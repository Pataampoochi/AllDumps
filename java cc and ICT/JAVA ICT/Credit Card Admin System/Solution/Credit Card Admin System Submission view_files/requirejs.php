define('core/modal_save_cancel', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events"],function(a,b,c,d,e){var f={SAVE_BUTTON:'[data-action="save"]',CANCEL_BUTTON:'[data-action="cancel"]'},g=function(a){d.call(this,a),this.getFooter().find(f.SAVE_BUTTON).length||b.exception({message:"No save button found"}),this.getFooter().find(f.CANCEL_BUTTON).length||b.exception({message:"No cancel button found"})};return g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.setFooter=function(){b.exception({message:"Can not change the footer of a save cancel modal"})},g.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,f.SAVE_BUTTON,function(b,c){var d=a.Event(e.save);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,f.CANCEL_BUTTON,function(b,c){var d=a.Event(e.cancel);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},g.prototype.setSaveButtonText=function(a){var b=this.getFooter().find(f.SAVE_BUTTON);this.asyncSet(a,b.text.bind(b))},g});
define('core/auto_rows', ["jquery"],function(a){var b={ELEMENT:"[data-auto-rows]"},c={ROW_CHANGE:"autorows:rowchange"},d=function(a){var b=a.attr("rows"),c=a.data("min-rows"),d=a.attr("data-max-rows"),e=a.height(),f=a.innerHeight(),g=f-e,h=a[0].scrollHeight,i=(h-g)/(e/b);return a.css("height",""),i<c?c:d&&i>=d?d:i},e=function(b){var e=a(b.target),f=e.data("min-rows"),g=e.attr("rows");"undefined"==typeof f&&e.data("min-rows",g),e.attr("rows",1);var h=d(e);e.attr("rows",h),h!=g&&e.trigger(c.ROW_CHANGE)},f=function(c){a(c).data("auto-rows")?a(c).on("input propertychange",e.bind(this)):a(c).on("input propertychange",b.ELEMENT,e.bind(this))};return{init:f,events:c}});
define('core/backoff_timer', function(){var a=function(a,b){this.callback=a,this.backOffFunction=b};return a.prototype.callback=null,a.prototype.backOffFunction=null,a.prototype.time=null,a.prototype.timeout=null,a.prototype.generateNextTime=function(){var a=this.backOffFunction(this.time);return this.time=a,a},a.prototype.reset=function(){return this.time=null,this.stop(),this},a.prototype.stop=function(){return this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null),this},a.prototype.start=function(){if(!this.timeout){var a=this.generateNextTime();this.timeout=window.setTimeout(function(){this.callback(),this.stop(),this.start()}.bind(this),a)}return this},a.prototype.restart=function(){return this.reset().start()},a.getIncrementalCallback=function(a,b,c,d){return function(e){return e?e+b>c?d:e+b:a}},a});
define('core/modal', ["jquery","core/templates","core/notification","core/key_codes","core/custom_interaction_events","core/modal_backdrop","core/event","core/modal_events"],function(a,b,c,d,e,f,g,h){var i,j={CONTAINER:'[data-region="modal-container"]',MODAL:'[data-region="modal"]',HEADER:'[data-region="header"]',TITLE:'[data-region="title"]',BODY:'[data-region="body"]',FOOTER:'[data-region="footer"]',HIDE:'[data-action="hide"]',DIALOG:"[role=dialog]",FORM:"form",MENU_BAR:"[role=menubar]",HAS_Z_INDEX:".moodle-has-zindex",CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]'},k={LOADING:"core/loading",BACKDROP:"core/modal_backdrop"},l=0,m=function(b){this.root=a(b),this.modal=this.root.find(j.MODAL),this.header=this.modal.find(j.HEADER),this.title=this.header.find(j.TITLE),this.body=this.modal.find(j.BODY),this.footer=this.modal.find(j.FOOTER),this.hiddenSiblings=[],this.isAttached=!1,this.bodyJS=null,this.footerJS=null,this.modalCount=l++,this.root.is(j.CONTAINER)||c.exception({message:"Element is not a modal container"}),this.modal.length||c.exception({message:"Container does not contain a modal"}),this.header.length||c.exception({message:"Modal is missing a header region"}),this.title.length||c.exception({message:"Modal header is missing a title region"}),this.body.length||c.exception({message:"Modal is missing a body region"}),this.footer.length||c.exception({message:"Modal is missing a footer region"}),this.registerEventListeners()};return m.prototype.attachToDOM=function(){this.isAttached||(a("body").append(this.root),this.bodyJS&&(b.runTemplateJS(this.bodyJS),this.bodyJS=null),this.footerJS&&(b.runTemplateJS(this.footerJS),this.footerJS=null),this.isAttached=!0)},m.prototype.countOtherVisibleModals=function(){var b=0;return a("body").find(j.CONTAINER).each(function(c,d){d=a(d),!this.root.is(d)&&d.hasClass("show")&&b++}.bind(this)),b},m.prototype.getBackdrop=function(){return i||(i=b.render(k.BACKDROP,{}).then(function(b){var c=a(b);return new f(c)}).fail(c.exception)),i},m.prototype.getRoot=function(){return this.root},m.prototype.getModal=function(){return this.modal},m.prototype.getTitle=function(){return this.title},m.prototype.getBody=function(){return this.body},m.prototype.getFooter=function(){return this.footer},m.prototype.getModalCount=function(){return this.modalCount},m.prototype.setTitle=function(a){var b=this.getTitle();this.asyncSet(a,b.html.bind(b))},m.prototype.setBody=function(d){var e=this.getBody();if("string"==typeof d)e.html(d),g.notifyFilterContentUpdated(e),this.getRoot().trigger(h.bodyRendered,this);else{var f="amd-modal-js-pending-id-"+this.getModalCount();M.util.js_pending(f);var i=null;if(e.css("overflow","hidden"),"pending"==d.state()){var j=e.innerHeight();j<100&&(j=100),e.animate({height:j+"px"},150),e.html(""),i=b.render(k.LOADING,{}).then(function(b){var c=a(b).hide();return e.html(c),c.fadeIn(150),a.when(c.promise(),d)}).then(function(a){return a.fadeOut(100).promise()}).then(function(){return d})}else i=d;i.then(function(a,c){var d=null;if(this.isVisible()){e.css("opacity",0);var f=e.innerHeight();e.html(a),e.css("height","");var i=e.innerHeight();e.css("height",f+"px"),d=e.animate({height:i+"px",opacity:1},{duration:150,queue:!1}).promise()}else e.html(a);return c&&(this.isAttached?b.runTemplateJS(c):this.bodyJS=c),g.notifyFilterContentUpdated(e),this.getRoot().trigger(h.bodyRendered,this),d}.bind(this)).fail(c.exception).always(function(){e.css("height",""),e.css("overflow",""),e.css("opacity",""),M.util.js_complete(f)}).fail(c.exception)}},m.prototype.setFooter=function(a){this.showFooter();var c=this.getFooter();"string"==typeof a?c.html(a):b.render(k.LOADING,{}).done(function(d){c.html(d),a.done(function(a,d){c.html(a),d&&(this.isAttached?b.runTemplateJS(d):this.footerJS=d)}.bind(this))}.bind(this))},m.prototype.hasFooterContent=function(){return!!this.getFooter().children().length},m.prototype.hideFooter=function(){this.getFooter().addClass("hidden")},m.prototype.showFooter=function(){this.getFooter().removeClass("hidden")},m.prototype.setLarge=function(){this.isLarge()||this.getModal().addClass("modal-lg")},m.prototype.isLarge=function(){return this.getModal().hasClass("modal-lg")},m.prototype.setSmall=function(){this.isSmall()||this.getModal().removeClass("modal-lg")},m.prototype.isSmall=function(){return!this.getModal().hasClass("modal-lg")},m.prototype.calculateZIndex=function(){var b=a(j.DIALOG+", "+j.MENU_BAR+", "+j.HAS_Z_INDEX),c=parseInt(this.root.css("z-index"));return b.each(function(b,d){d=a(d);var e=d.css("z-index")?parseInt(d.css("z-index")):0;e>c&&(c=e)}),c},m.prototype.isVisible=function(){return this.root.hasClass("show")},m.prototype.hasFocus=function(){var b=a(document.activeElement);return this.root.is(b)||this.root.has(b).length},m.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},m.prototype.show=function(){this.isVisible()||(this.hasFooterContent()?this.showFooter():this.hideFooter(),this.isAttached||this.attachToDOM(),this.getBackdrop().done(function(b){var c=this.calculateZIndex(),d=c+2,e=d-1;this.root.css("z-index",d),b.setZIndex(e),b.show(),this.root.removeClass("hide").addClass("show"),this.accessibilityShow(),this.getModal().focus(),a("body").addClass("modal-open"),this.root.trigger(h.shown,this)}.bind(this)))},m.prototype.hideIfNotForm=function(){var a=this.modal.find(j.FORM);0==a.length&&this.hide()},m.prototype.hide=function(){this.getBackdrop().done(function(b){this.countOtherVisibleModals()||(b.hide(),a("body").removeClass("modal-open"));var c=parseInt(this.root.css("z-index"));this.root.css("z-index",""),b.setZIndex(c-3),this.accessibilityHide(),this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"),this.root.trigger(h.hidden,this)}.bind(this))},m.prototype.destroy=function(){this.root.remove(),this.root.trigger(h.destroyed,this)},m.prototype.accessibilityShow=function(){a("body").children().each(function(b,c){if(!this.root.is(c)){c=a(c);var d=c.attr("aria-hidden");"true"!==d&&(c.data("previous-aria-hidden",d),this.hiddenSiblings.push(c),c.attr("aria-hidden","true"))}}.bind(this)),this.root.attr("aria-hidden","false")},m.prototype.accessibilityHide=function(){this.root.attr("aria-hidden","true"),a.each(this.hiddenSiblings,function(b,c){c=a(c);var d=c.data("previous-aria-hidden");"undefined"==typeof d?c.removeAttr("aria-hidden"):c.attr("aria-hidden",d)}),this.hiddenSiblings=[]},m.prototype.handleTabLock=function(b){if(this.hasFocus()){var c=a(document.activeElement),d=this.modal.find(j.CAN_RECEIVE_FOCUS),e=d.first(),f=d.last();c.is(e)&&b.shiftKey?(f.focus(),b.preventDefault()):c.is(f)&&!b.shiftKey&&(e.focus(),b.preventDefault())}},m.prototype.registerEventListeners=function(){this.getRoot().on("keydown",function(a){this.isVisible()&&(a.keyCode==d.tab?this.handleTabLock(a):a.keyCode==d.escape&&this.hide())}.bind(this)),this.getRoot().click(function(b){a(b.target).closest(j.MODAL).length||a(b.target).closest(j.CONTAINER).length&&this.hideIfNotForm()}.bind(this)),e.define(this.getModal(),[e.events.activate]),this.getModal().on(e.events.activate,j.HIDE,function(a,b){this.hide(),b.originalEvent.preventDefault()}.bind(this))},m.prototype.asyncSet=function(b,d){var e=b;return"object"==typeof b&&b.hasOwnProperty("then")||(e=a.Deferred(),e.resolve(b)),e.then(function(a){d(a)}).fail(c.exception),e},m});
define('core/modal_backdrop', ["jquery","core/templates","core/notification"],function(a,b,c){var d={ROOT:'[data-region="modal-backdrop"]'},e=function(b){this.root=a(b),this.isAttached=!1,this.root.is(d.ROOT)||c.exception({message:"Element is not a modal backdrop"})};return e.prototype.getRoot=function(){return this.root},e.prototype.attachToDOM=function(){this.isAttached||(a("body").append(this.root),this.isAttached=!0)},e.prototype.setZIndex=function(a){this.root.css("z-index",a)},e.prototype.isVisible=function(){return this.root.hasClass("show")},e.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},e.prototype.show=function(){this.isVisible()||(this.isAttached||this.attachToDOM(),this.root.removeClass("hide").addClass("show"))},e.prototype.hide=function(){this.isVisible()&&(this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"))},e.prototype.destroy=function(){this.root.remove()},e});
define('core/notification', ["core/yui","jquery","core/log"],function(a,b,c){var d={types:{success:"core/notification_success",info:"core/notification_info",warning:"core/notification_warning",error:"core/notification_error"},fieldName:"user-notifications",fetchNotifications:function(){require(["core/ajax"],function(a){var b=a.call([{methodname:"core_fetch_notifications",args:{contextid:d.contextid}}]);b[0].done(d.addNotifications)})},addNotifications:function(a){a||(a=[]),b.each(a,function(a,b){d.renderNotification(b.template,b.variables)})},setupTargetRegion:function(){var a=b("#"+d.fieldName);if(a.length)return!1;var c=b("<span>").attr("id",d.fieldName);return a=b("#region-main"),a.length?a.prepend(c):(a=b('[role="main"]'),a.length?a.prepend(c):(a=b("body"),a.prepend(c)))},addNotification:function(a){var c=d.types.error;return a=b.extend({closebutton:!0,announce:!0,type:"error"},a),a.template?(c=a.template,delete a.template):a.type&&("undefined"!=typeof d.types[a.type]&&(c=d.types[a.type]),delete a.type),d.renderNotification(c,a)},renderNotification:function(a,e){return"undefined"!=typeof e.message&&e.message?void require(["core/templates"],function(c){c.render(a,e).done(function(a,e){b("#"+d.fieldName).prepend(a),c.runTemplateJS(e)}).fail(d.exception)}):void c.debug("Notification received without content. Skipping.")},alert:function(b,c,d){a.use("moodle-core-notification-alert",function(){var a=new M.core.alert({title:b,message:c,yesLabel:d});a.show()})},confirm:function(b,c,d,e,f,g){a.use("moodle-core-notification-confirm",function(){var a=new M.core.confirm({title:b,question:c,yesLabel:d,noLabel:e});a.on("complete-yes",function(){f()}),g&&a.on("complete-no",function(){g()}),a.show()})},exception:function(b){if("undefined"==typeof b.stack&&(b.stack=""),b.debuginfo&&(b.stack+=b.debuginfo+"\n"),!b.backtrace&&b.stacktrace&&(b.backtrace=b.stacktrace),b.backtrace){b.stack+=b.backtrace;var c=b.backtrace.match(/line ([^ ]*) of/),d=b.backtrace.match(/ of ([^:]*): /);c&&c[1]&&(b.lineNumber=c[1]),d&&d[1]&&(b.fileName=d[1],b.fileName.length>30&&(b.fileName="..."+b.fileName.substr(b.fileName.length-27)))}"undefined"==typeof b.name&&b.errorcode&&(b.name=b.errorcode),a.use("moodle-core-notification-exception",function(){var a=new M.core.exception(b);a.show()})}};return{init:function(a,b){d.contextid=a,d.setupTargetRegion(),d.addNotifications(b),d.fetchNotifications()},fetchNotifications:d.fetchNotifications,addNotification:d.addNotification,alert:d.alert,confirm:d.confirm,exception:d.exception}});
define('core/form-autocomplete', ["jquery","core/log","core/str","core/templates","core/notification"],function(a,b,c,d,e){var f={DOWN:40,ENTER:13,SPACE:32,ESCAPE:27,COMMA:44,UP:38},g=a.now(),h=function(b,c){var d=a(document.getElementById(c.selectionId)),e=d.children("[aria-selected=true]").length;for(b%=e;b<0;)b+=e;var f=a(d.children("[aria-selected=true]").get(b)),g=c.selectionId+"-"+b;return d.children().attr("data-active-selection",!1).attr("id",""),f.attr("data-active-selection",!0).attr("id",g),d.attr("aria-activedescendant",g),a.Deferred().resolve()},i=function(b,c,f){var g="form-autocomplete-updateSelectionList-"+c.inputId;M.util.js_pending(g);var i=[],j=a(document.getElementById(c.selectionId)),k=j.attr("aria-activedescendant"),l=!1;k&&(l=a(document.getElementById(k)).attr("data-value")),f.children("option").each(function(b,c){if(a(c).prop("selected")){var d;d=a(c).data("html")?a(c).data("html"):a(c).html(),""!==d&&i.push({label:d,value:a(c).attr("value")})}});var m=a.extend({items:i},b,c);return d.render("core/form_autocomplete_selection",m).then(function(b,e){return d.replaceNodeContents(j,b,e),l!==!1&&j.children("[aria-selected=true]").each(function(b,d){a(d).attr("data-value")===l&&h(b,c)}),l}).then(function(){return M.util.js_complete(g)})["catch"](e.exception)},j=function(a){"undefined"!=typeof M.core_formchangechecker&&M.core_formchangechecker.set_form_changed(),a.change()},k=function(b,c,d,e){var f=a(d).attr("data-value");return e.children("option").each(function(b,c){a(c).attr("value")==f&&(a(c).prop("selected",!1),a(c).attr("data-iscustom")&&a(c).remove())}),i(b,c,e).then(function(){j(e)})},l=function(b,c){var d=a(document.getElementById(c.inputId)),e=a(document.getElementById(c.suggestionsId)),f=e.children("[aria-hidden=false]").length;for(b%=f;b<0;)b+=f;var g=a(e.children("[aria-hidden=false]").get(b)),h=a(e.children("[role=option]")).index(g),i=c.suggestionsId+"-"+h;e.children().attr("aria-selected",!1).attr("id",""),g.attr("aria-selected",!0).attr("id",i),d.attr("aria-activedescendant",i);var j=g.offset().top-e.offset().top+e.scrollTop()-e.height()/2;return e.animate({scrollTop:j},100).promise()},m=function(b){var c=a(document.getElementById(b.suggestionsId)),d=c.children("[aria-selected=true]"),e=c.children("[aria-hidden=false]").index(d);return l(e+1,b)},n=function(b){var c=a(document.getElementById(b.selectionId)),d=c.children("[data-active-selection=true]");if(!d)return h(0,b);var e=c.children("[aria-selected=true]").index(d);return h(e-1,b)},o=function(b){var c=a(document.getElementById(b.selectionId)),d=c.children("[data-active-selection=true]"),e=0;return d?(e=c.children("[aria-selected=true]").index(d),e+=1):e=0,h(e,b)},p=function(b){var c=a(document.getElementById(b.suggestionsId)),d=c.children("[aria-selected=true]"),e=c.children("[aria-hidden=false]").index(d);return l(e-1,b)},q=function(b){var c=a(document.getElementById(b.inputId)),d=a(document.getElementById(b.suggestionsId));return c.attr("aria-expanded",!1).attr("aria-activedescendant",b.selectionId),d.hide().attr("aria-hidden",!0),a.Deferred().resolve()},r=function(b,f,g,h){var i="form-autocomplete-updateSuggestions-"+f.inputId;M.util.js_pending(i);var j=a(document.getElementById(f.inputId)),k=a(document.getElementById(f.suggestionsId)),m=!1,n=[];h.children("option").each(function(b,c){a(c).prop("selected")!==!0&&(n[n.length]={label:c.innerHTML,value:a(c).attr("value")})});var o=f.caseSensitive?g:g.toLocaleLowerCase(),p=a.extend({options:n},b,f),q=d.render("core/form_autocomplete_suggestions",p).then(function(e,g){return d.replaceNode(k,e,g),k=a(document.getElementById(f.suggestionsId)),k.show().attr("aria-hidden",!1),k.children().each(function(c,d){d=a(d),b.caseSensitive&&d.text().indexOf(o)>-1||!b.caseSensitive&&d.text().toLocaleLowerCase().indexOf(o)>-1?(d.show().attr("aria-hidden",!1),m=!0):d.hide().attr("aria-hidden",!0)}),j.attr("aria-expanded",!0),h.attr("data-notice")?k.html(h.attr("data-notice")):m?b.tags||l(0,f):c.get_string("nosuggestions","form").done(function(a){k.html(a)}),k}).then(function(){return M.util.js_complete(i)})["catch"](e.exception);return q},s=function(b,c,d){var e=a(document.getElementById(c.inputId)),f=e.val(),g=f.split(","),h=!1;return a.each(g,function(c,e){if(e=e.trim(),""!==e&&(b.multiple||d.children("option").prop("selected",!1),d.children("option").each(function(b,c){a(c).attr("value")==e&&(h=!0,a(c).prop("selected",!0))}),!h)){var f=a("<option>");f.append(document.createTextNode(e)),f.attr("value",e),d.append(f),f.prop("selected",!0),f.attr("data-iscustom",!0)}}),i(b,c,d).then(function(){j(d)}).then(function(){e.val("")}).then(function(){return q(c)})},t=function(b,c,d){var e=a(document.getElementById(c.inputId)),f=a(document.getElementById(c.suggestionsId)),g=f.children("[aria-selected=true]").attr("data-value");return b.multiple||d.children("option").prop("selected",!1),d.children("option").each(function(b,c){a(c).attr("value")==g&&a(c).prop("selected",!0)}),i(b,c,d).then(function(){j(d)}).then(function(){return b.closeSuggestionsOnSelect?(e.val(""),q(c)):(e.focus(),r(b,c,e.val(),d))})},u=function(b,c,d,e,f){var g=w("updateAjax"),h=a(b.currentTarget).val();return f.transport(c.selector,h,function(b){var h=f.processResults(c.selector,b),i=[];if(c.multiple||e.children("option").remove(),e.children("option").each(function(b,c){c=a(c),c.prop("selected")?i.push(String(c.attr("value"))):c.remove()}),!c.multiple&&0===e.children("option").length){var j=a("<option>");e.append(j)}a.isArray(h)?(a.each(h,function(b,c){if(i.indexOf(String(c.value))===-1){var d=a("<option>");d.append(c.label),d.attr("value",c.value),e.append(d)}}),e.attr("data-notice","")):e.attr("data-notice",h),g.resolve(r(c,d,"",e))},function(a){g.reject(a)}),g},v=function(b,c,d){var g=a(document.getElementById(c.inputId));if(g.on("keydown",function(e){var h=w("addNavigation-"+c.inputId+"-"+e.keyCode);switch(e.keyCode){case f.DOWN:return b.showSuggestions?("true"===g.attr("aria-expanded")?h.resolve(m(c)):!g.val()&&b.ajax?require([b.ajax],function(a){h.resolve(u(e,b,c,d,a))}):h.resolve(r(b,c,g.val(),d)),e.preventDefault(),!1):(h.resolve(),!0);case f.UP:return h.resolve(p(c)),e.preventDefault(),!1;case f.ENTER:var i=a(document.getElementById(c.suggestionsId));return"true"===g.attr("aria-expanded")&&i.children("[aria-selected=true]").length>0?h.resolve(t(b,c,d)):b.tags?h.resolve(s(b,c,d)):h.resolve(),e.preventDefault(),!1;case f.ESCAPE:return"true"===g.attr("aria-expanded")?h.resolve(q(c)):h.resolve(),e.preventDefault(),!1}return h.resolve(),!0}),g.on("keypress",function(a){return a.keyCode!==f.COMMA||(b.tags&&w("keypress-"+a.keyCode).resolve(s(b,c,d)),a.preventDefault(),!1)}),g.closest("form").on("submit",function(){return b.tags&&w("form-autocomplete-submit").resolve(s(b,c,d)),!0}),g.on("blur",function(){var e=w("form-autocomplete-blur");window.setTimeout(function(){var f=a(document.activeElement),h=a.Deferred();f.is(document.getElementById(c.suggestionsId))?g.focus():!f.is(g)&&a(document.getElementById(c.inputId)).length&&(b.tags&&h.then(function(){return s(b,c,d)})["catch"](),h.then(function(){return q(c)})["catch"]()),h.then(function(){return e.resolve()})["catch"](),h.resolve()},500)}),b.showSuggestions){var h=a(document.getElementById(c.downArrowId));h.on("click",function(a){var e=w("form-autocomplete-show-suggestions");g.focus(),!g.val()&&b.ajax?require([b.ajax],function(f){e.resolve(u(a,b,c,d,f))}):e.resolve(r(b,c,g.val(),d))})}var i=a(document.getElementById(c.suggestionsId));i.parent().prop("onclick",null).off("click"),i.parent().on("click","[role=option]",function(e){var f=w("form-autocomplete-parent"),g=a(e.currentTarget).closest("[role=option]"),h=a(document.getElementById(c.suggestionsId)),i=h.children("[aria-hidden=false]").index(g);l(i,c).then(function(){return t(b,c,d)}).then(function(){return f.resolve()})["catch"]()});var j=a(document.getElementById(c.selectionId));j.on("click","[role=listitem]",function(e){var f=w("form-autocomplete-clicks");f.resolve(k(b,c,a(e.currentTarget),d))}),j.on("keydown",function(e){var g=w("form-autocomplete-keydown-"+e.keyCode);switch(e.keyCode){case f.DOWN:return e.preventDefault(),g.resolve(o(c)),!1;case f.UP:return e.preventDefault(),g.resolve(n(c)),!1;case f.SPACE:case f.ENTER:var h=a(document.getElementById(c.selectionId)).children("[data-active-selection=true]");return h&&(e.preventDefault(),g.resolve(k(b,c,h,d))),!1}return g.resolve(),!0}),b.showSuggestions&&(b.ajax?require([b.ajax],function(a){var f=null,h=!1,i="autocomplete-throttledhandler",j=function(g){f=null,h=!0,u(g,b,c,d,a).then(function(){return null===f&&M.util.js_complete(i),h=!1,arguments[0]})["catch"](e.exception)},k=function(a){return window.clearTimeout(f),h?void(f=window.setTimeout(k.bind(this,a),100)):(null===f&&M.util.js_pending(i),void(f=window.setTimeout(j.bind(this,a),300)))};g.on("input",k)}):g.on("input",function(e){var f=a(e.currentTarget).val(),g=a(e.currentTarget).data("last-value");g!==f&&r(b,c,f,d),a(e.currentTarget).data("last-value",f)}))},w=function(b){var c="form-autocomplete:"+b;M.util.js_pending(c);var d=a.Deferred();return d.then(function(){return M.util.js_complete(c),arguments[0]})["catch"](e.exception),d};return{enhance:function(f,h,j,k,l,m,n,o){var p={selector:f,tags:!1,ajax:!1,placeholder:k,caseSensitive:!1,showSuggestions:!0,noSelectionString:n},q="autocomplete-setup-"+f;M.util.js_pending(q),"undefined"!=typeof h&&(p.tags=h),"undefined"!=typeof j&&(p.ajax=j),"undefined"!=typeof l&&(p.caseSensitive=l),"undefined"!=typeof m&&(p.showSuggestions=m),"undefined"==typeof n&&c.get_string("noselection","form").done(function(a){p.noSelectionString=a}).fail(e.exception);var r=a(f);if(!r)return b.debug("Selector not found: "+f),M.util.js_complete(q),!1;r.css("visibility","hidden").attr("aria-hidden",!0);var s={selectId:r.attr("id"),inputId:"form_autocomplete_input-"+g,suggestionsId:"form_autocomplete_suggestions-"+g,selectionId:"form_autocomplete_selection-"+g,downArrowId:"form_autocomplete_downarrow-"+g};g++,p.multiple=r.attr("multiple"),"undefined"!=typeof o?p.closeSuggestionsOnSelect=o:p.closeSuggestionsOnSelect=!p.multiple;var t=a("[for="+s.selectId+"]"),u=[];r.children("option").each(function(b,c){u[b]={label:c.innerHTML,value:a(c).attr("value")}});var w=a.extend({},p,s);w.options=u,w.items=[];var x="",y=d.render("core/form_autocomplete_input",w).then(function(a,b){return x+=b,a}),z=d.render("core/form_autocomplete_suggestions",w).then(function(a,b){return x+=b,a}),A=d.render("core/form_autocomplete_selection",w).then(function(a,b){return x+=b,a});return a.when(y,z,A).then(function(b,c,e){r.hide(),r.after(c),r.after(b),r.after(e),d.runTemplateJS(x),t.attr("for",s.inputId),v(p,s,r);var f=a(document.getElementById(s.suggestionsId));f.hide().attr("aria-hidden",!0)}).then(function(){return i(p,s,r)}).then(function(){return M.util.js_complete(q)})["catch"](function(a){M.util.js_complete(q),e.exception(a)})}}});
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define('core/popper', b):a.Popper=b()}(this,function(){"use strict";function a(a){var b=!1;return function(){b||(b=!0,Promise.resolve().then(function(){b=!1,a()}))}}function b(a){var b=!1;return function(){b||(b=!0,setTimeout(function(){b=!1,a()},ha))}}function c(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function d(a,b){if(1!==a.nodeType)return[];var c=window.getComputedStyle(a,null);return b?c[b]:c}function e(a){return"HTML"===a.nodeName?a:a.parentNode||a.host}function f(a){if(!a)return window.document.body;switch(a.nodeName){case"HTML":case"BODY":return a.ownerDocument.body;case"#document":return a.body}var b=d(a),c=b.overflow,g=b.overflowX,h=b.overflowY;return/(auto|scroll)/.test(c+h+g)?a:f(e(a))}function g(a){var b=a&&a.offsetParent,c=b&&b.nodeName;return c&&"BODY"!==c&&"HTML"!==c?["TD","TABLE"].indexOf(b.nodeName)!==-1&&"static"===d(b,"position")?g(b):b:a?a.ownerDocument.documentElement:window.document.documentElement}function h(a){var b=a.nodeName;return"BODY"!==b&&("HTML"===b||g(a.firstElementChild)===a)}function i(a){return null!==a.parentNode?i(a.parentNode):a}function j(a,b){if(!(a&&a.nodeType&&b&&b.nodeType))return window.document.documentElement;var c=a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING,d=c?a:b,e=c?b:a,f=document.createRange();f.setStart(d,0),f.setEnd(e,0);var k=f.commonAncestorContainer;if(a!==k&&b!==k||d.contains(e))return h(k)?k:g(k);var l=i(a);return l.host?j(l.host,b):j(a,i(b).host)}function k(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",c="top"===b?"scrollTop":"scrollLeft",d=a.nodeName;if("BODY"===d||"HTML"===d){var e=a.ownerDocument.documentElement,f=a.ownerDocument.scrollingElement||e;return f[c]}return a[c]}function l(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=k(b,"top"),e=k(b,"left"),f=c?-1:1;return a.top+=d*f,a.bottom+=d*f,a.left+=e*f,a.right+=e*f,a}function m(a,b){var c="x"===b?"Left":"Top",d="Left"===c?"Right":"Bottom";return+a["border"+c+"Width"].split("px")[0]+ +a["border"+d+"Width"].split("px")[0]}function n(a,b,c,d){return Math.max(b["offset"+a],b["scroll"+a],c["client"+a],c["offset"+a],c["scroll"+a],ma()?c["offset"+a]+d["margin"+("Height"===a?"Top":"Left")]+d["margin"+("Height"===a?"Bottom":"Right")]:0)}function o(){var a=window.document.body,b=window.document.documentElement,c=ma()&&window.getComputedStyle(b);return{height:n("Height",a,b,c),width:n("Width",a,b,c)}}function p(a){return qa({},a,{right:a.left+a.width,bottom:a.top+a.height})}function q(a){var b={};if(ma())try{b=a.getBoundingClientRect();var c=k(a,"top"),e=k(a,"left");b.top+=c,b.left+=e,b.bottom+=c,b.right+=e}catch(f){}else b=a.getBoundingClientRect();var g={left:b.left,top:b.top,width:b.right-b.left,height:b.bottom-b.top},h="HTML"===a.nodeName?o():{},i=h.width||a.clientWidth||g.right-g.left,j=h.height||a.clientHeight||g.bottom-g.top,l=a.offsetWidth-i,n=a.offsetHeight-j;if(l||n){var q=d(a);l-=m(q,"x"),n-=m(q,"y"),g.width-=l,g.height-=n}return p(g)}function r(a,b){var c=ma(),e="HTML"===b.nodeName,g=q(a),h=q(b),i=f(a),j=d(b),k=+j.borderTopWidth.split("px")[0],m=+j.borderLeftWidth.split("px")[0],n=p({top:g.top-h.top-k,left:g.left-h.left-m,width:g.width,height:g.height});if(n.marginTop=0,n.marginLeft=0,!c&&e){var o=+j.marginTop.split("px")[0],r=+j.marginLeft.split("px")[0];n.top-=k-o,n.bottom-=k-o,n.left-=m-r,n.right-=m-r,n.marginTop=o,n.marginLeft=r}return(c?b.contains(i):b===i&&"BODY"!==i.nodeName)&&(n=l(n,b)),n}function s(a){var b=a.ownerDocument.documentElement,c=r(a,b),d=Math.max(b.clientWidth,window.innerWidth||0),e=Math.max(b.clientHeight,window.innerHeight||0),f=k(b),g=k(b,"left"),h={top:f-c.top+c.marginTop,left:g-c.left+c.marginLeft,width:d,height:e};return p(h)}function t(a){var b=a.nodeName;return"BODY"!==b&&"HTML"!==b&&("fixed"===d(a,"position")||t(e(a)))}function u(a,b,c,d){var g={top:0,left:0},h=j(a,b);if("viewport"===d)g=s(h);else{var i=void 0;"scrollParent"===d?(i=f(e(a)),"BODY"===i.nodeName&&(i=a.ownerDocument.documentElement)):i="window"===d?a.ownerDocument.documentElement:d;var k=r(i,h);if("HTML"!==i.nodeName||t(h))g=k;else{var l=o(),m=l.height,n=l.width;g.top+=k.top-k.marginTop,g.bottom=m+k.top,g.left+=k.left-k.marginLeft,g.right=n+k.left}}return g.left+=c,g.top+=c,g.right-=c,g.bottom-=c,g}function v(a){var b=a.width,c=a.height;return b*c}function w(a,b,c,d,e){var f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(a.indexOf("auto")===-1)return a;var g=u(c,d,f,e),h={top:{width:g.width,height:b.top-g.top},right:{width:g.right-b.right,height:g.height},bottom:{width:g.width,height:g.bottom-b.bottom},left:{width:b.left-g.left,height:g.height}},i=Object.keys(h).map(function(a){return qa({key:a},h[a],{area:v(h[a])})}).sort(function(a,b){return b.area-a.area}),j=i.filter(function(a){var b=a.width,d=a.height;return b>=c.clientWidth&&d>=c.clientHeight}),k=j.length>0?j[0].key:i[0].key,l=a.split("-")[1];return k+(l?"-"+l:"")}function x(a,b,c){var d=j(b,c);return r(c,d)}function y(a){var b=window.getComputedStyle(a),c=parseFloat(b.marginTop)+parseFloat(b.marginBottom),d=parseFloat(b.marginLeft)+parseFloat(b.marginRight),e={width:a.offsetWidth+d,height:a.offsetHeight+c};return e}function z(a){var b={left:"right",right:"left",bottom:"top",top:"bottom"};return a.replace(/left|right|bottom|top/g,function(a){return b[a]})}function A(a,b,c){c=c.split("-")[0];var d=y(a),e={width:d.width,height:d.height},f=["right","left"].indexOf(c)!==-1,g=f?"top":"left",h=f?"left":"top",i=f?"height":"width",j=f?"width":"height";return e[g]=b[g]+b[i]/2-d[i]/2,c===h?e[h]=b[h]-d[j]:e[h]=b[z(h)],e}function B(a,b){return Array.prototype.find?a.find(b):a.filter(b)[0]}function C(a,b,c){if(Array.prototype.findIndex)return a.findIndex(function(a){return a[b]===c});var d=B(a,function(a){return a[b]===c});return a.indexOf(d)}function D(a,b,d){var e=void 0===d?a:a.slice(0,C(a,"name",d));return e.forEach(function(a){a["function"]&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var d=a["function"]||a.fn;a.enabled&&c(d)&&(b.offsets.popper=p(b.offsets.popper),b.offsets.reference=p(b.offsets.reference),b=d(b,a))}),b}function E(){if(!this.state.isDestroyed){var a={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};a.offsets.reference=x(this.state,this.popper,this.reference),a.placement=w(this.options.placement,a.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),a.originalPlacement=a.placement,a.offsets.popper=A(this.popper,a.offsets.reference,a.placement),a.offsets.popper.position="absolute",a=D(this.modifiers,a),this.state.isCreated?this.options.onUpdate(a):(this.state.isCreated=!0,this.options.onCreate(a))}}function F(a,b){return a.some(function(a){var c=a.name,d=a.enabled;return d&&c===b})}function G(a){for(var b=[!1,"ms","Webkit","Moz","O"],c=a.charAt(0).toUpperCase()+a.slice(1),d=0;d<b.length-1;d++){var e=b[d],f=e?""+e+c:a;if("undefined"!=typeof window.document.body.style[f])return f}return null}function H(){return this.state.isDestroyed=!0,F(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.left="",this.popper.style.position="",this.popper.style.top="",this.popper.style[G("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function I(a){var b=a.ownerDocument;return b?b.defaultView:window}function J(a,b,c,d){var e="BODY"===a.nodeName,g=e?a.ownerDocument.defaultView:a;g.addEventListener(b,c,{passive:!0}),e||J(f(g.parentNode),b,c,d),d.push(g)}function K(a,b,c,d){c.updateBound=d,I(a).addEventListener("resize",c.updateBound,{passive:!0});var e=f(a);return J(e,"scroll",c.updateBound,c.scrollParents),c.scrollElement=e,c.eventsEnabled=!0,c}function L(){this.state.eventsEnabled||(this.state=K(this.reference,this.options,this.state,this.scheduleUpdate))}function M(a,b){return I(a).removeEventListener("resize",b.updateBound),b.scrollParents.forEach(function(a){a.removeEventListener("scroll",b.updateBound)}),b.updateBound=null,b.scrollParents=[],b.scrollElement=null,b.eventsEnabled=!1,b}function N(){this.state.eventsEnabled&&(window.cancelAnimationFrame(this.scheduleUpdate),this.state=M(this.reference,this.state))}function O(a){return""!==a&&!isNaN(parseFloat(a))&&isFinite(a)}function P(a,b){Object.keys(b).forEach(function(c){var d="";["width","height","top","right","bottom","left"].indexOf(c)!==-1&&O(b[c])&&(d="px"),a.style[c]=b[c]+d})}function Q(a,b){Object.keys(b).forEach(function(c){var d=b[c];d!==!1?a.setAttribute(c,b[c]):a.removeAttribute(c)})}function R(a){return P(a.instance.popper,a.styles),Q(a.instance.popper,a.attributes),a.arrowElement&&Object.keys(a.arrowStyles).length&&P(a.arrowElement,a.arrowStyles),a}function S(a,b,c,d,e){var f=x(e,b,a),g=w(c.placement,f,b,a,c.modifiers.flip.boundariesElement,c.modifiers.flip.padding);return b.setAttribute("x-placement",g),P(b,{position:"absolute"}),c}function T(a,b){var c=b.x,d=b.y,e=a.offsets.popper,f=B(a.instance.modifiers,function(a){return"applyStyle"===a.name}).gpuAcceleration;void 0!==f&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var h=void 0!==f?f:b.gpuAcceleration,i=g(a.instance.popper),j=q(i),k={position:e.position},l={left:Math.floor(e.left),top:Math.floor(e.top),bottom:Math.floor(e.bottom),right:Math.floor(e.right)},m="bottom"===c?"top":"bottom",n="right"===d?"left":"right",o=G("transform"),p=void 0,r=void 0;if(r="bottom"===m?-j.height+l.bottom:l.top,p="right"===n?-j.width+l.right:l.left,h&&o)k[o]="translate3d("+p+"px, "+r+"px, 0)",k[m]=0,k[n]=0,k.willChange="transform";else{var s="bottom"===m?-1:1,t="right"===n?-1:1;k[m]=r*s,k[n]=p*t,k.willChange=m+", "+n}var u={"x-placement":a.placement};return a.attributes=qa({},u,a.attributes),a.styles=qa({},k,a.styles),a.arrowStyles=qa({},a.offsets.arrow,a.arrowStyles),a}function U(a,b,c){var d=B(a,function(a){var c=a.name;return c===b}),e=!!d&&a.some(function(a){return a.name===c&&a.enabled&&a.order<d.order});if(!e){var f="`"+b+"`",g="`"+c+"`";console.warn(g+" modifier is required by "+f+" modifier in order to work, be sure to include it before "+f+"!")}return e}function V(a,b){if(!U(a.instance.modifiers,"arrow","keepTogether"))return a;var c=b.element;if("string"==typeof c){if(c=a.instance.popper.querySelector(c),!c)return a}else if(!a.instance.popper.contains(c))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),a;var e=a.placement.split("-")[0],f=a.offsets,g=f.popper,h=f.reference,i=["left","right"].indexOf(e)!==-1,j=i?"height":"width",k=i?"Top":"Left",l=k.toLowerCase(),m=i?"left":"top",n=i?"bottom":"right",o=y(c)[j];h[n]-o<g[l]&&(a.offsets.popper[l]-=g[l]-(h[n]-o)),h[l]+o>g[n]&&(a.offsets.popper[l]+=h[l]+o-g[n]);var q=h[l]+h[j]/2-o/2,r=d(a.instance.popper,"margin"+k).replace("px",""),s=q-p(a.offsets.popper)[l]-r;return s=Math.max(Math.min(g[j]-o,s),0),a.arrowElement=c,a.offsets.arrow={},a.offsets.arrow[l]=Math.round(s),a.offsets.arrow[m]="",a}function W(a){return"end"===a?"start":"start"===a?"end":a}function X(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=sa.indexOf(a),d=sa.slice(c+1).concat(sa.slice(0,c));return b?d.reverse():d}function Y(a,b){if(F(a.instance.modifiers,"inner"))return a;if(a.flipped&&a.placement===a.originalPlacement)return a;var c=u(a.instance.popper,a.instance.reference,b.padding,b.boundariesElement),d=a.placement.split("-")[0],e=z(d),f=a.placement.split("-")[1]||"",g=[];switch(b.behavior){case ta.FLIP:g=[d,e];break;case ta.CLOCKWISE:g=X(d);break;case ta.COUNTERCLOCKWISE:g=X(d,!0);break;default:g=b.behavior}return g.forEach(function(h,i){if(d!==h||g.length===i+1)return a;d=a.placement.split("-")[0],e=z(d);var j=a.offsets.popper,k=a.offsets.reference,l=Math.floor,m="left"===d&&l(j.right)>l(k.left)||"right"===d&&l(j.left)<l(k.right)||"top"===d&&l(j.bottom)>l(k.top)||"bottom"===d&&l(j.top)<l(k.bottom),n=l(j.left)<l(c.left),o=l(j.right)>l(c.right),p=l(j.top)<l(c.top),q=l(j.bottom)>l(c.bottom),r="left"===d&&n||"right"===d&&o||"top"===d&&p||"bottom"===d&&q,s=["top","bottom"].indexOf(d)!==-1,t=!!b.flipVariations&&(s&&"start"===f&&n||s&&"end"===f&&o||!s&&"start"===f&&p||!s&&"end"===f&&q);(m||r||t)&&(a.flipped=!0,(m||r)&&(d=g[i+1]),t&&(f=W(f)),a.placement=d+(f?"-"+f:""),a.offsets.popper=qa({},a.offsets.popper,A(a.instance.popper,a.offsets.reference,a.placement)),a=D(a.instance.modifiers,a,"flip"))}),a}function Z(a){var b=a.offsets,c=b.popper,d=b.reference,e=a.placement.split("-")[0],f=Math.floor,g=["top","bottom"].indexOf(e)!==-1,h=g?"right":"bottom",i=g?"left":"top",j=g?"width":"height";return c[h]<f(d[i])&&(a.offsets.popper[i]=f(d[i])-c[j]),c[i]>f(d[h])&&(a.offsets.popper[i]=f(d[h])),a}function $(a,b,c,d){var e=a.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),f=+e[1],g=e[2];if(!f)return a;if(0===g.indexOf("%")){var h=void 0;switch(g){case"%p":h=c;break;case"%":case"%r":default:h=d}var i=p(h);return i[b]/100*f}if("vh"===g||"vw"===g){var j=void 0;return j="vh"===g?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),j/100*f}return f}function _(a,b,c,d){var e=[0,0],f=["right","left"].indexOf(d)!==-1,g=a.split(/(\+|\-)/).map(function(a){return a.trim()}),h=g.indexOf(B(g,function(a){return a.search(/,|\s/)!==-1}));g[h]&&g[h].indexOf(",")===-1&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var i=/\s*,\s*|\s+/,j=h!==-1?[g.slice(0,h).concat([g[h].split(i)[0]]),[g[h].split(i)[1]].concat(g.slice(h+1))]:[g];return j=j.map(function(a,d){var e=(1===d?!f:f)?"height":"width",g=!1;return a.reduce(function(a,b){return""===a[a.length-1]&&["+","-"].indexOf(b)!==-1?(a[a.length-1]=b,g=!0,a):g?(a[a.length-1]+=b,g=!1,a):a.concat(b)},[]).map(function(a){return $(a,e,b,c)})}),j.forEach(function(a,b){a.forEach(function(c,d){O(c)&&(e[b]+=c*("-"===a[d-1]?-1:1))})}),e}function aa(a,b){var c=b.offset,d=a.placement,e=a.offsets,f=e.popper,g=e.reference,h=d.split("-")[0],i=void 0;return i=O(+c)?[+c,0]:_(c,f,g,h),"left"===h?(f.top+=i[0],f.left-=i[1]):"right"===h?(f.top+=i[0],f.left+=i[1]):"top"===h?(f.left+=i[0],f.top-=i[1]):"bottom"===h&&(f.left+=i[0],f.top+=i[1]),a.popper=f,a}function ba(a,b){var c=b.boundariesElement||g(a.instance.popper);a.instance.reference===c&&(c=g(c));var d=u(a.instance.popper,a.instance.reference,b.padding,c);b.boundaries=d;var e=b.priority,f=a.offsets.popper,h={primary:function(a){var c=f[a];return f[a]<d[a]&&!b.escapeWithReference&&(c=Math.max(f[a],d[a])),pa({},a,c)},secondary:function(a){var c="right"===a?"left":"top",e=f[c];return f[a]>d[a]&&!b.escapeWithReference&&(e=Math.min(f[c],d[a]-("right"===a?f.width:f.height))),pa({},c,e)}};return e.forEach(function(a){var b=["left","top"].indexOf(a)!==-1?"primary":"secondary";f=qa({},f,h[b](a))}),a.offsets.popper=f,a}function ca(a){var b=a.placement,c=b.split("-")[0],d=b.split("-")[1];if(d){var e=a.offsets,f=e.reference,g=e.popper,h=["bottom","top"].indexOf(c)!==-1,i=h?"left":"top",j=h?"width":"height",k={start:pa({},i,f[i]),end:pa({},i,f[i]+f[j]-g[j])};a.offsets.popper=qa({},g,k[d])}return a}function da(a){if(!U(a.instance.modifiers,"hide","preventOverflow"))return a;var b=a.offsets.reference,c=B(a.instance.modifiers,function(a){return"preventOverflow"===a.name}).boundaries;if(b.bottom<c.top||b.left>c.right||b.top>c.bottom||b.right<c.left){if(a.hide===!0)return a;a.hide=!0,a.attributes["x-out-of-boundaries"]=""}else{if(a.hide===!1)return a;a.hide=!1,a.attributes["x-out-of-boundaries"]=!1}return a}function ea(a){var b=a.placement,c=b.split("-")[0],d=a.offsets,e=d.popper,f=d.reference,g=["left","right"].indexOf(c)!==-1,h=["top","left"].indexOf(c)===-1;return e[g?"left":"top"]=f[c]-(h?e[g?"width":"height"]:0),a.placement=z(b),a.offsets.popper=p(e),a}for(var fa="undefined"!=typeof window&&"undefined"!=typeof window.document,ga=["Edge","Trident","Firefox"],ha=0,ia=0;ia<ga.length;ia+=1)if(fa&&navigator.userAgent.indexOf(ga[ia])>=0){ha=1;break}var ja=fa&&window.Promise,ka=ja?a:b,la=void 0,ma=function(){return void 0===la&&(la=navigator.appVersion.indexOf("MSIE 10")!==-1),la},na=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},oa=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),pa=function(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},qa=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},ra=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],sa=ra.slice(3),ta={FLIP:"flip",CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise"},ua={shift:{order:100,enabled:!0,fn:ca},offset:{order:200,enabled:!0,fn:aa,offset:0},preventOverflow:{order:300,enabled:!0,fn:ba,priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:Z},arrow:{order:500,enabled:!0,fn:V,element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:Y,behavior:"flip",padding:5,boundariesElement:"viewport"},inner:{order:700,enabled:!1,fn:ea},hide:{order:800,enabled:!0,fn:da},computeStyle:{order:850,enabled:!0,fn:T,gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:R,onLoad:S,gpuAcceleration:void 0}},va={placement:"bottom",eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:ua},wa=function(){function a(b,d){var e=this,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};na(this,a),this.scheduleUpdate=function(){return requestAnimationFrame(e.update)},this.update=ka(this.update.bind(this)),this.options=qa({},a.Defaults,f),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=b&&b.jquery?b[0]:b,this.popper=d&&d.jquery?d[0]:d,this.options.modifiers={},Object.keys(qa({},a.Defaults.modifiers,f.modifiers)).forEach(function(b){e.options.modifiers[b]=qa({},a.Defaults.modifiers[b]||{},f.modifiers?f.modifiers[b]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(a){return qa({name:a},e.options.modifiers[a])}).sort(function(a,b){return a.order-b.order}),this.modifiers.forEach(function(a){a.enabled&&c(a.onLoad)&&a.onLoad(e.reference,e.popper,e.options,a,e.state)}),this.update();var g=this.options.eventsEnabled;g&&this.enableEventListeners(),this.state.eventsEnabled=g}return oa(a,[{key:"update",value:function(){return E.call(this)}},{key:"destroy",value:function(){return H.call(this)}},{key:"enableEventListeners",value:function(){return L.call(this)}},{key:"disableEventListeners",value:function(){return N.call(this)}}]),a}();return wa.Utils=("undefined"!=typeof window?window:global).PopperUtils,wa.placements=ra,wa.Defaults=va,wa});
define('core/paged_content_paging_bar', ["jquery","core/custom_interaction_events","core/paged_content_events","core/str","core/pubsub"],function(a,b,c,d,e){var f={ROOT:'[data-region="paging-bar"]',PAGE:"[data-page]",PAGE_ITEM:'[data-region="page-item"]',PAGE_LINK:'[data-region="page-link"]',FIRST_BUTTON:'[data-control="first"]',LAST_BUTTON:'[data-control="last"]',NEXT_BUTTON:'[data-control="next"]',PREVIOUS_BUTTON:'[data-control="previous"]',DOTS_BUTTONS:"[data-dots]",BEGINNING_DOTS_BUTTON:'[data-dots="beginning"]',ENDING_DOTS_BUTTON:'[data-dots="ending"]'},g=function(a,b){return a.find(f.PAGE_ITEM+'[data-page-number="'+b+'"]')},h=function(a){return a.find(f.NEXT_BUTTON)},i=function(a,b){a.attr("data-last-page-number",b)},j=function(a){return parseInt(a.attr("data-last-page-number"),10)},k=function(a){return parseInt(a.attr("data-active-page-number"),10)},l=function(a,b){a.attr("data-active-page-number",b)},m=function(a){var b=k(a);return!isNaN(b)&&0!=b},n=function(a,b){if(void 0!=b.attr("data-page"))return parseInt(b.attr("data-page-number"),10);var c=1,d=null;switch(b.attr("data-control")){case"first":c=1;break;case"last":c=j(a);break;case"next":d=k(a);var e=j(a);c=e?d&&d<e?d+1:e:d+1;break;case"previous":d=k(a),c=d&&d>1?d-1:1;break;default:c=1}return parseInt(c,10)},o=function(a){return parseInt(a.attr("data-items-per-page"),10)},p=function(a,b){a.attr("data-items-per-page",b)},q=function(a){a.removeClass("hidden")},r=function(a){a.addClass("hidden")},s=function(a){var b=a.find(f.NEXT_BUTTON),c=a.find(f.LAST_BUTTON);b.addClass("disabled"),b.attr("aria-disabled",!0),c.addClass("disabled"),c.attr("aria-disabled",!0)},t=function(a){var b=a.find(f.NEXT_BUTTON),c=a.find(f.LAST_BUTTON);b.removeClass("disabled"),b.removeAttr("aria-disabled"),c.removeClass("disabled"),c.removeAttr("aria-disabled")},u=function(a){var b=a.find(f.PREVIOUS_BUTTON),c=a.find(f.FIRST_BUTTON);b.addClass("disabled"),b.attr("aria-disabled",!0),c.addClass("disabled"),c.attr("aria-disabled",!0)},v=function(b){var c=k(b),d=j(b),e=b.find(f.DOTS_BUTTONS),g=b.find(f.BEGINNING_DOTS_BUTTON),h=b.find(f.ENDING_DOTS_BUTTON),i=b.find(f.PAGE),l=parseInt(b.attr("data-bar-size"),10);if(l&&d>l){var m=Math.max(c-Math.round(l/2),1),n=m+l-1;n>=d&&(n=d,m=n-l+1),m>1?(q(g),m++):r(g),n<d?(q(h),n--):r(h),e.addClass("disabled"),e.attr("aria-disabled",!0),r(i),i.each(function(b,c){c=a(c),b+1>=m&&b+1<=n&&q(c)})}else r(e)},w=function(a){var b=a.find(f.PREVIOUS_BUTTON),c=a.find(f.FIRST_BUTTON);b.removeClass("disabled"),b.removeAttr("aria-disabled"),c.removeClass("disabled"),c.removeAttr("aria-disabled")},x=function(a){var b=a.attr("data-aria-label-components-pagination-item"),c=b.split(",").map(function(a){return a.trim()});return c},y=function(a){var b=a.attr("data-aria-label-components-pagination-active-item"),c=b.split(",").map(function(a){return a.trim()});return c},z=function(b,c){var d=0;l(b,0),c.each(function(c,e){var f=c+1;e=a(e),e.attr("data-page-number",f),d++,e.hasClass("active")&&l(b,f)}),i(b,d)},A=function(b){var c=x(b),e=y(b),g=k(b),h=b.find(f.PAGE_ITEM),i=h.map(function(d,f){f=a(f);var h=n(b,f);return h===g?{key:e[0],component:e[1],param:h}:{key:c[0],component:c[1],param:h}});d.get_strings(i).then(function(b){return h.each(function(c,d){d=a(d);var e=b[c];d.attr("aria-label",e),d.find(f.PAGE_LINK).attr("aria-label",e)}),b})["catch"](function(){})},B=function(a,b,d){var h=j(a),i=b==k(a),m=o(a),n=(b-1)*m;if(!i){a.find(f.PAGE_ITEM).removeClass("active").removeAttr("aria-current");var p=g(a,b);p.addClass("active"),p.attr("aria-current",!0),l(a,b),v(a)}h&&b>=h?s(a):t(a),b>1?w(a):u(a),A(a),e.publish(d+c.SHOW_PAGES,[{pageNumber:b,limit:m,offset:n}])},C=function(d,g){var h=d.attr("data-ignore-control-while-loading"),k=!1;""==h&&(h=!0),b.define(d,[b.events.activate]),d.on(b.events.activate,f.PAGE_ITEM,function(b,c){if(c.originalEvent.preventDefault(),c.originalEvent.stopPropagation(),!h||!k){var e=a(b.target).closest(f.PAGE_ITEM);if(!e.hasClass("disabled")){var i=n(d,e);B(d,i,g),k=!0}}}),e.subscribe(g+c.ALL_ITEMS_LOADED,function(a){k=!1;var b=j(d);(!b||a<b)&&i(d,a),1===a&&d.attr("data-hide-control-on-single-page")?(r(d),s(d),u(d)):(q(d),s(d))}),e.subscribe(g+c.PAGES_SHOWN,function(){k=!1}),e.subscribe(g+c.SET_ITEMS_PER_PAGE_LIMIT,function(a){p(d,a),i(d,0),l(d,0),q(d),B(d,1,g)})},D=function(b,c){b=a(b);var d=b.find(f.PAGE);if(z(b,d),C(b,c),m(b)){var e=k(b);g(b,e).click(),1==e&&u(b)}else h(b).click();v(b)};return{init:D,showPage:B,rootSelector:f.ROOT}});
define('core/config', function(){return M.cfg});
define('core/chart_output_htmltable', ["jquery","core/chart_output_base"],function(a,b){function c(){b.prototype.constructor.apply(this,arguments),this._build()}return c.prototype=Object.create(b.prototype),c.prototype._build=function(){this._node.empty(),this._node.append(this._makeTable())},c.prototype._makeTable=function(){var b,c,d,e=a("<table>"),f=this._chart,g=f.getLabels(),h=g.length>0,i=f.getSeries(),j=i[0].getCount();e.addClass("chart-output-htmltable generaltable"),null!==f.getTitle()&&e.append(a("<caption>").text(f.getTitle())),b=a("<tr>"),h&&b.append(a("<td>")),i.forEach(function(c){b.append(a("<th>").text(c.getLabel()).attr("scope","col"))}),e.append(b);for(var k=0;k<j;k++){b=a("<tr>"),g.length>0&&b.append(a("<th>").text(g[k]).attr("scope","row"));for(var l=0;l<i.length;l++)c=i[l].getValues()[k],d=i[l].getLabels(),null!==d&&(c=i[l].getLabels()[k]),b.append(a("<td>").text(c));e.append(b)}return e},c.prototype.update=function(){this._build()},c});
define('core/paged_content', ["jquery","core/paged_content_pages","core/paged_content_paging_bar","core/paged_content_paging_bar_limit_selector","core/paged_content_paging_dropdown"],function(a,b,c,d,e){var f=function(f,g,h){f=a(f);var i=f.find(b.rootSelector),j=f.find(c.rootSelector),k=f.find(e.rootSelector),l=f.find(d.rootSelector),m=f.attr("id");h&&(m=h),b.init(i,m,g),j.length&&c.init(j,m),l.length&&d.init(l,m),k.length&&e.init(k,m)};return{init:f,rootSelector:'[data-region="paged-content-container"]'}});
!function(a,b){"use strict";"function"==typeof define&&define.amd?define('core/loglevel', b):"object"==typeof module&&module.exports?module.exports=b():a.log=b()}(this,function(){"use strict";function a(a,b){var c=a[b];if("function"==typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(d){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function b(b){return"debug"===b&&(b="log"),typeof console!==h&&(void 0!==console[b]?a(console,b):void 0!==console.log?a(console,"log"):g)}function c(a,b){for(var c=0;c<i.length;c++){var d=i[c];this[d]=c<a?g:this.methodFactory(d,a,b)}this.log=this.debug}function d(a,b,d){return function(){typeof console!==h&&(c.call(this,b,d),this[a].apply(this,arguments))}}function e(a,c,e){return b(a)||d.apply(this,arguments)}function f(a,b,d){function f(a){var b=(i[a]||"silent").toUpperCase();if(typeof window!==h){try{return void(window.localStorage[l]=b)}catch(c){}try{window.document.cookie=encodeURIComponent(l)+"="+b+";"}catch(c){}}}function g(){var a;if(typeof window!==h){try{a=window.localStorage[l]}catch(b){}if(typeof a===h)try{var c=window.document.cookie,d=c.indexOf(encodeURIComponent(l)+"=");d!==-1&&(a=/^([^;]+)/.exec(c.slice(d))[1])}catch(b){}return void 0===k.levels[a]&&(a=void 0),a}}var j,k=this,l="loglevel";a&&(l+=":"+a),k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.methodFactory=d||e,k.getLevel=function(){return j},k.setLevel=function(b,d){if("string"==typeof b&&void 0!==k.levels[b.toUpperCase()]&&(b=k.levels[b.toUpperCase()]),!("number"==typeof b&&b>=0&&b<=k.levels.SILENT))throw"log.setLevel() called with invalid level: "+b;if(j=b,d!==!1&&f(b),c.call(k,b,a),typeof console===h&&b<k.levels.SILENT)return"No console available for logging"},k.setDefaultLevel=function(a){g()||k.setLevel(a,!1)},k.enableAll=function(a){k.setLevel(k.levels.TRACE,a)},k.disableAll=function(a){k.setLevel(k.levels.SILENT,a)};var m=g();null==m&&(m=null==b?"WARN":b),k.setLevel(m,!1)}var g=function(){},h="undefined",i=["trace","debug","info","warn","error"],j=new f,k={};j.getLogger=function(a){if("string"!=typeof a||""===a)throw new TypeError("You must supply a name when creating a logger.");var b=k[a];return b||(b=k[a]=new f(a,j.getLevel(),j.methodFactory)),b};var l=typeof window!==h?window.log:void 0;return j.noConflict=function(){return typeof window!==h&&window.log===j&&(window.log=l),j},j});
define('core/storagewrapper', ["core/config"],function(a){var b=function(b){this.storage=b,this.supported=this.detectSupport(),this.hashSource=a.wwwroot+"/"+a.jsrev,this.hash=this.hashString(this.hashSource),this.prefix=this.hash+"/",this.jsrevPrefix=this.hashString(a.wwwroot)+"/jsrev",this.validateCache()};return b.prototype.detectSupport=function(){if(a.jsrev==-1)return!1;if("undefined"==typeof this.storage)return!1;var b="test";try{return null!==this.storage&&(this.storage.setItem(b,"1"),this.storage.removeItem(b),!0)}catch(c){return!1}},b.prototype.prefixKey=function(a){return this.prefix+a},b.prototype.validateCache=function(){var b=this.storage.getItem(this.jsrevPrefix);if(null===b)return void this.storage.setItem(this.jsrevPrefix,a.jsrev);var c=a.jsrev;c!=b&&(this.storage.clear(),this.storage.setItem(this.jsrevPrefix,a.jsrev))},b.prototype.hashString=function(a){var b,c,d,e=0;if(0===a.length)return e;for(b=0,d=a.length;b<d;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e},b.prototype.get=function(a){return!!this.supported&&(a=this.prefixKey(a),this.storage.getItem(a))},b.prototype.set=function(a,b){if(!this.supported)return!1;a=this.prefixKey(a);try{this.storage.setItem(a,b)}catch(c){return!1}return!0},b});
define('core/paged_content_paging_dropdown', ["jquery","core/custom_interaction_events","core/paged_content_events","core/pubsub"],function(a,b,c,d){var e={ROOT:'[data-region="paging-dropdown-container"]',DROPDOWN_ITEM:'[data-region="dropdown-item"]',DROPDOWN_TOGGLE:'[data-region="dropdown-toggle"]',ACTIVE_DROPDOWN_ITEM:'[data-region="dropdown-item"].active',CARET:'[data-region="caret"]'},f=function(a){return parseInt(a.attr("data-page-number"),10)},g=function(a){return a.find(e.DROPDOWN_ITEM)},h=function(b,c){var d=f(c);return g(b).filter(function(b,c){return f(a(c))<d})},i=function(a){return parseInt(a.attr("data-item-count"),10)},j=function(b,c){if(void 0!=c.attr("data-offset"))return parseInt(c.attr("data-offset"),10);var d=0;return h(b,c).each(function(b,c){c=a(c),d+=i(c)}),c.attr("data-offset",d),d},k=function(a){return a.find(e.ACTIVE_DROPDOWN_ITEM)},l=function(b,c){return c.map(function(c,d){return d=a(d),{pageNumber:f(d),limit:i(d),offset:j(b,d)}}).get()},m=function(b){b.each(function(b,c){c=a(c),c.attr("data-page-number",b+1)})},n=function(a,b,f){var g=h(a,b),i=g.add(b),j=l(a,i),m=a.find(e.DROPDOWN_TOGGLE),n=m.find(e.CARET);k(a).removeClass("active"),b.addClass("active"),m.html(b.text()),m.append(n),d.publish(f+c.SHOW_PAGES,j)},o=function(c,d){c=a(c);var f=g(c);m(f);var h=k(c);h.length&&n(c,h,d),b.define(c,[b.events.activate]),c.on(b.events.activate,e.DROPDOWN_ITEM,function(b,f){var g=a(b.target).closest(e.DROPDOWN_ITEM);n(c,g,d),f.originalEvent.preventDefault()})};return{init:o,rootSelector:e.ROOT}});
define('core/search-input', ["jquery"],function(a){var b=null,c=function(a){b.hasClass("expanded")?e():d(a)},d=function(c){var d=a(document).width();if("keydown"!==c.type||13===c.keyCode||32===c.keyCode)return d<=767&&("click"===c.type||"keydown"===c.type)?void f():void(d<=767||("keydown"===c.type&&c.preventDefault(),b.addClass("expanded"),b.find("form").addClass("expanded"),b.find("input").focus()))},e=function(){b.removeClass("expanded"),b.find("form").removeClass("expanded")},f=function(){b.find("form").submit()};return{init:function(d){b=a("#"+d),b.on("click mouseover keydown","div",c)}}});
define('core/page_global', ["jquery","core/custom_interaction_events","core/str"],function(a,b,c){var d=function(){var d=a("body");b.define(d,[b.events.activate]),d.on(b.events.activate,"[data-show-active-item]",function(b){var d=a(b.target).closest(".dropdown-item"),e=d.closest("[data-show-active-item]");if(d.hasClass("dropdown-item")&&!d.hasClass("active")){var f=e.find(".dropdown-item");f.removeClass("active"),f.removeAttr("aria-current"),e.attr("data-skip-active-class")||d.addClass("active"),d.attr("aria-current",!0);var g=d.text(),h=e.parent().find('[data-toggle="dropdown"]'),i=h.find("[data-active-item-text]");i.length?i.html(g):h.html(g);var j=e.attr("data-active-item-button-aria-label-components");if(j){var k=j.split(",");k.push(g),c.get_string(k[0].trim(),k[1].trim(),k[2].trim()).then(function(a){return h.attr("aria-label",a),a})["catch"](function(){return!1})}}})},e=function(){d()};return{init:e}});
define('core/form-cohort-selector', ["core/ajax","jquery"],function(a,b){return{processResults:function(a,c){var d=[],e=0,f=String(b(a).data("exclude")).split(",");for(e=0;e<c.cohorts.length;e++)f.indexOf(String(c.cohorts[e].id))===-1&&d.push({value:c.cohorts[e].id,label:c.cohorts[e].name});return d},transport:function(c,d,e,f){var g=b(c),h=null;"undefined"==typeof d&&(d="");var i=g.data("contextid"),j={query:d,includes:"parents",limitfrom:0,limitnum:100,context:{contextid:i}},k=[{methodname:"core_cohort_search_cohorts",args:j}];h=a.call(k),b.when.apply(b.when,h).done(function(a){e(a)}).fail(f)}}});
define('core/sessionstorage', ["core/config","core/storagewrapper"],function(a,b){var c=new b(window.sessionStorage);return{get:function(a){return c.get(a)},set:function(a,b){return c.set(a,b)}}});
define('core/chart_pie', ["core/chart_base"],function(a){function b(){a.prototype.constructor.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.TYPE="pie",b.prototype._doughnut=null,b.prototype.create=function(b,c){var d=a.prototype.create.apply(this,arguments);return d.setDoughnut(c.doughnut),d},b.prototype.addSeries=function(b){if(null===b.getColor()){for(var c=[],d=this.getConfigColorSet()||a.prototype.COLORSET,e=0;e<b.getCount();e++)c.push(d[e%d.length]);b.setColors(c)}return a.prototype.addSeries.apply(this,arguments)},b.prototype.getDoughnut=function(){return this._doughnut},b.prototype.setDoughnut=function(a){this._doughnut=Boolean(a)},b.prototype._validateSeries=function(){if(this._series.length>=1)throw new Error("Pie charts only support one serie.");return a.prototype._validateSeries.apply(this,arguments)},b});
define('core/chart_base', ["core/chart_series","core/chart_axis"],function(a,b){function c(){this._series=[],this._labels=[],this._xaxes=[],this._yaxes=[],this._setDefaults()}return c.prototype._series=null,c.prototype._labels=null,c.prototype._title=null,c.prototype._xaxes=null,c.prototype._yaxes=null,c.prototype.COLORSET=["#f3c300","#875692","#f38400","#a1caf1","#be0032","#c2b280","#7f180d","#008856","#e68fac","#0067a5"],c.prototype._configColorSet=null,c.prototype.TYPE=null,c.prototype.addSeries=function(a){if(this._validateSeries(a),this._series.push(a),null===a.getColor()){var b=this.getConfigColorSet()||c.prototype.COLORSET;a.setColor(b[this._series.length%b.length])}},c.prototype.create=function(c,d){var e=new c;return e.setConfigColorSet(d.config_colorset),e.setLabels(d.labels),e.setTitle(d.title),d.series.forEach(function(b){e.addSeries(a.prototype.create(b))}),d.axes.x.forEach(function(a,c){e.setXAxis(b.prototype.create(a),c)}),d.axes.y.forEach(function(a,c){e.setYAxis(b.prototype.create(a),c)}),e},c.prototype.__getAxis=function(a,c,d){var e,f="x"===a?this._xaxes:this._yaxes,g=("x"===a?this.setXAxis:this.setYAxis).bind(this);if(c="undefined"==typeof c?0:c,d="undefined"!=typeof d&&d,e=f[c],"undefined"==typeof e){if(!d)throw new Error("Unknown axis.");e=new b,g(e,c)}return e},c.prototype.getConfigColorSet=function(){return this._configColorSet},c.prototype.getLabels=function(){return this._labels},c.prototype.getSeries=function(){return this._series},c.prototype.getTitle=function(){return this._title},c.prototype.getType=function(){if(!this.TYPE)throw new Error("The TYPE property has not been set.");return this.TYPE},c.prototype.getXAxes=function(){return this._xaxes},c.prototype.getXAxis=function(a,b){return this.__getAxis("x",a,b)},c.prototype.getYAxes=function(){return this._yaxes},c.prototype.getYAxis=function(a,b){return this.__getAxis("y",a,b)},c.prototype.setConfigColorSet=function(a){this._configColorSet=a},c.prototype._setDefaults=function(){},c.prototype.setLabels=function(a){if(a.length&&this._series.length&&this._series[0].length!=a.length)throw new Error("Series must match label values.");this._labels=a},c.prototype.setTitle=function(a){this._title=a},c.prototype.setXAxis=function(a,b){b="undefined"==typeof b?0:b,this._validateAxis("x",a,b),this._xaxes[b]=a},c.prototype.setYAxis=function(a,b){b="undefined"==typeof b?0:b,this._validateAxis("y",a,b),this._yaxes[b]=a},c.prototype._validateAxis=function(a,b,c){if(c="undefined"==typeof c?0:c,c>0){var d="x"==a?this._xaxes:this._yaxes;if("undefined"==typeof d[c-1])throw new Error("Missing "+a+" axis at index lower than "+c)}},c.prototype._validateSeries=function(a){if(this._series.length&&this._series[0].getCount()!=a.getCount())throw new Error("Series do not have an equal number of values.");if(this._labels.length&&this._labels.length!=a.getCount())throw new Error("Series must match label values.")},c});
define('core/chart_bar', ["core/chart_base"],function(a){function b(){a.prototype.constructor.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype._horizontal=!1,b.prototype._stacked=!1,b.prototype.TYPE="bar",b.prototype.create=function(b,c){var d=a.prototype.create.apply(this,arguments);return d.setHorizontal(c.horizontal),d.setStacked(c.stacked),d},b.prototype._setDefaults=function(){a.prototype._setDefaults.apply(this,arguments);var b=this.getYAxis(0,!0);b.setMin(0)},b.prototype.getHorizontal=function(){return this._horizontal},b.prototype.getStacked=function(){return this._stacked},b.prototype.setHorizontal=function(a){var b=this.getXAxis(0,!0);null===b.getMin()&&b.setMin(0),this._horizontal=Boolean(a)},b.prototype.setStacked=function(a){this._stacked=Boolean(a)},b});
define('core/paged_content_factory', ["jquery","core/templates","core/notification","core/paged_content","core/paged_content_events","core/pubsub","core/ajax"],function(a,b,c,d,e,f,g){var h={PAGED_CONTENT:"core/paged_content"},i={ITEMS_PER_PAGE_SINGLE:25,ITEMS_PER_PAGE_ARRAY:[25,50,100,0],MAX_PAGES:3},j=function(){return{pagingbar:!1,pagingdropdown:!1,skipjs:!0,ignorecontrolwhileloading:!0,controlplacementbottom:!1}},k=function(){return{showitemsperpageselector:!1,itemsperpage:35,previous:!0,next:!0,activepagenumber:1,hidecontrolonsinglepage:!0,pages:[]}},l=function(a,b){var c=1;if(a>0){var d=a%b;d?(a-=d,c=a/b+1):c=a/b}return c},m=function(b,c){null===c&&(c=i.ITEMS_PER_PAGE_SINGLE),a.isArray(c)&&(c=c[0]);var d=k();d.itemsperpage=c;for(var e=l(b,c),f=1;f<=e;f++){var g={number:f,page:""+f};1===f&&(g.active=!0),d.pages.push(g)}return d.barsize=10,d},n=function(b){if(a.isArray(b)){var c=b.map(function(a){return"number"==typeof a?{value:a,active:!1}:a}),d=c.filter(function(a){return a.active});return d.length||(c[0].active=!0),c}return b},o=function(b){null===b&&(b=i.ITEMS_PER_PAGE_ARRAY);var c=k();return c.itemsperpage=n(b),c.showitemsperpageselector=a.isArray(b),c},p=function(a,b){return a?m(a,b):o(b)},q=function(b,c){if(null===b&&(b=i.ITEMS_PER_PAGE_SINGLE),a.isArray(b))return{options:b};var d={options:[]},e=0,f=0,g=i.MAX_PAGES;c.hasOwnProperty("maxPages")&&(g=c.maxPages);for(var h=1;h<=g;h++){var j=0;h<=2?(j=b,f=b):(f=2*f,j=f),e+=j;var k={itemcount:j,content:e};1===h&&(k.active=!0),d.options.push(k)}return d},r=function(a,b,c){var d=j();return c.hasOwnProperty("ignoreControlWhileLoading")&&(d.ignorecontrolwhileloading=c.ignoreControlWhileLoading),c.hasOwnProperty("controlPlacementBottom")&&(d.controlplacementbottom=c.controlPlacementBottom),c.hasOwnProperty("hideControlOnSinglePage")&&(d.hidecontrolonsinglepage=c.hideControlOnSinglePage),c.hasOwnProperty("ariaLabels")&&(d.arialabels=c.ariaLabels),c.hasOwnProperty("dropdown")&&c.dropdown?d.pagingdropdown=q(b,c):d.pagingbar=p(a,b),d},s=function(a,b){return u(null,null,a,b)},t=function(a,b,c){return u(null,a,b,c)},u=function(e,f,g,i){i=i||{};var j=a.Deferred(),k=r(e,f,i);return b.render(h.PAGED_CONTENT,k).then(function(b,c){b=a(b);var e=b.attr("id");i.hasOwnProperty("eventNamespace")&&(e=i.eventNamespace);var f=b;d.init(f,g,e),y(e,i),j.resolve(b,c)}).fail(function(a){j.reject(a)}).fail(c.exception),j.promise()},v=function(a,b,c,d){"undefined"==typeof d&&(d={});var e=a.length;return u(e,b,function(b){var d=[];return b.forEach(function(b){var c=b.offset,f=b.limit?c+b.limit:e,g=a.slice(c,f);d.push(g)}),c(d)},d)},w=function(a,b){f.publish(a+e.ALL_ITEMS_LOADED,b)},x=function(a){var b=function(b){var c={preferences:[{type:a,value:b}]},d={methodname:"core_user_update_user_preferences",args:c};g.call([d])};return b},y=function(a,b){b.hasOwnProperty("persistentLimitKey")&&f.subscribe(a+e.SET_ITEMS_PER_PAGE_LIMIT,x(b.persistentLimitKey))};return{create:s,createWithLimit:t,createWithTotalAndLimit:u,createFromStaticList:v,createFromAjax:u,resetLastPageNumber:w}});
define('core/chart_output_base', ["jquery"],function(a){function b(b,c){this._node=a(b),this._chart=c}return b.prototype.update=function(){throw new Error("Not supported.")},b});
define('core/yui', function(){return Y});
define('core/chart_output', ["core/chart_output_chartjs"],function(a){var b=a;return b});
define('core/key_codes', function(){return{tab:9,enter:13,shift:16,ctrl:17,alt:18,escape:27,space:32,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,8:56,asterix:106,pageUp:33,pageDown:34}});
define('core/permissionmanager', ["jquery","core/config","core/notification","core/templates","core/yui"],function(a,b,c,d,e){var f,g,h,i,j={ADDROLE:"a.allowlink, a.prohibitlink",REMOVEROLE:"a.preventlink, a.unprohibitlink",UNPROHIBIT:"a.unprohibitlink"},k=a.Event("rolesloaded"),l=null,m=function(){var d={contextid:f,getroles:1,sesskey:b.sesskey};a.post(h+"roles/ajax.php",d,null,"json").done(function(b){try{i=b,m=function(){a("body").trigger(k)},m()}catch(d){c.exception(d)}}).fail(function(a,b,d){c.exception(d)})},n=function(b,e,g){var j={contextid:f,roleid:e,sesskey:M.cfg.sesskey,action:g,capability:b.data("name")};a.post(h+"roles/ajax.php",j,null,"json").done(function(f){var g=f;try{var j={rolename:i[e],roleid:e,adminurl:h,imageurl:M.util.image_url("t/delete","moodle")};switch(g){case"allow":j.spanclass="allowed",j.linkclass="preventlink",j.action="prevent",j.icon="t/delete",j.iconalt=M.util.get_string("deletexrole","core_role",i[e]);break;case"prohibit":j.spanclass="forbidden",j.linkclass="unprohibitlink",j.action="unprohibit",j.icon="t/delete",j.iconalt=M.util.get_string("deletexrole","core_role",i[e]);break;case"prevent":return void b.find('a[data-role-id="'+e+'"]').first().closest(".allowed").remove();case"unprohibit":return void b.find('a[data-role-id="'+e+'"]').first().closest(".forbidden").remove();default:return}d.render("core/permissionmanager_role",j).done(function(c){if("allow"==g)a(c).insertBefore(b.find(".allowmore:first"));else if("prohibit"==g){a(c).insertBefore(b.find(".prohibitmore:first"));var d=b.find(".allowedroles").first().find('a[data-role-id="'+e+'"]');d&&d.first().closest(".allowed").remove()}l.hide()}).fail(c.exception)}catch(k){c.exception(k)}}).fail(function(a,b,d){c.exception(d)})},o=function(b){b.preventDefault();var f=a(b.currentTarget);a("body").one("rolesloaded",function(){e.use("moodle-core-notification-dialogue",function(){var b=f.data("action"),e=f.closest("tr.rolecap"),h={cap:e.data("humanname"),context:g},k=M.util.get_string("role"+b+"info","core_role",h);null===l&&(l=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,width:"450px"})),l.set("headerContent",M.util.get_string("role"+b+"header","core_role"));var m,o,p=[];switch(b){case"allow":o=e.find(j.REMOVEROLE);break;case"prohibit":o=e.find(j.UNPROHIBIT)}for(m in i){var q="",r=o.filter("[data-role-id='"+m+"']").length;r&&(q="disabled");var s={roleid:m,rolename:i[m],disabled:q};p.push(s)}d.render("core/permissionmanager_panelcontent",{message:k,roles:p}).done(function(c){l.set("bodyContent",c),l.show(),a("div.role_buttons").on("click","input",function(c){var d=a(c.currentTarget).data("role-id");n(e,d,b)})}).fail(c.exception)})}),m()},p=function(b){b.preventDefault();var d=a(b.currentTarget);a("body").one("rolesloaded",function(){var a=d.data("action"),b=d.data("role-id"),e=d.closest("tr.rolecap"),f={role:i[b],cap:e.data("humanname"),context:g};c.confirm(M.util.get_string("confirmunassigntitle","core_role"),M.util.get_string("confirmrole"+a,"core_role",f),M.util.get_string("confirmunassignyes","core_role"),M.util.get_string("confirmunassignno","core_role"),function(){n(e,b,a)})}),m()};return{initialize:function(b){f=b.contextid,g=b.contextname,h=b.adminurl;var c=a("body");c.on("click",j.ADDROLE,o),c.on("click",j.REMOVEROLE,p)}}});
define('core/inplace_editable', ["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url","core/form-autocomplete","core/pending"],function(a,b,c,d,e,f,g,h,i){return a("body").on("click keypress","[data-inplaceeditable] [data-inplaceeditablelink]",function(j){if("keypress"!==j.type||13===j.keyCode){var k=new i("autocomplete-start-editing");j.stopImmediatePropagation(),j.preventDefault();var l=a(this),m=l.closest("[data-inplaceeditable]"),n=function(b){b.addClass("updating");var c=b.find("img.spinner");c.length?c.show():(c=a("<img/>").attr("src",g.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon"),b.append(c))},o=function(a){a.removeClass("updating"),a.find("img.spinner").hide()},p=function(e,f){var g=[e.attr("data-itemid"),e.attr("data-component"),e.attr("data-itemtype")].join("-"),h=new i(g);n(e),b.call([{methodname:"core_update_inplace_editable",args:{itemid:e.attr("data-itemid"),component:e.attr("data-component"),itemtype:e.attr("data-itemtype"),value:f}}])[0].then(function(b){return c.render("core/inplace_editable",b).then(function(d,f){var g=e.attr("data-value"),h=a(d);c.replaceNode(e,h,f),h.find("[data-inplaceeditablelink]").focus(),h.trigger({type:"updated",ajaxreturn:b,oldvalue:g})})}).then(function(){return h.resolve()}).fail(function(b){var c=a.Event("updatefailed",{exception:b,newvalue:f});o(e),M.util.js_complete(g),e.trigger(c),c.isDefaultPrevented()||d.exception(b)})},q=function(a){a.find("input").off(),a.find("select").off(),a.html(a.attr("data-oldcontent")),a.removeAttr("data-oldcontent"),a.removeClass("inplaceeditingon"),a.find("[data-inplaceeditablelink]").focus()},r=function(){a("span.inplaceeditable.inplaceeditingon").each(function(){q(a(this))})},s=function(b,c){var d,e=b;for(d=0;d<c;d++)e+=String(Math.floor(10*Math.random()));return 0===a("#"+e).length?e:s(b,c)},t=function(b){e.get_string("edittitleinstructions").done(function(c){var d=a('<span class="editinstructions">'+c+"</span>").attr("id",s("id_editinstructions_",20)),e=a('<input type="text"/>').attr("id",s("id_inplacevalue_",20)).attr("value",b.attr("data-value")).attr("aria-describedby",d.attr("id")).addClass("ignoredirty").addClass("form-control"),g=a('<label class="accesshide">'+m.attr("data-editlabel")+"</label>").attr("for",e.attr("id"));b.html("").append(d).append(g).append(e),e.focus(),e.select(),e.on("keyup keypress focusout",function(a){if(!f.behatsiterunning||"focusout"!==a.type){if("keypress"===a.type&&13===a.keyCode){var c=e.val();q(b),p(b,c)}("keyup"===a.type&&27===a.keyCode||"focusout"===a.type)&&q(b)}})})},u=function(a,b){q(a),p(a,b)},v=function(b,c){var d,e=a("<select></select>").attr("id",s("id_inplacevalue_",20)).addClass("custom-select"),g=a('<label class="accesshide">'+m.attr("data-editlabel")+"</label>").attr("for",e.attr("id"));for(d in c)e.append(a("<option>").attr("value",c[d].key).html(c[d].value));e.val(b.attr("data-value")),b.html("").append(g).append(e),e.focus(),e.select(),e.on("keyup change focusout",function(a){if(!f.behatsiterunning||"focusout"!==a.type){if("change"===a.type){var c=e.val();q(b),p(b,c)}("keyup"===a.type&&27===a.keyCode||"focusout"===a.type)&&q(b)}})},w=function(b,f){var g,i=a("<select></select>").attr("id",s("id_inplacevalue_",20)).addClass("form-autocomplete-original-select").addClass("custom-select"),j=a('<label class="accesshide">'+m.attr("data-editlabel")+"</label>").attr("for",i.attr("id")),k=f.options,l=f.attributes,n=a('<a href="#"></a>'),o=a('<a href="#"></a>');for(g in k)i.append(a("<option>").attr("value",k[g].key).html(k[g].value));l.multiple&&i.attr("multiple","true"),i.val(JSON.parse(b.attr("data-value"))),e.get_string("savechanges","core").then(function(a){return c.renderPix("e/save","core",a)}).then(function(a){n.append(a)}).fail(d.exception),e.get_string("cancel","core").then(function(a){return c.renderPix("e/cancel","core",a)}).then(function(a){o.append(a)}).fail(d.exception),b.html("").append(j).append(i).append(n).append(o),i.focus(),i.select(),h.enhance(i,l.tags,l.ajax,l.placeholder,l.caseSensitive,l.showSuggestions,l.noSelectionString).then(function(){b.find("[role=combobox]").focus()}).fail(d.exception),i.on("keyup",function(a){("keyup"===a.type&&27===a.keyCode||"focusout"===a.type)&&q(b)}),n.on("click",function(a){var c=JSON.stringify(i.val());i.empty(),q(b),p(b,c),a.preventDefault()}),o.on("click",function(a){i.empty(),q(b),a.preventDefault()})},x=function(b){b.addClass("inplaceeditingon"),b.attr("data-oldcontent",b.html());var c=b.attr("data-type"),d=b.attr("data-options");"toggle"===c?u(b,d):"select"===c?v(b,a.parseJSON(d)):"autocomplete"===c?w(b,a.parseJSON(d)):t(b)};r(),x(m),k.resolve()}}),{}});
define('core/modal_events', [],function(){return{shown:"modal:shown",hidden:"modal:hidden",destroyed:"modal:destroyed",bodyRendered:"modal:bodyRendered",save:"modal-save-cancel:save",cancel:"modal-save-cancel:cancel",yes:"modal-save-cancel:save",no:"modal-save-cancel:cancel"}});
define('core/chart_series', [],function(){function a(a,b){if("string"!=typeof a)throw new Error("Invalid label for series.");if("object"!=typeof b)throw new Error("Values for a series must be an array.");if(b.length<1)throw new Error("Invalid values received for series.");this._colors=[],this._label=a,this._values=b}return a.prototype.TYPE_DEFAULT=null,a.prototype.TYPE_LINE="line",a.prototype._colors=null,a.prototype._label=null,a.prototype._labels=null,a.prototype._smooth=!1,a.prototype._type=a.prototype.TYPE_DEFAULT,a.prototype._values=null,a.prototype._xaxis=null,a.prototype._yaxis=null,a.prototype.create=function(b){var c=new a(b.label,b.values);return c.setType(b.type),c.setXAxis(b.axes.x),c.setYAxis(b.axes.y),c.setLabels(b.labels),b.colors&&b.colors.length>1?c.setColors(b.colors):c.setColor(b.colors[0]),c.setSmooth(b.smooth),c},a.prototype.getColor=function(){return this._colors[0]||null},a.prototype.getColors=function(){return this._colors},a.prototype.getCount=function(){return this._values.length},a.prototype.getLabel=function(){return this._label},a.prototype.getLabels=function(){return this._labels},a.prototype.getSmooth=function(){return this._smooth},a.prototype.getType=function(){return this._type},a.prototype.getValues=function(){return this._values},a.prototype.getXAxis=function(){return this._xaxis},a.prototype.getYAxis=function(){return this._yaxis},a.prototype.hasColoredValues=function(){return this._colors.length==this.getCount()},a.prototype.setColor=function(a){this._colors=[a]},a.prototype.setColors=function(a){if(a&&a.length!=this.getCount())throw new Error("When setting multiple colors there must be one per value.");this._colors=a||[]},a.prototype.setLabels=function(a){this._validateLabels(a),a="undefined"==typeof a?null:a,this._labels=a},a.prototype.setSmooth=function(a){a="undefined"==typeof a?null:a,this._smooth=a},a.prototype.setType=function(a){if(a!=this.TYPE_DEFAULT&&a!=this.TYPE_LINE)throw new Error("Invalid serie type.");this._type=a||null},a.prototype.setXAxis=function(a){this._xaxis=a||null},a.prototype.setYAxis=function(a){this._yaxis=a||null},a.prototype._validateLabels=function(a){if(a&&a.length>0&&a.length!=this.getCount())throw new Error("Series labels must match series values.")},a});
define('core/popover_region_controller', ["jquery","core/str","core/custom_interaction_events"],function(a,b,c){var d={CONTENT:".popover-region-content",CONTENT_CONTAINER:".popover-region-content-container",MENU_CONTAINER:".popover-region-container",MENU_TOGGLE:".popover-region-toggle",CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]'},e=function(b){this.root=a(b),this.content=this.root.find(d.CONTENT),this.contentContainer=this.root.find(d.CONTENT_CONTAINER),this.menuContainer=this.root.find(d.MENU_CONTAINER),this.menuToggle=this.root.find(d.MENU_TOGGLE),this.isLoading=!1,this.promises={closeHandlers:a.Deferred(),navigationHandlers:a.Deferred()},this.registerBaseEventListeners()};return e.prototype.events=function(){return{menuOpened:"popoverregion:menuopened",menuClosed:"popoverregion:menuclosed",startLoading:"popoverregion:startLoading",stopLoading:"popoverregion:stopLoading"}},e.prototype.getContentContainer=function(){return this.contentContainer},e.prototype.getContent=function(){return this.content},e.prototype.isMenuOpen=function(){return!this.root.hasClass("collapsed")},e.prototype.toggleMenu=function(){this.isMenuOpen()?this.closeMenu():this.openMenu()},e.prototype.closeMenu=function(){this.isMenuOpen()&&(this.root.addClass("collapsed"),this.menuContainer.attr("aria-expanded","false"),this.menuContainer.attr("aria-hidden","true"),this.updateButtonAriaLabel(),this.root.trigger(this.events().menuClosed))},e.prototype.openMenu=function(){this.isMenuOpen()||(this.root.removeClass("collapsed"),this.menuContainer.attr("aria-expanded","true"),this.menuContainer.attr("aria-hidden","false"),this.updateButtonAriaLabel(),this.promises.closeHandlers.resolve(),this.promises.navigationHandlers.resolve(),this.root.trigger(this.events().menuOpened))},e.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?b.get_string("hidepopoverwindow").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):b.get_string("showpopoverwindow").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this))},e.prototype.startLoading=function(){this.isLoading=!0,this.getContentContainer().addClass("loading"),this.getContentContainer().attr("aria-busy","true"),this.root.trigger(this.events().startLoading)},e.prototype.stopLoading=function(){this.isLoading=!1,this.getContentContainer().removeClass("loading"),this.getContentContainer().attr("aria-busy","false"),this.root.trigger(this.events().stopLoading)},e.prototype.focusMenuToggle=function(){this.menuToggle.focus()},e.prototype.contentItemHasFocus=function(){return this.getContentItemWithFocus().length>0},e.prototype.getContentItemWithFocus=function(){var b=a(document.activeElement),c=this.getContent().children(),d=c.filter(b);return d.length||(d=c.has(b)),d},e.prototype.focusContentItem=function(a){a.is(d.CAN_RECEIVE_FOCUS)?a.focus():a.find(d.CAN_RECEIVE_FOCUS).first().focus()},e.prototype.focusFirstContentItem=function(){this.focusContentItem(this.getContent().children().first())},e.prototype.focusLastContentItem=function(){this.focusContentItem(this.getContent().children().last())},e.prototype.focusNextContentItem=function(){var a=this.getContentItemWithFocus();a.length&&a.next()&&this.focusContentItem(a.next())},e.prototype.focusPreviousContentItem=function(){var a=this.getContentItemWithFocus();a.length&&a.prev()&&this.focusContentItem(a.prev())},e.prototype.registerBaseEventListeners=function(){c.define(this.root,[c.events.activate,c.events.escape]),this.root.on(c.events.activate,d.MENU_TOGGLE,function(){this.toggleMenu()}.bind(this)),this.promises.closeHandlers.done(function(){this.root.on(c.events.escape,function(){this.closeMenu(),this.focusMenuToggle()}.bind(this)),a("html").click(function(b){var c=a(b.target);this.root.is(c)||this.root.has(c).length||this.closeMenu()}.bind(this)),c.define(this.getContentContainer(),[c.events.scrollBottom])}.bind(this))},e.prototype.registerListNavigationEventListeners=function(){c.define(this.root,[c.events.down]),this.root.on(c.events.down,function(a,b){this.isMenuOpen()?this.contentItemHasFocus()?this.focusNextContentItem():this.focusFirstContentItem():(this.openMenu(),this.focusFirstContentItem()),b.originalEvent.preventDefault()}.bind(this)),this.promises.navigationHandlers.done(function(){c.define(this.root,[c.events.up,c.events.home,c.events.end]),this.root.on(c.events.up,function(a,b){this.focusPreviousContentItem(),b.originalEvent.preventDefault()}.bind(this)),this.root.on(c.events.home,function(a,b){this.focusFirstContentItem(),b.originalEvent.preventDefault()}.bind(this)),this.root.on(c.events.end,function(a,b){this.focusLastContentItem(),b.originalEvent.preventDefault()}.bind(this))}.bind(this))},e});
define('core/paged_content_events', [],function(){return{SHOW_PAGES:"core-paged-content-show-pages",PAGES_SHOWN:"core-paged-content-pages-shown",ALL_ITEMS_LOADED:"core-paged-content-all-items-loaded",SET_ITEMS_PER_PAGE_LIMIT:"core-paged-content-set-items-per-page-limit"}});
define('core/chart_output_chartjs', ["jquery","core/chartjs","core/chart_axis","core/chart_bar","core/chart_output_base","core/chart_line","core/chart_pie","core/chart_series"],function(a,b,c,d,e,f,g,h){function i(){e.prototype.constructor.apply(this,arguments),this._canvas=this._node,"CANVAS"!=this._canvas.prop("tagName")&&(this._canvas=a("<canvas>"),this._node.append(this._canvas)),this._build()}var j=function(a,b){return"axis-"+a+"-"+b};return i.prototype=Object.create(e.prototype),i.prototype._config=null,i.prototype._chartjs=null,i.prototype._canvas=null,i.prototype._build=function(){this._config=this._makeConfig(),this._chartjs=new b(this._canvas[0],this._config)},i.prototype._cleanData=function(b){return b instanceof Array?b.map(function(b){return a("<span>").html(b).text()}):a("<span>").html(b).text()},i.prototype._getChartType=function(){var a=this._chart.getType();return this._chart.getType()===d.prototype.TYPE&&this._chart.getHorizontal()===!0?a="horizontalBar":this._chart.getType()===g.prototype.TYPE&&this._chart.getDoughnut()===!0&&(a="doughnut"),a},i.prototype._makeAxisConfig=function(a,b,d){var e={id:j(b,d)};return a.getPosition()!==c.prototype.POS_DEFAULT&&(e.position=a.getPosition()),null!==a.getLabel()&&(e.scaleLabel={display:!0,labelString:this._cleanData(a.getLabel())}),null!==a.getStepSize()&&(e.ticks=e.ticks||{},e.ticks.stepSize=a.getStepSize()),null!==a.getMax()&&(e.ticks=e.ticks||{},e.ticks.max=a.getMax()),null!==a.getMin()&&(e.ticks=e.ticks||{},e.ticks.min=a.getMin()),e},i.prototype._makeConfig=function(){var a={type:this._getChartType(),data:{labels:this._cleanData(this._chart.getLabels()),datasets:this._makeDatasetsConfig()},options:{title:{display:null!==this._chart.getTitle(),text:this._cleanData(this._chart.getTitle())}}};return this._chart.getXAxes().forEach(function(b,c){var d=b.getLabels();a.options.scales=a.options.scales||{},a.options.scales.xAxes=a.options.scales.xAxes||[],a.options.scales.xAxes[c]=this._makeAxisConfig(b,"x",c),null!==d&&(a.options.scales.xAxes[c].ticks.callback=function(a,b){return d[b]||""}),a.options.scales.xAxes[c].stacked=this._isStacked()}.bind(this)),this._chart.getYAxes().forEach(function(b,c){var d=b.getLabels();a.options.scales=a.options.scales||{},a.options.scales.yAxes=a.options.scales.yAxes||[],a.options.scales.yAxes[c]=this._makeAxisConfig(b,"y",c),null!==d&&(a.options.scales.yAxes[c].ticks.callback=function(a){return d[parseInt(a,10)]||""}),a.options.scales.yAxes[c].stacked=this._isStacked()}.bind(this)),a.options.tooltips={callbacks:{label:this._makeTooltip.bind(this)}},a},i.prototype._makeDatasetsConfig=function(){var a=this._chart.getSeries().map(function(a){var b=a.hasColoredValues()?a.getColors():a.getColor(),c={label:this._cleanData(a.getLabel()),data:a.getValues(),type:a.getType(),fill:!1,backgroundColor:b,borderColor:this._chart.getType()==g.prototype.TYPE?"#fff":b,lineTension:this._isSmooth(a)?.3:0};return null!==a.getXAxis()&&(c.xAxisID=j("x",a.getXAxis())),null!==a.getYAxis()&&(c.yAxisID=j("y",a.getYAxis())),c}.bind(this));return a},i.prototype._makeTooltip=function(a,b){var c=this._chart.getSeries()[a.datasetIndex],d=c.getLabel(),e=c.getLabels(),f=b.datasets[a.datasetIndex].data,g=f[a.index],h=[];if(""==a.xLabel&&""==a.yLabel){var i=this._cleanData(this._chart.getLabels());h.push(i[a.index])}return null!==e?h.push(this._cleanData(e[a.index])):h.push(this._cleanData(d)+": "+g),h},i.prototype._isSmooth=function(a){var b=!1;return this._chart.getType()===f.prototype.TYPE?(b=a.getSmooth(),null===b&&(b=this._chart.getSmooth())):a.getType()===h.prototype.TYPE_LINE&&(b=a.getSmooth()),b},i.prototype._isStacked=function(){var a=!1;return this._chart.getType()===d.prototype.TYPE&&(a=this._chart.getStacked()),a},i.prototype.update=function(){a.extend(!0,this._config,this._makeConfig()),this._chartjs.update()},i});
define('core/pending', ["jquery"],function(a){var b=function(b){var c=a.Deferred();return b=b||{},M.util.js_pending(b),c.then(function(){return M.util.js_complete(b)})["catch"](),c};return b.prototype.constructor=b,b});
define('core/form-course-selector', ["core/ajax","jquery"],function(a,b){return{processResults:function(a,c){var d=[],e=0,f=String(b(a).data("exclude")).split(",");for(e=0;e<c.courses.length;e++)f.indexOf(String(c.courses[e].id))===-1&&d.push({value:c.courses[e].id,label:c.courses[e].displayname});return d},transport:function(c,d,e,f){var g=b(c),h=g.data("requiredcapabilities");h=""!==h.trim()?h.split(","):[];var i=g.data("limittoenrolled"),j=g.data("includefrontpage"),k=null;"undefined"==typeof d&&(d="");var l={criterianame:"search",criteriavalue:d,page:0,perpage:100,requiredcapabilities:h,limittoenrolled:i},m=[{methodname:"core_course_search_courses",args:l}];j&&m.push({methodname:"core_course_get_courses",args:{options:{ids:[j]}}}),k=a.call(m),b.when.apply(b.when,k).done(function(a,b){if(b&&1==b.length){var c=b.pop(),f=""===d||c.fullname.toUpperCase().indexOf(d.toUpperCase())>-1||c.shortname.toUpperCase().indexOf(d.toUpperCase())>-1;f&&a.courses.splice(0,0,c)}e(a)}).fail(f)}}});
define('core/icon_system_standard', ["core/icon_system","core/url","core/mustache"],function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=Object.create(a.prototype),d.prototype.renderIcon=function(a,d,e,f){var g=b.imageUrl(a,d),h={attributes:[{name:"src",value:g},{name:"alt",value:e},{name:"title",value:e}]};"undefined"!=typeof e&&""!=e||h.attributes.push({name:"aria-hidden",value:"true"});var i=c.render(f,h);return i.trim()},d.prototype.getTemplateName=function(){return"core/pix_icon"},d});
define('core/truncate', ["jquery"],function(a){var b=/(\s*\S+|\s)$/,c=/^(\S*)/,d=/\s/,e=function(a,b){if(null==this)throw TypeError();var c=String(a),d=c.length,e=b?Number(b):0;if(e!=e&&(e=0),e<=-1||e>=d)return"";e=0|e;var f,g=c.charCodeAt(e),h=e+1,i=1;return g>=55296&&g<=56319&&d>h&&(f=c.charCodeAt(h),f>=56320&&f<=57343&&(i=2)),i},f=function(a){for(var b=0,c=0;c<a.length;c+=e(a,c))b++;return b},g=function(a,b){if(!a.length)return 0;var c=0,d=0;do c+=e(a,c),d++;while(c<a.length&&d<b);return c};return a.truncate=function(b,c){return a("<div></div>").append(b).truncate(c).html()},a.fn.truncate=function(e){a.isNumeric(e)&&(e={length:e});var h=a.extend({},a.truncate.defaults,e);return this.each(function(){var e=a(this);h.noBreaks&&e.find("br").replaceWith(" ");var i=h.ellipsis.length,j=e.text(),k=f(j),l=k-h.length+i;if(!(k<h.length)){if(h.stripTags&&e.text(j),h.words&&l>0){var m=j.slice(0,g(j,h.length-i)+1),n=m.replace(b,""),o=f(n),p=!m.match(d);l=h.keepFirstWord&&0===o?k-f(c.exec(j)[0])-i:p&&0===o?k-h.length+i:k-o-1}l>k&&(l=k-h.length),l<0||!l&&!h.truncated||a.each(e.contents().get().reverse(),function(b,c){var d=a(c),e=d.text(),j=f(e);if(j<=l)return h.truncated=!0,l-=j,void d.remove();if(3===c.nodeType){var k=j-l;return k=k>=0?g(e,k):0,a(c.splitText(k)).replaceWith(h.ellipsis),!1}return d.truncate(a.extend(h,{length:j-l+i})),!1})}})},a.truncate.defaults={stripTags:!1,words:!1,keepFirstWord:!1,noBreaks:!1,length:1/0,ellipsis:"…"},{truncate:a.truncate}});
define('core/chart_builder', ["jquery"],function(a){var b={make:function(b){var c=a.Deferred();return require(["core/chart_"+b.type],function(a){var d=a.prototype.create(a,b);c.resolve(d)}),c.promise()}};return b});
define('core/custom_interaction_events', ["jquery","core/key_codes"],function(a,b){var c={activate:"cie:activate",keyboardActivate:"cie:keyboardactivate",escape:"cie:escape",down:"cie:down",up:"cie:up",home:"cie:home",end:"cie:end",next:"cie:next",previous:"cie:previous",asterix:"cie:asterix",scrollLock:"cie:scrollLock",scrollTop:"cie:scrollTop",scrollBottom:"cie:scrollBottom",ctrlPageUp:"cie:ctrlPageUp",ctrlPageDown:"cie:ctrlPageDown",enter:"cie:enter"},d={},e=function(a,b){return b=b||[],!(!b.length||b.indexOf(a)===-1)},f=function(a){return a.shiftKey||a.metaKey||a.altKey||a.ctrlKey},g=function(b,c){var e="";return c.hasOwnProperty("originalEvent")?(e="triggeredCustom_"+b,c.originalEvent.hasOwnProperty(e)?void 0:(c.originalEvent[e]=!0,void a(c.target).trigger(b,[{originalEvent:c}]))):(e=""+b+c.type+c.timeStamp,void(d.hasOwnProperty(e)||(d[e]=!0,a(c.target).trigger(b,[{originalEvent:c}]))))},h=function(a,b,c){a.off("keydown."+b).on("keydown."+b,function(a){f(a)||a.keyCode==c&&g(b,a)})},i=function(a){a.off("click.cie.activate").on("click.cie.activate",function(a){g(c.activate,a)}),a.off("keydown.cie.activate").on("keydown.cie.activate",function(a){f(a)||a.keyCode!=b.enter&&a.keyCode!=b.space||g(c.activate,a)})},j=function(a){a.off("keydown.cie.keyboardactivate").on("keydown.cie.keyboardactivate",function(a){f(a)||a.keyCode!=b.enter&&a.keyCode!=b.space||g(c.keyboardActivate,a)})},k=function(a){h(a,c.escape,b.escape)},l=function(a){h(a,c.down,b.arrowDown)},m=function(a){h(a,c.up,b.arrowUp)},n=function(a){h(a,c.home,b.home)},o=function(a){h(a,c.end,b.end)},p=function(d){var e="rtl"==a("html").attr("dir")?b.arrowLeft:b.arrowRight;h(d,c.next,e)},q=function(d){var e="rtl"==a("html").attr("dir")?b.arrowRight:b.arrowLeft;h(d,c.previous,e)},r=function(a){h(a,c.asterix,b.asterix)},s=function(a){a.off("scroll.cie.scrollTop").on("scroll.cie.scrollTop",function(b){var d=a.scrollTop();0===d&&g(c.scrollTop,b)})},t=function(a){a.off("scroll.cie.scrollBottom").on("scroll.cie.scrollBottom",function(b){var d=a.scrollTop(),e=a.innerHeight(),f=a[0].scrollHeight;d+e>=f&&g(c.scrollBottom,b)})},u=function(a){a.off("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock").on("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock",function(b){var d=a.scrollTop(),e=a[0].scrollHeight,f=a.height(),h="DOMMouseScroll"==b.type?b.originalEvent.detail*-40:b.originalEvent.wheelDelta,i=h>0;return!i&&-h>e-f-d?(a.scrollTop(e),b.stopPropagation(),b.preventDefault(),b.returnValue=!1,g(c.scrollLock,b),!1):!(i&&h>d)||(a.scrollTop(0),b.stopPropagation(),b.preventDefault(),b.returnValue=!1,g(c.scrollLock,b),!1)})},v=function(a){a.off("keydown.cie.ctrlpageup").on("keydown.cie.ctrlpageup",function(a){a.ctrlKey&&a.keyCode==b.pageUp&&g(c.ctrlPageUp,a)})},w=function(a){a.off("keydown.cie.ctrlpagedown").on("keydown.cie.ctrlpagedown",function(a){a.ctrlKey&&a.keyCode==b.pageDown&&g(c.ctrlPageDown,a)})},x=function(a){h(a,c.enter,b.enter)},y=function(){var a={};return a[c.activate]=i,a[c.keyboardActivate]=j,a[c.escape]=k,a[c.down]=l,a[c.up]=m,a[c.home]=n,a[c.end]=o,a[c.next]=p,a[c.previous]=q,a[c.asterix]=r,a[c.scrollLock]=u,a[c.scrollTop]=s,a[c.scrollBottom]=t,a[c.ctrlPageUp]=v,a[c.ctrlPageDown]=w,a[c.enter]=x,a},z=function(b,c){b=a(b),c=c||[],b.length&&c.length&&a.each(y(),function(a,d){e(a,c)&&d(b)})};return{define:z,events:c}});
define('core/paged_content_pages', ["jquery","core/templates","core/notification","core/pubsub","core/paged_content_events"],function(a,b,c,d,e){var f={ROOT:'[data-region="page-container"]',PAGE_REGION:'[data-region="paged-content-page"]',ACTIVE_PAGE_REGION:'[data-region="paged-content-page"].active'},g={PAGING_CONTENT_ITEM:"core/paged_content_page",LOADING:"core/overlay_loading"},h=300,i=function(a,b){return a.find('[data-page="'+b+'"]')},j=function(d){var e=a.Deferred();return d.attr("aria-busy",!0),b.render(g.LOADING,{visible:!0}).then(function(b){var c=a(b),f=setTimeout(function(){d.css("position","relative"),c.appendTo(d)},h);e.always(function(){clearTimeout(f),c.remove(),d.css("position",""),d.removeAttr("aria-busy")})}).fail(c.exception),e},k=function(d,e,f){var h=a.Deferred();return e.then(function(a,e){e=e||"",b.render(g.PAGING_CONTENT_ITEM,{page:f,content:a}).then(function(a){b.appendNodeContents(d,a,e);var c=i(d,f);h.resolve(c)}).fail(function(a){h.reject(a)}).fail(c.exception)}).fail(function(a){h.reject(a)}).fail(c.exception),h.promise()},l=function(b,g,h,l){var m=[],n=[],o=a.Deferred(),p=!0;if(g.forEach(function(a){var c=a.pageNumber,d=i(b,c);d.length?m.push(d):n.push(a)}),n.length&&"function"==typeof l){var q=l(n,{allItemsLoaded:function(a){d.publish(h+e.ALL_ITEMS_LOADED,a)}}),r=q.map(function(a,c){return k(b,a,n[c].pageNumber)});a.when.apply(a,r).then(function(){var a=Array.prototype.slice.call(arguments);o.resolve(a)}).fail(function(a){o.reject(a)}).fail(c.exception)}else o.resolve([]);var s=j(b);o.then(function(a){var c=m.concat(a);b.find(f.PAGE_REGION).addClass("hidden"),c.forEach(function(a){p&&a.removeClass("hidden")})}).then(function(){d.publish(h+e.PAGES_SHOWN,g)}).fail(c.exception).always(function(){s.resolve()})},m=function(b,c,f){b=a(b),d.subscribe(c+e.SHOW_PAGES,function(a){l(b,a,c,f)}),d.subscribe(c+e.SET_ITEMS_PER_PAGE_LIMIT,function(){b.empty()})};return{init:m,rootSelector:f.ROOT}});
define('core/localstorage', ["core/config","core/storagewrapper"],function(a,b){var c=new b(window.localStorage);return{get:function(a){return c.get(a)},set:function(a,b){return c.set(a,b)}}});
define('core/dragdrop', ["jquery","core/autoscroll"],function(a,b){var c={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(a){a.preventDefault();var b;if(b="touchstart"===a.type?null===c.touching&&a.changedTouches.length>0:1===a.which){var d=c.getEventXY(a);return d.start=!0,d}return{start:!1}},start:function(a,d,e,f){var g=c.getEventXY(a);switch(c.initialX=g.x,c.initialY=g.y,c.initialPosition=d.offset(),c.dragProxy=d,c.onMove=e,c.onDrop=f,a.type){case"mousedown":c.addEventSpecial("mousemove",c.mouseMove),c.addEventSpecial("mouseup",c.mouseUp);break;case"touchstart":c.addEventSpecial("touchend",c.touchEnd),c.addEventSpecial("touchcancel",c.touchEnd),c.addEventSpecial("touchmove",c.touchMove),c.touching=a.changedTouches[0].identifier;break;default:throw new Error("Unexpected event type: "+a.type)}b.start(c.scroll)},addEventSpecial:function(a,b){try{window.addEventListener(a,b,c.eventCaptureOptions)}catch(d){c.eventCaptureOptions=!0,window.addEventListener(a,b,c.eventCaptureOptions)}},getEventXY:function(a){switch(a.type){case"touchstart":return{x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY};case"mousedown":return{x:a.pageX,y:a.pageY};default:throw new Error("Unexpected event type: "+a.type)}},touchMove:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleMove(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseMove:function(a){c.handleMove(a.pageX,a.pageY)},handleMove:function(b,d){var e=c.dragProxy.offset(),f=e.top-parseInt(c.dragProxy.css("top")),g=e.left-parseInt(c.dragProxy.css("left")),h=a(document).height()-c.dragProxy.outerHeight()-f,i=a(document).width()-c.dragProxy.outerWidth()-g,j=-f,k=-g,l=c.initialPosition,m={top:Math.max(j,Math.min(h,l.top+(d-c.initialY)-f)),left:Math.max(k,Math.min(i,l.left+(b-c.initialX)-g))};c.dragProxy.css(m),c.onMove(b,d,c.dragProxy)},touchEnd:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleEnd(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseUp:function(a){c.handleEnd(a.pageX,a.pageY)},handleEnd:function(a,d){null!==c.touching?(window.removeEventListener("touchend",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchcancel",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchmove",c.touchMove,c.eventCaptureOptions),c.touching=null):(window.removeEventListener("mousemove",c.mouseMove,c.eventCaptureOptions),window.removeEventListener("mouseup",c.mouseUp,c.eventCaptureOptions)),b.stop(),c.onDrop(a,d,c.dragProxy)},scroll:function(b){var d=a(document).height()-c.dragProxy.outerHeight(),e=c.dragProxy.offset();e.top=Math.min(d,e.top+b),c.dragProxy.css(e)}};return{prepare:c.prepare,start:c.start}});
define('core/icon_system_fontawesome', ["core/icon_system","jquery","core/ajax","core/mustache","core/localstorage","core/url"],function(a,b,c,d,e,f){var g=null,h=null,i=function(){a.apply(this,arguments)};return i.prototype=Object.create(a.prototype),i.prototype.init=function(){if(g)return b.when(this);var a=e.get("core/iconmap-fontawesome");return a&&(a=JSON.parse(a)),a?(g=a,b.when(this)):(null===h&&(h=c.call([{methodname:"core_output_load_fontawesome_icon_map",args:[]}],!0,!1)[0]),h.then(function(a){return g={},b.each(a,function(a,b){g[b.component+"/"+b.pix]=b.to}),e.set("core/iconmap-fontawesome",JSON.stringify(g)),this}.bind(this)))},i.prototype.renderIcon=function(a,b,c,e){var h=g[b+"/"+a],i=!1;if("undefined"==typeof h){var j=f.imageUrl(a,b);i={attributes:[{name:"src",value:j},{name:"alt",value:c},{name:"title",value:c}]}}var k={key:h,title:c,alt:c,unmappedIcon:i};"undefined"!=typeof c&&""!==c||(k["aria-hidden"]=!0);var l=d.render(e,k);return l.trim()},i.prototype.getTemplateName=function(){return"core/pix_icon_fontawesome"},i});
define('core/tree', ["jquery"],function(a){var b={ITEM:"[role=treeitem]",GROUP:"[role=treeitem]:has([role=group]), [role=treeitem][aria-owns], [role=treeitem][data-requires-ajax=true]",CLOSED_GROUP:"[role=treeitem]:has([role=group])[aria-expanded=false], [role=treeitem][aria-owns][aria-expanded=false], [role=treeitem][data-requires-ajax=true][aria-expanded=false]",FIRST_ITEM:"[role=treeitem]:first",VISIBLE_ITEM:"[role=treeitem]:visible",UNLOADED_AJAX_ITEM:"[role=treeitem][data-requires-ajax=true][data-loaded=false][aria-expanded=true]"},c=function(c,d){this.treeRoot=a(c),this.treeRoot.data("activeItem",null),this.selectCallback=d,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,asterisk:106},this.initialiseNodes(this.treeRoot),this.setActiveItem(this.treeRoot.find(b.FIRST_ITEM)),this.refreshVisibleItemsCache(),this.bindEventHandlers()};return c.prototype.registerEnterCallback=function(a){this.enterCallback=a},c.prototype.refreshVisibleItemsCache=function(){this.treeRoot.data("visibleItems",this.treeRoot.find(b.VISIBLE_ITEM))},c.prototype.getVisibleItems=function(){return this.treeRoot.data("visibleItems")},c.prototype.setActiveItem=function(a){var b=this.treeRoot.data("activeItem");a!==b&&(b&&(b.attr("tabindex","-1"),b.attr("aria-selected","false")),a.attr("tabindex","0"),a.attr("aria-selected","true"),this.treeRoot.data("activeItem",a),"function"==typeof this.selectCallback&&this.selectCallback(a))},c.prototype.isGroupItem=function(a){return a.is(b.GROUP)},c.prototype.getGroupFromItem=function(a){var b=this.treeRoot.find("#"+a.attr("aria-owns")),c=a.children("[role=group]");return b.length>c.length?b:c},c.prototype.isGroupCollapsed=function(a){return"false"===a.attr("aria-expanded")},c.prototype.isGroupCollapsible=function(a){return"false"!==a.attr("data-collapsible")},c.prototype.initialiseNodes=function(c){this.removeAllFromTabOrder(c),this.setAriaSelectedFalseOnItems(c);var d=this;c.find(b.UNLOADED_AJAX_ITEM).each(function(){var b=a(this);d.collapseGroup(b),d.expandGroup(b)})},c.prototype.removeAllFromTabOrder=function(b){b.find("*").attr("tabindex","-1"),this.getGroupFromItem(a(b)).find("*").attr("tabindex","-1")},c.prototype.setAriaSelectedFalseOnItems=function(a){a.find(b.ITEM).attr("aria-selected","false")},c.prototype.expandAllGroups=function(){var c=this;this.treeRoot.find(b.CLOSED_GROUP).each(function(){var b=a(this);c.expandGroup(a(this)).done(function(){c.expandAllChildGroups(b)})})},c.prototype.expandAllChildGroups=function(c){var d=this;this.getGroupFromItem(c).find(b.CLOSED_GROUP).each(function(){var b=a(this);d.expandGroup(a(this)).done(function(){d.expandAllChildGroups(b)})})},c.prototype.expandGroup=function(b){var c=a.Deferred();if("false"!==b.attr("data-expandable")&&this.isGroupCollapsed(b))if("true"===b.attr("data-requires-ajax")&&"true"!==b.attr("data-loaded")){b.attr("data-loaded",!1);var d=b.closest("[data-ajax-loader]").attr("data-ajax-loader"),e=this;b.addClass("loading"),require([d],function(a){a.load(b).done(function(){b.attr("data-loaded",!0),e.initialiseNodes(b),e.finishExpandingGroup(b),b.removeClass("loading"),c.resolve()})})}else this.finishExpandingGroup(b),c.resolve();else c.resolve();return c},c.prototype.finishExpandingGroup=function(a){var b=this.getGroupFromItem(a);b.attr("aria-hidden","false"),a.attr("aria-expanded","true"),this.refreshVisibleItemsCache()},c.prototype.collapseGroup=function(a){if(this.isGroupCollapsible(a)&&!this.isGroupCollapsed(a)){var b=this.getGroupFromItem(a);b.attr("aria-hidden","true"),a.attr("aria-expanded","false"),this.refreshVisibleItemsCache()}},c.prototype.toggleGroup=function(a){"true"===a.attr("aria-expanded")?this.collapseGroup(a):this.expandGroup(a)},c.prototype.handleKeyDown=function(c,d){var e=this.getVisibleItems().index(c);if(d.altKey||d.ctrlKey||d.metaKey||d.shiftKey&&d.keyCode!=this.keys.tab)return!0;switch(d.keyCode){case this.keys.home:return this.getVisibleItems().first().focus(),d.stopPropagation(),!1;case this.keys.end:return this.getVisibleItems().last().focus(),d.stopPropagation(),!1;case this.keys.enter:var f=c.children("a").length?c.children("a"):c.children().not(b.GROUP).find("a");return f.length?"function"==typeof this.enterCallback?this.enterCallback(c):window.location.href=f.first().attr("href"):this.isGroupItem(c)&&this.toggleGroup(c,!0),d.stopPropagation(),!1;case this.keys.space:return this.isGroupItem(c)&&this.toggleGroup(c,!0),d.stopPropagation(),!1;case this.keys.left:var g=function(b){b.getVisibleItems().filter(function(){return b.getGroupFromItem(a(this)).has(c).length}).focus()};return this.isGroupItem(c)?this.isGroupCollapsed(c)?g(this):this.collapseGroup(c):g(this),d.stopPropagation(),!1;case this.keys.right:return this.isGroupItem(c)&&(this.isGroupCollapsed(c)?this.expandGroup(c):this.getGroupFromItem(c).find(b.ITEM).first().focus()),d.stopPropagation(),!1;case this.keys.up:if(e>0){var h=this.getVisibleItems().eq(e-1);h.focus()}return d.stopPropagation(),!1;case this.keys.down:if(e<this.getVisibleItems().length-1){var i=this.getVisibleItems().eq(e+1);i.focus()}return d.stopPropagation(),!1;case this.keys.asterisk:return this.expandAllGroups(),d.stopPropagation(),!1}return!0},c.prototype.handleClick=function(a,b){return!!(b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)||(a.focus(),this.isGroupItem(a)&&this.toggleGroup(a),b.stopPropagation(),!0)},c.prototype.handleFocus=function(a,b){return this.setActiveItem(a),b.stopPropagation(),!0},c.prototype.bindEventHandlers=function(){var c=this;this.treeRoot.on({click:function(b){return c.handleClick(a(this),b)},keydown:function(b){return c.handleKeyDown(a(this),b)},focus:function(b){return c.handleFocus(a(this),b)}},b.ITEM)},c});
define('core/autoscroll', ["jquery"],function(a){var b={SCROLL_THRESHOLD:30,SCROLL_FREQUENCY:1e3/60,SCROLL_SPEED:.5,scrollingId:null,scrollAmount:0,callback:null,start:function(c){a(window).on("mousemove",b.mouseMove),a(window).on("touchmove",b.touchMove),b.callback=c},stop:function(){a(window).off("mousemove",b.mouseMove),a(window).off("touchmove",b.touchMove),null!==b.scrollingId&&b.stopScrolling()},touchMove:function(a){for(var c=0;c<a.changedTouches.length;c++)b.handleMove(a.changedTouches[c].clientX,a.changedTouches[c].clientY)},mouseMove:function(a){b.handleMove(a.clientX,a.clientY)},handleMove:function(c,d){d<b.SCROLL_THRESHOLD?b.scrollAmount=-Math.min(b.SCROLL_THRESHOLD-d,b.SCROLL_THRESHOLD):d>a(window).height()-b.SCROLL_THRESHOLD?b.scrollAmount=Math.min(d-(a(window).height()-b.SCROLL_THRESHOLD),b.SCROLL_THRESHOLD):b.scrollAmount=0,b.scrollAmount&&null===b.scrollingId?b.startScrolling():b.scrollAmount||null===b.scrollingId||b.stopScrolling()},startScrolling:function(){var c=a(document).height()-a(window).height();b.scrollingId=window.setInterval(function(){var d=a(window).scrollTop(),e=Math.round(b.scrollAmount*b.SCROLL_SPEED);if(d+e<0&&(e=-d),d+e>c&&(e=c-d),0!==e){a(window).scrollTop(d+e);var f=a(window).scrollTop()-d;0!==f&&b.callback&&b.callback(f)}},b.SCROLL_FREQUENCY)},stopScrolling:function(){window.clearInterval(b.scrollingId),b.scrollingId=null}};return{start:b.start,stop:b.stop}});
define('core/sortable_list', ["jquery","core/log","core/autoscroll","core/str","core/modal_factory","core/modal_events","core/notification"],function(a,b,c,d,e,f,g){var h={targetListSelector:null,moveHandlerSelector:"[data-drag-type=move]",isHorizontal:!1,autoScroll:!0},i={keyboardDragClass:"dragdrop-keyboard-drag",isDraggedClass:"sortable-list-is-dragged",currentPositionClass:"sortable-list-current-position",sourceListClass:"sortable-list-source",targetListClass:"sortable-list-target",overElementClass:"sortable-list-over-element"},j=function(){var a,b=!1,c="testpassiveeventoptions";try{a=Object.defineProperty({},"passive",{get:function(){b=!0}}),document.addEventListener(c,a,a),document.removeEventListener(c,a,a)}catch(d){b=!1}return b},k=function(a){return{setup:function(b,c,d){return!!c.includes("notPassive")&&(this.addEventListener(a,d,{passive:!1}),!0)}}};j&&(a.event.special.touchstart=k("touchstart"),a.event.special.touchmove=k("touchmove"),a.event.special.touchend=k("touchend"));var l=function(b,c){this.info=null,this.proxy=null,this.proxyDelta=null,this.dragCounter=0,this.lastEvent=null,this.config=a.extend({},h,c||{}),this.config.listSelector=b,this.config.targetListSelector||(this.config.targetListSelector=b),"object"==typeof this.config.listSelector?a(this.config.listSelector).on("mousedown touchstart.notPassive",a.proxy(this.dragStartHandler,this)):a("body").on("mousedown touchstart.notPassive",this.config.listSelector,a.proxy(this.dragStartHandler,this)),null!==this.config.moveHandlerSelector&&a("body").on("click keypress",this.config.moveHandlerSelector,a.proxy(this.clickHandler,this))};return l.EVENTS={DRAGSTART:"sortablelist-dragstart",DRAG:"sortablelist-drag",DROP:"sortablelist-drop",DRAGEND:"sortablelist-dragend"},l.prototype.resetDraggedClasses=function(){var b=[i.isDraggedClass,i.currentPositionClass,i.overElementClass,i.targetListClass];for(var c in b)a("."+b[c]).removeClass(b[c]);this.proxy&&(this.proxy.remove(),this.proxy=a())},l.prototype.calculatePositionOnPage=function(b){if(b.originalEvent&&b.originalEvent.touches&&void 0!==b.originalEvent.touches[0]){var c=b.originalEvent.touches[0];b.pageX=c.pageX,b.pageY=c.pageY}void 0===b.pageX?(b.pageX=this.lastEvent.pageX,b.pageY=this.lastEvent.pageY):this.lastEvent=b,void 0===b.clientX&&(b.clientX=Math.round(b.pageX-a(window).scrollLeft()),b.clientY=Math.round(b.pageY-a(window).scrollTop()))},l.prototype.dragStartHandler=function(b){if(null!==this.info){if("click"===this.info.type||"touchend"===this.info.type)return;this.moveElement(this.info.sourceList,this.info.sourceNextElement),this.finishDragging()}if("mousedown"!==b.type||1===b.which){this.calculatePositionOnPage(b);var d=a(b.target).closest(a(b.currentTarget).children());if(d.length&&(null===this.config.moveHandlerSelector||a(b.target).closest(this.config.moveHandlerSelector,d).length)){b.stopPropagation(),b.preventDefault(),this.dragCounter++,this.info={element:d,sourceNextElement:d.next(),sourceList:d.parent(),targetNextElement:d.next(),targetList:d.parent(),type:b.type,dropped:!1,startX:b.pageX,startY:b.pageY,startTime:(new Date).getTime()},a(this.config.targetListSelector).addClass(i.targetListClass);var e=d.offset();d.addClass(i.currentPositionClass),this.proxyDelta={x:e.left-b.pageX,y:e.top-b.pageY},this.proxy=a();var f=this.dragCounter;setTimeout(a.proxy(function(){null!==this.info&&"click"!==this.info.type&&"keypress"!==this.info.type&&this.dragCounter===f&&this.createProxy()},this),500),a(window).on("mousemove touchmove.notPassive mouseup touchend.notPassive",a.proxy(this.dragHandler,this)),a(window).on("keypress",a.proxy(this.dragcancelHandler,this)),this.config.autoScroll&&c.start(function(){a(window).trigger("mousemove")}),this.executeCallback(l.EVENTS.DRAGSTART)}}},l.prototype.createProxy=function(){this.proxy=this.info.element.clone(),this.info.sourceList.append(this.proxy),this.proxy.removeAttr("id").removeClass(i.currentPositionClass).addClass(i.isDraggedClass).css({position:"fixed"}),this.proxy.offset({top:this.proxyDelta.y+this.lastEvent.pageY,left:this.proxyDelta.x+this.lastEvent.pageX})},l.prototype.clickHandler=function(b){if(("keypress"!==b.type||13===b.originalEvent.keyCode||32===b.originalEvent.keyCode)&&null===this.info){var c=a(b.target).closest(this.config.moveHandlerSelector),d=c.closest(this.config.listSelector),e=c.closest(d.children());e.length&&(b.preventDefault(),b.stopPropagation(),this.dragCounter++,this.info={element:e,sourceNextElement:e.next(),sourceList:d,targetNextElement:e.next(),targetList:d,dropped:!1,type:b.type,startTime:(new Date).getTime()},this.executeCallback(l.EVENTS.DRAGSTART),this.displayMoveDialogue(c))}},l.prototype.getPositionInNode=function(a,b,c){if(!c.length)return null;var d=c[0],e=0,f=d.getBoundingClientRect(),g=b-(f.top+window.scrollY),h=a-(f.left+window.scrollX);return h>=-e&&h<=f.width+e&&g>=-e&&g<=f.height+e?{x:h,y:g,xRatio:f.width?h/f.width:0,yRatio:f.height?g/f.height:0}:null},l.prototype.isListHorizontal=function(a){var b=this.config.isHorizontal;return b===!0||b===!1?b:b(a)},l.prototype.dragHandler=function(b){b.preventDefault(),b.stopPropagation(),this.calculatePositionOnPage(b),this.proxy.offset({top:-1e3,left:-1e3});var c=a(document.elementFromPoint(b.clientX,b.clientY)),d=this.info.element[0],e=function(){return this!==d},f=c.closest("."+i.targetListClass+" > :not(."+i.isDraggedClass+")").filter(e),g=c.closest("."+i.targetListClass),h=this.proxy,j=function(){return!h||!h.length||this!==h[0]};if(a("."+i.overElementClass).removeClass(i.overElementClass),f.addClass(i.overElementClass),this.proxy.offset({top:this.proxyDelta.y+b.pageY,left:this.proxyDelta.x+b.pageX}),g.length&&!g.children().filter(j).length)this.moveElement(g,a());else if(1===f.length&&!this.info.element.find(f[0]).length){var k=this.getPositionInNode(b.pageX,b.pageY,f);if(k){var m=f.parent(),n=this.isListHorizontal(m)?k.xRatio:k.yRatio,o=f.find("."+i.targetListClass),p=!o.children().filter(j).filter(e).length;o.length&&p&&n>.2&&n<.8?this.moveElement(o,a()):n>.5?this.moveElement(m,f.next().filter(j)):this.moveElement(m,f)}}if("mouseup"===b.type||"touchend"===b.type){this.info.endX=b.pageX,this.info.endY=b.pageY,this.info.endTime=(new Date).getTime(),this.info.dropped=!0,this.info.positionChanged=this.hasPositionChanged(this.info);var q=this.info;this.executeCallback(l.EVENTS.DROP),this.finishDragging(),"touchend"===b.type&&null!==this.config.moveHandlerSelector&&q.endTime-q.startTime<500&&!q.positionChanged&&this.clickHandler(b)}},l.prototype.hasPositionChanged=function(a){return a.sourceList[0]!==a.targetList[0]||a.sourceNextElement.length!==a.targetNextElement.length||a.sourceNextElement.length&&a.sourceNextElement[0]!==a.targetNextElement[0]},l.prototype.moveElement=function(a,b){var c=this.info.element;b.length&&b[0]===c[0]||a[0]===this.info.targetList[0]&&b.length===this.info.targetNextElement.length&&b[0]===this.info.targetNextElement[0]||(b.length?a[0].insertBefore(c[0],b[0]):this.proxy&&this.proxy.parent().length&&this.proxy.parent()[0]===a[0]?a[0].insertBefore(c[0],this.proxy[0]):a[0].appendChild(c[0]),this.info.targetList=a,this.info.targetNextElement=b,this.executeCallback(l.EVENTS.DRAG))},l.prototype.finishDragging=function(){this.resetDraggedClasses(),this.config.autoScroll&&c.stop(),a(window).off("mousemove touchmove.notPassive mouseup touchend.notPassive",a.proxy(this.dragHandler,this)),a(window).off("keypress",a.proxy(this.dragcancelHandler,this)),this.executeCallback(l.EVENTS.DRAGEND),this.info=null},l.prototype.executeCallback=function(a){this.info.element.trigger(a,this.info)},l.prototype.dragcancelHandler=function(a){"keypress"===a.type&&27===a.originalEvent.keyCode&&(this.moveElement(this.info.sourceList,this.info.sourceNextElement),this.finishDragging())},l.prototype.getElementName=function(b){return a.Deferred().resolve(b.text())},l.prototype.getDestinationName=function(a,b){return b.length?this.getElementName(b).then(function(a){return d.get_string("movecontentafter","moodle",a)}):d.get_string("movecontenttothetop","moodle")},l.prototype.getMoveDialogueTitle=function(b,c){return c.attr("title")?a.Deferred().resolve(c.attr("title")):this.getElementName(b).then(function(a){return d.get_string("movecontent","moodle",a)})},l.prototype.getDestinationsList=function(){var b=[],c=a(this.config.targetListSelector),d=a("<ul/>").addClass(i.keyboardDragClass),e=a.when().then(function(){return d}),f=a.proxy(function(b,c,f){c.is(this.info.element)||f.is(this.info.element)||a.contains(this.info.element[0],b[0])||(e=e.then(a.proxy(function(){return this.getDestinationName(b,f)},this)).then(function(e){var f=a("<li/>").appendTo(d),g=a('<a href="#"/>').attr("data-core_sortable_list-quickmove",1).appendTo(f);return g.data("parent-element",b).data("before-element",c).text(e),d}))},this),g=function(){if(a.inArray(this,b)===-1){b.push(this);var d=a(this),e=d.children();e.each(function(){var b=a(this);f(d,b,b.prev()),b.find(c).each(g)}),f(d,a(),e.last())}};return c.each(g),e},l.prototype.displayMoveDialogue=function(b){e.create({type:e.types.CANCEL,title:this.getMoveDialogueTitle(this.info.element,b),body:this.getDestinationsList()}).then(a.proxy(function(c){var d=a.proxy(function(d){d.preventDefault(),d.stopPropagation(),this.moveElement(a(d.currentTarget).data("parent-element"),a(d.currentTarget).data("before-element")),this.info.endTime=(new Date).getTime(),this.info.positionChanged=this.hasPositionChanged(this.info),this.info.dropped=!0,b.focus(),this.executeCallback(l.EVENTS.DROP),c.hide()},this);return c.getRoot().on("click","[data-core_sortable_list-quickmove]",d),c.getRoot().on(f.hidden,a.proxy(function(){c.getRoot().off("click","[data-core_sortable_list-quickmove]",d),c.destroy(),this.finishDragging()},this)),c.setLarge(),c.show(),c},this))["catch"](g.exception)},l});
define('core/modal_factory', ["jquery","core/modal_events","core/modal_registry","core/modal","core/modal_save_cancel","core/modal_confirm","core/modal_cancel","core/templates","core/notification","core/custom_interaction_events"],function(a,b,c,d,e,f,g,h,i,j){var k={DEFAULT:"core/modal",SAVE_CANCEL:"core/modal_save_cancel",CONFIRM:"core/modal_save_cancel",CANCEL:"core/modal_cancel"},l={DEFAULT:"DEFAULT",SAVE_CANCEL:"SAVE_CANCEL",CONFIRM:"CONFIRM",CANCEL:"CANCEL"};c.register(l.DEFAULT,d,k.DEFAULT),c.register(l.SAVE_CANCEL,e,k.SAVE_CANCEL),c.register(l.CONFIRM,f,k.CONFIRM),c.register(l.CANCEL,g,k.CANCEL);var m=function(c,d,e){var f=null,g="function"==typeof e.preShowCallback,h=function(b,d){f=a(b.currentTarget),c.then(function(a){return g&&e.preShowCallback(f,a),a.show(),a}),d.originalEvent.preventDefault()};if(Array.isArray(d)){var i=d[1];d=d[0],j.define(d,[j.events.activate]),d.on(j.events.activate,i,h)}else j.define(d,[j.events.activate]),d.on(j.events.activate,h);c.then(function(a){return a.getRoot().on(b.hidden,function(){null!==f&&f.focus()}),a})},n=function(b,c){c=a(c);var d=b.module,e=new d(c);return e},o=function(b,c){var d=b.template,e=h.render(d,c).then(function(c){var d=a(c);return n(b,d)}).fail(i.exception);return e},p=function(a,b){var d=a.type||l.DEFAULT,e=!!a.large,f=null,g={};f=c.get(d),f||i.exception({message:"Unable to find modal of type: "+d}),"undefined"!=typeof a.templateContext&&(g=a.templateContext);var h=o(f,g).then(function(b){return"undefined"!=typeof a.title&&b.setTitle(a.title),"undefined"!=typeof a.body&&b.setBody(a.body),"undefined"!=typeof a.footer&&b.setFooter(a.footer),e&&b.setLarge(),b});return"undefined"!=typeof b&&m(h,b,a),h};return{create:p,types:l}});
define('core/ajax', ["jquery","core/config","core/log","core/url"],function(a,b,c,d){var e=!1,f=function(a){var b,c,e=this,f=null,g=0;if(a.error)for(;g<e.length;g++)b=e[g],b.deferred.reject(a);else{for(g=0;g<e.length;g++){if(b=e[g],c=a[g],"undefined"==typeof c){f=new Error("missing response");break}if(c.error!==!1){f=c.exception;break}b.deferred.resolve(c.data)}null!==f&&("servicerequireslogin"===f.errorcode?window.location=d.relativeUrl("/login/index.php"):e.forEach(function(a){a.deferred.reject(f)}))}},g=function(a,b,d){var f=this,g=0;for(g=0;g<f.length;g++){var h=f[g];e?(c.error("Page unloaded."),c.error(d)):h.deferred.reject(d)}};return{call:function(c,d,h){a(window).bind("beforeunload",function(){e=!0});var i,j=[],k=[],l=[],m="";for("undefined"==typeof h&&(h=!0),"undefined"==typeof d&&(d=!0),i=0;i<c.length;i++){var n=c[i];j.push({index:i,methodname:n.methodname,args:n.args}),n.deferred=a.Deferred(),k.push(n.deferred.promise()),"undefined"!=typeof n.done&&n.deferred.done(n.done),"undefined"!=typeof n.fail&&n.deferred.fail(n.fail),n.index=i,l.push(n.methodname)}m=l.length<=5?l.sort().join():l.length+"-method-calls",j=JSON.stringify(j);var o={type:"POST",data:j,context:c,dataType:"json",processData:!1,async:d,contentType:"application/json"},p="service.php";h||(p="service-nologin.php");var q=b.wwwroot+"/lib/ajax/"+p+"?sesskey="+b.sesskey+"&info="+m;return d?a.ajax(q,o).done(f).fail(g):(o.success=f,o.error=g,a.ajax(q,o)),k}}});
define('core/icon_system', ["jquery"],function(a){var b=function(){};return b.prototype.init=function(){return a.when(this)},b.prototype.renderIcon=function(a,b,c,d){throw new Error("Abstract function not implemented.")},b.prototype.getTemplateName=function(){throw new Error("Abstract function not implemented.")},b});
define('core/adapter', [],function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c,d,e){var f=j.writeRtpDescription(a.kind,b);if(f+=j.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=j.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":e||"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g=a.rtpSender._initialTrackId||a.rtpSender.track.id;a.rtpSender._initialTrackId=g;var h="msid:"+(d?d.id:"-")+" "+g+"\r\n";f+="a="+h,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+h,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+h,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+j.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+j.localCName+"\r\n"),f}function e(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"==typeof d;return e&&(d=[d]),d=d.filter(function(a){var d=0===a.indexOf("turn:")&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!c;return d?(c=!0,!0):0===a.indexOf("stun:")&&b>=14393&&a.indexOf("?transport=udp")===-1}),delete a.url,a.urls=e?d[0]:d,!!d.length}})}function f(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){var f=d(a.parameters.apt,c),g=d(b.parameters.apt,e);return f&&g&&f.name.toLowerCase()===g.name.toLowerCase()};return a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate){if("rtx"===d.name.toLowerCase()&&d.parameters&&g.parameters.apt&&!e(d,g,a.codecs,b.codecs))continue;g=JSON.parse(JSON.stringify(g)),g.numChannels=Math.min(d.numChannels,g.numChannels),c.codecs.push(g),g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c}function g(a,b,c){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)!==-1}function h(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});return c||a.addRemoteCandidate(b),!c}function i(a,b){var c=new Error(b);return c.name=a,c.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a],c}var j=a("sdp");b.exports=function(a,b){function c(b,c){c.addTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("addtrack",{track:b}))}function k(b,c){c.removeTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("removetrack",{track:b}))}function l(b,c,d,e){var f=new Event("track");f.track=c,f.receiver=d,f.transceiver={receiver:d},f.streams=e,a.setTimeout(function(){b._dispatchEvent("track",f)})}var m=function(c){var d=this,f=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){d[a]=f[a].bind(f)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle="max-bundle"===c.bundlePolicy,"negotiate"===c.rtcpMuxPolicy)throw i("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all"}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced"}if(c.iceServers=e(c.iceServers||[],b),this._iceGatherers=[],c.iceCandidatePoolSize)for(var g=c.iceCandidatePoolSize;g>0;g--)this._iceGatherers.push(new a.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=j.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};m.prototype.onicecandidate=null,m.prototype.onaddstream=null,m.prototype.ontrack=null,m.prototype.onremovestream=null,m.prototype.onsignalingstatechange=null,m.prototype.oniceconnectionstatechange=null,m.prototype.onconnectionstatechange=null,m.prototype.onicegatheringstatechange=null,m.prototype.onnegotiationneeded=null,m.prototype.ondatachannel=null,m.prototype._dispatchEvent=function(a,b){this._isClosed||(this.dispatchEvent(b),"function"==typeof this["on"+a]&&this["on"+a](b))},m.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},m.prototype.getConfiguration=function(){return this._config},m.prototype.getLocalStreams=function(){return this.localStreams},m.prototype.getRemoteStreams=function(){return this.remoteStreams},m.prototype._createTransceiver=function(a,b){var c=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&c)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var e=this._createIceAndDtlsTransports();d.iceTransport=e.iceTransport,d.dtlsTransport=e.dtlsTransport}return b||this.transceivers.push(d),d},m.prototype.addTrack=function(b,c){if(this._isClosed)throw i("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var d=this.transceivers.find(function(a){return a.track===b});if(d)throw i("InvalidAccessError","Track already exists.");for(var e,f=0;f<this.transceivers.length;f++)this.transceivers[f].track||this.transceivers[f].kind!==b.kind||(e=this.transceivers[f]);return e||(e=this._createTransceiver(b.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),e.track=b,e.stream=c,e.rtpSender=new a.RTCRtpSender(b,e.dtlsTransport),e.rtpSender},m.prototype.addStream=function(a){var c=this;if(b>=15025)a.getTracks().forEach(function(b){c.addTrack(b,a)});else{var d=a.clone();a.getTracks().forEach(function(a,b){var c=d.getTracks()[b];a.addEventListener("enabled",function(a){c.enabled=a.enabled})}),d.getTracks().forEach(function(a){c.addTrack(a,d)})}},m.prototype.removeTrack=function(b){if(this._isClosed)throw i("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(b instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(a){return a.rtpSender===b});if(!c)throw i("InvalidAccessError","Sender was not created by this connection.");var d=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var e=this.transceivers.map(function(a){return a.stream});e.indexOf(d)===-1&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},m.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&b.removeTrack(c)})},m.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},m.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},m.prototype._createIceGatherer=function(b,c){var d=this;if(c&&b>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var e=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(e,"state",{value:"new",writable:!0}),this.transceivers[b].bufferedCandidateEvents=[],this.transceivers[b].bufferCandidates=function(a){var c=!a.candidate||0===Object.keys(a.candidate).length;e.state=c?"completed":"gathering",null!==d.transceivers[b].bufferedCandidateEvents&&d.transceivers[b].bufferedCandidateEvents.push(a)},e.addEventListener("localcandidate",this.transceivers[b].bufferCandidates),e},m.prototype._gather=function(b,c){var d=this,e=this.transceivers[c].iceGatherer;if(!e.onlocalcandidate){var f=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,e.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),e.onlocalcandidate=function(a){if(!(d.usingBundle&&c>0)){var f=new Event("icecandidate");f.candidate={sdpMid:b,sdpMLineIndex:c};var g=a.candidate,h=!g||0===Object.keys(g).length;if(h)"new"!==e.state&&"gathering"!==e.state||(e.state="completed");else{"new"===e.state&&(e.state="gathering"),g.component=1,g.ufrag=e.getLocalParameters().usernameFragment;var i=j.writeCandidate(g);f.candidate=Object.assign(f.candidate,j.parseCandidate(i)),f.candidate.candidate=i,f.candidate.toJSON=function(){return{candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex,usernameFragment:f.candidate.usernameFragment}}}var k=j.getMediaSections(d.localDescription.sdp);h?k[f.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n":k[f.candidate.sdpMLineIndex]+="a="+f.candidate.candidate+"\r\n",d.localDescription.sdp=j.getDescription(d.localDescription.sdp)+k.join("");var l=d.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),h||d._dispatchEvent("icecandidate",f),l&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},a.setTimeout(function(){f.forEach(function(a){e.onlocalcandidate(a)})},0)}},m.prototype._createIceAndDtlsTransports=function(){var b=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){b._updateIceConnectionState(),b._updateConnectionState()};var d=new a.RTCDtlsTransport(c);return d.ondtlsstatechange=function(){b._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),b._updateConnectionState()},{iceTransport:c,dtlsTransport:d}},m.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);var c=this.transceivers[a].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[a].iceTransport);var d=this.transceivers[a].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)},m.prototype._transceive=function(a,c,d){var e=f(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:j.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),d&&a.rtpReceiver&&e.codecs.length>0&&("video"===a.kind&&a.recvEncodingParameters&&b<15019&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),a.recvEncodingParameters.length?e.encodings=a.recvEncodingParameters:e.encodings=[{}],e.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(e.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},m.prototype.setLocalDescription=function(a){var b=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(i("TypeError",'Unsupported type "'+a.type+'"'));if(!g("setLocalDescription",a.type,b.signalingState)||b._isClosed)return Promise.reject(i("InvalidStateError","Can not set local "+a.type+" in state "+b.signalingState));var c,d;if("offer"===a.type)c=j.splitSections(a.sdp),d=c.shift(),c.forEach(function(a,c){var d=j.parseRtpParameters(a);b.transceivers[c].localCapabilities=d}),b.transceivers.forEach(function(a,c){b._gather(a.mid,c)});else if("answer"===a.type){c=j.splitSections(b.remoteDescription.sdp),d=c.shift();var e=j.matchPrefix(d,"a=ice-lite").length>0;c.forEach(function(a,c){var g=b.transceivers[c],h=g.iceGatherer,i=g.iceTransport,k=g.dtlsTransport,l=g.localCapabilities,m=g.remoteCapabilities,n=j.isRejected(a)&&0===j.matchPrefix(a,"a=bundle-only").length;if(!n&&!g.rejected){var o=j.getIceParameters(a,d),p=j.getDtlsParameters(a,d);e&&(p.role="server"),b.usingBundle&&0!==c||(b._gather(g.mid,c),"new"===i.state&&i.start(h,o,e?"controlling":"controlled"),"new"===k.state&&k.start(p));var q=f(l,m);b._transceive(g,q.codecs.length>0,!1)}})}return b.localDescription={type:a.type,sdp:a.sdp},"offer"===a.type?b._updateSignalingState("have-local-offer"):b._updateSignalingState("stable"),Promise.resolve()},m.prototype.setRemoteDescription=function(d){var e=this;if(["offer","answer"].indexOf(d.type)===-1)return Promise.reject(i("TypeError",'Unsupported type "'+d.type+'"'));if(!g("setRemoteDescription",d.type,e.signalingState)||e._isClosed)return Promise.reject(i("InvalidStateError","Can not set remote "+d.type+" in state "+e.signalingState));var f={};e.remoteStreams.forEach(function(a){f[a.id]=a});var m=[],n=j.splitSections(d.sdp),o=n.shift(),p=j.matchPrefix(o,"a=ice-lite").length>0,q=j.matchPrefix(o,"a=group:BUNDLE ").length>0;e.usingBundle=q;var r=j.matchPrefix(o,"a=ice-options:")[0];return r?e.canTrickleIceCandidates=r.substr(14).split(" ").indexOf("trickle")>=0:e.canTrickleIceCandidates=!1,n.forEach(function(g,i){var l=j.splitLines(g),n=j.getKind(g),r=j.isRejected(g)&&0===j.matchPrefix(g,"a=bundle-only").length,s=l[0].substr(2).split(" ")[2],t=j.getDirection(g,o),u=j.parseMsid(g),v=j.getMid(g)||j.generateIdentifier();if("application"===n&&"DTLS/SCTP"===s||r)return void(e.transceivers[i]={mid:v,kind:n,rejected:!0});!r&&e.transceivers[i]&&e.transceivers[i].rejected&&(e.transceivers[i]=e._createTransceiver(n,!0));var w,x,y,z,A,B,C,D,E,F,G,H=j.parseRtpParameters(g);r||(F=j.getIceParameters(g,o),G=j.getDtlsParameters(g,o),G.role="client"),C=j.parseRtpEncodingParameters(g);var I=j.parseRtcpParameters(g),J=j.matchPrefix(g,"a=end-of-candidates",o).length>0,K=j.matchPrefix(g,"a=candidate:").map(function(a){return j.parseCandidate(a)}).filter(function(a){return 1===a.component});if(("offer"===d.type||"answer"===d.type)&&!r&&q&&i>0&&e.transceivers[i]&&(e._disposeIceAndDtlsTransports(i),e.transceivers[i].iceGatherer=e.transceivers[0].iceGatherer,e.transceivers[i].iceTransport=e.transceivers[0].iceTransport,e.transceivers[i].dtlsTransport=e.transceivers[0].dtlsTransport,e.transceivers[i].rtpSender&&e.transceivers[i].rtpSender.setTransport(e.transceivers[0].dtlsTransport),e.transceivers[i].rtpReceiver&&e.transceivers[i].rtpReceiver.setTransport(e.transceivers[0].dtlsTransport)),"offer"!==d.type||r)"answer"!==d.type||r||(w=e.transceivers[i],x=w.iceGatherer,y=w.iceTransport,z=w.dtlsTransport,A=w.rtpReceiver,B=w.sendEncodingParameters,D=w.localCapabilities,e.transceivers[i].recvEncodingParameters=C,e.transceivers[i].remoteCapabilities=H,e.transceivers[i].rtcpParameters=I,K.length&&"new"===y.state&&(!p&&!J||q&&0!==i?K.forEach(function(a){h(w.iceTransport,a)}):y.setRemoteCandidates(K)),q&&0!==i||("new"===y.state&&y.start(x,F,"controlling"),"new"===z.state&&z.start(G)),e._transceive(w,"sendrecv"===t||"recvonly"===t,"sendrecv"===t||"sendonly"===t),!A||"sendrecv"!==t&&"sendonly"!==t?delete w.rtpReceiver:(E=A.track,u?(f[u.stream]||(f[u.stream]=new a.MediaStream),c(E,f[u.stream]),m.push([E,A,f[u.stream]])):(f["default"]||(f["default"]=new a.MediaStream),c(E,f["default"]),m.push([E,A,f["default"]]))));else{w=e.transceivers[i]||e._createTransceiver(n),w.mid=v,w.iceGatherer||(w.iceGatherer=e._createIceGatherer(i,q)),K.length&&"new"===w.iceTransport.state&&(!J||q&&0!==i?K.forEach(function(a){h(w.iceTransport,a)}):w.iceTransport.setRemoteCandidates(K)),D=a.RTCRtpReceiver.getCapabilities(n),b<15019&&(D.codecs=D.codecs.filter(function(a){return"rtx"!==a.name})),B=w.sendEncodingParameters||[{ssrc:1001*(2*i+2)}];var L=!1;if("sendrecv"===t||"sendonly"===t){if(L=!w.rtpReceiver,A=w.rtpReceiver||new a.RTCRtpReceiver(w.dtlsTransport,n),L){var M;E=A.track,u&&"-"===u.stream||(u?(f[u.stream]||(f[u.stream]=new a.MediaStream,Object.defineProperty(f[u.stream],"id",{get:function(){return u.stream}})),Object.defineProperty(E,"id",{get:function(){return u.track}}),M=f[u.stream]):(f["default"]||(f["default"]=new a.MediaStream),M=f["default"])),M&&(c(E,M),w.associatedRemoteMediaStreams.push(M)),m.push([E,A,M])}}else w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===w.rtpReceiver.track.id});b&&k(b,a)}),w.associatedRemoteMediaStreams=[]);w.localCapabilities=D,w.remoteCapabilities=H,w.rtpReceiver=A,w.rtcpParameters=I,w.sendEncodingParameters=B,w.recvEncodingParameters=C,e._transceive(e.transceivers[i],!1,L)}}),void 0===e._dtlsRole&&(e._dtlsRole="offer"===d.type?"active":"passive"),e.remoteDescription={type:d.type,sdp:d.sdp},"offer"===d.type?e._updateSignalingState("have-remote-offer"):e._updateSignalingState("stable"),Object.keys(f).forEach(function(b){var c=f[b];if(c.getTracks().length){if(e.remoteStreams.indexOf(c)===-1){e.remoteStreams.push(c);var d=new Event("addstream");d.stream=c,a.setTimeout(function(){e._dispatchEvent("addstream",d)})}m.forEach(function(a){var b=a[0],d=a[1];c.id===a[2].id&&l(e,b,d,[c])})}}),m.forEach(function(a){a[2]||l(e,a[0],a[1],[])}),a.setTimeout(function(){e&&e.transceivers&&e.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&a.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},m.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},m.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",b)},m.prototype._maybeFireNegotiationNeeded=function(){var b=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,a.setTimeout(function(){if(b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b._dispatchEvent("negotiationneeded",a)}},0))},m.prototype._updateIceConnectionState=function(){var a,b={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){b[a.iceTransport.state]++}),a="new",b.failed>0?a="failed":b.checking>0?a="checking":b.disconnected>0?a="disconnected":b["new"]>0?a="new":b.connected>0?a="connected":b.completed>0&&(a="completed"),a!==this.iceConnectionState){this.iceConnectionState=a;var c=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",c)}},m.prototype._updateConnectionState=function(){var a,b={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){b[a.iceTransport.state]++,b[a.dtlsTransport.state]++}),b.connected+=b.completed,a="new",b.failed>0?a="failed":b.connecting>0?a="connecting":b.disconnected>0?a="disconnected":b["new"]>0?a="new":b.connected>0&&(a="connected"),a!==this.connectionState){this.connectionState=a;var c=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",c)}},m.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(i("InvalidStateError","Can not call createOffer after close"));var e=c.transceivers.filter(function(a){return"audio"===a.kind}).length,f=c.transceivers.filter(function(a){return"video"===a.kind}).length,g=arguments[0];if(g){if(g.mandatory||g.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==g.offerToReceiveAudio&&(e=g.offerToReceiveAudio===!0?1:g.offerToReceiveAudio===!1?0:g.offerToReceiveAudio),void 0!==g.offerToReceiveVideo&&(f=g.offerToReceiveVideo===!0?1:g.offerToReceiveVideo===!1?0:g.offerToReceiveVideo)}for(c.transceivers.forEach(function(a){"audio"===a.kind?(e--,e<0&&(a.wantReceive=!1)):"video"===a.kind&&(f--,f<0&&(a.wantReceive=!1))});e>0||f>0;)e>0&&(c._createTransceiver("audio"),e--),f>0&&(c._createTransceiver("video"),f--);var h=j.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(d,e){var f=d.track,g=d.kind,h=d.mid||j.generateIdentifier();d.mid=h,d.iceGatherer||(d.iceGatherer=c._createIceGatherer(e,c.usingBundle));var i=a.RTCRtpSender.getCapabilities(g);b<15019&&(i.codecs=i.codecs.filter(function(a){return"rtx"!==a.name})),i.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1"),d.remoteCapabilities&&d.remoteCapabilities.codecs&&d.remoteCapabilities.codecs.forEach(function(b){a.name.toLowerCase()===b.name.toLowerCase()&&a.clockRate===b.clockRate&&(a.preferredPayloadType=b.payloadType)})}),i.headerExtensions.forEach(function(a){var b=d.remoteCapabilities&&d.remoteCapabilities.headerExtensions||[];b.forEach(function(b){a.uri===b.uri&&(a.id=b.id)})});var k=d.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];f&&b>=15019&&"video"===g&&!k[0].rtx&&(k[0].rtx={ssrc:k[0].ssrc+1}),d.wantReceive&&(d.rtpReceiver=new a.RTCRtpReceiver(d.dtlsTransport,g)),d.localCapabilities=i,d.sendEncodingParameters=k}),"max-compat"!==c._config.bundlePolicy&&(h+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),h+="a=ice-options:trickle\r\n",c.transceivers.forEach(function(a,b){h+=d(a,a.localCapabilities,"offer",a.stream,c._dtlsRole),h+="a=rtcp-rsize\r\n",!a.iceGatherer||"new"===c.iceGatheringState||0!==b&&c.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1,h+="a="+j.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(h+="a=end-of-candidates\r\n"))});var k=new a.RTCSessionDescription({type:"offer",sdp:h});return Promise.resolve(k)},m.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(i("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==c.signalingState&&"have-local-pranswer"!==c.signalingState)return Promise.reject(i("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var e=j.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(e+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");var g=j.getMediaSections(c.remoteDescription.sdp).length;c.transceivers.forEach(function(a,h){if(!(h+1>g)){if(a.rejected)return"application"===a.kind?e+="m=application 0 DTLS/SCTP 5000\r\n":"audio"===a.kind?e+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===a.kind&&(e+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(e+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+a.mid+"\r\n");if(a.stream){var i;"audio"===a.kind?i=a.stream.getAudioTracks()[0]:"video"===a.kind&&(i=a.stream.getVideoTracks()[0]),i&&b>=15019&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}var j=f(a.localCapabilities,a.remoteCapabilities),k=j.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length;!k&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx,e+=d(a,j,"answer",a.stream,c._dtlsRole),a.rtcpParameters&&a.rtcpParameters.reducedSize&&(e+="a=rtcp-rsize\r\n")}});var h=new a.RTCSessionDescription({type:"answer",sdp:e});return Promise.resolve(h)},m.prototype.addIceCandidate=function(a){var b,c=this;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,e){if(!c.remoteDescription)return e(i("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var f=a.sdpMLineIndex;if(a.sdpMid)for(var g=0;g<c.transceivers.length;g++)if(c.transceivers[g].mid===a.sdpMid){f=g;break}var k=c.transceivers[f];if(!k)return e(i("OperationError","Can not add ICE candidate"));if(k.rejected)return d();var l=Object.keys(a.candidate).length>0?j.parseCandidate(a.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return d();if(l.component&&1!==l.component)return d();if((0===f||f>0&&k.iceTransport!==c.transceivers[0].iceTransport)&&!h(k.iceTransport,l))return e(i("OperationError","Can not add ICE candidate"));var m=a.candidate.trim();0===m.indexOf("a=")&&(m=m.substr(2)),b=j.getMediaSections(c.remoteDescription.sdp),b[f]+="a="+(l.type?m:"end-of-candidates")+"\r\n",c.remoteDescription.sdp=j.getDescription(c.remoteDescription.sdp)+b.join("")}else for(var n=0;n<c.transceivers.length&&(c.transceivers[n].rejected||(c.transceivers[n].iceTransport.addRemoteCandidate({}),b=j.getMediaSections(c.remoteDescription.sdp),b[n]+="a=end-of-candidates\r\n",c.remoteDescription.sdp=j.getDescription(c.remoteDescription.sdp)+b.join(""),!c.usingBundle));n++);d()})},m.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=function(a){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};return new Promise(function(c){var d=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(c){a[c].type=b(a[c]),d.set(c,a[c])})}),c(d)})})};var n=["createOffer","createAnswer"];return n.forEach(function(a){var b=m.prototype[a];m.prototype[a]=function(){var a=arguments;return"function"==typeof a[0]||"function"==typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"==typeof a[0]&&a[0].apply(null,[b])},function(b){"function"==typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}}),n=["setLocalDescription","setRemoteDescription","addIceCandidate"],n.forEach(function(a){var b=m.prototype[a];m.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]||"function"==typeof a[2]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)},function(b){"function"==typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}}),["getStats"].forEach(function(a){var b=m.prototype[a];m.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}}),m}},{sdp:2}],2:[function(a,b,c){"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){var b=a.split("\nm=");return b.map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.getDescription=function(a){var b=d.splitSections(a);return b&&b[0]},d.getMediaSections=function(a){var b=d.splitSections(a);return b.shift(),b},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:parseInt(b[1],10),protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1];break;case"ufrag":c.ufrag=b[d+1],c.usernameFragment=b[d+1];break;default:c[b[d]]=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},d.parseIceOptions=function(a){return a.substr(14).split(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},d.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.getMid=function(a){var b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substr(6)},d.parseFingerprint=function(a){var b=a.substr(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1]}},d.getDtlsParameters=function(a,b){var c=d.matchPrefix(a+b,"a=fingerprint:");return{role:"auto",fingerprints:c.map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,b){
var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e={usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)};return e},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});var e=0;return b.codecs.forEach(function(a){a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),c+="a=rtcp-mux\r\n",b.headerExtensions.forEach(function(a){c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=e.fecMechanisms.indexOf("RED")!==-1,g=e.fecMechanisms.indexOf("ULPFEC")!==-1,h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){var b=a.split(" ");return b.shift(),b.map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:b}};c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:b,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substr(5),10)*.95-16e3:void 0,c.forEach(function(a){a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){var b={},c=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);var e=d.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=e.length>0,b.compound=0===e.length;var f=d.matchPrefix(a,"a=rtcp-mux");return b.mux=f.length>0,b},d.parseMsid=function(a){var b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return b=c[0].substr(7).split(" "),{stream:b[0],track:b[1]};var e=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});return e.length>0?(b=e[0].value.split(" "),{stream:b[0],track:b[1]}):void 0},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(a,b){var c,e=void 0!==b?b:2;return c=a?a:d.generateSessionId(),"v=0\r\no=thisisadapterortc "+c+" "+e+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.direction?"a="+a.direction+"\r\n":a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),f},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){var b=d.splitLines(a),c=b[0].split(" ");return c[0].substr(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},d.parseMLine=function(a){var b=d.splitLines(a),c=b[0].substr(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},d.parseOLine=function(a){var b=d.matchPrefix(a,"o=")[0],c=b.substr(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},"object"==typeof b&&(b.exports=d)},{}],3:[function(a,b,c){(function(c){"use strict";var d=a("./adapter_factory.js");b.exports=d({window:c.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(a,b,c){"use strict";var d=a("./utils");b.exports=function(b,c){var e=b&&b.window,f={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var g in c)hasOwnProperty.call(c,g)&&(f[g]=c[g]);var h=d.log,i=d.detectBrowser(e),j=a("./chrome/chrome_shim")||null,k=a("./edge/edge_shim")||null,l=a("./firefox/firefox_shim")||null,m=a("./safari/safari_shim")||null,n=a("./common_shim")||null,o={browserDetails:i,commonShim:n,extractVersion:d.extractVersion,disableLog:d.disableLog,disableWarnings:d.disableWarnings};switch(i.browser){case"chrome":if(!j||!j.shimPeerConnection||!f.shimChrome)return h("Chrome shim is not included in this adapter release."),o;h("adapter.js shimming chrome."),o.browserShim=j,n.shimCreateObjectURL(e),j.shimGetUserMedia(e),j.shimMediaStream(e),j.shimSourceObject(e),j.shimPeerConnection(e),j.shimOnTrack(e),j.shimAddTrackRemoveTrack(e),j.shimGetSendersWithDtmf(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"firefox":if(!l||!l.shimPeerConnection||!f.shimFirefox)return h("Firefox shim is not included in this adapter release."),o;h("adapter.js shimming firefox."),o.browserShim=l,n.shimCreateObjectURL(e),l.shimGetUserMedia(e),l.shimSourceObject(e),l.shimPeerConnection(e),l.shimOnTrack(e),l.shimRemoveStream(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"edge":if(!k||!k.shimPeerConnection||!f.shimEdge)return h("MS edge shim is not included in this adapter release."),o;h("adapter.js shimming edge."),o.browserShim=k,n.shimCreateObjectURL(e),k.shimGetUserMedia(e),k.shimPeerConnection(e),k.shimReplaceTrack(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"safari":if(!m||!f.shimSafari)return h("Safari shim is not included in this adapter release."),o;h("adapter.js shimming safari."),o.browserShim=m,n.shimCreateObjectURL(e),m.shimRTCIceServerUrls(e),m.shimCallbacksAPI(e),m.shimLocalStreamsAPI(e),m.shimRemoteStreamsAPI(e),m.shimTrackEventTransceiver(e),m.shimGetUserMedia(e),m.shimCreateOfferLegacy(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;default:h("Unsupported browser!")}return o}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log;b.exports={shimGetUserMedia:a("./getusermedia"),shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)"RTCRtpTransceiver"in a||d.wrapPeerConnectionEvent(a,"track",function(a){return a.transceiver||(a.transceiver={receiver:a.receiver}),a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return c._ontrackpoly||(c._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.track.id}):{track:d.track};var f=new Event("track");f.track=d.track,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)}),b.stream.getTracks().forEach(function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.id}):{track:d};var f=new Event("track");f.track=d,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)})},c.addEventListener("addstream",c._ontrackpoly)),b.apply(c,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){var e=this,f=c.apply(e,arguments);return f||(f=b(e,a),e._senders.push(f)),f};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;d.apply(b,arguments);var c=b._senders.indexOf(a);c!==-1&&b._senders.splice(c,1)}}var e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;c._senders=c._senders||[],e.apply(c,[a]),a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var f=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._senders=b._senders||[],f.apply(b,[a]),a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var g=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=g.apply(a,[]);return b.forEach(function(b){b._pc=a}),b},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(a){var b=a&&a.URL;"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;return this._srcObject=a,this.src&&b.revokeObjectURL(this.src),a?(this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)}),void a.addEventListener("removetrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)})):void(this.src="")}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var d=b.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(d)===-1&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});if(c)throw new DOMException("Track already exists.","InvalidAccessError")});var d=b.getSenders();c.apply(this,arguments);var e=b.getSenders().filter(function(a){return d.indexOf(a)===-1});this._shimmedLocalStreams[a.id]=[a].concat(e)};var d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};var e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var d=b._shimmedLocalStreams[c].indexOf(a);d!==-1&&b._shimmedLocalStreams[c].splice(d,1),1===b._shimmedLocalStreams[c].length&&delete b._shimmedLocalStreams[c]}),e.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function b(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(e.id,"g"),d.id)}),new RTCSessionDescription({type:b.type,sdp:c})}function c(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(d.id,"g"),e.id)}),new RTCSessionDescription({type:b.type,sdp:c})}var e=d.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&e.version>=65)return this.shimAddTrackRemoveTrackWithNative(a);var f=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=f.apply(this);return a._reverseStreams=a._reverseStreams||{},b.map(function(b){return a._reverseStreams[b.id]})};var g=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var c=this;if(c._streams=c._streams||{},c._reverseStreams=c._reverseStreams||{},b.getTracks().forEach(function(a){var b=c.getSenders().find(function(b){return b.track===a});if(b)throw new DOMException("Track already exists.","InvalidAccessError")}),!c._reverseStreams[b.id]){var d=new a.MediaStream(b.getTracks());c._streams[b.id]=d,c._reverseStreams[d.id]=b,b=d}g.apply(c,[b])};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._streams=b._streams||{},b._reverseStreams=b._reverseStreams||{},h.apply(b,[b._streams[a.id]||a]),delete b._reverseStreams[b._streams[a.id]?b._streams[a.id].id:a.id],delete b._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){var d=this;if("closed"===d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var f=d.getSenders().find(function(a){return a.track===b});if(f)throw new DOMException("Track already exists.","InvalidAccessError");d._streams=d._streams||{},d._reverseStreams=d._reverseStreams||{};var g=d._streams[c.id];if(g)g.addTrack(b),Promise.resolve().then(function(){d.dispatchEvent(new Event("negotiationneeded"))});else{var h=new a.MediaStream([b]);d._streams[c.id]=h,d._reverseStreams[h.id]=c,d.addStream(h)}return d.getSenders().find(function(a){return a.track===b})},["createOffer","createAnswer"].forEach(function(c){var d=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this,c=arguments,e=arguments.length&&"function"==typeof arguments[0];return e?d.apply(a,[function(d){var e=b(a,d);c[0].apply(null,[e])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):d.apply(a,arguments).then(function(c){return b(a,c)})}});var i=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var a=this;return arguments.length&&arguments[0].type?(arguments[0]=c(a,arguments[0]),i.apply(a,arguments)):i.apply(a,arguments)};var j=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=this,c=j.get.apply(this);return""===c.type?c:b(a,c)}}),a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var c=a._pc===b;if(!c)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};var d;Object.keys(b._streams).forEach(function(c){var e=b._streams[c].getTracks().find(function(b){return a.track===b});e&&(d=b._streams[c])}),d&&(1===d.getTracks().length?b.removeStream(b._reverseStreams[d.id]):d.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(a){var b=d.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection)a.RTCPeerConnection=function(b,c){return e("PeerConnection"),b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy),new a.webkitRTCPeerConnection(b,c)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}});else{var c=a.RTCPeerConnection;a.RTCPeerConnection=function(a,b){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new c(a,b)},a.RTCPeerConnection.prototype=c.prototype,Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return c.generateCertificate}})}var f=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,c){var d=this,e=arguments;if(arguments.length>0&&"function"==typeof a)return f.apply(this,arguments);if(0===f.length&&(0===arguments.length||"function"!=typeof arguments[0]))return f.apply(this,[]);var g=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};if(arguments.length>=2){var i=function(a){e[1](h(g(a)))};return f.apply(this,[i,arguments[0]])}return new Promise(function(a,b){f.apply(d,[function(b){a(h(g(b)))},b])}).then(b,c)},b.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=arguments,b=this,d=new Promise(function(d,e){c.apply(b,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),b.version<52&&["createOffer","createAnswer"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){c.apply(a,[d,e,b])})}return c.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var g=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?g.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":13,"./getusermedia":6}],6:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},g=function(a,d){if(b.version>=61)return d(a);if(a=JSON.parse(JSON.stringify(a)),a&&"object"==typeof a.audio){var g=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a)),g(a.audio,"autoGainControl","googAutoGainControl"),g(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=f(a.audio)}if(a&&"object"==typeof a.video){var h=a.video.facingMode;h=h&&("object"==typeof h?h:{ideal:h});var i=b.version<66;if(h&&("user"===h.exact||"environment"===h.exact||"user"===h.ideal||"environment"===h.ideal)&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||i)){delete a.video.facingMode;var j;if("environment"===h.exact||"environment"===h.ideal?j=["back","rear"]:"user"!==h.exact&&"user"!==h.ideal||(j=["front"]),j)return c.mediaDevices.enumerateDevices().then(function(b){b=b.filter(function(a){return"videoinput"===a.kind});var c=b.find(function(a){return j.some(function(b){return a.label.toLowerCase().indexOf(b)!==-1})});return!c&&b.length&&j.indexOf("back")!==-1&&(c=b[b.length-1]),c&&(a.video.deviceId=h.exact?{exact:c.deviceId}:{ideal:c.deviceId}),a.video=f(a.video),e("chrome: "+JSON.stringify(a)),d(a)})}a.video=f(a.video)}return e("chrome: "+JSON.stringify(a)),d(a)},h=function(a){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(a,b,d){g(a,function(a){c.webkitGetUserMedia(a,b,function(a){d&&d(h(a))})})};c.getUserMedia=i;var j=function(a){return new Promise(function(b,d){c.getUserMedia(a,b,d)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:j,enumerateDevices:function(){return new Promise(function(b){var c={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){b(a.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return g(a,function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(h(a))})})}}else c.mediaDevices.getUserMedia=function(a){return j(a)};"undefined"==typeof c.mediaDevices.addEventListener&&(c.mediaDevices.addEventListener=function(){e("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof c.mediaDevices.removeEventListener&&(c.mediaDevices.removeEventListener=function(){e("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(a,b,c){"use strict";var d=a("sdp"),e=a("./utils");b.exports={shimRTCIceCandidate:function(a){if(a.RTCIceCandidate&&!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if("object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2)),a.candidate&&a.candidate.length){var c=new b(a),e=d.parseCandidate(a.candidate),f=Object.assign(c,e);return f.toJSON=function(){return{candidate:f.candidate,sdpMid:f.sdpMid,sdpMLineIndex:f.sdpMLineIndex,usernameFragment:f.usernameFragment}},f}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,e.wrapPeerConnectionEvent(a,"icecandidate",function(b){return b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b})}},shimCreateObjectURL:function(a){var b=a&&a.URL;if("object"==typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&b.createObjectURL&&b.revokeObjectURL){var c=b.createObjectURL.bind(b),d=b.revokeObjectURL.bind(b),f=new Map,g=0;b.createObjectURL=function(a){if("getTracks"in a){var b="polyblob:"+ ++g;return f.set(b,a),e.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),b}return c(a)},b.revokeObjectURL=function(a){d(a),f["delete"](a)};var h=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return h.get.apply(this)},set:function(a){return this.srcObject=f.get(a)||null,h.set.apply(this,[a])}});var i=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=f.get(arguments[1])||null),i.apply(this,arguments)}}},shimMaxMessageSize:function(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var b=e.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp}});var c=function(a){var b=d.splitSections(a.sdp);return b.shift(),b.some(function(a){var b=d.parseMLine(a);return b&&"application"===b.kind&&b.protocol.indexOf("SCTP")!==-1})},f=function(a){var b=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===b||b.length<2)return-1;var c=parseInt(b[1],10);return c!==c?-1:c},g=function(a){var c=65536;return"firefox"===b.browser&&(c=b.version<57?a===-1?16384:2147483637:57===b.version?65535:65536),c},h=function(a,c){var e=65536;"firefox"===b.browser&&57===b.version&&(e=65535);var f=d.matchPrefix(a.sdp,"a=max-message-size:");return f.length>0?e=parseInt(f[0].substr(19),10):"firefox"===b.browser&&c!==-1&&(e=2147483637),e},i=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;if(a._sctp=null,c(arguments[0])){var b,d=f(arguments[0]),e=g(d),j=h(arguments[0],d);b=0===e&&0===j?Number.POSITIVE_INFINITY:0===e||0===j?Math.max(e,j):Math.min(e,j);var k={};Object.defineProperty(k,"maxMessageSize",{get:function(){return b}}),a._sctp=k}return i.apply(a,arguments)}}},shimSendThrowTypeError:function(a){if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var b=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=this,c=b.apply(a,arguments),d=c.send;return c.send=function(){var b=this,c=arguments[0],e=c.length||c.size||c.byteLength;if(e>a.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)","TypeError");return d.apply(b,arguments)},c}}}}},{"./utils":13,sdp:2}],8:[function(a,b,c){"use strict";var d=a("../utils"),e=a("rtcpeerconnection-shim");b.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection:function(a){var b=d.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),b.version<15025)){var c=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){c.set.call(this,a);var b=new Event("enabled");b.enabled=a,this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),a.RTCDtmfSender&&!a.RTCDTMFSender&&(a.RTCDTMFSender=a.RTCDtmfSender),a.RTCPeerConnection=e(a,b.version)},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(a,b,c){"use strict";b.exports=function(a){var b=a&&a.navigator,c=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},d=b.mediaDevices.getUserMedia.bind(b.mediaDevices);b.mediaDevices.getUserMedia=function(a){return d(a)["catch"](function(a){return Promise.reject(c(a))})}}},{}],10:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimGetUserMedia:a("./getusermedia"),shimOnTrack:function(a){"object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.transceiver={receiver:c.receiver},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}}),"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=d.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){
a.RTCPeerConnection||(a.RTCPeerConnection=function(c,d){if(b.version<38&&c&&c.iceServers){for(var e=[],f=0;f<c.iceServers.length;f++){var g=c.iceServers[f];if(g.hasOwnProperty("urls"))for(var h=0;h<g.urls.length;h++){var i={url:g.urls[h]};0===g.urls[h].indexOf("turn")&&(i.username=g.username,i.credential=g.credential),e.push(i)}else e.push(c.iceServers[f])}c.iceServers=e}return new a.mozRTCPeerConnection(c,d)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var e=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},f={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,d){return g.apply(this,[a||null]).then(function(a){if(b.version<48&&(a=e(a)),b.version<53&&!c)try{a.forEach(function(a){a.type=f[a.type]||a.type})}catch(d){if("TypeError"!==d.name)throw d;a.forEach(function(b,c){a.set(c,Object.assign({},b,{type:f[b.type]||b.type}))})}return a}).then(c,d)}}},shimRemoveStream:function(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;d.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&a.getTracks().indexOf(c.track)!==-1&&b.removeTrack(c)})})}}},{"../utils":13,"./getusermedia":11}],11:[function(a,b,c){"use strict";var d=a("../utils"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=a&&a.MediaStreamTrack,g=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(a,d,f){var h=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return a=JSON.parse(JSON.stringify(a)),b.version<38&&(e("spec: "+JSON.stringify(a)),a.audio&&(a.audio=h(a.audio)),a.video&&(a.video=h(a.video)),e("ff37: "+JSON.stringify(a))),c.mozGetUserMedia(a,d,function(a){f(g(a))})},i=function(a){return new Promise(function(b,c){h(a,b,c)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(a){var b=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];a(b)})},b.version<41){var j=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return j().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(b.version<49){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(g(a))})}}if(!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var l=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},m=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","mozAutoGainControl"),l(a.audio,"noiseSuppression","mozNoiseSuppression")),m(a)},f&&f.prototype.getSettings){var n=f.prototype.getSettings;f.prototype.getSettings=function(){var a=n.apply(this,arguments);return l(a,"mozAutoGainControl","autoGainControl"),l(a,"mozNoiseSuppression","noiseSuppression"),a}}if(f&&f.prototype.applyConstraints){var o=f.prototype.applyConstraints;f.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),l(a,"autoGainControl","mozAutoGainControl"),l(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}c.getUserMedia=function(a,e,f){return b.version<44?h(a,e,f):(d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void c.mediaDevices.getUserMedia(a).then(e,f))}}},{"../utils":13}],12:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimLocalStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;return this._localStreams&&this._localStreams.forEach(function(c){c.id===a&&(b=c)}),this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)}),b}),!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(a)===-1&&this._localStreams.push(a);var c=this;a.getTracks().forEach(function(d){b.call(c,d,a)})},a.RTCPeerConnection.prototype.addTrack=function(a,c){return c&&(this._localStreams?this._localStreams.indexOf(c)===-1&&this._localStreams.push(c):this._localStreams=[c]),b.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(b!==-1){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){d.indexOf(a.track)!==-1&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){"object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){var b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){if(b._remoteStreams||(b._remoteStreams=[]),!(b._remoteStreams.indexOf(a)>=0)){b._remoteStreams.push(a);var c=new Event("addstream");c.stream=a,b.dispatchEvent(c)}})})}}))},shimCallbacksAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){var d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){var c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};var h=function(a,b,c){var d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,h=function(a,b,c){var d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.setRemoteDescription=h,h=function(a,b,c){var d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=h}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"==typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){var c=this;if(a){"undefined"!=typeof a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var d=c.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});a.offerToReceiveAudio===!1&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):a.offerToReceiveAudio!==!0||d||c.addTransceiver("audio"),"undefined"!=typeof a.offerToReceiveAudio&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);var e=c.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});a.offerToReceiveVideo===!1&&e?"sendrecv"===e.direction?e.setDirection("sendonly"):"recvonly"===e.direction&&e.setDirection("inactive"):a.offerToReceiveVideo!==!0||e||c.addTransceiver("video")}return b.apply(c,arguments)}}}},{"../utils":13}],13:[function(a,b,c){"use strict";function d(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)}function e(a,b,c){if(a.RTCPeerConnection){var d=a.RTCPeerConnection.prototype,e=d.addEventListener;d.addEventListener=function(a,d){if(a!==b)return e.apply(this,arguments);var f=function(a){d(c(a))};return this._eventMap=this._eventMap||{},this._eventMap[d]=f,e.apply(this,[a,f])};var f=d.removeEventListener;d.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return f.apply(this,arguments);var d=this._eventMap[c];return delete this._eventMap[c],f.apply(this,[a,d])},Object.defineProperty(d,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),a&&this.addEventListener(b,this["_on"+b]=a)}})}}var f=!0,g=!0;b.exports={extractVersion:d,wrapPeerConnectionEvent:e,disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(f=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(g=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(f)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(a,b){g&&console.warn(a+" is deprecated, please use "+b+" instead.")},detectBrowser:function(a){var b=a&&a.navigator,c={};if(c.browser=null,c.version=null,"undefined"==typeof a||!a.navigator)return c.browser="Not a browser.",c;if(b.mozGetUserMedia)c.browser="firefox",c.version=d(b.userAgent,/Firefox\/(\d+)\./,1);else if(b.webkitGetUserMedia)c.browser="chrome",c.version=d(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/))c.browser="edge",c.version=d(b.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!a.RTCPeerConnection||!b.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=d(b.userAgent,/AppleWebKit\/(\d+)\./,1)}return c}}},{}]},{},[3])(3)});
define('core/modal_registry', ["core/notification"],function(a){var b={},c=function(a){return b[a]},d=function(d,e,f){c(d)&&a.exception({message:"Modal of  type '"+d+"' is already registered"}),e&&"function"==typeof e||a.exception({message:"You must provide a modal module"}),f||a.exception({message:"You must provide a modal template"}),b[d]={module:e,template:f}};return{register:d,get:c}});
define('core/templates', ["core/mustache","jquery","core/ajax","core/str","core/notification","core/url","core/config","core/localstorage","core/icon_system","core/event","core/yui","core/log","core/truncate","core/user_date","core/pending"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=0,q={},r={},s={},t={},u=["js"],v=function(){this.requiredStrings=[],this.requiredJS=[],this.requiredDates=[],this.currentThemeName=""};v.prototype.requiredStrings=null,v.prototype.requiredDates=[],v.prototype.requiredJS=null,v.prototype.currentThemeName="",v.prototype.getTemplate=function(a){var d=a.split("/"),e=d.shift(),f=d.shift(),g=this.currentThemeName+"/"+a;if(g in r)return r[g];var i=h.get("core_template/"+g);if(i)return q[g]=i,r[g]=b.Deferred().resolve(i).promise(),r[g];var j=c.call([{methodname:"core_output_load_template",args:{component:e,template:f,themename:this.currentThemeName}}],!0,!1);return r[g]=j[0].then(function(a){return q[g]=a,h.set("core_template/"+g,a),a}),r[g]},v.prototype.partialHelper=function(a){var b=this.currentThemeName+"/"+a;return b in q||e.exception(new Error("Failed to pre-fetch the template: "+a)),q[b]},v.prototype.renderIcon=function(a,c,d){var f=g.iconsystemmodule,h=b.Deferred();return require([f],function(a){var b=new a;b instanceof i?(t=b,b.init().then(h.resolve)["catch"](e.exception)):h.reject("Invalid icon system specified"+g.iconsystemmodule)}),h.then(function(a){return this.getTemplate(a.getTemplateName())}.bind(this)).then(function(b){return t.renderIcon(a,c,d,b)})},v.prototype.pixHelper=function(a,b,c){var d=b.split(","),e="",f="",g="";d.length>0&&(e=c(d.shift().trim(),a)),d.length>0&&(f=c(d.shift().trim(),a)),d.length>0&&(g=c(d.join(",").trim(),a));var h=t.getTemplateName(),i=this.currentThemeName+"/"+h,j=q[i];return e=e.replace(/&#x2F;/gi,"/"),t.renderIcon(e,f,g,j)},v.prototype.jsHelper=function(a,b,c){return this.requiredJS.push(c(b,a)),""},v.prototype.stringHelper=function(a,b,c){var d=b.split(","),e="",f="",g="";d.length>0&&(e=d.shift().trim()),d.length>0&&(f=d.shift().trim()),d.length>0&&(g=d.join(",").trim()),""!==g&&(g=c(g,a)),0===g.indexOf("{")&&0!==g.indexOf("{{")&&(g=JSON.parse(g));var h=this.requiredStrings.length;return this.requiredStrings.push({key:e,component:f,param:g}),"[[_s"+h+"]]"},v.prototype.quoteHelper=function(a,b,c){var d=c(b.trim(),a);return d=d.replace(/"/g,'\\"').replace(/([\{\}]{2,3})/g,"{{=<% %>=}}$1<%={{ }}=%>").replace(/(\r\n|\r|\n)/g,"&#x0a;"),'"'+d+'"'},v.prototype.shortenTextHelper=function(a,b,c){var d=/(.*?),(.*)/,e=b.match(d),f=e[1].trim(),g=e[2].trim(),h=c(g,a);return m.truncate(h,{length:f,words:!0,ellipsis:"..."})},v.prototype.userDateHelper=function(a,b,c){var d=/(.*?),(.*)/,e=b.match(d),f=c(e[1].trim(),a),g=c(e[2].trim(),a),h=this.requiredDates.length;return this.requiredDates.push({timestamp:f,format:g}),"[[_t_"+h+"]]"},v.prototype.addHelperFunction=function(a,b){return function(){return function(c,d){var e=u.reduce(function(a,c){return b.hasOwnProperty(c)&&(a[c]=b[c]),a},{});u.forEach(function(a){b[a]=function(){return""}});var f=a.apply(this,[b,c,d]);for(var g in e)b[g]=e[g];return f}.bind(this)}.bind(this)},v.prototype.addHelpers=function(a,b){this.currentThemeName=b,this.requiredStrings=[],this.requiredJS=[],a.uniqid=p++,a.str=this.addHelperFunction(this.stringHelper,a),a.pix=this.addHelperFunction(this.pixHelper,a),a.js=this.addHelperFunction(this.jsHelper,a),a.quote=this.addHelperFunction(this.quoteHelper,a),a.shortentext=this.addHelperFunction(this.shortenTextHelper,a),a.userdate=this.addHelperFunction(this.userDateHelper,a),a.globals={config:g},a.currentTheme=b},v.prototype.getJS=function(){var a="";return this.requiredJS.length>0&&(a=this.requiredJS.join(";\n")),a},v.prototype.treatStringsInContent=function(a,b){var c,d,e,f,g,h,i=/\[\[_s\d+\]\]/;do{for(c="",d=a.search(i);d>-1;){c+=a.substring(0,d),a=a.substr(d),e="",f=4,g=a.substr(f,1);do e+=g,f++,g=a.substr(f,1);while("]"!=g);h=b[parseInt(e,10)],"undefined"==typeof h&&(l.debug("Could not find string for pattern [[_s"+e+"]]."),h=""),c+=h,a=a.substr(6+e.length),d=a.search(i)}a=c+a,d=a.search(i)}while(d>-1);return a},v.prototype.treatDatesInContent=function(a,b){return b.forEach(function(b,c){var d="\\[\\[_t_"+c+"\\]\\]",e=new RegExp(d,"g");a=a.replace(e,b)}),a},v.prototype.doRender=function(c,e,f){this.currentThemeName=f;var g=t.getTemplateName(),h=new o("core/templates:doRender");return this.getTemplate(g).then(function(){this.addHelpers(e,f);var d=a.render(c,e,this.partialHelper.bind(this));return b.Deferred().resolve(d.trim(),this.getJS()).promise()}.bind(this)).then(function(a,c){return this.requiredStrings.length>0?d.get_strings(this.requiredStrings).then(function(d){return this.requiredDates=this.requiredDates.map(function(a){return{timestamp:this.treatStringsInContent(a.timestamp,d),format:this.treatStringsInContent(a.format,d)}}.bind(this)),a=this.treatStringsInContent(a,d),c=this.treatStringsInContent(c,d),b.Deferred().resolve(a,c).promise()}.bind(this)):b.Deferred().resolve(a,c).promise()}.bind(this)).then(function(a,c){return this.requiredDates.length>0?n.get(this.requiredDates).then(function(d){return a=this.treatDatesInContent(a,d),c=this.treatDatesInContent(c,d),b.Deferred().resolve(a,c).promise()}.bind(this)):b.Deferred().resolve(a,c).promise()}.bind(this)).then(function(a,c){return h.resolve(),b.Deferred().resolve(a,c).promise()})};var w=function(a){if(""!==a.trim()){var c=b("<script>").attr("type","text/javascript").html(a);b("head").append(c)}},x=function(a,c,d,e){var f=b(a);if(f.length){var g=b(c),h=null;e?(h=new k.NodeList(f.children().get()),h.destroy(!0),f.empty(),f.append(g)):(h=new k.NodeList(f.get()),h.destroy(!0),f.replaceWith(g)),w(d),j.notifyFilterContentUpdated(g)}};v.prototype.scanForPartials=function(b){var c=a.parse(b),d=[],e=function(a,b){var c,d;for(c=0;c<a.length;c++)d=a[c],">"!=d[0]&&"<"!=d[0]||b.push(d[1]),d.length>4&&e(d[4],b)};return e(c,d),d},v.prototype.cachePartials=function(a,c){var d=this.currentThemeName+"/"+a;return d in s?s[d]:(c=c||[d],s[d]=b.Deferred(),this.getTemplate(a).then(function(e){var f=this.scanForPartials(e),g=f.filter(function(b){return!(c.indexOf(this.currentThemeName+"/"+b)>=0)&&b!=a}.bind(this)),h=g.map(function(a){return c.push(this.currentThemeName+"/"+a),this.cachePartials(a,c)}.bind(this));return b.when.apply(b,h).then(function(){return s[d].resolve(e)})}.bind(this))["catch"](s[d].reject),s[d])},v.prototype.render=function(a,c,d){"undefined"==typeof d&&(d=g.theme),this.currentThemeName=d;var f=g.iconsystemmodule,h=b.Deferred();return require([f],function(a){var b=new a;b instanceof i?(t=b,b.init().then(h.resolve)["catch"](e.exception)):h.reject("Invalid icon system specified"+g.iconsystem)}),h.then(function(){return this.cachePartials(a)}.bind(this)).then(function(a){return this.doRender(a,c,d)}.bind(this))};var y=function(a,c,d){var e=b(a);e.length&&(e.prepend(c),w(d),j.notifyFilterContentUpdated(e))},z=function(a,c,d){var e=b(a);e.length&&(e.append(c),w(d),j.notifyFilterContentUpdated(e))};return{render:function(a,b,c){var d=new v;return d.render(a,b,c)},renderPix:function(a,b,c){var d=new v;return d.renderIcon(a,b,c)},runTemplateJS:w,replaceNodeContents:function(a,b,c){x(a,b,c,!0)},replaceNode:function(a,b,c){x(a,b,c,!1)},prependNodeContents:function(a,b,c){y(a,b,c)},appendNodeContents:function(a,b,c){z(a,b,c)}}});
define('core/user_date', ["jquery","core/ajax","core/sessionstorage","core/config"],function(a,b,c,d){var e=86400,f={},g=function(b){var c=a("html").attr("lang").replace(/-/g,"_");return"core_user_date/"+c+"/"+d.usertimezone+"/"+b.timestamp+"/"+b.format},h=function(a){return c.get(a)},i=function(a,b){c.set(a,b)},j=function(a){return"undefined"!=typeof f[a]},k=function(a){return f[a]},l=function(a,b){f[a]=b},m=function(a){var c=a.map(function(a){return{timestamp:a.timestamp,format:a.format}}),e={methodname:"core_get_user_dates",args:{contextid:d.contextid,timestamps:c}};return b.call([e],!0,!0)[0].then(function(b){b.dates.forEach(function(b,c){var d=a[c],e=g(d);i(e,b),d.deferred.resolve(b)})})["catch"](function(b){a.forEach(function(a){a.deferred.reject(b)})})},n=function(b){var c=[],d=[];return b.forEach(function(b){var e=g(b);if(j(e))d.push(k(e));else{var f=a.Deferred(),i=h(e);i?f.resolve(i):(b.deferred=f,c.push(b)),l(e,f.promise()),d.push(f.promise())}}),c.length&&m(c),a.when.apply(a,d).then(function(){return 1===arguments.length?[arguments[0]]:Array.apply(null,arguments)})},o=function(a,b){var c=a>b,d=Math.abs(a-b),f=c?Math.floor(d/e):Math.ceil(d/e),g=f*e,h=c?b+g:b-g;return h};return{get:n,getUserMidnightForTimestamp:o}});
define('core/chartjs', ["core/chartjs-lazy"],function(a){return a});
define('core/tag', ["jquery","core/ajax","core/templates","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){return{initTagindexPage:function(){a("body").delegate(".tagarea[data-ta] a[data-quickload=1]","click",function(d){d.preventDefault();var e=a(this),f=e[0].search.replace(/^\?/,""),g=e.closest(".tagarea[data-ta]"),h=f.split("&").reduce(function(a,b){var c=b.split("=");return a[c[0]]=decodeURIComponent(c[1]),a},{}),i=b.call([{methodname:"core_tag_get_tagindex",args:{tagindex:h}}],!0);a.when.apply(a,i).done(function(a){c.render("core_tag/index",a).done(function(a){g.replaceWith(a)})})})},initManagePage:function(){a("body").on("updated","[data-inplaceeditable]",function(b){if(e.get_string("selecttag","core_tag",b.ajaxreturn.value).then(function(c){return a('label[for="tagselect'+b.ajaxreturn.itemid+'"]').html(c)}).fail(d.exception),e.get_string("now").done(function(c){a(b.target).closest("tr").find("td.col-timemodified").html(c)}),"tagflag"===b.ajaxreturn.itemtype){var c=a(b.target).closest("tr");"0"===b.ajaxreturn.value?c.removeClass("flagged-tag"):c.addClass("flagged-tag")}}),a(".tag-management-table").delegate("a.tagdelete","click",function(b){b.preventDefault();var c=a(this).attr("href");e.get_strings([{key:"delete"},{key:"confirmdeletetag",component:"tag"},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location.href=c})})}),a("#tag-management-delete").click(function(b){var c=a(this).closest("form").get(0),f=a(c).find("input[type=checkbox]:checked").length;if(f){var g=a("<input type='hidden'/>").attr("name",this.name);b.preventDefault(),e.get_strings([{key:"delete"},{key:"confirmdeletetags",component:"tag"},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){g.appendTo(c),c.submit()})})}}),a("#tag-management-combine").click(function(b){b.preventDefault();var h=a(this).closest("form").get(0),i=a(h).find("input[type=checkbox]:checked");if(i.length<=1)return void e.get_strings([{key:"combineselected",component:"tag"},{key:"selectmultipletags",component:"tag"},{key:"ok"}]).done(function(a){d.alert(a[0],a[1],a[2])});var j=a("<input type='hidden'/>").attr("name",this.name),k="",l=[];i.each(function(){var b=a(this).val(),c=a(".inplaceeditable[data-itemtype=tagname][data-itemid="+b+"]").attr("data-value");l.push({id:b,name:c})}),e.get_strings([{key:"combineselected",component:"tag"},{key:"continue"}]).then(function(a){var b=a[0];k=a[1];var d={tags:l};return f.create({title:b,body:c.render("core_tag/combine_tags",d),type:f.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(k),b.getRoot().on(g.save,function(b){b.preventDefault(),j.appendTo(h);var c=a("input[name=maintag]:checked","#combinetags_form").val();a("<input type='hidden'/>").attr("name","maintag").attr("value",c).appendTo(h),h.submit()}),b.getRoot().on(g.hidden,function(){b.destroy()}),b.show(),a("#combinetags_form input[type=radio]").first().focus().prop("checked",!0)})["catch"](d.exception)}),a("body").on("updatefailed","[data-inplaceeditable][data-itemtype=tagname]",function(b){var c=b.exception,f=b.newvalue,g=a(b.target).attr("data-itemid");"namesalreadybeeingused"===c.errorcode&&(b.preventDefault(),e.get_strings([{key:"nameuseddocombine",component:"tag"},{key:"yes"},{key:"cancel"}]).done(function(a){d.confirm(b.message,a[0],a[1],a[2],function(){window.location.href=window.location.href+"&newname="+encodeURIComponent(f)+"&tagid="+encodeURIComponent(g)+"&action=renamecombine&sesskey="+M.cfg.sesskey})}))}),a("body").on("click","a[data-action=addstandardtag]",function(b){b.preventDefault();var h="";e.get_strings([{key:"addotags",component:"tag"},{key:"continue"}]).then(function(a){var b=a[0];h=a[1];var d={actionurl:window.location.href,sesskey:M.cfg.sesskey};return f.create({title:b,body:c.render("core_tag/add_tags",d),type:f.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(h),b.getRoot().on(g.save,function(b){var c=a(b.currentTarget).find("#id_tagslist"),d=c.val().trim();c.val(d);var e=a("#addtags_form");return e.on("submit",function(b){var c=a("#addtags_form");c[0].checkValidity()===!1&&(b.preventDefault(),b.stopPropagation()),c.addClass("was-validated"),a('[data-region="tagslistinput"]').addClass("error");var d=a("#id_tagslist_error_message");d.removeAttr("hidden"),d.addClass("help-block")}),e.submit(),!1}),b.getRoot().on(g.hidden,function(){b.destroy()}),b.show()})["catch"](d.exception)})},initManageCollectionsPage:function(){a("body").on("updated","[data-inplaceeditable]",function(b){var c,d,e,f=b.ajaxreturn;"core_tag"===f.component&&"tagareaenable"===f.itemtype&&(c=a(this).attr("data-itemid"),a(".tag-collections-table ul[data-collectionid] li[data-areaid="+c+"]").hide(),e=f.value,"1"===e?(a(this).closest("tr").removeClass("dimmed_text"),d=a(this).closest("tr").find('[data-itemtype="tagareacollection"]').attr("data-value"),a(".tag-collections-table ul[data-collectionid="+d+"] li[data-areaid="+c+"]").show()):a(this).closest("tr").addClass("dimmed_text")),"core_tag"===f.component&&"tagareacollection"===f.itemtype&&(c=a(this).attr("data-itemid"),a(".tag-collections-table ul[data-collectionid] li[data-areaid="+c+"]").hide(),d=a(this).attr("data-value"),e=a(this).closest("tr").find('[data-itemtype="tagareaenable"]').attr("data-value"),"1"===e&&a(".tag-collections-table ul[data-collectionid="+d+"] li[data-areaid="+c+"]").show())}),a("body").on("click",".addtagcoll > a",function(b){b.preventDefault();var h=[{key:"addtagcoll",component:"tag"},{key:"create"}],i=a(this).attr("data-url"),j="";e.get_strings(h).then(function(a){var b=a[0];j=a[1];var d={actionurl:i,sesskey:M.cfg.sesskey};return f.create({title:b,body:c.render("core_tag/add_tag_collection",d),type:f.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(j),b.getRoot().on(g.save,function(b){var c=a(b.currentTarget).find("#addtagcoll_name"),d=c.val().trim();c.val(d);var e=a("#addtagcoll_form");return e.on("submit",function(b){e[0].checkValidity()===!1&&(b.preventDefault(),b.stopPropagation()),e.addClass("was-validated"),a('[data-region="addtagcoll_nameinput"]').addClass("error");var c=a("#id_addtagcoll_name_error_message");c.removeAttr("hidden"),c.addClass("help-block")}),e.submit(),!1}),b.getRoot().on(g.hidden,function(){b.destroy()}),b.show()})["catch"](d.exception)}),a("body").on("click",".tag-collections-table .action_delete",function(b){b.preventDefault();var c=a(this).attr("data-url")+"&sesskey="+M.cfg.sesskey;e.get_strings([{key:"delete"},{key:"suredeletecoll",component:"tag",param:a(this).attr("data-collname")},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location.href=c})})})}}});
define('core/url', ["jquery","core/config"],function(a,b){return{fileUrl:function(a,c){var d=b.wwwroot+a;return"/"!=c.charAt(0)&&(c="/"+c),d+=b.slasharguments?c:"?file="+encodeURIComponent(c)},relativeUrl:function(c,d,e){if(0===c.indexOf("http:")||0===c.indexOf("https:")||c.indexOf("://")>=0)throw new Error("relativeUrl function does not accept absolute urls");"/"!=c.charAt(0)&&(c="/"+c),"admin"!==b.admin&&(c=c.replace(/^\/admin\//,"/"+b.admin+"/")),d=d||{},e&&(d.sesskey=b.sesskey);var f="";return Object.keys(d).length&&(f=a.map(d,function(a,b){return b+"="+a}).join("&")),""!==f?b.wwwroot+c+"?"+f:b.wwwroot+c},imageUrl:function(a,b){return M.util.image_url(a,b)}}});
!function(a,b){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?b(exports):"function"==typeof define&&define.amd?define('core/mustache', ["exports"],b):(a.Mustache={},b(a.Mustache))}(this,function(a){function b(a){return"function"==typeof a}function c(a){return p(a)?"array":typeof a}function d(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a,b){return null!=a&&"object"==typeof a&&b in a}function f(a,b){return q.call(a,b)}function g(a){return!f(r,a)}function h(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return s[a]})}function i(b,c){function e(){if(r&&!s)for(;q.length;)delete o[q.pop()];else q=[];r=!1,s=!1}function f(a){if("string"==typeof a&&(a=a.split(u,2)),!p(a)||2!==a.length)throw new Error("Invalid tags: "+a);h=new RegExp(d(a[0])+"\\s*"),i=new RegExp("\\s*"+d(a[1])),m=new RegExp("\\s*"+d("}"+a[1]))}if(!b)return[];var h,i,m,n=[],o=[],q=[],r=!1,s=!1;f(c||a.tags);for(var y,z,A,B,C,D,E=new l(b);!E.eos();){if(y=E.pos,A=E.scanUntil(h))for(var F=0,G=A.length;F<G;++F)B=A.charAt(F),g(B)?q.push(o.length):s=!0,o.push(["text",B,y,y+1]),y+=1,"\n"===B&&e();if(!E.scan(h))break;if(r=!0,z=E.scan(x)||"name",E.scan(t),"="===z?(A=E.scanUntil(v),E.scan(v),E.scanUntil(i)):"{"===z?(A=E.scanUntil(m),E.scan(w),E.scanUntil(i),z="&"):A=E.scanUntil(i),!E.scan(i))throw new Error("Unclosed tag at "+E.pos);if(C=[z,A,y,E.pos],o.push(C),"#"===z||"^"===z||"$"===z||"<"===z)n.push(C);else if("/"===z){if(D=n.pop(),!D)throw new Error('Unopened section "'+A+'" at '+y);if(D[1]!==A)throw new Error('Unclosed section "'+D[1]+'" at '+y)}else"name"===z||"{"===z||"&"===z?s=!0:"="===z&&f(A)}if(D=n.pop())throw new Error('Unclosed section "'+D[1]+'" at '+E.pos);return k(j(o))}function j(a){for(var b,c,d=[],e=0,f=a.length;e<f;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function k(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;g<h;++g)switch(b=a[g],b[0]){case"$":case"<":case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function l(a){this.string=a,this.tail=a,this.pos=0}function m(a,b){this.view=a,this.blocks={},this.cache={".":this.view},this.parent=b}function n(){this.cache={}}var o=Object.prototype.toString,p=Array.isArray||function(a){return"[object Array]"===o.call(a)},q=RegExp.prototype.test,r=/\S/,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},t=/\s*/,u=/\s+/,v=/\s*=/,w=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!|\$|</;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},l.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},m.prototype.push=function(a){return new m(a,this)},m.prototype.setBlockVar=function(a,b){var c=this.blocks;return c[a]=b,b},m.prototype.clearBlockVars=function(){this.blocks={}},m.prototype.getBlockVar=function(a){var b,c=this.blocks;return c.hasOwnProperty(a)?b=c[a]:this.parent&&(b=this.parent.getBlockVar(a)),b},m.prototype.lookup=function(a){var c,d=this.cache;if(d.hasOwnProperty(a))c=d[a];else{for(var f,g,h=this,i=!1;h;){if(a.indexOf(".")>0)for(c=h.view,f=a.split("."),g=0;null!=c&&g<f.length;)g===f.length-1&&(i=e(c,f[g])),c=c[f[g++]];else c=h.view[a],i=e(h.view,a);if(i)break;h=h.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},n.prototype.clearCache=function(){this.cache={}},n.prototype.parse=function(b,c){var d=this.cache,e=d[b];return null==e&&(e=d[b+":"+(c||a.tags).join(":")]=i(b,c)),e},n.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof m?b:new m(b);return this.renderTokens(d,e,c,a)},n.prototype.renderTokens=function(a,b,c,d){for(var e,f,g,h="",i=0,j=a.length;i<j;++i)g=void 0,e=a[i],f=e[0],"#"===f?g=this.renderSection(e,b,c,d):"^"===f?g=this.renderInverted(e,b,c,d):">"===f?g=this.renderPartial(e,b,c,d):"<"===f?g=this.renderBlock(e,b,c,d):"$"===f?g=this.renderBlockVariable(e,b,c,d):"&"===f?g=this.unescapedValue(e,b):"name"===f?g=this.escapedValue(e,b):"text"===f&&(g=this.rawValue(e)),void 0!==g&&(h+=g);return h},n.prototype.renderSection=function(a,c,d,e){function f(a){return g.render(a,c,d)}var g=this,h="",i=c.lookup(a[1]);if(i){if(p(i))for(var j=0,k=i.length;j<k;++j)h+=this.renderTokens(a[4],c.push(i[j]),d,e);else if("object"==typeof i||"string"==typeof i||"number"==typeof i)h+=this.renderTokens(a[4],c.push(i),d,e);else if(b(i)){if("string"!=typeof e)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,e.slice(a[3],a[5]),f),null!=i&&(h+=i)}else h+=this.renderTokens(a[4],c,d,e);return h}},n.prototype.renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);if(!e||p(e)&&0===e.length)return this.renderTokens(a[4],b,c,d)},n.prototype.renderPartial=function(a,c,d){if(d){var e=b(d)?d(a[1]):d[a[1]];return null!=e?this.renderTokens(this.parse(e),c,d,e):void 0}},n.prototype.renderBlock=function(a,c,d,e){if(d){var f=b(d)?d(a[1]):d[a[1]];null!=f&&c.clearBlockVars(),this.renderTokens(a[4],c,d,e);var g=this.renderTokens(this.parse(f),c,d,f);return c.clearBlockVars(),g}},n.prototype.renderBlockVariable=function(a,b,c,d){var e=a[1],f=b.getBlockVar(e);return f?this.renderTokens(this.parse(f),b,c,f):(b.setBlockVar(e,d.slice(a[3],a[5])),this.renderTokens(a[4],b,c,d))},n.prototype.unescapedValue=function(a,b){var c=b.lookup(a[1]);if(null!=c)return c},n.prototype.escapedValue=function(b,c){var d=c.lookup(b[1]);if(null!=d)return a.escape(d)},n.prototype.rawValue=function(a){return a[1]},a.name="mustache.js",a.version="2.3.0",a.tags=["{{","}}"];var y=new n;return a.clearCache=function(){return y.clearCache()},a.parse=function(a,b){return y.parse(a,b)},a.render=function(a,b,d){if("string"!=typeof a)throw new TypeError('Invalid template! Template should be a "string" but "'+c(a)+'" was given as the first argument for mustache#render(template, view, partials)');return y.render(a,b,d)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);return b(f)?void f(g):g},a.escape=h,a.Scanner=l,a.Context=m,a.Writer=n,a});
define('core/chart_axis', [],function(){function a(){}return a.prototype.POS_DEFAULT=null,a.prototype.POS_BOTTOM="bottom",a.prototype.POS_LEFT="left",a.prototype.POS_RIGHT="right",a.prototype.POS_TOP="top",a.prototype._label=null,a.prototype._labels=null,a.prototype._max=null,a.prototype._min=null,a.prototype._position=null,a.prototype._stepSize=null,a.prototype.create=function(b){var c=new a;return c.setPosition(b.position),c.setLabel(b.label),c.setStepSize(b.stepSize),c.setMax(b.max),c.setMin(b.min),c.setLabels(b.labels),c},a.prototype.getLabel=function(){return this._label},a.prototype.getLabels=function(){return this._labels},a.prototype.getMax=function(){return this._max},a.prototype.getMin=function(){return this._min},a.prototype.getPosition=function(){return this._position},a.prototype.getStepSize=function(){return this._stepSize},a.prototype.setLabel=function(a){this._label=a||null},a.prototype.setLabels=function(a){this._labels=a||null,null===this._labels||null!==this._stepSize||null!==this._min&&0!==this._min||null!==this._max||(this.setStepSize(1),this.setMin(0),this.setMax(a.length-1))},a.prototype.setMax=function(a){this._max="undefined"!=typeof a?a:null},a.prototype.setMin=function(a){this._min="undefined"!=typeof a?a:null},a.prototype.setPosition=function(a){if(a!=this.POS_DEFAULT&&a!=this.POS_BOTTOM&&a!=this.POS_LEFT&&a!=this.POS_RIGHT&&a!=this.POS_TOP)throw new Error("Invalid axis position.");this._position=a},a.prototype.setStepSize=function(a){if("undefined"==typeof a||null===a)a=null;else{if(isNaN(Number(a)))throw new Error("Value for stepSize is not a number.");a=Number(a)}this._stepSize=a},a});
define('core/log', ["core/loglevel"],function(a){var b=a.methodFactory;return a.methodFactory=function(a,c){var d=b(a,c);return function(a,b){d(b?b+": "+a:a)}},a.setConfig=function(b){"undefined"!=typeof b.level&&a.setLevel(b.level)},a});
define('core/first', ["jquery"],function(a){a(document).bind("ajaxStart",function(){M.util.js_pending("jq")}).bind("ajaxStop",function(){M.util.js_complete("jq")})});
define('core/pubsub', ["core/pending"],function(a){var b={},c=function(a,c){b[a]=b[a]||[],b[a].push(c)},d=function(a,c){if(b[a])for(var d=0;d<b[a].length;d++)if(b[a][d]===c){b[a].splice(d,1);break}},e=function(c,d){var e=new a("Publishing "+c);b[c]&&b[c].forEach(function(a){a(d)}),e.resolve()};return{subscribe:c,unsubscribe:d,publish:e}});
define('core/paged_content_paging_bar_limit_selector', ["jquery","core/custom_interaction_events","core/paged_content_events","core/pubsub"],function(a,b,c,d){var e={ROOT:'[data-region="paging-control-limit-container"]',LIMIT_OPTION:"[data-limit]",LIMIT_TOGGLE:'[data-action="limit-toggle"]'},f=function(f,g){f=a(f),b.define(f,[b.events.activate]),f.on(b.events.activate,e.LIMIT_OPTION,function(b,f){var h=a(b.target).closest(e.LIMIT_OPTION);if(!h.hasClass("active")){var i=parseInt(h.attr("data-limit"),10);d.publish(g+c.SET_ITEMS_PER_PAGE_LIMIT,i),f.originalEvent.preventDefault()}})};return{init:f,rootSelector:e.ROOT}});
define('core/modal_cancel', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events"],function(a,b,c,d,e){var f={CANCEL_BUTTON:'[data-action="cancel"]'},g=function(a){d.call(this,a),this.getFooter().find(f.CANCEL_BUTTON).length||b.exception({message:"No cancel button found"})};return g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.setFooter=function(){b.exception({message:"Can not change the footer of a cancel modal"})},g.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,f.CANCEL_BUTTON,function(b,c){var d=a.Event(e.cancel);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},g});
define('core/fragment', ["jquery","core/ajax"],function(a,b){var c=function(a,c,d,e){var f=[];for(var g in e)f.push({name:g,value:e[g]});return b.call([{methodname:"core_get_fragment",args:{component:a,callback:c,contextid:d,args:f}}])[0]};return{loadFragment:function(b,d,e,f){var g=a.Deferred();return c(b,d,e,f).then(function(b){var c=a(b.javascript),d="";c.each(function(b,c){c=a(c);var e=c.prop("tagName");if(e&&"script"==e.toLowerCase())if(c.attr("src")){var f=!1;a("script").each(function(b,d){return a(d).attr("src")==c.attr("src")&&(f=!0),!f}),f||(d+=" { ",d+=' node = document.createElement("script"); ',d+=' node.type = "text/javascript"; ',d+=' node.src = decodeURI("'+encodeURI(c.attr("src"))+'"); ',d+=' document.getElementsByTagName("head")[0].appendChild(node); ',d+=" } ")}else d+=" "+c.text()}),g.resolve(b.html,d)}).fail(function(a){g.reject(a)}),g.promise()}}});
define('core/addblockmodal', ["jquery","core/modal_factory","core/templates","core/str","core/notification"],function(a,b,c,d,e){return{init:function(f){var g=a("[data-key=addblock]"),h=f.blocks.map(function(a){return{key:"pluginname",component:"block_"+a}}),i=d.get_strings(h).then(function(a){return a.map(function(a,b){return{name:f.blocks[b],title:a}})}).then(function(a){return f.blocks=a,c.render("core/add_block_body",f)}).fail(e.exception),j=d.get_string("addblock").fail(e.exception);b.create({title:j,body:i,type:"CANCEL"},g)}}});
define('core/chart_line', ["core/chart_base"],function(a){function b(){a.prototype.constructor.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.TYPE="line",b.prototype._smooth=!1,b.prototype.create=function(b,c){var d=a.prototype.create.apply(this,arguments);return d.setSmooth(c.smooth),d},b.prototype.getSmooth=function(){return this._smooth},b.prototype.setSmooth=function(a){this._smooth=Boolean(a)},b});
define('core/event', ["jquery","core/yui"],function(a,b){return{Events:{FORM_FIELD_VALIDATION:"core_form-field-validation"},getLegacyEvents:function(){var c=a.Deferred();return b.use("event","moodle-core-event",function(){c.resolve(window.M.core.event)}),c.promise()},notifyFilterContentUpdated:function(c){c=a(c),b.use("event","moodle-core-event",function(b){a(document).trigger(M.core.event.FILTER_CONTENT_UPDATED,[c]);var d=new b.NodeList(c.get());b.fire(M.core.event.FILTER_CONTENT_UPDATED,{nodes:d})})},notifyEditorContentRestored:function(){b.use("event","moodle-core-event",function(b){a(document).trigger(M.core.event.EDITOR_CONTENT_RESTORED),b.fire(M.core.event.EDITOR_CONTENT_RESTORED)})}}});
define('core/tooltip', ["jquery"],function(a){var b=function(b){this._regionSelector=b,a(this._regionSelector).each(function(b,c){var d=a(c).attr("aria-describedby");if(d){var e=document.getElementById(d);if(e){var f="tooltip"==a(e).attr("role");f&&(a(e).hide(),a(c).attr("tabindex","0")),a(c).on("focus",this._handleFocus.bind(this)),a(c).on("mouseover",this._handleMouseOver.bind(this)),a(c).on("mouseout",this._handleMouseOut.bind(this)),a(c).on("blur",this._handleBlur.bind(this)),a(c).on("keydown",this._handleKeyDown.bind(this))}}}.bind(this))};return b.prototype._regionSelector=null,b.prototype._showTooltip=function(b){var c=a(b.target),d=c.attr("aria-describedby");if(d){var e=a(document.getElementById(d));if(e.show(),e.attr("aria-hidden","false"),!e.is(".tooltip")){var f=a('<div class="tooltip-inner"></div>');f.append(e.contents()),e.append(f),e.addClass("tooltip"),e.addClass("bottom"),e.append('<div class="tooltip-arrow"></div>')}var g=c.offset();g.top+=c.height()+10,a(e).offset(g)}},b.prototype._hideTooltip=function(b){var c=a(b.target),d=c.attr("aria-describedby");if(d){var e=document.getElementById(d);a(e).hide(),a(e).attr("aria-hidden","true")}},b.prototype._handleFocus=function(a){this._showTooltip(a)},b.prototype._handleKeyDown=function(a){27==a.which&&this._hideTooltip(a)},b.prototype._handleMouseOver=function(a){this._showTooltip(a)},b.prototype._handleMouseOut=function(b){var c=a(b.target);c.is(":focus")||this._hideTooltip(b)},b.prototype._handleBlur=function(a){this._hideTooltip(a)},b});
define('core/modal_confirm', ["jquery","core/custom_interaction_events","core/modal_events","core/modal_save_cancel","core/log"],function(a,b,c,d,e){var f=function(a){e.warn("The CONFIRM modal type has been deprecated and should not be used anymore. Please use the SAVE_CANCEL modal type instead."),d.call(this,a)};return f.prototype=Object.create(d.prototype),f.prototype.constructor=f,f});
define('core/str', ["jquery","core/ajax","core/localstorage"],function(a,b,c){var d=[];return{get_string:function(a,b,c,d){var e=this.get_strings([{key:a,component:b,param:c,lang:d}]);return e.then(function(a){return a[0]})},get_strings:function(e){var f,g=a.Deferred(),h=[],i=0,j=!1;for(i=0;i<e.length;i++)if(f=e[i],"undefined"==typeof f.lang&&(f.lang=a("html").attr("lang").replace(/-/g,"_")),f.cacheKey="core_str/"+f.key+"/"+f.component+"/"+f.lang,"undefined"==typeof M.str[f.component]||"undefined"==typeof M.str[f.component][f.key]){var k=c.get(f.cacheKey);k?("undefined"==typeof M.str[f.component]&&(M.str[f.component]=[]),M.str[f.component][f.key]=k):j=!0}if(j){var l=[],m=[],n=function(a){this.resolve(a)},o=function(a){this.reject(a)};for(i=0;i<e.length;i++)if(f=e[i],"undefined"!=typeof d[f.cacheKey])m.push(d[f.cacheKey]);else{var p=a.Deferred();l.push({methodname:"core_get_string",args:{stringid:f.key,component:f.component,lang:f.lang,stringparams:[]},done:n.bind(p),fail:o.bind(p)}),d[f.cacheKey]=p.promise(),m.push(d[f.cacheKey])}l.length>0&&b.call(l,!0,!1),a.when.apply(null,m).done(function(){var a=0;for(a=0;a<arguments.length;a++)f=e[a],"undefined"==typeof M.str[f.component]&&(M.str[f.component]=[]),M.str[f.component][f.key]=arguments[a],c.set("core_str/"+f.key+"/"+f.component+"/"+f.lang,arguments[a]),h[a]=M.util.get_string(f.key,f.component,f.param).trim();g.resolve(h)}).fail(function(a){g.reject(a)})}else{for(i=0;i<e.length;i++)f=e[i],h[i]=M.util.get_string(f.key,f.component,f.param);g.resolve(h)}return g.promise()}}});
define('core_calendar/selectors', [],function(){return{eventFilterItem:"[data-action='filter-event-type']",eventType:{site:"[data-eventtype-site]",category:"[data-eventtype-category]",course:"[data-eventtype-course]",group:"[data-eventtype-group]",user:"[data-eventtype-user]"},popoverType:{site:"[data-popover-eventtype-site]",category:"[data-popover-eventtype-category]",course:"[data-popover-eventtype-course]",group:"[data-popover-eventtype-group]",user:"[data-popover-eventtype-user]"},calendarPeriods:{month:"[data-period='month']"},courseSelector:'select[name="course"]',actions:{create:'[data-action="new-event-button"]',edit:'[data-action="edit"]',remove:'[data-action="delete"]',viewEvent:'[data-action="view-event"]'},elements:{courseSelector:'select[name="course"]'},today:".today",day:'[data-region="day"]',wrapper:".calendarwrapper",eventItem:'[data-type="event"]',links:{navLink:".calendarwrapper .arrow_link",eventLink:"[data-region='event-item']"},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}});
define('core_calendar/calendar_threemonth', ["jquery","core/notification","core_calendar/selectors","core_calendar/events","core/templates","core_calendar/view_manager"],function(a,b,c,d,e,f){var g=function(e){var g=a("body");g.on(d.monthChanged,function(a,c,d,f,g){e.queue(function(e){return h(a,c,d,f,g).then(function(){return e()}).fail(b.exception)})});var h=function(b,d,g,h,i){var j=e.find('[data-year="'+d+'"][data-month="'+g+'"]'),k=j.closest(c.calendarPeriods.month),l=e.find(c.calendarPeriods.month),m=a(l[0]),n=a(l[2]),o=a("<span>");o.attr("data-template","core_calendar/threemonth_month"),o.attr("data-includenavigation",!1),o.attr("data-mini",!0);var p=a("<div>");p.hide(),p.append(o);var q,r,s;return k.is(m)?(p.insertBefore(m),q=m.data("previousYear"),r=m.data("previousMonth"),s=n):k.is(n)&&(p.insertAfter(n),q=n.data("nextYear"),r=n.data("nextMonth"),s=m),f.refreshMonthContent(o,q,r,h,i,o).then(function(){var b=a.Deferred(),c=a.Deferred();return s.slideUp("fast",function(){a(this).remove(),b.resolve()}),p.slideDown("fast",function(){c.resolve()}),a.when(b,c)})}};return{init:function(b){b=a(b),g(b)}}});
define('core_calendar/crud', ["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/modal_event_form","core_calendar/repository","core_calendar/events","core_calendar/modal_delete","core_calendar/selectors"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(d,e,f){var i=[{key:"deleteevent",component:"calendar"}];f=parseInt(f,10);var m,n=f>1;n?(i.push({key:"confirmeventseriesdelete",component:"calendar",param:{name:e,count:f}}),m=g.create({type:l.TYPE})):(i.push({key:"confirmeventdelete",component:"calendar",param:e}),m=g.create({type:g.types.SAVE_CANCEL})),m.then(function(a){a.show()}).fail(c.exception);var o=b.get_strings(i),p=a.when(o,m).then(function(b,e){return e.setTitle(b[0]),e.setBody(b[1]),n||e.setSaveButtonText(b[0]),e.getRoot().on(h.save,function(){j.deleteEvent(d,!1).then(function(){a("body").trigger(k.deleted,[d,!1])})["catch"](c.exception)}),e.getRoot().on(k.deleteAll,function(){j.deleteEvent(d,!0).then(function(){a("body").trigger(k.deleted,[d,!0])})["catch"](c.exception)}),e}).fail(c.exception);return p}function o(b){b.on("click",m.actions.remove,function(b){var c=a(this).closest(m.eventItem),d=c.data("eventId"),e=c.data("eventTitle"),f=c.data("eventCount");n(d,e,f),b.preventDefault()})}function p(b,d){return d.then(function(c){a("body").on(k.editEvent,function(a,d){var e=b.find(m.wrapper);c.setEventId(d),c.setContextId(e.data("contextId")),c.show(),a.stopImmediatePropagation()})}).fail(c.exception),d}var q=function(b){var d=g.create({type:i.TYPE,large:!0});return b.on("click",m.actions.create,function(a){d.then(function(a){var c=b.find(m.wrapper),d=c.data("categoryid");"undefined"!=typeof d&&a.setCategoryId(d);var e=b.find(m.today),f=b.find(m.day);!e.length&&f.length&&a.setStartTime(f.data("newEventTimestamp")),a.setContextId(c.data("contextId")),a.setCourseId(c.data("courseid")),a.show()}).fail(c.exception),a.preventDefault()}),b.on("click",m.actions.edit,function(b){b.preventDefault();var e=a(b.currentTarget),f=e.closest(m.wrapper),g=e.closest(m.eventItem);d.then(function(a){a.setEventId(g.data("eventId")),a.setContextId(f.data("contextId")),a.show(),b.stopImmediatePropagation()}).fail(c.exception)}),d};return{registerRemove:o,registerEditListeners:p,registerEventFormModal:q}});
define('core_calendar/events', [],function(){return{created:"calendar-events:created",deleted:"calendar-events:deleted",deleteAll:"calendar-events:delete_all",updated:"calendar-events:updated",editEvent:"calendar-events:edit_event",editActionEvent:"calendar-events:edit_action_event",eventMoved:"calendar-events:event_moved",dayChanged:"calendar-events:day_changed",monthChanged:"calendar-events:month_changed",moveEvent:"calendar-events:move_event",filterChanged:"calendar-events:filter_changed",viewUpdated:"calendar-events:view_updated"}});
define('core_calendar/modal_delete', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events","core/modal_registry","core_calendar/events"],function(a,b,c,d,e,f,g){var h=!1,i={DELETE_ONE_BUTTON:'[data-action="deleteone"]',DELETE_ALL_BUTTON:'[data-action="deleteall"]',CANCEL_BUTTON:'[data-action="cancel"]'},j=function(a){d.call(this,a)};return j.TYPE="core_calendar-modal_delete",j.prototype=Object.create(d.prototype),j.prototype.constructor=j,j.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,i.DELETE_ONE_BUTTON,function(b,c){var d=a.Event(e.save);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,i.DELETE_ALL_BUTTON,function(b,c){var d=a.Event(g.deleteAll);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,i.CANCEL_BUTTON,function(b,c){var d=a.Event(e.cancel);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},h||(f.register(j.TYPE,j,"calendar/event_delete_modal"),h=!0),j});
define('core_calendar/calendar_filter', ["jquery","core_calendar/selectors","core_calendar/events","core/str","core/templates"],function(a,b,c,d,e){var f=function(d){d.on("click",b.eventFilterItem,function(b){var c=a(b.currentTarget);g(c),b.preventDefault()}),a("body").on(c.viewUpdated,function(){var c=d.find(b.eventFilterItem);c.each(function(b,c){if(c=a(c),c.data("eventtype-hidden")){var d=i(c);h(d)}})})},g=function(a){var b=i(a);return b.hidden=!b.hidden,d.get_string("eventtype"+b.eventtype,"calendar").then(function(a){return b.name=a,b.icon=!0,b.key="i/"+b.eventtype+"event",b.component="core",b}).then(function(a){return e.render("core_calendar/event_filter_key",a)}).then(function(b,c){return e.replaceNode(a,b,c)}).then(function(){h(b)})},h=function(b){M.util.js_pending("month-mini-filterChanged"),a("body").trigger(c.filterChanged,{type:b.eventtype,hidden:b.hidden}),M.util.js_complete("month-mini-filterChanged")},i=function(a){return{eventtype:a.data("eventtype"),hidden:a.data("eventtype-hidden")}};return{init:function(b){b=a(b),f(b)}}});
define('core_calendar/modal_event_form', ["jquery","core/event","core/str","core/notification","core/templates","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment","core_calendar/events","core_calendar/repository"],function(a,b,c,d,e,f,g,h,i,j,k){var l=!1,m={SAVE_BUTTON:'[data-action="save"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]'},n=function(a){g.call(this,a),this.eventId=null,this.startTime=null,this.courseId=null,this.categoryId=null,this.contextId=null,this.reloadingBody=!1,this.reloadingTitle=!1,this.saveButton=this.getFooter().find(m.SAVE_BUTTON)};return n.TYPE="core_calendar-modal_event_form",n.prototype=Object.create(g.prototype),n.prototype.constructor=n,n.prototype.setContextId=function(a){this.contextId=a},n.prototype.getContextId=function(){return this.contextId},n.prototype.setCourseId=function(a){this.courseId=a},n.prototype.getCourseId=function(){return this.courseId},n.prototype.setCategoryId=function(a){this.categoryId=a},n.prototype.getCategoryId=function(){return this.categoryId},n.prototype.hasCourseId=function(){return null!==this.courseId},n.prototype.hasCategoryId=function(){return null!==this.categoryId},n.prototype.setEventId=function(a){this.eventId=a},n.prototype.getEventId=function(){return this.eventId},n.prototype.hasEventId=function(){return null!==this.eventId},n.prototype.setStartTime=function(a){this.startTime=a},n.prototype.getStartTime=function(){return this.startTime},n.prototype.hasStartTime=function(){return null!==this.startTime},n.prototype.getForm=function(){return this.getBody().find("form")},n.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0)},n.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1)},n.prototype.reloadTitleContent=function(){return this.reloadingTitle?this.titlePromise:(this.reloadingTitle=!0,this.hasEventId()?this.titlePromise=c.get_string("editevent","calendar"):this.titlePromise=c.get_string("newevent","calendar"),this.titlePromise.then(function(a){return this.setTitle(a),a}.bind(this)).always(function(){this.reloadingTitle=!1}.bind(this)).fail(d.exception),this.titlePromise)},n.prototype.reloadBodyContent=function(a){if(this.reloadingBody)return this.bodyPromise;this.reloadingBody=!0,this.disableButtons();var b={};return this.hasEventId()&&(b.eventid=this.getEventId()),this.hasStartTime()&&(b.starttime=this.getStartTime()),this.hasCourseId()&&(b.courseid=this.getCourseId()),this.hasCategoryId()&&(b.categoryid=this.getCategoryId()),"undefined"!=typeof a&&(b.formdata=a),this.bodyPromise=i.loadFragment("calendar","event_form",this.getContextId(),b),this.setBody(this.bodyPromise),this.bodyPromise.then(function(){this.enableButtons()}.bind(this)).fail(d.exception).always(function(){this.reloadingBody=!1}.bind(this)).fail(d.exception),this.bodyPromise},n.prototype.reloadAllContent=function(){return a.when(this.reloadTitleContent(),this.reloadBodyContent())},n.prototype.show=function(){this.reloadAllContent(),g.prototype.show.call(this)},n.prototype.hide=function(){g.prototype.hide.call(this),this.setEventId(null),this.setStartTime(null),this.setCourseId(null),this.setCategoryId(null)},n.prototype.getFormData=function(){return this.getForm().serialize()},n.prototype.save=function(){var b=this.saveButton.find(m.LOADING_ICON_CONTAINER);b.removeClass("hidden"),this.disableButtons();var c=this.getFormData();return k.submitCreateUpdateForm(c).then(function(b){if(b.validationerror)return void this.reloadBodyContent(c);var d=this.hasEventId();this.hide(),d?a("body").trigger(j.updated,[b.event]):a("body").trigger(j.created,[b.event])}.bind(this)).always(function(){b.addClass("hidden"),this.enableButtons()}.bind(this)).fail(d.exception)},n.prototype.registerEventListeners=function(){g.prototype.registerEventListeners.call(this),this.getModal().on(f.events.activate,m.SAVE_BUTTON,function(a,b){this.getForm().submit(),b.originalEvent.preventDefault(),a.stopPropagation()}.bind(this)),this.getModal().on("submit",function(a){this.save(),a.preventDefault(),a.stopPropagation()}.bind(this))},l||(h.register(n.TYPE,n,"calendar/modal_event_form"),l=!0),n});
define('core_calendar/drag_drop_data_store', [],function(){var a=null,b=null,c=null,d=null,e=null,f=null,g=function(b){a=b},h=function(){return a},i=function(){return null!==a},j=function(a){b=a},k=function(){return b},l=function(a){c=a},m=function(){return c},n=function(){return null!==c},o=function(a){d=a},p=function(){return d},q=function(){return null!==d},r=function(a){e=a},s=function(){return e},t=function(a){f=a},u=function(){return f},v=function(){g(null),j(null),l(null),o(null),r(null),t(null)};return{setEventId:g,getEventId:h,hasEventId:i,setDurationDays:j,getDurationDays:k,setMinTimestart:l,getMinTimestart:m,hasMinTimestart:n,setMaxTimestart:o,getMaxTimestart:p,hasMaxTimestart:q,setMinError:r,getMinError:s,setMaxError:t,getMaxError:u,clearAll:v}});
define('core_calendar/calendar_mini', ["jquery","core_calendar/selectors","core_calendar/events","core_calendar/view_manager"],function(a,b,c,d){var e=function(b){var d=a("body"),e="."+b.attr("id");d.on(c.created+e,b,f),d.on(c.deleted+e,b,f),d.on(c.updated+e,b,f),d.on(c.eventMoved+e,b,f)},f=function(b){var e=b.data,f=a("body"),g="."+e.attr("id");e.is(":visible")?d.reloadCurrentMonth(e):(f.off(c.created+g),f.off(c.deleted+g),f.off(c.updated+g),f.off(c.eventMoved+g))},g=function(e){a("body").on(c.filterChanged,function(a,c){var d=e.find(b.eventType[c.type]);d.toggleClass("calendar_event_"+c.type,!c.hidden)});var f="."+e.attr("id");a("body").on("change"+f,b.elements.courseSelector,function(){if(e.is(":visible")){var b=a(this),c=b.val(),g=null;d.reloadCurrentMonth(e,c,g)}else a("body").off("change"+f)})};return{init:function(b,c){b=a(b),d.init(b),g(b),e(b),c&&d.reloadCurrentMonth(b)}}});
define('core_calendar/summary_modal', ["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/repository","core_calendar/events","core_calendar/crud"],function(a,b,c,d,e,f,g,h,i,j,k){var l=!1,m={ROOT:"[data-region='summary-modal-container']",EDIT_BUTTON:'[data-action="edit"]',DELETE_BUTTON:'[data-action="delete"]'},n=function(a){e.call(this,a)};return n.TYPE="core_calendar-event_summary",n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.getEditButton=function(){return"undefined"==typeof this.editButton&&(this.editButton=this.getFooter().find(m.EDIT_BUTTON)),this.editButton},n.prototype.getDeleteButton=function(){return"undefined"==typeof this.deleteButton&&(this.deleteButton=this.getFooter().find(m.DELETE_BUTTON)),this.deleteButton},n.prototype.getEventId=function(){return this.getBody().find(m.ROOT).attr("data-event-id")},n.prototype.getEventTitle=function(){return this.getBody().find(m.ROOT).attr("data-event-title")},n.prototype.getEventCount=function(){return this.getBody().find(m.ROOT).attr("data-event-count")},n.prototype.getEditUrl=function(){return this.getBody().find(m.ROOT).attr("data-edit-url")},n.prototype.isActionEvent=function(){return"true"==this.getBody().find(m.ROOT).attr("data-action-event")},n.prototype.registerEventListeners=function(){e.prototype.registerEventListeners.call(this),this.getRoot().on(h.bodyRendered,function(){this.getModal().data({eventTitle:this.getEventTitle(),eventId:this.getEventId(),eventCount:this.getEventCount()}).attr("data-type","event"),k.registerRemove(this.getModal())}.bind(this)),a("body").on(j.deleted,function(){this.hide()}.bind(this)),d.define(this.getEditButton(),[d.events.activate]),this.getEditButton().on(d.events.activate,function(b,c){this.isActionEvent()?a("body").trigger(j.editActionEvent,[this.getEditUrl()]):a("body").trigger(j.editEvent,[this.getEventId()]),this.hide(),b.preventDefault(),b.stopPropagation(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()}.bind(this))},l||(f.register(n.TYPE,n,"core_calendar/event_summary_modal"),l=!0),n});
define('core_calendar/repository', ["jquery","core/ajax"],function(a,b){var c=function(a,c){"undefined"==typeof c&&(c=!1);var d={methodname:"core_calendar_delete_calendar_events",args:{events:[{eventid:a,repeat:c}]}};return b.call([d])[0]},d=function(a){var c={methodname:"core_calendar_get_calendar_event_by_id",args:{eventid:a}};return b.call([c])[0]},e=function(a){var c={methodname:"core_calendar_submit_create_update_form",args:{formdata:a}};return b.call([c])[0]},f=function(a,c,d,e,f,g){var h={methodname:"core_calendar_get_calendar_monthly_view",args:{year:a,month:c,courseid:d,categoryid:e,includenavigation:f,mini:g}};return b.call([h])[0]},g=function(a,c,d,e,f){var g={methodname:"core_calendar_get_calendar_day_view",args:{year:a,month:c,day:d,courseid:e,categoryid:f}};return b.call([g])[0]},h=function(a,c){var d={methodname:"core_calendar_update_event_start_day",args:{eventid:a,daytimestamp:c}};return b.call([d])[0]},i=function(a,c){var d={methodname:"core_calendar_get_calendar_upcoming_view",args:{courseid:a,categoryid:c}};return b.call([d])[0]},j=function(a){var c={methodname:"core_group_get_course_groups",args:{courseid:a}};return b.call([c])[0]};return{getEventById:d,deleteEvent:c,updateEventStartDay:h,submitCreateUpdateForm:e,getCalendarMonthData:f,getCalendarDayData:g,getCalendarUpcomingData:i,getCourseGroupsData:j}});
define('core_calendar/calendar', ["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_events","core/modal_factory","core_calendar/modal_event_form","core_calendar/summary_modal","core_calendar/repository","core_calendar/events","core_calendar/view_manager","core_calendar/crud","core_calendar/selectors"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={ROOT:"[data-region='calendar']",DAY:"[data-region='day']",NEW_EVENT_BUTTON:"[data-action='new-event-button']",DAY_CONTENT:"[data-region='day-content']",LOADING_ICON:".loading-icon",VIEW_DAY_LINK:"[data-action='view-day-link']",CALENDAR_MONTH_WRAPPER:".calendarwrapper",TODAY:".today"},q=function(b,c,f,g){var h=null,i=g.attr("data-day-timestamp");f&&(h=f.attr("data-day-timestamp")),f&&h==i||d.render("core/loading",{}).then(function(a,b){g.find(p.DAY_CONTENT).addClass("hidden"),d.appendNodeContents(g,a,b),f&&(f.find(p.DAY_CONTENT).addClass("hidden"),d.appendNodeContents(f,a,b))}).then(function(){return k.updateEventStartDay(c,i)}).then(function(){a("body").trigger(l.eventMoved,[c,f,g])}).always(function(){var a=g.find(p.LOADING_ICON);if(g.find(p.DAY_CONTENT).removeClass("hidden"),d.replaceNode(a,"",""),f){var b=f.find(p.LOADING_ICON);f.find(p.DAY_CONTENT).removeClass("hidden"),d.replaceNode(b,"","")}}).fail(e.exception)},r=function(b,c){var d=a("body");d.on(l.created,function(){m.reloadCurrentMonth(b)}),d.on(l.deleted,function(){m.reloadCurrentMonth(b)}),d.on(l.updated,function(){m.reloadCurrentMonth(b)}),d.on(l.editActionEvent,function(a,b){window.location.assign(b)}),d.on(l.moveEvent,q),d.on(l.eventMoved,function(){m.reloadCurrentMonth(b)}),n.registerEditListeners(b,c)},s=function(b){b.on("change",o.elements.courseSelector,function(){var c=a(this),d=c.val();m.reloadCurrentMonth(b,d,null).then(function(){return b.find(o.elements.courseSelector).val(d)}).fail(e.exception)});var c=n.registerEventFormModal(b),d=a(p.CALENDAR_MONTH_WRAPPER).data("context-id");r(b,c),d&&b.on("click",p.DAY,function(b){var d=a(b.target);if(!d.is(p.VIEW_DAY_LINK)){var f=a(this).attr("data-new-event-timestamp");c.then(function(a){var b=d.closest(o.wrapper);a.setCourseId(b.data("courseid"));var c=b.data("categoryid");"undefined"!=typeof c&&a.setCategoryId(c),a.setContextId(b.data("contextId")),a.setStartTime(f),a.show()}).fail(e.exception),b.preventDefault()}})};return{init:function(b){b=a(b),m.init(b),s(b)}}});
define('core_calendar/view_manager', ["jquery","core/templates","core/str","core/notification","core_calendar/repository","core_calendar/events","core_calendar/selectors","core/modal_factory","core/modal_events","core_calendar/summary_modal"],function(a,b,c,d,e,f,g,h,i,j){var k=function(b){b=a(b),b.on("click",g.links.eventLink,function(b){var c,d=a(b.target),e=null;c=d.is(g.actions.viewEvent)?d:d.closest(g.actions.viewEvent),e=c.length?c.data("eventId"):d.find(g.actions.viewEvent).data("eventId"),e&&(b.preventDefault(),b.stopPropagation(),w(e))}),b.on("click",g.links.navLink,function(c){var d=b.find(g.wrapper),e=d.data("view"),f=d.data("courseid"),h=d.data("categoryid"),i=a(c.currentTarget);"month"===e?(m(b,i.attr("href"),i.data("year"),i.data("month"),f,h),c.preventDefault()):"day"===e&&(q(b,i.attr("href"),i.data("year"),i.data("month"),i.data("day"),f,h),c.preventDefault())})},l=function(c,h,i,j,k,l){r(c),l=l||c.find(g.wrapper),M.util.js_pending([c.get("id"),h,i,j].join("-"));var m=c.data("includenavigation"),n=c.data("mini");return e.getCalendarMonthData(h,i,j,k,m,n).then(function(a){return b.render(c.attr("data-template"),a)}).then(function(a,c){return b.replaceNode(l,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){return M.util.js_complete([c.get("id"),h,i,j].join("-")),s(c)}).fail(d.exception)},m=function(b,c,d,e,g,h){return l(b,d,e,g,h).then(function(){return c.length&&"#"!==c&&window.history.pushState({},"",c),arguments}).then(function(){return a("body").trigger(f.monthChanged,[d,e,g,h]),arguments})},n=function(a,b,c){var d=a.find(g.wrapper).data("year"),e=a.find(g.wrapper).data("month");return"undefined"==typeof b&&(b=a.find(g.wrapper).data("courseid")),"undefined"==typeof c&&(c=a.find(g.wrapper).data("categoryid")),l(a,d,e,b,c)},o=function(c,h,i,j,k,l,m){r(c),m=m||c.find(g.wrapper),M.util.js_pending([c.get("id"),h,i,j,k,l].join("-"));var n=c.data("includenavigation");return e.getCalendarDayData(h,i,j,k,l,n).then(function(a){return b.render(c.attr("data-template"),a)}).then(function(a,c){return b.replaceNode(m,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){return M.util.js_complete([c.get("id"),h,i,j,k,l].join("-")),s(c)}).fail(d.exception)},p=function(a,b,c){var d=a.find(g.wrapper),e=d.data("year"),f=d.data("month"),h=d.data("day");return b||(b=a.find(g.wrapper).data("courseid")),"undefined"==typeof c&&(c=a.find(g.wrapper).data("categoryid")),o(a,e,f,h,b,c)},q=function(b,c,d,e,g,h,i){return o(b,d,e,g,h,i).then(function(){return c.length&&"#"!==c&&window.history.pushState({},"",c),arguments}).then(function(){return a("body").trigger(f.dayChanged,[d,e,g,h,i]),arguments})},r=function(a){var b=a.find(g.containers.loadingIcon);b.removeClass("hidden")},s=function(a){var b=a.find(g.containers.loadingIcon);b.addClass("hidden")},t=function(c,h,i){r(c);var j=c.find(g.wrapper);return"undefined"==typeof h&&(h=c.find(g.wrapper).data("courseid")),"undefined"==typeof i&&(i=c.find(g.wrapper).data("categoryid")),e.getCalendarUpcomingData(h,i).then(function(a){return b.render(c.attr("data-template"),a)}).then(function(a,c){return b.replaceNode(j,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){return s(c)}).fail(d.exception)},u=function(a){switch(a){case"user":return"user";case"site":return"site";case"group":return"group";case"category":return"category";default:return"course"}},v=function(a){return"calendar_event_"+u(a)},w=function(a){var c="";e.getEventById(a).then(function(b){if(!b.event)throw new Error("Error encountered while trying to fetch calendar event with ID: "+a);var d=b.event;return c=v(d.eventtype),x(d.eventtype).then(function(a){return d.eventtype=a,d})}).then(function(a){var d={title:a.name,type:j.TYPE,body:b.render("core_calendar/event_summary_body",a),templateContext:{canedit:a.canedit,candelete:a.candelete,headerclasses:c,isactionevent:a.isactionevent,url:a.url}};return h.create(d)}).done(function(a){a.getRoot().on(i.hidden,function(){a.destroy()}),a.show()}).fail(d.exception)},x=function(a){var b="type"+u(a);return c.get_string(b,"core_calendar").then(function(a){return a})};return{init:function(a){k(a)},reloadCurrentMonth:n,changeMonth:m,refreshMonthContent:l,reloadCurrentDay:p,changeDay:q,refreshDayContent:o,reloadCurrentUpcoming:t}});
define('core_calendar/event_form', ["jquery","core_calendar/repository"],function(a,b){var c={EVENT_GROUP_COURSE_ID:'[name="groupcourseid"]',EVENT_GROUP_ID:'[name="groupid"]',SELECT_OPTION:"option"},d=function(d){var e=d.find(c.EVENT_GROUP_COURSE_ID),f=function(b){var e=d.find(c.EVENT_GROUP_ID),f=e.find(c.SELECT_OPTION),g=a(b);f.remove(),e.prop("disabled",!1),g.each(function(b,c){a(e).append(a("<option></option>").attr("value",c.id).text(c.name))})};e.on("change",function(){var a=d.find(c.EVENT_GROUP_COURSE_ID).val();b.getCourseGroupsData(a).then(function(a){return f(a)})["catch"](Notification.exception)})},e=function(b){var c=a("#"+b);d(c)};return{init:e}});
define('core_calendar/calendar_view', ["jquery","core/str","core/notification","core_calendar/selectors","core_calendar/events","core_calendar/view_manager","core_calendar/repository","core/modal_factory","core_calendar/modal_event_form","core/modal_events","core_calendar/crud"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(b,g){var h=a("body");k.registerRemove(b);var i="reloadCurrent"+g.charAt(0).toUpperCase()+g.slice(1);h.on(e.created,function(){f[i](b)}),h.on(e.deleted,function(){f[i](b)}),h.on(e.updated,function(){f[i](b)}),b.on("change",d.courseSelector,function(){var e=a(this),g=e.val();f[i](b,g,null).then(function(){return b.find(d.courseSelector).val(g)}).then(function(){window.history.pushState({},"","?view=upcoming&course="+g)}).fail(c.exception)}),h.on(e.filterChanged,function(a,c){var e=b.find(d.eventType[c.type]);1==c.hidden?e.addClass("hidden"):e.removeClass("hidden")});var j=k.registerEventFormModal(b);k.registerEditListeners(b,j)};return{init:function(b,c){b=a(b),f.init(b,c),l(b,c)}}});
define('core_calendar/month_navigation_drag_drop', ["jquery","core_calendar/drag_drop_data_store"],function(a,b){var c={DRAGGABLE:'[draggable="true"][data-region="event-item"]',DROP_ZONE:'[data-drop-zone="nav-link"]'},d="bg-primary text-white",e="drop-target",f=1e3,g=!1,h=null,i=null,j=function(a,b){b?a.addClass(d):a.removeClass(d)},k=function(){i.find(c.DROP_ZONE).addClass(e)},l=function(){i.find(c.DROP_ZONE).removeClass(e)},m=function(b){var d=a(b.target).closest(c.DROP_ZONE);return d.length?d:null},n=function(b){var d=a(b.target).closest(c.DRAGGABLE);d.length&&k()},o=function(a){if(b.hasEventId()){a.preventDefault();var c=m(a);c&&b.hasEventId()&&(h||(h=setTimeout(function(){c.click(),h=null},f)),j(c,!0),l())}},p=function(a){if(b.hasEventId()){var c=m(a);c&&(h&&(clearTimeout(h),h=null),j(c,!1),k(),a.preventDefault())}},q=function(a){if(b.hasEventId()){l();var c=m(a);c&&(j(c,!1),a.preventDefault())}};return{init:function(c){g||(document.addEventListener("dragstart",n,!1),document.addEventListener("dragover",o,!1),document.addEventListener("dragleave",p,!1),document.addEventListener("drop",q,!1),document.addEventListener("dragend",l,!1),g=!0),i=a(c),b.hasEventId()&&k()}}});
define('core_calendar/month_view_drag_drop', ["jquery","core/notification","core/str","core_calendar/events","core_calendar/drag_drop_data_store"],function(a,b,c,d,e){var f={ROOT:"[data-region='calendar']",DRAGGABLE:'[draggable="true"][data-region="event-item"]',DROP_ZONE:'[data-drop-zone="month-view-day"]',WEEK:'[data-region="month-view-week"]'},g="bg-faded",h="bg-danger text-white",i="bg-primary text-white",j=g+" "+h+" "+i,k=!1,l=function(b){var c=a(b.target).closest(f.DROP_ZONE);return c.length?c:null},m=function(a){var b=a.attr("data-day-timestamp"),c=e.getMinTimestart(),d=e.getMaxTimestart();return!(c&&c>b)&&!(d&&d<b)},n=function(a){var b=a.attr("data-day-timestamp"),c=e.getMinTimestart(),d=e.getMaxTimestart();return c&&c>b?e.getMinError():d&&d<b?e.getMaxError():null},o=function(){a(f.ROOT).find(f.DROP_ZONE).each(function(b,c){c=a(c),c.removeClass(j)})},p=function(a,b,c){"undefined"==typeof c&&(c=e.getDurationDays());var d=m(a);if(a.removeClass(j),b?d?a.addClass(i):a.addClass(h):(a.removeClass(i+" "+h),d||a.addClass(g)),c--,c>0){var k=a.next();if(!k.length){var l=a.closest(f.WEEK).next();l.length&&(k=l.children(f.DROP_ZONE).first())}k.length&&p(k,b,c)}},q=function(){a(f.ROOT).find(f.DROP_ZONE).each(function(b,c){c=a(c),m(c)||p(c,!1)})},r=function(b){var c=a(b.target),d=c.closest(f.DRAGGABLE);if(d.length){var g=d.find("[data-event-id]"),h=g.attr("data-event-id"),i=d.attr("data-min-day-timestamp"),j=d.attr("data-max-day-timestamp"),k=d.attr("data-min-day-error"),l=d.attr("data-max-day-error"),m=f.ROOT+' [data-event-id="'+h+'"]',n=a(m).length;e.setEventId(h),e.setDurationDays(n),i&&e.setMinTimestart(i),j&&e.setMaxTimestart(j),k&&e.setMinError(k),l&&e.setMaxError(l),b.dataTransfer.effectAllowed="move",b.dataTransfer.dropEffect="move",b.dataTransfer.setData("text/plain",h),b.dropEffect="move",q()}},s=function(a){if(e.hasEventId()){a.preventDefault();var b=l(a);b&&p(b,!0)}},t=function(a){if(e.hasEventId()){var b=l(a);b&&(p(b,!1),a.preventDefault())}},u=function(g){if(e.hasEventId()){var h=l(g);if(!h)return e.clearAll(),void o();if(m(h)){var i=e.getEventId(),j=f.ROOT+' [data-event-id="'+i+'"]',k=a(j),p=null;k.length&&(p=k.closest(f.DROP_ZONE)),a("body").trigger(d.moveEvent,[i,p,h])}else{var q=n(h);c.get_string("errorinvaliddate","calendar").then(function(a){b.exception({name:a,message:q||a})})}e.clearAll(),o(),g.preventDefault()}},v=function(){e.clearAll(),o()},w=function(){q()};return{init:function(){k||(document.addEventListener("dragstart",r,!1),document.addEventListener("dragover",s,!1),document.addEventListener("dragleave",t,!1),document.addEventListener("drop",u,!1),document.addEventListener("dragend",v,!1),a("body").on(d.monthChanged,w),k=!0)}}});
define('core_course/events', [],function(){return{favourited:"core_course:favourited",unfavorited:"core_course:unfavorited"}});
define('core_course/learning_path', ['jquery'], function($)
{

        return{
                init: function()
                {
                   $(document).ready(function() {
            		$("#submit").click(function() {

		var length = $('.custom-select').length;

		var i;
               	var select_array = [];
                for(i=1; i<=length; i++)
                {
			select_array.push($("#tag"+i).val());
                }                        
               	var select_data = JSON.stringify(select_array);
                var hrefurl = M.cfg.wwwroot+"/course/tagselection_ajax.php?select="+select_data;
		
                window.location.href = hrefurl;
				
            });
        });
                                }
                        };
                });

define('core_course/upload', ['jquery'], function($) {

    return {
        init: function() {

        	
        	
        	
        	$( "#id_activitytype" ).change(function() {
        		var activityType = $('#id_activitytype').val();
        		var activityId = '';
        		var cohorts = '';
        		//$('#selected_cohorts').val(null).trigger('change');
        		$('#selected_cohorts').children().remove();
        		$('#selected_cohorts').trigger('change');
        		if(activityType == 3){
        			var activityId = $('#id_assign').val();
        	    	$("#selected_cohorts").load(M.cfg.wwwroot+'/course/ajax_upload.php?activityid='+activityId,"action=getcohorts", function( response, status, xhr ) {
        	  						if ( response == "" ) {
        	    							console.log('empty response received');
        	    							activityType = 'other';
        	    							$("#template_link").attr("href", M.cfg.wwwroot+"/course/excel_template.php?activitytype=" +activityType);
        	  							}else{
        	  								var cohorts = $('#selected_cohorts').val();
        	  								$("#selected_cohorts").trigger("chosen:updated");
        	  								$("#template_link").attr("href", M.cfg.wwwroot+"/course/excel_template.php?activitytype=" +activityType+'&id='+activityId+'&cohorts='+cohorts);
        	  							}
        			});
        	    	console.log('changed to assign');
        		}else{
        			$("#template_link").attr("href", M.cfg.wwwroot+"/course/excel_template.php?activitytype=" +activityType);
        			console.log('changed to other');
        		}
        	});
        	
        	
        	$( "#id_assign" ).change(function() {
        		var activityType = $('#id_activitytype').val();
        		$('#selected_cohorts').children().remove();
        		$('#selected_cohorts').trigger('change');
        		if (activityType == 3) {
        			console.log("assign activity changed");
        			var activityId = $('#id_assign').val();
        			$("#selected_cohorts").load(M.cfg.wwwroot+'/course/ajax_upload.php?activityid='+activityId,"action=getcohorts", function( response, status, xhr ) {
  						if ( response == "" ) {
    							console.log('empty response received');
    							activityType = 'other';
    							$("#template_link").attr("href", M.cfg.wwwroot+"/course/excel_template.php?activitytype=" +activityType);
  							}else{
  								var cohorts = $('#selected_cohorts').val();
  								$("#selected_cohorts").trigger("chosen:updated");
  								$("#template_link").attr("href", M.cfg.wwwroot+"/course/excel_template.php?activitytype=" +activityType+'&id='+activityId+'&cohorts='+cohorts);
  							}
        			});
				}else{
        			$("#template_link").attr("href", M.cfg.wwwroot+"/course/excel_template.php?activitytype=" +activityType);
        			console.log('other activity changed');
        		}
        	});
        }
    };
});


define('core_course/stage_change', ['jquery'], function($) {

    return {
        init: function() {

            var rootPath = M.cfg.wwwroot;

            $('#newlp').hide();
            $('#stagename').change(function() {
                if ($('#stagename option:selected').text() == 'Others') {
                    $('#newlp').show();
                } else {
                    $('#newlp').hide();
                }
            });
            $(document).on('click', '#submit', function() {
                $cohort1 = $('#cohortname').val();
                $oldlp = $('#stagename option:selected').text();
                $lp = $('#lpname option:selected').text();
                $cohort = $cohort1.toUpperCase();

                $cohort_text = JSON.stringify($cohort);
                $("#stageid").load('stage_ajax.php', "choice=get_data&cohort_data=" + $cohort_text + "&oldlp_data=" + $oldlp + "&lp_data=" + $lp);
            });

        }
    };
});


define('core_course/actions', ["jquery","core/ajax","core/templates","core/notification","core/str","core/url","core/yui","core/modal_factory","core/modal_events","core/key_codes"],function(a,b,c,d,e,f,g,h,i,j){var k={EDITINPROGRESS:"editinprogress",SECTIONDRAGGABLE:"sectiondraggable",EDITINGMOVE:"editing_move"},l={ACTIVITYLI:"li.activity",ACTIONAREA:".actions",ACTIVITYACTION:"a.cm-edit-action",MENU:".moodle-actionmenu[data-enhance=moodle-core-actionmenu]",TOGGLE:".toggle-display,.dropdown-toggle",SECTIONLI:"li.section",SECTIONACTIONMENU:".section_action_menu",ADDSECTIONS:"#changenumsections [data-add-sections]"};g.use("moodle-course-coursebase",function(){var a=M.course.format.get_section_selector();a&&(l.SECTIONLI=a)});var m=function(a){var b;return g.use("moodle-course-util",function(c){b=c.Moodle.core_course.util.cm.getId(c.Node(a.get(0)))}),b},n=function(a){var b;return g.use("moodle-course-util",function(c){b=c.Moodle.core_course.util.cm.getName(c.Node(a.get(0)))}),b},o=function(a){a.addClass(k.EDITINPROGRESS);var b=a.find(l.ACTIONAREA).get(0);if(b){var c=M.util.add_spinner(g,g.Node(b));return c.show(),c}return null},p=function(a){a.addClass(k.EDITINPROGRESS);var b=a.find(l.SECTIONACTIONMENU).get(0);if(b){var c=M.util.add_spinner(g,g.Node(b));return c.show(),c}return null},q=function(a){var b=M.util.add_lightbox(g,g.Node(a.get(0)));return b.show(),b},r=function(a,b,c){window.setTimeout(function(){a.removeClass(k.EDITINPROGRESS),b&&b.hide()},c)},s=function(a,b){a&&window.setTimeout(function(){a.hide()},b)},t=function(a,b){if(g.use("moodle-course-coursebase",function(){M.course.coursebase.invoke_function("setup_for_resource","#"+a)}),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(g.one("#"+a)),b){var c=g.one("#"+a+" "+l.MENU).one(l.TOGGLE);c&&c.simulate&&c.simulate("click")}},u=function(b,c){var d=a("#"+b),e="[data-action="+c+"]";"groupsseparate"!==c&&"groupsvisible"!==c&&"groupsnone"!==c||(e="[data-action=groupsseparate],[data-action=groupsvisible],[data-action=groupsnone]"),d.find(e).is(":visible")?d.find(e).focus():d.find(l.MENU).find(l.TOGGLE).focus()},v=function(b){var c=a("a:visible"),d=!1,e=null;return c.each(function(){if(a.contains(b[0],this))d=!0;else if(d)return e=this,!1}),e},w=function(c,e,f){var g,h=f.attr("data-keepopen"),i=f.attr("data-action"),j=o(c),k=b.call([{methodname:"core_course_edit_module",args:{id:e,action:i,sectionreturn:f.attr("data-sectionreturn")?f.attr("data-sectionreturn"):0}}],!0);"duplicate"===i&&(g=q(f.closest(l.SECTIONLI))),a.when.apply(a,k).done(function(b){var d=v(c);c.replaceWith(b),a("<div>"+b+"</div>").find(l.ACTIVITYLI).each(function(b){t(a(this).attr("id"),h),0===b&&(u(a(this).attr("id"),i),d=null)}),d&&d.focus(),r(c,j,400),s(g,400),c.trigger(a.Event("coursemoduleedited",{ajaxreturn:b,action:i}))}).fail(function(b){r(c,j),s(g);var e=a.Event("coursemoduleeditfailed",{exception:b,action:i});c.trigger(e),e.isDefaultPrevented()||d.exception(b)})},x=function(c,d,e){var f=o(c),g=b.call([{methodname:"core_course_get_module",args:{id:d,sectionreturn:e}}],!0);a.when.apply(a,g).done(function(a){r(c,f,400),C(a)}).fail(function(){r(c,f)})},y=function(a,b){var c=a.attr("class").match(/modtype_([^\s]*)/)[1],f=n(a);e.get_string("pluginname",c).done(function(a){var c={type:a,name:f};e.get_strings([{key:"confirm"},{key:null===f?"deletechecktype":"deletechecktypename",param:c},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],b)})})},z=function(a,b){e.get_strings([{key:"confirm"},{key:"yes"},{key:"no"}]).done(function(c){d.confirm(c[0],a,c[1],c[2],b)})},A=function(a,b,f,g,h,i,j){var k=[{key:f,component:g}];return e.get_strings(k).then(function(d){return a.find("span.menu-action-text").html(d[0]),c.renderPix(b,"core")}).then(function(b){a.find(".icon").replaceWith(b),a.attr("data-action",j)})["catch"](d.exception)},B=function(b,c,d,e){var f=c.attr("data-action");if("hide"===f||"show"===f){if("hide"===f?(b.addClass("hidden"),A(c,"i/show","showfromothers","format_"+e,null,null,"show")):(b.removeClass("hidden"),A(c,"i/hide","hidefromothers","format_"+e,null,null,"hide")),void 0!==d.modules)for(var g in d.modules)C(d.modules[g]);void 0!==d.section_availability&&b.find(".section_availability").first().replaceWith(d.section_availability)}else if("setmarker"===f){var h=a(l.SECTIONLI+".current"),i=h.find(l.SECTIONACTIONMENU+" a[data-action=removemarker]");h.removeClass("current"),A(i,"i/marker","highlight","core","markthistopic","core","setmarker"),b.addClass("current"),A(c,"i/marked","highlightoff","core","markedthistopic","core","removemarker")}else"removemarker"===f&&(b.removeClass("current"),A(c,"i/marker","highlight","core","markthistopic","core","setmarker"))},C=function(b){a("<div>"+b+"</div>").find(l.ACTIVITYLI).each(function(){var c=a(this).attr("id");a(l.ACTIVITYLI+"#"+c).replaceWith(b),t(c,!1)})},D=function(c,e,f,g){var h=f.attr("data-action"),i=f.attr("data-sectionreturn")?f.attr("data-sectionreturn"):0,j=p(c),k=b.call([{methodname:"core_course_edit_section",args:{id:e,action:h,sectionreturn:i}}],!0),m=q(c);a.when.apply(a,k).done(function(b){var d=a.parseJSON(b);r(c,j),s(m),c.find(l.SECTIONACTIONMENU).find(l.TOGGLE).focus();var e=a.Event("coursesectionedited",{ajaxreturn:d,action:h});c.trigger(e),e.isDefaultPrevented()||B(c,f,d,g)}).fail(function(b){r(c,j),s(m);var e=a.Event("coursesectioneditfailed",{exception:b,action:h});c.trigger(e),e.isDefaultPrevented()||d.exception(b)})};return g.use("moodle-course-coursebase",function(){M.course.coursebase.register_module({set_visibility_resource_ui:function(b){var c=a(b.element.getDOMNode()),d=m(c);if(d){var e=c.find("."+k.EDITINGMOVE).attr("data-sectionreturn");x(c,d,e)}}})}),{initCoursePage:function(b){a("body").on("click keypress",l.ACTIVITYLI+" "+l.ACTIVITYACTION+"[data-action]",function(b){if("keypress"!==b.type||13===b.keyCode){var c=a(this),d=c.closest(l.ACTIVITYLI),e=c.attr("data-action"),f=m(d);switch(e){case"moveleft":case"moveright":case"delete":case"duplicate":case"hide":case"stealth":case"show":case"groupsseparate":case"groupsvisible":case"groupsnone":break;default:return}f&&(b.preventDefault(),"delete"===e?y(d,function(){w(d,f,c)}):w(d,f,c))}}),a("body").on("click keypress",l.SECTIONLI+" "+l.SECTIONACTIONMENU+"[data-sectionid] a[data-action]",function(c){if("keypress"!==c.type||13===c.keyCode){var d=a(this),e=d.closest(l.SECTIONLI),f=d.closest(l.SECTIONACTIONMENU).attr("data-sectionid");c.preventDefault(),d.attr("data-confirm")?z(d.attr("data-confirm"),function(){D(e,f,d,b)}):D(e,f,d,b)}}),e.get_string("numberweeks").done(function(b){var c=a(l.ADDSECTIONS),d=c.attr("data-add-sections"),e=c.attr("new-sections"),f=a('<div><label for="add_section_numsections"></label> <input id="add_section_numsections" type="number" min="1" max="'+e+'" value="1"></div>');f.find("label").html(b),h.create({title:d,type:h.types.SAVE_CANCEL,body:f.html()},c).done(function(b){var e=a(b.getBody()).find("#add_section_numsections"),f=function(){""+parseInt(e.val())===e.val()&&parseInt(e.val())>=1&&(document.location=c.attr("href")+"&numsections="+parseInt(e.val()))};b.setSaveButtonText(d),b.getRoot().on(i.shown,function(){e.focus().select().on("keydown",function(a){a.keyCode===j.enter&&f()})}),b.getRoot().on(i.save,function(a){a.preventDefault(),f()})})})},replaceSectionActionItem:function(a,b,c,d,e,f,g,h){var i=a.find(l.SECTIONACTIONMENU+" "+b);A(i,c,d,e,f,g,h)}}});
define('core_course/repository', ["jquery","core/ajax"],function(a,b){var c=function(a,c,d,e){var f={classification:a};"undefined"!=typeof c&&(f.limit=c),"undefined"!=typeof d&&(f.offset=d),"undefined"!=typeof e&&(f.sort=e);var g={methodname:"core_course_get_enrolled_courses_by_timeline_classification",args:f};return b.call([g])[0]},d=function(a,c,d,e){var f={};"undefined"!=typeof a&&(f.userid=a),"undefined"!=typeof c&&(f.limit=c),"undefined"!=typeof d&&(f.offset=d),"undefined"!=typeof e&&(f.sort=e);var g={methodname:"core_course_get_recent_courses",args:f};return b.call([g])[0]};return{getEnrolledCoursesByTimelineClassification:c,getLastAccessedCourses:d}});
define('core_form/passwordunmask', ["jquery","core/templates"],function(a,b){var c=function(b){this.wrapperSelector='[data-passwordunmask="wrapper"][data-passwordunmaskid="'+b+'"]',this.wrapper=a(this.wrapperSelector),this.editorSpace=this.wrapper.find('[data-passwordunmask="editor"]'),this.editLink=this.wrapper.find('a[data-passwordunmask="edit"]'),this.editInstructions=this.wrapper.find('[data-passwordunmask="instructions"]'),this.displayValue=this.wrapper.find('[data-passwordunmask="displayvalue"]'),this.inputFieldLabel=a('label[for="'+b+'"]'),this.inputField=this.editorSpace.find(document.getElementById(b)),this.inputField.attr("type","hidden"),this.inputField.removeClass("hiddenifjs"),this.editInstructions.attr("id")||this.editInstructions.attr("id",b+"_instructions"),this.editInstructions.hide(),this.setDisplayValue(),this.addListeners()};return c.prototype.addListeners=function(){return this.wrapper.on("click keypress",'[data-passwordunmask="edit"]',a.proxy(function(b){"keypress"===b.type&&13!==b.keyCode||(b.stopImmediatePropagation(),b.preventDefault(),"hidden"!==this.inputField.attr("type")?"click"===b.type||a(b.relatedTarget).is(":input")?this.turnEditingOff(!1):this.turnEditingOff(!0):this.turnEditingOn())},this)),this.wrapper.on("click keypress",'[data-passwordunmask="unmask"]',a.proxy(function(a){"keypress"===a.type&&13!==a.keyCode||(a.stopImmediatePropagation(),a.preventDefault(),this.wrapper.data("unmasked",!this.wrapper.data("unmasked")),this.setDisplayValue())},this)),this.wrapper.on("keydown","input",a.proxy(function(a){"keydown"===a.type&&13!==a.keyCode||(a.stopImmediatePropagation(),a.preventDefault(),this.turnEditingOff(!0))},this)),this.inputFieldLabel.on("click",a.proxy(function(a){a.preventDefault(),this.turnEditingOn()},this)),this},c.prototype.checkFocusOut=function(b){this.isEditing()&&window.setTimeout(a.proxy(function(){var c=b.relatedTarget||document.activeElement;this.wrapper.has(a(c)).length||this.turnEditingOff(!a(c).is(":input,a"))},this),100)},c.prototype.passwordVisible=function(){return!!this.wrapper.data("unmasked")},c.prototype.isEditing=function(){return"hidden"!==this.inputField.attr("type")},c.prototype.turnEditingOn=function(){var b=this.getDisplayValue();return this.passwordVisible()?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(b),this.inputField.attr("size",this.inputField.attr("data-size")),this.editInstructions.length&&(this.inputField.attr("aria-describedby",this.editInstructions.attr("id")),this.editInstructions.show()),this.wrapper.attr("data-passwordunmask-visible",1),this.editLink.hide(),this.inputField.focus().select(),a("body").on("focusout",this.wrapperSelector,a.proxy(this.checkFocusOut,this)),this},c.prototype.turnEditingOff=function(b){a("body").off("focusout",this.wrapperSelector,this.checkFocusOut);var c=this.getDisplayValue();return this.inputField.attr("type","hidden").attr("aria-describedby",null),this.inputField.val(c),this.editInstructions.hide(),this.wrapper.removeAttr("data-passwordunmask-visible"),this.inputField.removeAttr("size"),this.editLink.show(),this.setDisplayValue(),b&&this.editLink.focus(),this},c.prototype.getDisplayValue=function(){return this.inputField.val()},c.prototype.setDisplayValue=function(){var c=this.getDisplayValue();return this.isEditing()&&(this.wrapper.data("unmasked")?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(c)),c&&this.wrapper.data("unmasked")?this.displayValue.text(c):(c||(c=""),b.render("core_form/element-passwordunmask-fill",{element:{frozen:this.inputField.is("[readonly]"),value:c,valuechars:c.split("")}}).done(a.proxy(function(a,c){this.displayValue.html(a),b.runTemplateJS(c)},this))),this},c});
define('core_form/filetypes', ["jquery","core/log","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/tree"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(c,d,e,f){if(this.elementId=c,this.elementLabel=d,this.onlyTypes=e,this.allowAll=f,this.inputField=a("#"+c),this.wrapperBrowserTrigger=a('[data-filetypesbrowser="'+c+'"]'),this.wrapperDescriptions=a('[data-filetypesdescriptions="'+c+'"]'),this.wrapperBrowserTrigger.length)return this.inputField.length&&this.wrapperDescriptions.length?void this.prepareBrowserTrigger().then(function(){return this.prepareBrowserModal()}.bind(this)).then(function(){return this.prepareBrowserTree()}.bind(this)):void b.error("core_form/filetypes: Unexpected DOM structure, unable to enhance filetypes field "+c)};return i.prototype.prepareBrowserTrigger=function(){return g.render("core_form/filetypes-trigger",{}).then(function(a){this.wrapperBrowserTrigger.html(a),this.browserTrigger=this.wrapperBrowserTrigger.find('[data-filetypeswidget="browsertrigger"]')}.bind(this))},i.prototype.prepareBrowserModal=function(){return d.create({type:d.types.SAVE_CANCEL,title:this.elementLabel}).then(function(a){this.browserModal=a}.bind(this)).then(function(){this.browserModal.getRoot().on(e.hidden,function(){this.browserTrigger.focus()}.bind(this)),this.browserModal.getRoot().on(e.save,function(){this.saveBrowserModal()}.bind(this))}.bind(this))},i.prototype.prepareBrowserTree=function(){return this.browserTrigger.on("click",function(b){if(b.preventDefault(),!this.inputField.is("[disabled]")){var c=this.loadBrowserModalBody();c.then(function(){this.browserTree=new h(this.browserModal.getBody()),this.browserTree.handleKeyDown=function(a,b){b.keyCode==this.browserTree.keys.enter||b.keyCode==this.browserTree.keys.space?(b.preventDefault(),b.stopPropagation(),this.toggleCheckbox(a.attr("data-filetypesbrowserkey"))):h.prototype.handleKeyDown.call(this.browserTree,a,b)}.bind(this),this.allowAll&&(this.hideOrShowItemsDependingOnAllowAll(this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]:first')),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey="*"]',function(b){this.hideOrShowItemsDependingOnAllowAll(a(b.currentTarget))}.bind(this))),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey]',function(b){var c=a(b.currentTarget),d=c.attr("data-filetypesbrowserkey");this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+d+'"]').prop("checked",c.prop("checked"))}.bind(this))}.bind(this)).then(function(){this.browserModal.show()}.bind(this)),this.browserModal.setBody(c)}}.bind(this)),a.when()},i.prototype.loadBrowserModalBody=function(){var a={onlytypes:this.onlyTypes.join(),allowall:this.allowAll,current:this.inputField.val()};return f.call([{methodname:"core_form_get_filetypes_browser_data",args:a}])[0].then(function(a){return g.render("core_form/filetypes-browser",{elementid:this.elementId,groups:a.groups})}.bind(this))},i.prototype.toggleCheckbox=function(a){var b=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+a+'"]:first');b.prop("checked",!b.prop("checked"))},i.prototype.saveBrowserModal=function(){if(this.allowAll){var b=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]');if(b.length&&b.prop("checked"))return this.inputField.val("*"),void this.updateDescriptions(["*"])}var c=[];this.browserModal.getRoot().find('input[type="checkbox"]').each(function(){var b=a(this),d=b.attr("data-filetypesbrowserkey");b.prop("checked")&&c.push(d)}),c=c.filter(function(a,b,c){return c.indexOf(a)==b}),this.inputField.val(c.join(" ")),this.updateDescriptions(c)},i.prototype.updateDescriptions=function(a){var b=[];a.forEach(function(a){b.push({description:this.browserModal.getRoot().find('[data-filetypesname="'+a+'"]:first').text().trim(),extensions:this.browserModal.getRoot().find('[data-filetypesextensions="'+a+'"]:first').text().trim()})}.bind(this));var c={hasdescriptions:b.length>0,descriptions:b};return g.render("core_form/filetypes-descriptions",c).then(function(a){this.wrapperDescriptions.html(a)}.bind(this))},i.prototype.hideOrShowItemsDependingOnAllowAll=function(a){var b=this.browserModal.getRoot().find('[role="treeitem"][data-filetypesbrowserkey!="*"]');a.prop("checked")?b.hide():b.show()},{init:function(a,b,c,d){new i(a,b,c,d)}}});
define('core_form/defaultcustom', ["jquery"],function(a){var b=function(b){var c=a(b.target),d=JSON.parse(c.attr("data-defaultvalue")),e=JSON.parse(c.attr("data-customvalue")),f=c.attr("data-type"),g=c.closest("form"),h=c.attr("name").replace(/\[customize\]$/,"[value]"),i=c.prop("checked")?e:d;"text"===f?g.find('[name="'+h+'"]').val(i):"date_selector"===f?(g.find('[name="'+h+'[day]"]').val(i.day),g.find('[name="'+h+'[month]"]').val(i.month),g.find('[name="'+h+'[year]"]').val(i.year)):"date_time_selector"===f&&(g.find('[name="'+h+'[day]"]').val(i.day),g.find('[name="'+h+'[month]"]').val(i.month),g.find('[name="'+h+'[year]"]').val(i.year),g.find('[name="'+h+'[hour]"]').val(i.hour),g.find('[name="'+h+'[minute]"]').val(i.minute))},c="input[data-defaultcustom=true]";a("body").on("change",c,b)});
define('core_grades/edittree_index', ["jquery"],function(a){var b=function(){a("body").on("change",".itemselect.ignoredirty",b.checkMoveMenuState),a("body").on("click",'[data-action="grade_edittree-index-bulkselect"]',b.toggleAllSelectItems),a("body").on("change",".weightoverride",b.toggleWeightInput),a("#menumoveafter").on("change",function(){var b=a(this).closest("form"),c=b.find("#bulkmoveinput");c.val(1),b.submit()}),b.checkMoveMenuState()};return b.toggleWeightInput=function(b){b.preventDefault();var c=a(this),d=c.closest("tr");a('input[name="weight_'+d.data("itemid")+'"]').prop("disabled",!c.prop("checked"))},b.toggleAllSelectItems=function(c){c.preventDefault();var d=a(this),e=d.closest("tr");a("."+e.data("category")+" .itemselect").prop("checked",d.data("checked")),b.checkMoveMenuState()},b.getMoveMenu=function(){return a("#menumoveafter")},b.checkMoveMenuState=function(){var c=b.getMoveMenu();if(!c.length)return!1;var d;return a(".itemselect").each(function(){return d=a(this).prop("checked"),!d}),c.prop("disabled",!d),d},{enhance:b}});
define('core_message/message_drawer_events', [],function(){return{CREATE_CONVERSATION_WITH_USER:"message-drawer-create-conversation-with-user",CONTACT_BLOCKED:"message-drawer-contact-blocked",CONTACT_UNBLOCKED:"message-drawer-contact-unblocked",CONTACT_ADDED:"message-drawer-contact-added",CONTACT_REMOVED:"message-drawer-contact-removed",CONTACT_REQUEST_ACCEPTED:"message-drawer-contact-request-accepted",CONTACT_REQUEST_DECLINED:"message-drawer-contact-request-declined",CONVERSATION_CREATED:"message-drawer-conversation-created",CONVERSATION_NEW_LAST_MESSAGE:"message-drawer-conversation-new-last-message",CONVERSATION_DELETED:"message-drawer-conversation-deleted",CONVERSATION_READ:"message-drawer-conversation-read",CONVERSATION_SET_FAVOURITE:"message-drawer-conversation-set-favourite",CONVERSATION_UNSET_FAVOURITE:"message-drawer-conversation-unset-favourite",PREFERENCES_UPDATED:"message-drawer-preferences-updated",ROUTE_CHANGED:"message-drawer-route-change",SHOW:"message-drawer-show",HIDE:"message-drawer-hide",TOGGLE_VISIBILITY:"message-drawer-toggle",SHOW_CONVERSATION:"message-drawer-show-conversation",SHOW_CONTACT_REQUESTS:"message-drawer-show-contact-requests",SHOW_SETTINGS:"message-drawer-show-settings"}});
define('core_message/message_drawer_view_search', ["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/str","core/templates","core_message/message_repository","core_message/message_drawer_events"],function(a,b,c,d,e,f,g,h){var i=50,j=50,k=3,l={BLOCK_ICON_CONTAINER:'[data-region="block-icon-container"]',CANCEL_SEARCH_BUTTON:'[data-action="cancel-search"]',CONTACTS_CONTAINER:'[data-region="contacts-container"]',CONTACTS_LIST:'[data-region="contacts-container"] [data-region="list"]',EMPTY_MESSAGE_CONTAINER:'[data-region="empty-message-container"]',LIST:'[data-region="list"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]',LOADING_PLACEHOLDER:'[data-region="loading-placeholder"]',MESSAGES_LIST:'[data-region="messages-container"] [data-region="list"]',MESSAGES_CONTAINER:'[data-region="messages-container"]',NON_CONTACTS_CONTAINER:'[data-region="non-contacts-container"]',NON_CONTACTS_LIST:'[data-region="non-contacts-container"] [data-region="list"]',SEARCH_ICON_CONTAINER:'[data-region="search-icon-container"]',SEARCH_ACTION:'[data-action="search"]',SEARCH_INPUT:'[data-region="search-input"]',SEARCH_RESULTS_CONTAINER:'[data-region="search-results-container"]',LOAD_MORE_USERS:'[data-action="load-more-users"]',LOAD_MORE_MESSAGES:'[data-action="load-more-messages"]',BUTTON_TEXT:'[data-region="button-text"]',NO_RESULTS_CONTAINTER:'[data-region="no-results-container"]',ALL_CONTACTS_CONTAINER:'[data-region="all-contacts-container"]'},m={CONTACTS_LIST:"core_message/message_drawer_contacts_list",NON_CONTACTS_LIST:"core_message/message_drawer_non_contacts_list",MESSAGES_LIST:"core_message/message_drawer_messages_list"},n=function(a){return a.attr("data-user-id")},o=function(a){return a.find(l.EMPTY_MESSAGE_CONTAINER)},p=function(a){return a.find(l.LOADING_ICON_CONTAINER)},q=function(a){return a.find(l.LOADING_PLACEHOLDER)},r=function(a){return a.find(l.SEARCH_ICON_CONTAINER)},s=function(a){return a.find(l.SEARCH_INPUT)},t=function(a){return a.find(l.SEARCH_RESULTS_CONTAINER)},u=function(a){return a.find(l.CONTACTS_CONTAINER)},v=function(a){return a.find(l.NON_CONTACTS_CONTAINER)},w=function(a){return a.find(l.MESSAGES_CONTAINER)},x=function(a){o(a).removeClass("hidden")},y=function(a){o(a).addClass("hidden")},z=function(a){p(a).removeClass("hidden")},A=function(a){p(a).addClass("hidden")},B=function(a){q(a).removeClass("hidden")},C=function(a){q(a).addClass("hidden")},D=function(a){r(a).removeClass("hidden")},E=function(a){r(a).addClass("hidden")},F=function(a){t(a).removeClass("hidden")},G=function(a){t(a).addClass("hidden")},H=function(a){var b=t(a);b.find(l.ALL_CONTACTS_CONTAINER).addClass("hidden"),b.find(l.MESSAGES_CONTAINER).addClass("hidden"),b.find(l.NO_RESULTS_CONTAINTER).removeClass("hidden")},I=function(a){var b=t(a);b.find(l.ALL_CONTACTS_CONTAINER).removeClass("hidden"),b.find(l.MESSAGES_CONTAINER).removeClass("hidden"),b.find(l.NO_RESULTS_CONTAINTER).addClass("hidden")},J=function(a){var b=t(a);b.find(l.ALL_CONTACTS_CONTAINER).removeClass("hidden")},K=function(a){var b=t(a);b.find(l.ALL_CONTACTS_CONTAINER).addClass("hidden")},L=function(a){var b=t(a);b.find(l.CONTACTS_CONTAINER).removeClass("hidden")},M=function(a){var b=t(a);b.find(l.CONTACTS_CONTAINER).addClass("hidden")},N=function(a){var b=t(a);b.find(l.NON_CONTACTS_CONTAINER).removeClass("hidden")},O=function(a){var b=t(a);b.find(l.NON_CONTACTS_CONTAINER).addClass("hidden")},P=function(a){var b=t(a);b.find(l.MESSAGES_CONTAINER).removeClass("hidden")},Q=function(a){var b=t(a);b.find(l.MESSAGES_CONTAINER).addClass("hidden")},R=function(a){s(a).prop("disabled",!0)},S=function(a){s(a).prop("disabled",!1)},T=function(a){s(a).val("")},U=function(a){a.find(l.CONTACTS_LIST).empty(),a.find(l.NON_CONTACTS_LIST).empty(),a.find(l.MESSAGES_LIST).empty(),I(a),J(a),L(a),N(a),P(a),Z(a),ba(a)},V=function(a,b){E(a),y(b),G(b),z(a),B(b),R(a)},W=function(a,b){D(a),y(b),F(b),A(a),C(b),S(a)},X=function(a){var b=a.find(l.LOAD_MORE_USERS);b.prop("disabled",!0),b.find(l.BUTTON_TEXT).addClass("hidden"),b.find(l.LOADING_ICON_CONTAINER).removeClass("hidden")},Y=function(a){var b=a.find(l.LOAD_MORE_USERS);b.prop("disabled",!1),b.find(l.BUTTON_TEXT).removeClass("hidden"),b.find(l.LOADING_ICON_CONTAINER).addClass("hidden")},Z=function(a){a.find(l.LOAD_MORE_USERS).removeClass("hidden")},$=function(a){a.find(l.LOAD_MORE_USERS).addClass("hidden")},_=function(a){var b=a.find(l.LOAD_MORE_MESSAGES);b.prop("disabled",!0),b.find(l.BUTTON_TEXT).addClass("hidden"),b.find(l.LOADING_ICON_CONTAINER).removeClass("hidden")},aa=function(a){var b=a.find(l.LOAD_MORE_MESSAGES);b.prop("disabled",!1),b.find(l.BUTTON_TEXT).removeClass("hidden"),b.find(l.LOADING_ICON_CONTAINER).addClass("hidden")},ba=function(a){a.find(l.LOAD_MORE_MESSAGES).removeClass("hidden")},ca=function(a){a.find(l.LOAD_MORE_MESSAGES).addClass("hidden")},da=function(a,b){return a.find('[data-contact-user-id="'+b+'"]')},ea=function(a,b){var c=v(a),d=da(c,b.userid);if(d.length){d.remove();var e=u(a);e.removeClass("hidden"),e.find(l.LIST).append(d)}c.find(l.LIST).children().length||c.addClass("hidden")},fa=function(a,b){var c=u(a),d=da(c,b);if(d.length){d.remove();var e=v(a);e.removeClass("hidden"),e.find(l.LIST).append(d)}c.find(l.LIST).children().length||c.addClass("hidden")},ga=function(a,b){var c=da(a,b);c.length&&c.find(l.BLOCK_ICON_CONTAINER).removeClass("hidden")},ha=function(a,b){var c=da(a,b);c.length&&c.find(l.BLOCK_ICON_CONTAINER).addClass("hidden")},ia=function(a,b){var c=u(a),d=c.find(l.LIST);return f.render(m.CONTACTS_LIST,{contacts:b}).then(function(a){return d.append(a),a})},ja=function(a,b){var c=v(a),d=c.find(l.LIST);return f.render(m.NON_CONTACTS_LIST,{noncontacts:b}).then(function(a){return d.append(a),a})},ka=function(a,b){var c=w(a),d=c.find(l.LIST);return f.render(m.MESSAGES_LIST,{messages:b}).then(function(a){return d.append(a),a})},la=function(b,c,d,e,f){var h=!1;return X(b),g.searchUsers(c,d,e+1,f).then(function(a){var b=a.contacts,c=a.noncontacts;return b.length<=e&&c.length<=e?(h=!0,{contacts:b,noncontacts:c}):{contacts:b.slice(0,e),noncontacts:c.slice(0,e)}}).then(function(c){var d=c.contacts.length,e=c.noncontacts.length;return a.when(!d||ia(b,c.contacts),!e||ja(b,c.noncontacts)).then(function(){return{contactsCount:d,nonContactsCount:e}})}).then(function(a){return Y(b),h&&$(b),a})["catch"](function(a){throw Y(b),a})},ma=function(a,b,c,d,e){var f=!1;return _(a),g.searchMessages(b,c,d+1,e).then(function(a){var b=a.contacts;return b.length<=d?(f=!0,b):b.slice(0,d)}).then(function(b){return b.length?ka(a,b).then(function(){return b.length}):b.length}).then(function(b){return aa(a),f&&ca(a),b})["catch"](function(b){throw aa(a),b})},na=function(b,c,d,e,f,g,h){var i=n(c);return V(b,c),U(c),a.when(la(c,i,d,e,f),ma(c,i,d,g,h)).then(function(a,d){var e=a.contactsCount,f=a.nonContactsCount;W(b,c),e||f||d?(e||f?(e||M(c),f||O(c)):K(c),d||Q(c)):H(c)})},oa=function(a,e){var f=n(e),g=s(a),m="",o=0,p=0,q=function(b,d){m=g.val().trim(),""!==m&&(o=0,p=0,na(a,e,m,k,p,i,o).then(function(){g.focus(),p+=k,o+=i})["catch"](c.exception)),d.originalEvent.preventDefault()};b.define(g,[b.events.enter]),b.define(a,[b.events.activate]),b.define(e,[b.events.activate]),g.on(b.events.enter,q),a.on(b.events.activate,l.SEARCH_ACTION,q),e.on(b.events.activate,l.LOAD_MORE_MESSAGES,function(a,b){""!==m&&ma(e,f,m,i,o).then(function(){o+=i})["catch"](c.exception),b.originalEvent.preventDefault()}),e.on(b.events.activate,l.LOAD_MORE_USERS,function(a,b){""!==m&&la(e,f,m,j,p).then(function(){p+=j})["catch"](c.exception),b.originalEvent.preventDefault()}),a.on(b.events.activate,l.CANCEL_SEARCH_BUTTON,function(){T(a),x(e),D(a),G(e),A(a),C(e),p=0,o=0}),d.subscribe(h.CONTACT_ADDED,function(a){ea(e,a)}),d.subscribe(h.CONTACT_REMOVED,function(a){fa(e,a)}),d.subscribe(h.CONTACT_BLOCKED,function(a){ga(e,a)}),d.subscribe(h.CONTACT_UNBLOCKED,function(a){ha(e,a)})},pa=function(b,c){c.attr("data-init")||(oa(b,c),c.attr("data-init",!0));var d=s(b);return d.focus(),a.Deferred().resolve().promise()},qa=function(a){var b=s(a),c=b.val().trim();return e.get_string("messagedrawerviewsearch","core_message",c)};return{show:pa,description:qa}});
define('core_message/notification_processor', ["jquery"],function(a){var b={STATE_NONE:'[data-state="none"]',STATE_BOTH:'[data-state="both"]',STATE_LOGGED_IN:'[data-state="loggedin"]',STATE_LOGGED_OFF:'[data-state="loggedoff"]'},c=function(b){this.root=a(b)};return c.prototype.getName=function(){return this.root.attr("data-processor-name")},c.prototype.isLoggedInEnabled=function(){var a=this.root.find(b.STATE_NONE).find("input");if(a.prop("checked"))return!1;var c=this.root.find(b.STATE_BOTH).find("input"),d=this.root.find(b.STATE_LOGGED_IN).find("input");return d.prop("checked")||c.prop("checked")},c.prototype.isLoggedOffEnabled=function(){var a=this.root.find(b.STATE_NONE).find("input");if(a.prop("checked"))return!1;var c=this.root.find(b.STATE_BOTH).find("input"),d=this.root.find(b.STATE_LOGGED_OFF).find("input");return d.prop("checked")||c.prop("checked")},c});
define('core_message/message_drawer_view_conversation', ["jquery","core/auto_rows","core/backoff_timer","core/custom_interaction_events","core/notification","core/pubsub","core/str","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_view_conversation_constants","core_message/message_drawer_view_conversation_patcher","core_message/message_drawer_view_conversation_renderer","core_message/message_drawer_view_conversation_state_manager","core_message/message_drawer_router","core_message/message_drawer_routes"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={},q=null,r=!1,s=0,t=null,u=!1,v=[],w=!0,x=!1,y=null,z=j.NEWEST_MESSAGES_FIRST,A=j.LOAD_MESSAGE_LIMIT,B=j.MILLISECONDS_IN_SEC,C=j.SELECTORS,D=j.CONVERSATION_TYPES,E=function(){if(!q||q.type!=D.PRIVATE)return null;var a=q.loggedInUserId,b=Object.keys(q.members).filter(function(b){return a!=b});return b.length?b[0]:null},F=function(a){return Object.keys(p).reduce(function(b,c){if(!b){var d=p[c].state;d.type==D.PRIVATE&&a in d.members&&(b=d.id)}return b},null)},G=function(a){return{id:parseInt(a.attr("data-user-id"),10),fullname:null,profileimageurl:null,profileimageurlsmall:null,isonline:null,showonlinestatus:null,isblocked:null,iscontact:null,isdeleted:null,canmessage:null,requirescontact:null,contactrequests:[]}},H=function(){return s},I=function(a){s=a,p[q.id].messagesOffset=a},J=function(){return r},K=function(a){r=a,p[q.id].loadedAllMessages=a},L=function(a){return a.find(C.MESSAGES_CONTAINER)},M=function(b){return{id:b.id,name:b.name,subname:b.subname,imageUrl:b.imageUrl,isFavourite:b.isFavourite,type:b.type,totalMemberCount:b.totalMemberCount,loggedInUserId:b.loggedInUserId,messages:b.messages.map(function(b){return a.extend({},b)}),members:Object.keys(b.members).map(function(c){var d=a.extend({},b.members[c]);return d.contactrequests=b.members[c].contactrequests.map(function(b){return a.extend({},b)}),d})}},N=function(a,b){var c=a.id,d=m.setLoadingMembers(q,!0);return d=m.setLoadingMessages(d,!0),y(d),h.getMemberInfo(c,[b],!0,!0).then(function(a){if(a.length)return a[0];throw new Error("Unable to load other user profile")}).then(function(b){var c=m.addMembers(q,[b,a]);return c=m.setLoadingMembers(c,!1),c=m.setLoadingMessages(c,!1),c=m.setName(c,b.fullname),c=m.setType(c,1),c=m.setImageUrl(c,b.profileimageurl),c=m.setTotalMemberCount(c,2),y(c),b})["catch"](function(a){var b=m.setLoadingMembers(q,!1);y(b),e.exception(a)})},O=function(a,b){var c=a.members.filter(function(a){return a.id!=b}),d=c.length?c[0]:null,e=a.name,f=a.imageurl;a.type==D.PRIVATE&&(e=e||d?d.fullname:"",f=f||d?d.profileimageurl:"");var g=m.addMembers(q,a.members);return g=m.setName(g,e),g=m.setSubname(g,a.subname),g=m.setType(g,a.type),g=m.setImageUrl(g,f),g=m.setTotalMemberCount(g,a.membercount),g=m.setIsFavourite(g,a.isfavourite),g=m.addMessages(g,a.messages)},P=function(a,b,c,d,f){var g=b.id,i=m.setLoadingMembers(q,!0);return i=m.setLoadingMessages(i,!0),y(i),h.getConversation(g,a,!0,!0,0,0,c+1,d,f).then(function(a){return a.messages.length>c?a.messages=a.messages.slice(1):K(!0),I(d+c),a}).then(function(a){var c=a.members.filter(function(a){return a.id==b.id});c.length<1&&(a.members=a.members.concat([b]));var d=O(a,b.id);return d=m.setLoadingMembers(d,!1),d=m.setLoadingMessages(d,!1),y(d).then(function(){return a})}).then(function(){return T(a)})["catch"](function(a){var b=m.setLoadingMembers(q,!1);b=m.setLoadingMessages(b,!1),y(b),e.exception(a)})},Q=function(a,b,c,d){var f=a.members.filter(function(a){return a.id==b.id});f.length<1&&(a.members=a.members.concat([b]));var g=a.messages.length,h=g>=c,i=O(a,b.id);i=m.setLoadingMembers(i,!1),i=m.setLoadingMessages(i,!h);var j=y(i);return j.then(function(){return h?{messages:a.messages}:R(a.id,c,g,d,[])}).then(function(){var a=q.messages;return I(a.length),T(q.id),a})["catch"](e.exception)},R=function(a,b,c,d,e,f){return h.getMessages(q.loggedInUserId,a,b?b+1:b,c,d,f).then(function(a){return a.messages.length&&e.length&&(a.messages=a.messages.filter(function(a){return e.indexOf(parseInt(a.id,10))<0})),a}).then(function(a){return b?(a.messages.length>b?a.messages=a.messages.slice(0,-1):K(!0),a):a}).then(function(a){var b=a.members.filter(function(a){return!(a.id in q.members)}),c=m.addMembers(q,b);return c=m.addMessages(c,a.messages),c=m.setLoadingMessages(c,!1),y(c).then(function(){return a})})["catch"](function(a){var b=m.setLoadingMessages(q,!1);throw y(b),a})},S=function(b,c){return function(){var d=q.messages,e=d.length?d[d.length-1]:null;if(e&&!w&&!x){for(var g=[],h=d.length-1;h>=0;h--){var j=d[h];if(j.timeCreated!==e.timeCreated)break;g.push(j.id)}return R(b,0,0,c,g,e.timeCreated).then(function(a){if(a.messages.length){t.restart();var c=M(q);return f.publish(i.CONVERSATION_NEW_LAST_MESSAGE,c),T(b)}return a})}return a.Deferred().resolve().promise()}},T=function(a){var b=q.loggedInUserId;return h.markAllConversationMessagesAsRead(b,a).then(function(){var b=m.markMessagesAsRead(q,q.messages);return f.publish(i.CONVERSATION_READ,a),y(b)})},U=function(a){ga(a);var b=m.addPendingBlockUsersById(q,[a]);y(b)},V=function(a){var b=m.setLoadingConfirmAction(q,!0);return y(b),h.blockUser(q.loggedInUserId,a).then(function(b){var c=m.addMembers(q,[b]);return c=m.removePendingBlockUsersById(c,[a]),c=m.setLoadingConfirmAction(c,!1),f.publish(i.CONTACT_BLOCKED,a),y(c)})},W=function(a){ga(a);var b=m.addPendingUnblockUsersById(q,[a]);y(b)},X=function(a){var b=m.setLoadingConfirmAction(q,!0);return y(b),h.unblockUser(q.loggedInUserId,a).then(function(b){var c=m.addMembers(q,[b]);return c=m.removePendingUnblockUsersById(c,[a]),c=m.setLoadingConfirmAction(c,!1),f.publish(i.CONTACT_UNBLOCKED,a),y(c)})},Y=function(a){ga(a);var b=m.addPendingRemoveContactsById(q,[a]);y(b)},Z=function(a){var b=m.setLoadingConfirmAction(q,!0);return y(b),h.deleteContacts(q.loggedInUserId,[a]).then(function(b){var c=m.addMembers(q,b);return c=m.removePendingRemoveContactsById(c,[a]),c=m.setLoadingConfirmAction(c,!1),f.publish(i.CONTACT_REMOVED,a),y(c)})},$=function(a){ga(a);var b=m.addPendingAddContactsById(q,[a]);y(b)},_=function(a){var b=m.setLoadingConfirmAction(q,!0);return y(b),h.createContactRequest(q.loggedInUserId,a).then(function(a){if(!a.request)throw new Error(a.warnings[0].message);return a.request}).then(function(b){var c=m.removePendingAddContactsById(q,[a]);return c=m.addContactRequests(c,[b]),c=m.setLoadingConfirmAction(c,!1),y(c)})},aa=function(){var a=q.loggedInUserId,b=q.id;return h.setFavouriteConversations(a,[b]).then(function(){var a=m.setIsFavourite(q,!0);return y(a)}).then(function(){return f.publish(i.CONVERSATION_SET_FAVOURITE,M(q))})},ba=function(){var a=q.loggedInUserId,b=q.id;return h.unsetFavouriteConversations(a,[b]).then(function(){var a=m.setIsFavourite(q,!1);return y(a)}).then(function(){return f.publish(i.CONVERSATION_UNSET_FAVOURITE,M(q))})},ca=function(a){var b=q.selectedMessageIds;ga(a);var c=m.addPendingDeleteMessagesById(q,b);y(c)},da=function(){var a=q.pendingDeleteMessageIds,b=m.setLoadingConfirmAction(q,!0);return y(b),h.deleteMessages(q.loggedInUserId,a).then(function(){var b=m.removeMessagesById(q,a);b=m.removePendingDeleteMessagesById(b,a),b=m.removeSelectedMessagesById(b,a),b=m.setLoadingConfirmAction(b,!1);var c=q.messages[q.messages.length-1],d=b.messages.length?b.messages[b.messages.length-1]:null;if(d&&d.id!=c.id){var e=M(b);f.publish(i.CONVERSATION_NEW_LAST_MESSAGE,e)}else b.messages.length||f.publish(i.CONVERSATION_DELETED,b.id);return y(b)})},ea=function(a){ga(a);var b=m.setPendingDeleteConversation(q,!0);y(b)},fa=function(){var a=m.setLoadingConfirmAction(q,!0);return y(a),h.deleteConversation(q.loggedInUserId,q.id).then(function(){var a=m.removeMessages(q,q.messages);return a=m.removeSelectedMessagesById(a,q.selectedMessageIds),a=m.setPendingDeleteConversation(a,!1),a=m.setLoadingConfirmAction(a,!1),f.publish(i.CONVERSATION_DELETED,a.id),y(a)})},ga=function(a){var b=q.pendingDeleteMessageIds,c=m.removePendingAddContactsById(q,[a]);c=m.removePendingRemoveContactsById(c,[a]),c=m.removePendingUnblockUsersById(c,[a]),c=m.removePendingBlockUsersById(c,[a]),c=m.removePendingDeleteMessagesById(c,b),c=m.setPendingDeleteConversation(c,!1),y(c)},ha=function(a){var b=q.loggedInUserId,c=q.members[a].contactrequests.filter(function(a){return a.requesteduserid==b}),d=c[0],e=m.setLoadingConfirmAction(q,!0);return y(e),h.acceptContactRequest(a,b).then(function(a){var b=m.removeContactRequests(q,[d]);return b=m.addMembers(q,[a]),b=m.setLoadingConfirmAction(b,!1),y(b)}).then(function(){f.publish(i.CONTACT_ADDED,q.members[a]),f.publish(i.CONTACT_REQUEST_ACCEPTED,d)})},ia=function(a){var b=q.loggedInUserId,c=q.members[a].contactrequests.filter(function(a){return a.requesteduserid==b}),d=c[0],e=m.setLoadingConfirmAction(q,!0);return y(e),h.declineContactRequest(a,b).then(function(a){var b=m.removeContactRequests(q,[d]);return b=m.addMembers(q,[a]),b=m.setLoadingConfirmAction(b,!1),y(b)}).then(function(){f.publish(i.CONTACT_REQUEST_DECLINED,d)})},ja=function(a,b){x=!0;var c=m.setSendingMessage(q,!0),d=null;y(c);var g=null;if(a||q.type!=D.PRIVATE)g=h.sendMessageToConversation(a,b);else{var j=E();g=h.sendMessageToUser(j,b).then(function(a){return d=parseInt(a.conversationid,10),a})}g.then(function(a){var b=m.addMessages(q,[a]);b=m.setSendingMessage(b,!1);var c=M(b);b.id||(b=m.setId(b,d),c.id=d,Aa(d),f.publish(i.CONVERSATION_CREATED,c)),y(b),x=!1,f.publish(i.CONVERSATION_NEW_LAST_MESSAGE,c)})["catch"](function(a){x=!1;var b=m.setSendingMessage(q,!1);y(b),e.exception(a)})},ka=function(a){var b=q;b=q.selectedMessageIds.indexOf(a)>-1?m.removeSelectedMessagesById(q,[a]):m.addSelectedMessagesById(q,[a]),y(b)},la=function(){ga(E());var a=m.removeSelectedMessagesById(q,q.selectedMessageIds);y(a)},ma=function(a,b,c){if(!u&&v.length){u=!0;var d=v.shift();l.render(a,b,c,d.patch).then(function(){u=!1,d.deferred.resolve(!0),ma(a,b,c)})["catch"](function(a){u=!1,d.deferred.reject(a),e.exception(a)})}},na=function(b,c,d){return function(e){var f=k.buildPatch(q,e),g=a.Deferred();return Object.keys(f).length?v.push({patch:f,deferred:g}):g.resolve(!0),q=e,e.id&&(p[e.id]={state:e,messagesOffset:H(),loadedAllMessages:J()}),ma(b,c,d),g.promise()}},oa=function(a){return function(b,c){if(!q.loadingConfirmAction){a(E());var d=m.setLoadingConfirmAction(q,!1);y(d)}c.originalEvent.preventDefault()}},pa=function(b,c){var d=a(b.target),e=d.closest(C.FOOTER_CONTAINER),f=e.find(C.MESSAGE_TEXT_AREA),g=f.val().trim();""!==g&&ja(q.id,g),c.originalEvent.preventDefault()},qa=function(b,c){var d=window.getSelection(),e=a(b.target);if(""==d.toString()&&!e.is("a")){var f=e.closest(C.MESSAGE),g=parseInt(f.attr("data-message-id"),10);ka(g),c.originalEvent.preventDefault()}},ra=function(a,b){la(),b.originalEvent.preventDefault()},sa=function(a,b){var c=E(),d=q.members[c];n.go(o.VIEW_CONTACT,d),b.originalEvent.preventDefault()},ta=function(a,b){aa()["catch"](e.exception),b.originalEvent.preventDefault()},ua=function(a,b){ba()["catch"](e.exception),b.originalEvent.preventDefault()},va=function(a,b){n.go(o.VIEW_GROUP_INFO,{id:q.id,name:q.name,subname:q.subname,imageUrl:q.imageUrl,totalMemberCount:q.totalMemberCount},q.loggedInUserId),b.originalEvent.preventDefault()},wa=[[C.ACTION_REQUEST_BLOCK,oa(U)],[C.ACTION_REQUEST_UNBLOCK,oa(W)],[C.ACTION_REQUEST_ADD_CONTACT,oa($)],[C.ACTION_REQUEST_REMOVE_CONTACT,oa(Y)],[C.ACTION_REQUEST_DELETE_CONVERSATION,oa(ea)],[C.ACTION_CANCEL_EDIT_MODE,ra],[C.ACTION_VIEW_CONTACT,sa],[C.ACTION_VIEW_GROUP_INFO,va],[C.ACTION_CONFIRM_FAVOURITE,ta],[C.ACTION_CONFIRM_UNFAVOURITE,ua]],xa=[[C.ACTION_CANCEL_CONFIRM,oa(ga)],[C.ACTION_CONFIRM_BLOCK,oa(V)],[C.ACTION_CONFIRM_UNBLOCK,oa(X)],[C.ACTION_CONFIRM_ADD_CONTACT,oa(_)],[C.ACTION_CONFIRM_REMOVE_CONTACT,oa(Z)],[C.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES,oa(da)],[C.ACTION_CONFIRM_DELETE_CONVERSATION,oa(fa)],[C.ACTION_REQUEST_ADD_CONTACT,oa($)],[C.ACTION_ACCEPT_CONTACT_REQUEST,oa(ha)],[C.ACTION_DECLINE_CONTACT_REQUEST,oa(ia)],[C.MESSAGE,qa]],ya=[[C.SEND_MESSAGE_BUTTON,pa],[C.ACTION_REQUEST_DELETE_SELECTED_MESSAGES,oa(ca)],[C.ACTION_REQUEST_ADD_CONTACT,oa($)],[C.ACTION_REQUEST_UNBLOCK,oa(W)]],za=function(a,c,g){var h=!1,j=L(c);b.init(g),d.define(a,[d.events.activate]),d.define(c,[d.events.activate]),d.define(g,[d.events.activate,d.events.enter]),d.define(j,[d.events.scrollTop,d.events.scrollLock]),j.on(d.events.scrollTop,function(a,b){var c=Object.keys(q.members).length>1;if(!w&&!h&&!J()&&c){h=!0;var d=m.setLoadingMessages(q,!0);y(d),R(q.id,A,H(),z,[]).then(function(){h=!1,I(H()+A)})["catch"](function(a){h=!1,e.exception(a)})}b.originalEvent.preventDefault()}),wa.forEach(function(b){var c=b[0],e=b[1];a.on(d.events.activate,c,e)}),xa.forEach(function(a){var b=a[0],e=a[1];c.on(d.events.activate,b,e)}),ya.forEach(function(a){var b=a[0],c=a[1];g.on(d.events.activate,b,c)}),g.on(d.events.enter,C.MESSAGE_TEXT_AREA,function(a,b){var c=g.attr("data-enter-to-send");c&&"false"!=c&&"0"!=c&&pa(a,b)}),f.subscribe(i.ROUTE_CHANGED,function(a){t&&a.route!=o.VIEW_CONVERSATION&&t.stop()})},Aa=function(a){t&&t.stop(),t=new c(S(a,z),c.getIncrementalCallback(q.messagePollMin*B,B,q.messagePollMax*B,q.messagePollAfterMax*B)),t.start()},Ba=function(a,b,c){w=!0,u=!1,v=[],x=!1;var d=c.id,e=parseInt(a.attr("data-midnight"),10),f=parseInt(a.attr("data-message-poll-min"),10),g=parseInt(a.attr("data-message-poll-max"),10),h=parseInt(a.attr("data-message-poll-after-max"),10),i=m.buildInitialState(e,d,b,f,g,h);q||(q=i),t&&t.stop(),y(i)},Ca=function(a,b,c){return Ba(a,null,b),h.getConversationBetweenUsers(b.id,c,!0,!0,0,0,A,0,z).then(function(c){return Ea(a,c,b)})["catch"](function(){return N(b,c)})},Da=function(b,c,d){var e=null;c in p&&(e=p[c]),Ba(b,c,d);var f=a.Deferred().resolve({}).promise();if(e){var g=e.state;g=m.setLoadingMessages(g,!1),g=m.setLoadingMembers(g,!1),I(e.messagesOffset),K(e.loadedAllMessages),y(g)}else f=P(c,d,A,0,z);return f.then(function(){return Aa(c)})},Ea=function(b,c,d){var e=null;c.id in p&&(e=p[c.id]),Ba(b,c.id,d);var f=a.Deferred().resolve({}).promise();if(e){var g=e.state;g=m.setLoadingMessages(g,!1),g=m.setLoadingMembers(g,!1),I(e.messagesOffset),K(e.loadedAllMessages),y(g)}else f=Q(c,d,A,z);return f.then(function(){return Aa(c.id)})},Fa=function(b,c,d,f,g,h){var i=null,k=null;f&&null!==f&&"object"==typeof f?(i=f,k=parseInt(i.id,10)):(i=null,k=parseInt(f,10),k=isNaN(k)?null:k),!k&&g&&h&&(k=F(h)),c.attr("data-init")||(y=na(b,c,d),za(b,c,d),c.attr("data-init",!0));var l=!q||q.id!=k||h&&h!=E();if(l){var m=null,n=G(c);return m=i?Ea(c,i,n,h):k?Da(c,k,n,h):Ca(c,n,h),m.then(function(){w=!1,b.find(j.SELECTORS.CAN_RECEIVE_FOCUS).first().focus()})["catch"](function(a){w=!1,e.exception(a)})}if(Aa(k),q.type==D.PRIVATE&&g){var o=E();switch(g){case"block":return U(o);case"unblock":return W(o);case"add-contact":return $(o);case"remove-contact":return Y(o)}}return a.Deferred().resolve().promise()},Ga=function(){return g.get_string("messagedrawerviewconversation","core_message",q.name)};return{show:Fa,description:Ga}});
define('core_message/preferences_processor_form', ["jquery","core/ajax","core/notification","core/custom_interaction_events"],function(a,b,c,d){var e=function(b){this.root=a(b),this.userId=this.root.attr("data-user-id"),this.name=this.root.attr("data-processor-name"),this.root.find("form").on("submit",function(b){b.preventDefault(),this.save().done(function(){a(document).trigger("mpp:formsubmitted")})}.bind(this));var c=this.root.find("[data-cancel-button]");d.define(c,[d.events.activate]),c.on(d.events.activate,function(){a(document).trigger("mpp:formcancelled")})};return e.prototype.startLoading=function(){this.root.addClass("loading")},e.prototype.stopLoading=function(){this.root.removeClass("loading")},e.prototype.isLoading=function(){return this.root.hasClass("loading")},e.prototype.save=function(){if(this.isLoading())return a.Deferred();this.startLoading();var d=this.root.find("form").serializeArray(),e={methodname:"core_message_message_processor_config_form",args:{userid:this.userId,name:this.name,formvalues:d}};return b.call([e])[0].fail(c.exception).always(function(){this.stopLoading()}.bind(this))},e});
define('core_message/message_repository', ["jquery","core/ajax","core/notification"],function(a,b,c){var d={PRIVATE:1,PUBLIC:2},e=function(a){"undefined"==typeof a.limit&&(a.limit=0),"undefined"==typeof a.offset&&(a.offset=0),"undefined"==typeof a.type&&(a.type=null),"undefined"==typeof a.favouritesonly&&(a.favouritesonly=!1),a.limitfrom=a.offset,a.limitnum=a.limit,delete a.limit,delete a.offset;var d={methodname:"core_message_data_for_messagearea_conversations",args:a},e=b.call([d])[0];return e.fail(c.exception),e},f=function(a){var d={methodname:"core_message_get_unread_conversations_count",args:a},e=b.call([d])[0];return e.fail(c.exception),e},g=function(a){var d={methodname:"core_message_mark_all_messages_as_read",args:a},e=b.call([d])[0];return e.fail(c.exception),e},h=function(a,c,d){var e={userid:a};"undefined"!=typeof c&&(e.limitnum=c),"undefined"!=typeof d&&(e.limitfrom=d);var f={methodname:"core_message_get_user_contacts",args:e};return b.call([f])[0]},i=function(a,c){var d={methodname:"core_message_data_for_messagearea_get_profile",args:{currentuserid:a,otheruserid:c}};return b.call([d])[0]},j=function(c,d){var e=[{methodname:"core_message_block_user",args:{userid:c,blockeduserid:d}},{methodname:"core_message_get_member_info",args:{referenceuserid:c,userids:[d],includecontactrequests:!0,includeprivacyinfo:!0}}];return a.when.apply(null,b.call(e)).then(function(a,b){return b.length?b[0]:{}})},k=function(c,d){var e=[{methodname:"core_message_unblock_user",args:{userid:c,unblockeduserid:d}},{methodname:"core_message_get_member_info",args:{referenceuserid:c,userids:[d],includecontactrequests:!0,includeprivacyinfo:!0}}];return a.when.apply(null,b.call(e)).then(function(a,b){return b.length?b[0]:{}})},l=function(a,c){var d={methodname:"core_message_create_contact_request",args:{userid:a,requesteduserid:c}};return b.call([d])[0]},m=function(c,d){var e=[{methodname:"core_message_delete_contacts",args:{userid:c,userids:d}},{methodname:"core_message_get_member_info",args:{referenceuserid:c,userids:d,includecontactrequests:!0,includeprivacyinfo:!0}}];return a.when.apply(null,b.call(e)).then(function(a,b){return b})},n=function(a,c,d,e,f,g){var h={currentuserid:a,convid:c,newest:!!f};"undefined"!=typeof d&&(h.limitnum=d),"undefined"!=typeof e&&(h.limitfrom=e),"undefined"!=typeof g&&(h.timefrom=g);var i={methodname:"core_message_get_conversation_messages",args:h};return b.call([i])[0]},o=function(a,c,d,e){var f={userid:a,search:c};"undefined"!=typeof d&&(f.limitnum=d),"undefined"!=typeof e&&(f.limitfrom=e);var g={methodname:"core_message_message_search_users",args:f};return b.call([g])[0]},p=function(a,c,d,e){var f={userid:a,search:c};"undefined"!=typeof d&&(f.limitnum=d),"undefined"!=typeof e&&(f.limitfrom=e);var g={methodname:"core_message_data_for_messagearea_search_messages",args:f};return b.call([g])[0]},q=function(a,c){var d=c.map(function(b){return{touserid:a,text:b}}),e={methodname:"core_message_send_instant_messages",args:{messages:d}};return b.call([e])[0].then(function(a){var b=a.reduce(function(a,b){return b.errormessage&&a.push(b.errormessage),a},[]);if(b.length)throw new Error(b.join("\n"));return a}).then(function(a){return a.map(function(a){return{id:a.msgid,text:a.text,timecreated:a.timecreated,useridfrom:a.useridfrom,conversationid:a.conversationid}})})},r=function(a,b){return q(a,[b]).then(function(a){return a[0]})},s=function(a,c){var d=c.map(function(a){return{text:a}}),e={methodname:"core_message_send_messages_to_conversation",args:{conversationid:a,messages:d}};return b.call([e])[0]},t=function(a,b){return s(a,[b]).then(function(a){return a[0]})},u=function(a,c){var d={methodname:"core_user_update_user_preferences",args:{userid:a,preferences:c}};return b.call([d])[0]},v=function(a){var c={methodname:"core_user_get_user_preferences",args:{userid:a}};return b.call([c])[0]},w=function(c,d){return a.when.apply(null,b.call(d.map(function(a){return{methodname:"core_message_delete_message",args:{messageid:a,userid:c}}})))},x=function(a,c){var d={methodname:"core_message_delete_conversations_by_id",args:{userid:a,conversationids:[c]}};return b.call([d])[0]},y=function(a){var c={methodname:"core_message_get_contact_requests",args:{userid:a}};return b.call([c])[0]},z=function(c,d){var e=[{methodname:"core_message_confirm_contact_request",args:{userid:c,requesteduserid:d}},{methodname:"core_message_get_member_info",args:{referenceuserid:d,userids:[c],includecontactrequests:!0,includeprivacyinfo:!0}}];return a.when.apply(null,b.call(e)).then(function(a,b){return b.length?b[0]:{}})},A=function(c,d){var e=[{methodname:"core_message_decline_contact_request",args:{userid:c,requesteduserid:d}},{methodname:"core_message_get_member_info",args:{referenceuserid:d,userids:[c],includecontactrequests:!0,includeprivacyinfo:!0}}];return a.when.apply(null,b.call(e)).then(function(a,b){return b.length?b[0]:{}})},B=function(a,c,d,e,f,g,h,i,j){var k={userid:a,conversationid:c};"undefined"!=typeof d&&null!==d&&(k.includecontactrequests=d),"undefined"!=typeof e&&null!==e&&(k.includeprivacyinfo=e),"undefined"!=typeof f&&null!==f&&(k.memberlimit=f),"undefined"!=typeof g&&null!==g&&(k.memberoffset=g),"undefined"!=typeof h&&null!==h&&(k.messagelimit=h),"undefined"!=typeof i&&null!==i&&(k.messageoffset=i),"undefined"!=typeof j&&null!==j&&(k.newestmessagesfirst=j);var l={methodname:"core_message_get_conversation",args:k};return b.call([l])[0]},C=function(a,c,d,e,f,g,h,i,j){var k={userid:a,otheruserid:c};"undefined"!=typeof d&&null!==d&&(k.includecontactrequests=d),"undefined"!=typeof e&&null!==e&&(k.includeprivacyinfo=e),"undefined"!=typeof f&&null!==f&&(k.memberlimit=f),"undefined"!=typeof g&&null!==g&&(k.memberoffset=g),"undefined"!=typeof h&&null!==h&&(k.messagelimit=h),"undefined"!=typeof i&&null!==i&&(k.messageoffset=i),"undefined"!=typeof j&&null!==j&&(k.newestmessagesfirst=j);var l={methodname:"core_message_get_conversation_between_users",args:k};return b.call([l])[0]},D=function(a,c,e,f,g){var h={userid:a,type:c};"undefined"!=typeof e&&null!==e&&(h.limitnum=e),"undefined"!=typeof f&&null!==f&&(h.limitfrom=f),"undefined"!=typeof g&&null!==g&&(h.favourites=g);var i={methodname:"core_message_get_conversations",args:h};return b.call([i])[0].then(function(a){return a.conversations.length&&(a.conversations=a.conversations.map(function(a){if(a.type==d.PRIVATE){var b=a.members.length?a.members[0]:null;b&&(a.name=a.name?a.name:b.fullname,a.imageurl=a.imageurl?a.imageurl:b.profileimageurl)}return a})),a})},E=function(a,c,d,e,f){var g={userid:c,conversationid:a};"undefined"!=typeof d&&null!==d&&(g.limitnum=d),"undefined"!=typeof e&&null!==e&&(g.limitfrom=e),"undefined"!=typeof f&&null!==f&&(g.includecontactrequests=f);var h={methodname:"core_message_get_conversation_members",args:g};return b.call([h])[0]},F=function(a,c){var d={methodname:"core_message_set_favourite_conversations",args:{userid:a,conversations:c}};return b.call([d])[0]},G=function(a,c){var d={methodname:"core_message_unset_favourite_conversations",args:{userid:a,conversations:c}};return b.call([d])[0]},H=function(a,c,d,e){var f={referenceuserid:a,userids:c};"undefined"!=typeof d&&(f.includecontactrequests=d),"undefined"!=typeof e&&(f.includeprivacyinfo=e);var g={methodname:"core_message_get_member_info",args:f};return b.call([g])[0]},I=function(a,c){var d={methodname:"core_message_mark_all_conversation_messages_as_read",args:{userid:a,conversationid:c}};return b.call([d])[0]},J=function(a){var c={methodname:"core_message_get_user_message_preferences",args:{userid:a}};return b.call([c])[0]},K=function(a){var c={methodname:"core_message_get_conversation_counts",args:{userid:a}};return b.call([c])[0]},L=function(a){var c={methodname:"core_message_get_unread_conversation_counts",args:{userid:a}};return b.call([c])[0]},M=function(c){var d=[{methodname:"core_message_get_conversation_counts",args:{userid:c}},{methodname:"core_message_get_unread_conversation_counts",args:{userid:c}}];return a.when.apply(null,b.call(d)).then(function(a,b){return{total:a,unread:b}})};return{query:e,countUnreadConversations:f,markAllAsRead:g,getContacts:h,getProfile:i,blockUser:j,unblockUser:k,createContactRequest:l,deleteContacts:m,getMessages:n,searchUsers:o,searchMessages:p,sendMessagesToUser:q,sendMessageToUser:r,sendMessagesToConversation:s,sendMessageToConversation:t,savePreferences:u,getPreferences:v,deleteMessages:w,deleteConversation:x,getContactRequests:y,acceptContactRequest:z,declineContactRequest:A,getConversation:B,getConversationBetweenUsers:C,getConversations:D,getConversationMembers:E,setFavouriteConversations:F,unsetFavouriteConversations:G,getMemberInfo:H,markAllConversationMessagesAsRead:I,getUserMessagePreferences:J,getTotalConversationCounts:K,getUnreadConversationCounts:L,getAllConversationCounts:M}});
define('core_message/message_drawer_view_contacts_section_contacts', ["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],function(a,b,c,d,e,f,g){var h=100,i=0,j={BLOCK_ICON_CONTAINER:'[data-region="block-icon-container"]',CONTACT:'[data-region="contact"]',CONTENT_CONTAINER:'[data-region="contacts-content-container"]'},k={CONTACTS_LIST:"core_message/message_drawer_contacts_list"},l=function(a,b){return a.find('[data-contact-user-id="'+b+'"]')},m=function(c,e){var f=e.map(function(b){return a.extend(b,{id:b.userid})});return d.render(k.CONTACTS_LIST,{contacts:f}).then(function(a){return c.append(a),a})["catch"](b.exception)},n=function(a,c){return e.getContacts(c,h+1,i).then(function(a){return a}).then(function(b){return b.length>h?b.pop():g.setLoadedAll(a,!0),b}).then(function(a){return i+=h,a})["catch"](b.exception)},o=function(a,b){l(a,b).remove()},p=function(a,b){var c=l(a,b);c.length&&c.find(j.BLOCK_ICON_CONTAINER).removeClass("hidden")},q=function(a,b){var c=l(a,b);c.length&&c.find(j.BLOCK_ICON_CONTAINER).addClass("hidden")},r=function(a){c.subscribe(f.CONTACT_ADDED,function(b){var c=g.getContentContainer(a);m(c,[b]),g.hideEmptyMessage(a),g.showContent(a)}),c.subscribe(f.CONTACT_REMOVED,function(b){o(a,b);var c=a.find(j.CONTACT);c.length||(g.hideContent(a),g.showEmptyMessage(a))}),c.subscribe(f.CONTACT_BLOCKED,function(b){p(a,b)}),c.subscribe(f.CONTACT_UNBLOCKED,function(b){q(a,b)})},s=function(a){a.attr("data-contacts-init")||(r(a),a.attr("data-contacts-init",!0)),g.show(a,n,m)};return{show:s}});
define('core_message/message_drawer_view_overview', ["jquery","core/key_codes","core/pubsub","core/str","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core_message/message_drawer_view_overview_section","core_message/message_repository"],function(a,b,c,d,e,f,g,h,i){var j={CONTACT_REQUEST_COUNT:'[data-region="contact-request-count"]',FAVOURITES:'[data-region="view-overview-favourites"]',GROUP_MESSAGES:'[data-region="view-overview-group-messages"]',MESSAGES:'[data-region="view-overview-messages"]',SEARCH_INPUT:'[data-region="view-overview-search-input"]',SECTION_TOGGLE_BUTTON:"[data-toggle]"},k={PRIVATE:1,PUBLIC:2,FAVOURITE:null},l=null,m=function(a){return null===l&&(l=i.getAllConversationCounts(a)),l},n=function(a,b){return b===k.FAVOURITE?a.favourites:a.types[b]},o=function(a){var b=a.some(function(a){var b=a[0];return h.isVisible(b)});if(!b){a.sort(function(a,b){var c=a[1],d=a[2],e=b[1],f=b[2];return d>0&&0==f?-1:0==d&&f>0?1:c>0&&0==e?-1:0==c&&e>0?1:0});var c=a[0][0],d=c.find(j.SECTION_TOGGLE_BUTTON);d.click()}},p=function(a){return a.find(j.SEARCH_INPUT)},q=function(a){return a.attr("data-user-id")},r=function(a){return function(){var b=a.find(j.CONTACT_REQUEST_COUNT),c=parseInt(b.text(),10);c=isNaN(c)?0:c-1,c<=0?b.addClass("hidden"):b.text(c)}},s=function(a){var d=p(a),h=[b.tab,b.shift,b.ctrl,b.alt];d.on("click",function(){e.go(f.VIEW_SEARCH)}),d.on("keydown",function(a){h.indexOf(a.keyCode)<0&&"Meta"!=a.key&&e.go(f.VIEW_SEARCH)}),c.subscribe(g.CONTACT_REQUEST_ACCEPTED,r(a)),c.subscribe(g.CONTACT_REQUEST_DECLINED,r(a))},t=function(a,b){a.attr("data-init")||(s(a),a.attr("data-init",!0)),p(a).val("");var c=q(b),d=m(c),e=[[b.find(j.FAVOURITES),k.FAVOURITE,!0],[b.find(j.GROUP_MESSAGES),k.PUBLIC,!1],[b.find(j.MESSAGES),k.PRIVATE,!1]];return e.forEach(function(a){var b=a[0],c=a[1],e=a[2],f=d.then(function(a){return n(a.total,c)}),g=d.then(function(a){return n(a.unread,c)});h.show(b,c,e,f,g)}),d.then(function(a){var b=e.map(function(b){var c=b[0],d=b[1],e=n(a.total,d),f=n(a.unread,d);return[c,e,f]});return o(b)})},u=function(){return d.get_string("messagedrawerviewoverview","core_message")};return{show:t,description:u}});
define('core_message/message_area_events', [],function(){return{CANCELDELETEMESSAGES:"cancel-delete-messages",CHOOSEMESSAGESTODELETE:"choose-messages-to-delete",CONTACTADDED:"contact-added",CONTACTBLOCKED:"contact-blocked",CONTACTREMOVED:"contact-removed",CONTACTSELECTED:"contact-selected",CONTACTSSELECTED:"contacts-selected",CONTACTUNBLOCKED:"contact-unblocked",CONVERSATIONDELETED:"conversation-deleted",CONVERSATIONSELECTED:"conversation-selected",CONVERSATIONSSELECTED:"conversations-selected",MESSAGESDELETED:"messages-deleted",MESSAGESEARCHCANCELED:"message-search-canceled",MESSAGESENT:"message-sent",SENDMESSAGE:"message-send",USERSSEARCHCANCELED:"users-search-canceled"}});
define('core_message/message_area_tabs', ["core/custom_interaction_events","core_message/message_area_events"],function(a,b){function c(a){this.messageArea=a,this._init()}var d={ACTIVECONTACTSTAB:"[data-region='contacts-area'] [role='tab'][aria-selected='true']",CONTACTSPANELS:"[data-region='contacts']",VIEWCONTACTS:"[data-action='contacts-view']",VIEWCONVERSATIONS:"[data-action='conversations-view']"};return c.prototype.messageArea=null,c.prototype._init=function(){a.define(this.messageArea.node,[a.events.activate,a.events.up,a.events.down,a.events.next,a.events.previous,a.events.ctrlPageUp,a.events.ctrlPageDown]),this.messageArea.onDelegateEvent(a.events.activate,d.VIEWCONVERSATIONS,this._viewConversations.bind(this)),this.messageArea.onDelegateEvent(a.events.activate,d.VIEWCONTACTS,this._viewContacts.bind(this)),this.messageArea.onDelegateEvent(a.events.up,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.down,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.next,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.previous,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.up,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.down,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.next,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.previous,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.ctrlPageUp,d.CONTACTSPANELS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.ctrlPageDown,d.CONTACTSPANELS,this._toggleTabs.bind(this)),this.messageArea.onCustomEvent(b.MESSAGESENT,function(){this._selectTab(d.VIEWCONVERSATIONS,d.VIEWCONTACTS)}.bind(this))},c.prototype._viewConversations=function(){this.messageArea.trigger(b.CONVERSATIONSSELECTED),this._selectTab(d.VIEWCONVERSATIONS,d.VIEWCONTACTS)},c.prototype._viewContacts=function(){this.messageArea.trigger(b.CONTACTSSELECTED),this._selectTab(d.VIEWCONTACTS,d.VIEWCONVERSATIONS)},c.prototype._selectTab=function(a,b){b=this.messageArea.find(b),b.removeClass("selected"),b.attr("aria-selected","false"),b.attr("tabindex","-1"),a=this.messageArea.find(a),a.addClass("selected"),a.attr("aria-selected","true"),a.attr("tabindex","0")},c.prototype._toggleTabs=function(a,b){var c=this.messageArea.find(d.ACTIVECONTACTSTAB);c.is(d.VIEWCONVERSATIONS)?this._viewContacts():this._viewConversations(),this.messageArea.find(d.ACTIVECONTACTSTAB).focus(),a.preventDefault(),a.stopPropagation(),b.originalEvent.preventDefault(),b.originalEvent.stopPropagation()},c});
define('core_message/message_area_actions', ["core_message/message_area_events"],function(a){function b(a){this.messageArea=a}var c={MESSAGES:"[data-region='messages']"};return b.prototype.messageArea=null,b.prototype.chooseMessagesToDelete=function(){0!==this.messageArea.find(c.MESSAGES).length&&this.messageArea.trigger(a.CHOOSEMESSAGESTODELETE)},b});
define('core_message/message_drawer_view_conversation_constants', [],function(){var a={ACTION_ACCEPT_CONTACT_REQUEST:'[data-action="accept-contact-request"]',ACTION_CANCEL_CONFIRM:'[data-action="cancel-confirm"]',ACTION_CANCEL_EDIT_MODE:'[data-action="cancel-edit-mode"]',ACTION_CONFIRM_ADD_CONTACT:'[data-action="confirm-add-contact"]',ACTION_CONFIRM_BLOCK:'[data-action="confirm-block"]',ACTION_CONFIRM_DELETE_SELECTED_MESSAGES:'[data-action="confirm-delete-selected-messages"]',ACTION_CONFIRM_DELETE_CONVERSATION:'[data-action="confirm-delete-conversation"]',ACTION_CONFIRM_FAVOURITE:'[data-action="confirm-favourite"]',ACTION_CONFIRM_UNFAVOURITE:'[data-action="confirm-unfavourite"]',ACTION_CONFIRM_REMOVE_CONTACT:'[data-action="confirm-remove-contact"]',ACTION_CONFIRM_UNBLOCK:'[data-action="confirm-unblock"]',ACTION_DECLINE_CONTACT_REQUEST:'[data-action="decline-contact-request"]',ACTION_REQUEST_ADD_CONTACT:'[data-action="request-add-contact"]',ACTION_REQUEST_BLOCK:'[data-action="request-block"]',ACTION_REQUEST_DELETE_CONVERSATION:'[data-action="request-delete-conversation"]',ACTION_REQUEST_DELETE_SELECTED_MESSAGES:'[data-action="delete-selected-messages"]',ACTION_REQUEST_REMOVE_CONTACT:'[data-action="request-remove-contact"]',ACTION_REQUEST_UNBLOCK:'[data-action="request-unblock"]',ACTION_VIEW_CONTACT:'[data-action="view-contact"]',ACTION_VIEW_GROUP_INFO:'[data-action="view-group-info"]',CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',CONFIRM_DIALOGUE_BUTTON_TEXT:'[data-region="dialogue-button-text"]',CONFIRM_DIALOGUE_CANCEL_BUTTON:'[data-action="cancel-confirm"]',CONFIRM_DIALOGUE_CONTAINER:'[data-region="confirm-dialogue-container"]',CONFIRM_DIALOGUE_HEADER:'[data-region="dialogue-header"]',CONFIRM_DIALOGUE_TEXT:'[data-region="dialogue-text"]',CONTACT_REQUEST_SENT_MESSAGE_CONTAINER:'[data-region="contact-request-sent-message-container"]',CONTENT_PLACEHOLDER_CONTAINER:'[data-region="content-placeholder"]',CONTENT_CONTAINER:'[data-region="content-container"]',CONTENT_MESSAGES_CONTAINER:'[data-region="content-message-container"]',CONTENT_MESSAGES_FOOTER_CONTAINER:'[data-region="content-messages-footer-container"]',CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER:'[data-region="content-messages-footer-edit-mode-container"]',CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER:'[data-region="content-messages-footer-require-contact-container"]',CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER:'[data-region="content-messages-footer-require-unblock-container"]',CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER:'[data-region="content-messages-footer-unable-to-message"]',DAY_MESSAGES_CONTAINER:'[data-region="day-messages-container"]',FAVOURITE_ICON_CONTAINER:'[data-region="favourite-icon-container"]',FOOTER_CONTAINER:'[data-region="content-messages-footer-container"]',HEADER:'[data-region="header-content"]',HEADER_EDIT_MODE:'[data-region="header-edit-mode"]',HEADER_PLACEHOLDER_CONTAINER:'[data-region="header-placeholder"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]',MESSAGE:'[data-region="message"]',MESSAGE_NOT_SELECTED:'[data-region="message"][aria-checked="false"]',MESSAGE_NOT_SELECTED_ICON:'[data-region="not-selected-icon"]',MESSAGE_SELECTED_ICON:'[data-region="selected-icon"]',MESSAGES:'[data-region="content-message-container"]',MESSAGES_CONTAINER:'[data-region="content-message-container"]',MESSAGES_SELECTED_COUNT:'[data-region="message-selected-court"]',MESSAGE_TEXT_AREA:'[data-region="send-message-txt"]',MORE_MESSAGES_LOADING_ICON_CONTAINER:'[data-region="more-messages-loading-icon-container"]',PLACEHOLDER_CONTAINER:'[data-region="placeholder-container"]',SEND_MESSAGE_BUTTON:'[data-action="send-message"]',SEND_MESSAGE_ICON_CONTAINER:'[data-region="send-icon-container"]',TEXT:'[data-region="text"]',TITLE:'[data-region="title"]'},b={HEADER_PRIVATE:"core_message/message_drawer_view_conversation_header_content_type_private",HEADER_PRIVATE_NO_CONTROLS:"core_message/message_drawer_view_conversation_header_content_type_private_no_controls",HEADER_PUBLIC:"core_message/message_drawer_view_conversation_header_content_type_public",DAY:"core_message/message_drawer_view_conversation_body_day",MESSAGE:"core_message/message_drawer_view_conversation_body_message",MESSAGES:"core_message/message_drawer_view_conversation_body_messages"},c={PRIVATE:1,PUBLIC:2};return{SELECTORS:a,TEMPLATES:b,CONVERSATION_TYPES:c,NEWEST_MESSAGES_FIRST:!0,LOAD_MESSAGE_LIMIT:100,MILLISECONDS_IN_SEC:1e3}});
define('core_message/message_drawer_view_conversation_renderer', ["jquery","core/notification","core/str","core/templates","core/user_date","core_message/message_drawer_view_conversation_constants"],function(a,b,c,d,e,f){var g=f.SELECTORS,h=f.TEMPLATES,i=f.CONVERSATION_TYPES,j=function(a){return a.find(g.CONTENT_MESSAGES_CONTAINER)},k=function(a){j(a).removeClass("hidden")},l=function(a){j(a).addClass("hidden")},m=function(a){return a.find(g.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER)},n=function(a){return m(a).addClass("hidden")},o=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_CONTAINER)},p=function(a){o(a).removeClass("hidden")},q=function(a){o(a).addClass("hidden")},r=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER)},s=function(a){r(a).removeClass("hidden")},t=function(a){r(a).addClass("hidden")},u=function(a){return a.find(g.PLACEHOLDER_CONTAINER)},v=function(a){u(a).removeClass("hidden")},w=function(a){u(a).addClass("hidden")},x=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER)},y=function(a){x(a).removeClass("hidden")},z=function(a){x(a).addClass("hidden")},A=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER)},B=function(a){A(a).removeClass("hidden")},C=function(a){A(a).addClass("hidden")},D=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER)},E=function(a){D(a).removeClass("hidden")},F=function(a){D(a).addClass("hidden")},G=function(a){N(a),Q(a),T(a)},H=function(a){q(a),t(a),w(a),z(a),C(a),F(a)},I=function(a){return a.find(g.CONTENT_PLACEHOLDER_CONTAINER)},J=function(a){I(a).removeClass("hidden")},K=function(a){I(a).addClass("hidden")},L=function(a){return a.find(g.HEADER)},M=function(a){L(a).removeClass("hidden")},N=function(a){L(a).addClass("hidden")},O=function(a){return a.find(g.HEADER_EDIT_MODE)},P=function(a){O(a).removeClass("hidden")},Q=function(a){O(a).addClass("hidden")},R=function(a){return a.find(g.HEADER_PLACEHOLDER_CONTAINER)},S=function(a){R(a).removeClass("hidden")},T=function(a){R(a).addClass("hidden")},U=function(a){return a.find(g.MESSAGE_TEXT_AREA)},V=function(a,b){var c=j(a);return c.find('[data-message-id="'+b+'"]')},W=function(a,b){var c=j(a);return c.find('[data-day-id="'+b+'"]')},X=function(a){return a.find(g.MORE_MESSAGES_LOADING_ICON_CONTAINER)},Y=function(a){X(a).removeClass("hidden")},Z=function(a){X(a).addClass("hidden")},$=function(a){a.find(g.SEND_MESSAGE_BUTTON).prop("disabled",!0),U(a).prop("disabled",!0)},_=function(a){a.find(g.SEND_MESSAGE_BUTTON).prop("disabled",!1),U(a).prop("disabled",!1)},aa=function(a){$(a),a.find(g.SEND_MESSAGE_ICON_CONTAINER).addClass("hidden"),a.find(g.LOADING_ICON_CONTAINER).removeClass("hidden")},ba=function(a){_(a),a.find(g.SEND_MESSAGE_ICON_CONTAINER).removeClass("hidden"),a.find(g.LOADING_ICON_CONTAINER).addClass("hidden")},ca=function(a){var b=U(a);b.val(""),b.focus()},da=function(a){return a.find(g.CONFIRM_DIALOGUE_CONTAINER)},ea=function(a){var b=da(a),c=b.siblings(":not(.hidden)");c.attr("aria-hidden",!0),c.attr("tabindex",-1),c.attr("data-confirm-dialogue-hidden",!0),b.removeClass("hidden")},fa=function(a){var b=da(a),c=b.siblings('[data-confirm-dialogue-hidden="true"]');c.removeAttr("aria-hidden"),c.removeAttr("tabindex"),c.removeAttr("data-confirm-dialogue-hidden"),b.addClass("hidden")},ga=function(a,b){O(a).find(g.MESSAGES_SELECTED_COUNT).text(b)},ha=function(a,b){return a.map(function(a){return{id:a.id,isread:a.isRead,fromloggedinuser:a.fromLoggedInUser,userfrom:a.userFrom,text:a.text,formattedtime:b[a.timeCreated]}})},ia=function(b,c,e,f,g){var i=j(c),k=f.map(function(a){return d.render(h.DAY,{timestamp:a.value.timestamp,messages:ha(a.value.messages,g)})});return a.when.apply(a,k).then(function(){f.forEach(function(b,d){k[d].then(function(d){if(b.before){var e=W(c,b.before.timestamp);return a(d).insertBefore(e)}return i.append(d)})["catch"](function(){})})})},ja=function(b,c,e,f,i){var j=f.map(function(a){return a.value}),k=ha(j,i);return d.render(h.MESSAGES,{messages:k}).then(function(b){var d=a(b);f.forEach(function(a){var b=d.find('[data-message-id="'+a.value.id+'"]');if(a.before){var e=V(c,a.before.id);return b.insertBefore(e)}var f=W(c,a.day.timestamp),h=f.find(g.DAY_MESSAGES_CONTAINER);return h.append(b)})})},ka=function(a,b){b.forEach(function(b){W(a,b.timestamp).remove()})},la=function(a,b){b.forEach(function(b){V(a,b.id).remove()})},ma=function(b,d,f,g){var h=[],i=g.days.add.length>0,j=g.messages.add.length>0,k=[],l=a.Deferred().resolve({}).promise();return i&&(k=k.concat(g.days.add.reduce(function(a,b){return a.concat(b.value.messages.map(function(a){return a.timeCreated}))},[]))),j&&(k=k.concat(g.messages.add.map(function(a){return a.value.timeCreated}))),k.length&&(l=c.get_string("strftimetime24","core_langconfig").then(function(a){var b=k.map(function(b){return{timestamp:b,format:a}});return e.get(b)}).then(function(a){return k.reduce(function(b,c,d){return b[c]=a[d],b},{})})),i&&h.push(l.then(function(a){return ia(b,d,f,g.days.add,a)})),j&&h.push(l.then(function(a){return ja(b,d,f,g.messages.add,a)})),g.days.remove.length>0&&ka(d,g.days.remove),g.messages.remove.length>0&&la(d,g.messages.remove),a.when.apply(a,h)},na=function(a,b,c,e){var f=L(a),g=h.HEADER_PUBLIC;return e.type==i.PRIVATE&&(g=e.showControls?h.HEADER_PRIVATE:h.HEADER_PRIVATE_NO_CONTROLS),d.render(g,e.context).then(function(a,b){d.replaceNodeContents(f,a,b)})},oa=function(a,b,d,e){switch(H(d),e.type){case"placeholder":return v(d);case"add-contact":return c.get_strings([{key:"requirecontacttomessage",component:"core_message",param:e.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:e.user.fullname}]).then(function(a){var b=a[1],c=a[0],e=x(d);return e.find(g.TITLE).text(b),e.find(g.TEXT).text(c),y(d),a});case"edit-mode":return s(d);case"content":return p(d);case"unblock":return B(d);case"unable-to-message":return E(d)}return!0},pa=function(a,b,c,d){var e=j(b),f=V(b,d),g=f.position();if(g){var h=e.scrollTop()+g.top;e.scrollTop(h)}},qa=function(a,b,c,d){d?(N(a),S(a)):(M(a),T(a))},ra=function(a,b,c,d){d?(l(b),J(b)):(k(b),K(b))},sa=function(a,b,c,d){d?Y(b):Z(b)},ta=function(a,b,c,d){d?aa(c):(ba(c),ca(c))},ua=function(a,b,c,d,e,f,h,i){var j=da(b),k=d.map(function(a){return j.find(a)}),l=j.find(g.CONFIRM_DIALOGUE_CANCEL_BUTTON),m=j.find(g.CONFIRM_DIALOGUE_TEXT),n=j.find(g.CONFIRM_DIALOGUE_HEADER);j.find("button").addClass("hidden"),h?l.removeClass("hidden"):l.addClass("hidden"),f?(n.removeClass("hidden"),n.text(f)):(n.addClass("hidden"),n.text("")),k.forEach(function(a){a.removeClass("hidden")}),m.text(e),ea(c),ea(b),i||ea(a),j.find(g.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()},va=function(a,b,c){var d=da(b),e=d.find(g.CONFIRM_DIALOGUE_CANCEL_BUTTON),f=d.find(g.CONFIRM_DIALOGUE_TEXT),h=d.find(g.CONFIRM_DIALOGUE_HEADER);return fa(b),fa(c),fa(a),d.find("button").addClass("hidden"),e.removeClass("hidden"),f.text(""),h.addClass("hidden"),h.text(""),a.find(g.CAN_RECEIVE_FOCUS).first().focus(),!0},wa=function(a,b,d,e){return e?c.get_string("blockuserconfirm","core_message",e.fullname).then(function(c){return ua(a,b,d,[g.ACTION_CONFIRM_BLOCK],c,"",!0,!1)}):va(a,b,d)},xa=function(a,b,d,e){return e?c.get_string("unblockuserconfirm","core_message",e.fullname).then(function(c){return ua(a,b,d,[g.ACTION_CONFIRM_UNBLOCK],c,"",!0,!1)}):va(a,b,d)},ya=function(a,b,d,e){return e?c.get_string("addcontactconfirm","core_message",e.fullname).then(function(c){return ua(a,b,d,[g.ACTION_CONFIRM_ADD_CONTACT],c,"",!0,!1)}):va(a,b,d)},za=function(a,b,d,e){return e?c.get_string("removecontactconfirm","core_message",e.fullname).then(function(c){return ua(a,b,d,[g.ACTION_CONFIRM_REMOVE_CONTACT],c,"",!0,!1)}):va(a,b,d)},Aa=function(a,b,d,e){return e?c.get_string("deleteselectedmessagesconfirm","core_message").then(function(c){return ua(a,b,d,[g.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],c,"",!0,!1)}):va(a,b,d)},Ba=function(a,b,d,e){return e?c.get_string("deleteallconfirm","core_message").then(function(c){return ua(a,b,d,[g.ACTION_CONFIRM_DELETE_CONVERSATION],c,"",!0,!1)}):va(a,b,d)},Ca=function(a,b,d,e){return e?c.get_string("userwouldliketocontactyou","core_message",e.fullname).then(function(c){var e=[g.ACTION_ACCEPT_CONTACT_REQUEST,g.ACTION_DECLINE_CONTACT_REQUEST];return ua(a,b,d,e,c,"",!1,!0)}):va(a,b,d)},Da=function(a,b,c,d){d?(a.find(g.ACTION_REQUEST_BLOCK).addClass("hidden"),a.find(g.ACTION_REQUEST_UNBLOCK).removeClass("hidden")):(a.find(g.ACTION_REQUEST_BLOCK).removeClass("hidden"),a.find(g.ACTION_REQUEST_UNBLOCK).addClass("hidden"))},Ea=function(a,b,c,d){var e=a.find(g.FAVOURITE_ICON_CONTAINER),f=a.find(g.ACTION_CONFIRM_FAVOURITE),h=a.find(g.ACTION_CONFIRM_UNFAVOURITE);switch(d){case"hide":e.addClass("hidden"),f.addClass("hidden"),h.addClass("hidden");break;case"show-add":e.addClass("hidden"),f.removeClass("hidden"),h.addClass("hidden");break;case"show-remove":e.removeClass("hidden"),f.addClass("hidden"),h.removeClass("hidden")}},Fa=function(a,b,c,d){var e=a.find(g.ACTION_REQUEST_ADD_CONTACT),f=a.find(g.ACTION_REQUEST_REMOVE_CONTACT);switch(d){case"pending-contact":e.addClass("hidden"),f.addClass("hidden");break;case"contact":e.addClass("hidden"),f.removeClass("hidden");break;case"non-contact":e.removeClass("hidden"),f.addClass("hidden")}},Ga=function(a,b,c,d){var e=da(b),f=e.find("button"),h=e.find(g.CONFIRM_DIALOGUE_BUTTON_TEXT),i=e.find(g.LOADING_ICON_CONTAINER);d?(f.prop("disabled",!0),h.addClass("hidden"),i.removeClass("hidden")):(f.prop("disabled",!1),h.removeClass("hidden"),i.addClass("hidden"))},Ha=function(a,b,c,d){var e=null;d?(e=b.find(g.MESSAGE_NOT_SELECTED),e.find(g.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden"),N(a),P(a)):(e=j(b),e.find(g.MESSAGE_NOT_SELECTED_ICON).addClass("hidden"),e.find(g.MESSAGE_SELECTED_ICON).addClass("hidden"),M(a),Q(a))},Ia=function(a,b,c,d){var e=d.count>0;d.add.length&&d.add.forEach(function(a){var c=V(b,a);c.find(g.MESSAGE_NOT_SELECTED_ICON).addClass("hidden"),c.find(g.MESSAGE_SELECTED_ICON).removeClass("hidden"),c.attr("aria-checked",!0)}),d.remove.length&&d.remove.forEach(function(a){var c=V(b,a);e&&c.find(g.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden"),c.find(g.MESSAGE_SELECTED_ICON).addClass("hidden"),c.attr("aria-checked",!1)}),ga(a,d.count)},Ja=function(a,b,d,e){return e.show&&!e.hasMessages?c.get_strings([{key:"requirecontacttomessage",component:"core_message",param:e.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:e.user.fullname}]).then(function(c){var e=c[1],f=c[0];return ua(a,b,d,[g.ACTION_REQUEST_ADD_CONTACT],f,e,!1,!0)}):va(a,b,d)},Ka=function(a,b,d,e){var f=m(b);return e?c.get_string("yourcontactrequestpending","core_message",e).then(function(a){return f.find(g.TEXT).text(a),f.removeClass("hidden"),a}):(f.addClass("hidden"),!0)},La=function(a,b,c){return va(a,b,c),n(b),G(a),S(a),H(c),v(c),!0},Ma=function(c,d,e,f){var g=[{reset:La},{conversation:ma,header:na,footer:oa,confirmBlockUser:wa,confirmUnblockUser:xa,confirmAddContact:ya,confirmRemoveContact:za,confirmDeleteSelectedMessages:Aa,confirmDeleteConversation:Ba,confirmContactRequest:Ca,requireAddContact:Ja,contactRequestSent:Ka},{loadingMembers:qa,loadingFirstMessages:ra,loadingMessages:sa,sendingMessage:ta,isBlocked:Da,isContact:Fa,isFavourite:Ea,loadingConfirmAction:Ga,inEditMode:Ha},{scrollToMessage:pa,selectedMessages:Ia}],h=function(a){var b=[];for(var g in f)if(a.hasOwnProperty(g)){var h=a[g],i=f[g];b.push(h(c,d,e,i))}return b},i=h(g[0]);return i=i.concat(h(g[1])),a.when.apply(a,i).then(function(){for(var a=2;a<g.length;a++)h(g[a])})["catch"](b.exception)};return{render:Ma}});
define('core_message/message_notification_preference', ["jquery","core_message/notification_preference"],function(a,b){var c={PREFERENCE_KEY:"[data-preference-key]"},d=function(a,c){b.call(this,a,c)};return d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.getPreferenceKey=function(){return this.root.find(c.PREFERENCE_KEY).attr("data-preference-key")},d});
define('core_message/message_area_messages', ["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events","core/auto_rows","core_message/message_area_actions","core/modal_factory","core/modal_events","core/str","core_message/message_area_events","core/backoff_timer"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){this.messageArea=a,this._init()}var n=500,o=50,p={BLOCKTIME:"[data-region='blocktime']",CANCELDELETEMESSAGES:"[data-action='cancel-delete-messages']",CONTACT:"[data-region='contact']",CONVERSATIONS:"[data-region='contacts'][data-region-content='conversations']",DELETEALLMESSAGES:"[data-action='delete-all-messages']",DELETEMESSAGES:"[data-action='delete-messages']",LOADINGICON:".loading-icon",MESSAGE:"[data-region='message']",MESSAGERESPONSE:"[data-region='response']",MESSAGES:"[data-region='messages']",MESSAGESAREA:"[data-region='messages-area']",MESSAGINGAREA:"[data-region='messaging-area']",SENDMESSAGE:"[data-action='send-message']",SENDMESSAGETEXT:"[data-region='send-message-txt']",SHOWCONTACTS:"[data-action='show-contacts']",STARTDELETEMESSAGES:"[data-action='start-delete-messages']"},q=1e3;return m.prototype._isSendingMessage=!1,m.prototype._isLoadingMessages=!1,m.prototype._numMessagesDisplayed=0,m.prototype._messageQueue=[],m.prototype._numMessagesToRetrieve=20,m.prototype._confirmationModal=null,m.prototype._latestMessageTimestamp=0,m.prototype._backoffTimer=null,m.prototype.messageArea=null,m.prototype._init=function(){e.define(this.messageArea.node,[e.events.activate,e.events.up,e.events.down,e.events.enter]),a(window).height()<=670&&(n=400),f.init(this.messageArea.node),this.messageArea.onCustomEvent(k.CONVERSATIONSELECTED,this._viewMessages.bind(this)),this.messageArea.onCustomEvent(k.SENDMESSAGE,this._viewMessages.bind(this)),this.messageArea.onCustomEvent(k.CHOOSEMESSAGESTODELETE,this._chooseMessagesToDelete.bind(this)),this.messageArea.onCustomEvent(k.CANCELDELETEMESSAGES,this._hideDeleteAction.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.SENDMESSAGE,this._sendMessage.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.STARTDELETEMESSAGES,this._startDeleting.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.DELETEMESSAGES,this._deleteMessages.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.DELETEALLMESSAGES,this._deleteAllMessages.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.CANCELDELETEMESSAGES,this._triggerCancelMessagesToDelete.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.MESSAGE,this._toggleMessage.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.SHOWCONTACTS,this._hideMessagingArea.bind(this)),this.messageArea.onDelegateEvent(e.events.up,p.MESSAGE,this._selectPreviousMessage.bind(this)),this.messageArea.onDelegateEvent(e.events.down,p.MESSAGE,this._selectNextMessage.bind(this)),this.messageArea.onDelegateEvent("focus",p.SENDMESSAGETEXT,this._setMessaging.bind(this)),this.messageArea.onDelegateEvent("blur",p.SENDMESSAGETEXT,this._clearMessaging.bind(this)),a(document).on(f.events.ROW_CHANGE,this._adjustMessagesAreaHeight.bind(this));var b=this.messageArea.find(p.MESSAGES);b.length&&(this._addScrollEventListener(b.find(p.MESSAGE).length),this._latestMessageTimestamp=b.find(p.MESSAGE+":last").data("timecreated")),this._backoffTimer=new l(this._loadNewMessages.bind(this),l.getIncrementalCallback(this.messageArea.pollmin*q,q,this.messageArea.pollmax*q,this.messageArea.polltimeout*q)),this._backoffTimer.start()},m.prototype._viewMessages=function(e,f){this._numMessagesDisplayed=0,this._backoffTimer.stop(),this._latestMessageTimestamp=0;var g=b.call([{methodname:"core_message_mark_all_messages_as_read",args:{useridto:this.messageArea.getCurrentUserId(),useridfrom:f}}]),h=0;return c.render("core/loading",{}).then(function(a,b){return c.replaceNodeContents(this.messageArea.find(p.MESSAGESAREA),a,b),g[0]}.bind(this)).then(function(){var b=this.messageArea.find(p.CONVERSATIONS+" "+p.CONTACT+"[data-userid='"+f+"']");return b.hasClass("unread")&&(b.removeClass("unread"),a(document).trigger("messagearea:conversationselected",f)),this._getMessages(f)}.bind(this)).then(function(a){return h=a.messages.length,c.render("core_message/message_area_messages_area",a)}).then(function(a,b){c.replaceNodeContents(this.messageArea.find(p.MESSAGESAREA),a,b),this._addScrollEventListener(h),this._backoffTimer.restart(),this.messageArea.find(p.SENDMESSAGETEXT).focus()}.bind(this)).fail(d.exception)},m.prototype._loadMessages=function(){if(this._isLoadingMessages)return!1;this._isLoadingMessages=!0;var b=0;return c.render("core/loading",{}).then(function(a,b){return c.prependNodeContents(this.messageArea.find(p.MESSAGES),"<div style='text-align:center'>"+a+"</div>",b),this._getMessages(this._getUserId())}.bind(this)).then(function(a){return b=a.messages.length,c.render("core_message/message_area_messages",a)}).then(function(d,e){if(this.messageArea.find(p.MESSAGES+" "+p.LOADINGICON).remove(),b>0){var f=a("<div>"+d+"</div>");this._hasMatchingBlockTime(this.messageArea.node,f,!0)&&this.messageArea.node.find(p.BLOCKTIME+":first").remove();var g=this.messageArea.find(p.MESSAGES)[0].scrollHeight;c.prependNodeContents(this.messageArea.find(p.MESSAGES),d,e);var h=this.messageArea.find(p.MESSAGES)[0].scrollHeight;this.messageArea.find(p.MESSAGES).scrollTop(h-g),this._numMessagesDisplayed+=b}this._isLoadingMessages=!1}.bind(this)).fail(d.exception)},m.prototype._loadNewMessages=function(){if(this._isLoadingMessages)return!1;if(!this._getUserId())return!1;this._isLoadingMessages=!0;var a=!1,b=this.messageArea.find(p.MESSAGES);if(0!==b.length){var c=b.scrollTop(),e=b.innerHeight(),f=b[0].scrollHeight;c+e>=f&&(a=!0)}return this._getMessages(this._getUserId(),!0).then(function(b){return this._addMessagesToDom(b.messages,a)}.bind(this)).always(function(){this._isLoadingMessages=!1}.bind(this)).fail(d.exception)},m.prototype._getMessages=function(a,c){var e={currentuserid:this.messageArea.getCurrentUserId(),otheruserid:a,limitfrom:this._numMessagesDisplayed,limitnum:this._numMessagesToRetrieve,newest:!0};c&&(e.timefrom=this._latestMessageTimestamp,e.limitfrom=0,e.limitnum=0);var f=b.call([{methodname:"core_message_data_for_messagearea_messages",args:e}]);return f[0].then(function(a){var b=a.messages;if(b&&b.length){var c=b[b.length-1];c.timecreated>this._latestMessageTimestamp&&(this._latestMessageTimestamp=c.timecreated+1)}return a}.bind(this)).fail(function(a){this._backoffTimer.stop(),d.exception(a)}.bind(this))},m.prototype._sendMessage=function(){var a=this.messageArea.find(p.SENDMESSAGETEXT),c=a.val().trim();if(""===c)return!1;if(this._isSendingMessage)return!1;this._isSendingMessage=!0;var e=b.call([{methodname:"core_message_send_instant_messages",args:{messages:[{touserid:this._getUserId(),text:c}]}}]);return a.prop("disabled",!0),e[0].then(function(a){if(a.length<0)throw new Error("Invalid response");if(a[0].errormessage)throw new Error(a[0].errormessage);return this.messageArea.trigger(k.MESSAGESENT,[this._getUserId(),c]),this._addLastMessageToDom()}.bind(this)).then(function(){this._isSendingMessage=!1}.bind(this)).always(function(){a.prop("disabled",!1),a.focus()}).fail(d.exception)},m.prototype._chooseMessagesToDelete=function(){this.messageArea.find(p.MESSAGESAREA).addClass("editing"),this.messageArea.find(p.MESSAGE).attr("role","checkbox").attr("aria-checked","false")},m.prototype._deleteMessages=function(){var c=this.messageArea.getCurrentUserId(),e=this.messageArea.find(p.MESSAGE+"[aria-checked='true']"),f=[],g=[];e.each(function(b,d){var e=a(d),h=e.data("messageid"),i=e.data("messageread")?1:0;g.push(e),f.push({methodname:"core_message_delete_message",args:{messageid:h,userid:c,read:i}})}),f.length>0?a.when(b.call(f)).then(function(){var b=null,c=this.messageArea.find(p.MESSAGE),d=c.last(),e=g[g.length-1];a.each(g,function(a,b){b.remove()}),d.data("id")===e.data("id")&&(b=this.messageArea.find(p.MESSAGE).last()),a.each(g,function(a,b){var c=b.data("blocktime");0===this.messageArea.find(p.MESSAGE+"[data-blocktime='"+c+"']").length&&this.messageArea.find(p.BLOCKTIME+"[data-blocktime='"+c+"']").remove()}.bind(this)),0===this.messageArea.find(p.MESSAGE).length&&this.messageArea.find(p.CONVERSATIONS+" "+p.CONTACT+"[data-userid='"+this._getUserId()+"']").remove(),this.messageArea.trigger(k.MESSAGESDELETED,[this._getUserId(),b])}.bind(this))["catch"](d.exception):this.messageArea.trigger(k.MESSAGESDELETED,this._getUserId()),this._hideDeleteAction()},m.prototype._addScrollEventListener=function(a){this._scrollBottom(),this._numMessagesDisplayed=a,e.define(this.messageArea.find(p.MESSAGES),[e.events.scrollTop]),this.messageArea.onCustomEvent(e.events.scrollTop,this._loadMessages.bind(this))},m.prototype._deleteAllMessages=function(){if(this._confirmationModal)return void this._confirmationModal.show();var c=j.get_strings([{key:"confirm"},{key:"deleteallconfirm",component:"message"},{key:"delete"}]),e=h.create({type:h.types.SAVE_CANCEL},this.messageArea.find(p.DELETEALLMESSAGES));a.when(c,e).then(function(a,c){c.setTitle(a[0]),c.setBody(a[1]),c.setSaveButtonText(a[2]),this._confirmationModal=c,c.getRoot().on(i.save,function(){var a=this._getUserId(),c={methodname:"core_message_delete_conversation",args:{userid:this.messageArea.getCurrentUserId(),otheruserid:a}};b.call([c])[0].then(function(){this.messageArea.find(p.MESSAGESAREA).empty(),this.messageArea.trigger(k.CONVERSATIONDELETED,a),this._hideDeleteAction()}.bind(this))["catch"](d.exception)}.bind(this)),c.show()}.bind(this))["catch"](d.exception)},m.prototype._hideDeleteAction=function(){this.messageArea.find(p.MESSAGE).removeAttr("role").removeAttr("aria-checked"),this.messageArea.find(p.MESSAGESAREA).removeClass("editing")},m.prototype._triggerCancelMessagesToDelete=function(){this.messageArea.trigger(k.CANCELDELETEMESSAGES)},m.prototype._addMessagesToDom=function(b,d){var e=0,f=this.messageArea.find(p.MESSAGES);return b=b.filter(function(a){var b=""+a.id+a.isread;if(this._messageQueue[b])return!1;var c=f.find(p.MESSAGE+'[data-id="'+b+'"]');return c.length||(this._messageQueue[b]=!0),!c.length}.bind(this)),e=b.length,c.render("core_message/message_area_messages",{messages:b}).then(function(b,f){if(e>0){var g=a("<div>"+b+"</div>");this._hasMatchingBlockTime(this.messageArea.node,g,!1)&&g.find(p.BLOCKTIME+":first").remove(),c.appendNodeContents(this.messageArea.find(p.MESSAGES),g,f),d&&this._scrollBottom(),this._numMessagesDisplayed+=e,this._backoffTimer.restart()}}.bind(this))},m.prototype._addLastMessageToDom=function(){var a=b.call([{methodname:"core_message_data_for_messagearea_get_most_recent_message",args:{currentuserid:this.messageArea.getCurrentUserId(),otheruserid:this._getUserId()}}]);return a[0].then(function(a){return this._addMessagesToDom([a],!0)}.bind(this)).always(function(){this.messageArea.find(p.SENDMESSAGETEXT).val("").trigger("input")}.bind(this)).fail(d.exception)},m.prototype._getUserId=function(){return this.messageArea.find(p.MESSAGES).data("userid")},m.prototype._scrollBottom=function(){var a=this.messageArea.find(p.MESSAGES);0!==a.length&&a.scrollTop(a[0].scrollHeight)},m.prototype._selectPreviousMessage=function(b,c){var d=a(b.target).closest(p.MESSAGE);do d=d.prev();while(d.length&&!d.is(p.MESSAGE));d.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},m.prototype._selectNextMessage=function(b,c){var d=a(b.target).closest(p.MESSAGE);do d=d.next();while(d.length&&!d.is(p.MESSAGE));d.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},m.prototype._setMessaging=function(b){a(b.target).closest(p.MESSAGERESPONSE).addClass("messaging")},m.prototype._clearMessaging=function(b){a(b.target).closest(p.MESSAGERESPONSE).removeClass("messaging")},m.prototype._startDeleting=function(a){var b=new g(this.messageArea);b.chooseMessagesToDelete(),a.preventDefault()},m.prototype._isEditing=function(){return this.messageArea.find(p.MESSAGESAREA).hasClass("editing")},m.prototype._toggleMessage=function(b){if(this._isEditing()){var c=a(b.target).closest(p.MESSAGE);"true"===c.attr("aria-checked")?c.attr("aria-checked","false"):c.attr("aria-checked","true")}},m.prototype._adjustMessagesAreaHeight=function(){var a=this.messageArea.find(p.MESSAGES),b=this.messageArea.find(p.MESSAGERESPONSE),c=b.outerHeight(),d=c-o,e=n-d;a.outerHeight(e)},m.prototype._sendMessageHandler=function(a,b){b.originalEvent.preventDefault(),this._sendMessage()},m.prototype._hideMessagingArea=function(){this.messageArea.find(p.MESSAGINGAREA).removeClass("show-messages").addClass("hide-messages")},m.prototype._hasMatchingBlockTime=function(a,b,c){var d,e,f,g;return c?(e=":first",g=":last"):(e=":last",g=":first"),d=a.find(p.BLOCKTIME+e),f=b.find(p.BLOCKTIME+g),!(!d.length||!f.length)&&d.data("blocktime")==f.data("blocktime")},m});
define('core_message/message_drawer_routes', [],function(){return{VIEW_CONTACT:"view-contact",VIEW_CONTACTS:"view-contacts",VIEW_CONVERSATION:"view-conversation",VIEW_GROUP_INFO:"view-group-info",VIEW_OVERVIEW:"view-overview",VIEW_SEARCH:"view-search",VIEW_SETTINGS:"view-settings"}});
define('core_message/toggle_contact_button', ["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events"],function(a,b,c,d,e){var f=function(a){return"1"==a.attr("data-is-contact")},g=function(a){a.attr("data-is-contact","1")},h=function(a){a.attr("data-is-contact","0")},i=function(a){return a.attr("data-userid")},j=function(a){return a.hasClass("loading")||a.attr("disabled")},k=function(c,e){return j(c)?a.Deferred():(c.addClass("loading"),c.attr("disabled","disabled"),b.call([e])[0].fail(d.exception).always(function(){c.removeClass("loading"),c.removeAttr("disabled")}))},l=function(a){if(!j(a)){var b={methodname:"core_message_create_contacts",args:{userids:[i(a)]}};k(a,b).done(function(){g(a),c.render("message/remove_contact_button",{}).done(function(b,d){c.replaceNodeContents(a,b,d)})})}},m=function(a){if(!j(a)){var b={methodname:"core_message_delete_contacts",args:{userids:[i(a)]}};k(a,b).done(function(){h(a),c.render("message/add_contact_button",{}).done(function(b,d){c.replaceNodeContents(a,b,d)})})}},n=function(b){b=a(b),b.children(".loading-icon").length||c.render("core/loading",{}).done(function(a,c){b.append(a,c)}),e.define(b,[e.events.activate]),b.on(e.events.activate,function(a,c){f(b)?m(b):l(b),a.preventDefault(),c.originalEvent.preventDefault()})};return{enhance:n}});
define('core_message/message_drawer_lazy_load_list', ["jquery","core/custom_interaction_events"],function(a,b){var c={ROOT:'[data-region="lazy-load-list"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]',CONTENT_CONTAINER:'[data-region="content-container"]',EMPTY_MESSAGE:'[data-region="empty-message-container"]',PLACEHOLDER:'[data-region="placeholder-container"]'},d=function(a){a.attr("data-loading",!0)},e=function(a){a.attr("data-loading",!1)},f=function(a){return"true"===a.attr("data-loading")},g=function(a){return a.attr("data-user-id")},h=function(a){return a.find(c.CONTENT_CONTAINER)},i=function(a){return a.find(c.ROOT)},j=function(a){a.find(c.LOADING_ICON_CONTAINER).removeClass("hidden")},k=function(a){a.find(c.LOADING_ICON_CONTAINER).addClass("hidden")},l=function(a){a.find(c.EMPTY_MESSAGE).removeClass("hidden")},m=function(a){a.find(c.EMPTY_MESSAGE).addClass("hidden")},n=function(a){a.find(c.PLACEHOLDER).removeClass("hidden")},o=function(a){a.find(c.PLACEHOLDER).addClass("hidden")},p=function(a){h(a).removeClass("hidden")},q=function(a){h(a).addClass("hidden")},r=function(a){return"true"==a.attr("data-loaded-all")},s=function(a,b){a.attr("data-loaded-all",b)},t=function(a){return!r(a)&&!f(a)},u=function(a,b,c){var f=g(a);return d(a),b(a,f).then(function(b){if(b.length>0){var d=h(a);return c(d,b,f).then(function(){return b})}return b}).then(function(b){return e(a),a.attr("data-seen",!0),b.length||s(a,!0),b})["catch"](function(){e(a),a.attr("data-seen",!0)})},v=function(a,b,c){return h(a).empty(),n(a),q(a),u(a,b,c).then(function(b){o(a),b.length?p(a):l(a)})["catch"](function(){o(a),p(a)})},w=function(a,c,d){b.define(a,[b.events.scrollBottom]),a.on(b.events.scrollBottom,function(){t(a)&&(j(a),u(a,c,d).then(function(){return k(a)})["catch"](function(){return k(a)}))})},x=function(b,c,d){b=a(b),b.attr("data-init")||(w(b,c,d),v(b,c,d),b.attr("data-init",!0))};return{show:x,getContentContainer:h,getRoot:i,setLoadedAll:s,showEmptyMessage:l,hideEmptyMessage:m,showContent:p,hideContent:q}});
define('core_message/preferences_notifications_list_controller', ["jquery","core/ajax","core/notification","core/custom_interaction_events","core_message/notification_preference","core_message/notification_processor_settings"],function(a,b,c,d,e,f){var g={DISABLE_NOTIFICATIONS:'[data-region="disable-notification-container"] [data-disable-notifications]',DISABLE_NOTIFICATIONS_CONTAINER:'[data-region="disable-notification-container"]',PREFERENCE:"[data-state]",PREFERENCE_ROW:'[data-region="preference-row"]',PREFERENCE_INPUT:"[data-state] input",PROCESSOR_SETTING:"[data-processor-setting]"},h=function(b){this.root=a(b),this.userId=this.root.attr("data-user-id"),this.registerEventListeners()};return h.prototype.isDisabled=function(){return this.root.hasClass("disabled")},h.prototype.setDisabled=function(){this.root.addClass("disabled"),this.root.find(g.PREFERENCE_INPUT).prop("disabled",!0)},h.prototype.setEnabled=function(){this.root.removeClass("disabled"),this.root.find(g.PREFERENCE_INPUT).prop("disabled",!1)},h.prototype.toggleDisableAllStatus=function(){var d=a(g.DISABLE_NOTIFICATIONS),e=a(g.DISABLE_NOTIFICATIONS_CONTAINER),f=d.prop("checked");if(e.hasClass("loading"))return a.Deferred().resolve();e.addClass("loading");var h={methodname:"core_user_update_user_preferences",args:{userid:this.userId,emailstop:f?1:0}};return b.call([h])[0].done(function(){f?this.setDisabled():this.setEnabled()}.bind(this)).always(function(){e.removeClass("loading")}).fail(c.exception)},h.prototype.registerEventListeners=function(){var b=a(g.DISABLE_NOTIFICATIONS);d.define(this.root,[d.events.activate]),this.root.on("change",function(b){if(!this.isDisabled()){var c=a(b.target).closest(g.PREFERENCE),d=a(b.target).closest(g.PREFERENCE_ROW),f=new e(d,this.userId);c.addClass("loading"),f.save().always(function(){c.removeClass("loading")})}}.bind(this)),this.root.on(d.events.activate,g.PROCESSOR_SETTING,function(b,c){var d=a(b.target).closest(g.PROCESSOR_SETTING),e=new f(d);e.show(),c.originalEvent.preventDefault()}),d.define(b,[d.events.activate]),b.on(d.events.activate,function(){this.toggleDisableAllStatus()}.bind(this))},h});
define('core_message/message_drawer_router', ["jquery","core/pubsub","core/str","core_message/message_drawer_events"],function(a,b,c,d){var e={},f=[],g={CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',ROUTES_BACK:"[data-route-back]"},h=function(a,b,c,d){e[a]={elements:b,onGo:c,getDescription:d}},i=function(c){var f,h=[].slice.call(arguments,1),i=a.Deferred().resolve().promise();if(Object.keys(e).forEach(function(a){var b=e[a],d=a===c;d&&(f=b),b.elements.forEach(function(a){a.removeClass("previous"),d?(a.removeClass("hidden"),a.attr("aria-hidden",!1)):(a.addClass("hidden"),a.attr("aria-hidden",!0))})}),f&&f.onGo){i=f.onGo.apply(void 0,f.elements.concat(h));for(var j=a(document.activeElement),k=!1,l=0;l<f.elements.length;l++){var m=f.elements[l];if(m.has(j).length){k=!0;break}}k||f.elements[0].find(g.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()}var n={route:c,params:h,renderPromise:i};return b.publish(d.ROUTE_CHANGED,n),n},j=function(){var b=a(document.activeElement),d=i.apply(null,arguments),h=!1;f=f.reduce(function(a,b){return b.route===d.route&&(h=!0),h||a.push(b),a},[]);var j=f.length?f[f.length-1]:null;if(j){var k=e[j.route];k.elements.forEach(function(a){a.addClass("previous")}),j.focusElement=b,k.getDescription&&k.getDescription.apply(null,k.elements.concat(j.params)).then(function(a){return c.get_string("backto","core_message",a)}).then(function(a){return d.renderPromise.then(function(){e[d.route].elements.forEach(function(b){b.find(g.ROUTES_BACK).attr("aria-label",a)})})})["catch"](function(){})}return f.push(d),d},k=function(){if(f.length){f.pop();var a=f.pop();a&&(j.apply(void 0,[a.route].concat(a.params)),window.setTimeout(function(){a.focusElement.focus()},50))}};return{add:h,go:j,back:k}});
define('core_message/message_drawer_view_group_info', ["jquery","core/str","core/templates","core_message/message_repository","core_message/message_drawer_lazy_load_list"],function(a,b,c,d,e){var f=50,g={CONTENT_CONTAINER:'[data-region="group-info-content-container"]',MEMBERS_LIST:'[data-region="members-list"]'},h={CONTENT:"core_message/message_drawer_view_group_info_body_content",MEMBERS_LIST:"core_message/message_drawer_view_group_info_participants_list"},i=function(a){return a.find(g.CONTENT_CONTAINER)},j=function(a,b,d){var e=b.totalMemberCount>50?50:b.totalMemberCount,f=Array.apply(null,Array(e)).map(function(){return!0}),g={name:b.name,subname:b.subname,imageurl:b.imageUrl,placeholders:f,loggedinuser:{id:d}};return c.render(h.CONTENT,g).then(function(b){return i(a).append(b),b})},k=function(a,b,c){return function(f,g){return d.getConversationMembers(a.id,g,b+1,c).then(function(a){return a.length>b?a=a.slice(0,-1):e.setLoadedAll(f,!0),c+=b,a.filter(function(a){return a.id!=g})})}},l=function(a,b){return c.render(h.MEMBERS_LIST,{contacts:b}).then(function(b){return a.append(b),b})},m=function(b,c,d){return b=a(b),i(b).empty(),j(b,c,d).then(function(){var a=e.getRoot(b);e.show(a,k(c,f,0),l)})},n=function(a,c){return b.get_string("messagedrawerviewgroupinfo","core_message",c.name)};return{show:m,description:n}});
define('core_message/message_drawer_view_contacts_section_requests', ["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],function(a,b,c,d,e,f,g){var h={CONTACT_REQUEST:'[data-region="contact-request"]'},i={REQUESTS_LIST:"core_message/message_drawer_view_contacts_body_section_requests_list"},j=function(a,c){var e=c.map(function(a){return{id:a.id,profileimageurl:a.profileimageurl,fullname:a.fullname}});return d.render(i.REQUESTS_LIST,{requests:e}).then(function(b){return a.append(b),b})["catch"](b.exception)},k=function(a,c){return e.getContactRequests(c).then(function(b){return g.setLoadedAll(a,!0),b})["catch"](b.exception)},l=function(a){return function(b){a.find('[data-request-id="'+b.userid+'"]').remove();var c=a.find(h.CONTACT_REQUEST);c.length||(g.showEmptyMessage(a),g.hideContent(a))}},m=function(a){c.subscribe(f.CONTACT_REQUEST_ACCEPTED,l(a)),c.subscribe(f.CONTACT_REQUEST_DECLINED,l(a))},n=function(a){a.attr("data-contacts-init")||(m(a),a.attr("data-contacts-init",!0)),g.show(a,k,j)};return{show:n}});
define('core_message/message_area_profile', ["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/custom_interaction_events","core_message/message_area_events"],function(a,b,c,d,e,f,g,h){function i(a){this.messageArea=a,this._init()}var j={PROFILE:"[data-region='profile']",PROFILEADDCONTACT:"[data-action='profile-add-contact']",PROFILEBLOCKCONTACT:"[data-action='profile-block-contact']",PROFILEREMOVECONTACT:"[data-action='profile-remove-contact']",PROFILESENDMESSAGE:"[data-action='profile-send-message']",PROFILEUNBLOCKCONTACT:"[data-action='profile-unblock-contact']",PROFILEVIEW:"[data-action='profile-view']",SHOWCONTACTS:"[data-action='show-contacts']",MESSAGESAREA:"[data-region='messages-area']",MESSAGINGAREA:"[data-region='messaging-area']"};return i.prototype.messageArea=null,i.prototype._init=function(){g.define(this.messageArea.node,[g.events.activate]),this.messageArea.onCustomEvent(h.CONTACTSELECTED,this._viewProfile.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEVIEW,function(a,b){this._viewFullProfile(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILESENDMESSAGE,function(a,b){this._sendMessage(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEUNBLOCKCONTACT,function(a,b){this._unblockContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEBLOCKCONTACT,function(a,b){this._blockContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEADDCONTACT,function(a,b){this._addContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEREMOVECONTACT,function(a,b){this._removeContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.SHOWCONTACTS,this._hideMessagingArea.bind(this))},i.prototype._viewProfile=function(a,e){c.render("core/loading",{}).done(function(a,b){c.replaceNodeContents(this.messageArea.find(j.MESSAGESAREA),a,b)}.bind(this));var f=b.call([{methodname:"core_message_data_for_messagearea_get_profile",args:{currentuserid:this.messageArea.getCurrentUserId(),otheruserid:e}}]);return f[0].then(function(a){return c.render("core_message/message_area_profile",a)}).then(function(a,b){c.replaceNodeContents(this.messageArea.find(j.MESSAGESAREA),a,b)}.bind(this)).fail(d.exception)},i.prototype._viewFullProfile=function(){window.location.href=f.wwwroot+"/user/profile.php?id="+this._getUserId()},i.prototype._sendMessage=function(){this.messageArea.trigger(h.SENDMESSAGE,this._getUserId())},i.prototype._blockContact=function(){var a=this._performAction("core_message_block_user","unblockcontact","profile-block-contact","profile-unblock-contact","");return a.then(function(){this.messageArea.trigger(h.CONTACTBLOCKED,this._getUserId())}.bind(this))},i.prototype._unblockContact=function(){var a=this._performAction("core_message_unblock_user","blockcontact","profile-unblock-contact","profile-block-contact","danger");return a.then(function(){this.messageArea.trigger(h.CONTACTUNBLOCKED,this._getUserId())}.bind(this))},i.prototype._addContact=function(){var a=this._performAction("core_message_create_contact_request","removecontact","profile-add-contact","profile-remove-contact","danger");return a.then(function(){this.messageArea.trigger(h.CONTACTADDED,this._getUserId())}.bind(this))},i.prototype._removeContact=function(){var a=this._performAction("core_message_delete_contacts","addcontact","profile-remove-contact","profile-add-contact","");return a.then(function(){this.messageArea.trigger(h.CONTACTREMOVED,this._getUserId())}.bind(this))},i.prototype._performAction=function(a,c,f,g,h){var i="";switch(a){case"core_message_block_user":i={userid:this.messageArea.getCurrentUserId(),blockeduserid:this._getUserId()};break;case"core_message_unblock_user":i={userid:this.messageArea.getCurrentUserId(),unblockeduserid:this._getUserId()};break;case"core_message_create_contact_request":i={userid:this.messageArea.getCurrentUserId(),requesteduserid:this._getUserId()};break;default:i={userid:this.messageArea.getCurrentUserId(),userids:[this._getUserId()]}}var j=b.call([{methodname:a,args:i}]);return j[0].then(function(){return e.get_string(c,"message")}).then(function(a){this._changeText(a,f,g,h)}.bind(this)).fail(d.exception)},i.prototype._changeText=function(a,b,c,d){var e=this.messageArea.find("[data-action='"+b+"']");e.text(a),e.removeClass(),d&&e.addClass(d),e.attr("data-action",c)},i.prototype._getUserId=function(){return this.messageArea.find(j.PROFILE).data("userid")},i.prototype._hideMessagingArea=function(){this.messageArea.find(j.MESSAGINGAREA).removeClass("show-messages").addClass("hide-messages")},i});
define('core_message/notification_preference', ["jquery","core/ajax","core/notification","core_message/notification_processor"],function(a,b,c,d){var e={PROCESSOR:"[data-processor-name]",STATE_INPUTS:"[data-state] input"},f=function(b,c){this.root=a(b),this.userId=c};return f.prototype.getPreferenceKey=function(){return this.root.attr("data-preference-key")},f.prototype.getLoggedInPreferenceKey=function(){return this.getPreferenceKey()+"_loggedin"},f.prototype.getLoggedOffPreferenceKey=function(){return this.getPreferenceKey()+"_loggedoff"},f.prototype.getProcessors=function(){return this.root.find(e.PROCESSOR).map(function(b,c){return new d(a(c))})},f.prototype.startLoading=function(){this.root.addClass("loading"),this.root.find(e.STATE_INPUTS).prop("disabled",!0)},f.prototype.stopLoading=function(){this.root.removeClass("loading"),this.root.find(e.STATE_INPUTS).prop("disabled",!1)},f.prototype.isLoading=function(){return this.root.hasClass("loading")},f.prototype.save=function(){if(this.isLoading())return a.Deferred().resolve();this.startLoading();var d="",e="";this.getProcessors().each(function(a,b){b.isLoggedInEnabled()&&(""===d?d=b.getName():d+=","+b.getName()),b.isLoggedOffEnabled()&&(""===e?e=b.getName():e+=","+b.getName())}),""===d&&(d="none"),""===e&&(e="none");var f={userid:this.userId,preferences:[{type:this.getLoggedInPreferenceKey(),value:d},{type:this.getLoggedOffPreferenceKey(),value:e}]},g={methodname:"core_user_update_user_preferences",args:f};return b.call([g])[0].fail(c.exception).always(function(){this.stopLoading()}.bind(this))},f});
define('core_message/notification_processor_settings', ["jquery","core/ajax","core/notification","core/fragment","core/templates","core/str","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h={PROCESSOR:"[data-processor-name]",PREFERENCE_ROW:'[data-region="preference-row"]'},i=function(b){this.root=a(b),this.name=this.root.attr("data-name"),this.userId=this.root.attr("data-user-id"),this.contextId=this.root.attr("data-context-id")};return i.prototype.show=function(){d.loadFragment("message","processor_settings",this.contextId,{userid:this.userId,type:this.name}).done(function(b,c){f.get_string("processorsettings","message").done(function(d){var f=new g(d,b,function(){e.runTemplateJS(c)},function(){f.close()});a(document).on("mpp:formsubmitted",function(){f.close(),this.updateConfiguredStatus()}.bind(this)),a(document).on("mpp:formcancelled",function(){f.close()})}.bind(this))}.bind(this))},i.prototype.updateConfiguredStatus=function(){var d=this.root.closest(h.PROCESSOR);if(!d.hasClass("unconfigured"))return!1;var e=d.attr("data-processor-name"),f={methodname:"core_message_get_message_processor",args:{name:e,userid:this.userId}};return b.call([f])[0].fail(c.exception).done(function(b){if(b.userconfigured){var c=a(h.PREFERENCE_ROW+' [data-processor-name="'+e+'"]');d.removeClass("unconfigured"),c.removeClass("disabled")}})},i});
define('core_message/message_drawer_view_contact', ["jquery","core/str","core/templates"],function(a,b,c){var d={CONTENT_CONTAINER:'[data-region="content-container"]'},e={CONTENT:"core_message/message_drawer_view_contact_body_content"},f=function(a){return a.find(d.CONTENT_CONTAINER)},g=function(a,b){return c.render(e.CONTENT,b).then(function(b){return f(a).append(b),b})},h=function(b,c){return b=a(b),f(b).empty(),g(b,c)},i=function(a,c){return b.get_string("messagedrawerviewcontact","core_message",c.fullname)};return{show:h,description:i}});
define('core_message/message_area', ["jquery","core_message/message_area_contacts","core_message/message_area_messages","core_message/message_area_profile","core_message/message_area_tabs","core_message/message_area_search"],function(a,b,c,d,e,f){function g(b,c,d,e){this.node=a(b),this.pollmin=c,this.pollmax=d,this.polltimeout=e,this._init()}return g.prototype.node=null,g.prototype.pollmin=null,g.prototype.pollmax=null,g.prototype.polltimeout=null,g.prototype._init=function(){new b(this),new c(this),new d(this),new e(this),new f(this)},g.prototype.onDelegateEvent=function(a,b,c){this.node.on(a,b,c)},g.prototype.onCustomEvent=function(a,b){this.node.on(a,b)},g.prototype.trigger=function(a,b){"undefined"==typeof b&&(b=""),this.node.trigger(a,b)},g.prototype.find=function(a){return this.node.find(a)},g.prototype.getCurrentUserId=function(){return this.node.data("userid")},g.prototype.showContactsFirst=function(){return!!this.node.data("displaycontacts")},g});
define('core_message/message_drawer_view_conversation_patcher', ["jquery","core/user_date","core_message/message_drawer_view_conversation_constants"],function(a,b,c){var d=function(a,c){var d=a.reduce(function(a,d){var e=b.getUserMidnightForTimestamp(d.timeCreated,c);return a.hasOwnProperty(e)?a[e].push(d):a[e]=[d],a},{});return Object.keys(d).map(function(a){return{timestamp:a,messages:d[a]}})},e=function(a,b,c){b=b.slice();var d=[],e=[],f=[];return a.forEach(function(a){for(var d=!1,g=0;g<b.length;g++){var h=b[g];if(c(a,h)){d=!0,f.push({a:a,b:h});break}}d?b.splice(g,1):e.push(a)}),d=b,{missingFromA:d,missingFromB:e,matches:f}},f=function(a,b){for(var c=null,d=0;d<a.length;d++){var e=a[d];if(b(e))return e}return c},g=function(a,b){a.sort(),b.sort();var c=a.length,d=b.length;return c<1&&d<1||c==d&&a.every(function(a,c){return a==b[c]})},h=function(a,b){return{remove:b.missingFromB,add:b.missingFromA.map(function(b){var c=f(a,function(a){return b.timestamp<a.timestamp});return{before:c,value:b}})}},i=function(a){var b=[],c=[];return a.forEach(function(a){var d=a.a,g=a.b,h=e(d.messages,g.messages,function(a,b){return a.id==b.id});b=b.concat(h.missingFromB),h.missingFromA.forEach(function(a){var b=f(d.messages,function(b){return a.timeCreated==b.timeCreated?a.id<b.id:a.timeCreated<b.timeCreated});c.push({before:b,value:a,day:d})})}),{add:c,remove:b}},j=function(a,b){var c=a.messages.map(function(a){return a.id}),f=b.messages.map(function(a){return a.id});if(g(c,f))return null;var j=d(a.messages,a.midnight),k=d(b.messages,b.midnight),l=e(j,k,function(a,b){return a.timestamp==b.timestamp});return{days:h(j,l),messages:i(l.matches)}},k=function(a,b){var d=G(a,b),e=x(a,b),f=E(a),g=E(b),h=d&&d.show&&!d.hasMessages,i=d&&!d.show,j=!f&&g;return j=j||h||i,j=j||null!==e,j?{type:c.CONVERSATION_TYPES.PRIVATE,showControls:!h&&!e,context:{id:b.id,name:b.name,subname:b.subname,totalmembercount:b.totalMemberCount,imageurl:b.imageUrl,isfavourite:b.isFavourite,showfavourite:null!==b.id,userid:g.id,showonlinestatus:g.showonlinestatus,isonline:g.isonline,isblocked:g.isblocked,iscontact:g.iscontact}}:null},l=function(a,b){var d=a.totalMemberCount,e=b.totalMemberCount;return d!=e?{type:c.CONVERSATION_TYPES.PUBLIC,showControls:!0,context:{id:b.id,name:b.name,subname:b.subname,totalmembercount:b.totalMemberCount,imageurl:b.imageUrl,isfavourite:b.isFavourite,showfavourite:null!==b.id}}:null},m=function(a,b){var c=a.messages,d=b.messages;if(d.length<1)return null;if(c.length<1)return d[d.length-1].id;var e=c[a.messages.length-1],f=d[d.length-1],g=c[0],h=d[0];return e.id!=f.id?f.id:g.id!=h.id?g.id:null},n=function(a,b){return!(a.loadingMembers||!b.loadingMembers)||!(a.loadingMembers&&!b.loadingMembers)&&null},o=function(a,b){return a.hasTriedToLoadMessages===b.hasTriedToLoadMessages?null:!(b.hasTriedToLoadMessages||!b.loadingMessages)||!(b.hasTriedToLoadMessages&&!b.loadingMessages)&&null},p=function(a,b){return!(a.loadingMessages||!b.loadingMessages)||!(a.loadingMessages&&!b.loadingMessages)&&null},q=function(a,b){return!(a.sendingMessage||!b.sendingMessage)||!(a.sendingMessage&&!b.sendingMessage)&&null},r=function(a,b){if(b.pendingBlockUserIds.length){var c=b.pendingBlockUserIds[0];return b.members[c]}return!a.pendingBlockUserIds.length&&null},s=function(a,b){if(b.pendingUnblockUserIds.length){var c=b.pendingUnblockUserIds[0];return b.members[c]}return!a.pendingUnblockUserIds.length&&null},t=function(a,b){if(b.pendingAddContactIds.length){var c=b.pendingAddContactIds[0];return b.members[c]}return!a.pendingAddContactIds.length&&null},u=function(a,b){if(b.pendingRemoveContactIds.length){var c=b.pendingRemoveContactIds[0];return b.members[c]}return!a.pendingRemoveContactIds.length&&null},v=function(a,b){return!!b.pendingDeleteMessageIds.length||!a.pendingDeleteMessageIds.length&&null},w=function(a,b){return!(a.pendingDeleteConversation||!b.pendingDeleteConversation)||!(a.pendingDeleteConversation&&!b.pendingDeleteConversation)&&null},x=function(a,b){var c=a.loggedInUserId,d=E(a),e=E(b),f=d?d.contactrequests.filter(function(a){return a.requesteduserid==c&&a.userid==d.id}):[],g=e?e.contactrequests.filter(function(a){return a.requesteduserid==c&&a.userid==e.id}):[],h=f.length?f[0]:null,i=g.length?g[0]:null;return!h&&i?e:!(h&&!i)&&null},y=function(a,b){var c=E(a),d=E(b);return c||d?!c&&d?!!d.isblocked||null:!d&&c?!c.isblocked&&null:!(c.isblocked&&!d.isblocked)&&(!(c.isblocked||!d.isblocked)||null):null},z=function(a,b){var c=a.isFavourite,d=b.isFavourite;return null===a.id&&null===b.id?null:null===a.id&&null!==b.id?"show-add":null!==a.id&&null===b.id?"hide":c==d?null:!c&&d?"show-remove":c&&!d?"show-add":null},A=function(a,b){var c=a.loggedInUserId,d=E(a),e=E(b),f=d?d.contactrequests.filter(function(a){return a.userid==c&&a.requesteduserid==d.id||a.userid==d.id&&a.requesteduserid==c}):[],g=e?e.contactrequests.filter(function(a){return a.userid==c&&a.requesteduserid==e.id||a.userid==e.id&&a.requesteduserid==c}):[],h=f.length>0,i=g.length>0;return d||e?h&&i?null:h||!i||e.iscontact?!d&&e?e.iscontact?"contact":null:!e&&d?d.iscontact?"non-contact":null:d.iscontact&&!e.iscontact?i?"pending-contact":"non-contact":!d.iscontact&&e.iscontact?"contact":null:"pending-contact":null},B=function(a,b){return!(a.loadingConfirmAction||!b.loadingConfirmAction)||!(a.loadingConfirmAction&&!b.loadingConfirmAction)&&null},C=function(a,b){var c=a.selectedMessageIds.length>0,d=b.selectedMessageIds.length>0,e=a.messages.length!=b.messages.length;return!(c||!d)||!(c&&!d)&&(!(!c||!e)||null)},D=function(a,b){var c=a.selectedMessageIds,d=b.selectedMessageIds;if(g(c,d))return null;var f=e(c,d,function(a,b){return a==b});return{count:d.length,add:f.missingFromA,remove:f.missingFromB}},E=function(a){return Object.keys(a.members).reduce(function(b,c){return c==a.loggedInUserId||b||(b=a.members[c]),b},null)},F=function(a,b){if(b.canmessage)return!1;var c=b.contactrequests.filter(function(b){return b.userid==a||b.requesteduserid}),d=c.length>0;return b.requirescontact&&!b.iscontact&&!d},G=function(a,b){var c=E(a),d=E(b),e=a.messages.length>0,f=b.messages.length>0,g=b.loggedInUserId,h=c&&F(g,c),i=d&&F(g,d),j=t(a,b),k=j===!1;if(!a.hasTriedToLoadMessages&&!b.hasTriedToLoadMessages)return null;if(!c&&!d)return null;if(!c&&i)return{show:!0,hasMessages:f,user:d};if(k&&i)return{show:!0,hasMessages:f,user:d};if(a.hasTriedToLoadMessages&&b.hasTriedToLoadMessages){if(!h&&i)return{show:!0,hasMessages:f,user:d};if(h&&!i)return{show:!1,hasMessages:f}}return!a.hasTriedToLoadMessages&&b.hasTriedToLoadMessages&&i?{show:!0,hasMessages:f,user:d}:a.hasTriedToLoadMessages&&!b.hasTriedToLoadMessages&&h?{show:!1,hasMessages:e}:null},H=function(a,b){var c=E(a),d=E(b);return c||d?c&&!d?!c.isblocked&&null:!c&&d?!!d.isblocked||null:!(c.isblocked||!d.isblocked)||!(c.isblocked&&!d.isblocked)&&null:null},I=function(a,b){var c=E(a),d=E(b);return c||d?c&&!d?!c.canmessage||null:!c&&d?!d.canmessage||null:!(!c.canmessage&&d.canmessage)&&(!(!c.canmessage||d.canmessage)||null):null},J=function(a,b){var c=o(a,b),d=C(a,b),e=G(a,b),f=H(a,b),g=I(a,b),h=null!==e?e.show&&e.hasMessages:null,i=E(b),j=function(a,c){if(a)return c;if(null!==a&&!a){if(!i)return{type:"content"};if(i.isblocked)return{type:"unblock"};if(b.messages.length&&F(b.loggedInUserId,i))return{type:"add-contact",user:i};if(!i.canmessage&&i.requirescontact&&!i.iscontact)return{type:"unable-to-message"}}return null};if(null===c&&null===d&&null===e&&null===f)return null;for(var k=[[c,{type:"placeholder"}],[d,{type:"edit-mode"}],[g,{type:"unable-to-message"}],[f,{type:"unblock"}],[h,{type:"add-contact",user:i}]],l=0;l<k.length;l++){var m=k[l][0],n=k[l][1],p=j(m,n);if(null!==p)return p}return{type:"content"}},K=function(a,b){var c=o(a,b),d=C(a,b);return null===c&&null===d?null:c?{type:"placeholder"}:d?{type:"edit-mode"}:{type:"content"}},L=function(a,b){var c=a.type,d=b.type,e=a.id,f=b.id,g=Object.keys(a.members),h=Object.keys(b.members);g.sort(),h.sort();var i=g.every(function(a,b){return a==h[b]});return c!=d||(!(!e||f)||(!(!e||!f||e==f)||(!(e||f||i)||null)))},M=function(a,b){var c=b.loggedInUserId,d=E(a),e=E(b),f=d?d.contactrequests.filter(function(a){return a.userid==c}):[],g=e?e.contactrequests.filter(function(a){return a.userid==c}):[],h=f.length>0,i=g.length>0,j=a.messages.length>0,k=a.messages.length>0;return h||!i||e.iscontact||k?!(d&&!d.iscontact&&i&&e.iscontact)&&(!(h&&!i)&&(!(!j&&k)&&null)):e.fullname},N=function(b,d){var e={all:{reset:L,conversation:j,scrollToMessage:m,loadingMembers:n,loadingFirstMessages:o,loadingMessages:p,sendingMessage:q,confirmDeleteSelectedMessages:v,inEditMode:C,selectedMessages:D,isFavourite:z}};e[c.CONVERSATION_TYPES.PRIVATE]={header:k,footer:J,confirmBlockUser:r,confirmUnblockUser:s,confirmAddContact:t,confirmRemoveContact:u,confirmContactRequest:x,confirmDeleteConversation:w,isBlocked:y,isContact:A,loadingConfirmAction:B,requireAddContact:G,contactRequestSent:M},e[c.CONVERSATION_TYPES.PUBLIC]={header:l,footer:K};var f=a.extend({},e.all);return d.type&&d.type in e&&(f=a.extend(f,e[d.type])),Object.keys(f).reduce(function(a,c){var e=f[c],g=e(b,d);return null!==g&&(a[c]=g),a},{})};return{buildPatch:N}});
define('core_message/message_area_contacts', ["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events","core/str","core_message/message_area_events"],function(a,b,c,d,e,f,g){function h(a){this.messageArea=a,this._init()}var i={CONTACT:"[data-region='contact']",CONTACTICONBLOCKED:"[data-region='contact-icon-blocked']",CONTACTS:"[data-region='contacts'][data-region-content='contacts']",CONTACTSAREA:"[data-region='contacts-area']",CONVERSATIONS:"[data-region='contacts'][data-region-content='conversations']",COURSE:"[data-region='course']",LASTMESSAGETEXT:"[data-region='last-message-text']",LASTMESSAGEUSER:"[data-region='last-message-user']",LOADINGICON:".loading-icon",MESSAGETEXT:"[data-region='message-text']",MESSAGINGAREA:"[data-region='messaging-area']",NOCONTACTS:"[data-region=no-contacts]",SEARCHBOX:"[data-region='search-box']",SEARCHRESULTSAREA:"[data-region='search-results-area']",SEARCHTEXTAREA:"[data-region='search-text-area']",SELECTEDVIEWCONVERSATION:"[data-action='view-contact-msg'].selected",SELECTEDVIEWPROFILE:"[data-action='view-contact-profile'].selected",SHOWMESSAGES:"[data-action='show-messages']",VIEWCONVERSATION:"[data-action='view-contact-msg']",VIEWPROFILE:"[data-action='view-contact-profile']"};return h.prototype._isLoadingConversations=!1,h.prototype._isLoadingContacts=!1,h.prototype._numContactsDisplayed=0,h.prototype._numContactsToRetrieve=20,h.prototype._numConversationsDisplayed=0,h.prototype._numConversationsToRetrieve=20,h.prototype._messageLength=60,h.prototype.messageArea=null,h.prototype._init=function(){e.define(this.messageArea.node,[e.events.activate,e.events.down,e.events.up]),this.messageArea.onCustomEvent(g.MESSAGESEARCHCANCELED,this._viewConversations.bind(this)),this.messageArea.onCustomEvent(g.USERSSEARCHCANCELED,this._viewContacts.bind(this)),this.messageArea.onCustomEvent(g.CONTACTSSELECTED,this._viewContacts.bind(this)),this.messageArea.onCustomEvent(g.CONVERSATIONDELETED,this._deleteConversation.bind(this)),this.messageArea.onCustomEvent(g.CONVERSATIONSSELECTED,this._viewConversations.bind(this)),this.messageArea.onCustomEvent(g.CONTACTSSELECTED,this._viewContacts.bind(this)),this.messageArea.onCustomEvent(g.MESSAGESDELETED,this._updateLastMessage.bind(this)),this.messageArea.onCustomEvent(g.MESSAGESENT,this._handleMessageSent.bind(this)),this.messageArea.onCustomEvent(g.CONTACTREMOVED,function(a,b){this._removeContact(i.CONTACTS,b)}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTADDED,function(a,b){this._addContact(b)}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTBLOCKED,function(a,b){this._blockContact(b)}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTUNBLOCKED,function(a,b){this._unblockContact(b)}.bind(this)),this.messageArea.onCustomEvent(g.CHOOSEMESSAGESTODELETE,this._startDeleting.bind(this)),this.messageArea.onCustomEvent(g.CANCELDELETEMESSAGES,this._stopDeleting.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,i.VIEWCONVERSATION,this._viewConversation.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,i.VIEWPROFILE,this._viewContact.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,i.SHOWMESSAGES,this._showMessagingArea.bind(this)),this.messageArea.onDelegateEvent(e.events.up,i.CONTACT,this._selectPreviousContact.bind(this)),this.messageArea.onDelegateEvent(e.events.down,i.CONTACT,this._selectNextContact.bind(this)),this.messageArea.onDelegateEvent(e.events.up,i.VIEWCONVERSATION,this._selectPreviousConversation.bind(this)),this.messageArea.onDelegateEvent(e.events.down,i.VIEWCONVERSATION,this._selectNextConversation.bind(this)),this.messageArea.onDelegateEvent(e.events.up,i.COURSE,this._selectPreviousCourse.bind()),this.messageArea.onDelegateEvent(e.events.down,i.COURSE,this._selectNextCourse.bind()),this.messageArea.onDelegateEvent("focus",i.SEARCHBOX,this._setSearching.bind(this)),this.messageArea.onDelegateEvent("blur",i.SEARCHBOX,this._clearSearching.bind(this)),e.define(this.messageArea.find(i.CONVERSATIONS),[e.events.scrollBottom]),e.define(this.messageArea.find(i.CONTACTS),[e.events.scrollBottom]),this.messageArea.onDelegateEvent(e.events.scrollBottom,i.CONVERSATIONS,this._loadConversations.bind(this)),this.messageArea.onDelegateEvent(e.events.scrollBottom,i.CONTACTS,this._loadContacts.bind(this)),this.messageArea.showContactsFirst()||(this._numConversationsDisplayed=20)},h.prototype._startDeleting=function(){this.messageArea.find(i.CONTACTSAREA).addClass("editing")},h.prototype._stopDeleting=function(){this.messageArea.find(i.CONTACTSAREA).removeClass("editing")},h.prototype._viewConversations=function(){0===this._numConversationsDisplayed&&this._loadConversations(),this.messageArea.find(i.CONTACTS).hide(),this.messageArea.find(i.CONVERSATIONS).show()},h.prototype._viewContacts=function(){0===this._numContactsDisplayed&&this._loadContacts(),this.messageArea.find(i.CONVERSATIONS).hide(),this.messageArea.find(i.CONTACTS).show()},h.prototype._handleMessageSent=function(a,b,c){this._viewConversations();var d=this._getUserNode(i.CONVERSATIONS,b);if(0===d.length){var e=this._getUserNode(i.CONTACTS,b);if(0===e.length&&(e=this._getUserNode(i.SEARCHRESULTSAREA,b)),0==e.length)return;d=e.clone(),d.attr("data-action","view-contact-msg"),this.messageArea.find(i.CONVERSATIONS+" "+i.NOCONTACTS).remove(),this._numConversationsDisplayed++}d.prependTo(this.messageArea.find(i.CONVERSATIONS)),this.messageArea.find(i.CONVERSATIONS).scrollTop(0),this._updateContactText(d,c,!0),this._setSelectedUser("[data-userid='"+b+"']")},h.prototype._loadConversations=function(){if(this._isLoadingConversations)return!1;this._isLoadingConversations=!0;var a=0;return c.render("core/loading",{}).then(function(a,b){return this._numConversationsDisplayed?c.appendNodeContents(this.messageArea.find(i.CONVERSATIONS),"<div style='text-align:center'>"+a+"</div>",b):c.replaceNodeContents(this.messageArea.find(i.CONVERSATIONS),"<div style='text-align:center'>"+a+"</div>",b),this._getItems("core_message_data_for_messagearea_conversations",this._numConversationsDisplayed,this._numConversationsToRetrieve)}.bind(this)).then(function(b){return a=b.contacts.length,b.isconversation=!0,c.render("core_message/message_area_contacts",b)}).then(function(b,d){this.messageArea.find(i.CONVERSATIONS+" "+i.LOADINGICON).remove(),a>0?(c.appendNodeContents(this.messageArea.find(i.CONVERSATIONS),b,d),this._numConversationsDisplayed+=this._numConversationsToRetrieve):this._numConversationsDisplayed||c.replaceNodeContents(this.messageArea.find(i.CONVERSATIONS),b,d),this._isLoadingConversations=!1}.bind(this)).fail(d.exception)},h.prototype._loadContacts=function(){if(this._isLoadingContacts)return!1;this._isLoadingContacts=!0;var a=0;return c.render("core/loading",{}).then(function(a,b){return this._numContactsDisplayed?c.appendNodeContents(this.messageArea.find(i.CONTACTS),"<div style='text-align:center'>"+a+"</div>",b):c.replaceNodeContents(this.messageArea.find(i.CONTACTS),"<div style='text-align:center'>"+a+"</div>",b),this._getItems("core_message_data_for_messagearea_contacts",this._numContactsDisplayed,this._numContactsToRetrieve)}.bind(this)).then(function(b){return a=b.contacts.length,b.isconversation=!1,c.render("core_message/message_area_contacts",b)}).then(function(b,d){this.messageArea.find(i.CONTACTS+" "+i.LOADINGICON).remove(),a>0?(c.appendNodeContents(this.messageArea.find(i.CONTACTS),b,d),this._numContactsDisplayed+=a):this._numContactsDisplayed||c.replaceNodeContents(this.messageArea.find(i.CONTACTS),b,d),this._isLoadingContacts=!1}.bind(this)).fail(d.exception)},h.prototype._viewConversation=function(b){this.messageArea.trigger(g.CANCELDELETEMESSAGES);var c=a(b.currentTarget).data("userid"),d=a(b.currentTarget).data("messageid"),e="[data-userid='"+c+"']";d&&(e="[data-messageid='"+d+"']"),this._setSelectedUser(e),this.messageArea.trigger(g.CONVERSATIONSELECTED,c),this.messageArea.find(i.SELECTEDVIEWPROFILE).removeClass("selected"),this._showMessagingArea()},h.prototype._viewContact=function(b){this.messageArea.trigger(g.CANCELDELETEMESSAGES);var c=a(b.currentTarget).data("userid");this._setSelectedUser("[data-userid='"+c+"']"),this.messageArea.trigger(g.CONTACTSELECTED,c),this.messageArea.find(i.SELECTEDVIEWCONVERSATION).removeClass("selected"),this._showMessagingArea()},h.prototype._getItems=function(a,c,d){var e=b.call([{methodname:a,args:{userid:this.messageArea.getCurrentUserId(),limitfrom:c,limitnum:d}}]);return e[0]},h.prototype._deleteConversation=function(a,b){this._removeContact(i.CONVERSATIONS,b),this._numConversationsDisplayed--,this._hideMessagingArea(),this._stopDeleting()},h.prototype._updateLastMessage=function(a,b,c){if(c){var d=this._getUserNode(i.CONVERSATIONS,b),e=c.find(i.MESSAGETEXT).text().trim(),f=!1;c.data("useridto")==b&&(f=!0),this._updateContactText(d,e,f)}this._stopDeleting()},h.prototype._addContact=function(){this.messageArea.find(i.CONTACTS).empty(),this._numContactsDisplayed=0,this._loadContacts()},h.prototype._removeContact=function(a,b){this._getUserNode(a,b).remove(),this._numContactsDisplayed--},h.prototype._blockContact=function(a){var b=this._getUserNode(i.CONTACTS,a);b.find(i.CONTACTICONBLOCKED).removeClass("hidden"),b=this._getUserNode(i.CONVERSATIONS,a),b.find(i.CONTACTICONBLOCKED).removeClass("hidden"),b=this._getUserNode(i.SEARCHRESULTSAREA,a),b.find(i.CONTACTICONBLOCKED).removeClass("hidden")},h.prototype._unblockContact=function(a){var b=this._getUserNode(i.CONTACTS,a);b.find(i.CONTACTICONBLOCKED).addClass("hidden"),b=this._getUserNode(i.CONVERSATIONS,a),b.find(i.CONTACTICONBLOCKED).addClass("hidden"),b=this._getUserNode(i.SEARCHRESULTSAREA,a),b.find(i.CONTACTICONBLOCKED).addClass("hidden")},h.prototype._getUserNode=function(a,b){return this.messageArea.find(a+" "+i.CONTACT+"[data-userid='"+b+"']")},h.prototype._setSelectedUser=function(a){this.messageArea.find(i.CONTACT).removeClass("selected"),this.messageArea.find(i.CONTACT).attr("aria-pressed",!1),this.messageArea.find(i.CONTACT+a).addClass("selected"),this.messageArea.find(i.CONTACT+a).attr("aria-pressed",!0)},h.prototype._getContactText=function(a){return a.length>this._messageLength&&(a=a.substr(0,this._messageLength-3),a+="..."),document.createTextNode(a)},h.prototype._updateContactText=function(a,b,c){b=this._getContactText(b),c?f.get_string("you","message").done(function(b){a.find(i.LASTMESSAGEUSER).empty().append(b)}).always(function(){a.find(i.LASTMESSAGETEXT).empty().append(b)}):(a.find(i.LASTMESSAGEUSER).empty(),a.find(i.LASTMESSAGETEXT).empty().append(b))},h.prototype._selectNextContact=function(b,c){var d=a(b.target).closest(i.CONTACT),e=d.next();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectPreviousContact=function(b,c){var d=a(b.target).closest(i.CONTACT),e=d.prev();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectNextCourse=function(b,c){var d=a(b.target).closest(i.COURSE);d.next().focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectPreviousCourse=function(b,c){var d=a(b.target).closest(i.COURSE);d.prev().focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectNextConversation=function(b,c){var d=a(b.target).closest(i.VIEWCONVERSATION),e=d.next();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectPreviousConversation=function(b,c){var d=a(b.target).closest(i.VIEWCONVERSATION),e=d.prev();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._setSearching=function(){a(i.SEARCHTEXTAREA).addClass("searching")},h.prototype._clearSearching=function(){a(i.SEARCHTEXTAREA).removeClass("searching")},h.prototype._showMessagingArea=function(){this.messageArea.find(i.MESSAGINGAREA).removeClass("hide-messages").addClass("show-messages")},h.prototype._hideMessagingArea=function(){this.messageArea.find(i.MESSAGINGAREA).removeClass("show-messages").addClass("hide-messages")},h});
define('core_message/message_drawer', ["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_view_contact","core_message/message_drawer_view_contacts","core_message/message_drawer_view_conversation","core_message/message_drawer_view_group_info","core_message/message_drawer_view_overview","core_message/message_drawer_view_search","core_message/message_drawer_view_settings","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core/pending"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={VIEW_CONTACT:'[data-region="view-contact"]',VIEW_CONTACTS:'[data-region="view-contacts"]',VIEW_CONVERSATION:'[data-region="view-conversation"]',VIEW_GROUP_INFO:'[data-region="view-group-info"]',VIEW_OVERVIEW:'[data-region="view-overview"]',VIEW_SEARCH:'[data-region="view-search"]',VIEW_SETTINGS:'[data-region="view-settings"]',ROUTES:"[data-route]",ROUTES_BACK:"[data-route-back]",HEADER_CONTAINER:'[data-region="header-container"]',BODY_CONTAINER:'[data-region="body-container"]',FOOTER_CONTAINER:'[data-region="footer-container"]'},p=function(a,b){var c=a.children(),d=c.filter(o.HEADER_CONTAINER).find(b),e=c.filter(o.BODY_CONTAINER).find(b),f=c.filter(o.FOOTER_CONTAINER).find(b),g=[d,e,f].filter(function(a){return a.length});return g},q=[[l.VIEW_CONTACT,o.VIEW_CONTACT,d.show,d.description],[l.VIEW_CONTACTS,o.VIEW_CONTACTS,e.show,e.description],[l.VIEW_CONVERSATION,o.VIEW_CONVERSATION,f.show,f.description],[l.VIEW_GROUP_INFO,o.VIEW_GROUP_INFO,g.show,g.description],[l.VIEW_OVERVIEW,o.VIEW_OVERVIEW,h.show,h.description],[l.VIEW_SEARCH,o.VIEW_SEARCH,i.show,i.description],[l.VIEW_SETTINGS,o.VIEW_SETTINGS,j.show,j.description]],r=function(a){q.forEach(function(b){k.add(b[0],p(a,b[1]),b[2],b[3])})},s=function(a){a.attr("data-shown")||(k.go(l.VIEW_OVERVIEW),a.attr("data-shown",!0)),a.removeClass("hidden"),a.attr("aria-expanded",!0),a.attr("aria-hidden",!1)},t=function(a){a.addClass("hidden"),a.attr("aria-expanded",!1),a.attr("aria-hidden",!0)},u=function(a){return!a.hasClass("hidden")},v=function(d){b.define(d,[b.events.activate]);var e=/^data-route-param-?(\d*)$/;d.on(b.events.activate,o.ROUTES,function(b,c){for(var d=a(b.target).closest(o.ROUTES),f=d.attr("data-route"),g=[],h=0;h<d[0].attributes.length;h++)g.push(d[0].attributes[h]);var i=g.filter(function(a){var b=a.nodeName,c=e.test(b);return c});i.sort(function(a,b){var c=e.exec(a.nodeName),d=e.exec(b.nodeName),f=c.length>1?c[1]:0,g=d.length>1?d[1]:0;return f<g?-1:g<f?1:0});var j=i.map(function(a){return a.nodeValue}),l=[f].concat(j);k.go.apply(null,l),c.originalEvent.preventDefault()}),d.on(b.events.activate,o.ROUTES_BACK,function(a,b){k.back(),b.originalEvent.preventDefault()}),c.subscribe(m.SHOW,function(){s(d)}),d.on("hide.bs.collapse",".collapse",function(b){var c=new n;a(b.target).one("hidden.bs.collapse",function(){c.resolve()})}),d.on("show.bs.collapse",".collapse",function(b){var c=new n;a(b.target).one("shown.bs.collapse",function(){c.resolve()})}),c.subscribe(m.HIDE,function(){t(d)}),c.subscribe(m.TOGGLE_VISIBILITY,function(){u(d)?t(d):s(d)}),c.subscribe(m.SHOW_CONVERSATION,function(a){s(d),k.go(l.VIEW_CONVERSATION,a)}),c.subscribe(m.CREATE_CONVERSATION_WITH_USER,function(a){s(d),k.go(l.VIEW_CONVERSATION,null,"create",a)}),c.subscribe(m.SHOW_SETTINGS,function(){s(d),k.go(l.VIEW_SETTINGS)}),c.subscribe(m.SHOW_CONTACT_REQUESTS,function(){s(d),k.go(l.VIEW_CONTACTS,"requests")}),c.subscribe(m.PREFERENCES_UPDATED,function(a){var b=a.filter(function(a){return"message_entertosend"==a.type}),c=b.length?b[0]:null;if(c){var e=d.find(o.FOOTER_CONTAINER).find(o.VIEW_CONVERSATION);e.attr("data-enter-to-send",c.value)}})},w=function(b){b=a(b),r(b),v(b)};return{init:w}});
define('core_message/message_area_search', ["jquery","core/ajax","core/templates","core/notification","core/str","core/custom_interaction_events","core_message/message_area_events"],function(a,b,c,d,e,f,g){function h(a){this.messageArea=a,this._init()}var i={CONTACTS:"[data-region='contacts'][data-region-content='contacts']",CONTACTSAREA:"[data-region='contacts-area']",CONVERSATIONS:"[data-region='contacts'][data-region-content='conversations']",DELETESEARCHFILTER:"[data-region='search-filter-area']",LOADINGICON:".loading-icon",SEARCHBOX:"[data-region='search-box']",SEARCHFILTER:"[data-region='search-filter']",SEARCHFILTERAREA:"[data-region='search-filter-area']",SEARCHRESULTSAREA:"[data-region='search-results-area']",SEARCHTEXTAREA:"[data-region='search-text-area']",SEARCHUSERSINCOURSE:"[data-action='search-users-in-course']"};return h.prototype.messageArea=null,h.prototype._searchArea=null,h.prototype._courseid=null,h.prototype._isLoading=!1,h.prototype._numMessagesDisplayed=0,h.prototype._numMessagesToRetrieve=20,h.prototype._numUsersDisplayed=0,h.prototype._numUsersToRetrieve=20,h.prototype._searchAreas={MESSAGES:"messages",USERS:"users",USERSINCOURSE:"usersincourse"},h.prototype._requestTimeout=null,h.prototype._init=function(){this.messageArea.find(i.SEARCHTEXTAREA).on("input",this._searchRequest.bind(this)),this.messageArea.onDelegateEvent(f.events.activate,i.SEARCHUSERSINCOURSE,function(b){this._setFilter(a(b.currentTarget).html()),this._setPlaceholderText("searchforuser"),this._clearSearchArea(),this._searchArea=this._searchAreas.USERSINCOURSE,this._courseid=a(b.currentTarget).data("courseid"),this._searchUsersInCourse(),this.messageArea.find(i.SEARCHBOX).focus()}.bind(this)),this.messageArea.onDelegateEvent(f.events.activate,i.DELETESEARCHFILTER,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.USERS,this._setPlaceholderText("searchforuserorcourse"),this.messageArea.trigger(g.USERSSEARCHCANCELED),this.messageArea.find(i.SEARCHBOX).focus()}.bind(this)),this.messageArea.onCustomEvent(g.CONVERSATIONSSELECTED,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.MESSAGES,this._setPlaceholderText("searchmessages")}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTSSELECTED,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.USERS,this._setPlaceholderText("searchforuserorcourse")}.bind(this)),this.messageArea.onCustomEvent(g.MESSAGESENT,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.MESSAGES,this._setPlaceholderText("searchmessages")}.bind(this)),f.define(this.messageArea.find(i.SEARCHRESULTSAREA),[f.events.scrollBottom]),this.messageArea.onDelegateEvent(f.events.scrollBottom,i.SEARCHRESULTSAREA,function(){this._searchArea==this._searchAreas.MESSAGES?this._searchMessages():this._searchArea==this._searchAreas.USERSINCOURSE&&this._searchUsersInCourse()}.bind(this)),this._searchArea=this.messageArea.showContactsFirst()?this._searchAreas.USERS:this._searchAreas.MESSAGES},h.prototype._searchRequest=function(){var a=this.messageArea.find(i.SEARCHTEXTAREA+" input").val();return this._requestTimeout&&clearTimeout(this._requestTimeout),""===a.trim()?void(this._searchArea==this._searchAreas.MESSAGES?(this._hideSearchResults(),this.messageArea.trigger(g.MESSAGESEARCHCANCELED)):this._searchArea==this._searchAreas.USERS?(this._hideSearchResults(),this.messageArea.trigger(g.USERSSEARCHCANCELED)):this._searchArea==this._searchAreas.USERSINCOURSE&&(this._clearSearchArea(),this._searchUsersInCourse())):(this.messageArea.find(i.CONVERSATIONS).hide(),this.messageArea.find(i.CONTACTS).hide(),this.messageArea.find(i.SEARCHRESULTSAREA).show(),void(this._searchArea==this._searchAreas.MESSAGES?this._requestTimeout=setTimeout(function(){this._clearSearchArea(),this._numMessagesDisplayed=0,this._searchMessages()}.bind(this),300):this._searchArea==this._searchAreas.USERSINCOURSE?this._requestTimeout=setTimeout(function(){this._clearSearchArea(),this._numUsersDisplayed=0,this._searchUsersInCourse()}.bind(this),300):this._requestTimeout=setTimeout(function(){this._clearSearchArea(),this._numUsersDisplayed=0,this._searchUsers()}.bind(this),300)))},h.prototype._searchMessages=function(){if(this._isLoading)return!1;var a=this.messageArea.find(i.SEARCHBOX).val();this._isLoading=!0;var e=b.call([{methodname:"core_message_data_for_messagearea_search_messages",args:{userid:this.messageArea.getCurrentUserId(),search:a,limitfrom:this._numMessagesDisplayed,limitnum:this._numMessagesToRetrieve}}]),f=0;return c.render("core/loading",{}).then(function(a,b){return c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),"<div style='text-align:center'>"+a+"</div>",b),e[0]}.bind(this)).then(function(a){return f=a.contacts.length,c.render("core_message/message_area_message_search_results",a)}).then(function(a,b){this.messageArea.find(i.SEARCHRESULTSAREA+" "+i.LOADINGICON).remove(),f>0?(c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._numMessagesDisplayed+=f):0==this._numMessagesDisplayed&&c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._isLoading=!1}.bind(this)).fail(d.exception)},h.prototype._searchUsers=function(){var a=this.messageArea.find(i.SEARCHBOX).val(),e=b.call([{methodname:"core_message_data_for_messagearea_search_users",args:{userid:this.messageArea.getCurrentUserId(),search:a,limitnum:this._numUsersToRetrieve}}]);return c.render("core/loading",{}).then(function(a,b){return c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),"<div style='text-align:center'>"+a+"</div>",b),e[0]}.bind(this)).then(function(a){return a.contacts.length>0&&(a.hascontacts=!0),a.courses.length>0&&(a.hascourses=!0),a.noncontacts.length>0&&(a.hasnoncontacts=!0),c.render("core_message/message_area_user_search_results",a)}).then(function(a,b){c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b)}.bind(this)).fail(d.exception)},h.prototype._searchUsersInCourse=function(){if(this._isLoading)return!1;var a=this.messageArea.find(i.SEARCHBOX).val();this._isLoading=!0;var e=b.call([{methodname:"core_message_data_for_messagearea_search_users_in_course",args:{userid:this.messageArea.getCurrentUserId(),courseid:this._courseid,search:a,limitfrom:this._numUsersDisplayed,limitnum:this._numUsersToRetrieve}}]),f=0;return c.render("core/loading",{}).then(function(a,b){return c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),"<div style='text-align:center'>"+a+"</div>",b),e[0]}.bind(this)).then(function(a){return f=a.contacts.length,f>0&&(a.hascontacts=!0),c.render("core_message/message_area_user_search_results",a)}).then(function(a,b){this.messageArea.find(i.SEARCHRESULTSAREA+" "+i.LOADINGICON).remove(),f>0?(c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._numUsersDisplayed+=f):0==this._numUsersDisplayed&&c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._isLoading=!1}.bind(this)).fail(d.exception)},h.prototype._setPlaceholderText=function(a){return e.get_string(a,"message").then(function(a){this.messageArea.find(i.SEARCHTEXTAREA+" input").attr("placeholder",a)}.bind(this))},h.prototype._setFilter=function(a){this.messageArea.find(i.SEARCHBOX).val(""),this.messageArea.find(i.CONTACTSAREA).addClass("searchfilter"),this.messageArea.find(i.SEARCHFILTERAREA).show(),this.messageArea.find(i.SEARCHFILTER).html(a),e.get_string("removecoursefilter","message",a).then(function(a){this.messageArea.find(i.SEARCHFILTERAREA).attr("aria-label",a)}.bind(this))["catch"](d.exception)},h.prototype._clearFilters=function(){this.messageArea.find(i.CONTACTSAREA).removeClass("searchfilter"),this.messageArea.find(i.SEARCHFILTER).empty(),this.messageArea.find(i.SEARCHFILTERAREA).hide(),this.messageArea.find(i.SEARCHFILTERAREA).removeAttr("aria-label")},h.prototype._clearSearchArea=function(){this.messageArea.find(i.SEARCHRESULTSAREA).empty()},h.prototype._hideSearchResults=function(){this._clearFilters(),this.messageArea.find(i.SEARCHTEXTAREA+" input").val(""),this._clearSearchArea(),this.messageArea.find(i.SEARCHRESULTSAREA).hide()},h});
define('core_message/message_preferences', ["jquery","core/ajax","core/notification","core_message/message_notification_preference","core/custom_interaction_events"],function(a,b,c,d,e){var f={PREFERENCE:"[data-state]",PREFERENCES_CONTAINER:'[data-region="preferences-container"]',CONTACTABLE_PRIVACY_CONTAINER:'[data-region="privacy-setting-container"]'},g=function(b){this.root=a(b),this.userId=this.root.find(f.PREFERENCES_CONTAINER).attr("data-user-id"),this.registerEventListeners()};return g.prototype.preferencesDisabled=function(){return this.root.find(f.PREFERENCES_CONTAINER).hasClass("disabled")},g.prototype.saveContactablePrivacySetting=function(){var d=this.root.find(f.CONTACTABLE_PRIVACY_CONTAINER),e=a("input[type='radio']:checked").val();if(d.hasClass("loading"))return a.Deferred().resolve();d.addClass("loading");var g={methodname:"core_user_update_user_preferences",args:{userid:this.userId,preferences:[{type:d.attr("data-preference-key"),value:e}]}};return b.call([g])[0].fail(c.exception).always(function(){d.removeClass("loading")})},g.prototype.registerEventListeners=function(){e.define(this.root,[e.events.activate]),this.root.on("change",function(b){if("message_blocknoncontacts"==b.target.name)this.saveContactablePrivacySetting();else if(!this.preferencesDisabled()){var c=a(b.target).closest(f.PREFERENCES_CONTAINER),e=a(b.target).closest(f.PREFERENCE),g=new d(c,this.userId);e.addClass("loading"),g.save().always(function(){e.removeClass("loading")})}}.bind(this))},g});
define('core_message/message_drawer_view_overview_section', ["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/str","core/templates","core/user_date","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_lazy_load_list","core_message/message_drawer_view_conversation_constants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={TOGGLE:'[data-region="toggle"]',CONVERSATION:"[data-conversation-id]",BLOCKED_ICON_CONTAINER:'[data-region="contact-icon-blocked"]',LAST_MESSAGE:'[data-region="last-message"]',LAST_MESSAGE_DATE:'[data-region="last-message-date"]',UNREAD_COUNT:'[data-region="unread-count"]',SECTION_TOTAL_COUNT:'[data-region="section-total-count"]',SECTION_TOTAL_COUNT_CONTAINER:'[data-region="section-total-count-container"]',SECTION_UNREAD_COUNT:'[data-region="section-unread-count"]',PLACEHOLDER_CONTAINER:'[data-region="placeholder-container"]'},o={CONVERSATIONS_LIST:"core_message/message_drawer_conversations_list",CONVERSATIONS_LIST_ITEMS_PLACEHOLDER:"core_message/message_drawer_conversations_list_items_placeholder"},p=50,q={},r=!1,s=!1,t=function(a){return l.getRoot(a).hasClass("show")},u=function(a){a.addClass("expanded")},v=function(a){a.removeClass("expanded")},w=function(a,b){var c=a.find(n.SECTION_TOTAL_COUNT_CONTAINER),d=c.find(n.SECTION_TOTAL_COUNT);d.text(b),c.removeClass("hidden"),e.get_string("totalconversations","core_message",b).done(function(a){c.attr("aria-label",a)});var g=b>20?20:b,h=Array.apply(null,Array(g)).map(function(){return!0});f.render(o.CONVERSATIONS_LIST_ITEMS_PLACEHOLDER,{placeholders:h}).then(function(b){var c=a.find(n.PLACEHOLDER_CONTAINER);c.html(b)})["catch"](function(){})},x=function(a,b){var c=a.find(n.SECTION_UNREAD_COUNT);c.text(b),e.get_string("unreadconversations","core_message",b).done(function(a){c.attr("aria-label",a)}),b>0&&c.removeClass("hidden")},y=function(b){var c=function(b){return Object.keys(b).reduce(function(d,e){return a.isArray(b[e])?d[e.toLowerCase()]=b[e].map(c):d[e.toLowerCase()]=b[e],d},{})},d=c(b);return d.messages=d.messages.map(function(a){return a.useridfrom=a.userfrom.id,a}),d},z=function(b,c){var d=b.map(function(b){var d=b.messages.length?b.messages[b.messages.length-1]:null,e={id:b.id,imageurl:b.imageurl,name:b.name,subname:b.subname,unreadcount:b.unreadcount,lastmessagedate:d?d.timecreated:null,sentfromcurrentuser:d?d.useridfrom==c:null,lastmessage:d?a(d.text).text()||d.text:null};if(b.type==m.CONVERSATION_TYPES.PRIVATE){var f=b.members.reduce(function(a,b){return a||b.id==c||(a=b),a},null);e.userid=f.id,e.showonlinestatus=f.showonlinestatus,e.isonline=f.isonline,e.isblocked=f.isblocked}return b.type==m.CONVERSATION_TYPES.PUBLIC&&(e.lastsendername=b.members.reduce(function(a,b){return!a&&d&&b.id==d.useridfrom&&(a=b.fullname),a},null)),e});return f.render(o.CONVERSATIONS_LIST,{conversations:d})},A=function(a,b,d){return function(e,f){return h.getConversations(f,a,p+1,d,b).then(function(a){var b=a.conversations;return b.length>p?b=b.slice(0,-1):l.setLoadedAll(e,!0),d+=p,b.forEach(function(a){q[a.id]=a}),b})["catch"](c.exception)}},B=function(a){return a.find(n.SECTION_TOTAL_COUNT)},C=function(a){return a.find(n.SECTION_UNREAD_COUNT)},D=function(a){if(r){var b=B(a),c=parseInt(b.text());c+=1,b.text(c)}},E=function(a){if(r){var b=B(a),c=parseInt(b.text());c-=1,b.text(c)}},F=function(a){if(s){var b=C(a),c=parseInt(b.text());c-=1,b.text(c),c<1&&b.addClass("hidden")}},G=function(a,b){return a.find('[data-conversation-id="'+b+'"]')},H=function(a,b){return a.find('[data-user-id="'+b+'"]')},I=function(a){a.find(n.BLOCKED_ICON_CONTAINER).removeClass("hidden")},J=function(a){a.find(n.BLOCKED_ICON_CONTAINER).addClass("hidden")},K=function(a,b,d){var e=a.find(n.CONVERSATION);if(!e.length){var f=l.getRoot(a);l.showContent(f),l.hideEmptyMessage(f)}return q[b.id]=b,z([b],d).then(function(b){var c=l.getContentContainer(a);return c.prepend(b)}).then(function(){return D(a)})["catch"](c.exception)},L=function(a,b){b.remove(),E(a);var c=a.find(n.CONVERSATION);if(!c.length){var d=l.getRoot(a);l.hideContent(d),l.showEmptyMessage(d)}},M=function(a,b){var c=b.find(n.UNREAD_COUNT);c.text("0"),c.addClass("hidden"),F(a)},N=function(e,f,g,h){var m=l.getRoot(e),o=e.find(n.TOGGLE);e.css("min-height",o.outerHeight()),e.on("show.bs.collapse",function(){u(e),l.show(m,f,function(a,b,d){return z(b,d).then(function(b){return a.append(b),b})["catch"](c.exception)})}),e.on("hidden.bs.collapse",function(){v(e)}),d.subscribe(i.CONTACT_BLOCKED,function(a){var b=H(e,a);b.length&&I(b)}),d.subscribe(i.CONTACT_UNBLOCKED,function(a){var b=H(e,a);b.length&&J(b)}),d.subscribe(i.CONVERSATION_NEW_LAST_MESSAGE,function(a){if(!(g&&a.type!=g||h&&!a.isFavourite||!h&&a.isFavourite)){var b=a.loggedInUserId,d=a.id,f=G(e,d);if(a=y(a),f.length){var i=l.getContentContainer(e);z([a],b).then(function(a){return i.prepend(a),f.remove(),a})["catch"](c.exception)}else K(e,a,b)}}),d.subscribe(i.CONVERSATION_DELETED,function(a){var b=G(e,a);delete q[a],b.length&&L(e,b)}),d.subscribe(i.CONVERSATION_READ,function(a){var b=G(e,a);b.length&&M(e,b)}),d.subscribe(i.CONVERSATION_SET_FAVOURITE,function(a){var b=null;!h||g&&g!=a.type?g==a.type&&(b=G(e,a.id),b.length&&L(e,b)):(b=G(e,a.id),b.length||K(e,y(a),a.loggedInUserId))}),d.subscribe(i.CONVERSATION_UNSET_FAVOURITE,function(a){var b=null;h?(b=G(e,a.id),b.length&&L(e,b)):g==a.type&&(b=G(e,a.id),b.length||K(e,y(a),a.loggedInUserId))}),b.define(e,[b.events.activate]),e.on(b.events.activate,n.CONVERSATION,function(b,c){var d=a(b.target).closest(n.CONVERSATION),e=d.attr("data-conversation-id"),f=q[e];j.go(k.VIEW_CONVERSATION,f),c.originalEvent.preventDefault()})},O=function(b,d,e,f,g){if(b=a(b),!b.attr("data-init")){var h=A(d,e,0);if(N(b,h,d,e),t(b)){u(b);var i=l.getRoot(b);l.show(i,h,function(a,b,d){return z(b,d).then(function(b){return a.append(b),b})["catch"](c.exception)})}f.then(function(a){w(b,a),r=!0})["catch"](function(){}),g.then(function(a){x(b,a),s=!0})["catch"](function(){}),b.attr("data-init",!0)}};return{show:O,isVisible:t}});
define('core_message/message_drawer_view_settings', ["jquery","core/notification","core/str","core/pubsub","core/templates","core_message/message_repository","core/custom_interaction_events","core_message/message_drawer_events"],function(a,b,c,d,e,f,g,h){var i={CHECKBOX:'input[type="checkbox"]',SETTINGS:'[data-region="settings"]',PRIVACY_PREFERENCE:'[data-preference="blocknoncontacts"] input[type="radio"]',NOTIFICATIONS_PREFERENCE:'[data-preference="notifications"] input[type="checkbox"]',ENTER_TO_SEND_PREFERENCE:'[data-preference="entertosend"] input[type="checkbox"]',NOTIFICATION_PREFERENCES_CONTAINER:'[data-region="notification-preference-container"]',CONTENT_CONTAINER:'[data-region="content-container"]',PLACEHOLDER_CONTAINER:'[data-region="placeholder-container"]'},j={NOTIFICATION_PREFERENCES:"core_message/message_drawer_view_settings_body_content_notification_preferences"},k="message_provider_moodle_instantmessage",l=function(b,c){var d=b.find(i.PRIVACY_PREFERENCE);d.each(function(b,d){d=a(d),d.val()==c?d.prop("checked",!0):d.prop("checked",!1)})},m=function(a,b){var c=a.find(i.ENTER_TO_SEND_PREFERENCE);b?c.prop("checked",!0):c.prop("checked",!1)},n=function(a,c){return f.savePreferences(a,c).then(function(){d.publish(h.PREFERENCES_UPDATED,c)})["catch"](b.exception)},o=function(b,c){var d=b.find(i.SETTINGS);g.define(d,[g.events.activate]),d.on(g.events.activate,i.NOTIFICATIONS_PREFERENCE,function(b){var d=a(b.target).closest(i.NOTIFICATION_PREFERENCES_CONTAINER),e=d.find(i.CHECKBOX);if(e.length){var f=e.toArray().reduce(function(b,c){return c=a(c),c.prop("checked")&&b.push(c.attr("data-name")),b},[]),g=f.length?f.join(","):"none",h=[{type:"message_provider_moodle_instantmessage_loggedoff",value:g},{type:"message_provider_moodle_instantmessage_loggedin",value:g}];n(c,h)}}),d.on("change",i.PRIVACY_PREFERENCE,function(b){var d=a(b.target).val(),e=[{type:"message_blocknoncontacts",value:d}];n(c,e)}),d.on(g.events.activate,i.ENTER_TO_SEND_PREFERENCE,function(b){var d=a(b.target).prop("checked"),e=[{type:"message_entertosend",value:d}];n(c,e)})},p=function(a,c){f.getUserMessagePreferences(c).then(function(b){l(a,b.blocknoncontacts),m(a,b.entertosend);var c=[];b.preferences.components.length&&b.preferences.components.forEach(function(a){if(a.notifications.length){var b=a.notifications.filter(function(a){return a.preferencekey==k});if(b.length){var d=a.notifications[0];c=d.processors.map(function(a){var b=a.loggedin.checked||a.loggedoff.checked;return{displayname:a.displayname,name:a.name,checked:b,locked:a.locked,lockedmessage:a.lockedmessage||null}})}}});var d=a.find(i.NOTIFICATION_PREFERENCES_CONTAINER);return!c.length||(d.removeClass("hidden"),e.render(j.NOTIFICATION_PREFERENCES,{processors:c}).then(function(a){return d.append(a),a}))}).then(function(){a.find(i.CONTENT_CONTAINER).removeClass("hidden"),a.find(i.PLACEHOLDER_CONTAINER).addClass("hidden"),o(a,c)})["catch"](b.exception)},q=function(b,c,d){return c.attr("data-init")||(p(c,d),c.attr("data-init",!0)),a.Deferred().resolve().promise()},r=function(){return c.get_string("messagedrawerviewsettings","core_message")};return{show:q,description:r}});
define('core_message/message_drawer_view_conversation_state_manager', ["jquery"],function(a){var b=function(b){var c=a.extend({},b);return c.messages=b.messages.map(function(b){return a.extend({},b)}),c.members=Object.keys(b.members).reduce(function(c,d){return c[d]=a.extend({},b.members[d]),c[d].contactrequests=b.members[d].contactrequests.map(function(b){return a.extend({},b)}),c},{}),c},c=function(a,b,c){return a.map(function(a){var d=a.useridfrom==b;return{id:parseInt(a.id,10),isRead:a.isread,fromLoggedInUser:d,userFrom:c[a.useridfrom],text:a.text,timeCreated:parseInt(a.timecreated,10)}})},d=function(a){return a.map(function(a){return{id:a.id,fullname:a.fullname,profileurl:a.profileurl,profileimageurl:a.profileimageurl,profileimageurlsmall:a.profileimageurlsmall,isonline:a.isonline,showonlinestatus:a.showonlinestatus,isblocked:a.isblocked,iscontact:a.iscontact,isdeleted:a.isdeleted,canmessage:a.canmessage,requirescontact:a.requirescontact,contactrequests:a.contactrequests||[]}})},e=function(a,b,c,d,e,f){return{midnight:a,loggedInUserId:b,id:c,messagePollMin:d,messagePollMax:e,messagePollAfterMax:f,name:null,subname:null,type:null,totalMemberCount:null,imageUrl:null,isFavourite:null,members:{},messages:[],hasTriedToLoadMessages:!1,loadingMessages:!0,sendingMessage:!1,loadingMembers:!0,loadingConfirmAction:!1,pendingBlockUserIds:[],pendingUnblockUserIds:[],pendingRemoveContactIds:[],pendingAddContactIds:[],pendingDeleteMessageIds:[],pendingDeleteConversation:!1,selectedMessageIds:[]}},f=function(a,d){var e=b(a),f=c(d,a.loggedInUserId,a.members),g=a.messages.concat(f);return g.sort(function(a,b){return a.timeCreated<b.timeCreated?-1:a.timeCreated>b.timeCreated?1:a.id<b.id?-1:a.id>b.id?1:0}),e.messages=g.filter(function(a,b,c){return!b||a.id!==c[b-1].id}),e},g=function(a,c){var d=b(a),e=c.map(function(a){return a.id});return d.messages=d.messages.filter(function(a){return e.indexOf(a.id)<0}),d},h=function(a,c){var d=b(a);return d.messages=d.messages.filter(function(a){return c.indexOf(a.id)<0}),d},i=function(a,c){var e=b(a),f=d(c);return f.forEach(function(a){e.members[a.id]=a}),e},j=function(a,c){var d=b(a);return c.forEach(function(a){delete d.members[a.id]}),d},k=function(a,c){var d=b(a);return d.loadingMessages=c,a.loadingMessages&&!c&&(d.hasTriedToLoadMessages=!0),d},l=function(a,c){var d=b(a);return d.sendingMessage=c,d},m=function(a,c){var d=b(a);return d.loadingMembers=c,d},n=function(a,c){var d=b(a);return d.id=c,d},o=function(a,c){var d=b(a);return d.name=c,d},p=function(a,c){var d=b(a);return d.subname=c,d},q=function(a,c){var d=b(a);return d.type=c,d},r=function(a,c){var d=b(a);return d.isFavourite=c,d},s=function(a,c){var d=b(a);return d.totalMemberCount=c,d},t=function(a,c){var d=b(a);return d.imageUrl=c,d},u=function(a,c){var d=b(a);return d.loadingConfirmAction=c,d},v=function(a,c){var d=b(a);return d.pendingDeleteConversation=c,d},w=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingBlockUserIds.push(a)}),d},x=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingRemoveContactIds.push(a)}),d},y=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingUnblockUserIds.push(a)}),d},z=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingAddContactIds.push(a)}),d},A=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingDeleteMessageIds.push(a)}),d},B=function(a,c){var d=b(a);return d.pendingBlockUserIds=d.pendingBlockUserIds.filter(function(a){return c.indexOf(a)<0}),d},C=function(a,c){var d=b(a);return d.pendingRemoveContactIds=d.pendingRemoveContactIds.filter(function(a){return c.indexOf(a)<0}),d},D=function(a,c){var d=b(a);return d.pendingUnblockUserIds=d.pendingUnblockUserIds.filter(function(a){return c.indexOf(a)<0}),d},E=function(a,c){var d=b(a);return d.pendingAddContactIds=d.pendingAddContactIds.filter(function(a){return c.indexOf(a)<0}),d},F=function(a,c){var d=b(a);return d.pendingDeleteMessageIds=d.pendingDeleteMessageIds.filter(function(a){return c.indexOf(a)<0}),d},G=function(a,c){var d=b(a);return d.selectedMessageIds=d.selectedMessageIds.concat(c),d},H=function(a,c){var d=b(a);return d.selectedMessageIds=d.selectedMessageIds.filter(function(a){return c.indexOf(a)<0}),d},I=function(a,c){var d=b(a),e=c.map(function(a){return a.id});return d.messages=d.messages.map(function(a){return e.indexOf(a.id)>=0&&(a.isRead=!0),a}),d},J=function(a,c){var d=b(a);return c.forEach(function(a){var b=a.userid,c=a.requesteduserid;d.members[b].contactrequests.push(a),d.members[c].contactrequests.push(a)}),d},K=function(a,c){var d=b(a);return c.forEach(function(a){var b=a.userid,c=a.requesteduserid;d.members[b].contactrequests=d.members[b].contactrequests.filter(function(a){return a.userid!=b}),d.members[c].contactrequests=d.members[c].contactrequests.filter(function(a){return a.requesteduserid!=c})}),d};return{buildInitialState:e,addMessages:f,removeMessages:g,removeMessagesById:h,addMembers:i,removeMembers:j,setLoadingMessages:k,setSendingMessage:l,setLoadingMembers:m,setId:n,setName:o,setSubname:p,setType:q,setIsFavourite:r,setTotalMemberCount:s,setImageUrl:t,setLoadingConfirmAction:u,setPendingDeleteConversation:v,addPendingBlockUsersById:w,addPendingRemoveContactsById:x,addPendingUnblockUsersById:y,addPendingAddContactsById:z,addPendingDeleteMessagesById:A,removePendingBlockUsersById:B,removePendingRemoveContactsById:C,removePendingUnblockUsersById:D,removePendingAddContactsById:E,removePendingDeleteMessagesById:F,addSelectedMessagesById:G,removeSelectedMessagesById:H,markMessagesAsRead:I,addContactRequests:J,removeContactRequests:K}});
define('core_message/message_popover', ["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_events"],function(a,b,c,d){var e={COUNT_CONTAINER:'[data-region="count-container"]'},f=function(){c.publish(d.TOGGLE_VISIBILITY)},g=function(a){return function(){var b=a.find(e.COUNT_CONTAINER),c=parseInt(b.text(),10);isNaN(c)?b.addClass("hidden"):!c||c<2?b.addClass("hidden"):(c-=1,b.text(c))}},h=function(a){b.define(a,[b.events.activate]),a.on(b.events.activate,function(a,b){f(),b.originalEvent.preventDefault()}),c.subscribe(d.CONVERSATION_READ,g(a)),c.subscribe(d.CONTACT_REQUEST_ACCEPTED,g(a)),c.subscribe(d.CONTACT_REQUEST_DECLINED,g(a))},i=function(b){b=a(b),h(b)};return{init:i}});
define('core_message/message_drawer_view_contacts', ["jquery","core/pubsub","core/str","core_message/message_drawer_events","core_message/message_drawer_view_contacts_section_contacts","core_message/message_drawer_view_contacts_section_requests"],function(a,b,c,d,e,f){var g={ACTION_SHOW_CONTACTS_SECTION:'[data-action="show-contacts-section"]',ACTION_SHOW_REQUESTS_SECTION:'[data-action="show-requests-section"]',CONTACT_REQUEST_COUNT:'[data-region="contact-request-count"]',CONTACTS_SECTION_CONTAINER:'[data-section="contacts"]',REQUESTS_SECTION_CONTAINER:'[data-section="requests"]'},h=function(a){return a.find(g.CONTACTS_SECTION_CONTAINER)},i=function(a){return a.find(g.REQUESTS_SECTION_CONTAINER)},j=function(a){return a.find(g.ACTION_SHOW_CONTACTS_SECTION)},k=function(a){return a.find(g.ACTION_SHOW_REQUESTS_SECTION)},l=function(a){return a.hasClass("active")},m=function(a){return function(){var b=a.find(g.CONTACT_REQUEST_COUNT),c=parseInt(b.text(),10);c=isNaN(c)?0:c-1,c<=0?b.addClass("hidden"):b.text(c)}},n=function(a){var c=h(a),j=i(a),k=a.find(g.ACTION_SHOW_CONTACTS_SECTION),l=a.find(g.ACTION_SHOW_REQUESTS_SECTION);k.on("show.bs.tab",function(){e.show(c)}),l.on("show.bs.tab",function(){f.show(j)}),b.subscribe(d.CONTACT_REQUEST_ACCEPTED,m(a)),b.subscribe(d.CONTACT_REQUEST_DECLINED,m(a))},o=function(b,c,d){c=a(c),c.attr("data-contacts-init")||(n(c),c.attr("data-contacts-init",!0));var g=h(c),m=i(c);if(d){var o=j(c),p=k(c);"requests"==d?(o.removeClass("active"),g.removeClass("show active"),p.addClass("active"),m.addClass("show active")):(p.removeClass("active"),m.removeClass("show active"),o.addClass("active"),g.addClass("show active"))}return l(g)?e.show(g):f.show(m),a.Deferred().resolve().promise()},p=function(){return c.get_string("messagedrawerviewcontacts","core_message")};return{show:o,description:p}});
define('core_message/message_drawer_helper', ["core/pubsub","core_message/message_drawer_events"],function(a,b){var c=function(c){a.publish(b.CREATE_CONVERSATION_WITH_USER,c)},d=function(){a.publish(b.SHOW)},e=function(c){a.publish(b.SHOW_CONVERSATION,c)},f=function(){a.publish(b.SHOW_SETTINGS)},g=function(){a.publish(b.SHOW_CONTACT_REQUESTS)};return{createConversationWithUser:c,show:d,showContactRequests:g,showConversation:e,showSettings:f}});
define('core_question/selectors', [],function(){return{actions:{save:'[data-action="save"]',edittags:'[data-action="edittags"]'},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}});
define('core_question/edit_tags', ["jquery","core/fragment","core/str","core/modal_events","core/modal_factory","core/notification","core/custom_interaction_events","core_question/repository","core_question/selectors"],function(a,b,c,d,e,f,g,h,i){var j=function(a){a.find(i.actions.save).prop("disabled",!1)},k=function(a){a.find(i.actions.save).prop("disabled",!0)},l=function(a){return a.getBody().find("form").serialize()},m=function(a){var b=a.find(i.containers.loadingIcon);b.removeClass("hidden")},n=function(a){var b=a.find(i.containers.loadingIcon);b.addClass("hidden")},o=function(a,b){a.getBody().attr("data-contextid",b)},p=function(a){return a.getBody().data("contextid")},q=function(a,b){a.getBody().attr("data-questionid",b)},r=function(a){return a.getBody().data("questionid")},s=function(h){var l=e.create({type:e.types.SAVE_CANCEL,large:!1},[h,i.actions.edittags]).then(function(a){return c.get_string("questiontags","question").then(function(b){return a.setTitle(b),b}).fail(f.exception),a.getRoot().on(d.save,function(b){var c=a.getBody().find("form");c.submit(),b.preventDefault()}),a.getRoot().on("submit","form",function(b){t(a,h).then(function(){a.hide(),location.reload()}).fail(f.exception),b.preventDefault(),b.stopPropagation()}),a});h.on(g.events.activate,i.actions.edittags,function(c){var d=a(c.currentTarget),e=d.data("questionid"),g=!!d.data("cantag"),p=d.data("contextid");l.then(function(a){k(h),m(h);var c={id:e},d=b.loadFragment("question","tags_form",p,c);return a.setBody(d),d.then(function(){j(h)}).always(function(){n(h)}).fail(f.exception),g?a.getRoot().find(i.actions.save).show():a.getRoot().find(i.actions.save).hide(),q(a,e),o(a,p),a}).fail(f.exception),c.preventDefault()})},t=function(a,b){k(b),m(b);var c=l(a),d=r(a),e=p(a);return h.submitTagCreateUpdateForm(d,e,c).always(function(){n(b),j(b)}).fail(f.exception)};return{init:function(b){b=a(b),s(b)}}});
define('core_question/repository', ["jquery","core/ajax"],function(a,b){var c=function(a,c,d){var e={methodname:"core_question_submit_tags_form",args:{questionid:a,contextid:c,formdata:d}};return b.call([e])[0]};return{submitTagCreateUpdateForm:c}});
define('core_search/form-search-user-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h,i={query:e},j=a(d).attr("withincourseid");"undefined"!=typeof j&&""!==a("#id_searchwithin").val()?i.courseid=j:i.courseid=0,h=b.call([{methodname:"core_search_get_relevant_users",args:i}]),h[0].then(function(b){var d=[];return a.each(b,function(a,b){d.push(c.render("core_search/form-user-selector-suggestion",b))}),a.when.apply(a.when,d).then(function(){var c=arguments,d=0;a.each(b,function(a,b){b._label=c[d++]}),f(b)})}).fail(g)}}});
define('core_user/status_field', ["core/templates","jquery","core/str","core/config","core/notification","core/modal_factory","core/modal_events","core/fragment","core/ajax"],function(a,b,c,d,e,f,g,h,i){var j={EDIT_ENROLMENT:'[data-action="editenrolment"]',SHOW_DETAILS:'[data-action="showdetails"]',UNENROL:'[data-action="unenrol"]'},k=function(a){this.contextid=a.contextid,this.courseid=a.courseid,this.bindEditEnrol(),this.bindUnenrol(),this.bindStatusDetails()};return k.prototype.courseid=0,k.prototype.bindEditEnrol=function(){var a=this;b(j.EDIT_ENROLMENT).click(function(d){d.preventDefault();var h=b(this),i=h.parent(),j=i.data("fullname"),k=h.attr("rel");b.when(c.get_string("edituserenrolment","enrol",j)).then(function(a){return f.create({large:!0,title:a,type:f.types.SAVE_CANCEL})}).done(function(b){b.getRoot().on(g.save,function(c){c.preventDefault(),a.submitEditFormAjax(b)}),b.getRoot().on(g.hidden,function(){b.destroy()}),b.setBody(a.getBody(k)),b.show()}).fail(e.exception)})},k.prototype.bindUnenrol=function(){var a=this;b(j.UNENROL).click(function(d){d.preventDefault();var h=b(this),i=h.parent(),j=[{key:"unenrol",component:"enrol"},{key:"unenrolconfirm",component:"enrol",param:{user:i.data("fullname"),course:i.data("coursename"),enrolinstancename:i.data("enrolinstancename")}}],k=f.create({type:f.types.SAVE_CANCEL});b.when(c.get_strings(j),k).done(function(c,e){var f=c[0],i=c[1];e.setTitle(f),e.setBody(i),e.setSaveButtonText(f),e.getRoot().on(g.save,function(){var c={ueid:b(h).attr("rel")};d.preventDefault(),a.submitUnenrolFormAjax(e,c)}),e.getRoot().on(g.hidden,function(){e.destroy()}),e.show()}).fail(e.exception)})},k.prototype.bindStatusDetails=function(){b(j.SHOW_DETAILS).click(function(d){d.preventDefault();var h=b(this),i=h.parent(),k={fullname:i.data("fullname"),coursename:i.data("coursename"),enrolinstancename:i.data("enrolinstancename"),status:i.data("status"),statusclass:i.find("span").attr("class"),timestart:i.data("timestart"),timeend:i.data("timeend")},l=[{key:"enroldetails",component:"enrol"}],m=h.next(j.EDIT_ENROLMENT);m.length&&(k.editenrollink=b("<div>").append(m.clone()).html());var n=c.get_strings(l),o=f.create({large:!0,type:f.types.CANCEL});b.when(n,o).done(function(c,d){var e=a.render("core_user/status_details",k);d.setTitle(c[0]),d.setBody(e),m.length&&d.getRoot().on("click",j.EDIT_ENROLMENT,function(a){a.preventDefault(),d.hide(),b(m).trigger("click")}),d.show(),d.getRoot().on(g.hidden,function(){d.destroy()})}).fail(e.exception)})},k.prototype.submitEditFormAjax=function(a){var c=this,d=a.getRoot().find("form"),f=b(d).find('[name="ue"]').val(),g={methodname:"core_enrol_submit_user_enrolment_form",args:{formdata:d.serialize()}};i.call([g])[0].done(function(b){if(b.result)a.hide(),"undefined"!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload();else{var e=JSON.stringify(d.serialize());a.setBody(c.getBody(f,e))}}).fail(e.exception)},k.prototype.submitUnenrolFormAjax=function(a,b){var c={methodname:"core_enrol_unenrol_user_enrolment",args:b};i.call([c])[0].done(function(b){b.result?(a.hide(),"undefined"!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload()):e.alert(b.errors[0].key,b.errors[0].message)}).fail(e.exception)},k.prototype.getBody=function(a,b){var c={ueid:a};return"undefined"!=typeof b&&(c.formdata=b),h.loadFragment("enrol","user_enrolment_form",this.contextid,c).fail(e.exception)},{init:function(a){new k(a)}}});
define('core_user/unified_filter_datasource', ["jquery","core/ajax","core/notification"],function(a,b,c){return{list:function(b,c){var d=[],e=a(b),f=a(b).data("originaloptionsjson"),g=e.val();a.each(f,function(b,e){return""!==a.trim(c)&&e.label.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())===-1||(a.inArray(e.value,g)>-1||(d.push(e),!0))});var h=new a.Deferred;return h.resolve(d),h.promise()},processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.value,label:b.label})}),d},transport:function(a,b,d){this.list(a,b).then(d)["catch"](c.exception)}}});
define('core_user/unified_filter', ["jquery","core/form-autocomplete","core/str","core/notification"],function(a,b,c,d){var e={UNIFIED_FILTERS:"#unified-filters"},f=function(){var f=[{key:"userfilterplaceholder",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}];M.util.js_pending("unified_filter_datasource"),c.get_strings(f).done(function(a){var c=a[0],f=a[1];b.enhance(e.UNIFIED_FILTERS,!0,"core_user/unified_filter_datasource",c,!1,!0,f,!0).then(function(){M.util.js_complete("unified_filter_datasource")}).fail(d.exception)}).fail(d.exception);var g=a(e.UNIFIED_FILTERS).val();a(e.UNIFIED_FILTERS).on("change",function(){var b=a(this).val(),c=[],d=[],e=!1;if(a.each(b,function(a,b){var f=b.split(":",2);if(2!==f.length)return d.push(b),!0;var g=f[0],h=f[1];return"undefined"!=typeof c[g]&&(e=!0),c[g]=h,!0}),e){var f=[];for(var h in c)f.push(h+":"+c[h]);f=f.concat(d),a(this).val(f)}g.join(",")!=b.join(",")&&this.form.submit()})},g=function(){return a(e.UNIFIED_FILTERS).closest("form")};return{init:function(){f()},getForm:function(){return g()}}});
define('core_user/participants', ["jquery","core/str","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],function(a,b,c,d,e,f,g){var h={BULKACTIONSELECT:"#formactionid",BULKUSERCHECKBOXES:"input.usercheckbox",BULKUSERNOSCHECKBOXES:"input.usercheckbox[value='0']",BULKUSERSELECTEDCHECKBOXES:"input.usercheckbox:checked",BULKACTIONFORM:"#participantsform",CHECKALLBUTTON:"#checkall",CHECKALLNOSBUTTON:"#checkallnos",CHECKALLONPAGEBUTTON:"#checkallonpage",CHECKNONEBUTTON:"#checknone"},i=function(a){this.courseId=a.courseid,this.noteStateNames=a.noteStateNames,this.stateHelpIcon=a.stateHelpIcon,this.attachEventListeners()};return i.prototype.modal=null,i.prototype.courseId=-1,i.prototype.noteStateNames={},i.prototype.stateHelpIcon="",i.prototype.attachEventListeners=function(){a(h.BULKACTIONSELECT).on("change",function(b){var c=a(b.target).val();if(c.indexOf("#")!==-1){b.preventDefault();var d=[];a(h.BULKUSERSELECTEDCHECKBOXES).each(function(b,c){var e=a(c).attr("name"),f=e.replace("user","");d.push(f)}),"#messageselect"==c?this.showSendMessage(d).fail(f.exception):"#addgroupnote"==c&&this.showAddNote(d).fail(f.exception),a(h.BULKACTIONSELECT+' option[value=""]').prop("selected","selected")}else""!==c&&(a(h.BULKUSERSELECTEDCHECKBOXES).length>0?a(h.BULKACTIONFORM).submit():a(h.BULKACTIONSELECT+' option[value=""]').prop("selected","selected"))}.bind(this)),a(h.CHECKALLBUTTON).on("click",function(){var b=a(this).data("showallink");b&&(window.location=b)}),a(h.CHECKALLNOSBUTTON).on("click",function(){a(h.BULKUSERNOSCHECKBOXES).prop("checked",!0)}),a(h.CHECKALLONPAGEBUTTON).on("click",function(){a(h.BULKUSERCHECKBOXES).prop("checked",!0)}),a(h.CHECKNONEBUTTON).on("click",function(){a(h.BULKUSERCHECKBOXES).prop("checked",!1)})},i.prototype.showAddNote=function(f){if(0==f.length)return a.Deferred().resolve().promise();var g=[];for(var i in this.noteStateNames)switch(i){case"draft":g.push({value:"personal",label:this.noteStateNames[i]});break;case"public":g.push({value:"course",label:this.noteStateNames[i],selected:1});break;case"site":g.push({value:i,label:this.noteStateNames[i]})}var j={stateNames:g,stateHelpIcon:this.stateHelpIcon},k=null;return k=1==f.length?b.get_string("addbulknotesingle","core_notes"):b.get_string("addbulknote","core_notes",f.length),a.when(c.create({type:c.types.SAVE_CANCEL,body:e.render("core_user/add_bulk_note",j)}),k).then(function(b,c){return this.modal=b,this.modal.setTitle(c),this.modal.setSaveButtonText(c),this.modal.getRoot().on(d.hidden,function(){var b=a("#user-notifications [role=alert]");b.length?b.focus():a(h.BULKACTIONSELECT).focus(),this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(d.save,this.submitAddNote.bind(this,f)),this.modal.show(),this.modal}.bind(this))},i.prototype.submitAddNote=function(a){var c=this.modal.getRoot().find("form textarea").val(),d=this.modal.getRoot().find("form select").val(),e=[],h=0;for(h=0;h<a.length;h++)e.push({userid:a[h],text:c,courseid:this.courseId,publishstate:d});return g.call([{methodname:"core_notes_create_notes",args:{notes:e}}])[0].then(function(a){return 1==a.length?b.get_string("addbulknotedonesingle","core_notes"):b.get_string("addbulknotedone","core_notes",a.length)}).then(function(a){return f.addNotification({message:a,type:"success"}),!0})["catch"](f.exception)},i.prototype.showSendMessage=function(f){if(0==f.length)return a.Deferred().resolve().promise();var g=null;return g=1==f.length?b.get_string("sendbulkmessagesingle","core_message"):b.get_string("sendbulkmessage","core_message",f.length),a.when(c.create({type:c.types.SAVE_CANCEL,body:e.render("core_user/send_bulk_message",{})}),g).then(function(b,c){return this.modal=b,this.modal.setTitle(c),this.modal.setSaveButtonText(c),this.modal.getRoot().on(d.hidden,function(){a(h.BULKACTIONSELECT).focus(),this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(d.save,this.submitSendMessage.bind(this,f)),this.modal.show(),this.modal}.bind(this))},i.prototype.submitSendMessage=function(a){var c=this.modal.getRoot().find("form textarea").val(),d=[],e=0;for(e=0;e<a.length;e++)d.push({touserid:a[e],text:c});return g.call([{methodname:"core_message_send_instant_messages",args:{messages:d}}])[0].then(function(a){return 1==a.length?b.get_string("sendbulkmessagesentsingle","core_message"):b.get_string("sendbulkmessagesent","core_message",a.length)}).then(function(a){return f.addNotification({message:a,type:"success"}),!0})["catch"](f.exception)},{init:function(a){return new i(a)}}});
define('qtype_ddimageortext/form', ["jquery","core/dragdrop"],function(a,b){"use strict";var c={maxBgImageSize:null,maxDragImageSize:null,fp:null,init:function(b,d){c.maxBgImageSize=b,c.maxDragImageSize=d,c.fp=c.filePickers(),a("#id_previewareaheader").append('<div class="ddarea">  <div class="droparea">    <img class="dropbackground" />    <div class="dropzones"></div>  </div>  <div class="dragitems"></div></div>'),c.updateVisibilityOfFilePickers(),c.setOptionsForDragItemSelectors(),c.setupEventHandlers(),c.waitForFilePickerToInitialise()},waitForFilePickerToInitialise:function(){return null===c.fp.file("bgimage").href?void setTimeout(c.waitForFilePickerToInitialise,1e3):(M.util.js_pending("dragDropToImageForm"),a("form.mform").on("change",".filepickerhidden",function(){M.util.js_pending("dragDropToImageForm"),c.loadPreviewImage()}),void c.loadPreviewImage())},loadPreviewImage:function(){a("fieldset#id_previewareaheader .dropbackground").one("load",c.afterPreviewImageLoaded).attr("src",c.fp.file("bgimage").href)},afterPreviewImageLoaded:function(){var b=a("fieldset#id_previewareaheader .dropbackground");c.constrainImageSize(b,c.maxBgImageSize),c.createDropZones(),M.util.js_complete("dragDropToImageForm")},constrainImageSize:function(a,b){var c=Math.max(a.width()/b.width,a.height()/b.height);c>1&&a.css("width",Math.floor(a.width()/c)),a.addClass("constrained")},createDropZones:function(){var b=a(".dropzones");b.empty();var d=c.fp.file("bgimage").href;if(null!==d){for(var e=c.form.getFormValue("nodropzone",[]),f=0;f<e;f++){var g=c.form.getFormValue("drops",[f,"choice"]);if("0"!==g){g-=1;var h=c.form.getFormValue("drags",[g,"draggroup"]),i=c.form.getFormValue("draglabel",[g]);if("image"===c.form.getFormValue("drags",[g,"dragitemtype"])){var j=c.fp.file("dragitem["+g+"]").href;if(null===j)continue;b.append('<img class="droppreview group'+h+" drop"+f+'" src="'+j+'" alt="'+i+'" data-drop-no="'+f+'">')}else""!==i&&b.append('<div class="droppreview group'+h+" drop"+f+'"  data-drop-no="'+f+'">'+i+"</div>")}}c.waitForAllDropImagesToBeLoaded()}},waitForAllDropImagesToBeLoaded:function(){var b=a(".dropzones img").not(function(a,b){return c.imageIsLoaded(b)});return b.length>0?void setTimeout(function(){c.waitForAllDropImagesToBeLoaded()},100):void c.updateDropZones()},imageIsLoaded:function(a){return a.complete&&0!==a.naturalHeight},updateDropZones:function(){var b=c.fp.file("bgimage").href;if(null!==b){for(var d=a("fieldset#id_previewareaheader .dropbackground").offset(),e=c.form.getFormValue("nodropzone",[]),f=0;f<e;f++){var g=a(".dropzones .drop"+f);if(0!==g.length){var h=c.form.getFormValue("drops",[f,"choice"])-1;g.offset({left:d.left+parseInt(c.form.getFormValue("drops",[f,"xleft"])),top:d.top+parseInt(c.form.getFormValue("drops",[f,"ytop"]))});var i=c.form.getFormValue("draglabel",[h]);g.is("img")?g.attr("alt",i):g.html(i)}}a(".dropzones .droppreview").css("padding","0");for(var j=a("select.draggroup").first().find("option").length,k=1;k<=j;k++)c.resizeAllDragsAndDropsInGroup(k)}},resizeAllDragsAndDropsInGroup:function(b){var c=a(".dropzones .droppreview.group"+b),d=0,e=0;c.each(function(a,b){d=Math.max(d,Math.ceil(b.offsetWidth)),e=Math.max(e,Math.ceil(b.offsetHeight))}),d+=10,e+=10,c.each(function(b,c){var f=Math.round((d-c.offsetWidth)/2),g=Math.floor((e-c.offsetHeight)/2);a(c).css({"padding-left":f+"px","padding-right":d-c.offsetWidth-f+"px","padding-top":g+"px","padding-bottom":e-c.offsetHeight-g+"px"})})},setupEventHandlers:function(){a("fieldset#id_draggableitemheader").on("change input","input, select",function(b){var d=a(b.target).closest("select, input");d.hasClass("dragitemtype")&&c.updateVisibilityOfFilePickers(),c.setOptionsForDragItemSelectors(),d.is(".dragitemtype, .draggroup")?c.createDropZones():d.is(".draglabel")&&c.updateDropZones()}),a("fieldset#id_dropzoneheader").on("change input","input, select",function(b){var d=a(b.target).closest("select, input");d.is("select")?c.createDropZones():c.updateDropZones()}),a("fieldset#id_previewareaheader").on("mousedown touchstart",".droppreview",function(a){c.dragStart(a)}),a(window).on("resize",function(){c.updateDropZones()})},updateVisibilityOfFilePickers:function(){for(var b=c.form.getFormValue("noitems",[]),d=0;d<b;d++){var e=a("input#id_dragitem_"+d).closest(".fitem_ffilepicker");"image"===c.form.getFormValue("drags",[d,"dragitemtype"])?e.show():e.hide()}},setOptionsForDragItemSelectors:function(){for(var b={0:""},d=c.form.getFormValue("noitems",[]),e=c.form.getFormValue("nodropzone",[]),f=0;f<d;f++){var g=c.form.getFormValue("draglabel",[f]),h=c.fp.file(c.form.toNameWithIndex("dragitem",[f]));"image"===c.form.getFormValue("drags",[f,"dragitemtype"])&&null!==h.name?b[f+1]=f+1+". "+g+" ("+h.name+")":""!==g&&(b[f+1]=f+1+". "+g)}for(var i=0;i<e;i++){var j=a("#id_drops_"+i+"_choice"),k=j.val();j.find("option").remove();for(var l in b)if(b.hasOwnProperty(l)){j.append('<option value="'+l+'">'+b[l]+"</option>");var m=j.find('option[value="'+l+'"]');parseInt(l)===parseInt(k)?m.attr("selected",!0):c.isItemUsed(parseInt(l))&&m.attr("disabled",!0)}}},isItemUsed:function(b){return 0!==b&&(!c.form.getFormValue("drags",[b-1,"infinite"])&&0!==a("fieldset#id_dropzoneheader select").filter(function(c,d){return parseInt(a(d).val())===b}).length)},dragStart:function(d){var e=a(d.target).closest(".droppreview"),f=b.prepare(d);f.start&&b.start(d,e,function(a,b,d){c.dragMove(d)},function(){c.dragEnd()})},dragMove:function(b){var d=a("fieldset#id_previewareaheader .dropbackground"),e=d.offset(),f=b.data("dropNo"),g=b.offset(),h=Math.round(g.left-e.left),i=Math.round(g.top-e.top);h=Math.max(0,Math.min(h,d.width()-b.width()-10)),i=Math.max(0,Math.min(i,d.height()-b.height()-10)),c.form.setFormValue("drops",[f,"xleft"],h),c.form.setFormValue("drops",[f,"ytop"],i)},dragEnd:function(){c.updateDropZones()},form:{toNameWithIndex:function(a,b){for(var c=a,d=0;d<b.length;d++)c=c+"["+b[d]+"]";return c},getEl:function(a,b){var c=document.getElementById("mform1");return c.elements[this.toNameWithIndex(a,b)]},getFormValue:function(a,b){var c=this.getEl(a,b);return c.type||(c=c[c.length-1]),"checkbox"===c.type?c.checked:c.value},setFormValue:function(a,b,c){var d=this.getEl(a,b);"checkbox"===d.type?d.checked=c:d.value=c}},filePickers:function(){var b,c;if(void 0===b){b={},c={};var d=a("form.mform input.filepickerhidden");d.each(function(a,d){b[d.value]=d.name,c[d.name]=d.parentNode})}return{file:function(b){var d=a(c[b]),e=d.find("div.filepicker-filelist a");return e.length?{href:e.get(0).href,name:e.get(0).innerHTML}:{href:null,name:null}},name:function(a){return b[a]}}}};return{init:c.init}});
define('qtype_ddimageortext/question', ["jquery","core/dragdrop","core/key_codes"],function(a,b,c){"use strict";function d(a,b,c){this.containerId=a,M.util.js_pending("qtype_ddimageortext-init-"+this.containerId),this.places=c,this.allImagesLoaded=!1,this.imageLoadingTimeoutId=null,b&&this.getRoot().addClass("qtype_ddimageortext-readonly");var d=this;this.getNotYetLoadedImages().one("load",function(){d.waitForAllImagesToBeLoaded()}),this.waitForAllImagesToBeLoaded()}d.prototype.waitForAllImagesToBeLoaded=function(){var a=this;if(!this.allImagesLoaded){if(null!==this.imageLoadingTimeoutId&&clearTimeout(this.imageLoadingTimeoutId),this.getNotYetLoadedImages().length>0)return void(this.imageLoadingTimeoutId=setTimeout(function(){a.waitForAllImagesToBeLoaded()},100));this.allImagesLoaded=!0,a.setupQuestion()}},d.prototype.getNotYetLoadedImages=function(){var a=this;return this.getRoot().find(".ddarea img").not(function(b,c){return a.imageIsLoaded(c)})},d.prototype.imageIsLoaded=function(a){return a.complete&&0!==a.naturalHeight},d.prototype.setupQuestion=function(){this.resizeAllDragsAndDrops(),this.cloneDrags(),this.positionDragsAndDrops(),M.util.js_complete("qtype_ddimageortext-init-"+this.containerId)},d.prototype.resizeAllDragsAndDrops=function(){var b=this;this.getRoot().find(".draghomes > div").each(function(c,d){b.resizeAllDragsAndDropsInGroup(b.getClassnameNumericSuffix(a(d),"dragitemgroup"))})},d.prototype.resizeAllDragsAndDropsInGroup=function(b){var c=this.getRoot(),d=c.find(".dragitemgroup"+b+" .draghome"),e=0,f=0;d.each(function(a,b){e=Math.max(e,Math.ceil(b.offsetWidth)),f=Math.max(f,Math.ceil(b.offsetHeight))}),e+=10,f+=10,d.each(function(b,c){var d=Math.round((e-c.offsetWidth)/2),g=Math.floor((f-c.offsetHeight)/2);a(c).css({"padding-left":d+"px","padding-right":e-c.offsetWidth-d+"px","padding-top":g+"px","padding-bottom":f-c.offsetHeight-g+"px"})});for(var g in this.places)if(this.places.hasOwnProperty(g)){var h=this.places[g],i=h.text;parseInt(h.group)===b&&(""===i&&(i=M.util.get_string("blank","qtype_ddimageortext")),c.find(".dropzones").append('<div class="dropzone group'+h.group+" place"+g+'" tabindex="0"><span class="accesshide">'+i+"</span>&nbsp;</div>"),c.find(".dropzone.place"+g).width(e-2).height(f-2))}},d.prototype.cloneDrags=function(){var b=this;this.getRoot().find(".ddarea .draghome").each(function(c,d){b.cloneDragsForOneChoice(a(d))})},d.prototype.cloneDragsForOneChoice=function(a){if(a.hasClass("infinite"))for(var b=this.noOfDropsInGroup(this.getGroup(a)),c=0;c<b;c++)this.cloneDrag(a);else this.cloneDrag(a)},d.prototype.cloneDrag=function(a){var b=a.clone();b.removeClass("draghome").addClass("drag unplaced moodle-has-zindex").offset(a.offset()),this.getRoot().find(".dragitems").append(b)},d.prototype.positionDragsAndDrops=function(){var b=this,c=this.getRoot(),d=this.bgImage().offset();c.find(".ddarea .dropzone").each(function(c,e){var f=a(e),g=b.places[b.getPlace(f)];f.offset({left:d.left+parseInt(g.xy[0]),top:d.top+parseInt(g.xy[1])})}),c.find(".ddarea .drag").each(function(c,d){var e=a(d),f=b.getClassnameNumericSuffix(e,"inplace");e.addClass("unplaced").removeClass("placed").offset(b.getDragHome(b.getGroup(e),b.getChoice(e)).offset()),null!==f&&e.removeClass("inplace"+f)}),c.find("input.placeinput").each(function(d,e){var f=a(e),g=f.val();if("0"!==g){var h=b.getPlace(f);b.getUnplacedChoice(b.getGroup(f),g).removeClass("unplaced").addClass("placed inplace"+h).offset(c.find(".dropzone.place"+h).offset())}}),this.bgImage().data("prev-top",d.top).data("prev-left",d.left)},d.prototype.fixLayoutIfBackgroundMoved=function(){var a=this.bgImage(),b=a.offset(),c=a.data("prev-top"),d=a.data("prev-left");void 0!==d&&void 0!==c&&(c===b.top&&d===b.left||this.positionDragsAndDrops())},d.prototype.handleDragStart=function(c){var d=this,e=a(c.target).closest(".drag"),f=b.prepare(c);if(f.start){var g=this.getClassnameNumericSuffix(e,"inplace");null!==g&&(this.setInputValue(g,0),e.removeClass("inplace"+g)),e.addClass("beingdragged"),b.start(c,e,function(a,b,c){d.dragMove(a,b,c)},function(a,b,c){d.dragEnd(a,b,c)})}},d.prototype.dragMove=function(b,c,d){var e=this;this.getRoot().find(".dropzone.group"+this.getGroup(d)).each(function(d,f){var g=a(f);e.isPointInDrop(b,c,g)?g.addClass("valid-drag-over-drop"):g.removeClass("valid-drag-over-drop")})},d.prototype.dragEnd=function(b,c,d){var e=this,f=this.getRoot(),g=!1;f.find(".dropzone.group"+this.getGroup(d)).each(function(f,h){var i=a(h);return!e.isPointInDrop(b,c,i)||(i.removeClass("valid-drag-over-drop"),e.sendDragToDrop(d,i),g=!0,!1)}),g||this.sendDragHome(d)},d.prototype.sendDragToDrop=function(a,b){var c=this.getCurrentDragInPlace(this.getPlace(b));0!==c.length&&this.sendDragHome(c),0===a.length?this.setInputValue(this.getPlace(b),0):(this.setInputValue(this.getPlace(b),this.getChoice(a)),a.removeClass("unplaced").addClass("placed inplace"+this.getPlace(b)),this.animateTo(a,b))},d.prototype.sendDragHome=function(a){a.removeClass("placed").addClass("unplaced");var b=this.getClassnameNumericSuffix(a,"inplace");null!==b&&a.removeClass("inplace"+b),this.animateTo(a,this.getDragHome(this.getGroup(a),this.getChoice(a)))},d.prototype.handleKeyPress=function(b){var d=a(b.target).closest(".dropzone"),e=this.getCurrentDragInPlace(this.getPlace(d)),f=a();switch(b.keyCode){case c.space:case c.arrowRight:case c.arrowDown:f=this.getNextDrag(this.getGroup(d),e);break;case c.arrowLeft:case c.arrowUp:f=this.getPreviousDrag(this.getGroup(d),e);break;case c.escape:break;default:return}b.preventDefault(),this.sendDragToDrop(f,d)},d.prototype.getNextDrag=function(a,b){var c,d=this.noOfChoicesInGroup(a);c=0===b.length?1:this.getChoice(b)+1;for(var e=this.getUnplacedChoice(a,c);0===e.length&&c<d;)c++,e=this.getUnplacedChoice(a,c);return e},d.prototype.getPreviousDrag=function(a,b){var c;c=0===b.length?this.noOfChoicesInGroup(a):this.getChoice(b)-1;for(var d=this.getUnplacedChoice(a,c);0===d.length&&c>1;)c--,d=this.getUnplacedChoice(a,c);return d},d.prototype.animateTo=function(a,b){var c=a.offset(),d=b.offset();a.addClass("beingdragged"),a.animate({left:parseInt(a.css("left"))+d.left-c.left,top:parseInt(a.css("top"))+d.top-c.top},{duration:"fast",done:function(){a.removeClass("beingdragged"),a.offset(d)}})},d.prototype.isPointInDrop=function(a,b,c){var d=c.offset();return a>=d.left&&a<d.left+c.width()&&b>=d.top&&b<d.top+c.height()},d.prototype.setInputValue=function(a,b){this.getRoot().find("input.placeinput.place"+a).val(b)},d.prototype.getRoot=function(){return a(document.getElementById(this.containerId))},d.prototype.bgImage=function(){return this.getRoot().find("img.dropbackground")},d.prototype.getDragHome=function(a,b){return this.getRoot().find(".ddarea .draghome.group"+a+".choice"+b)},d.prototype.getUnplacedChoice=function(a,b){return this.getRoot().find(".ddarea .drag.group"+a+".choice"+b+".unplaced").slice(0,1)},d.prototype.getCurrentDragInPlace=function(a){return this.getRoot().find(".ddarea .drag.inplace"+a)},d.prototype.noOfDropsInGroup=function(a){return this.getRoot().find(".dropzone.group"+a).length},d.prototype.noOfChoicesInGroup=function(a){return this.getRoot().find(".dragitemgroup"+a+" .draghome").length},d.prototype.getClassnameNumericSuffix=function(a,b){var c=a.attr("class");if(""!==c)for(var d=c.split(" "),e=0;e<d.length;e++){var f=new RegExp("^"+b+"([0-9])+$");if(f.test(d[e])){var g=new RegExp("([0-9])+$"),h=g.exec(d[e]);return Number(h[0])}}return null},d.prototype.getChoice=function(a){return this.getClassnameNumericSuffix(a,"choice")},d.prototype.getGroup=function(a){return this.getClassnameNumericSuffix(a,"group")},d.prototype.getPlace=function(a){return this.getClassnameNumericSuffix(a,"place")};var e={eventHandlersInitialised:!1,questions:{},init:function(a,b,c){e.questions[a]=new d(a,b,c),e.eventHandlersInitialised||(e.setupEventHandlers(),e.eventHandlersInitialised=!0)},setupEventHandlers:function(){a("body").on("mousedown touchstart",".que.ddimageortext:not(.qtype_ddimageortext-readonly) .dragitems .drag",e.handleDragStart).on("keydown",".que.ddimageortext:not(.qtype_ddimageortext-readonly) .dropzones .dropzone",e.handleKeyPress),a(window).on("resize",e.handleWindowResize),setTimeout(e.fixLayoutIfThingsMoved,100)},handleDragStart:function(a){a.preventDefault();var b=e.getQuestionForEvent(a);b&&b.handleDragStart(a)},handleKeyPress:function(a){var b=e.getQuestionForEvent(a);b&&b.handleKeyPress(a)},handleWindowResize:function(){for(var a in e.questions)e.questions.hasOwnProperty(a)&&e.questions[a].positionDragsAndDrops()},fixLayoutIfThingsMoved:function(){for(var a in e.questions)e.questions.hasOwnProperty(a)&&e.questions[a].fixLayoutIfBackgroundMoved();setTimeout(e.fixLayoutIfThingsMoved,100)},getQuestionForEvent:function(b){var c=a(b.currentTarget).closest(".que.ddimageortext").attr("id");return e.questions[c]}};return{init:e.init}});
define('qtype_ddmarker/shapes', function(){"use strict";function a(a,b){this.x=a,this.y=b}function b(b,c,d){this.label=b,this.centre=new a(c||0,d||0)}function c(a,c,d,e){c=c||15,d=d||15,b.call(this,a,c,d),this.radius=e||15}function d(a,c,d,e,f){b.call(this,a,c,d),this.width=e||30,this.height=f||30}function e(c,d){b.call(this,c,0,0),this.points=d?d.slice():[new a(10,10),new a(40,10),new a(10,40)],this.normalizeShape()}function f(a){b.call(this,a)}function g(a,b){var c=a.ownerDocument.createElementNS("http://www.w3.org/2000/svg",b);return a.appendChild(c),c}function h(a,b){var c=g(a,"g");return g(c,b).setAttribute("class","shape"),g(c,"text").setAttribute("class","shapeLabel"),c}return a.prototype.toString=function(){return this.x+","+this.y},a.prototype.move=function(a,b){this.x+=a,this.y+=b},a.prototype.offset=function(b,c){return b instanceof a&&(c=b.y,b=b.x),new a(this.x+b,this.y+c)},a.parse=function(b){var c=b.split(",");if(2!==c.length)throw new Error(b+" is not a valid point");return new a(Math.round(c[0]),Math.round(c[1]))},b.prototype.getType=function(){throw new Error("Not implemented.")},b.prototype.getCoordinates=function(){throw new Error("Not implemented.")},b.prototype.parse=function(a){throw new Error("Not implemented.")},b.prototype.move=function(a,b,c,d){},b.prototype.edit=function(a,b,c,d,e){},b.prototype.normalizeShape=function(){},b.prototype.makeSvg=function(a){throw new Error("Not implemented.")},b.prototype.updateSvg=function(a){},b.prototype.makeSimilarCircle=function(){throw new Error("Not implemented.")},b.prototype.makeSimilarRectangle=function(){throw new Error("Not implemented.")},b.prototype.makeSimilarPolygon=function(){throw new Error("Not implemented.")},b.prototype.getHandlePositions=function(){return null},c.prototype=new b,c.prototype.getType=function(){return"circle"},c.prototype.getCoordinates=function(){return this.centre+";"+Math.abs(this.radius)},c.prototype.makeSvg=function(a){var b=h(a,"circle");return this.updateSvg(b),b},c.prototype.updateSvg=function(a){a.childNodes[0].setAttribute("cx",this.centre.x),a.childNodes[0].setAttribute("cy",this.centre.y),a.childNodes[0].setAttribute("r",Math.abs(this.radius)),a.childNodes[1].setAttribute("x",this.centre.x),a.childNodes[1].setAttribute("y",this.centre.y+15),a.childNodes[1].textContent=this.label},c.prototype.parse=function(b){if(!b.match(/^\d+,\d+;\d+$/))return!1;var c=b.split(";");return this.centre=a.parse(c[0]),this.radius=Math.round(c[1]),!0},c.prototype.move=function(a,b,c,d){this.centre.move(a,b),this.centre.x<this.radius&&(this.centre.x=this.radius),this.centre.x>c-this.radius&&(this.centre.x=c-this.radius),this.centre.y<this.radius&&(this.centre.y=this.radius),this.centre.y>d-this.radius&&(this.centre.y=d-this.radius)},c.prototype.edit=function(a,b,c,d,e){this.radius+=b;var f=Math.min(this.centre.x,this.centre.y,d-this.centre.x,e-this.centre.y);this.radius>f&&(this.radius=f),this.radius<-f&&(this.radius=-f)},c.prototype.normalizeShape=function(){this.radius=Math.abs(this.radius)},c.prototype.makeSimilarRectangle=function(){return new d(this.label,this.centre.x-this.radius,this.centre.y-this.radius,2*this.radius,2*this.radius)},c.prototype.makeSimilarPolygon=function(){return new e(this.label,[this.centre.offset(-this.radius,-this.radius),this.centre.offset(-this.radius,this.radius),this.centre.offset(this.radius,this.radius),this.centre.offset(this.radius,-this.radius)])},c.prototype.getHandlePositions=function(){return{moveHandle:this.centre,editHandles:[this.centre.offset(this.radius,0)]}},d.prototype=new b,d.prototype.getType=function(){return"rectangle"},d.prototype.getCoordinates=function(){return this.centre+";"+this.width+","+this.height},d.prototype.makeSvg=function(a){var b=h(a,"rect");return this.updateSvg(b),b},d.prototype.updateSvg=function(a){this.width>=0?(a.childNodes[0].setAttribute("x",this.centre.x),a.childNodes[0].setAttribute("width",this.width)):(a.childNodes[0].setAttribute("x",this.centre.x+this.width),a.childNodes[0].setAttribute("width",-this.width)),this.height>=0?(a.childNodes[0].setAttribute("y",this.centre.y),a.childNodes[0].setAttribute("height",this.height)):(a.childNodes[0].setAttribute("y",this.centre.y+this.height),a.childNodes[0].setAttribute("height",-this.height)),a.childNodes[1].setAttribute("x",this.centre.x+this.width/2),a.childNodes[1].setAttribute("y",this.centre.y+this.height/2+15),a.childNodes[1].textContent=this.label},d.prototype.parse=function(b){if(!b.match(/^\d+,\d+;\d+,\d+$/))return!1;var c=b.split(";");this.centre=a.parse(c[0]);var d=a.parse(c[1]);return this.width=d.x,this.height=d.y,!0},d.prototype.move=function(a,b,c,d){this.centre.move(a,b),this.centre.x<0&&(this.centre.x=0),this.centre.x>c-this.width&&(this.centre.x=c-this.width),this.centre.y<0&&(this.centre.y=0),this.centre.y>d-this.height&&(this.centre.y=d-this.height)},d.prototype.edit=function(a,b,c,d,e){this.width+=b,this.height+=c,this.width<-this.centre.x&&(this.width=-this.centre.x),this.width>d-this.centre.x&&(this.width=d-this.centre.x),this.height<-this.centre.y&&(this.height=-this.centre.y),this.height>e-this.centre.y&&(this.height=e-this.centre.y)},d.prototype.normalizeShape=function(){this.width<0&&(this.centre.x+=this.width,this.width=-this.width),this.height<0&&(this.centre.y+=this.height,this.height=-this.height)},d.prototype.makeSimilarCircle=function(){return new c(this.label,Math.round(this.centre.x+this.width/2),Math.round(this.centre.y+this.height/2),Math.round((this.width+this.height)/4))},d.prototype.makeSimilarPolygon=function(){return new e(this.label,[this.centre,this.centre.offset(0,this.height),this.centre.offset(this.width,this.height),this.centre.offset(this.width,0)])},d.prototype.getHandlePositions=function(){return{moveHandle:this.centre.offset(this.width/2,this.height/2),editHandles:[this.centre.offset(this.width,this.height)]}},e.prototype=new b,e.prototype.getType=function(){return"polygon"},e.prototype.getCoordinates=function(){for(var a="",b=0;b<this.points.length;b++)a+=this.centre.offset(this.points[b])+";";return a.slice(0,a.length-1)},e.prototype.makeSvg=function(a){var b=h(a,"polygon");return this.updateSvg(b),b},e.prototype.updateSvg=function(a){a.childNodes[0].setAttribute("points",this.getCoordinates().replace(/[,;]/g," ")),a.childNodes[1].setAttribute("x",this.centre.x),a.childNodes[1].setAttribute("y",this.centre.y+15),a.childNodes[1].textContent=this.label},e.prototype.parse=function(b){if(!b.match(/^\d+,\d+(?:;\d+,\d+)*$/))return!1;for(var c=b.split(";"),d=[],e=0;e<c.length;e++)d.push(a.parse(c[e]));return this.points=d,this.centre.x=0,this.centre.y=0,this.normalizeShape(),!0},e.prototype.move=function(a,b,c,d){this.centre.move(a,b);for(var e=c,f=0,g=d,h=0,i=0;i<this.points.length;i++)e=Math.min(e,this.points[i].x),f=Math.max(f,this.points[i].x),g=Math.min(g,this.points[i].y),h=Math.max(h,this.points[i].y);this.centre.x<-e&&(this.centre.x=-e),this.centre.x>c-f&&(this.centre.x=c-f),this.centre.y<-g&&(this.centre.y=-g),this.centre.y>d-h&&(this.centre.y=d-h)},e.prototype.edit=function(a,b,c,d,e){this.points[a].move(b,c),this.points[a].x<-this.centre.x&&(this.points[a].x=-this.centre.x),this.points[a].x>d-this.centre.x&&(this.points[a].x=d-this.centre.x),this.points[a].y<-this.centre.y&&(this.points[a].y=-this.centre.y),this.points[a].y>e-this.centre.y&&(this.points[a].y=e-this.centre.y)},e.prototype.addNewPointAfter=function(b){this.points.splice(b,0,new a(this.points[b].x,this.points[b].y))},e.prototype.normalizeShape=function(){var a,b=0,c=0;if(0!==this.points.length){for(a=0;a<this.points.length;a++)b+=this.points[a].x,c+=this.points[a].y;if(b=Math.round(b/this.points.length),c=Math.round(c/this.points.length),0!==b||0!==c){for(a=0;a<this.points.length;a++)this.points[a].move(-b,-c);this.centre.move(b,c)}}},e.prototype.makeSimilarCircle=function(){return this.makeSimilarRectangle().makeSimilarCircle()},e.prototype.makeSimilarRectangle=function(){for(var a,b=0,c=0,e=0,f=0,g=0;g<this.points.length;g++)a=this.points[g],b=Math.min(b,a.x),c=Math.max(c,a.x),e=Math.min(e,a.y),f=Math.max(f,a.y);return new d(this.label,this.centre.x+b,this.centre.y+e,Math.max(c-b,10),Math.max(f-e,10))},e.prototype.getHandlePositions=function(){for(var a=[],b=0;b<this.points.length;b++)a.push(this.points[b].offset(this.centre.x,this.centre.y));return{moveHandle:this.centre,editHandles:a}},f.prototype=new b,f.prototype.getType=function(){return"null"},f.prototype.getCoordinates=function(){return""},f.prototype.makeSvg=function(a){return null},f.prototype.updateSvg=function(a){},f.prototype.parse=function(a){return!1},f.prototype.makeSimilarCircle=function(){return new c(this.label)},f.prototype.makeSimilarRectangle=function(){return new d(this.label)},f.prototype.makeSimilarPolygon=function(){return new e(this.label)},{Point:a,Shape:b,Circle:c,Rectangle:d,Polygon:e,NullShape:f,createSvgElement:g,make:function(a,b){switch(a){case"circle":return new c(b);case"rectangle":return new d(b);case"polygon":return new e(b);default:return new f(b)}},getSimilar:function(a,b){if(a===b.getType())return b;switch(a){case"circle":return b.makeSimilarCircle();case"rectangle":return b.makeSimilarRectangle();case"polygon":return b.makeSimilarPolygon();default:return new f(b.label)}}}});
define('qtype_ddmarker/form', ["jquery","core/dragdrop","qtype_ddmarker/shapes"],function(a,b,c){"use strict";function d(a){this.dropzoneNo=a,this.svgEl=null,this.shape=c.make(this.getShapeType(),this.getLabel()),this.updateCoordinatesFromForm()}d.prototype.updateCoordinatesFromForm=function(a){var b=this.getCoordinates(),c="polygon"===this.shape.getType()&&this.shape.points.length;if(this.shape.getCoordinates()!==b&&this.shape.parse(b))if("polygon"===this.shape.getType()&&c!==this.shape.points.length){var d=this.isActive();this.removeFromSvg(),a&&(this.addToSvg(a),d&&this.setActive())}else this.updateSvgEl()},d.prototype.updateLabel=function(){var a=this.getLabel();this.shape.label!==a&&(this.shape.label=a,this.updateSvgEl())},d.prototype.changeShape=function(a){var b=this.getShapeType(),d=this.isActive();b!==this.shape.getType()&&(this.removeFromSvg(),this.shape=c.getSimilar(b,this.shape),a&&(this.addToSvg(a),d&&this.setActive()),this.setCoordinatesInForm())},d.prototype.addToSvg=function(a){if(null!==this.svgEl)throw new Error("this.svgEl already set");if(this.svgEl=this.shape.makeSvg(a),this.svgEl){this.svgEl.setAttribute("class","dropzone"),this.svgEl.setAttribute("data-dropzone-no",this.dropzoneNo);var b=this.shape.getHandlePositions();if(null!==b){var d=c.createSvgElement(this.svgEl,"circle");d.setAttribute("cx",b.moveHandle.x),d.setAttribute("cy",b.moveHandle.y),d.setAttribute("r",7),d.setAttribute("class","handle move");for(var e=0;e<b.editHandles.length;++e)this.makeEditHandle(e,b.editHandles[e])}}},d.prototype.makeEditHandle=function(a,b){var d=c.createSvgElement(this.svgEl,"rect");d.setAttribute("x",b.x-6),d.setAttribute("y",b.y-6),d.setAttribute("width",11),d.setAttribute("height",11),d.setAttribute("class","handle edit"),d.setAttribute("data-edit-handle-no",a)},d.prototype.removeFromSvg=function(){null!==this.svgEl&&(this.svgEl.parentNode.removeChild(this.svgEl),this.svgEl=null)},d.prototype.updateSvgEl=function(){if(null!==this.svgEl){this.shape.updateSvg(this.svgEl);var a=this.shape.getHandlePositions();if(null!==a){this.svgEl.childNodes[2].setAttribute("cx",a.moveHandle.x),this.svgEl.childNodes[2].setAttribute("cy",a.moveHandle.y);for(var b=0;b<a.editHandles.length;++b)this.svgEl.childNodes[3+b].setAttribute("x",a.editHandles[b].x-6),this.svgEl.childNodes[3+b].setAttribute("y",a.editHandles[b].y-6)}}},d.prototype.isActive=function(){return null!==this.svgEl&&this.svgEl.getAttribute("class").match(/\bactive\b/)},d.prototype.setActive=function(){var a=this.svgEl.parentNode;a.removeChild(this.svgEl),a.appendChild(this.svgEl),this.svgEl.setAttribute("class",this.svgEl.getAttribute("class")+" active")},d.prototype.setCoordinatesInForm=function(){e.form.setFormValue("drops",[this.dropzoneNo,"coords"],this.shape.getCoordinates())},d.prototype.getCoordinates=function(){return e.form.getFormValue("drops",[this.dropzoneNo,"coords"]).replace(/\s*/g,"")},d.prototype.getChoiceNo=function(){return e.form.getFormValue("drops",[this.dropzoneNo,"choice"])},d.prototype.getLabel=function(){return e.form.getMarkerText(this.getChoiceNo())},d.prototype.getShapeType=function(){return e.form.getFormValue("drops",[this.dropzoneNo,"shape"])},d.prototype.handleMove=function(c){var d=b.prepare(c);if(d.start){var e=this,f=d.x,g=d.y,h=this.makeDragProxy(d.x,d.y),i=a("fieldset#id_previewareaheader .dropbackground"),j=i.width(),k=i.height();b.start(c,a(h),function(a,b){e.shape.move(a-f,b-g,j,k),f=a,g=b,e.updateSvgEl(),e.setCoordinatesInForm()},function(){document.body.removeChild(h)})}},d.prototype.handleEdit=function(c,d,e){var f=b.prepare(c);if(f.start){"polygon"===this.shape.getType()&&(c.ctrlKey||c.metaKey)&&(this.shape.addNewPointAfter(d),this.removeFromSvg(),this.addToSvg(e),this.setActive());var g=this,h=f.x,i=f.y,j=this.makeDragProxy(f.x,f.y),k=a("fieldset#id_previewareaheader .dropbackground"),l=k.width(),m=k.height();b.start(c,a(j),function(a,b){g.shape.edit(d,a-h,b-i,l,m),h=a,i=b,g.updateSvgEl(),g.setCoordinatesInForm()},function(){document.body.removeChild(j),g.shape.normalizeShape(),g.updateSvgEl(),g.setCoordinatesInForm()})}},d.prototype.makeDragProxy=function(a,b){var c=document.createElement("div");return c.style.position="absolute",c.style.top=b+"px",c.style.left=a+"px",c.style.width="1px",c.style.height="1px",document.body.appendChild(c),c};var e={maxSizes:null,fp:null,noDropZones:null,dropZones:[],init:function(a){e.maxSizes=a,e.fp=e.filePickers(),e.noDropZones=e.form.getFormValue("nodropzone",[]),e.setupPreviewArea(),e.setOptionsForDragItemSelectors(),e.createShapes(),e.setupEventHandlers(),e.waitForFilePickerToInitialise()},setupPreviewArea:function(){a("fieldset#id_previewareaheader div.fcontainer").append('<div class="ddarea que ddmarker">   <div id="ddm-droparea" class="droparea">       <img class="dropbackground" />       <div id="ddm-dropzone" class="dropzones">       </div>   </div></div>')},setOptionsForDragItemSelectors:function(){var b,c,d,f={0:""},g=e.form.getFormValue("noitems",[]),h=[];for(c=1;c<=g;c++)d=e.form.getMarkerText(c),""!==d&&(f[c]=a("<div/>").text(d).html());for(c=0;c<e.noDropZones;c++)b=a("#id_drops_"+c+"_choice"),h[c]=Number(b.val());for(c=0;c<e.noDropZones;c++){b=a("#id_drops_"+c+"_choice"),b.find("option").remove();for(var i in f){i=Number(i);var j='<option value="'+i+'">'+f[i]+"</option>";b.append(j);var k=b.find('option[value="'+i+'"]');if(0!==i)if(i!==h[c]){var l=e.form.getFormValue("drags",[i-1,"noofdrags"]);if(0!==Number(l))for(var m in h)if(Number(h[m])===i){if(1===Number(l)){k.attr("disabled",!0);break}l--}}else k.attr("selected",!0)}e.dropZones.length>0&&e.dropZones[c].updateLabel()}},createShapes:function(){for(var a=0;a<e.noDropZones;a++)e.dropZones[a]=new d(a)},setupEventHandlers:function(){a("fieldset#id_draggableitemheader").on("change input","input, select",function(){e.setOptionsForDragItemSelectors()}),a("fieldset#id_dropzoneheader").on("change input","input, select",function(a){var b=a.currentTarget.name.match(/^drops\[(\d+)]\[([a-z]*)]$/);if(b){var c=b[1],d=b[2],f=e.dropZones[c];switch(d){case"shape":f.changeShape(e.form.getSvg());break;case"coords":f.updateCoordinatesFromForm(e.form.getSvg());break;case"choice":f.updateLabel()}}});var b=a("fieldset#id_previewareaheader");b.on("click","g.dropzone",function(b){var c=a(b.currentTarget).data("dropzone-no"),d=e.dropZones[c].isActive();a(e.form.getSvg()).find(".dropzone.active").removeClass("active"),d||e.dropZones[c].setActive()}),b.on("mousedown touchstart",".dropzone .handle.move",function(b){var c=a(b.currentTarget).closest("g").data("dropzoneNo");e.dropZones[c].handleMove(b)}),b.on("mousedown touchstart",".dropzone .handle.edit",function(b){var c=a(b.currentTarget).closest("g").data("dropzoneNo"),d=b.currentTarget.getAttribute("data-edit-handle-no");e.dropZones[c].handleEdit(b,d,e.form.getSvg())})},waitForFilePickerToInitialise:function(){return null===e.fp.file("bgimage").href?void setTimeout(e.waitForFilePickerToInitialise,1e3):(a("form.mform").on("change","#id_bgimage",e.loadPreviewImage),void e.loadPreviewImage())},loadPreviewImage:function(){a("fieldset#id_previewareaheader .dropbackground").one("load",e.afterPreviewImageLoaded).attr("src",e.fp.file("bgimage").href)},afterPreviewImageLoaded:function(){var b=a("fieldset#id_previewareaheader .dropbackground");e.constrainImageSize(),a("#ddm-dropzone").css("position","relative").css("top",(b.height()+1)*-1),a("#ddm-droparea").css("height",b.height()+20),e.updateSvgDisplay()},constrainImageSize:function(){var b=a("fieldset#id_previewareaheader .dropbackground"),c=Math.max(b.width()/e.maxSizes.width,b.height()/e.maxSizes.height);c>1&&b.css("width",Math.floor(b.width()/c)),b.addClass("constrained")},updateSvgDisplay:function(){var b,c=a("fieldset#id_previewareaheader .dropbackground");if(e.form.getSvg())for(b=0;b<e.noDropZones;b++)e.dropZones[b].updateSvgEl();else for(a("#ddm-dropzone").html('<svg xmlns="http://www.w3.org/2000/svg" class="dropzones" width="'+c.outerWidth()+'" height="'+c.outerHeight()+'"></svg>'),b=0;b<e.noDropZones;b++)e.dropZones[b].addToSvg(e.form.getSvg())},form:{getMarkerText:function(a){if(0!==Number(a)){var b=e.form.getFormValue("drags",[a-1,"label"]);return b.replace(new RegExp("^\\s*(.*)\\s*$"),"$1")}return""},getSvg:function(){var b=a("fieldset#id_previewareaheader svg");return 0===b.length?null:b[0]},toNameWithIndex:function(a,b){for(var c=a,d=0;d<b.length;d++)c=c+"["+b[d]+"]";return c},getEl:function(a,b){var c=document.getElementById("mform1");return c.elements[this.toNameWithIndex(a,b)]},getFormValue:function(a,b){var c=this.getEl(a,b);return"checkbox"===c.type?c.checked:c.value},setFormValue:function(a,b,c){var d=this.getEl(a,b);"checkbox"===d.type?d.checked=c:d.value=c}},filePickers:function(){var b,c;return void 0===b&&(b={},c={},a("form.mform input.filepickerhidden").each(function(a,d){b[d.value]=d.name,c[d.name]=d.parentNode})),{file:function(b){var d=a(c[b]).find("div.filepicker-filelist a");return d.length?{href:d.get(0).href,name:d.get(0).innerHTML}:{href:null,name:null}},name:function(a){return b[a]}}}};return{init:e.init}});
define('qtype_ddmarker/question', ["jquery","core/dragdrop","qtype_ddmarker/shapes","core/key_codes"],function(a,b,c,d){"use strict";function e(a,b,c,d){this.containerId=a,this.visibleDropZones=d,c&&this.getRoot().addClass("qtype_ddmarker-readonly"),this.loadImage(b)}e.prototype.loadImage=function(a){var b=this;this.getRoot().find(".dropbackground").one("load",function(){b.visibleDropZones.length>0&&b.drawDropzones(),b.repositionDrags()}).attr("src",a).css({border:"1px solid #000","max-width":"none"})},e.prototype.drawDropzones=function(){var a=this.getRoot().find("img.dropbackground");this.getRoot().find("div.dropzones").html('<svg xmlns="http://www.w3.org/2000/svg" class="dropzones" width="'+a.outerWidth()+'" height="'+a.outerHeight()+'"></svg>');var b=this.getRoot().find("svg.dropzones");b.css("position","absolute");for(var c=0,d=0;d<this.visibleDropZones.length;d++){var e="color"+c;c=(c+1)%8,this.addDropzone(b,d,e)}},e.prototype.addDropzone=function(a,b,d){var e,f=this.visibleDropZones[b],g=c.make(f.shape,"");if(g.parse(f.coords)){if(e=this.getRoot().find("div.markertexts span.markertext"+b),e.length)""!==f.markertext?e.html(f.markertext):e.remove();else if(""!==f.markertext){var h="markertext markertext"+b;this.getRoot().find("div.markertexts").append('<span class="'+h+'">'+f.markertext+"</span>")}var i=g.makeSvg(a[0]);i.setAttribute("class","dropzone "+d)}},e.prototype.repositionDropZones=function(){var a=this.getRoot().find("svg.dropzones");if(0!==a.length){var b=this.convertToWindowXY(new c.Point((-1),0));a.offset({left:b.x,top:b.y});for(var d=0;d<this.visibleDropZones.length;d++){var e=this.getRoot().find("div.ddarea div.markertexts span.markertext"+d);if(0!==e.length){var f=this.visibleDropZones[d],g=c.make(f.shape,"");if(g.parse(f.coords)){var h=g.getHandlePositions(),i=this.convertToWindowXY(h.moveHandle.offset(-e.outerWidth()/2,-e.outerHeight()/2));e.offset({left:i.x-4,top:i.y})}}}}},e.prototype.repositionDrags=function(){var b=this.getRoot(),c=this;b.find("div.dragitems .dragitem").each(function(b,c){a(c).addClass("unneeded")}),b.find("input.choices").each(function(a,b){for(var d=c.getChoiceNoFromElement(b),e=c.getCoords(b),f=c.dragHome(d),g=0;g<e.length;g++){var h=c.dragItem(d,g);!h.length||h.hasClass("beingdragged")?h=c.cloneNewDragItem(f,g):h.removeClass("unneeded"),h.offset({left:e[g].x,top:e[g].y})}}),b.find("div.dragitems .dragitem").each(function(b,c){var d=a(c);d.hasClass("unneeded")&&!d.hasClass("beingdragged")&&d.remove()}),this.repositionDropZones();var d=this.bgImage(),e=d.offset();d.data("prev-top",e.top).data("prev-left",e.left)},e.prototype.getCoords=function(b){var d=this.getRoot(),e=this.getChoiceNoFromElement(b),f=Number(this.getClassnameNumericSuffix(b,"noofdrags")),g=d.find("span.dragitem.beingdragged.choice"+e).length>0,h=[],i=a(b).val();if(""!==i)for(var j=i.split(";"),k=0;k<j.length;k++)h[k]=this.convertToWindowXY(c.Point.parse(j[k]));var l=h.length+(g?1:0);return(a(b).hasClass("infinite")||l<f)&&(h[h.length]=this.dragHomeXY(e)),h},e.prototype.convertToWindowXY=function(a){var b=this.bgImage();return a.offset(b.offset().left+1,b.offset().top+1)},e.prototype.convertToBgImgXY=function(a){var b=this.bgImage();return a.offset(-b.offset().left-1,-b.offset().top-1)},e.prototype.coordsInBgImg=function(a){var b=this.bgImage();return a.x>0&&a.x<=b.width()&&a.y>0&&a.y<=b.height()},e.prototype.dragHomeXY=function(a){var b=this.dragHome(a);return new c.Point(b.offset().left,b.offset().top)},e.prototype.getRoot=function(){return a(document.getElementById(this.containerId))},e.prototype.bgImage=function(){return this.getRoot().find("img.dropbackground")},e.prototype.dragHome=function(a){return this.getRoot().find("div.dragitems span.draghome.choice"+a)},e.prototype.dragItem=function(a,b){return this.getRoot().find("div.dragitems span.dragitem.choice"+a+".item"+b)},e.prototype.cloneNewDragItem=function(a,b){var c=a.clone(!0);return c.removeClass("draghome").addClass("dragitem").addClass("item"+b),a.after(c),c.attr("tabIndex",0),c},e.prototype.handleDragStart=function(c){var d=this,e=a(c.target).closest(".dragitem"),f=b.prepare(c);f.start&&(e.addClass("beingdragged"),b.start(c,e,function(){},function(a,b,c){d.dragEnd(c)}))},e.prototype.dragEnd=function(a){a.removeClass("beingdragged");var b=this.getChoiceNoFromElement(a);this.saveCoordsForChoice(b,a),this.repositionDrags()},e.prototype.saveCoordsForChoice=function(a,b){for(var d,e=[],f=this.getRoot().find("span.dragitem.choice"+a).length,g=!0,h=0;h<=f;h++){var i=this.dragItem(a,h);0!==i.length&&(i.hasClass("beingdragged")||(d=this.convertToBgImgXY(new c.Point(i.offset().left,i.offset().top)),this.coordsInBgImg(d)&&(e[e.length]=d)),b&&0!==b.length&&b[0].innerText===i[0].innerText&&(g=!1))}g&&(d=this.convertToBgImgXY(new c.Point(b.offset().left,b.offset().top)),this.coordsInBgImg(d)&&(e[e.length]=d)),this.getRoot().find("input.choice"+a).val(e.join(";"))},e.prototype.handleKeyPress=function(b){var e=a(b.target).closest(".dragitem"),f=new c.Point(e.offset().left,e.offset().top),g=this.getChoiceNoFromElement(e);switch(b.keyCode){case d.arrowLeft:case 65:f.x-=1;break;case d.arrowRight:case 68:f.x+=1;break;case d.arrowDown:case 83:f.y+=1;break;case d.arrowUp:case 87:f.y-=1;break;case d.space:case d.escape:f=null;break;default:return}b.preventDefault(),f=null!==f?this.constrainToBgImg(f):this.dragHomeXY(g),e.offset({left:f.x,top:f.y}),this.saveCoordsForChoice(g,e),this.repositionDrags()},e.prototype.constrainToBgImg=function(a){var b=this.bgImage(),c=this.convertToBgImgXY(a);return c.x=Math.max(0,c.x),c.y=Math.max(0,c.y),c.x=Math.min(b.width(),c.x),c.y=Math.min(b.height(),c.y),this.convertToWindowXY(c)},e.prototype.getChoiceNoFromElement=function(a){return Number(this.getClassnameNumericSuffix(a,"choice"))},e.prototype.getClassnameNumericSuffix=function(b,c){var d=a(b).attr("class");if(void 0!==d&&""!==d)for(var e=d.split(" "),f=0;f<e.length;f++){var g=new RegExp("^"+c+"([0-9])+$");if(g.test(e[f])){var h=new RegExp("([0-9])+$"),i=h.exec(e[f]);return Number(i[0])}}return null},e.prototype.handleResize=function(){this.repositionDrags()},e.prototype.fixLayoutIfBackgroundMoved=function(){var a=this.bgImage(),b=a.offset(),c=a.data("prev-top"),d=a.data("prev-left");void 0!==d&&void 0!==c&&(c===b.top&&d===b.left||this.repositionDrags())};var f={eventHandlersInitialised:!1,questions:{},init:function(a,b,c,d){f.questions[a]=new e(a,b,c,d),f.eventHandlersInitialised||(f.setupEventHandlers(),f.eventHandlersInitialised=!0)},setupEventHandlers:function(){a("body").on("mousedown touchstart",".que.ddmarker:not(.qtype_ddmarker-readonly) div.dragitems .dragitem",f.handleDragStart).on("keydown keypress",".que.ddmarker:not(.qtype_ddmarker-readonly) div.dragitems .dragitem",f.handleKeyPress),a(window).on("resize",f.handleWindowResize),setTimeout(f.fixLayoutIfThingsMoved,100)},handleDragStart:function(a){a.preventDefault();var b=f.getQuestionForEvent(a);b&&b.handleDragStart(a)},handleKeyPress:function(a){var b=f.getQuestionForEvent(a);b&&b.handleKeyPress(a)},handleWindowResize:function(){for(var a in f.questions)f.questions.hasOwnProperty(a)&&f.questions[a].handleResize()},fixLayoutIfThingsMoved:function(){for(var a in f.questions)f.questions.hasOwnProperty(a)&&f.questions[a].fixLayoutIfBackgroundMoved();setTimeout(f.fixLayoutIfThingsMoved,100)},getQuestionForEvent:function(b){var c=a(b.currentTarget).closest(".que.ddmarker").attr("id");return f.questions[c]}};return{init:f.init}});
define('qtype_ddwtos/ddwtos', ["jquery","core/dragdrop","core/key_codes"],function(a,b,c){"use strict";function d(a,b){this.containerId=a,b&&this.getRoot().addClass("qtype_ddwtos-readonly"),this.resizeAllDragsAndDrops(),this.cloneDrags(),this.positionDrags()}d.prototype.resizeAllDragsAndDrops=function(){var b=this;this.getRoot().find(".answercontainer > div").each(function(c,d){b.resizeAllDragsAndDropsInGroup(b.getClassnameNumericSuffix(a(d),"draggrouphomes"))})},d.prototype.resizeAllDragsAndDropsInGroup=function(a){var b=this,c=this.getRoot().find(".draggrouphomes"+a+" span.draghome"),d=0,e=0;c.each(function(a,b){d=Math.max(d,Math.ceil(b.offsetWidth)),e=Math.max(e,Math.ceil(0+b.offsetHeight))}),d+=8,e+=2,c.each(function(a,c){b.setElementSize(c,d,e)}),this.getRoot().find("span.drop.group"+a).each(function(a,c){b.setElementSize(c,d,e)})},d.prototype.setElementSize=function(b,c,d){a(b).width(c).height(d).css("lineHeight",d+"px")},d.prototype.cloneDrags=function(){var b=this;this.getRoot().find("span.draghome").each(function(c,d){b.cloneDragsForOneChoice(a(d))})},d.prototype.cloneDragsForOneChoice=function(a){if(a.hasClass("infinite"))for(var b=this.noOfDropsInGroup(this.getGroup(a)),c=0;c<b;c++)this.cloneDrag(a);else this.cloneDrag(a)},d.prototype.cloneDrag=function(a){var b=a.clone();b.removeClass("draghome").addClass("drag unplaced moodle-has-zindex").offset(a.offset()),this.getRoot().find("div.drags").append(b)},d.prototype.positionDrags=function(){var b=this,c=this.getRoot();c.find("span.drag").each(function(c,d){var e=a(d),f=b.getClassnameNumericSuffix(e,"inplace");e.addClass("unplaced").removeClass("placed").offset(b.getDragHome(b.getGroup(e),b.getChoice(e)).offset()),null!==f&&e.removeClass("inplace"+f)}),c.find("input.placeinput").each(function(d,e){var f=a(e),g=f.val(),h=b.getPlace(f),i=c.find(".drop.place"+h),j=i.offset();i.data("prev-top",j.top).data("prev-left",j.left),"0"!==g&&b.getUnplacedChoice(b.getGroup(f),g).removeClass("unplaced").addClass("placed inplace"+h).offset(c.find(".drop.place"+h).offset())})},d.prototype.fixLayoutIfDropsMoved=function(){var b=this,c=this.getRoot(),d=!1;c.find("input.placeinput").each(function(e,f){var g=b.getPlace(a(f)),h=c.find(".drop.place"+g),i=h.offset(),j=h.data("prev-top"),k=h.data("prev-left");void 0!==k&&void 0!==j&&(j===i.top&&k===i.left||(d=!0))}),d&&this.positionDrags()},d.prototype.handleDragStart=function(c){var d=this,e=a(c.target).closest(".drag"),f=b.prepare(c);if(f.start){var g=this.getClassnameNumericSuffix(e,"inplace");null!==g&&(this.setInputValue(g,0),e.removeClass("inplace"+g)),e.addClass("beingdragged"),b.start(c,e,function(a,b,c){d.dragMove(a,b,c)},function(a,b,c){d.dragEnd(a,b,c)})}},d.prototype.dragMove=function(b,c,d){var e=this;this.getRoot().find("span.drop.group"+this.getGroup(d)).each(function(d,f){var g=a(f);e.isPointInDrop(b,c,g)?g.addClass("valid-drag-over-drop"):g.removeClass("valid-drag-over-drop")})},d.prototype.dragEnd=function(b,c,d){var e=this,f=this.getRoot(),g=!1;f.find("span.drop.group"+this.getGroup(d)).each(function(f,h){var i=a(h);return!e.isPointInDrop(b,c,i)||(i.removeClass("valid-drag-over-drop"),e.sendDragToDrop(d,i),g=!0,!1)}),g||this.sendDragHome(d)},d.prototype.sendDragToDrop=function(a,b){var c=this.getCurrentDragInPlace(this.getPlace(b));0!==c.length&&this.sendDragHome(c),0===a.length?this.setInputValue(this.getPlace(b),0):(this.setInputValue(this.getPlace(b),this.getChoice(a)),a.removeClass("unplaced").addClass("placed inplace"+this.getPlace(b)),this.animateTo(a,b))},d.prototype.sendDragHome=function(a){a.removeClass("placed").addClass("unplaced");var b=this.getClassnameNumericSuffix(a,"inplace");null!==b&&a.removeClass("inplace"+b),this.animateTo(a,this.getDragHome(this.getGroup(a),this.getChoice(a)))},d.prototype.handleKeyPress=function(b){var d=a(b.target).closest(".drop"),e=this.getCurrentDragInPlace(this.getPlace(d)),f=a();switch(b.keyCode){case c.space:case c.arrowRight:case c.arrowDown:f=this.getNextDrag(this.getGroup(d),e);break;case c.arrowLeft:case c.arrowUp:f=this.getPreviousDrag(this.getGroup(d),e);break;case c.escape:break;default:return}b.preventDefault(),this.sendDragToDrop(f,d)},d.prototype.getNextDrag=function(a,b){var c,d=this.noOfChoicesInGroup(a);c=0===b.length?1:this.getChoice(b)+1;for(var e=this.getUnplacedChoice(a,c);0===e.length&&c<d;)c++,e=this.getUnplacedChoice(a,c);return e},d.prototype.getPreviousDrag=function(a,b){var c;c=0===b.length?this.noOfChoicesInGroup(a):this.getChoice(b)-1;for(var d=this.getUnplacedChoice(a,c);0===d.length&&c>1;)c--,d=this.getUnplacedChoice(a,c);return d},d.prototype.animateTo=function(a,b){var c=a.offset(),d=b.offset();a.addClass("beingdragged"),a.animate({left:parseInt(a.css("left"))+d.left-c.left,top:parseInt(a.css("top"))+d.top-c.top},{duration:"fast",done:function(){a.removeClass("beingdragged"),a.offset(d)}})},d.prototype.isPointInDrop=function(a,b,c){var d=c.offset();return a>=d.left&&a<d.left+c.width()&&b>=d.top&&b<d.top+c.height()},d.prototype.setInputValue=function(a,b){this.getRoot().find("input.placeinput.place"+a).val(b)},d.prototype.getRoot=function(){return a(document.getElementById(this.containerId))},d.prototype.getDragHome=function(a,b){return this.getRoot().find(".draghome.group"+a+".choice"+b)},d.prototype.getUnplacedChoice=function(a,b){return this.getRoot().find(".drag.group"+a+".choice"+b+".unplaced").slice(0,1)},d.prototype.getCurrentDragInPlace=function(a){return this.getRoot().find("span.drag.inplace"+a)},d.prototype.noOfDropsInGroup=function(a){return this.getRoot().find(".drop.group"+a).length},d.prototype.noOfChoicesInGroup=function(a){return this.getRoot().find(".draghome.group"+a).length},d.prototype.getClassnameNumericSuffix=function(a,b){var c=a.attr("class");if(""!==c)for(var d=c.split(" "),e=0;e<d.length;e++){var f=new RegExp("^"+b+"([0-9])+$");if(f.test(d[e])){var g=new RegExp("([0-9])+$"),h=g.exec(d[e]);return Number(h[0])}}return null},d.prototype.getChoice=function(a){return this.getClassnameNumericSuffix(a,"choice")},d.prototype.getGroup=function(a){return this.getClassnameNumericSuffix(a,"group")},d.prototype.getPlace=function(a){return this.getClassnameNumericSuffix(a,"place")};var e={eventHandlersInitialised:!1,questions:{},init:function(a,b){e.questions[a]=new d(a,b),e.eventHandlersInitialised||(e.setupEventHandlers(),e.eventHandlersInitialised=!0)},setupEventHandlers:function(){a("body").on("mousedown touchstart",".que.ddwtos:not(.qtype_ddwtos-readonly) span.drag",e.handleDragStart).on("keydown",".que.ddwtos:not(.qtype_ddwtos-readonly) span.drop",e.handleKeyPress),a(window).on("resize",e.handleWindowResize),setTimeout(e.fixLayoutIfThingsMoved,100)},handleDragStart:function(a){a.preventDefault();var b=e.getQuestionForEvent(a);b&&b.handleDragStart(a)},handleKeyPress:function(a){var b=e.getQuestionForEvent(a);b&&b.handleKeyPress(a)},handleWindowResize:function(){for(var a in e.questions)e.questions.hasOwnProperty(a)&&e.questions[a].positionDrags()},fixLayoutIfThingsMoved:function(){for(var a in e.questions)e.questions.hasOwnProperty(a)&&e.questions[a].fixLayoutIfDropsMoved();setTimeout(e.fixLayoutIfThingsMoved,100)},getQuestionForEvent:function(b){var c=a(b.currentTarget).closest(".que.ddwtos").attr("id");return e.questions[c]}};return{init:e.init}});
!function(a){"function"==typeof define&&define.amd?define('qtype_ordering/jquery.ui.touch-punch-improved', ["jquery","jqueryui"],a):a(window.jQuery)}(function(a){function b(a){var b=window.pageXOffset,c=window.pageYOffset,d=a.clientX,e=a.clientY;return 0===a.pageY&&Math.floor(e)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(d)>Math.floor(a.pageX)?(d-=b,e-=c):(e<a.pageY-c||d<a.pageX-b)&&(d=a.pageX-b,e=a.pageY-c),{clientX:d,clientY:e}}function c(c,e){if(!(!d&&c.originalEvent.touches.length>1||d&&!c.isPrimary)){var f=d?c.originalEvent:c.originalEvent.changedTouches[0],g=document.createEvent("MouseEvents"),h=b(f);a(f.target).is("input")||a(f.target).is("textarea")?c.stopPropagation():c.preventDefault(),g.initMouseEvent(e,!0,!0,window,1,c.screenX||f.screenX,c.screenY||f.screenY,c.clientX||h.clientX,c.clientY||h.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(g)}}var d=window.navigator.pointerEnabled||window.navigator.msPointerEnabled;if(a.support.touch="ontouchend"in document||d,a.support.touch&&a.ui.mouse){var e,f=a.ui.mouse.prototype,g=f._mouseInit;f._touchStart=function(a){var b=this;e||!d&&!b._mouseCapture(a.originalEvent.changedTouches[0])||(e=!0,b._touchMoved=!1,c(a,"mouseover"),c(a,"mousemove"),c(a,"mousedown"))},f._touchMove=function(a){e&&(this._touchMoved=!0,c(a,"mousemove"))},f._touchEnd=function(a){e&&(c(a,"mouseup"),c(a,"mouseout"),this._touchMoved||c(a,"click"),e=!1)},f._mouseInit=function(){var b=this;b.element.on({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd"),pointerDown:a.proxy(b,"_touchStart"),pointerMove:a.proxy(b,"_touchMove"),pointerUp:a.proxy(b,"_touchEnd"),MSPointerDown:a.proxy(b,"_touchStart"),MSPointerMove:a.proxy(b,"_touchMove"),MSPointerUp:a.proxy(b,"_touchEnd")}),g.call(b)}}});
define('qtype_ordering/ordering', ["jquery","jqueryui","qtype_ordering/jquery.ui.touch-punch-improved"],function(a){return{init:function(b,c,d,e){a("#"+b).sortable({axis:e,containment:a("#"+b),opacity:.6,update:function(){var b=a(this).sortable("toArray").toString();a("#"+c).attr("value",b)}})}}});
define('mod_assign/grading_navigation_user_info', ["jquery","core/notification","core/ajax","core/templates"],function(a,b,c,d){var e=function(b){this._regionSelector=b,this._region=a(b),this._userCache={},a(document).on("user-changed",this._refreshUserInfo.bind(this))};return e.prototype._regionSelector=null,e.prototype._userCache=null,e.prototype._region=null,e.prototype._lastUserId=0,e.prototype._getAssignmentId=function(){return this._region.attr("data-assignmentid")},e.prototype._refreshUserInfo=function(e,f){var g=a.Deferred();this._region.attr("data-userid",f),this._lastUserId!=f&&(this._lastUserId=f,d.render("mod_assign/loading",{}).done(function(e,h){if(this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,e,h),this._region.fadeIn("fast")}.bind(this)),f<0)return void d.render("mod_assign/grading_navigation_no_users",{}).done(function(a,b){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(b.exception);if("undefined"!=typeof this._userCache[f])g.resolve(this._userCache[f]);else{var i=this._getAssignmentId(),j=c.call([{methodname:"mod_assign_get_participant",args:{userid:f,assignid:i,embeduser:!0}}]);j[0].done(function(a){a.hasOwnProperty("id")?(this._userCache[f]=a,g.resolve(this._userCache[f])):g.reject("No users")}.bind(this)).fail(b.exception)}g.done(function(c){var e=a("[data-showuseridentity]").data("showuseridentity").split(","),f=[];c.courseid=a('[data-region="grading-navigation-panel"]').attr("data-courseid"),c.user&&(a.each(e,function(a,b){"undefined"!=typeof c.user[b]&&""!==c.user[b]&&(c.hasidentity=!0,f.push(c.user[b]))}),c.identity=f.join(", "),c.user.profileimageurl&&(c.profileimageurl=c.user.profileimageurl)),d.render("mod_assign/grading_navigation_user_summary",c).done(function(a,b){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(b.exception)}.bind(this)).fail(function(){d.render("mod_assign/grading_navigation_no_users",{}).done(function(a,b){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(b.exception)}.bind(this))}.bind(this)).fail(b.exception))},e});
define('mod_assign/grading_review_panel', ["jquery","mod_assign/grading_events"],function(a,b){var c=function(){this._region=a('[data-region="review-panel-content"]'),this.registerEventListeners()};return c.prototype._region=null,c.prototype.getReviewPanel=function(a){var b=this._region.data("panel-owner");return"undefined"==typeof b&&this._region.data("review-panel-plugin",a),this._region.data("review-panel-plugin")==a&&this._region[0]},c.prototype.getTogglePanelButton=function(){return this.getPanelElement().find('[data-region="review-panel-toggle"]')},c.prototype.getPanelElement=function(){return a('[data-region="review-panel"]')},c.prototype.getPanelContentElement=function(){return a('[data-region="review-panel-content"]')},c.prototype.togglePanel=function(){this.getPanelElement().hasClass("collapsed")?a(document).trigger(b.EXPAND_REVIEW_PANEL):a(document).trigger(b.COLLAPSE_REVIEW_PANEL)},c.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed").removeClass("grade-panel-collapsed"),this.getPanelContentElement().attr("aria-hidden",!0)},c.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed"),this.getPanelContentElement().removeAttr("aria-hidden")},c.prototype.registerEventListeners=function(){var c=this.getTogglePanelButton();c.click(function(a){this.togglePanel(),a.preventDefault()}.bind(this)),c.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.togglePanel(),a.preventDefault())}.bind(this));var d=a(document);d.on(b.COLLAPSE_REVIEW_PANEL,function(){this.collapsePanel()}.bind(this)),d.on(b.COLLAPSE_GRADE_PANEL,function(){this.expandPanel(),this.getPanelElement().addClass("grade-panel-collapsed")}.bind(this)),d.on(b.EXPAND_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),d.on(b.EXPAND_GRADE_PANEL,function(){this.getPanelElement().removeClass("grade-panel-collapsed")}.bind(this))},c});
define('mod_assign/grading_actions', ["jquery","mod_assign/grading_events"],function(a,b){var c=function(b){this._regionSelector=b,this._region=a(b),this.registerEventListeners()};return c.prototype._regionSelector=null,c.prototype._lastUserId=0,c.prototype._region=null,c.prototype._showActionsForm=function(a,b){var c=this._region.find("[data-region=grading-actions-form]");b!=this._lastUserId&&b>0&&(this._lastUserId=b),b>0?c.removeClass("hide"):c.addClass("hide")},c.prototype._trigger=function(b){a(document).trigger(b)},c.prototype.getReviewPanelElement=function(){return a('[data-region="review-panel"]')},c.prototype.hasReviewPanelElement=function(){return this.getReviewPanelElement().length>0},c.prototype.getCollapseGradePanelButton=function(){return a('[data-region="grade-actions"] .collapse-grade-panel')},c.prototype.getCollapseReviewPanelButton=function(){return a('[data-region="grade-actions"] .collapse-review-panel')},c.prototype.getExpandAllPanelsButton=function(){return a('[data-region="grade-actions"] .collapse-none')},c.prototype.resetLayoutButtons=function(){this.getCollapseGradePanelButton().removeClass("active"),this.getCollapseReviewPanelButton().removeClass("active"),this.getExpandAllPanelsButton().removeClass("active")},c.prototype.collapseReviewPanel=function(){a(document).trigger(b.COLLAPSE_REVIEW_PANEL),a(document).trigger(b.EXPAND_GRADE_PANEL),this.resetLayoutButtons(),this.getCollapseReviewPanelButton().addClass("active")},c.prototype.collapseGradePanel=function(){a(document).trigger(b.COLLAPSE_GRADE_PANEL),a(document).trigger(b.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getCollapseGradePanelButton().addClass("active")},c.prototype.expandAllPanels=function(){a(document).trigger(b.EXPAND_GRADE_PANEL),a(document).trigger(b.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getExpandAllPanelsButton().addClass("active")},c.prototype.registerEventListeners=function(){if(this.hasReviewPanelElement()){var b=this.getCollapseReviewPanelButton();b.click(function(a){this.collapseReviewPanel(),a.preventDefault()}.bind(this)),b.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.collapseReviewPanel(),a.preventDefault())}.bind(this));var c=this.getCollapseGradePanelButton();c.click(function(a){this.collapseGradePanel(),a.preventDefault()}.bind(this)),c.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.collapseGradePanel(),a.preventDefault())}.bind(this));var d=this.getExpandAllPanelsButton();d.click(function(a){this.expandAllPanels(),a.preventDefault()}.bind(this)),d.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.expandAllPanels(),a.preventDefault())}.bind(this))}a(document).on("user-changed",this._showActionsForm.bind(this)),this._region.find('[name="savechanges"]').on("click",this._trigger.bind(this,"save-changes")),this._region.find('[name="saveandshownext"]').on("click",this._trigger.bind(this,"save-and-show-next")),this._region.find('[name="resetbutton"]').on("click",this._trigger.bind(this,"reset")),this._region.find("form").on("submit",function(a){a.preventDefault()})},c});
define('mod_assign/participant_selector', ["core/ajax","jquery","core/templates"],function(a,b,c){return{processResults:function(a,b){return b},transport:function(d,e,f,g){var h=b(d).attr("data-assignmentid"),i=b(d).attr("data-groupid"),j=b('[data-region="configure-filters"] input[type="checkbox"]'),k=[];j.each(function(a,c){k[b(c).attr("name")]=b(c).prop("checked")}),a.call([{methodname:"mod_assign_list_participants",args:{assignid:h,groupid:i,filter:e,limit:30,includeenrolments:!1}}])[0].then(function(a){var d=[],e=b("[data-showuseridentity]").data("showuseridentity").split(",");return b.each(a,function(a,f){var g=f,h=[],i=!0;k.filter_submitted&&!f.submitted&&(i=!1),k.filter_notsubmitted&&f.submitted&&(i=!1),k.filter_requiregrading&&!f.requiregrading&&(i=!1),k.filter_grantedextension&&!f.grantedextension&&(i=!1),i&&(b.each(e,function(a,b){"undefined"!=typeof f[b]&&""!==f[b]&&(g.hasidentity=!0,h.push(f[b]))}),g.identity=h.join(", "),d.push(c.render("mod_assign/list_participant_user_summary",g).then(function(a){return{value:f.id,label:a}})))}),b.when.apply(b,d)}).then(function(){var a=[];arguments[0]&&(a=Array.prototype.slice.call(arguments)),f(a)})["catch"](g)}}});
define('mod_assign/grading_panel', ["jquery","core/yui","core/notification","core/templates","core/fragment","core/ajax","core/str","mod_assign/grading_form_change_checker","mod_assign/grading_events"],function(a,b,c,d,e,f,g,h,i){var j=function(b){this._regionSelector=b,this._region=a(b),this._userCache=[],this.registerEventListeners()};return j.prototype._regionSelector=null,j.prototype._lastUserId=0,j.prototype._lastAttemptNumber=-1,j.prototype._region=null,j.prototype.nextUserId=null,j.prototype.nextUser=!1,j.prototype._niceReplaceNodeContents=function(b,c,e){var f=a.Deferred();return b.fadeOut("fast",function(){d.replaceNodeContents(b,c,e),b.fadeIn("fast",function(){f.resolve()})}),f.promise()},j.prototype._saveFormState=function(){"undefined"!=typeof window.tinyMCE&&window.tinyMCE.triggerSave();var b=a('[data-region="grading-actions-form"] [name="sendstudentnotifications"]').prop("checked");a('.gradeform [name="sendstudentnotifications"]').val(b)},j.prototype._submitForm=function(b,d,e){var g=a(this._region.find("form.gradeform"));a('[data-region="overlay"]').show(),g.trigger("save-form-state");var h=g.serialize(),i=this._region.attr("data-assignmentid");f.call([{methodname:"mod_assign_submit_grading_form",args:{assignmentid:i,userid:this._lastUserId,jsonformdata:JSON.stringify(h)},done:this._handleFormSubmissionResponse.bind(this,h,d,e),fail:c.exception}])},j.prototype._handleFormSubmissionResponse=function(d,e,f,h){"undefined"==typeof e&&(e=this._lastUserId),h.length?a(document).trigger("reset",[this._lastUserId,d]):(g.get_strings([{key:"changessaved",component:"core"},{key:"gradechangessaveddetail",component:"mod_assign"}]).done(function(a){c.alert(a[0],a[1])}).fail(c.exception),b.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),e==this._lastUserId?a(document).trigger("reset",e):f?a(document).trigger("done-saving-show-next",!0):a(document).trigger("user-changed",e)),a('[data-region="overlay"]').hide()},j.prototype._resetForm=function(b,c,d){var e=a.Event("custom");"undefined"==typeof c&&(c=this._lastUserId),this._lastUserId=0,this._refreshGradingPanel(e,c,d)},j.prototype._chooseAttempt=function(b){var d=a(b.target),e=d.data("submissions"),f=a(document.getElementById(e)),h=f.clone(),i=h.wrap(a("<form/>")).html();g.get_strings([{key:"viewadifferentattempt",component:"mod_assign"},{key:"view",component:"core"},{key:"cancel",component:"core"}]).done(function(b){c.confirm(b[0],i,b[1],b[2],function(){var b=a("input:radio[name='select-attemptnumber']:checked").val();this._refreshGradingPanel(null,this._lastUserId,"",b)}.bind(this))}.bind(this)).fail(c.exception)},j.prototype._addPopoutButtons=function(b){var e=a(b);d.render("mod_assign/popout_button",{}).done(function(a){var b=e.find('[data-fieldtype="filemanager"],[data-fieldtype="editor"],[data-fieldtype="grading"]').closest(".fitem");b.addClass("has-popout").find("label").parent().append(a),e.on("click",'[data-region="popout-button"]',this._togglePopout.bind(this))}.bind(this)).fail(c.exception)},j.prototype._togglePopout=function(b){b.preventDefault();var c=a(b.target).closest(".fitem");c.hasClass("popout")?a(".popout").removeClass("popout"):(a(".popout").removeClass("popout"),c.addClass("popout"),c.addClass("moodle-has-zindex"))},j.prototype._refreshGradingPanel=function(b,f,g,i){var j=this._region.attr("data-contextid");"undefined"==typeof g&&(g=""),"undefined"==typeof i&&(i=-1),this._lastUserId==f&&this._lastAttemptNumber==i&&""===g||(this._lastUserId=f,this._lastAttemptNumber=i,a(document).trigger("start-loading-user"),window.M.util.js_pending("mod-assign-loading-user"),d.render("mod_assign/loading",{}).done(function(b,d){this._niceReplaceNodeContents(this._region,b,d).done(function(){if(f>0){this._region.show();var b={userid:f,attemptnumber:i,jsonformdata:JSON.stringify(g)};e.loadFragment("mod_assign","gradingpanel",j,b).done(function(b,d){this._niceReplaceNodeContents(this._region,b,d).done(function(){h.saveFormState('[data-region="grade-panel"] .gradeform'),a(document).on("editor-content-restored",function(){h.saveFormState('[data-region="grade-panel"] .gradeform')}),a('[data-region="attempt-chooser"]').on("click",this._chooseAttempt.bind(this)),this._addPopoutButtons('[data-region="grade-panel"] .gradeform'),a(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this)).fail(c.exception)}.bind(this)).fail(c.exception),a('[data-region="review-panel"]').show()}else this._region.hide(),a('[data-region="review-panel"]').hide(),a(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this))}.bind(this)).fail(c.exception))},j.prototype._getNextUser=function(a,b){this.nextUserId=b.nextUserId,this.nextUser=b.nextUser},j.prototype._handleSaveAndShowNext=function(){this._submitForm(null,this.nextUserId,this.nextUser)},j.prototype.getPanelElement=function(){return a('[data-region="grade-panel"]')},j.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed")},j.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed")},j.prototype.registerEventListeners=function(){var b=a(document),c=a(this._region);c.on("submit","form",function(a){a.preventDefault()}),b.on("next-user",this._getNextUser.bind(this)),b.on("user-changed",this._refreshGradingPanel.bind(this)),b.on("save-changes",this._submitForm.bind(this)),b.on("save-and-show-next",this._handleSaveAndShowNext.bind(this)),b.on("reset",this._resetForm.bind(this)),b.on("save-form-state",this._saveFormState.bind(this)),b.on(i.COLLAPSE_GRADE_PANEL,function(){this.collapsePanel()}.bind(this)),b.on(i.COLLAPSE_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),b.on(i.EXPAND_GRADE_PANEL,function(){this.expandPanel()}.bind(this))},j});
define('mod_assign/grading_form_change_checker', ["jquery"],function(a){return{saveFormState:function(b){a(b).trigger("save-form-state");var c=a(b).serialize();a(b).data("saved-form-state",c)},checkFormForChanges:function(b){a(b).trigger("save-form-state");var c=a(b).serialize(),d=a(b).data("saved-form-state");return"undefined"!=typeof d&&d!=c}}});
define('mod_assign/grading_navigation', ["jquery","core/notification","core/str","core/form-autocomplete","core/ajax","mod_assign/grading_form_change_checker"],function(a,b,c,d,e,f){var g=function(e){this._regionSelector=e,this._region=a(e),this._filters=[],this._users=[],this._filteredUsers=[],this._loadAllUsers(),this._region.find('[data-action="previous-user"]').on("click",this._handlePreviousUser.bind(this)),this._region.find('[data-action="next-user"]').on("click",this._handleNextUser.bind(this)),this._region.find('[data-action="change-user"]').on("change",this._handleChangeUser.bind(this)),this._region.find('[data-region="user-filters"]').on("click",this._toggleExpandFilters.bind(this)),a(document).on("user-changed",this._refreshSelector.bind(this)),a(document).on("done-saving-show-next",this._handleNextUser.bind(this));var f=this._region.find('[data-region="user-filters"]'),g=a(document.getElementById(f.attr("aria-controls")));g.on("change",'[type="checkbox"]',this._filterChanged.bind(this));var h=a('[data-region="grading-navigation-panel"]').data("first-userid");h&&this._selectUserById(h),c.get_string("changeuser","mod_assign").done(function(a){d.enhance("[data-action=change-user]",!1,"mod_assign/participant_selector",a)}).fail(b.exception),a(document).bind("start-loading-user",function(){this._isLoading=!0}.bind(this)),a(document).bind("finish-loading-user",function(){this._isLoading=!1}.bind(this))};return g.prototype._isLoading=!1,g.prototype._regionSelector=null,g.prototype._filters=null,g.prototype._users=null,g.prototype._region=null,g.prototype._loadAllUsers=function(){var a=this._region.find("[data-action=change-user]"),c=a.attr("data-assignmentid"),d=a.attr("data-groupid");e.call([{methodname:"mod_assign_list_participants",args:{assignid:c,groupid:d,filter:"",onlyids:!0},done:this._usersLoaded.bind(this),fail:b.exception}])},g.prototype._usersLoaded=function(b){if(this._filteredUsers=this._users=b,this._users.length){var c=this._region.find('[data-region="user-filters"]'),d=a(document.getElementById(c.attr("aria-controls")));d.find('[type="checkbox"]').trigger("change")}else this._selectNoUser();this._triggerNextUserEvent()},g.prototype._checkClickOutsideConfigureFilters=function(b){var c=this._region.find('[data-region="configure-filters"]');if(!c.is(b.target)&&0===c.has(b.target).length){var d=this._region.find('[data-region="user-filters"]');c.hide(),c.attr("aria-hidden","true"),d.attr("aria-expanded","false"),a(document).unbind("click.mod_assign_grading_navigation")}},g.prototype._filterChanged=function(d){var e=a(d.target).attr("name"),f=e.split("_").pop(),g=a(d.target).prop("checked");if(g)this._filters.indexOf(f)==-1&&(this._filters[this._filters.length]=f);else{var h=this._filters.indexOf(f);h!=-1&&this._filters.splice(h,1)}var i=[];this._region.find('[data-region="configure-filters"]').find('[type="checkbox"]').each(function(b,c){a(c).prop("checked")&&(i[i.length]=a(c).closest("label").text())}),i.length?this._region.find('[data-region="user-filters"] span').text(i.join(", ")):c.get_string("nofilters","mod_assign").done(function(a){this._region.find('[data-region="user-filters"] span').text(a)}.bind(this)).fail(b.exception);var j=this._region.find("[data-action=change-user]"),k=j.attr("data-selected"),l=0;this._filteredUsers=[],a.each(this._users,function(b,c){var d=!0;a.each(this._filters,function(a,b){"submitted"==b?"0"==c.submitted&&(d=!1):"notsubmitted"==b?"1"==c.submitted&&(d=!1):"requiregrading"==b?"0"==c.requiregrading&&(d=!1):"grantedextension"==b&&"0"==c.grantedextension&&(d=!1)}),d&&(this._filteredUsers[this._filteredUsers.length]=c,k==c.id&&(l=this._filteredUsers.length-1))}.bind(this)),this._filteredUsers.length?this._selectUserById(this._filteredUsers[l].id):this._selectNoUser(),this._triggerNextUserEvent()},g.prototype._selectNoUser=function(){this._isLoading||(f.checkFormForChanges('[data-region="grade-panel"] .gradeform')?c.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){a(document).trigger("save-changes",-1)})}):a(document).trigger("user-changed",-1))},g.prototype._selectUserById=function(d){var e=this._region.find("[data-action=change-user]"),g=parseInt(d,10);this._isLoading||(f.checkFormForChanges('[data-region="grade-panel"] .gradeform')?c.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){a(document).trigger("save-changes",g)})}):(e.attr("data-selected",d),!isNaN(g)&&g>0&&a(document).trigger("user-changed",d)))},g.prototype._toggleExpandFilters=function(b){b.preventDefault();var c=a(b.target).closest('[data-region="user-filters"]'),d="true"==c.attr("aria-expanded"),e=a(document.getElementById(c.attr("aria-controls")));d?(e.hide(),e.attr("aria-hidden","true"),c.attr("aria-expanded","false"),a(document).unbind("click.mod_assign_grading_navigation")):(e.css("display","inline-block"),e.attr("aria-hidden","false"),c.attr("aria-expanded","true"),b.stopPropagation(),a(document).on("click.mod_assign_grading_navigation",this._checkClickOutsideConfigureFilters.bind(this)))},g.prototype._handlePreviousUser=function(a){a.preventDefault();var b=this._region.find("[data-action=change-user]"),c=b.attr("data-selected"),d=0,e=0;for(d=0;d<this._filteredUsers.length;d++)if(this._filteredUsers[d].id==c){e=d;break}var f=this._filteredUsers.length,g=e-1;g<0&&(g=f-1),f&&this._selectUserById(this._filteredUsers[g].id)},g.prototype._handleNextUser=function(b,c){b.preventDefault();var d=this._region.find("[data-action=change-user]"),e=d.attr("data-selected"),f=0,g=0;for(f=0;f<this._filteredUsers.length;f++)if(this._filteredUsers[f].id==e){g=f;break}var h=this._filteredUsers.length,i=(g+1)%h;if(c&&h){var j=this._filteredUsers[i].id,k=parseInt(j,10);d.attr("data-selected",j),!isNaN(k)&&k>0&&a(document).trigger("user-changed",j)}else h&&this._selectUserById(this._filteredUsers[i].id)},g.prototype._refreshCount=function(){var a=this._region.find("[data-action=change-user]"),d=a.attr("data-selected"),e=0,f=0;if(isNaN(d)||d<=0)this._region.find('[data-region="user-count"]').hide();else{for(this._region.find('[data-region="user-count"]').show(),e=0;e<this._filteredUsers.length;e++)if(this._filteredUsers[e].id==d){f=e;break}var g=this._filteredUsers.length;g&&(f+=1);var h={x:f,y:g};c.get_string("xofy","mod_assign",h).done(function(a){this._region.find('[data-region="user-count-summary"]').text(a)}.bind(this)).fail(b.exception)}},g.prototype._refreshSelector=function(a,b){var c=this._region.find("[data-action=change-user]");b=parseInt(b,10),!isNaN(b)&&b>0&&c.attr("data-selected",b),this._refreshCount()},g.prototype._triggerNextUserEvent=function(){this._filteredUsers.length>1?a(document).trigger("next-user",{nextUserId:null,nextUser:!0}):a(document).trigger("next-user",{nextUser:!1})},g.prototype._handleChangeUser=function(){var d=this._region.find("[data-action=change-user]"),e=parseInt(d.val(),10);this._isLoading||(f.checkFormForChanges('[data-region="grade-panel"] .gradeform')?c.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){a(document).trigger("save-changes",e)})}):!isNaN(e)&&e>0&&(d.attr("data-selected",e),a(document).trigger("user-changed",e)))},g});
define('mod_assign/grading_events', function(){return{COLLAPSE_REVIEW_PANEL:"grading:collapse-review-panel",EXPAND_REVIEW_PANEL:"grading:expand-review-panel",COLLAPSE_GRADE_PANEL:"grading:collapse-grade-panel",EXPAND_GRADE_PANEL:"grading:expand-grade-panel"}});
define('mod_choice/select_all_choices', ["jquery"],function(a){return{init:function(){a(".selectallnone a").on("click",function(b){b.preventDefault(),a("#attemptsform").find("input:checkbox").prop("checked",a(this).data("selectInfo"))})}}});
/*! @vimeo/player v2.10.0 | (c) 2019 Vimeo | MIT License | https://github.com/vimeo/player.js */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define('mod_externalvideo/player', t):((e=e||self).Vimeo=e.Vimeo||{},e.Vimeo.Player=t())}(this,function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var e="undefined"!=typeof global&&"[object global]"==={}.toString.call(global);function i(e,t){return 0===e.indexOf(t.toLowerCase())?e:"".concat(t.toLowerCase()).concat(e.substr(0,1).toUpperCase()).concat(e.substr(1))}function s(e){return/^(https?:)?\/\/((player|www)\.)?vimeo\.com(?=$|\/)/.test(e)}function l(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.id,r=t.url,o=n||r;if(!o)throw new Error("An id or url must be passed, either in an options object or as a data-vimeo-id or data-vimeo-url attribute.");if(e=o,!isNaN(parseFloat(e))&&isFinite(e)&&Math.floor(e)==e)return"https://vimeo.com/".concat(o);if(s(o))return o.replace("http:","https:");if(n)throw new TypeError("“".concat(n,"” is not a valid video id."));throw new TypeError("“".concat(o,"” is not a vimeo.com url."))}var t=void 0!==Array.prototype.indexOf,n="undefined"!=typeof window&&void 0!==window.postMessage;if(!(e||t&&n))throw new Error("Sorry, the Vimeo Player API is not available in this browser.");var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(e){if(!e.WeakMap){var n=Object.prototype.hasOwnProperty,o=function(e,t,n){Object.defineProperty?Object.defineProperty(e,t,{configurable:!0,writable:!0,value:n}):e[t]=n};e.WeakMap=function(){function e(){if(void 0===this)throw new TypeError("Constructor WeakMap requires 'new'");if(o(this,"_id","_WeakMap"+"_"+t()+"."+t()),0<arguments.length)throw new TypeError("WeakMap iterable is not supported")}function r(e,t){if(!i(e)||!n.call(e,"_id"))throw new TypeError(t+" method called on incompatible receiver "+typeof e)}function t(){return Math.random().toString().substring(2)}return o(e.prototype,"delete",function(e){if(r(this,"delete"),!i(e))return!1;var t=e[this._id];return!(!t||t[0]!==e)&&(delete e[this._id],!0)}),o(e.prototype,"get",function(e){if(r(this,"get"),i(e)){var t=e[this._id];return t&&t[0]===e?t[1]:void 0}}),o(e.prototype,"has",function(e){if(r(this,"has"),!i(e))return!1;var t=e[this._id];return!(!t||t[0]!==e)}),o(e.prototype,"set",function(e,t){if(r(this,"set"),!i(e))throw new TypeError("Invalid value used as weak map key");var n=e[this._id];return n&&n[0]===e?n[1]=t:o(e,this._id,[e,t]),this}),o(e,"_polyfill",!0),e}()}function i(e){return Object(e)===e}}("undefined"!=typeof self?self:"undefined"!=typeof window?window:o);var a,f=(function(e){var t,n,r;r=function(){var t,a,n,e=Object.prototype.toString,r="undefined"!=typeof setImmediate?function(e){return setImmediate(e)}:setTimeout;try{Object.defineProperty({},"x",{}),t=function(e,t,n,r){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:!1!==r})}}catch(e){t=function(e,t,n){return e[t]=n,e}}function i(e,t){n.add(e,t),a||(a=r(n.drain))}function u(e){var t,n=typeof e;return null==e||"object"!=n&&"function"!=n||(t=e.then),"function"==typeof t&&t}function c(){for(var e=0;e<this.chain.length;e++)o(this,1===this.state?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function o(e,t,n){var r,o;try{!1===t?n.reject(e.msg):(r=!0===t?e.msg:t.call(void 0,e.msg))===n.promise?n.reject(TypeError("Promise-chain cycle")):(o=u(r))?o.call(r,n.resolve,n.reject):n.resolve(r)}catch(e){n.reject(e)}}function s(e){var t=this;t.triggered||(t.triggered=!0,t.def&&(t=t.def),t.msg=e,t.state=2,0<t.chain.length&&i(c,t))}function l(e,n,r,o){for(var t=0;t<n.length;t++)!function(t){e.resolve(n[t]).then(function(e){r(t,e)},o)}(t)}function f(e){this.def=e,this.triggered=!1}function d(e){this.promise=e,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function h(e){if("function"!=typeof e)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var r=new d(this);this.then=function(e,t){var n={success:"function"!=typeof e||e,failure:"function"==typeof t&&t};return n.promise=new this.constructor(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");n.resolve=e,n.reject=t}),r.chain.push(n),0!==r.state&&i(c,r),n.promise},this.catch=function(e){return this.then(void 0,e)};try{e.call(void 0,function(e){(function e(n){var r,o=this;if(!o.triggered){o.triggered=!0,o.def&&(o=o.def);try{(r=u(n))?i(function(){var t=new f(o);try{r.call(n,function(){e.apply(t,arguments)},function(){s.apply(t,arguments)})}catch(e){s.call(t,e)}}):(o.msg=n,o.state=1,0<o.chain.length&&i(c,o))}catch(e){s.call(new f(o),e)}}}).call(r,e)},function(e){s.call(r,e)})}catch(e){s.call(r,e)}}n=function(){var n,r,o;function i(e,t){this.fn=e,this.self=t,this.next=void 0}return{add:function(e,t){o=new i(e,t),r?r.next=o:n=o,r=o,o=void 0},drain:function(){var e=n;for(n=r=a=void 0;e;)e.fn.call(e.self),e=e.next}}}();var v=t({},"constructor",h,!1);return t(h.prototype=v,"__NPO__",0,!1),t(h,"resolve",function(n){return n&&"object"==typeof n&&1===n.__NPO__?n:new this(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");e(n)})}),t(h,"reject",function(n){return new this(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");t(n)})}),t(h,"all",function(t){var a=this;return"[object Array]"!=e.call(t)?a.reject(TypeError("Not an array")):0===t.length?a.resolve([]):new a(function(n,e){if("function"!=typeof n||"function"!=typeof e)throw TypeError("Not a function");var r=t.length,o=Array(r),i=0;l(a,t,function(e,t){o[e]=t,++i===r&&n(o)},e)})}),t(h,"race",function(t){var r=this;return"[object Array]"!=e.call(t)?r.reject(TypeError("Not an array")):new r(function(n,e){if("function"!=typeof n||"function"!=typeof e)throw TypeError("Not a function");l(r,t,function(e,t){n(t)},e)})}),h},(n=o)[t="Promise"]=n[t]||r(),e.exports&&(e.exports=n[t])}(a={exports:{}},a.exports),a.exports),d=new WeakMap;function u(e,t,n){var r=d.get(e.element)||{};t in r||(r[t]=[]),r[t].push(n),d.set(e.element,r)}function c(e,t){return(d.get(e.element)||{})[t]||[]}function h(e,t,n){var r=d.get(e.element)||{};if(!r[t])return!0;if(!n)return r[t]=[],d.set(e.element,r),!0;var o=r[t].indexOf(n);return-1!==o&&r[t].splice(o,1),d.set(e.element,r),r[t]&&0===r[t].length}var v=["autopause","autoplay","background","byline","color","controls","dnt","height","id","loop","maxheight","maxwidth","muted","playsinline","portrait","responsive","speed","texttrack","title","transparent","url","width"];function p(r){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return v.reduce(function(e,t){var n=r.getAttribute("data-vimeo-".concat(t));return(n||""===n)&&(e[t]=""===n?1:n),e},e)}function y(e,t){var n=e.html;if(!t)throw new TypeError("An element must be provided");if(null!==t.getAttribute("data-vimeo-initialized"))return t.querySelector("iframe");var r=document.createElement("div");return r.innerHTML=n,t.appendChild(r.firstChild),t.setAttribute("data-vimeo-initialized","true"),t.querySelector("iframe")}function m(i){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},u=2<arguments.length?arguments[2]:void 0;return new Promise(function(t,n){if(!s(i))throw new TypeError("“".concat(i,"” is not a vimeo.com url."));var e="https://vimeo.com/api/oembed.json?url=".concat(encodeURIComponent(i));for(var r in a)a.hasOwnProperty(r)&&(e+="&".concat(r,"=").concat(encodeURIComponent(a[r])));var o="XDomainRequest"in window?new XDomainRequest:new XMLHttpRequest;o.open("GET",e,!0),o.onload=function(){if(404!==o.status)if(403!==o.status)try{var e=JSON.parse(o.responseText);if(403===e.domain_status_code)return y(e,u),void n(new Error("“".concat(i,"” is not embeddable.")));t(e)}catch(e){n(e)}else n(new Error("“".concat(i,"” is not embeddable.")));else n(new Error("“".concat(i,"” was not found.")))},o.onerror=function(){var e=o.status?" (".concat(o.status,")"):"";n(new Error("There was an error fetching the embed code from Vimeo".concat(e,".")))},o.send()})}function g(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return console.warn(e),{}}return e}function w(e,t,n){if(e.element.contentWindow&&e.element.contentWindow.postMessage){var r={method:t};void 0!==n&&(r.value=n);var o=parseFloat(navigator.userAgent.toLowerCase().replace(/^.*msie (\d+).*$/,"$1"));8<=o&&o<10&&(r=JSON.stringify(r)),e.element.contentWindow.postMessage(r,e.origin)}}function b(n,r){var t,e=[];if((r=g(r)).event){if("error"===r.event)c(n,r.data.method).forEach(function(e){var t=new Error(r.data.message);t.name=r.data.name,e.reject(t),h(n,r.data.method,e)});e=c(n,"event:".concat(r.event)),t=r.data}else if(r.method){var o=function(e,t){var n=c(e,t);if(n.length<1)return!1;var r=n.shift();return h(e,t,r),r}(n,r.method);o&&(e.push(o),t=r.value)}e.forEach(function(e){try{if("function"==typeof e)return void e.call(n,t);e.resolve(t)}catch(e){}})}var k=new WeakMap,E=new WeakMap,Player=function(){function Player(u){var e,c=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Player),window.jQuery&&u instanceof jQuery&&(1<u.length&&window.console&&console.warn&&console.warn("A jQuery object with multiple elements was passed, using the first element."),u=u[0]),"undefined"!=typeof document&&"string"==typeof u&&(u=document.getElementById(u)),e=u,!Boolean(e&&1===e.nodeType&&"nodeName"in e&&e.ownerDocument&&e.ownerDocument.defaultView))throw new TypeError("You must pass either a valid element or a valid id.");var r=u.ownerDocument.defaultView;if("IFRAME"!==u.nodeName){var t=u.querySelector("iframe");t&&(u=t)}if("IFRAME"===u.nodeName&&!s(u.getAttribute("src")||""))throw new Error("The player element passed isn’t a Vimeo embed.");if(k.has(u))return k.get(u);this.element=u,this.origin="*";var o=new f(function(i,a){var e=function(e){if(s(e.origin)&&c.element.contentWindow===e.source){"*"===c.origin&&(c.origin=e.origin);var t=g(e.data);if(t&&"error"===t.event&&t.data&&"ready"===t.data.method){var n=new Error(t.data.message);return n.name=t.data.name,void a(n)}var r=t&&"ready"===t.event,o=t&&"ping"===t.method;if(r||o)return c.element.setAttribute("data-ready","true"),void i();b(c,t)}};if(r.addEventListener?r.addEventListener("message",e,!1):r.attachEvent&&r.attachEvent("onmessage",e),"IFRAME"!==c.element.nodeName){var t=p(u,n);m(l(t),t,u).then(function(e){var t,n,r,o=y(e,u);return c.element=o,c._originalElement=u,t=u,n=o,r=d.get(t),d.set(n,r),d.delete(t),k.set(c.element,c),e}).catch(a)}});return E.set(this,o),k.set(this.element,this),"IFRAME"===this.element.nodeName&&w(this,"ping"),this}var e,t,n;return e=Player,(t=[{key:"callMethod",value:function(n){var r=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new f(function(e,t){return r.ready().then(function(){u(r,n,{resolve:e,reject:t}),w(r,n,o)}).catch(t)})}},{key:"get",value:function(n){var r=this;return new f(function(e,t){return n=i(n,"get"),r.ready().then(function(){u(r,n,{resolve:e,reject:t}),w(r,n)}).catch(t)})}},{key:"set",value:function(n,r){var o=this;return new f(function(e,t){if(n=i(n,"set"),null==r)throw new TypeError("There must be a value to set.");return o.ready().then(function(){u(o,n,{resolve:e,reject:t}),w(o,n,r)}).catch(t)})}},{key:"on",value:function(e,t){if(!e)throw new TypeError("You must pass an event name.");if(!t)throw new TypeError("You must pass a callback function.");if("function"!=typeof t)throw new TypeError("The callback must be a function.");0===c(this,"event:".concat(e)).length&&this.callMethod("addEventListener",e).catch(function(){}),u(this,"event:".concat(e),t)}},{key:"off",value:function(e,t){if(!e)throw new TypeError("You must pass an event name.");if(t&&"function"!=typeof t)throw new TypeError("The callback must be a function.");h(this,"event:".concat(e),t)&&this.callMethod("removeEventListener",e).catch(function(e){})}},{key:"loadVideo",value:function(e){return this.callMethod("loadVideo",e)}},{key:"ready",value:function(){var e=E.get(this)||new f(function(e,t){t(new Error("Unknown player. Probably unloaded."))});return f.resolve(e)}},{key:"addCuePoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.callMethod("addCuePoint",{time:e,data:t})}},{key:"removeCuePoint",value:function(e){return this.callMethod("removeCuePoint",e)}},{key:"enableTextTrack",value:function(e,t){if(!e)throw new TypeError("You must pass a language.");return this.callMethod("enableTextTrack",{language:e,kind:t})}},{key:"disableTextTrack",value:function(){return this.callMethod("disableTextTrack")}},{key:"pause",value:function(){return this.callMethod("pause")}},{key:"play",value:function(){return this.callMethod("play")}},{key:"unload",value:function(){return this.callMethod("unload")}},{key:"destroy",value:function(){var t=this;return new f(function(e){E.delete(t),k.delete(t.element),t._originalElement&&(k.delete(t._originalElement),t._originalElement.removeAttribute("data-vimeo-initialized")),t.element&&"IFRAME"===t.element.nodeName&&t.element.parentNode&&t.element.parentNode.removeChild(t.element),e()})}},{key:"getAutopause",value:function(){return this.get("autopause")}},{key:"setAutopause",value:function(e){return this.set("autopause",e)}},{key:"getBuffered",value:function(){return this.get("buffered")}},{key:"getColor",value:function(){return this.get("color")}},{key:"setColor",value:function(e){return this.set("color",e)}},{key:"getCuePoints",value:function(){return this.get("cuePoints")}},{key:"getCurrentTime",value:function(){return this.get("currentTime")}},{key:"setCurrentTime",value:function(e){return this.set("currentTime",e)}},{key:"getDuration",value:function(){return this.get("duration")}},{key:"getEnded",value:function(){return this.get("ended")}},{key:"getLoop",value:function(){return this.get("loop")}},{key:"setLoop",value:function(e){return this.set("loop",e)}},{key:"setMuted",value:function(e){return this.set("muted",e)}},{key:"getMuted",value:function(){return this.get("muted")}},{key:"getPaused",value:function(){return this.get("paused")}},{key:"getPlaybackRate",value:function(){return this.get("playbackRate")}},{key:"setPlaybackRate",value:function(e){return this.set("playbackRate",e)}},{key:"getPlayed",value:function(){return this.get("played")}},{key:"getSeekable",value:function(){return this.get("seekable")}},{key:"getSeeking",value:function(){return this.get("seeking")}},{key:"getTextTracks",value:function(){return this.get("textTracks")}},{key:"getVideoEmbedCode",value:function(){return this.get("videoEmbedCode")}},{key:"getVideoId",value:function(){return this.get("videoId")}},{key:"getVideoTitle",value:function(){return this.get("videoTitle")}},{key:"getVideoWidth",value:function(){return this.get("videoWidth")}},{key:"getVideoHeight",value:function(){return this.get("videoHeight")}},{key:"getVideoUrl",value:function(){return this.get("videoUrl")}},{key:"getVolume",value:function(){return this.get("volume")}},{key:"setVolume",value:function(e){return this.set("volume",e)}}])&&r(e.prototype,t),n&&r(e,n),Player}();return e||(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,t=[].slice.call(e.querySelectorAll("[data-vimeo-id], [data-vimeo-url]")),n=function(e){"console"in window&&console.error&&console.error("There was an error creating an embed: ".concat(e))};t.forEach(function(t){try{if(null!==t.getAttribute("data-vimeo-defer"))return;var e=p(t);m(l(e),e,t).then(function(e){return y(e,t)}).catch(n)}catch(e){n(e)}})}(),function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document;if(!window.VimeoPlayerResizeEmbeds_){window.VimeoPlayerResizeEmbeds_=!0;var e=function(e){if(s(e.origin)&&e.data&&"spacechange"===e.data.event)for(var t=r.querySelectorAll("iframe"),n=0;n<t.length;n++)if(t[n].contentWindow===e.source){t[n].parentElement.style.paddingBottom="".concat(e.data.data[0].bottom,"px");break}};window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e)}}()),Player});
define('mod_externalvideo/script', ['jquery'], function($) {
 
    return {
               init: function(args) {
        	CONFIG = args;
			var coursemoduleid = CONFIG.cmid;
			var rootPath = M.cfg.wwwroot;
        	
        	var url=  $(location).attr('href');
        	var error = true;
        	
        	try {
        		var iframe = document.querySelector('iframe');   
				var player = new Vimeo.Player(iframe);		
        		}
        		catch(err) {
        		   error = false;
        		}
        	
        	if(url.includes('/mod/externalvideo/view.php') && error){
        		
				var iframe = document.querySelector('iframe');   
				var player = new Vimeo.Player(iframe);		
				var data = 'deafult';
				var value = 0;
				var stopajax = 0;
				var myWindow = window;

				// Invoked when Play function is triggered
				player.on('play', function() {
					player.getCurrentTime().then(function(seconds) {
					//console.log(seconds);
					data = 'play';
					value = seconds;
					
	       		   //   myWindow.focus();
	       		     
					
					if(stopajax != 1){
						//console.log('played the video!');
						ajaxcall(value,'play');
					}
					stopajax = 0;
					}).catch(function(error) {
					    // an error occurred
					});	
				 });
				
				// Invoked when Pause function is triggered
				player.on('pause', function() {
						player.getCurrentTime().then(function(seconds) {
						//console.log(seconds);
						value = seconds;
						if(stopajax != 1){
							//console.log('paused the video!');
							ajaxcall(value,'pause');
						}
						stopajax = 0;
						}).catch(function(error) {
						    // an error occurred
						});	
					 });
				

				//Invoked when moved to a certain time
				player.on('seeked', function() {
					//console.log("SEEKEED");
					player.pause().then(function() {
					    // the video was paused
					}).catch(function(error) {
					    switch (error.name) {
					        case 'PasswordError':
					            // the video is password-protected and the viewer needs to enter the
					            // password first
					            break;

					        case 'PrivacyError':
					            // the video is private
					            break;

					        default:
					            // some other error occurred
					            break;
					    }
					});
				});
				
				
				// Invoked when video reaches the end
				player.on('ended', function() {
					//console.log('Video Ended');
						player.getCurrentTime().then(function(seconds) {
						//console.log(seconds);
						value = seconds;
						ajaxcall(value,'pause');
						}).catch(function(error) {
						    // an error occurred
						});	
					 });
				
				
				/*myWindow.onblur = function() {
					 player.pause().then(function() {
						    // the video was paused
						}).catch(function(error) {
						    switch (error.name) {
						        case 'PasswordError':
						            // the video is password-protected and the viewer needs to enter the
						            // password first
						            break;

						        case 'PrivacyError':
						            // the video is private
						            break;

						        default:
						            // some other error occurred
						            break;
						    }
						});   
     		      };*/
				
				
				//Ajax call is done in this function for db value updation 
				function ajaxcall ( option,event){
					var cmid = getUrlParameter('id');
					var session = M.cfg.sesskey;
					player.getDuration().then(function(duration) {
						$.post("ajax.php", { event : event, value : option, cmid : cmid, session : session, total : duration, cmodule:coursemoduleid }).done(function( result ) {
                    		console.log("success");
                    	});
					}).catch(function(error) {
					    // an error occurred
					});
					//console.log("AJAX CALL");
				}

			    
				//Function to get the specific value from URL
				var getUrlParameter = function getUrlParameter(sParam) {
				    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
				        sURLVariables = sPageURL.split('&'),
				        sParameterName,
				        i;

				    for (i = 0; i < sURLVariables.length; i++) {
				        sParameterName = sURLVariables[i].split('=');

				        if (sParameterName[0] === sParam) {
				            return sParameterName[1] === undefined ? true : sParameterName[1];
				        }
				    }
				};
				
				// On window ready open modal
				$(document).ready(function() {
					
					var type = getUrlParameter('type');
					var start = getUrlParameter('start');
					if(type){
						videoResume();
					}else if(start == 0){
						
					}else{
						/*var existingdiv1 = '<div class="modal fade" id="confirmActionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content" id="modalContent" style="display:none; width:250px; height: 140px; left: 20%; top:100"><div class="modal-header"><h4 class="modal-title" id="confirmActionModalTitle">confirmAction</h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-primary" style="">resume</button><button type="button" class="btn btn-stop" style="">startagain</button></div></div></div></div>';
						$('#region-main-box').append(existingdiv1);*/
						$("#modalContent").css("display", "");
						$('#confirmActionModal').modal('show');
					}
					}); 
				
				// Resume video 
				$("#confirmActionModal .modal-body .btn-primary").click(function(){
					stopajax = 1;
					$('#confirmActionModal').modal('hide');
					videoResume();
				});
				
				// Start Again
				$("#confirmActionModal .modal-body .btn-stop").click(function(){
					//console.log("Start Again");
					$('#confirmActionModal').modal('hide');
					startVideo();
	        	});
				
				/*myWindow.onbeforeunload = function(){
					
					player.pause().then(function() {
					    // the video was paused
					}).catch(function(error) {
					    switch (error.name) {
					        case 'PasswordError':
					            // the video is password-protected and the viewer needs to enter the
					            // password first
					            break;

					        case 'PrivacyError':
					            // the video is private
					            break;

					        default:
					            // some other error occurred
					            break;
					    }
					});
					
				};*/
				
				
				/*window.addEventListener("beforeunload", function(event) {
					
//					var event = "pause";
//					var option = "time";
//					var cmid = getUrlParameter('id');
//					var session = M.cfg.sesskey;
//					var value = '66';
//					var duration = '144';
//					
//						$.post( "ajax.php", { event : event, value : value, cmid : cmid, session : session, total : duration }).done(function( result ) {
//                    	//	console.log(result);
//                    	});
					
					
					player.getCurrentTime().then(function(seconds) {
						//console.log(seconds);
						var event = "pause";
						var option = "time";
						var cmid = getUrlParameter('id');
						var session = M.cfg.sesskey;
							player.getDuration().then(function(duration) {
								$.post( "ajax.php", { event : event, value : value, cmid : cmid, session : session, total : duration }).done(function( result ) {
		                    	//	console.log(result);
		                    	});
							}).catch(function(error) {
							    // an error occurred
							});
						console.log("AJAX CALL");
						}).catch(function(error) {
						    // an error occurred
						});
					
					
					
				}, false);
				*/
				
				function startVideo(){
					// Invoked when Play function is triggered
					player.play().then(function() {
						player.getCurrentTime().then(function(seconds) {
						//console.log(seconds);
						data = 'play';
						value = seconds;
		       		   //   myWindow.focus();
						if(stopajax != 1){
							//console.log('played the video!');
							ajaxcall(value,'play');
						}
						stopajax = 0;
						}).catch(function(error) {
						    // an error occurred
						});	
					 });
				}
				
				function videoResume(){
					var resume = getUrlParameter('start');
			    	//console.log("resume video function");
			    	//console.log(resume);
					player.setCurrentTime(resume).then(function(seconds) {
						// Invoked when Play function is triggered
						player.on('play', function() {
							player.getCurrentTime().then(function(seconds) {
							//console.log(seconds);
							data = 'play';
							value = seconds;
			       		   //   myWindow.focus();
							if(stopajax != 1){
								//console.log('played the video!');
								ajaxcall(value,'play');
							}
							stopajax = 0;
							}).catch(function(error) {
							    // an error occurred
							});	
						 });
						/*stopajax = 1;
						player.pause().then(function() {
						    // the video was paused
						}).catch(function(error) {
						    switch (error.name) {
						        case 'PasswordError':
						            // the video is password-protected and the viewer needs to enter the
						            // password first
						            break;

						        case 'PrivacyError':
						            // the video is private
						            break;

						        default:
						            // some other error occurred
						            break;
						    }
						});*/
					    // seconds = the actual time that the player seeked to
					}).catch(function(error) {
					    switch (error.name) {
					        case 'RangeError':
					            // the time was less than 0 or greater than the video’s duration
					            break;

					        default:
					            // some other error occurred
					            break;
					    }
					});	
				}
				
        	}
        }
    };
});
define('mod_feedback/edit', ["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){var e={deleteItem:function(b){b.preventDefault();var e=a(b.currentTarget).attr("href");c.get_strings([{key:"confirmation",component:"admin"},{key:"confirmdeleteitem",component:"mod_feedback"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location=e})})["catch"]()},setup:function(){a("body").delegate('[data-action="delete"]',"click",e.deleteItem)}};return{setup:e.setup}});
define('mod_jupyterhub/script', ['jquery'], function($) {
     return {
        init: function() {
        	
    		var clickedImage = $(this);
    		var cmid = clickedImage.attr('cmid');
    		var imageid = clickedImage.attr('imageid');
    		
        	$("#page-mod-vmassignment-view .imageLink").click(function(){
        		clickedImage = $(this);
        		cmid = clickedImage.attr('cmid');
        		imageid = clickedImage.attr('imageid');
        		
        		$.post( "ajax.php", { id: cmid, imageid: imageid, action: 'checkstatus' })
        		  .done(function( result ) {
        			  //instance not created. Update message in modal and ask confirmation for creating one
        			  if ( ! result.response.status ){
        				  $('#confirmActionModal .modal-body').append( result.response.message );
        				  $('#confirmActionModal').modal('show');
        			  }
        		});
        	});
        	
        	$("#confirmActionModal .modal-footer .btn-primary").click(function(){
        		//we need to create new instance or start stopped instance or anything similar
        		
        	});
        	
            //clear modal content on click of buttons
            $( '#confirmActionModal .modal-footer button' ).click(function(){
            	$('#confirmActionModal .modal-body').text('');
            	$('#confirmActionModal').modal('hide');
            });
            
            $('#refresh').click(function(){
            	var url = document.URL;
            	var id = url.substring(url.lastIndexOf('=') + 1);
            	$('#jupytergrade').empty();
            	$('#jupytergrade').html('<img src="pix/Loading_icon.gif" style="display: block; margin-left: auto; margin-right: auto; width: 50%;"/>');
            	$.post( "ajax.php",{id : id}).done(function( result ) {
            		$('#jupytergrade').empty();
                	$('#jupytergrade').html(result);
                });
            });
        }
     
    };
});
define('mod_lti/contentitem', ["jquery","core/notification","core/str","core/templates","mod_lti/form-field","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){var h,i,j={init:function(a,e,j){i=j;var k={url:a,postData:e},l=d.render("mod_lti/contentitem",k);return h?(h.setBody(l),void h.show()):void c.get_string("selectcontent","lti").then(function(a){return f.create({title:a,body:l,large:!0})}).then(function(a){h=a,a.getRoot().on(g.hidden,function(){a.setBody(""),b.fetchNotifications()}),a.show()})["catch"](b.exception)}},k=[new e("name",e.TYPES.TEXT,(!1),""),new e("introeditor",e.TYPES.EDITOR,(!1),""),new e("toolurl",e.TYPES.TEXT,(!0),""),new e("securetoolurl",e.TYPES.TEXT,(!0),""),new e("instructorchoiceacceptgrades",e.TYPES.CHECKBOX,(!0),(!0)),new e("instructorchoicesendname",e.TYPES.CHECKBOX,(!0),(!0)),new e("instructorchoicesendemailaddr",e.TYPES.CHECKBOX,(!0),(!0)),new e("instructorcustomparameters",e.TYPES.TEXT,(!0),""),new e("icon",e.TYPES.TEXT,(!0),""),new e("secureicon",e.TYPES.TEXT,(!0),""),new e("launchcontainer",e.TYPES.SELECT,(!0),0),new e("grade_modgrade_point",e.TYPES.TEXT,(!1),""),new e("cmidnumber",e.TYPES.TEXT,(!0),"")];return window.processContentItemReturnData=function(b){h&&h.hide();var c;for(c in k){var d=k[c],e=null;"undefined"!==a.type(b[d.name])&&(e=b[d.name]),d.setFieldValue(e)}i&&i()},j});
define('mod_lti/events', [],function(){return{NEW_TOOL_TYPE:"lti.tool.type.new",START_EXTERNAL_REGISTRATION:"lti.registration.external.start",STOP_EXTERNAL_REGISTRATION:"lti.registration.external.stop",START_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.start",STOP_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.stop",REGISTRATION_FEEDBACK:"lti.registration.feedback",CAPABILITIES_AGREE:"lti.tool.type.capabilities.agree",CAPABILITIES_DECLINE:"lti.tool.type.capabilities.decline"}});
define('mod_lti/tool_type', ["core/ajax","core/notification"],function(a,b){return{query:function(c){var d={methodname:"mod_lti_get_tool_types",args:c||{}},e=a.call([d])[0];return e.fail(b.exception),e},create:function(b){var c={methodname:"mod_lti_create_tool_type",args:b},d=a.call([c])[0];return d},update:function(c){var d={methodname:"mod_lti_update_tool_type",args:c},e=a.call([d])[0];return e.fail(b.exception),e},"delete":function(c){var d={methodname:"mod_lti_delete_tool_type",args:{id:c}},e=a.call([d])[0];return e.fail(b.exception),e},getFromToolProxyId:function(a){return this.query({toolproxyid:a})},isCartridge:function(b){var c={methodname:"mod_lti_is_cartridge",args:{url:b}},d=a.call([c])[0];return d},constants:{state:{configured:1,pending:2,rejected:3}}}});
define('mod_lti/keys', [],function(){return{ENTER:13,SPACE:32}});
define('mod_lti/tool_card_controller', ["jquery","core/ajax","core/notification","core/templates","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g,h){var i={DELETE_BUTTON:".delete",NAME_ELEMENT:".name",DESCRIPTION_ELEMENT:".description",CAPABILITIES_CONTAINER:".capabilities-container",ACTIVATE_BUTTON:".tool-card-footer a.activate"},j=2e3,k=function(a){return a.find(i.DELETE_BUTTON)},l=function(a){return a.find(i.NAME_ELEMENT)},m=function(a){return a.find(i.DESCRIPTION_ELEMENT)},n=function(a){return a.find(i.ACTIVATE_BUTTON)},o=function(a){return!!n(a).length},p=function(a){return a.find(i.CAPABILITIES_CONTAINER)},q=function(a){return!!p(a).length},r=function(a){return a.attr("data-type-id")},s=function(a){a.removeClass("announcement loading success fail capabilities")},t=function(a){s(a),a.addClass("announcement loading")},u=function(a){a.removeClass("announcement loading")},v=function(b){var c=a.Deferred();return s(b),b.addClass("announcement success"),setTimeout(function(){b.removeClass("announcement success"),c.resolve()},j),c},w=function(b){var c=a.Deferred();return s(b),b.addClass("announcement fail"),setTimeout(function(){b.removeClass("announcement fail"),c.resolve()},j),c},x=function(b){var d=a.Deferred(),f=r(b);return t(b),""===f?a.Deferred().resolve():(h.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done(function(a){c.confirm(a[0],a[1],a[2],a[3],function(){e["delete"](f).done(function(){u(b),v(b).done(function(){b.remove()}).fail(c.exception).always(function(){d.resolve()})}).fail(function(a){w(b),d.reject(a)})},function(){u(b),d.resolve()})}).fail(function(a){u(b),c.exception(a),d.reject(a)}),d)},y=function(a,b){a.attr("data-val-snapshot",b)},z=function(a){return a.attr("data-val-snapshot")},A=function(a){var b=m(a);if(!b.hasClass("loading")){var c=b.text().trim();y(b,c)}},B=function(b){var d=r(b);if(""===d)return a.Deferred().resolve();var f=m(b);if(f.hasClass("loading"))return a.Deferred().resolve();var g=f.text().trim(),h=z(f);if(h==g)return a.Deferred().resolve();f.addClass("loading");var i=e.update({id:d,description:g});return i.done(function(a){f.removeClass("loading"),f.text(a.description)}).fail(c.exception),i.fail(function(){f.removeClass("loading")}),i},C=function(a){var b=l(a);if(!b.hasClass("loading")){var c=b.text().trim();y(b,c)}},D=function(b){var c=r(b);if(""===c)return a.Deferred().resolve();var d=l(b);if(d.hasClass("loading"))return a.Deferred().resolve();var f=d.text().trim(),g=z(d);if(g==f)return a.Deferred().resolve();d.addClass("loading");var h=e.update({id:c,name:f});return h.done(function(a){d.removeClass("loading"),d.text(a.name)}),h.fail(function(){d.removeClass("loading")}),h},E=function(b){var c=r(b);if(""===c)return a.Deferred().resolve();t(b);var f=e.update({id:c,state:e.constants.state.configured});return f.then(function(a){return u(b),v(b),a}).then(function(a){return d.render("mod_lti/tool_card",a)}).then(function(a){var c=a[0],e=a[1];d.replaceNode(b,c,e)})["catch"](function(){u(b),w(b)}),f},F=function(a){a.addClass("announcement capabilities")},G=function(a){a.removeClass("announcement capabilities")},H=function(a){q(a)?F(a):E(a)},I=function(a){var b=k(a);b.click(function(b){b.preventDefault(),x(a)}),b.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),b.click())});var c=m(a);c.focus(function(b){b.preventDefault(),A(a)}),c.blur(function(b){b.preventDefault(),B(a)}),c.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode==g.ENTER&&(a.preventDefault(),c.blur())});var d=l(a);if(d.focus(function(b){b.preventDefault(),C(a)}),d.blur(function(b){b.preventDefault(),D(a)}),d.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode==g.ENTER&&(a.preventDefault(),d.blur())}),o(a)){var e=n(a);e.click(function(b){b.preventDefault(),H(a)}),e.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),e.click())})}if(q(a)){var h=p(a);h.on(f.CAPABILITIES_AGREE,function(){E(a)}),h.on(f.CAPABILITIES_DECLINE,function(){G(a)})}};return{init:function(a){I(a)}}});
define('mod_lti/form-field', ["jquery"],function(a){var b=function(a,b,c,d){this.name=a,this.id="id_"+this.name,this.selector="#"+this.id,this.type=b,this.resetIfUndefined=c,this.defaultValue=d};return b.TYPES={TEXT:1,SELECT:2,CHECKBOX:3,EDITOR:4},b.prototype.setFieldValue=function(c){if(null===c){if(!this.resetIfUndefined)return;c=this.defaultValue}switch(this.type){case b.TYPES.CHECKBOX:c?a(this.selector).prop("checked",!0):a(this.selector).prop("checked",!1);break;case b.TYPES.EDITOR:if("undefined"!==a.type(c.text)){var d=a(this.selector+"editable");d.length?d.html(c.text):"undefined"!=typeof tinyMCE&&tinyMCE.execInstanceCommand(this.id,"mceInsertContent",!1,c.text),a(this.selector).val(c.text)}break;default:a(this.selector).val(c)}},b});
define('mod_lti/external_registration_return', [],function(){return{init:function(a,b,c,d){window.parent&&window.parent.triggerExternalRegistrationComplete({message:a,error:b,id:c,status:d})}}});
define('mod_lti/external_registration', ["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/tool_proxy","mod_lti/tool_type","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g,h,i){var j={EXTERNAL_REGISTRATION_CONTAINER:"#external-registration-page-container",EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER:"#external-registration-template-container",EXTERNAL_REGISTRATION_CANCEL_BUTTON:"#cancel-external-registration",TOOL_TYPE_CAPABILITIES_CONTAINER:"#tool-type-capabilities-container",TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER:"#tool-type-capabilities-template-container",CAPABILITIES_AGREE_CONTAINER:".capabilities-container"},k=function(){return a(j.EXTERNAL_REGISTRATION_CANCEL_BUTTON)},l=function(){return a(j.EXTERNAL_REGISTRATION_CONTAINER)},m=function(){return a(j.EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER)},n=function(){return a(j.TOOL_TYPE_CAPABILITIES_CONTAINER)},o=function(){return a(j.TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER)},p=function(){n().addClass("loading")},q=function(){n().removeClass("loading")},r=function(){k().addClass("loading")},s=function(){k().removeClass("loading")},t=function(){n().addClass("hidden")},u=function(){n().removeClass("hidden")},v=function(){l().addClass("hidden")},w=function(){l().removeClass("hidden")},x=function(a){var b=k();b.attr("data-tool-proxy-id",a)},y=function(){var a=k();return a.attr("data-tool-proxy-id")},z=function(){var a=k();a.removeAttr("data-tool-proxy-id")},A=function(){return!!y()},B=function(){var a=k();return a.attr("data-tool-proxy-new")&&A()},C=function(){var a=k();return a.attr("data-tool-proxy-new","new")},D=function(){var a=k();return a.removeAttr("data-tool-proxy-new")},E=function(a){var c={methodname:"mod_lti_get_tool_proxy_registration_request",args:{id:a}};return b.call([c])[0]},F=function(){r();var b=a.Deferred();if(B()){var d=y();f["delete"](d).done(function(){b.resolve()}).fail(function(a){b.reject(a)})}else b.resolve();return b.done(function(){L(),s()}).fail(function(b){c.exception(b),L(),s(),i.get_string("failedtodeletetoolproxy","mod_lti").done(function(b){var c={message:b,error:!0};a(document).trigger(e.REGISTRATION_FEEDBACK,c)}).fail(c.exception)}),b},G=function(a){var b=d.render("mod_lti/tool_proxy_registration_form",a);return b.done(function(a,b){var c=m();c.append(a),d.runTemplateJS(b),c.find("form").submit(),w()}).fail(c.exception),b},H=function(a){return g.update({id:a.id,state:g.constants.state.configured})},I=function(b){var f=a.Deferred();return d.render("mod_lti/tool_type_capabilities_agree",b).done(function(a,c){var g=o();v(),u(),d.replaceNodeContents(g,a,c);var h=g.find(j.CAPABILITIES_AGREE_CONTAINER);h.on(e.CAPABILITIES_AGREE,function(){p(),H(b).always(function(){q(),g.empty(),f.resolve()})}),h.on(e.CAPABILITIES_DECLINE,function(){g.empty(),f.resolve()})}).fail(f.reject),f.done(function(){t()}).fail(c.exception),f},J=function(b){var c=a.Deferred();return b&&""!==b?f.create({regurl:b}).done(function(a){C(),c=K(a.id)}).fail(function(b){F();var d={message:b.message,error:!0};a(document).trigger(e.REGISTRATION_FEEDBACK,d),c.reject(b)}):c.resolve(),c},K=function(b){var c=a.Deferred();return x(b),E(b).done(function(a){G(a).done(function(){c.resolve()}).fail(c.fail)}).fail(c.fail),c},L=function(){A()&&z(),D(!1),v();var b=m();b.empty(),a(document).trigger(e.STOP_EXTERNAL_REGISTRATION)},M=function(){a(document).on(e.START_EXTERNAL_REGISTRATION,function(a,b){b&&(b.url&&J(b.url),b.proxyid&&K(b.proxyid))});var b=k();b.click(function(a){a.preventDefault(),F()}),b.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=h.ENTER&&a.keyCode!=h.SPACE||(a.preventDefault(),F())}),window.triggerExternalRegistrationComplete=function(b){var d=a.Deferred(),f={message:"",error:!1};if("success"==b.status){if(i.get_string("successfullycreatedtooltype","mod_lti").done(function(a){f.message=a}).fail(c.exception),d.done(function(){L(),a(document).trigger(e.REGISTRATION_FEEDBACK,f),a(document).trigger(e.NEW_TOOL_TYPE)}).fail(c.exception),B()){var h=y();g.getFromToolProxyId(h).done(function(a){if(a&&a.length){var b=a[0];b.hascapabilitygroups?I(b).always(function(){d.resolve()}):d.resolve()}else d.resolve()}).fail(function(){d.resolve()})}}else f.message=b.error,f.error=!0,d.done(function(){F().always(function(){a(document).trigger(e.REGISTRATION_FEEDBACK,f)})}).fail(c.exception),d.resolve();return d}};return{init:function(){M()}}});
define('mod_lti/tool_proxy_card_controller', ["jquery","core/ajax","core/notification","core/templates","mod_lti/tool_proxy","mod_lti/events","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g,h){var i={DELETE_BUTTON:".delete",CAPABILITIES_CONTAINER:".capabilities-container",ACTIVATE_BUTTON:".tool-card-footer a.activate"},j=2e3,k=function(a){return a.find(i.DELETE_BUTTON)},l=function(a){return a.find(i.ACTIVATE_BUTTON)},m=function(a){return a.attr("data-proxy-id")},n=function(a){a.removeClass("announcement loading success fail capabilities")},o=function(a){n(a),a.addClass("announcement loading")},p=function(a){a.removeClass("announcement loading")},q=function(b){var c=a.Deferred();return n(b),b.addClass("announcement success"),setTimeout(function(){b.removeClass("announcement success"),c.resolve()},j),c},r=function(b){var c=a.Deferred();return n(b),b.addClass("announcement fail"),setTimeout(function(){b.removeClass("announcement fail"),c.resolve()},j),c},s=function(b){var d=a.Deferred(),f=m(b);return o(b),""===f?a.Deferred().resolve():(h.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done(function(a){c.confirm(a[0],a[1],a[2],a[3],function(){e["delete"](f).done(function(){p(b),q(b).done(function(){b.remove(),d.resolve()}).fail(c.exception)}).fail(function(a){r(b),d.reject(a)})},function(){p(b),d.resolve()})}).fail(function(a){p(b),c.exception(a),d.reject(a)}),d)},t=function(b){var c={proxyid:m(b)};a(document).trigger(f.START_EXTERNAL_REGISTRATION,c)},u=function(a){var b=k(a);b.click(function(b){b.preventDefault(),s(a)}),b.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),b.click())});var c=l(a);c.click(function(b){b.preventDefault(),t(a)}),c.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),c.click())})};return{init:function(a){u(a)}}});
define('mod_lti/tool_configure_controller', ["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/keys","mod_lti/tool_type","mod_lti/tool_proxy","core/str"],function(a,b,c,d,e,f,g,h,i){var j={EXTERNAL_REGISTRATION_CONTAINER:"#external-registration-container",EXTERNAL_REGISTRATION_PAGE_CONTAINER:"#external-registration-page-container",CARTRIDGE_REGISTRATION_CONTAINER:"#cartridge-registration-container",CARTRIDGE_REGISTRATION_FORM:"#cartridge-registration-form",ADD_TOOL_FORM:"#add-tool-form",TOOL_LIST_CONTAINER:"#tool-list-container",TOOL_CREATE_BUTTON:"#tool-create-button",REGISTRATION_CHOICE_CONTAINER:"#registration-choice-container",TOOL_URL:"#tool-url"},k=function(){return a(j.TOOL_CREATE_BUTTON)},l=function(){return a(j.TOOL_LIST_CONTAINER)},m=function(){return a(j.EXTERNAL_REGISTRATION_CONTAINER)},n=function(){return a(j.CARTRIDGE_REGISTRATION_CONTAINER)},o=function(){return a(j.REGISTRATION_CHOICE_CONTAINER)},p=function(){return a(j.TOOL_URL).val()},q=function(){m().addClass("hidden")},r=function(){n().addClass("hidden")},s=function(){o().addClass("hidden")},t=function(){r(),s(),m().removeClass("hidden"),w(m())},u=function(a){q(),s();var b=n();b.find("input").val(""),b.removeClass("hidden"),b.find(j.CARTRIDGE_REGISTRATION_FORM).attr("data-cartridge-url",a),w(b)},v=function(){q(),r(),o().removeClass("hidden"),w(o())},w=function(a){var b=a.children().detach();b.appendTo(a)},x=function(){l().addClass("hidden")},y=function(){l().removeClass("hidden")},z=function(a){var b=a.error?"error":"success";c.addNotification({message:a.message,type:b})},A=function(a){a.addClass("loading")},B=function(a){a.removeClass("loading")},C=function(){var b=a.Deferred(),e=l();A(e),a.when(g.query(),h.query({orphanedonly:!0})).done(function(a,c){d.render("mod_lti/tool_list",{tools:a,proxies:c}).done(function(a,c){e.empty(),e.append(a),d.runTemplateJS(c),b.resolve()}).fail(b.reject)}).fail(b.reject),b.fail(c.exception).always(function(){B(e)})},D=function(){var b=a.trim(p());if(""===b)return a.Deferred().resolve();var d=k();A(d);var f=g.isCartridge(b);return f.always(function(){B(d)}),f.done(function(c){c.iscartridge?(a(j.TOOL_URL).val(""),a(document).trigger(e.START_CARTRIDGE_REGISTRATION,b)):a(document).trigger(e.START_EXTERNAL_REGISTRATION,{url:b})}),f.fail(function(){i.get_string("errorbadurl","mod_lti").done(function(b){a(document).trigger(e.REGISTRATION_FEEDBACK,{message:b,error:!0})}).fail(c.exception)}),f},E=function(){a(document).on(e.NEW_TOOL_TYPE,function(){C()}),a(document).on(e.START_EXTERNAL_REGISTRATION,function(){t(),a(j.TOOL_URL).val(""),x()}),a(document).on(e.STOP_EXTERNAL_REGISTRATION,function(){y(),v()}),a(document).on(e.START_CARTRIDGE_REGISTRATION,function(a,b){u(b)}),a(document).on(e.STOP_CARTRIDGE_REGISTRATION,function(){n().find(j.CARTRIDGE_REGISTRATION_FORM).removeAttr("data-cartridge-url"),v()}),a(document).on(e.REGISTRATION_FEEDBACK,function(a,b){z(b)});var b=a(j.ADD_TOOL_FORM);b.submit(function(a){a.preventDefault(),D()})};return{init:function(){E(),C()}}});
define('mod_lti/contentitem_return', ["jquery"],function(a){return{init:function(b){a(window).ready(function(){window!=top?parent.processContentItemReturnData(b):window.processContentItemReturnData(b)})}}});
define('mod_lti/cartridge_registration_form', ["jquery","core/ajax","core/notification","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g){var h={CARTRIDGE_URL:"#cartridge-url",CONSUMER_KEY:"#registration-key",SHARED_SECRET:"#registration-secret",REGISTRATION_FORM:"#cartridge-registration-form",REGISTRATION_SUBMIT_BUTTON:"#cartridge-registration-submit",REGISTRATION_CANCEL_BUTTON:"#cartridge-registration-cancel"},i=function(){return a(h.REGISTRATION_FORM).attr("data-cartridge-url")},j=function(){return a(h.REGISTRATION_SUBMIT_BUTTON)},k=function(){return a(h.REGISTRATION_CANCEL_BUTTON)},l=function(){return a(h.CONSUMER_KEY).val()},m=function(){return a(h.SHARED_SECRET).val()},n=function(){j().addClass("loading")},o=function(){j().removeClass("loading")},p=function(){return j().hasClass("loading")},q=function(){if(p())return!1;var b=i();if(""===b)return!1;n();var f=l(),h=m(),j=d.create({cartridgeurl:b,key:f,secret:h});return j.done(function(){g.get_string("successfullycreatedtooltype","mod_lti").done(function(b){a(document).trigger(e.NEW_TOOL_TYPE),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION),a(document).trigger(e.REGISTRATION_FEEDBACK,{message:b})}).fail(c.exception)}).fail(function(){g.get_string("failedtocreatetooltype","mod_lti").done(function(b){a(document).trigger(e.NEW_TOOL_TYPE),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION),a(document).trigger(e.REGISTRATION_FEEDBACK,{message:b,error:!0})}).fail(c.exception)}).always(function(){o()}),j},r=function(){var b=a(h.REGISTRATION_FORM);b.submit(function(a){a.preventDefault(),q()});var c=k();c.click(function(b){b.preventDefault(),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION)}),c.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=f.ENTER&&a.keyCode!=f.SPACE||(a.preventDefault(),c.click())})};return{init:function(){r()}}});
define('mod_lti/tool_proxy', ["core/ajax","core/notification"],function(a,b){return{query:function(c){var d={methodname:"mod_lti_get_tool_proxies",args:c||{}},e=a.call([d])[0];return e.fail(b.exception),e},"delete":function(c){var d={methodname:"mod_lti_delete_tool_proxy",args:{id:c}},e=a.call([d])[0];return e.fail(b.exception),e},create:function(b){var c={methodname:"mod_lti_create_tool_proxy",args:b},d=a.call([c])[0];return d}}});


define('mod_projecthosting/script', ['jquery'], function($) {
    return {
       init: function() {
     
        var cells = document.getElementsByClassName("elipcell");

        for(let index = 0; index < cells.length; ++index) {
          let cell = cells.item(index);
          cell.addEventListener('mouseenter', setTitleIfNecessary, false);
        }
      
        function setTitleIfNecessary() {
          if(this.offsetWidth < this.scrollWidth) {
            this.setAttribute('title', this.innerHTML);
          }
        }


$("#btnEndStep1").click(function () {
    $("#step1").addClass('hideMe');
    $("#step2").removeClass('hideMe');
});
$("#btnEndStep2").click(function () {
    $("#step1").removeClass('hideMe');
    $("#step2").addClass('hideMe');    
});

$("#cancel").click(function () {
  window.close();
});
$("#cancelassign").click(function () {
  $("#projectModal").modal("hide");
});
$("#closeproj").click(function () {
  window.opener.location.reload(true);
  window.close();
});
$("#openmod").click(function () {
  $("#projectModal").modal("show");
});
$("#choseproject").click(function () {
  $project=$("input[name='choseradio']:checked").val();
  $projecttext=$("input[name='choseradio']:checked").parent().text();
  $('#namehelp').val($projecttext);
  $('#namehelp').attr('name',  $project);
  $("#projectModal").modal("hide");

});
$("#createproject").click(function () {
  $cmid=$("#cmid").val();
  $moduleid=$("#actid").val();
  var redirecturl=M.cfg.wwwroot+"/mod/projecthosting/addproject.php?cmid="+$cmid+"&module="+$moduleid;
  window.open(redirecturl);
});
$("#project").unbind('click');
 $("#project").click(function () {
    $teamid=$("#team").val();
    $start=$("#start_date").val();
    $end=$("#end_date").val();
    $ins=$("#ins").val();
    $project=$("#namehelp").attr('name');
    $guide=$('#git-users').val();
    $course=$("#course").attr("value");
    if($start==''){
      alert('Please provide start date');

    }
    else if($end==''){
      alert( 'Please provide end date');

    }
    else if($project==''){
      alert('Please select a project');

    }
    else if($guide==''){
      alert('Please select guide for project');

    }
    else{

    $.post( "ajax.php", { action: 'create', teamid: $teamid,start:$start,end:$end, project: $project,guide:$guide,ins:$ins,course:$course })
                 .done(function( result ) {
                   console.log(result);
                 
                   if(result.includes("ERROR")){
                    document.getElementById("error").innerHTML = 'Error : Project/User Creation Interrupted please try again..';

                   }
                   else{
                    alert("Project Assigned Successfully");
                    window.opener.location.reload(true);
                                        window.close();
                    
                   }
               });
              }
});
// $("#promodal").click(function () {
//     $vals=$(this).attr("value");
//     var redirecturl=M.cfg.wwwroot+"/mod/projecthosting/assignproject.php?teamid="+$vals;
//     window.open(redirecturl);

// });

  
  $('#guidebody').on('click', '.clickable', function(){
    $id=$(this).attr("value");
    $ins=$("#instanceid").attr("value");
    var redirecturl=M.cfg.wwwroot+"/mod/projecthosting/projectsummary.php?id="+$ins+"&projectid="+$id;
    location.replace(redirecturl); 
  });

  $("#assigntd").unbind('click');
$('#assigntd').on('click', '#promodal', function(){
  $vals=$(this).attr("value");
  $ins=$("#instance").attr("value");
   $course=$("#course").attr("value");
  var redirecturl=M.cfg.wwwroot+"/mod/projecthosting/assignproject.php?teamid="+$vals+"&instance="+$ins+"&course="+ $course;
  window.open(redirecturl);
});

$("#searchInput").click(function(){
 
var  namesrc = $("#name_srch").val().toUpperCase();
var  descsrc = $("#desc_srch").val().toUpperCase();
var  category = $( "#git-cat option:selected" ).text().toUpperCase();
if(namesrc =='' && descsrc =='' && category==''){

}
else{
var isempty=true;

$(".fbody tr").each(function() {
var row = $(this);
var name = row.find("td").eq(0).text();
var desc = row.find("td").eq(1).text();
var cate = row.find("td").eq(2).text();


//show all rows by default
var show = true;



if(name.toUpperCase().indexOf(namesrc) < 0){
show = false;
}
if(desc.toUpperCase().indexOf(descsrc) < 0){
  show = false;
  }
  if(cate.toUpperCase().indexOf(category) < 0){
    show = false;
    }
if (show){
row.show();
isempty=false;
}
else{
row.hide();
}
});
if(isempty){

$(".no-records").show();
}
}
});

$("#Reset").click(function(){
  $(".fbody tr").each(function() {
    var row = $(this);
      row.show();
    });
    $("#name_srch").val("");
    $("#desc_srch").val(null);
   
  });	



}
     
};
});
define('mod_quiz/quizquestionbank', ["mod_quiz/add_question_modal_launcher","mod_quiz/modal_quiz_question_bank"],function(a,b){return{init:function(c){a.init(b.TYPE,'.menu [data-action="questionbank"]',c)}}});
define('mod_quiz/random_question_form_preview', ["jquery","core/ajax","core/str","core/notification","core/templates","core/paged_content_factory"],function(a,b,c,d,e,f){var g=5,h="mod_quiz/random_question_form_preview_question_list",i={LOADING_ICON_CONTAINER:'[data-region="overlay-icon-container"]',QUESTION_COUNT_CONTAINER:'[data-region="question-count-container"]',QUESTION_LIST_CONTAINER:'[data-region="question-list-container"]'},j=function(a){a.find(i.LOADING_ICON_CONTAINER).removeClass("hidden")},k=function(a){a.find(i.LOADING_ICON_CONTAINER).addClass("hidden")},l=function(a,b){c.get_string("questionsmatchingfilter","mod_quiz",b).then(function(b){a.find(i.QUESTION_COUNT_CONTAINER).html(b)}).fail(d.exception)},m=function(a,c,d,e,f,g){var h={methodname:"core_question_get_random_question_summaries",args:{categoryid:a,includesubcategories:c,tagids:d,contextid:e,limit:f,offset:g}};return b.call([h])[0]},n=function(a,b,c,i,j,k){return f.createFromAjax(j,g,function(f){return f.map(function(f){var g=f.limit,j=f.offset;return 0==j?e.render(h,{questions:k}):m(a,b,c,i,g,j).then(function(a){var b=a.questions;return e.render(h,{questions:b})}).fail(d.exception)})})},o=function(b,c,f,h,o){return j(b),m(c,f,h,o,g,0).then(function(a){var c=a.totalcount;return l(b,c),a}).then(function(b){var d=b.totalcount,e=b.questions;return e.length?n(c,f,h,o,d,e):a.Deferred().resolve("","")}).then(function(a,c){var d=b.find(i.QUESTION_LIST_CONTAINER);e.replaceNodeContents(d,a,c)}).always(function(){k(b)}).fail(d.exception)};return{reload:o,showLoadingIcon:j,hideLoadingIcon:k}});
define('mod_quiz/add_random_form', ["jquery","mod_quiz/random_question_form_preview"],function(a,b){var c=2e3,d={PREVIEW_CONTAINER:'[data-region="random-question-preview-container"]',CATEGORY_FORM_ELEMENT:'[name="category"]',SUBCATEGORY_FORM_ELEMENT:'[name="includesubcategories"]',TAG_IDS_FORM_ELEMENT:'[name="fromtags[]"]'},e=function(a){return a.find(d.CATEGORY_FORM_ELEMENT).val()},f=function(a){var b=e(a),c=b.split(",");return c[0]},g=function(a,b){var c=e(a);return b.indexOf(c)>-1},h=function(a,b){return!!g(a,b)||a.find(d.SUBCATEGORY_FORM_ELEMENT).is(":checked")},i=function(a){var b=a.find(d.TAG_IDS_FORM_ELEMENT).val();return b.map(function(a){var b=a.split(",");return b[0]})},j=function(a,c,e){var g=a.find(d.PREVIEW_CONTAINER);b.reload(g,f(a),h(a,e),i(a),c)},k=function(a){return a.closest(d.CATEGORY_FORM_ELEMENT).length>0||(a.closest(d.SUBCATEGORY_FORM_ELEMENT).length>0||a.closest(d.TAG_IDS_FORM_ELEMENT).length>0)},l=function(d,e,f){var g=null;d.on("change",function(h){k(a(h.target))&&(b.showLoadingIcon(d),g&&clearTimeout(g),g=setTimeout(function(){j(d,e,f)},c))})},m=function(b,c,d,e){if(1==e){var f=a("#"+b);j(f,c,d,e),l(f,c,d,e)}};return{init:m}});
define('mod_quiz/add_random_question', ["mod_quiz/add_question_modal_launcher","mod_quiz/modal_add_random_question"],function(a,b){return{init:function(c,d,e,f){a.init(b.TYPE,'.menu [data-action="addarandomquestion"]',c,function(a,b){b.setCategory(d),b.setReturnUrl(e),b.setCMID(f)})}}});
define('mod_quiz/preflightcheck', ["jquery","core/yui"],function(a,b){var c={confirmDialogue:null,init:function(a,d,e,f){var g=a;b.use("moodle-core-notification",function(){b.one(e)&&(c.confirmDialogue=new M.core.dialogue({headerContent:d,bodyContent:b.one(e),draggable:!0,visible:!1,center:!0,modal:!0,width:null,extraClasses:["mod_quiz_preflight_popup"]}),b.one(a).on("click",c.displayDialogue),b.one("#id_cancel").on("click",c.hideDialogue),g=c.confirmDialogue.get("boundingBox").one('[name="submitbutton"]')),f&&b.one(g).on("click",c.launchQuizPopup,c,f)})},displayDialogue:function(a){a&&a.halt(),c.confirmDialogue.show()},hideDialogue:function(a){a&&a.halt(),c.confirmDialogue.hide(a)},launchQuizPopup:function(a,c){a.halt(),b.use("moodle-core-formchangechecker","io-form",function(){M.core_formchangechecker.reset_form_dirty_state();var d=a.target.ancestor("form");window.openpopup(a,{url:d.get("action")+"?"+b.IO.stringify(d).replace(/\bcancel=/,"x="),windowname:"quizpopup",options:c,fullscreen:!0})})}};return c});
define('mod_quiz/modal_quiz_question_bank', ["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment"],function(a,b,c,d,e,f,g){var h=!1,i={ADD_TO_QUIZ_CONTAINER:"td.addtoquizaction",ANCHOR:"a[href]",PREVIEW_CONTAINER:"td.previewaction",SEARCH_OPTIONS:"#advancedsearch",DISPLAY_OPTIONS:"#displayoptions",ADD_QUESTIONS_FORM:'form[action="edit.php"]'},j=function(a){d.call(this,a),this.contextId=null,this.addOnPageId=null};return j.TYPE="mod_quiz-quiz-question-bank",j.prototype=Object.create(d.prototype),j.prototype.constructor=j,j.prototype.setContextId=function(a){this.contextId=a},j.prototype.getContextId=function(){return this.contextId},j.prototype.setAddOnPageId=function(a){this.addOnPageId=a},j.prototype.getAddOnPageId=function(){return this.addOnPageId},j.prototype.show=function(){return this.reloadBodyContent(window.location.search),d.prototype.show.call(this)},j.prototype.reloadBodyContent=function(a){var b=g.loadFragment("mod_quiz","quiz_question_bank",this.getContextId(),{querystring:a}).fail(c.exception);this.setBody(b)},j.prototype.handleAddToQuizEvent=function(a,b){var c=b.attr("href")+"&addonpage="+this.getAddOnPageId();b.attr("href",c)},j.prototype.handlePreviewContainerEvent=function(a,b){var c=["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"];window.openpopup(a,{url:b.attr("href"),name:"questionpreview",options:c.join(",")})},j.prototype.handleDisplayOptionFormEvent=function(b){b.stopPropagation(),b.preventDefault();var c=a(b.target).closest(i.DISPLAY_OPTIONS),d="?"+c.serialize();this.reloadBodyContent(d)},j.prototype.registerDisplayOptionListeners=function(){this.getModal().on("change",i.DISPLAY_OPTIONS,function(b){var c=a(b.target);c.attr("aria-autocomplete")||this.handleDisplayOptionFormEvent(b)}.bind(this)),this.getModal().on("submit",i.DISPLAY_OPTIONS,function(a){this.handleDisplayOptionFormEvent(a)}.bind(this))},j.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.registerDisplayOptionListeners(),this.getModal().on("submit",i.ADD_QUESTIONS_FORM,function(b){var c=a(b.currentTarget);a("<input />").attr("type","hidden").attr("name","addonpage").attr("value",this.getAddOnPageId()).appendTo(c)}.bind(this)),this.getModal().on("click",i.ANCHOR,function(b){var c=a(b.currentTarget);return c.closest(i.ADD_TO_QUIZ_CONTAINER).length?void this.handleAddToQuizEvent(b,c):c.closest(i.PREVIEW_CONTAINER).length?void this.handlePreviewContainerEvent(b,c):void(c.closest(i.SEARCH_OPTIONS).length||(b.preventDefault(),this.reloadBodyContent(c.prop("search"))))}.bind(this)),this.getRoot().on(e.bodyRendered,function(){b.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})})},h||(f.register(j.TYPE,j,"core/modal"),h=!0),j});
define('mod_quiz/modal_add_random_question', ["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment","core/templates"],function(a,b,c,d,e,f,g,h){var i=!1,j={EXISTING_CATEGORY_CONTAINER:'[data-region="existing-category-container"]',EXISTING_CATEGORY_FORM_ELEMENT:"#id_existingcategoryheader",NEW_CATEGORY_CONTAINER:'[data-region="new-category-container"]',NEW_CATEGORY_FORM_ELEMENT:"#id_newcategoryheader",TAB_CONTENT:'[data-region="tab-content"]',ADD_ON_PAGE_FORM_ELEMENT:'[name="addonpage"]',SUBMIT_BUTTON_ELEMENT:'input[type="submit"]',CANCEL_BUTTON_ELEMENT:'input[type="submit"][name="cancel"]',FORM_HEADER:"legend",BUTTON_CONTAINER:".fitem"},k=function(a){d.call(this,a),this.contextId=null,this.addOnPageId=null,this.category=null,this.returnUrl=null,this.cmid=null,this.loadedForm=!1};return k.TYPE="mod_quiz-quiz-add-random-question",k.prototype=Object.create(d.prototype),k.prototype.constructor=k,k.prototype.setContextId=function(a){this.contextId=a},k.prototype.getContextId=function(){return this.contextId},k.prototype.setAddOnPageId=function(a){this.addOnPageId=a,this.getBody().find(j.ADD_ON_PAGE_FORM_ELEMENT).val(a)},k.prototype.getAddOnPageId=function(){return this.addOnPageId},k.prototype.setCategory=function(a){this.category=a},k.prototype.getCategory=function(){return this.category},k.prototype.setReturnUrl=function(a){this.returnUrl=a},k.prototype.getReturnUrl=function(){return this.returnUrl},k.prototype.setCMID=function(a){this.cmid=a},k.prototype.getCMID=function(){return this.cmid},k.prototype.moveFormElementIntoTab=function(b,c){var d=b.find(j.SUBMIT_BUTTON_ELEMENT),e=a('<div class="modal-footer m-t-1" data-region="footer"></div>');b.find(j.FORM_HEADER).addClass("hidden"),b.wrap(c),d.closest(j.BUTTON_CONTAINER).remove(),d.appendTo(e),e.appendTo(b)},k.prototype.moveTabsIntoTabContent=function(a){var b=this.getBody().find(j.TAB_CONTENT).empty();a.find('[role="tabpanel"]').wrapAll(b)},k.prototype.moveCancelButtonToTabs=function(a){var b=a.find(j.CANCEL_BUTTON_ELEMENT).addClass("m-l-1"),c=a.find('[data-region="footer"]');b.closest(j.BUTTON_CONTAINER).remove(),b.clone().appendTo(c)},k.prototype.loadForm=function(){return g.loadFragment("mod_quiz","add_random_question_form",this.getContextId(),{addonpage:this.getAddOnPageId(),cat:this.getCategory(),returnurl:this.getReturnUrl(),cmid:this.getCMID()}).then(function(b,c){var d=a(b),e=d.find(j.EXISTING_CATEGORY_FORM_ELEMENT),f=this.getBody().find(j.EXISTING_CATEGORY_CONTAINER),g=d.find(j.NEW_CATEGORY_FORM_ELEMENT),i=this.getBody().find(j.NEW_CATEGORY_CONTAINER);this.moveFormElementIntoTab(e,f),this.moveFormElementIntoTab(g,i),this.moveTabsIntoTabContent(d),this.moveCancelButtonToTabs(d),h.replaceNode(this.getBody().find(j.TAB_CONTENT),d,c)}.bind(this)).then(function(){b.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})}).fail(c.exception)},k.prototype.show=function(){d.prototype.show.call(this),this.loadedForm||(this.loadForm(),this.loadedForm=!0)},i||(f.register(k.TYPE,k,"mod_quiz/modal_add_random_question"),i=!0),k});
define('mod_quiz/add_question_modal_launcher', ["jquery","core/notification","core/modal_factory"],function(a,b,c){return{init:function(d,e,f,g){var h=a("body");return c.create({type:d,large:!0,preShowCallback:function(b,c){b=a(b),c.setContextId(f),c.setAddOnPageId(b.attr("data-addonpage")),c.setTitle(b.attr("data-header")),g&&g(b,c)}},[h,e]).fail(b.exception)}}});
define('mod_subsection/collapse_subsection', ["jquery"],function(t){return{init:function(){var n=null;if(t("#region-main .editing_move").length>0)throw t(".activity.subsection.modtype_subsection a").attr("href","#"),new Error("Lets not proceed further with subsection");t(document).ready(function(){t(".activity.subsection.modtype_subsection a").attr("href","#")}),t("#page-course-view-topics").on("click",".editing_hide",function(){var n=t(this).attr("href").substring(t(this).attr("href").lastIndexOf("=")+1);if(t("#module-"+n).hasClass("modtype_subsection")){var e=t("#module-"+n),i=0;for((s=e.find('[class^="mod-indent mod-indent-"]').attr("class"))&&(i=s.substring(s.length-1,s.length));e.next().has('[class^="mod-indent mod-indent-"]').length;){var s,d=0;(s=e.next().find('[class^="mod-indent mod-indent-"]').attr("class"))&&(d=s.substring(s.length-1,s.length)),d>i&&e.next().find(".editing_hide").click(),e=e.next()}}}),t("#page-course-view-topics").on("click",".editing_show",function(){var n=t(this).attr("href").substring(t(this).attr("href").lastIndexOf("=")+1);if(t("#module-"+n).hasClass("modtype_subsection")){var e=t("#module-"+n),i=0;for((s=e.find('[class^="mod-indent mod-indent-"]').attr("class"))&&(i=s.substring(s.length-1,s.length));e.next().has('[class^="mod-indent mod-indent-"]').length;){var s,d=0;(s=e.next().find('[class^="mod-indent mod-indent-"]').attr("class"))&&(d=s.substring(s.length-1,s.length)),Number(d)>Number(i)&&e.next().find(".editing_show").click(),e=e.next()}}}),t("#page-course-view-topics").on("click",".editing_moveright",function(){var n=t(this).attr("href").substring(t(this).attr("href").lastIndexOf("&id=")+4,t(this).attr("href").lastIndexOf("&"));if(t("#module-"+n).hasClass("modtype_subsection")){var e=t("#module-"+n),i=0;for((s=e.find('[class^="mod-indent mod-indent-"]').attr("class"))&&(i=s.substring(s.length-1,s.length));e.next().has('[class^="mod-indent mod-indent-"]').length;){var s,d=0;(s=e.next().find('[class^="mod-indent mod-indent-"]').attr("class"))&&(d=s.substring(s.length-1,s.length)),d>i&&e.next().find(".editing_moveright").click(),e=e.next()}}}),t("#page-course-view-topics").on("click",".editing_moveleft",function(){var n=t(this).attr("href").substring(t(this).attr("href").lastIndexOf("&id=")+4,t(this).attr("href").lastIndexOf("&"));if(t("#module-"+n).hasClass("modtype_subsection")){var e=t("#module-"+n),i=0;for((s=e.find('[class^="mod-indent mod-indent-"]').attr("class"))&&(i=s.substring(s.length-1,s.length));e.next().has('[class^="mod-indent mod-indent-"]').length;){var s,d=0;(s=e.next().find('[class^="mod-indent mod-indent-"]').attr("class"))&&(d=s.substring(s.length-1,s.length)),d>i&&e.next().find(".editing_moveleft").click(),e=e.next()}}}),t("#page-course-view-topics").on("click",".editing_delete",function(){n=t(this)}),t("#page-course-view-topics").on("click",".confirmation-buttons input[value='No']",function(){n=null}),t("#page-course-view-topics").on("click",".confirmation-buttons input[value='Yes']",function(){if(n){var e=n.attr("href").substring(n.attr("href").lastIndexOf("=")+1);if(t("#module-"+e).hasClass("modtype_subsection")){var i=t("#module-"+e),s=0;for((d=i.find('[class^="mod-indent mod-indent-"]').attr("class"))&&(s=d.substring(d.length-1,d.length));i.next().has('[class^="mod-indent mod-indent-"]').length;){var d,o=0;(d=i.next().find('[class^="mod-indent mod-indent-"]').attr("class"))&&(o=d.substring(d.length-1,d.length)),o>s&&i.next().find(".editing_moveleft").click(),i=i.next()}}}}),t(".modtype_subsection").each(function(){for(var n=t(this);n.next().has('[class^="mod-indent mod-indent-"]').length>0;)n.next().has('[class^="mod-indent mod-indent-"]').hide(),n=n.next()}),t("#page-course-view-topics").on("click",".modtype_subsection",function(){var n=t(this),e=!0,i=0;for(n.next().has('[class^="mod-indent mod-indent-"]').length&&"none"==n.next().has('[class^="mod-indent mod-indent-"]').css("display")?(n.find(".iconlarge.activityicon").parent().find("img").addClass("rotateImg90"),e=!0):(n.find(".iconlarge.activityicon").parent().find("img").removeClass("rotateImg90"),e=!1),(s=n.find('[class^="mod-indent mod-indent-"]').attr("class"))&&(i=s.substring(s.length-1,s.length));n.next().has('[class^="mod-indent mod-indent-"]').length>0;){var s,d=0;(s=n.next().find('[class^="mod-indent mod-indent-"]').attr("class"))&&(d=s.substring(s.length-1,s.length)),Number(d)>Number(i)&&(e?n.next().has(".mod-indent-"+(Number(i)+1)).show():(n.hasClass("modtype_subsection")&&n.find(".iconlarge.activityicon").parent().find("img").removeClass("rotateImg90"),n.next().has('[class^="mod-indent mod-indent-"]').hide())),n=n.next()}})}}});
define('mod_survey/validation', ["jquery","core/str","core/modal_factory","core/notification"],function(a,b,c,d){return{ensureRadiosChosen:function(e){var f=b.get_strings([{key:"error",component:"moodle"},{key:"questionsnotanswered",component:"survey"}]).then(function(a){return c.create({type:c.types.CANCEL,title:a[0],body:a[1]})})["catch"](d.exception),g=a("#"+e);g.submit(function(a){return 0===g.find('input:radio[data-survey-default="true"]:checked').length||(a.preventDefault(),f.then(function(a){return a.show(),!1}))})}}});
// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 * Ajax functions for tekforum
 *
 * @module     mod/tekforum
 * @package    mod_tekforum
 * @copyright  2017 Tamara Gunkel
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define('mod_tekforum/functions', ['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/config', 'core/url', 'core/str'],
    function($, ajax, templates, notification, Cfg, Url, str) {

    var RATING_SOLVED = 3;
    var RATING_REMOVE_SOLVED = 30;
    var RATING_HELPFUL = 4;
    var RATING_REMOVE_HELPFUL = 40;

    var t = {

        /**
         * Reoords a upvote / downvote.
         * @param {int} discussionid
         * @param {int} ratingid
         * @param {int} userid
         * @param {event} event
         * @returns {string}
         */
        recordvote: function(discussionid, ratingid, userid, event) {
            var target = $(event.target).closest('.tekforumpost').prev();
            var postid = target.attr('id');
            postid = postid.substring(1);

            var vote = ajax.call([{
                methodname: 'mod_tekforum_record_vote',
                args: {
                    discussionid: discussionid,
                    postid: postid,
                    ratingid: ratingid,
                    sesskey: Cfg.sesskey
                }
            }
            ]);

            vote[0].done(function(response) {

                var parentdiv = $(event.target).parent().parent();
                // Update Votes.
                if (ratingid === 2) {
                    parentdiv.children('a:first-of-type').children().attr(
                        'src', Url.imageUrl('vote/upvoted', 'tekforum'));
                    parentdiv.children('a:nth-of-type(2)').children().attr(
                        'src', Url.imageUrl('vote/downvote', 'tekforum'));
                } else if (ratingid === 1) {
                    parentdiv.children('a:first-of-type').children().attr(
                        'src', Url.imageUrl('vote/upvote', 'tekforum'));
                    parentdiv.children('a:nth-of-type(2)').children().attr(
                        'src', Url.imageUrl('vote/downvoted', 'tekforum'));
                } else {
                    parentdiv.children('a:first-of-type').children().attr(
                        'src', Url.imageUrl('vote/upvote', 'tekforum'));
                    parentdiv.children('a:nth-of-type(2)').children().attr(
                        'src', Url.imageUrl('vote/downvote', 'tekforum'));
                }

                parentdiv.children('p').text(response.postrating);

                // Update user reputation.
                templates.replaceNode($('.user-details,.author').find('a[href*="id=' + userid + '"]')
                    .siblings('span'), '<span>' + response.raterreputation + '</span>', "");
                if (userid !== response.ownerid) {
                    templates.replaceNode($('.user-details,.author').find('a[href*="id=' + response.ownerid + '"]')
                        .siblings('span'), '<span>' + response.ownerreputation + '</span>', "");
                }
            }).fail(notification.exception);

            return vote;
        },

        /**
         * Initializes the clickevent on upvotes / downvotes.
         * @param {int} discussionid
         * @param {int} userid
         */
        clickevent: function(discussionid, userid) {
            $(".upvote").on("click", function(event) {
                if ($(event.target).is('a')) {
                    event.target = $(event.target).children();
                }

                if ($(event.target).parent().attr('class').indexOf('active') >= 0) {
                    t.recordvote(discussionid, 20, userid, event);
                } else {
                    t.recordvote(discussionid, 2, userid, event);
                }
                $(event.target).parent().toggleClass('active');
                $(event.target).parent().nextAll('a').removeClass('active');
            });

            $(".downvote").on("click", function(event) {
                if ($(event.target).is('a')) {
                    event.target = $(event.target).children();
                }

                if ($(event.target).parent().attr('class').indexOf('active') >= 0) {
                    t.recordvote(discussionid, 10, userid, event);
                } else {
                    t.recordvote(discussionid, 1, userid, event);
                }
                $(event.target).parent().toggleClass('active');
                $(event.target).parent().prevAll('a').removeClass('active');
            });

            $(".marksolved").on("click", function(event) {
                var post = $(event.target).parents('.tekforumpost');

                if (post.hasClass('statusteacher') || post.hasClass('statusboth')) {
                    // Remove solution mark.
                    t.recordvote(discussionid, RATING_REMOVE_SOLVED, userid, event)[0].then(function() {
                        t.removeSolvedFromPost(post);
                    });
                } else {
                    // Add solution mark.
                    t.recordvote(discussionid, RATING_SOLVED, userid, event)[0].then(function() {
                        // Remove other solution mark in dom.
                        t.removeOtherSolved(post.parent().parent());
                        if (post.hasClass('statusstarter')) {
                            post.removeClass('statusstarter');
                            post.addClass('statusboth');
                        } else {
                            post.addClass('statusteacher');
                        }

                        var promiseStringNotSolved = str.get_string('marknotsolved', 'mod_tekforum');
                        $.when(promiseStringNotSolved).done(function(string) {
                            $(event.target).text(string);
                        });

                        t.redoStatus(post);
                    });
                }


            });

            $(".markhelpful").on("click", function(event) {
                var post = $(event.target).parents('.tekforumpost');

                if (post.hasClass('statusstarter') || post.hasClass('statusboth')) {
                    // Remove helpful mark.
                    t.recordvote(discussionid, RATING_REMOVE_HELPFUL, userid, event)[0].then(function() {
                        t.removeHelpfulFromPost(post);
                    });
                } else {
                    // Add helpful mark.
                    t.recordvote(discussionid, RATING_HELPFUL, userid, event)[0].then(function() {
                        // Remove other helpful mark in dom.
                        t.removeOtherHelpful(post.parent().parent());
                        if (post.hasClass('statusteacher')) {
                            post.removeClass('statusteacher');
                            post.addClass('statusboth');
                        } else {
                            post.addClass('statusstarter');
                        }

                        var promiseStringNotHelpful = str.get_string('marknothelpful', 'mod_tekforum');
                        $.when(promiseStringNotHelpful).done(function(string) {
                            $(event.target).text(string);
                        });
                        t.redoStatus(post);
                    });
                }

            });
        },

        removeHelpfulFromPost: function (post) {
            if (post.hasClass('statusstarter')) {
                post.removeClass('statusstarter');
            } else {
                post.removeClass('statusboth');
                post.addClass('statusteacher');
            }

            t.redoStatus(post);

            var promiseHelpful = str.get_string('markhelpful', 'mod_tekforum');
            $.when(promiseHelpful).done(function (string) {
                post.find('.markhelpful').text(string);
            });
        },

        removeOtherHelpful: function(root) {
            var formerhelpful = root.find('.statusstarter, .statusboth');
            if (formerhelpful.length > 0) {
                t.removeHelpfulFromPost(formerhelpful);
            }
        },

        removeSolvedFromPost: function(post) {
            if (post.hasClass('statusteacher')) {
                post.removeClass('statusteacher');
            } else {
                post.removeClass('statusboth');
                post.addClass('statusstarter');
            }

            t.redoStatus(post);

            var promiseHelpful = str.get_string('marksolved', 'mod_tekforum');
            $.when(promiseHelpful).done(function(string) {
                post.find('.marksolved').text(string);
            });
        },

        removeOtherSolved: function(root) {
            var formersolution = root.find('.statusteacher, .statusboth');
            if (formersolution.length > 0) {
                t.removeSolvedFromPost(formersolution);
            }
        },

        /**
         * Redoes the post status
         * @param {object} post dom with .tekforumpost which status should be redone
         */
        redoStatus: function(post) {
            if ($(post).hasClass('statusboth')) {
                var statusBothRequest = [
                    {key: 'teacherrating', component: 'mod_tekforum'},
                    {key: 'starterrating', component: 'mod_tekforum'},
                    {key: 'bestanswer', component: 'mod_tekforum'}
                ];
                str.get_strings(statusBothRequest).then(function(results) {
                    var circle = templates.renderPix('status/c_circle', 'mod_tekforum', results[0]);
                    var box = templates.renderPix('status/b_box', 'mod_tekforum', results[1]);
                    $.when(box, circle).done(function(boxImg, circleImg) {
                        post.find('.status').html(boxImg + circleImg + results[2]);
                    });
                    return results;
                });
            } else if ($(post).hasClass('statusteacher')) {
                var statusTeacherRequest = [
                    {key: 'teacherrating', component: 'mod_tekforum'},
                    {key: 'solvedanswer', component: 'mod_tekforum'}
                ];
                str.get_strings(statusTeacherRequest).then(function(results) {
                    var circle = templates.renderPix('status/c_outline', 'mod_tekforum', results[0]);
                    $.when(circle).done(function(circleImg) {
                        post.find('.status').html(circleImg + results[1]);
                    });
                    return results;
                });
            } else if ($(post).hasClass('statusstarter')) {
                var statusStarterRequest = [
                    {key: 'starterrating', component: 'mod_tekforum'},
                    {key: 'helpfulanswer', component: 'mod_tekforum'}
                ];
                str.get_strings(statusStarterRequest).then(function(results) {
                    var box = templates.renderPix('status/b_outline', 'mod_tekforum', results[0]);
                    $.when(box).done(function(boxImg) {
                        post.find('.status').html(boxImg + results[1]);
                    });
                    return results;
                });
            } else {
                post.find('.status').html('');
            }

        }
    };

    return t;
});

define('mod_vmassignment/script', ['jquery'], function($) {
     return {
        init: function() {
        	var url=  $(location).attr('href');

    		var clickedImage = $(this);
    		var cmid = clickedImage.attr('cmid');
    		var imageid = clickedImage.attr('imageid');
    		var image = $('.imageLink');
    		var extend = 0;
            askForApproval();
    		
    		$(document).ready(function() {
    			 // executes when complete page is fully loaded, including all frames, objects and images
				 
			 var url = document.URL;
			 var id = getVmUrlParameter('id');
             var x= '';	
				 	
			  $.post( "ajax.php", { id:id,action:'getinstanceid' })
  		  	   .done(function( result ) {
				  var imgobj=result.response.status;
				   $.each(imgobj, function(key, value) {
					   var insid=value.id;
					   var status = $('.imagestatus-'+insid).text();
					   instanceTimer();
				       if(status == "running"){
							hidebutton_onstart();
							return false;
						}else{
							$('#timelimit').attr('value', 0);
							hidebutton_onstop();
							$(".imageLink" ).addClass( "disabled" );						
			 				$(".imageLink" ).css("pointer-events", "none");
						}
			
					   if(status  != "Not created yet"){
							//instanceTimer(insid);
						}							
				   });					
				});
			});
    		
            var evaluationHtml =
                ' <div id="evaluationModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
                ' <div id = "evaluationdialog" class="modal-dialog" style="max-width: 1000px;">' +
                ' <div class="modal-content">' +                    
                ' <div class="modal-headers">' +
                ' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;padding-top: 10px;"> Evaluation Results </h4>' +
				' <button type="button" class="close" data-dismiss="modal">&times;</button></div>'+
                ' <div class="modal-body" id="evaluationRegister">'+
                ' <div id="evaluationresult" class="center col-12" style="overflow-y: auto;height: 400px;"> </div>'+
                ' </div>'+
                ' <div class="modal-footer">'+                  
                ' <button type="button" class="btn btn-primary" id="Ok" data-dismiss="modal" >Ok</button>'+                    
                ' </div>'+
                ' </div></div>';
                    
            $("#page-header").append(evaluationHtml);
			
			var disabledNotify = 
                '<div align="center" id="notify-notenabled" style="height: 32px; color: white; padding-top: 5px; background-color: orange; display: none;">' + 
                '<p>You have disabled browser notification. You might miss many important notifications. <b><a id="notify-modal" style="width:100%;cursor: pointer;text-decoration: underline;">Click here</a></b> to enable notifications.</p>' +
                '</div>';
            $(".page-header").append(disabledNotify);
            //get modal instruction to enable notification
            $("#notify-modal").click(function() {
                $("#notify_steps").modal("show");
            });
    		//Get the grade history and display
    		$('#btn-evaluation').click(function(){
    			onEvaluationResult();  			
            });
    		
    		function onEvaluationResult(){
            	var url = document.URL;
            	var id = getVmUrlParameter('id');
//            	console.log(id);
            	// $('#vmgradehistory').empty();
            	// $('#vmgradehistory').html('<img src="pix/Loading_icon.gif" style="display: block; margin-left: auto; margin-right: auto; width: 50%;"/>');
            	$('#confirmActionModal').modal('hide');
				$.post( "getresult.php",{id : id}).done(function( result ) {                    
					if (result)
					{
						$("#evaluationModal").modal("show");
						var tabletext = '<table class="table table-bordered table-striped table-hover" id="testcaseresult">'+
                                '<thead>'+
                                ' <tr>'+
                                '<th>Instance Name</th>'+
                                '<th>Name</th>'+
                                '<th>Skill</th>'+
                                '<th>Status</th>'+
                                '<th>Score</th>'+
                                '<th>Observation</th>'+
                                '<th>Feedback</th>'+
                                '<th>ConsoleOutput</th>'+
                                '<th>Grade</th>'+
                                '<th>Graded On</th>'+
                                '</tr>'+
                                '</thead>'+
                                '<tbody>';
	                    $.each(JSON.parse(result),function(key,value){
	              
	                        var valuetext =         ' <tr>'+
	                                    '<td>'+value.instname+'</td>'+
	                                    '<td>'+value.name+'</td>'+
	                                    '<td>'+value.skill+'</td>'+
	                                    '<td>'+value.status+'</td>'+
	                                    '<td>'+value.score+'</td>'+
	                                    '<td>'+value.observation+'</td>'+
	                                    '<td>'+value.feedback+'</td>'+
	                                    '<td>'+value.consoleoutput+'</td>'+
	                                    '<td>'+value.grade+'</td>'+
	                                    '<td>'+value.gradedon+'</td>'+
	                                    '</tr>';
	              
	                        tabletext = tabletext+valuetext;
	                    });
	                        
	                    var endtext = '</tbody></table>';
	                    tabletext = tabletext+endtext;
	                    $('#evaluationresult').html(tabletext);
					}else{
						var modal='<div class="container"><div class="modal" id="eresultmodal"><div class="modal-dialog"><div class="modal-content">'+
                
                  '<div class="modal-header"><h4 class="modal-title"><center>Evaluation Result warning</center></h4>'+
                  '<button type="button" class="close" data-dismiss="modal">&times;</button></div>'+
        
                  '<div class="modal-body">You have not evaluated your program yet.</div>'+
                
                  '<div class="modal-footer"><button type="button" class="btn btn-success" data-dismiss="modal">Ok</button></div>'+
            
                  '</div></div></div></div>';
  
  
                  $("#page-header").append(modal);
                  $("#eresultmodal").modal('show');
					}
                });
    		}
    		
    	    // On Submit for evaluation of VM instance
    	    //$("#btn-vmsubmit").click(function(){
			$(document).on('click', '#btn-vmsubmit', function (e) {
				
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"evaluatelog",id:cmid }).done( function (result){});
    	    	
    	    	//Show loading icon till you get the output
    	    	$('#vmassignmentgrade').empty();
            	$('#vmassignmentgrade').html('<img src="pix/Loading_icon.gif" style="display: block; margin-left: auto; margin-right: auto; width: 50%;"/>');
    	    	
				var btnclass=$(this).attr('class').split(' ')[2];
				var btnid=btnclass.split('-')[1];
			 	var image = $('#imageLink-'+btnid);
			 	var clickedImage = image;
			 	var cmid = clickedImage.attr('cmid');
				
				//Onsubmit evaluate and bring the output to the UI
				$.ajax({
                    method: "POST",
                    url: M.cfg.wwwroot + '/mod/vmassignment/submit.php',
                    data: {"id" : cmid,"async" : false }
                }).done(function(result) {
                	var newData = JSON.stringify(result);
					var outcome = JSON.parse(newData);			
					if (outcome.result != 'terminate')	
					{
						$('#vmassignmentgrade').empty();
						if(outcome.error != ''){
				        	$('#vmassignmentgrade').html(outcome.error);
						}else{
				        	$('#vmassignmentgrade').html(outcome.result);
						}
					}else {
						$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
	  		  			$("#confirmActionModal .modal-footer .btn-secondary").css("display", "none");
	  		  			$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
						$("#confirmActionModal .modal-footer .btn-stop").css("display", "none");
	  		  			$('#confirmActionModal .modal-body').html( outcome.message );
	  		  		    $("#confirmActionModal .modal-footer #btn-wait").css("display", "");
	  		  			$('#confirmActionModal').modal('show' );
						setTimeout(function () {
					        location.reload(true);
				      	}, 3000);
					}	                    	
                });
    	    });	
    		
			function getVmUrlParameter(sParam) {
    		    var sPageURL = window.location.search.substring(1),
    		        sURLVariables = sPageURL.split('&'),
    		        sParameterName,
    		        i;
    		    for (i = 0; i < sURLVariables.length; i++) {
    		        sParameterName = sURLVariables[i].split('=');
    		        if (sParameterName[0] === sParam) {
    		            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
    		        }
    		    }
    		};
    		
    		// when user clicks on start,restart or image link, go to check status to further process
    		$("#page-mod-vmassignment-view .imageLink").click(function(){
        		// clicked on image start the instance
				//Opens the VM in new window
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				$.post( "ajax.php", { id: cmid, action: 'stoppedattemptcheck' })
  		  		.done(function( result ) {
					if(result.response.status != 'terminate')
					{
						openVM();
					}else{
						location.reload();
					}
  		  		});      			
        	});
        	//$("#btn-start").click(function(){
			$(document).on('click', '#btn-start', function (e) {
				
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				$.post( "ajax.php", { id: cmid, action: 'vmactivitycheck' })
	  			.done(function( result ) {
					if(result.response.status == 'validstate')
					{
						$('#confirmActionModal .modal-body').html( result.response.message );
	      			  	$("#confirmActionModal .modal-footer #btn-wait").css("display", "none");
		  			  	$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
	  		  		  	$("#confirmActionModal .modal-footer .btn-secondary").css("display", "");
	  		  		  	$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
	  		  		  	$("#confirmActionModal .modal-footer .btn-stop").css("display", "none");
						$("#confirmActionModal .modal-footer #activity_stop").css("display", "");
						$("#confirmActionModal .modal-footer #activity_stop").attr("assignmentid", result.response.assignmentid);
						$("#confirmActionModal .modal-footer #activity_stop").attr("moduleid", result.response.moduleid);
						$('#confirmActionModal').modal('show' );
					}
					else if (result.response.status == 'invalidstate'){
						$('#confirmActionModal .modal-body').html( result.response.message );
	      			  	$("#confirmActionModal .modal-footer #btn-wait").css("display", "none");
		  			  	$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
	  		  		  	$("#confirmActionModal .modal-footer .btn-secondary").css("display", "none");
	  		  		  	$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
	  		  		  	$("#confirmActionModal .modal-footer .btn-stop").css("display", "none");
						$("#confirmActionModal .modal-footer #activity_stop").css("display", "none");
						$('#confirmActionModal').modal('show' );
					}
					else {
						$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", {action:'startlog',id:cmid })
						.done(function( result ) {				
								
						});
						$('#confirmActionModal').modal('hide' );
						$.post( "ajax.php", { id: cmid, action: 'attemptcheck' })
		  		  		.done(function( result ) {
							if (result.response.attempt)
							{      				  
		    				  //  instance is stopped do you wanna start it
		    				  $(".imagestatus").text( 'terminated' );
		    				 // instanceTimer();
		                      $('#confirmActionModal .modal-body').html( 'Are you sure you want to start attempt?' );
		          			  $("#confirmActionModal .modal-footer #btn-wait").css("display", "none");
		      		  		  $("#confirmActionModal .modal-footer .btn-primary").css("display", "");
		      		  		  $("#confirmActionModal .modal-footer .btn-primary").text("Start Your Attempt");
		      		  		  $("#confirmActionModal .modal-footer .btn-secondary").css("display", "");
		      		  		  $("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
							  $("#confirmActionModal .modal-footer #activity_stop").css("display", "none");
		      		  		  $("#confirmActionModal .modal-footer .btn-stop").css("display", "none");
		                      $('#confirmActionModal').modal('show');
							}    
							else {
						 		$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
		      		  			$("#confirmActionModal .modal-footer .btn-secondary").css("display", "none");
		      		  			$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
							  	$("#confirmActionModal .modal-footer #activity_stop").css("display", "none");
		      		  			$('#confirmActionModal .modal-body').html( result.response.message );
		      		  		    $("#confirmActionModal .modal-footer #btn-wait").css("display", "");
		      		  			$('#confirmActionModal').modal('show' );
								$("#btn-start.btn.btn-success.imagebtnid").addClass( "disabled" );
								$("#btn-start.btn.btn-success.imagebtnid").css("pointer-events", "none");
								$("#btn-vmsubmit.btn.btn-info" ).addClass("disabled");
								$("#btn-vmsubmit.btn.btn-info").css("pointer-events", "none");
								$(".imagestatus").text( 'terminated' );
							} 		  			
		  		  		});		
					}
				});
        		
        	});
        	$("#btn-restart").click(function(){
				
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", {action:'restartlog',id:cmid })
				.done(function( result ) {				
						
				});
				
        		// clicked on re-start button the instance
        		hidebutton_onstart();
        		check_status();
        	});
        	
        	//$("#btn-notnow").click(function(){
			$(document).on('click', '#btn-notnow', function (e) {
				
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"aborttostartlog",id:cmid })
				.done( function (result){
					
				});
        		// clicked on not now button the instance
				var selectorid=$(this).attr('data-start-selector').split('-')[1];
				var selectorname=$(this).attr('data-start-selector').split('-')[0];
				if(selectorname =='vminstidstop'){
				hidebutton_onstart(selectorid);	
				}else{
        		hidebutton_onstop(selectorid);
				}
        	});
        	
    		
    		//$("#btn-stop").click(function(){
			$(document).on('click', '#btn-stop', function (e) {
				
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				var btnclass=$(this).attr('class').split(' ')[2];
				var classid=btnclass.split('-')[1];
				$.post( "ajax.php", { id: cmid, action: 'stoppedattemptcheck' })
  		  		.done(function( result ) {
					if(result.response.status != 'terminate')
					{
						$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"stoplog",id:cmid })
						.done( function (result){
							
						});
												
		    			// Ask confirmation whether to stop the instance
		    			$('#confirmActionModal .modal-body').text('Do you want to stop the instance');
						$("#confirmActionModal #btn-notnow").attr("data-start-selector","vminstidstop-"+classid );
						$("#confirmActionModal .modal-footer .btn-stop").attr("data-start-selector","vminstid-"+classid );
		    			$("#confirmActionModal .modal-footer #btn-wait").css("display", "none");
		    			$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
				  		$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
				  		$("#confirmActionModal .modal-footer .btn-stop").css("display", "");
				  		$('#confirmActionModal').modal('show' );
					}else{
						location.reload();
					}
  		  		});	
        	});
        	$("#confirmActionModal .modal-footer .btn-stop").click(function(){
				
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"instancestoppedlog",id:cmid })
				.done( function (result){
					
				});
				
				var btnclass=$(this).attr('data-start-selector').split('-')[1];
        		 $("#confirmActionModal .modal-footer .btn-secondary").css("display", "");
        		// On confirmationE stop the instance				
             	$(".imagestatus").text( 'stopping' );
				$("#btn-stop").text( 'Stopping...' );
				$(".imageLink" ).addClass( "disabled" );						
			 	$(".imageLink" ).css("pointer-events", "none");
			
				//Show loading icon till you get the output
    	    	$('#vmassignmentgrade').empty();
            	$('#vmassignmentgrade').html('<img src="pix/Loading_icon.gif" style="display: block; margin-left: auto; margin-right: auto; width: 50%;"/>');
				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"evaluatelog",id:cmid }).done( function (result){});
				$.ajax({
                    method: "POST",
                    url: M.cfg.wwwroot + '/mod/vmassignment/submit.php',
                    data: {"id" : cmid,"async" : false }
                }).done(function(result) {
                	var newData = JSON.stringify(result);
					var outcome = JSON.parse(newData);			
					if (outcome.result != 'terminate')	
					{
						$('#vmassignmentgrade').empty();
						$.post( "ajax.php", { id: cmid, action: 'stopinstance' })
		  		  		.done(function( result ) {
		  		  		    stopTimer(btnclass);
		  		  			hidebutton_onstop(btnclass);
		  		  			$(".imagestatus").text( 'terminated' );
							$("#btn-stop").text( 'Submit Attempt' );
		  		  		});
					}
                	
                });
				    		
    			//hide the modal with empty text field
        		$('#confirmActionModal .modal-body').text('');
            	$('#confirmActionModal').modal('hide');
        	});
        	
        	//When user clicks on launch instance
        	$("#confirmActionModal .modal-footer .btn-primary").click(function(){
					
				var url = document.URL;
				var id = url.substring(url.lastIndexOf('?') + 1);
				var cmid=id.split('=')[1];
				
				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"launchinstancelog",id:cmid })
				.done( function (result){
					
				});				
        		start_instance();
        	});
        	
        	$("#confirmActionModal .modal-footer .btn-secondary").click(function(){
//        		$("#btn-start.btn.btn-success" ).toggleClass( "disabled" );
//        		$("#btn-restart.btn.btn-warning" ).toggleClass( "disabled" );
        		$('#confirmActionModal').modal('hide');
        	});
        	
        	
        	//hide the modal with empty text field
        	    $('#confirmActionModal').on('hidden.bs.modal', function (e) {
            	//$('#confirmActionModal .modal-body').text('');
            	$('#confirmActionModal').modal('hide');
        	});
        	    
    	    $("#confirmActionModal .modal-footer #btn-wait").click(function(){
    	    	//Vm will be created, Wait untill that
        		//hide the modal with empty text field
        		$('#confirmActionModal .modal-body').text('');
            	$('#confirmActionModal').modal('hide');
        		// check_status();
        	});
    	    
    	    $("#confirmActionModal .modal-footer #vmsubmitmodal").click(function(){
    	    	//Vm will be created, Wait untill that
        		//hide the modal with empty text field
        		$('#confirmActionModal .modal-body').text('');
            	$('#confirmActionModal').modal('hide');
        	});
        	// This function checks for the staus of VM & does the step of operations accordingly
    	    function check_status(){				
        			//	we don't have the url to go. Either no instance or instnace turned off
        			var cmid = getVmUrlParameter('id');
            		$.post( "ajax.php", { id: cmid, action: 'checkstatus' })
            		  .done(function( result ) {
							var checkdata = result.response.checkdata;
							$.each(checkdata, function(key, value) {
								// instance not created. Update message in modal and ask confirmation for creating one
	            			  if(value.status == 'started'){ 
	            				  hidebutton_onstart();
	            				  $(".imagestatus").text( 'started' );	            				  
	            				  var millisecondsToWait = 3000;
		        				  	setTimeout(function() {
		    					  	check_status();
		        				  	}, millisecondsToWait);	            				  
	               			  }
	            			  else if ( value.status == 'running'){
		        				  	hidebutton_onstart();
									$("#prepare_envi").modal('hide');	
									$(".imageLink" ).removeClass( "disabled" );						
									$(".imageLink" ).css("pointer-events", "auto");	
			                      	$(".imagestatus").text( 'running' );		
									setTimeout(function () {
								        location.reload(true);
							      	}, 1000);						                    	
	            			  }
						});  			  
				});	
    	    }
    	    
    	    // Open the created VM in new window
    	    function openVM(){
    	    	var cmid = getVmUrlParameter('id');
    	    	$.post( "ajax.php", { id: cmid, action: 'fetchUrl'})
 		  		.done(function( result ) {
 		  			
 		  		 // url added & clicked
 	                $('.imageLink').attr("urltogo", result.response.url);
 	                
 	              //we have the url. so lets go there
 	    			var win = window.open ( image.attr('urltogo') ,'_blank' );
 	    			if (win) {
 	    			    //Browser has allowed it to be opened
 	    			    win.focus();
 	    			} else {
 	    			    //Browser has blocked it 
 	    			    alert('Please allow popups for this website');
 	    			    $("#btn-start.btn.btn-success" ).toggleClass( "disabled" );
 	            		$("#btn-restart.btn.btn-warning" ).toggleClass( "disabled" );
 	    			}	  			
 		  		});
    	    }
    	    
    	  //we need to create new instance or start stopped instance or anything similar
    	    function start_instance(){
        		$('#confirmActionModal').modal('hide');
				$("#prepare_envi").modal('show');        		
				var cmid = getVmUrlParameter('id');
    			$.post( "ajax.php", { id: cmid, imageid: imageid, action: 'startinstance' })
  		  		.done(function( result ) {
					if (result.response.status)
					{
						document.getElementById('attempttaken').innerHTML = result.response.attemptcount;
						$(".imagestatus").text( 'starting' );						
						hidebutton_onstart();
	  		  			// check if started and upadte in the UI
	  		  			check_status();
					}	
					else {
						$("#prepare_envi").modal('hide');
						$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
	  		  			$("#confirmActionModal .modal-footer .btn-secondary").css("display", "none");
	  		  			$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
	  		  			$('#confirmActionModal .modal-body').html( result.response.message );
	  		  		    $("#confirmActionModal .modal-footer #btn-wait").css("display", "");
	  		  			$('#confirmActionModal').modal('show' );
						
						$.post( "ajax.php", { id: cmid, action: 'stopinstance' })
		  		  		.done(function( result ) {
		  		  		     
		  		  		});
					}						
  				});
        	}
    	    
    	    // Method to hide buttons when users clicks on start,restart, imagelink
    	    function hidebutton_onstart(){
    	    	//instanceTimer();
				$("#btn-start.btn.btn-success.imagebtnid").addClass( "hidden" );
        		$("#btn-restart.btn.btn-warning" ).addClass( "disabled" );
        		$("#btn-stop.btn.btn-warning.imagebtnid").css("pointer-events", "auto");
        		$("#btn-vmsubmit.btn.btn-info").css("pointer-events", "auto");
				
        		$("#btn-start.btn.btn-success.imagebtnid").css("pointer-events", "none");
        		$("#btn-restart.btn.btn-warning" ).css("pointer-events", "none");
          		$("#btn-stop.btn.btn-warning.imagebtnid").removeClass("hidden");
        		$("#btn-vmsubmit.btn.btn-info").removeClass("disabled");
        		
        	}
    	    
    	    function hidebutton_onstop(){
    	    	//instanceTimer();
    	    	$("#btn-start.btn.btn-success.imagebtnid").removeClass( "hidden" );
        		$("#btn-restart.btn.btn-warning" ).removeClass( "disabled" );
        		$('#btn-stop.btn.btn-warning.imagebtnid').addClass("hidden");
				$("#btn-vmsubmit.btn.btn-info").addClass("disabled");
        		
        		$("#btn-start.btn.btn-success.imagebtnid").css("pointer-events", "auto");
        		$("#btn-restart.btn.btn-warning" ).css("pointer-events", "auto");
        		$('#btn-stop.btn.btn-warning.imagebtnid').css("pointer-events", "none");
				$("#btn-vmsubmit.btn.btn-info").css("pointer-events", "none");
        		
    	    }
    	    
    	    function stopTimer(){
				if($('#timelimit').length){
                    clearInterval(x);
					$('#timelimit').attr('value', 0);
                    instanceTimer();
				}
    	    }
            function askForApproval() {
                if (Notification.permission === "granted") {
                    $("#notify-notenabled").css("display", "none");
                } else {
                    Notification.requestPermission(permission => {
                        if (permission === 'granted') {
                            $("#notify-notenabled").css("display", "none");
                            createNotification('Assessment', 'Desktop Notification Enabled', $(' head > link:nth-child(2)').attr('href'));
                        } else{
                            $("#notify-notenabled").css("display", "");
                        }
                    });
                }
            }
            function createNotification(title, text, icon) {
                const noti = new Notification(title, {
                    body: text,
                    icon
                });
                noti.onclick = function(event) {
                }
            }
    	    
    	    function instanceTimer(){
    	    	
    	    	// update the vm-status
				status = $('#imagestatus1').text();
    	    	// calculating time left
        	    var timeLeft = $('#timelimit').attr('totalperiod') - $('#timelimit').attr('value');
				var distance = timeLeft;
				
        	    if(status != "stopped" && status != "stopping" && status != "Not created yet" && status != "terminated" && status != "pending"){
            	    x = setInterval(function() {
        	    	  
        	    	    // Find the distance between now and the count down date
            	    	distance = distance - 1;
						var navigationType = (window.performance.getEntriesByType("navigation")[0]).type;
						//back_forward value is duplicate tab
						if(navigationType == 'back_forward'){
							location.reload();
						}
						var dateset ;
						$(window).focus(function() {
							var current_time_flag = new Date();
							var diff_time = current_time_flag.getTime()- dateset;
							dateset = current_time_flag.getTime();
							if(diff_time >= 60000 && distance > 0)
							{
								location.reload();
							}
						});
						$(window).blur(function() {
							var d = new Date();
							dateset = d.getTime();
						});
                        if(distance<=301 || distance<=61){
                            var mins = Math.floor((distance % (60 * 60)) / 60);
                            var secs = Math.floor(distance % 60);
                            if ((mins==5 || mins==1) && secs==0) {
                                createNotification('Timeout Remainder', 'You have less than '+ mins +' minute(s) to complete the activity!!', $(' head > link:nth-child(2)').attr('href'));
                            }
                        }
        	    	    //Timer
            	    	var days = Math.floor(distance / (60 * 60 * 24));
        	    	    var hours = Math.floor((distance % (60 * 60 * 24)) / (60 * 60));
        	    	    var minutes = Math.floor((distance % (60 * 60)) / 60);
        	    	    var seconds = Math.floor(distance % 60);    
        	    	    hours = (days * 24) + hours;
        	    	    
        	    	    var myEle = document.getElementById("timelimit");
        	    	    
        	    	    if(myEle){
        	    	    	// Output the result in an element with id="demo"
            	    	    myEle.innerHTML = " "+ hours + "h "
            	    	    + minutes + "m " + seconds + "s ";
        	    	    }   
						if (distance < 0) {
					        clearInterval(x);
							$('#timelimit').attr('value', 0);
                            var myEle = document.getElementById("timelimit").innerHTML = " "+ 0 + "h "+ 0 + "m " + 0 + "s ";
							var url = document.URL;
							var id = url.substring(url.lastIndexOf('?') + 1);
							var cmid=id.split('=')[1];
							
			        		//hide the modal with empty text field
			        		$('#confirmActionModal .modal-body').text('');
			            	$('#confirmActionModal').modal('hide');
							$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"instancestoppedlog",id:cmid })
							.done( function (result){
								
							});

							$("#btn-stop").text( 'Stopping...' );
			    	    	$('#vmassignmentgrade').empty();
			            	$('#vmassignmentgrade').html('<img src="pix/Loading_icon.gif" style="display: block; margin-left: auto; margin-right: auto; width: 50%;"/>');
							$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"evaluatelog",id:cmid }).done( function (result){});
							$.ajax({
		                        method: "POST",
		                        url: M.cfg.wwwroot + '/mod/vmassignment/submit.php',
		                        data: {"id" : cmid,"async" : false }
		                    }).done(function(result) {
		                    	var newData = JSON.stringify(result);
								var outcome = JSON.parse(newData);			
								if (outcome.result != 'terminate')	
								{
				        		 	$('#vmassignmentgrade').empty();
					        		$.post( "ajax.php", { id: cmid, action: 'stopinstance', timeout:true })
		                            .done(function( result ) {

		                            	if(result.response.status=='time_extended'){
		                            		location.reload();
		                            	}else{
						  		  			hidebutton_onstop();
						  		  			$(".imagestatus").text( 'terminated' );
											$("#btn-stop").text( 'Submit Attempt' );
											$(".imageLink" ).addClass( "disabled" );						
						 					$(".imageLink" ).css("pointer-events", "none");
			                                stopTimer();
			
											createNotification('Attempt Stop Remainder', 'Time is up. Your attempt is stopped.', $(' head > link:nth-child(2)').attr('href'));
											$('#confirmActionModal .modal-body').html( ' Time is up. Your attempt is automatically stopped.' );
					          			  	$("#confirmActionModal .modal-footer #btn-wait").css("display", "");
				      		  		  		$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
					      		  		  	$("#confirmActionModal .modal-footer .btn-secondary").css("display", "none");
					      		  		  	$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
					      		  		  	$("#confirmActionModal .modal-footer .btn-stop").css("display", "none");
					                      	$('#confirmActionModal').modal('show');
											setTimeout(function () {
												$('#confirmActionModal').modal('hide');
										        onEvaluationResult();
									      	}, 5000);
										}	
					  		  		});
								}
										                    	
		                    });
					    }         	    
            	    }, 1000);
        	    }else{
					var timeLeft = $('#timelimit').attr('totalperiod');
        	    	var distance = timeLeft;
    	    	    //Timer
        	    	var days = Math.floor(distance / (60 * 60 * 24));
    	    	    var hours = Math.floor((distance % (60 * 60 * 24)) / (60 * 60));
    	    	    var minutes = Math.floor((distance % (60 * 60)) / 60);
    	    	    var seconds = Math.floor(distance % 60);
    	    	    hours = (days * 24) + hours;
    	    	    
    	    	    var myEle = document.getElementById("timelimit");
    	    	    
    	    	    if(myEle){
    	    	    	// Output the result in an element with id="demo"
        	    	    myEle.innerHTML = " "+ hours + "h "
        	    	    + minutes + "m " + seconds + "s ";
    	    	    }
        	    }
    	    }  
			
			$("#confirmActionModal .modal-footer #activity_stop").click(function(){
				var assignmentid=$(this).attr('assignmentid');
				var cmid = $(this).attr('moduleid');
				
				$('#confirmActionModal .modal-body').text('');
            	$('#confirmActionModal').modal('hide');

				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"stoplog",id:cmid })
				.done( function (result){});

				$('#btn-start').text('Starting...');
				$.post(M.cfg.wwwroot+"/mod/vmassignment/ajax.php", { action:"evaluatelog",id:cmid }).done( function (result){});
				$.ajax({
                    method: "POST",
                    url: M.cfg.wwwroot + '/mod/vmassignment/submit.php',
                    data: {"id" : cmid,"async" : false }
                }).done(function(result) {
                	var newData = JSON.stringify(result);
					var outcome = JSON.parse(newData);			
					if (outcome.result != 'terminate')	
					{
						$.post( "ajax.php", { id: cmid, vmassignment : assignmentid, action: 'stopinstance' })
		  		  		.done(function( result ) {
							if (result.response.status){
								$('#btn-start').text('Start Attempt');
								start_instance();
							}					
		  		  		});
					}
                	
                });
										
			});	    
    	    //working hourse select drop down
    	    $(function(){
    	        var $select = $(".1-100");
    	        for (i=1;i<=100;i++){
    	            $select.append($('<option></option>').val(i).html(i))
    	        }
    	    });
    	    
    	    $("#extendtimeconfirm").click(function(){
    	    	 extend = $('#workingtime').val();
    	    	
    	    	$("#confirmActionModal .modal-footer .btn-primary").css("display", "none");
    	    	$("#confirmActionModal .modal-footer .btn-secondary").css("display", "none");
    	    	$('#confirmActionModal .modal-body').text( "Your are extending your time "+extend+" more hours." +
    	    			"\n Note: This cannot be redone." );
    	    	$("#confirmActionModal .modal-footer #btn-wait").css("display", "none");
    	    	$("#confirmActionModal .modal-footer #vmsubmitmodal").css("display", "none");
    	    	$("#confirmActionModal .modal-footer #btn-extend").css("display", "");	
                $('#confirmActionModal').modal('show');  	
    	    });
    	    
    	    $("#btn-extend").click(function(){
    	    	$('#confirmActionModal').modal('hide');  	
    	    	
		    	var image = $('#extendtimeconfirm');
	    		var clickedImage = image;
	       		var cmid = clickedImage.attr('cmid');
	       		
	       		$.post( "ajax.php", { id: cmid, imageid: 'imageid', action: 'extendTime', extendTime: extend})
 		  		.done(function( result ) {
 		  			
 		  			$('#confirmActionModal .modal-body').text( "Successfully Updated. Close this window and Reload your Page." );
 		  			$("#confirmActionModal .modal-footer #btn-extend").css("display", "none");
 		  			$('#confirmActionModal').modal('show');  
 		  			
 		  		});
    	    });
    	    
    	    $(function () {
			  $('[data-toggle="tooltip"]').tooltip()
			});
        },
        override: function() {

        	function getVmUrlParameter(sParam) {
    		    var sPageURL = window.location.search.substring(1),
    		        sURLVariables = sPageURL.split('&'),
    		        sParameterName,
    		        i;
    		    for (i = 0; i < sURLVariables.length; i++) {
    		        sParameterName = sURLVariables[i].split('=');
    		        if (sParameterName[0] === sParam) {
    		            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
    		        }
    		    }
    		};

        	$(".delete_override").click(function(){

    	    	var overrideid = $(this).attr('id');
    	    	var userOrGroupName = $(this).attr('name');
    	    	$(".deleteyes").attr('id', overrideid);
			 	$('#deleteOverrideConfirmModal .modal-body .loading').addClass('hidden');
			 	$('#deleteOverrideConfirmModal .modal-body .deleteOverrideMsg').removeClass('hidden');
			 	$('#deleteOverrideConfirmModal .modal-body #user_group_name').text(userOrGroupName);
			 	$('#deleteOverrideConfirmModal .modal-footer').removeClass('hidden');
			 	$('#deleteOverrideConfirmModal').modal('show');
    	    });

    	    $(".deleteyes").click(function(){

    	    	var overrideid = $(this).attr('id');
    	    	var cmid = getVmUrlParameter('cmid');

	  			$('#deleteOverrideConfirmModal .modal-body .deleteOverrideMsg').addClass('hidden');
	  			$('#deleteOverrideConfirmModal .modal-footer').addClass('hidden');
    	    	$('#deleteOverrideConfirmModal .modal-body .loading').removeClass('hidden');

    	    	$.post( "ajax.php", { id: cmid, overrideid: overrideid, action: 'deleteOverride'})
 		  		.done(function( result ) {
 		  			
 		  			if(result.response.override == "deleted"){
 		  				$('#deleteOverrideConfirmModal .modal-body .loading').addClass('hidden');
 		  				$('#deleteOverrideConfirmModal .modal-body .deleteOverrideMsg').html('<b>Override Deleted!!</b>');
 		  				$('#deleteOverrideConfirmModal .modal-body .deleteOverrideMsg').removeClass('hidden');
 		  				// $('#deleteOverrideConfirmModal').modal('hide');
 		  				location.reload();
 		  			}
 		  		});
    	    });
        }
    };
});
define ("mod_vpl/vplclipboard",["jquery","jqueryui","mod_vpl/vplutil"],function(a,b,c){return function VPLClipboard(b,d,e,f,g,h){var i=a("#"+b),j=i.find(".vpl_clipboard_label1"),k=i.find(".vpl_clipboard_label2"),l=i.find(".vpl_clipboard_entry1"),m=i.find(".vpl_clipboard_entry2");j.html(d);k.html(f);if(e){j.button().click(e)}if(g){k.button().click(g)}i.dialog({title:c.str("clipboard"),closeOnEscape:!0,autoOpen:!1,width:"auto",height:"auto",resizable:!0,dialogClass:"vpl_clipboard vpl_ide"});if(h){i.on("click",h)}this.show=function(){i.dialog("open")};this.hide=function(){i.dialog("close")};this.setEntry1=function(a){l.val(a);l.select()};this.getEntry1=function(){return l.val()};this.setEntry2=function(a){m.val(a)};this.getEntry2=function(){return m.val()};var n=i.siblings().find(".ui-dialog-title"),o=c.genIcon("clipboard","sw");o+=" "+c.str("clipboard");n.html(o);i.parent().css("overflow","")}});
//# sourceMappingURL=vplclipboard.min.js.map

define ("mod_vpl/vplterminal",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplclipboard"],function(a,b,c,d){var e=function(b,e,f){var m=this,n=null,o=c.doNothing,p="",q="",r=a("#"+b),s=a("#vplide"),t="",u=null,v=64e3,w="",x,y=a("#"+e);this.updateTitle=function(){var a=p;if(""!==q){a+=" ("+q+")"}t.text(f("console")+": "+a)};this.setTitle=function(a){p=a;this.updateTitle()};this.setMessage=function(a){q=a;this.updateTitle()};function g(a){w+=a;if(w.length>v){var b=w.length-v/2;w=w.substr(b)}}function h(){if(n&&n.readyState==n.OPEN){n.send(u.getEntry2())}}function i(){u.setEntry1(w)}function j(){i();u.show()}this.write=function(a){x.write(a);return a};this.connect=function(a,b){o=b;if("WebSocket"in window){x.reset();x.startBlink();m.show();if(n){n.close()}w="";m.setMessage("");m.setTitle(f("connecting"));n=new WebSocket(a);n.writeBuffer="";n.writeIt=function(){x.write(n.writeBuffer);g(n.writeBuffer);n.writeBuffer=""};n.onmessage=function(a){if(0<n.writeBuffer.length){n.writeBuffer+=a.data}else{n.writeBuffer=a.data;setTimeout(n.writeIt,35)}};n.onopen=function(){m.setMessage("");m.setTitle(f("connected"))};n.onclose=function(){m.setTitle(f("connection_closed"));x.blur();x.stopBlink();b();n.stopOutput=!0}}else{x.write("WebSocket not available: Upgrade your browser")}};this.writeLocal=function(a){n.onmessage({data:a});return a};this.setDataCallback=function(a){n.onData=a};this.closeLocal=function(){if(n){n.writeIt();n.close();x.stopBlink();m.setTitle(f("connection_closed"))}};this.connectLocal=function(a,b){o=a;x.reset();x.startBlink();m.show();if(n){n.close()}w="";m.setMessage("");m.setTitle(f("running"));n={};n.onData=b;n.writeBuffer="";n.readBuffer="";n.readyState=1;n.OPEN=1;n.close=function(){n=!1};n.onmessage=function(a){n.writeBuffer=a.data;n.writeIt()};n.writeIt=function(){if(n){x.write(n.writeBuffer);g(n.writeBuffer);n.writeBuffer=""}};n.send=function(a){if("\x7F"==a){if(0<n.readBuffer.length){m.writeLocal("\b \b");n.readBuffer=n.readBuffer.substr(0,n.readBuffer.length-1)}}else{m.writeLocal(a);n.readBuffer+=a}var b=n.readBuffer.indexOf("\r");if(-1!=b){var c=n.readBuffer.substr(0,b);n.readBuffer=n.readBuffer.substr(b+1);n.onData(c)}}};this.isOpen=function(){return r.dialog("isOpen")};this.close=function(){r.dialog("close")};this.isConnected=function(){return n&&n.readyState!=n.CLOSED};this.disconnect=function(){if(n&&n.readyState==n.OPEN){o();if(n){n.close()}x.stopBlink()}};var z=c.genIcon("copy","sw")+" "+f("copy"),A=c.genIcon("paste","sw")+" "+f("paste");u=new d("vpl_dialog_terminal_clipboard",z,function(){i();document.execCommand("copy")},A,h);this.closeDialog=function(){u.hide();m.disconnect()};function k(a){r.data("terminal_theme",a);c.setUserPreferences({terminalTheme:a});for(var b=0;b<5;b++){r.removeClass("vpl_terminal_theme"+b)}r.addClass("vpl_terminal_theme"+a)}function l(){var a=s.width(),b=s.height();if(r.width()>a){r.dialog("option","width",a)}if(r.parent().height()>b){r.dialog("option","height",b-r.prev().outerHeight())}}r.dialog({closeOnEscape:!1,autoOpen:!1,width:"auto",height:"auto",resizable:!0,dragStop:l,open:l,focus:function focus(){l();x.focus()},dialogClass:"vpl_ide vpl_vnc",create:function create(){t=c.setTitleBar(r,"console","console",["clipboard","keyboard","theme"],[j,function(){x.focus()},function(){var a=(r.data("terminal_theme")+1)%5;k(a)}])},close:function close(){m.closeDialog()},resizeStop:function resizeStop(){r.width(r.parent().width());r.height(r.parent().height()-r.prev().outerHeight());l();x.focus()}});this.setFontSize=function(a){y.css("font-size",a+"px")};c.getUserPreferences(function(a){k(a.preferences.terminalTheme)});r.css("padding","1px");r.parent().css("z-index",2e3);this.show=function(){r.dialog("open");x.focus()};this.init=function(){if("undefined"==typeof Terminal){c.loadScript(["../../vpl/editor/xterm/term.js"],function(){m.init()});return}x=new Terminal({cols:80,rows:24,useStyle:!0,screenKeys:!0});x.on("data",function(a){if(n&&n.readyState==n.OPEN){n.send(a)}});x.open(y[0]);x.reset();x.stopBlink();x.setLineCallback(function(a,b){var c=y.height(),d=r.scrollTop(),e=r.innerHeight();if(e>=c){return}var f=c/b,g=a*f;if(g>=d&&g<e+d-f){return}if(g<d){r.scrollTop(g)}else{r.scrollTop(g-e+2*f)}})};this.init()};window.VPLTerminal=e;return e});
//# sourceMappingURL=vplterminal.min.js.map

define('mod_vpl/hint', ['jquery'], function($) {
 
    return {
        init: function(arg) {

        	var url=  $(location).attr('href');
        	var vplid = arg.vpl;
        	var courseid = arg.courseid;;
        	
        	/* Check if page is VPL IDE's edit tab*/
    		if(url.includes('mod/vpl/forms/edit.php')){
    			
    			function getHintFunction( load){
    				//get the failed contents
                	var failedCases = $('#hintFailedcases').text();
                	
                	console.log(failedCases);
                	
                	if(failedCases !== ""){
                    	$.post( "../hintajax.php", { hint : failedCases , vplid : vplid, courseid : courseid, load : load})
          		  		.done(function( result ) {
          		  			if(result === "NA" || result === "NIL"){
          		  				$('#showHint').css('display','none');
          		  				$('#hintContent').css('display','none');
          		  			}else{
	          		  			$('#hintContent').html(result);	
	  		              		$('#hintContent').css('display','');
	  		              		$('#newHint').css('display','');
          		  			}
          		  		});
                	}
    			}

                $(document).ready(function() {
                	
                	var d = new Date();
                	var n = d.getTime();
                	console.log(n);
                	setTimeout(getHintFunction(1), 5000);
                	
                	var d = new Date();
                	var n = d.getTime();
                	console.log(n);
                	
                    $("#showHint").click(function(){
                    	getHintFunction(0);
                    });	
                    
                    $("#newHint").click(function(){
                    	//get the failed contents
                    	var failedCases = $('#hintFailedcases').text();
                    	
                    	if(failedCases !== ""){
                        	$.post( "../hintajax.php", { hint : failedCases , vplid : vplid, courseid : courseid, newhint : 1})
              		  		.done(function( result ) {
	  		              		if(result == 'nil'){
	          		  				$('#hintContent').css('display','none');
	  		              			//$('#hintContent').html("No new testcases Found");
	  		              		}else if(result == 'NA'){
	  		              			$('#showHint').css('display','');
	  		              		}else{
	  		              			$('#hintContent').html(result);
	  		              		}	
	  		              	$('#hintContent').css('display','');
              		  		});
                        	
                    	}
                    	console.log("AMIGOOO");
                    });
                });
    		}
        }
    };
});
define('mod_vpl/script', ["jquery", "jqueryui"], function(e) {
    return {
        init: function(t) {
            var o = t,
                n = e(location).attr("href");

            function l() {
                var t = [],
                    o = [],
                    n = [];
                setTimeout(function() {
                    e(function() {
                        e("#vpl_tabs_scroll").find("a.ui-tabs-anchor").each(function(i) {
                            var o = e(this).attr("href");
                            t.push(o)
                        })
                    })
                }, 2e3), setTimeout(function() {
                    if (t.length >= 1)
                        for (i = 0; i < t.length; i++) {
                            var l = e("a[href='" + t[i] + "']");
                            o.push(l.text());
                            var d = o[i].split(".");
                            n.push(d[1])
                        }
                    var a = [];
                    e.each(n, function(i, t) {-1 === e.inArray(t, a) && a.push(t) });
                    var s = e("#vpl-version");
                    s.closest("html").length && s.remove();
                    var c = document.createElement("div"),
                        r = document.createTextNode("");
                    c.id = "vpl-version", c.appendChild(r), document.getElementById("region-main").appendChild(c)
                }, 3e3)
            }
            n.includes("mod/vpl/forms/edit.php") && (e(document).ready(function() {
                var i = o.afterSubmit,
                    t = o.message,
                    n = o.rightclickmsg,
                    l = o.cmid,
                    d = o.restrictededitor,
                    a = M.cfg.wwwroot,
                    s = ' <div class="modal fade" id="vpl_reset_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog" id="vpl_reset_dialog"> <div class="modal-content" style="text-align:center"> <div class="modal-headers"> <h4 class="modal-title" id="vpl_reset_label" style="color: red;"> Confirm Message </h4> </div><div class="modal-body" id="vpl_submit_body" >' + t + '<div></div><br> <button type="button" class="btn btn-info" id="vpl_reset" aria-expanded="false"> Confirm </button> <button type="button" class="btn btn-info" id="vpl_cancel_reset" aria-expanded="false"> Cancel </button>  </div></div>';
                if (e("#page-header").append(s), e(".message-drawer").attr("class", "message-drawer bg-light hidden"), 0 == e(".count-container").html() && e(".count-container").css("display", "none"), e("#vpl_ide_resetsubmission").click(function() { e("#vpl_ide_resetsubmission").hasClass("ui-button-disabled") || e("#vpl_reset_modal").modal("show") }), e("#vpl_reset").click(function() { e("#vpl_reset_body").html(i), e.post(a + "/mod/vpl/forms/edit.json.php", { action: "resetsubmission", id: l }).done(function(i) { e("#vpl_reset_modal").modal("hide"), location.reload() }) }), e("#vpl_cancel_reset").click(function() { e("#vpl_reset_modal").modal("hide") }), e("#vpl_ide_resetsubmission").click(function() { e("#vplide").hasClass("vpl_ide_root_fullscreen") && document.getElementById("vpl_ide_fullscreen").click() }), null !== d && 1 == d) {
                    var c = !1,
                        r = !1;
                    e("#region-main").on("contextmenu", function(e) { return !1 }), e("#vplide").keydown(function(e) { 17 != e.keyCode && 91 != e.keyCode || (c = !0) }).keyup(function(e) { 17 != e.keyCode && 91 != e.keyCode || (c = !1) }), e("#vplide").keydown(function(e) { if (c) return !1 }), e("#vplide").keydown(function(e) { 16 != e.keyCode && 91 != e.keyCode || (r = !0) }).keyup(function(e) { 16 != e.keyCode && 91 != e.keyCode || (r = !1) }), e("#vplide").keydown(function(e) { if (r && 45 == e.keyCode) return !1 });
                    var u = '<div class="modal fade bd-example-modal-sm" id="user-notification-modal"  tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">  <div class="modal-dialog modal-sm"><div class="modal-content"><div align="center"> ' + n + '</div><button type="button" style="line-height: 0.5em;" class="btn btn-secondary" id="rightclick_close" aria-expanded="false"> OK </button> </div></div></div>';
                    e("#page-header").append(u), e("#rightclick_close").click(function() { e("#user-notification-modal").modal("hide") })
                }
            }), e(document).ready(function() { document.getElementById("vpl_ide_timeleft") && document.getElementById("vpl_ide_timeleft").click() }), l(), e("#vpl_ide_description").click(function() { e("#description").dialog({ appendTo: "body", width: 300, autoOpen: !0, title: "Question Description", minHeight: 300, maxHeight: 500, width: 550 }).dialog("widget").position({ my: "right top-30", at: "right top-30", of: "#vpl_tr" }), e("#description div").removeClass("no-overflow"), e("#vpl_menu .ui-dialog .ui-dialog-titlebar .ui-button").text(""), e("#page-mod-vpl-forms-edit .ui-dialog-titlebar-close").text("X") }), document.getElementsByClassName("nav-link")[0].click()), n.includes("mod/vpl/forms/submissionview.php") && console.log("log entered"), e("#vpl_ide_save").click(function() { l() }), (n.includes("mod/vpl/forms/executionfiles.php") || n.includes("mod/vpl/forms/edit.php") || n.includes("mod/vpl/forms/requiredfiles.php") || n.includes("vpl/forms/testcasesfile.php")) && e("#vpl_ide_fullscreen").click(function() {}), e(document).ready(function() {-1 == window.location.href.indexOf("notifyeditingon=1") && e(".text-center.showactivitywrapper").remove() }), e(document).ready(function() { n.includes("mod/quiz/attempt.php") && e("#navbuttons").remove() }), e(document).ready(function() { e("div").removeClass("scrollable-bar-hide") }), e("#vpl_ide_evaluate").click(function() { e("#vplide").hasClass("vpl_ide_root_fullscreen") && document.getElementById("vpl_ide_fullscreen").click() })

			var file_diff_modal =
				'<div class="container"><div class="modal" id="filediffModal"><div class="modal-dialog" style="max-width: 80%;"><div class="modal-content">'+                
              	'<div class="modal-header" style="padding: 0.1rem;"><h4 class="modal-title" style="width: 100%;"><div class="row">'+
				'<div class="col filediffHeader"><h6>Previous Submission</h6></div>'+
				'<div class="col filediffHeader"><h6>Current Submission</h6></div></div></h4>'+
              	'<button type="button" class="close filediffModalClose" data-dismiss="modal">&times;</button></div>'+
				'<div class="modal-body">'+
				'<div id="filediffresult" class="center col-12">'+
				'<div class="container file-section">'+
				'<div class="row">'+
				'<div class="col" id="outputpreviousfile"></div>'+
				'<div class="col" id="outputsourcefile"></div>'+
				'</div></div>'+
				'</div></div>'+
            	'</div></div></div></div>';
                
        	$("#page-header").append( file_diff_modal );

			$('.file_diff_match').click(function() {
				var obj = new diff_match_patch();

			    var file1_content = $(this).attr("prevfile");
			    var file2_content = $(this).attr("currfile");

				var y = obj.diff_main(file1_content, file1_content);
                //Obtain the pretty difference in text
                var pretty1 = obj.diff_prettyHtml(y);
                pretty1 = pretty1.replace(/&amp;/g, "&");

				var x = obj.diff_main(file1_content, file2_content);
                //Obtain the pretty difference in text
                var pretty = obj.diff_prettyHtml(x);
                pretty = pretty.replace(/&amp;/g, "&");

			    document.getElementById('outputpreviousfile').innerHTML = pretty1;
			    document.getElementById('outputsourcefile').innerHTML = pretty;

				$("#filediffModal").modal('show');
			});
        }
    }
});
define ("mod_vpl/vplutil",["jquery","jqueryui","core/log"],function(a,b,c){var d={doNothing:a.noop,returnFalse:function(){return!1},returnTrue:function(){return!0}},e=!1;d.log=function(a,b){if(e||b){c.debug(a)}};d.setUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify(b),contentType:"application/json; charset=utf-8",dataType:"json"})};d.getUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({getPreferences:!0}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(b)};d.scrollBarWidth=function(){var b,c,d;b=a("<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>").appendTo("body");c=b.children();d=c.innerWidth()-c.height(99).innerWidth();b.remove();return d};d.sanitizeHTML=function(b){if("undefined"==typeof b||""==b.replace(/^\s+$/g,"")){return""}return a("<div>"+b+"</div>").html()};d.sanitizeText=function(a){if("undefined"==typeof a||""==a.replace(/^\s+$/g,"")){return""}return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};d.setProtocol=function(a){var b;if(0==a.securePort||0==a.port){b=0==a.port}else{switch(a.wsProtocol){case"always_use_wss":b=!0;break;case"always_use_ws":b=!1;break;default:b="https:"==window.location.protocol;}}var c=(b?"wss://":"ws://")+a.server;a.secure=b;a.portToUse=b?a.securePort:a.port;c+=":"+a.portToUse+"/";a.monitorURL=c+a.monitorPath;a.executionURL=c+a.executionPath};d.ArrayBuffer2String=function(a){var b=new Uint8Array(a),c=[],d=32e3,e,f;for(e=0,f=b.length;e<f;e+=d){c.push(String.fromCharCode.apply(String,b.subarray(e,Math.min(e+d,f))))}return c.join("")};d.String2ArrayBuffer=function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++){d[e]=a.charCodeAt(e)}return c};(function(){var a=0;d.getUniqueId=function(){return a++}})();(function(){d.fileExtension=function(a){var b=/\.([^.]*)$/.exec(a);return null!==b?b[1]:""};d.isImage=function(a){return /^(gif|jpg|jpeg|png|ico)$/i.test(d.fileExtension(a))};d.isBinary=function(a){return d.isImage(a)||/^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i.test(d.fileExtension(a))};d.isBlockly=function(a){return /^blockly[0123]?$/.test(d.fileExtension(a))};d.validFileName=function(a){if(1>a.length){return!1}if(128<a.length){return!1}return!/[\cA-\cZ]|[:-@]|[{-~]|\\|\[|\]|[/^`´]|^-|^ | $|\.\./.test(a)}})();d.getCurrentTime=function(){return parseInt(new Date().valueOf()/1e3)};d.encodeBinary=function(a,b){if(!d.isBinary(a)){return btoa(unescape(encodeURIComponent(b)))}return btoa(d.ArrayBuffer2String(b))};d.decodeBinary=function(a,b){var c=atob(b);if(!d.isBinary(a)){return decodeURIComponent(escape(c))}return d.String2ArrayBuffer(c)};d.validPath=function(a){if(256<a.length){return!1}for(var b=a.split("/"),c=0;c<b.length;c++){if(!d.validFileName(b[c])){return!1}}return!0};d.getFileName=function(a){var b=a.split("/");return b[b.length-1]};d.dataFromURLData=function(a){return a.substr(a.indexOf(",")+1)};d.readZipFile=function(a,b,c,e){if(!e){e=d.doNothing}if("undefined"==typeof JUnzip){d.loadScript(["../editor/zip/inflate.js","../editor/zip/unzip.js"],function(){d.readZipFile(a,b,c,e)});return}var g=d.ArrayBuffer2String(a),h=new JUnzip(g);if(!h.isZipFile()){d.log("Not a ZIP file");e();return}h.readEntries();var j=h.entries.length;function f(a){if(a>=j||c.isClosed()){e();return}var g=h.entries[a],k=g.fileName,l;if(k.match(/\/$/)){f(a+1)}else{c.processFile(k);var m="";if(0===g.compressionMethod){m=g.data}else if(8===g.compressionMethod){m=JSInflate.inflate(g.data)}if(d.isBinary(k)){b({name:k,contents:btoa(m),encoding:1});f(a+1)}else{l=d.String2ArrayBuffer(m);var n=new Blob([l],{type:"text/plain"}),o=new FileReader;o.onload=function(c){b({name:k,contents:c.target.result,encoding:0});f(a+1)};o.onerror=function(b){d.log(b);a=j;f(a+1)};o.readAsText(n)}}}f(0)};d.readSelectedFiles=function(a,b,c){var h=new d.progressBar("import","import"),i="";if(!c){c=d.doNothing}h.processFile=function(a){h.setLabel(a)};function g(j){if(j>=a.length||h.isClosed()){c();h.close();if(""<i){d.showErrorMessage(i)}return}var k=a[j];h.processFile(k.name);var f=d.isBinary(k.name),l=new FileReader,m=d.fileExtension(k.name).toLowerCase();l.onload=function(a){if(f){if("zip"==m){try{d.readZipFile(a.target.result,b,h,function(){g(j+1)});return}catch(a){d.showErrorMessage(a+" : "+k.name)}}else{var c=d.dataFromURLData(a.target.result);b({name:k.name,contents:c,encoding:1})}}else{b({name:k.name,contents:a.target.result,encoding:0})}g(j+1)};l.onerror=function(a){i+="Error \""+a.target.error+"\" reading "+k.name+"\n";g(j+1)};if(f){if("zip"==m){l.readAsArrayBuffer(k)}else{l.readAsDataURL(k)}}else{l.readAsText(k)}}g(0)};(function(){var a={gif:"image/gif",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",ico:"image/vnd.microsoft.icon",pdf:"application/pdf"};d.getMIME=function(b){var c=d.fileExtension(b);if(c in a){return a[c]}return"application/octet-stream"};d.getTimeLeft=function(a){var b="",c=60,d=60*c,e=24*d;if(0>a){b+="-";a=-a}var f=a,g=parseInt(f/e);f-=g*e;if(0!==g){b+=g+"T"}var h=parseInt(f/d);f-=h*d;var i=parseInt(f/c);f-=i*c;var j=parseInt(f);b+=("00"+h).substr(-2)+":";b+=("00"+i).substr(-2);if(a<d){b+=":"+("00"+j).substr(-2)}return b}})();(function(){var a={abap:"abap",abc:"abc",ada:"ada",ads:"ada",adb:"ada",as:"actionscript",as3:"actionscript",asm:"assembly_x86",bash:"sh",bat:"batchfile",c:"c_cpp",C:"c_cpp",cc:"c_cpp",cpp:"c_cpp","c++":"c_cpp",hxx:"c_cpp",h:"c_cpp",H:"c_cpp",cases:"cases",cbl:"cobol",cob:"cobol",coffee:"coffee",clj:"clojure",cs:"csharp",css:"css",d:"d",dart:"dart",e:"eiffel",erl:"erlang",hrl:"erlang",f:"fortran",f77:"fortran",f90:"fortran",for:"fortran",go:"golang",groovy:"groovy",gv:"dot",hs:"haskell",htm:"html",html:"html",hx:"haxe",java:"java",js:"javascript",json:"json",jsp:"jsp",jsx:"jsx",kt:"kotlin",kts:"kotlin",m:"matlab",md:"markdown",less:"less",lisp:"lisp",lsp:"lisp",lua:"lua",pas:"pascal",p:"pascal",perl:"perl",prl:"perl",php:"php",pro:"prolog",pl:"prolog",py:"python",R:"r",r:"r",rb:"ruby",ruby:"ruby",s:"assembly_x86",sass:"sass",scala:"scala",scm:"scheme",scss:"scss",sh:"sh",swift:"swift",sql:"sql",svg:"svg",tex:"tex",tcl:"tcl",ts:"typescript",twig:"twig",vbs:"vbscript",v:"verilog",vh:"verilog",vhd:"vhdl",vhdl:"vhdl",xml:"xml",yaml:"yaml"};d.langType=function(b){if(b in a){return a[b]}return"plain_text"}})();(function(){var a={};d.str=function(b,c){if(!a[b]){return"{"+b+"}"}if("undefined"!=typeof c){return a[b].replace(/\{\\*\$a\\*}/g,c)}else{return a[b]}};d.setStr=function(b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}d.dialogbaseOptions={minWidth:200,autoOpen:!1,width:"auto",closeText:d.str("cancel"),modal:!0,dialogClass:"vpl_ide vpl_ide_dialog"}};d.setStr(window.VPLi18n)})();(function(){var a={},b={},c=100,e=0;d.delay=function(b,c,d,f){if("undefined"!=typeof a[b]){clearTimeout(a[b]);e--}e++;a[b]=setTimeout(function(){e--;c(d,f);delete a[b]},20)};d.longDelay=function(b,d,f,g){if("undefined"!=typeof a[b]){clearTimeout(a[b]);e--}e++;a[b]=setTimeout(function(){e--;d(f,g);delete a[b]},c)};var f=function(a,d,g,h){if("undefined"!=typeof b[a]){clearTimeout(b[a])}return setTimeout(function(){if(0<e){b[a]=f(a,d,g,h)}else{d(g,h);delete b[a]}},c)};d.afterAll=function(a,c,d,e){b[a]=f(a,c,d,e)}})();d.iconModified=function(){var a="<span title=\""+d.str("modified")+"\" class=\"vpl_ide_charicon\">";a+="<i class=\"fa fa-star\"></i></span> ";return a};d.iconDelete=function(){var a=" <span title=\""+d.str("delete")+"\" class=\"vpl_ide_charicon vpl_ide_delicon\">";a+="<i class=\"fa fa-trash\"></i></span> ";return a};d.iconClose=function(){var a=" <span title=\""+d.str("closebuttontitle");a+="\" class=\"vpl_ide_charicon vpl_ide_closeicon\"><i class=\"fa fa-remove\"></i></span> ";return a};d.iconRequired=function(){var a=" <span title=\""+d.str("required")+"\" class=\"vpl_ide_charicon\">";a+="<i class=\"fa fa-shield\"></i></span> ";return a};d.iconFolder=function(){return"<i class=\"fa fa-folder-open-o\"></i>"};(function(){var a={filelist:"folder-o",filelistclose:"folder-open-o",new:"file-code-o",rename:"pencil",delete:"trash",multidelete:"trash|list",close:"remove",comments:"commenting",import:"upload",print:"print",edit:"edit",undo:"undo",redo:"repeat",select_all:"location-arrow",find:"search",find_replace:"exchange",next:"search-plus",resetfiles:"refresh",download:"download",fullscreen:"expand",regularscreen:"compress",save:"save",shortcuts:"flash",sort:"list-ol",run:"rocket",running:"rocket fa-spin",debug:"bug",evaluate:"check-square-o",console:"terminal",about:"question",info:"info-circle",alert:"warning",trash:"trash",retrieve:"download",spinner:"refresh fa-spin",keyboard:"keyboard-o",clipboard:"clipboard",timeleft:"clock-o",copy:"copy",paste:"paste",more:"plus-square",less:"minus-square",resize:"arrows-alt",graphic:"picture-o",send:"send",theme:"paint-brush",user:"user",fontsize:"text-height"};d.genIcon=function(b,c){if(!a[b]){return""}var d="fa fa-";if(!c){d+="lg"}else{d+=c}for(var e=a[b].split("|"),f="",g=0;g<e.length;g++){f+="<i class='"+d+" fa-"+e[g]+"'></i>"}return f}})();d.setTitleBar=function(b,c,e,f,g){var j=a(b).parent().find("span.ui-dialog-title");function h(a){var b="<a id='vpl_"+c+"_"+a+"' href='#' title='"+d.str(a)+"'>";b+=d.genIcon(a,"fw")+"</a>";return b}var k=d.genIcon(e);k+=" <span class='"+c+"-title-buttons'></span>";k+="<span class='"+c+"-title-text'></span>";j.html(k);var l=j.find("span."+c+"-title-buttons"),m=j.find("span."+c+"-title-text");k="";for(var n=0;n<f.length;n++){k+=h(f[n])}l.html(k);for(var o=0,p;o<g.length;o++){p=j.find("#vpl_"+c+"_"+f[o]);p.button().click(g[o]);p.css("padding","1px 3px")}l.on("focus","*",function(){a(this).blur()});return m};d.setDialogTitleIcon=function(b,c){var e=a(b).parent().find("span.ui-dialog-title");e.html(d.genIcon(c)+" "+e.html())};d.progressBar=function(b,c,e){var f="<div class=\"vpl_ide_progressbaricon\">"+d.genIcon("spinner")+"</div>",g=a("<div class=\"vpl_ide_dialog\" style=\"display:none;\">"+(" <div class=\"vpl_ide_progressbar\">"+f+"<span class=\"vpl_ide_progressbarlabel\"></span>"+"</div>")+"</div>");a("body").append(g);var h=g.find(".vpl_ide_progressbar"),i=h.find(".vpl_ide_progressbarlabel");g.dialog({title:d.str(b),resizable:!1,autoOpen:!1,width:200,height:20,minHeight:20,modal:!0,dialogClass:"vpl_ide vpl_ide_dialog",close:function close(a){if(g){if(e&&a.originalEvent){e()}e=!1}}});this.setLabel=function(a,b){if(g){i.text(a);if(b){i.html(d.genIcon(b)+" "+i.html())}}};this.close=function(){if(g){g.dialog("destroy");a(g).remove();g=!1}};this.isClosed=function(){return!1===g};var j=g.siblings().find(".ui-dialog-title");j.html(d.genIcon(b)+" "+j.html());this.setLabel(d.str(c));g.dialog("open");g.dialog("option","height","auto")};d.showMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,c),f=a("<div class=\"vpl_ide_dialog\" style=\"display:none\"></div>"),g="",h=" <span class=\"dmessage\">"+b.replace(/\n/g,"<br>")+"</span>";f.html(h);if("undefined"==typeof e.icon){g="info"}else{g=e.icon;delete e.icon}if(!e.title){e.title=d.str("warning")}a("body").append(f);var i={};if("function"==typeof c.ok){i[d.str("ok")]=function(){a(this).dialog("close");c.ok()};i[d.str("cancel")]=function(){a(this).dialog("close")};delete e.ok}else if("function"==typeof c.yes){i[d.str("yes")]=function(){a(this).dialog("close");c.yes()};i[d.str("no")]=function(){a(this).dialog("close")};delete e.yes}else{i[d.str("close")]=function(){a(this).dialog("close")}}if(e.next){i[d.str("next")]=function(){a(this).dialog("close");c.next()}}e.close=function(){a(this).remove();if(c.close){c.close()}};e.buttons=i;f.dialog(e);var j=f.siblings().find(".ui-dialog-title");j.html(d.genIcon(g)+" "+j.html());f.setMessage=function(b){a(f).find(".dmessage").html(b.replace(/\n/g,"<br>"))};f.dialog("open");return f};d.showErrorMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,{title:d.str("error"),icon:"alert"});if(c){e=a.extend(e,c)}return d.showMessage(b,e)};d.requestAction=function(b,c,f,g){var h=a.Deferred(),i=null,j=!1;if(""===c){c="connecting"}var k=new d.progressBar(b,c,function(){if(4!=i.readyState){if(j&&j.abort){j.abort()}}});i=a.ajax({beforeSend:function beforeSend(a){j=a;return!0},async:!0,type:"POST",url:g+b,data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(){k.close()}).done(function(a){if(!a.success){h.reject(a.error)}else{h.resolve(a.response)}}).fail(function(a,b,c){var f=d.str("connection_fail")+": "+b;if(e){f+="<br>"+c.message;f+="<br>"+a.responseText.substr(0,80)}d.log(f);h.reject(f)});return h};d.supportWebSocket=function(){if("WebSocket"in window){return!0}return!1};d.isAndroid=function(){return-1<window.navigator.userAgent.indexOf("Android")};d.isFirefox=function(){return-1<window.navigator.userAgent.indexOf("Firefox")};d.isMac=function(){return-1<window.navigator.userAgent.indexOf("Mac")};d.clickServer=function(b){var c=450,e=screen.width/2-275,f=screen.height/2-c/2;try{var g="toolbar=no, location=no, directories=no, status=no, menubar=no";g+=", resizable=yes, scrollbars=yes, copyhistory=no, width=550";g+=", height="+c+", top="+f+", left="+e;var h=window.open(a(this).attr("href"),"_blank",g);if(!h){return!0}}catch(a){d.log(a);return!0}b.preventDefault();a(this).parent().hide();return!1};d.acceptCertificates=function(b,c){if(0<b.length){var e=d.str("acceptcertificatesnote");e+="<ol>";for(var f in b){if(b.hasOwnProperty(f)){var g=1+f;e+="<li><a href=\""+b[f]+"\" target=\"_blank\">Server ";e+=g+"</a></li>"}}e+="</ol>";var h=d.showMessage(e,{ok:function ok(){var a=c();if(a){a()}},icon:"unlocked",title:d.str("acceptcertificates")});a(h).find("a").on("click keypress",d.clickServer)}else{d.log("servers.length == 0");d.showErrorMessage(d.str("connection_fail"))}};d.monitorRunning=d.returnFalse;d.webSocketMonitor=function(b,c,e,f){d.setProtocol(b);var g=null,h=null,i=a.Deferred(),j=function(a){i.reject(a)},k=!1,l={message:function message(a){var b=/^([^:]*):?([^]*)/.exec(a),c=b[1],g=b[2];if("running"==c){c=e}var i=d.str(c);if(""<g){i+=": "+g}if(null!==h&&!h.isClosed()){h.setLabel(i)}else if(f.getConsole&&f.getConsole().isOpen()){f.getConsole().setMessage(i)}else{d.log("Error: no dialogo. Message not shown: "+i)}},compilation:function compilation(a){if(f.setResult){f.setResult({compilation:a},!1)}},retrieve:function retrieve(){h.close();k=!0;d.requestAction("retrieve","","",f.ajaxurl).done(function(a){i.resolve();if(f.setResult){f.setResult(a,!0)}}).fail(j)},run:function run(a){h.close();f.run(a,b,g)},close:function close(){d.log("ws close message from jail");g.close()}};try{if(d.supportWebSocket()){g=new WebSocket(b.monitorURL)}else{d.log("ws not available");i.reject(d.str("browserupdate"));return i}}catch(a){d.log("ws new say "+a);i.reject(a.message);return i}h=new d.progressBar(c,"connecting",function(){i.reject("Stopped by user");g.close()});g.notOpen=!0;g.onopen=function(){g.notOpen=!1;h.setLabel(d.str("connected"));if(f.open){f.open()}};g.onerror=function(a){d.log("ws error "+a);h.close();if(b.secure&&g.notOpen){d.requestAction("getjails","retrieve",{},f.ajaxurl).done(function(a){d.acceptCertificates(a.servers,function(){return f.getLastAction()})}).fail(j)}else{i.reject(d.str("connection_fail"))}if(f.close){d.delay("externalActions.close",f.close)}};g.onclose=function(){if(f.getConsole){f.getConsole().disconnect()}if(!g.notOpen){h.close();if(!k&&"rejected"!=i.state()){i.resolve()}}if(f.close){f.close()}};g.onmessage=function(a){var b=/^([^:]+):([^]*)/.exec(a.data);if(null!==b){var c=b[1],e=b[2];if(l[c]){l[c](e)}}else{h.setLabel(d.str("error")+": "+a.data)}};d.monitorRunning=function(){return null!==g&&g.readyState!=WebSocket.CLOSED};return i};d.processResult=function(a,b,c,e,f){if("undefined"==typeof a||""==a.replace(/^\s+$/gm,"")){return""}function g(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/,"\\$&")}var p=/^\s*>/,q=new RegExp("\\[err\\]|error|"+g(d.str("error")),"i"),r=new RegExp("\\[warn\\]|warning|note|"+g(d.str("warning")),"i"),s="",t="",u="",v="",w=a.split(/\r\n|\n|\r/),x=[],y=!1,z=!1,A=!1;function h(a){if("undefined"==typeof c[a].getTagId){return"href=\"#\" "}else{return"href=\"#"+c[a].getTagId()+"\" "}}(function(){for(var a=0;a<b.length;a++){var c=g(b[a]);x[a]=new RegExp("(^|.* |.*/)"+c+"( on line | line |:|\\()(\\d+)(:|,)?(\\d+)?(\\))?","")}})();function j(a,e){for(var f=!1,g=0;g<x.length;g++){var j=x[g],k;while(null!==(k=j.exec(a))){var l=c[g].getAnnotations();z=g;f=!0;var m;if(-1<a.search(q)){m="error"}else if(-1<a.search(r)){m="warning"}else if(-1<a.search(/\[info\]|information/i)){m="info"}else{m="error"}y={row:k[3]-1,column:k[5],type:m,text:e};l.push(y);var n=b[g],o=h(g),p=d.sanitizeText(n),s="data-file=\""+n+"\" data-line=\""+k[3]+"\"";a=a.replace(j,"$1<a "+o+" class=\"vpl_fl\" "+s+">"+p+"$2$3$4$5$6</a>");c[g].setAnnotations(l)}}if(!f&&y){if(""!==e){y.text+="\n"+e;c[z].setAnnotations(c[z].getAnnotations())}else{y=!1}}return a}function k(a){y=!1;a=a.substr(1);var b=/\([-]?[\d]+[.]?[\d]*\)\s*$/.exec(a);if(null!==b){a=a.substr(0,a.length-b[0].length)}var c="";if(f){c+="<a href=\"javascript:void(0)\" onclick=\"VPLUtil.showHideDiv(this)\">[+]</a>"}c+="<b class=\"ui-widget-header ui-corner-all\">"+d.sanitizeText(a)+"</b><br>";c=j(c,a);return c}function l(){y=!1;var a=u;u="";return a}function m(a){var b=d.sanitizeText(a);u+=j(b,a)+"<br>"}function n(a){var b=d.sanitizeText(a);v+=j(b,a)+"\n"}function o(){y=!1;var a=v;v="";return"<pre><i>"+a+"</i></pre>"}for(var B=0,C;B<w.length;B++){C=w[B];if(e){t+=j(d.sanitizeText(C),C)+"\n";continue}var D=p.exec(C),E=p.test(C);if(null!==D!=E){d.log("error")}if(/^-.*/.test(C)){switch(s){case"comment":t+=l();break;case"case":t+=o();break;}if(A){t+="</div>"}t+=k(C);t+=f?"<div style=\"display:none\">":"<div>";A=!0;s=""}else if(E){if("comment"==s){t+=l()}n(C.substr(D[0].length));s="case"}else{if("case"==s){t+=o()}m(C);s="comment"}}switch(s){case"comment":t+=l();break;case"case":t+=o();break;}if(A){t+="</div>"}return t};(function(){var a=[];d.loadScript=function(b,c){if(0==b.length){c();return}var e=b[0];if("undefined"==typeof a[e]){b.shift();a[e]=1;var f=document.createElement("script");f.type="text/javascript";f.src=d.options.scriptPath+e;f.onload=function(){a[e]=2;d.loadScript(b,c)};document.head.appendChild(f)}else if(2==a[e]){b.shift();d.loadScript(b,c)}else{d.log("Error loading js "+e+" "+a[e]);setTimeout(function(){d.loadScript(b,c)},50)}};d.isScriptLoading=function(b){if("undefined"==typeof a[b]){return!1}return 1==a[b]};d.isScriptLoaded=function(b){if("undefined"==typeof a[b]){return!1}return 2==a[b]}})();d.adjustBlockly=function(a,b,c){for(var d=a.getAllBlocks(),e=2e4,f=-2e4,g=2e4,h=-2e4,k=0,l;k<d.length;k++){l=d[k].getRelativeToSurfaceXY();e=Math.min(e,l.y);f=Math.max(f,l.y);g=Math.min(g,l.x);h=Math.max(h,l.x)}d=a.getTopBlocks();for(var m=0;m<d.length;m++){d[m].moveBy(b-g,c-e)}return f-e+100+c};(function(){var c=[],e=[],f=[];function b(a,b){var c=this;this.files=a;this.results=b;setTimeout(function(){c.highlight()},10)}b.prototype.highlightBlockly=function(b){d.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js"],function(){var e=a("#"+b),f=e.html();a("#"+b+"load").remove();e.html("");e.show();f=a("<div />").html(f).text().replace(/\n/g,"");var g=Blockly.Xml.textToDom(f);e.html("").height(300).width(e.parent().width());var i=Blockly.inject(b,{toolbox:"",readOnly:!0,media:"../editor/blockly/media/"});Blockly.Xml.domToWorkspace(g,i);var j=d.adjustBlockly(i,10,10);e.height(j);e.width("100%");Blockly.svgResize(i);Blockly.resizeSvgContents(i);var k=e.html();i.dispose();e.html(k)})};b.prototype.highlight=function(){for(var b=this,c=!1,e=this.files,g=0,h;g<e.length;g++){h=e[g];if(d.isBinary(h.fileName)||d.isBlockly(h.fileName)){continue}else{c=!0;break}}if(c&&"undefined"==typeof ace){d.loadScript(["../editor/ace9/ace.js"],function(){b.highlight()});return}for(var j=this.results,k=[],l=[],m=0;m<e.length;m++){var n=e[m],o="code"+n.tagId;if(d.isBlockly(n.fileName)){b.highlightBlockly(o);continue}var p=d.fileExtension(n.fileName),q=d.langType(p);a("#"+o).show();a("#"+o+"load").remove();var r=ace.edit(o);r.setTheme("ace/theme/"+n.theme);r.getSession().setMode("ace/mode/"+q);r.renderer.setShowGutter(n.showln);r.setReadOnly(!0);r.setHighlightActiveLine(!1);r.setAutoScrollEditorIntoView(!0);r.setOption("maxLines",n.nl);r.getAnnotations=function(){return this.getSession().getAnnotations()};r.setAnnotations=function(b){return this.getSession().setAnnotations(b)};r.getTagId=function(){return this.vplTagId};r.vplTagId=n.tagId;k.push(r);l.push(n.fileName);f[n.tagId]=r}for(var s=0;s<j.length;s++){var t=document.getElementById(j[s].tagId),u=t.textContent||t.innerText;t.innerHTML=d.processResult(u,l,k,j[s].noFormat,j[s].folding)}};d.addResults=function(a,b,c){e.push({tagId:a,noFormat:b,folding:c})};d.syntaxHighlightFile=function(a,b,d,e,f){c.push({tagId:a,fileName:b,theme:d,showln:e,nl:f})};d.syntaxHighlight=function(){new b(c,e);c=[];e=[]};d.flEventHandler=function(a){var b=a.target.getAttribute("href").substring(1),c=a.target.getAttribute("data-line"),d=f[b];d.gotoLine(c,0);d.scrollToLine(c,!0)};d.setflEventHandler=function(){for(var a=document.getElementsByClassName("vpl_fl"),b=0;b<a.length;b++){a[b].onclick=d.flEventHandler}};d.showHideDiv=function(b){var a=b,c=b;if(!c.nextSibling){c=c.parentNode}c=c.nextSibling;while("DIV"!=c.nodeName&&"PRE"!=c.nodeName){c=c.nextSibling;if(!c){return}}if(a){if("[+]"==a.innerHTML){if(c.savedDisplay){c.style.display=c.savedDisplay}else{c.style.display=""}a.innerHTML="[-]"}else{c.savedDisplay=c.style.display;c.style.display="none";a.innerHTML="[+]"}}}})();d.options={scriptPath:""};if("undefined"!=typeof window.VPLDebugMode){e=window.VPLDebugMode}d.init=function(b){d.options={scriptPath:""};a.extend(d.options,b);if("undefined"!=typeof window.VPLDebugMode){e=window.VPLDebugMode}d.log(d.options)};window.VPLUtil=d;return d});
//# sourceMappingURL=vplutil.min.js.map

define('mod_workshop/workshopview', ["jquery"],function(a){function b(b){var c=0;b.height("auto"),b.each(function(){var b=a(this).height();b>c&&(c=b)}),b.height(c)}return{init:function(){var c=a(".path-mod-workshop .userplan dt"),d=a(".path-mod-workshop .userplan dd");b(c),b(d),a(window).on("resize",function(){b(c),b(d)})}}});
define('mod_workshop/modform', ["jquery"],function(a){function b(a,b){a.available.prop("checked")||(a.required.prop("disabled",!0),a.required.prop("checked",!1),b.available.prop("checked")&&(b.required.prop("disabled",!0),b.required.prop("checked",!0),b.requiredHidden.val(1)))}function c(a){a.required.prop("disabled",!1),a.required.prop("checked",!1),a.requiredHidden.val(0)}function d(){b(e.file,e.text),b(e.text,e.file),e.text.available.prop("checked")&&e.file.available.prop("checked")&&(c(e.text),c(e.file))}var e={text:{available:null,required:null,requiredHidden:null},file:{available:null,required:null,requiredHidden:null}};return{init:function(){e.text.available=a("#id_submissiontypetextavailable"),e.text.required=a("#id_submissiontypetextrequired"),e.text.requiredHidden=a('input[name="submissiontypetextrequired"][type="hidden"]'),e.file.available=a("#id_submissiontypefileavailable"),e.file.required=a("#id_submissiontypefilerequired"),e.file.requiredHidden=a('input[name="submissiontypefilerequired"][type="hidden"]'),e.text.available.on("change",d),e.file.available.on("change",d),d()}}});
define('enrol_manual/quickenrolment', ["core/templates","jquery","core/str","core/config","core/notification","core/modal_factory","core/modal_events","core/fragment"],function(a,b,c,d,e,f,g,h){var i={COHORTSELECT:"#id_cohortlist",TRIGGERBUTTONS:".enrolusersbutton.enrol_manual_plugin [type='submit']",UNWANTEDHIDDENFIELDS:":input[value='_qf__force_multiselect_submission']"},j=function(a){this.contextid=a.contextid,this.initModal()};return j.prototype.courseid=0,j.prototype.modal=null,j.prototype.initModal=function(){var a=b(i.TRIGGERBUTTONS);b.when(c.get_strings([{key:"enroluserscohorts",component:"enrol_manual"},{key:"enrolusers",component:"enrol_manual"}]),f.create({type:f.types.SAVE_CANCEL,large:!0},a)).then(function(a,c){this.modal=c,c.setTitle(a[1]),c.setSaveButtonText(a[1]),c.getRoot().on(g.save,this.submitForm.bind(this)),c.getRoot().on("submit","form",this.submitFormAjax.bind(this)),c.getRoot().on(g.hidden,function(){c.setBody("")}),c.getRoot().on(g.shown,function(){var d=this.getBody();d.then(function(d){var e=b(d).find(i.COHORTSELECT).length?0:1;c.setSaveButtonText(a[e])}).fail(e.exception),c.setBody(d)}.bind(this))}.bind(this)).fail(e.exception)},j.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},j.prototype.submitFormAjax=function(a){a.preventDefault();var c=this.modal.getRoot().find("form"),f=c.find(i.UNWANTEDHIDDENFIELDS);f.each(function(){b(this).remove()});var g=c.serialize();this.modal.hide();var h={type:"GET",processData:!1,contentType:"application/json"},j=d.wwwroot+"/enrol/manual/ajax.php?"+g;b.ajax(j,h).then(function(a){a.error?e.addNotification({message:a.error,type:"error"}):("undefined"!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload())}).fail(e.exception)},j.prototype.getBody=function(){return h.loadFragment("enrol_manual","enrol_users_form",this.contextid,{}).fail(e.exception)},j.prototype.getFooter=function(){return a.render("enrol_manual/enrol_modal_footer",{})},{init:function(a){new j(a)}}});
define('enrol_manual/form-potential-user-selector', ["jquery","core/ajax","core/templates","core/str"],function(a,b,c,d){return{processResults:function(b,c){var d=[];return a.isArray(c)?(a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d):c},transport:function(e,f,g,h){var i,j=a(e).attr("courseid"),k=a(e).attr("userfields").split(",");"undefined"==typeof j&&(j="1");var l=a(e).attr("enrolid");"undefined"==typeof l&&(l="");var m=a(e).attr("perpage");"undefined"==typeof m&&(m=100),i=b.call([{methodname:"core_enrol_get_potential_users",args:{courseid:j,enrolid:l,search:f,searchanywhere:!0,page:0,perpage:m+1}}]),i[0].then(function(b){var e=[],f=0;return b.length<=m?(a.each(b,function(b,d){var f=d,g=[];a.each(k,function(a,b){"undefined"!=typeof d[b]&&""!==d[b]&&(f.hasidentity=!0,g.push(d[b]))}),f.identity=g.join(", "),e.push(c.render("enrol_manual/form-user-selector-suggestion",f))}),a.when.apply(a.when,e).then(function(){var c=arguments;a.each(b,function(a,b){b._label=c[f],f++}),g(b)})):d.get_string("toomanyuserstoshow","core",">"+m).then(function(a){g(a)})}).fail(h)}}});
define('message_popup/notification_area_events', [],function(){return{showNotification:"notification-area-events:showNotification",notificationShown:"notification-area-events:notificationShown"}});
define('message_popup/notification_popover_controller', ["jquery","core/ajax","core/templates","core/str","core/url","core/notification","core/custom_interaction_events","core/popover_region_controller","message_popup/notification_repository","message_popup/notification_area_events"],function(a,b,c,d,e,f,g,h,i,j){var k={MARK_ALL_READ_BUTTON:'[data-action="mark-all-read"]',ALL_NOTIFICATIONS_CONTAINER:'[data-region="all-notifications"]',NOTIFICATION:'[data-region="notification-content-item-container"]',UNREAD_NOTIFICATION:'[data-region="notification-content-item-container"].unread',NOTIFICATION_LINK:'[data-action="content-item-link"]',EMPTY_MESSAGE:'[data-region="empty-message"]',COUNT_CONTAINER:'[data-region="count-container"]'},l=function(a){h.call(this,a),this.markAllReadButton=this.root.find(k.MARK_ALL_READ_BUTTON),this.unreadCount=0,this.userId=this.root.attr("data-userid"),this.container=this.root.find(k.ALL_NOTIFICATIONS_CONTAINER),this.limit=20,this.offset=0,this.loadedAll=!1,this.initialLoad=!1,this.unreadCount=this.root.find(k.COUNT_CONTAINER).html()};return l.prototype=Object.create(h.prototype),l.prototype.constructor=l,l.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?d.get_string("hidenotificationwindow","message").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):this.unreadCount?d.get_string("shownotificationwindowwithcount","message",this.unreadCount).done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):d.get_string("shownotificationwindownonew","message").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this))},l.prototype.getContent=function(){return this.container},l.prototype.getOffset=function(){return this.offset},l.prototype.incrementOffset=function(){this.offset+=this.limit},l.prototype.hasDoneInitialLoad=function(){return this.initialLoad},l.prototype.hasLoadedAllContent=function(){return this.loadedAll},l.prototype.setLoadedAllContent=function(a){this.loadedAll=a},l.prototype.renderUnreadCount=function(){var a=this.root.find(k.COUNT_CONTAINER);this.unreadCount?(a.text(this.unreadCount),a.removeClass("hidden")):a.addClass("hidden")},l.prototype.hideUnreadCount=function(){this.root.find(k.COUNT_CONTAINER).addClass("hidden")},l.prototype.getNotificationElement=function(a){var b=this.root.find(k.NOTIFICATION+'[data-id="'+a+'"]');return 1==b.length?b:null},l.prototype.renderNotifications=function(b,d){var f=[];return a.each(b,function(a,b){var d=this.getOffset()-this.limit;b.viewmoreurl=e.relativeUrl("/message/output/popup/notifications.php",{notificationid:b.id,offset:d});var g={notificationid:b.id};b.contexturl&&(g.redirecturl=encodeURIComponent(b.contexturl)),b.contexturl=e.relativeUrl("message/output/popup/mark_notification_read.php",g);var h=c.render("message_popup/notification_content_item",b).then(function(a,b){return{html:a,js:b}});f.push(h)}.bind(this)),a.when.apply(a,f).then(function(){a.each(arguments,function(a,b){d.append(b.html),c.runTemplateJS(b.js)})})},l.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return a.Deferred().resolve();this.startLoading();var b={limit:this.limit,offset:this.getOffset(),useridto:this.userId},c=this.getContent();return i.query(b).then(function(a){var b=a.notifications;return this.unreadCount=a.unreadcount,this.setLoadedAllContent(!b.length||b.length<this.limit),this.initialLoad=!0,this.updateButtonAriaLabel(),!!b.length&&(this.incrementOffset(),this.renderNotifications(b,c))}.bind(this)).always(function(){this.stopLoading()}.bind(this))},l.prototype.markAllAsRead=function(){return this.markAllReadButton.addClass("loading"),i.markAllAsRead({useridto:this.userId}).then(function(){this.unreadCount=0,this.root.find(k.UNREAD_NOTIFICATION).removeClass("unread")}.bind(this)).always(function(){this.markAllReadButton.removeClass("loading")}.bind(this))},l.prototype.registerEventListeners=function(){g.define(this.root,[g.events.activate]),this.root.on(g.events.activate,k.MARK_ALL_READ_BUTTON,function(a,b){this.markAllAsRead(),a.stopPropagation(),b.originalEvent.preventDefault()}.bind(this)),this.root.on(g.events.activate,k.NOTIFICATION_LINK,function(b){var c=a(b.target).closest(k.NOTIFICATION);c.hasClass("unread")&&(this.unreadCount--,c.removeClass("unread")),b.stopPropagation()}.bind(this)),this.root.on(this.events().menuOpened,function(){this.hideUnreadCount(),this.updateButtonAriaLabel(),this.hasDoneInitialLoad()||this.loadMoreNotifications()}.bind(this)),this.root.on(this.events().menuClosed,function(){this.renderUnreadCount(),this.updateButtonAriaLabel()}.bind(this)),this.root.on(this.events().startLoading,function(){this.getContent().attr("aria-busy","true")}.bind(this)),this.root.on(this.events().stopLoading,function(){this.getContent().attr("aria-busy","false")}.bind(this)),this.getContentContainer().on(g.events.scrollBottom,function(){this.isLoading||this.hasLoadedAllContent()||this.loadMoreNotifications()}.bind(this)),g.define(this.getContentContainer(),[g.events.scrollLock]),a(document).on(j.notificationShown,function(a,b){if(!b.read){var c=this.getNotificationElement(b.id);c&&c.removeClass("unread"),this.unreadCount--,this.renderUnreadCount()}}.bind(this))},l});
define('message_popup/notification_area_content_area', ["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],function(a,b,c,d,e,f){var g={CONTAINER:'[data-region="notification-area"]',CONTENT:'[data-region="content"]',HEADER:'[data-region="header"]',FOOTER:'[data-region="footer"]',TOGGLE_MODE:'[data-action="toggle-mode"]'},h={HEADER:"message_popup/notification_area_content_area_header",CONTENT:"message_popup/notification_area_content_area_content",FOOTER:"message_popup/notification_area_content_area_footer"},i=function(b,c){this.root=a(b),this.container=this.root.closest(g.CONTAINER),this.userId=c,this.header=this.root.find(g.HEADER),this.content=this.root.find(g.CONTENT),this.footer=this.root.find(g.FOOTER),this.registerEventListeners()};return i.prototype.getRoot=function(){return this.root},i.prototype.getContainer=function(){return this.container},i.prototype.getUserId=function(){return this.userId},i.prototype.getHeader=function(){return this.header},i.prototype.getContent=function(){return this.content},i.prototype.getFooter=function(){return this.footer},i.prototype.show=function(){this.getContainer().addClass("show-content-area")},i.prototype.hide=function(){this.getContainer().removeClass("show-content-area")},i.prototype.setHeaderHTML=function(a){this.getHeader().empty().html(a)},i.prototype.setContentHTML=function(a){this.getContent().empty().html(a)},i.prototype.setFooterHTML=function(a){this.getFooter().empty().html(a)},i.prototype.showNotification=function(c){var d=b.render(h.HEADER,c).done(function(a){this.setHeaderHTML(a)}.bind(this)),e=b.render(h.CONTENT,c).done(function(a){this.setContentHTML(a)}.bind(this)),g=b.render(h.FOOTER,c).done(function(a){this.setFooterHTML(a)}.bind(this));return a.when(d,e,g).done(function(){this.show(),this.getContainer().trigger(f.notificationShown,[c])}.bind(this))},i.prototype.registerEventListeners=function(){d.define(this.getRoot(),[d.events.activate]),this.getRoot().on(d.events.activate,g.VIEW_TOGGLE,function(){this.hide()}.bind(this)),this.getContainer().on(f.showNotification,function(a,b){this.showNotification(b)}.bind(this))},i});
define('message_popup/notification_area_control_area', ["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],function(a,b,c,d,e,f){var g={CONTAINER:'[data-region="notification-area"]',CONTENT:'[data-region="content"]',NOTIFICATION:'[data-region="notification-content-item-container"]',CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]'},h={NOTIFICATION:"message_popup/notification_content_item"},i=function(b,c){this.root=a(b),this.container=this.root.closest(g.CONTAINER),this.userId=c,this.content=this.root.find(g.CONTENT),this.offset=0,this.limit=20,this.initialLoad=!1,this.isLoading=!1,this.loadedAll=!1,this.notifications={},this.registerEventListeners()};return i.prototype.getRoot=function(){return this.root},i.prototype.getContainer=function(){return this.container},i.prototype.getUserId=function(){return this.userId},i.prototype.getContent=function(){return this.content},i.prototype.getOffset=function(){return this.offset},i.prototype.getLimit=function(){return this.limit},i.prototype.setOffset=function(a){this.offset=a},i.prototype.setLimit=function(a){this.limit=a},i.prototype.incrementOffset=function(){this.offset+=this.limit},i.prototype.startLoading=function(){this.isLoading=!0,this.getRoot().addClass("loading")},i.prototype.stopLoading=function(){this.isLoading=!1,this.getRoot().removeClass("loading")},i.prototype.hasDoneInitialLoad=function(){return this.initialLoad},i.prototype.hasLoadedAllContent=function(){return this.loadedAll},i.prototype.setLoadedAllContent=function(a){this.loadedAll=a},i.prototype.setCacheNotification=function(a){this.notifications[a.id]=a},i.prototype.getCacheNotification=function(a){return this.notifications[a]},i.prototype.getNotificationElement=function(a){var b=this.getRoot().find(g.NOTIFICATION+'[data-id="'+a+'"]');return 1==b.length?b:null},i.prototype.scrollNotificationIntoView=function(a){var b=a.position(),c=this.getRoot(),d=b.top-c.scrollTop();if(d>c.innerHeight()){var e=a.outerHeight();e=4*e;var f=b.top-e;c.scrollTop(f)}},i.prototype.showNotification=function(b){if("object"!=typeof b&&(b=this.getNotificationElement(b)),b&&b.length){this.getRoot().find(g.NOTIFICATION).removeClass("selected"),b.addClass("selected").find(g.CAN_RECEIVE_FOCUS).focus();var c=b.attr("data-id"),d=this.getCacheNotification(c);this.scrollNotificationIntoView(b),this.getContainer().trigger(f.showNotification,[a.extend({},d)])}},i.prototype.markNotificationAsRead=function(a){return e.markAsRead(a.attr("data-id")).done(function(){a.removeClass("unread")})},i.prototype.renderNotifications=function(c){var d=[],e=this.getContent();return a.each(c,function(a,c){var e=c.contexturl;delete c.contexturl;var f=b.render(h.NOTIFICATION,c).then(function(a,b){return c.contexturl=e,this.setCacheNotification(c),{html:a,js:b}}.bind(this));d.push(f)}.bind(this)),a.when.apply(a,d).then(function(){a.each(arguments,function(a,c){e.append(c.html),b.runTemplateJS(c.js)})})},i.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return a.Deferred().resolve();this.startLoading();var b={limit:this.getLimit(),offset:this.getOffset(),useridto:this.getUserId()};this.initialLoad||(b.limit=this.getOffset()+this.getLimit(),b.offset=0);var c=e.query(b).then(function(a){var b=a.notifications;return this.unreadCount=a.unreadcount,this.setLoadedAllContent(!b.length||b.length<this.getLimit()),this.initialLoad=!0,!!b.length&&(this.incrementOffset(),this.renderNotifications(b))}.bind(this)).always(function(){this.stopLoading()}.bind(this));return c},i.prototype.registerEventListeners=function(){d.define(this.getRoot(),[d.events.activate,d.events.scrollBottom,d.events.scrollLock,d.events.up,d.events.down]),this.getRoot().on(d.events.scrollBottom,function(){this.loadMoreNotifications()}.bind(this)),this.getRoot().on(d.events.activate,g.NOTIFICATION,function(b){var c=a(b.target).closest(g.NOTIFICATION);this.showNotification(c)}.bind(this)),this.getRoot().on(d.events.up,g.NOTIFICATION,function(b,c){var d=a(b.target).closest(g.NOTIFICATION);this.showNotification(d.prev()),c.originalEvent.preventDefault()}.bind(this)),this.getRoot().on(d.events.down,g.NOTIFICATION,function(b,c){var d=a(b.target).closest(g.NOTIFICATION);this.showNotification(d.next()),c.originalEvent.preventDefault()}.bind(this)),this.getContainer().on(f.notificationShown,function(a,b){if(!b.read){var c=this.getNotificationElement(b.id);c&&this.markNotificationAsRead(c);var d=this.getCacheNotification(b.id);d&&(d.read=!0)}}.bind(this))},i});
define('message_popup/notification_repository', ["core/ajax","core/notification"],function(a,b){var c=function(c){"undefined"==typeof c.limit&&(c.limit=20),"undefined"==typeof c.offset&&(c.offset=0);var d={methodname:"message_popup_get_popup_notifications",args:c},e=a.call([d])[0];return e.fail(b.exception),e},d=function(c){var d={methodname:"message_popup_get_unread_popup_notification_count",args:c},e=a.call([d])[0];return e.fail(b.exception),e},e=function(c){var d={methodname:"core_message_mark_all_notifications_as_read",args:c},e=a.call([d])[0];return e.fail(b.exception),e},f=function(c,d){var e={notificationid:c};d&&(e.timeread=d);var f={methodname:"core_message_mark_notification_read",args:e},g=a.call([f])[0];return g.fail(b.exception),g};return{query:c,countUnread:d,markAllAsRead:e,markAsRead:f}});
define('block_activity_notes/script', ['jquery'], function($) {

	return {
		init: function(args) {
			var url=  $(location).attr('href');
			
//to display note icon inline
			var rootPath = M.cfg.wwwroot;
			if(url.includes('calendar/view.php')){
				$('.block_activity_notes').remove();
			}
			if(url.includes('grade/report/grader')){
				$('.block_activity_notes').remove();
			}
			if(url.includes('user/index.php')){
				$('.block_activity_notes').remove();
			}
			if(url.includes('enrol/editinstance.php')){
				$('.block_activity_notes').remove();
			}
			
			
			
			if(url.includes('/my/')){
//				$('.block_activity_notes').hide();
				$('.block.block_activity_notes.page-aside-section').remove();
//				document.getElementsByClassName('block_activity_notes')[0].id
				$('.block_activity_notes').remove();
				
				
				if(!args.editing){
				var handler = $('<div class="mynotes-opener" title="View Notes" alt="View Notes" >User Notes</div>');
				handler.addClass(args.editingicon_pos);
				$('body').append(handler);
			//	handler.html('<a href="'+rootPath+'/blocks/activity_notes/view.php" class="view-all-url"><span class="pencil fas fa-sticky-note" id="mynoteview" style="color: #e68118;";></span></a>');

				handler.html('<a href="'+rootPath+'/blocks/activity_notes/view.php" class="view-all-url"><span class="pencil fa fa-sticky-note-o" id="mynoteview" style="color:white;"></span></a>');
				
				}
			}
			else{
			if(!args.editing){
			//	var handler = $('<div class="mynotes-opener" title="Add Note" alt="Add Note">User Notes</div>');
			//	handler.addClass(args.editingicon_pos);
			//	$('body').append(handler);
			//	handler.html('<span class="pencil" id="mynotepencil">&#x270D;</span>');	
				
			}
			else {
			//	var handler = $('<div class="mynotes-opener" title="Add Note" alt="Add Note">User Notes</div>');
			//	handler.addClass(args.editingicon_pos);
			//	handler.html('<span class="pencil">&#x270D;</span>');
			//	$('.inline-mynotes-opener').html(handler);
			//	$('.inline-mynotes-opener').append('<div class="mynotes-pos-inline-text mynotes-opener">Add Note</div>');	
			}
		}
			
		if(url.includes('/mod/quiz/')){
			
			$('.block.block_activity_notes.page-aside-section').remove();	
//			$('#mynotepencil')
			$('.mynotes-opener.mynotes-pos-rb').remove();
		}	
			
			
			
			$(".mynotes-opener").hide();
			$("#mynotepencil").hide();
			
			if(url.includes('/my/')){
				$(".mynotes-opener").show();

			}
			if(url.includes('/course/view.php')){
				$(".mynotes-opener").show();
				$("#mynotepencil").show();
			}
			if(url.includes('/mod/')){
				$(".mynotes-opener").show();
				$("#mynotepencil").show();
			}
			
			
			$("#mynotepencil").click(function(){
				
				//				getmynotes();
				$('.page-aside-switch-lg').click();
				$( "#exampleFormControlTextarea4" ).focus();
			});
			
			getmynotes();	
			$('document').ready(function(){
				
				var ckb = $("#notes_save_handler").is(':Checked');
				if(ckb){
					$("#save_note_button").hide(500);
				}else{
					$("#save_note_button").show(500);
				}
				$("#notes_save_handler").click(function(){

					$("#save_note_button").toggle(100);
				});
				
				
//				var checkboxsave = $("#notes_save_handler").is(':Checked');
				
				
				

				/*
				 * text area scripts
				 */	
				$('#exampleFormControlTextarea4').keypress(function(event) {

					var checkboxsave = $("#notes_save_handler").is(':Checked');
					if(checkboxsave){
						if (event.keyCode == 10) {
							var cellField = document.getElementById("exampleFormControlTextarea4");
							cellField.value= cellField.value +"\n";
						}
						if (event.keyCode == 13) {
							var textarea = $('#exampleFormControlTextarea4').val();
							if(textarea ==''||textarea ==' '){
								//do stuff here
							}else{
								saveMynotes(textarea);
							}
						}
					}/*else{
						$('#save_note_button').click(function(){
							console.log('clicked trigger');
							var textarea = $('#exampleFormControlTextarea4').val();console.log(textarea);
							if(textarea ==''||textarea ==' '){
								//do stuff here
							}else{
//								saveMynotes(textarea);
								console.log("save mynote");
								console.log(textarea);
								 return false; 
							}
						});
					}*/
				});
				/*
				 * save note by button
				 * 
				 */
				
				$('#save_note_button').click(function(){
					var textarea = $('#exampleFormControlTextarea4').val();
					if(textarea ==''||textarea ==' '){
						//do stuff here
					}else{
						saveMynotes(textarea);
//						 return false; 
					}
				});

			});
//save notes function
			function saveMynotes(e) {
				var context_id=M.cfg.contextid;
				
				var activityname;
				activityname=$(".breadcrumb li:last").text()
				if(!(activityname)){
					activityname=$(".page-title a:last").text()
				}
				var url=  $(location).attr('href');

				if((url.includes('/mod/page/view.php')) || (url.includes('/mod/externalvideo/view.php')) ){

					var iframe = document.querySelector('iframe');
					var player = new Vimeo.Player(iframe);
					player.pause();
					player.getCurrentTime().then(function(seconds) {
						
						var timenotes=seconds;
						var arg = {
								contextid: context_id,
								content: e,
								action: 'add',
								notestime:timenotes,
								urllink:url,
								activity:activityname,
						};
						var rootPath = M.cfg.wwwroot;
						//to disable text area and show
						$("#exampleFormControlTextarea4").attr('disabled', true);
						$("#exampleFormControlTextarea4").css({
							'backgroundImage': 'url(' + M.util.image_url('i/loading_small', 'core') + ')',
							'backgroundRepeat': 'no-repeat',
							'backgroundPosition': 'center center'
						});
						$.ajax({
							url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
							type: "POST",
							data: arg,
							success: function(response){
								var notescount=response.count;
								if(notescount>=1){
									$('.block_activity_notes .footer').show();
									}
								$("#notes_count").text('Notes ('+notescount+')');
								
								$("#exampleFormControlTextarea4").removeAttr('disabled');
								$("#exampleFormControlTextarea4").css({
									backgroundImage: ''
								});
								$('#exampleFormControlTextarea4').val("");
								displaymynotes(response);
							},
							error: function(){
								alert("error:try again ");
							}
						});
					});
				}else{
					if(url.includes('/mod/scorm/player.php')){
						
						var scoid=$("#scorm_tree >ul > li > div > span >a").attr("data-scoid");
						var titles=$("#scorm_tree >ul > li > div > span >a").attr("Title");

						console.log(titles);
						
						var splitvalue=titles.split('&');
						var scoidvalue=splitvalue[1].split('=');
						var currentorgvalue=splitvalue[2].split('=');
						
						var scoid=scoidvalue[1];
						var currentorg=currentorgvalue[1];
						
						var arg ={
								
								contextid: context_id,	
								content: e,
								action: 'add',
								urllink:url,
								activity:activityname,
								scormid:scoid,
								currentorgs:currentorg,
						};
						var rootPath = M.cfg.wwwroot;
						$("#exampleFormControlTextarea4").attr('disabled', true);
						$("#exampleFormControlTextarea4").css({
							'backgroundImage': 'url(' + M.util.image_url('i/loading_small', 'core') + ')',
							'backgroundRepeat': 'no-repeat',
							'backgroundPosition': 'center center'
						});
						$.ajax({
							url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
							type: "POST",
							data: arg,
							success: function(response){	
								var notescount=response.count;
								if(notescount>=1){
									$('.block_activity_notes .footer').show();
									}
								$("#notes_count").text('Notes ('+notescount+')');
								
								$("#exampleFormControlTextarea4").removeAttr('disabled');
								$("#exampleFormControlTextarea4").css({
									backgroundImage: ''
								});
								$('#exampleFormControlTextarea4').val("");
								displaymynotes(response);
							},
							error: function(){
								alert("error:try again ");
							}
						});
						console.log(arg);
					}
					else{
					var arg = {
							contextid: context_id,
							content: e,
							action: 'add',
							urllink:url,
							activity:activityname,
					};
					var rootPath = M.cfg.wwwroot;
					$("#exampleFormControlTextarea4").attr('disabled', true);
					$("#exampleFormControlTextarea4").css({
						'backgroundImage': 'url(' + M.util.image_url('i/loading_small', 'core') + ')',
						'backgroundRepeat': 'no-repeat',
						'backgroundPosition': 'center center'
					});
					$.ajax({
						url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
						type: "POST",
						data: arg,
						success: function(response){	
							var notescount=response.count;
							if(notescount>=1){
								$('.block_activity_notes .footer').show();
								}
							$("#notes_count").text('Notes ('+notescount+')');
							
							$("#exampleFormControlTextarea4").removeAttr('disabled');
							$("#exampleFormControlTextarea4").css({
								backgroundImage: ''
							});
							$('#exampleFormControlTextarea4').val("");
							displaymynotes(response);
						},
						error: function(){
							alert("error:try again ");
						}
					});
					}
				}
			}
//retrieve notes function
			function getmynotes(){

				var context_id=M.cfg.contextid;
				var activityname=$(".breadcrumb li:last").text()
				var url=  $(location).attr('href');

				var arg = {
						contextid: context_id,
						action: 'get',

				};
				var rootPath = M.cfg.wwwroot;
				$.ajax({
					url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
					type: "POST",
					data: arg,
					success: function(notesobj){
						//do action 
						var notescount=notesobj.count;
						$("#notes_count").text('Notes ('+notescount+')');
						if(notescount>=1){
						$('.block_activity_notes .footer').show();
						}
						displaymynotes(notesobj);
						
					},
					error: function(){
						// do action
					}
				});
			}
//display notes function
			function displaymynotes(notesobj){

				var usernotes=notesobj.notes;
				var notescount=notesobj.count;

				$.each( usernotes, function( i, val ) {
					
					if(val.notestime==""){
						$( "#notes_display_list").prepend( '<li class="mynote'+val.id+'" id="list-group-notes" >'+
								'<div class="notes_icons" id="notes_icons'+val.id+'"><a href="#" id="mynote-delete-'+val.id+'" class="mynote-delete"> <span class="fa fa-trash" id="trashnote"></span></a>'+
								'<a href="#" id="mynote-edit-'+val.id+'" class="mynote-edit"> <span class="fa fa-edit"></span></a></div>'+
								''+val.content+'<div id="notes-link">'+val.coursename+'</div><div id="undo-tab-'+val.id+'" class="undo-tab">Note deleted &nbsp;&nbsp;&nbsp;&nbsp;<a href="#" id="undo-mynote-'+val.id+'" class="undo-mynote"><span id="undo-icon-'+val.id+'" class="note-deleted" title="undo">&nbsp;Undo</span></a><div></li>');
					}else{
						var timeval=val.notestime;
						var videotime = timeval.replace(".", ":");
						$( "#notes_display_list").prepend( '<li class="mynote'+val.id+'" id="list-group-notes" >'+
								'<div class="notes_icons" id="notes_icons'+val.id+'"><a href="#" id="mynote-delete-'+val.id+'" class="mynote-delete"> <span class="fa fa-trash" id="trashnote"></span></a>'+
								'<a href="#" id="mynote-edit-'+val.id+'" class="mynote-edit"> <span class="fa fa-edit"></span></a></div>'+
								''+val.content+'<div id="notes-link">'+val.coursename+'&nbsp;&nbsp;'+'-'+'&nbsp;'+videotime+'</div><div id="undo-tab-'+val.id+'" class="undo-tab">Note deleted &nbsp;&nbsp;&nbsp;&nbsp;<a href="#" id="undo-mynote-'+val.id+'" class="undo-mynote"><span id="undo-icon-'+val.id+'" class="note-deleted" title="undo">&nbsp;Undo</span></a></div></li>');
					}
				});
			}

			
			$(document).ready(function () {
				
				var editid;
				
				$(document).on('mouseenter', '#list-group-notes', function () {
					
					var notes_class=this.className;
					var replacedid = notes_class.replace('mynote','');
					editid=replacedid;

//					$('#notes_icons'+editid).show(300);

				}).on('mouseleave', '#list-group-notes', function () {

//					$('#notes_icons'+editid).hide(100);
				});
                /*
                 * 
                 * mynote delete option
                 * 
                 */
				$(document).on('click', '.mynote-delete', function (e) {
					
					var delete_note_id = $(this).attr('id');
					var replacedid = delete_note_id.replace('mynote-delete-','');
					var context_id=M.cfg.contextid;

					$('li.mynote'+replacedid+' div.text_to_html').hide();
					$('#mynote-delete-'+replacedid).hide();
					$('#mynote-edit-'+replacedid).hide();
					$('li.mynote'+replacedid+' div#notes-link').hide();

					var counter = 5;
					$("#undo-mynote-"+replacedid).show();
					$("#undo-tab-"+replacedid).show();
					$(".undo-tab").css({"background-color":"black"});
					$(".undo-mynote").css({"background-color":"black"});
//					$("#undo-timer-"+replacedid).text(counter+'sec ');  #202124
					var note_id='';
					//setting undo time interval

					var interval = setInterval(function() {
						counter--;

						if (counter == 0) {
							// Display a login box
							clearInterval(interval);
							$("#undo-mynote-"+replacedid).remove();
							$("li.mynote"+replacedid).hide();
							note_id=replacedid;
							//deleting note via ajax call
							if(note_id !=''){

								var arg={
										contextid: context_id,
										action: 'delete',
										noteid: note_id,
								}
								var rootPath = M.cfg.wwwroot;
								$.ajax({
									url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
									type: "POST",
									data: arg,
									success: function(notesobj){
										var notescount=notesobj.count;
										/*if(notescount>=1){
											$('.block_activity_notes .footer').show();
											}*/
										if(notescount==0){
											$('.block_activity_notes .footer').hide();
											}
										$("#notes_count").text('Notes ('+notescount+')');
									},
									error: function(){
										// do action
									}
								});
							}
						}
						$("#undo-mynote-"+replacedid).show();
//						$("#undo-timer-"+replacedid).text(counter+'sec ');
					}, 1000);

					$(document).on('click', '#undo-icon-'+replacedid, function (e) {
						
						$("#undo-mynote-"+replacedid).hide();
						$("#undo-tab-"+replacedid).hide();
						$('#mynote-delete-'+replacedid).show();
						$('#mynote-edit-'+replacedid).show();
						$('li.mynote'+replacedid+' div.text_to_html').show();
						$('li.mynote'+replacedid+' div#notes-link').show();
						replacedid='';
					})

				});
				/*
				 * 
				 * mynote edit option
				 * 
				 */
				$(document).on('click', '.mynote-edit', function (e) {
					
					var edit_note_id = $(this).attr('id');
					var nid = $(this).attr('id');
					var replacedid = edit_note_id.replace('mynote-edit-','');

					$('li.mynote'+replacedid+' div.text_to_html').attr('id', 'editable_text'+replacedid);
					var vals=document.getElementById('editable_text'+replacedid).contentEditable = true;
					document.getElementById('editable_text'+replacedid).focus();

					$("#mynote-delete-"+replacedid).hide();
					$("#mynote-edit-"+replacedid).hide();
					
					$('#editable_text'+replacedid).keypress(function(event) {
						
						var context_id=M.cfg.contextid;
						if (event.keyCode == 13) {
							var newstring= $('#editable_text'+replacedid).text();
							if(replacedid){
								var arg = {
										contextid: context_id,
										action: 'edit',
										noteid: replacedid,
										newnotes:newstring,
								};

								var vals=document.getElementById('editable_text'+replacedid).contentEditable = false;
								$("#mynote-delete-"+replacedid).show();
								$("#mynote-edit-"+replacedid).show();

								var rootPath = M.cfg.wwwroot;
								$.ajax({
									url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
									type: "POST",
									data: arg,
									success: function(notesobj){
										// do action
									},
									error: function(){
										// do action
									}
								});
							}
						}
					});
				});	
				/*
				 * 
				 * seek and redirect url function
				 * 
				 */
				$(document).on('click', '.notes_button_redirect', function (e) {

					var redirect_note_id = $(this).attr('id');
					var url=  $(location).attr('href');
					var currenttime=$(this).attr('name');
					
					console.log(redirect_note_id);
					if(redirect_note_id.includes('mod/scorm/player.php')){
						
//						var notesid=$('.notes_button_redirect').attr("value");
						var notesid=$(this).attr('value');
//						console.log(notesid);
//						var context_id=M.cfg.contextid;
						var arg = {
//								contextid: context_id,
								action: 'getscorm',
								noteid: notesid,
						};
						var rootPath = M.cfg.wwwroot;
						$.ajax({
							url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
							type: "POST",
							data: arg,
							success: function(notesobj){
								console.log(notesobj);
								var scoid=notesobj.scoid;
								var currentorg=notesobj.currentorg;
								var instanceid=notesobj.instanceid;
								
								
								var form = $('<form action="' + redirect_note_id + '" method="post" oncontextmenu="return false">'+
										  '<input type="hidden" name="mode" value="normal" />'+
										  '<input type="hidden" name="scoid" value="' + scoid + '" />'+
										  '<input type="hidden" name="cm" value="' + instanceid + '" />'+
										  '<input type="hidden" name="currentorg" value="' + currentorg + '" />'+
										  '</form>');
								$('body').append(form); 
								 form.submit();
								
								 
								 
								
								// do action
							},
							error: function(){
								// do action
							}
						});
						
						
					}
					else{

					var urlmain;

					if(url.includes('&start')){
						var splitvalue=url.split('&start');
						urlmain=splitvalue[0];
					}else{
						urlmain=url;
					}

					var url2;

					if(redirect_note_id.includes('&start')){
						var splitedval=redirect_note_id.split('&start');
						url2=splitedval[0];
					}else{
						url2=redirect_note_id;
					}

					if(urlmain == url2){

						var iframe = document.querySelector('iframe');
						var player = new Vimeo.Player(iframe);
						player.setCurrentTime(currenttime).then(function(seconds) {
							player.play()
						})
					}else{
//						var currenttime=document.getElementsByClassName('notes_button_redirect')[0].name;
						location.replace(redirect_note_id);
						if((redirect_note_id.includes('/mod/page/view.php'))  || (redirect_note_id.includes('/mod/externalvideo/view.php'))){
							var iframe = document.querySelector('iframe');
							var player = new Vimeo.Player(iframe);

							player.setCurrentTime(currenttime).then(function(seconds) {
								player.play()
							})
						}
					}
				}
				});
				
				
				
			});
		}
	};
});
define('block_activity_notes/viewnotes', ['jquery','core/config',], function($,config) {
 
    return {
        init: function() {
        	
        	var CONFIG;
        	
        	
        	
			$(document).on('click', '.notes_button_redirect', function (e) {
				
									var redirect_note_id = $(this).attr('id');
									var url=  $(location).attr('href');
									var currenttime=$(this).attr('name');
									
									if(redirect_note_id.includes('mod/scorm/player.php')){
										
//										var notesid=$('.notes_button_redirect').attr("value");
										var notesid=$(this).attr('value');
//										console.log(notesid);
//										var context_id=M.cfg.contextid;
										var arg = {
//												contextid: context_id,
												action: 'getscorm',
												noteid: notesid,
										};
										var rootPath = M.cfg.wwwroot;
										$.ajax({
											url: rootPath+"/blocks/activity_notes/mynotes_ajax.php",
											type: "POST",
											data: arg,
											success: function(notesobj){
												
												var scoid=notesobj.scoid;
												var currentorg=notesobj.currentorg;
												var instanceid=notesobj.instanceid;
												
												
												var form = $('<form action="' + redirect_note_id + '" method="post" oncontextmenu="return false">'+
														  '<input type="hidden" name="mode" value="normal" />'+
														  '<input type="hidden" name="scoid" value="' + scoid + '" />'+
														  '<input type="hidden" name="cm" value="' + instanceid + '" />'+
														  '<input type="hidden" name="currentorg" value="' + currentorg + '" />'+
														  '</form>');
												$('body').append(form); 
												 form.submit();
												
												 
												 
												
												// do action
											},
											error: function(){
												// do action
											}
										});
										
										
									}
									else{

									
									location.replace(redirect_note_id);
									
								}
								});
			
			
			$( ".notes_section" ).click(function() {
				
				var note_string = $(this).attr('id');
				var note_id=note_string.replace("icon","")
				var classname=$('#view_all_note'+note_id).attr('class');
				$('#view_all_note'+note_id).toggleClass('fa-chevron-down fa-chevron-up');
				
//console.log(note_id);console.log(classname);
			});
        	
       /* 	$('.notes_overview').hide();
        	
        	var url=  $(location).attr('href');
        	
        	if(url.includes('/mynotes/view.php')){
        		
        		$('.page-header').css('margin-top','2em !important');
        		
            	$('.page-title').css('margin-top','inherit !important');
        		
        	}*/
/*
        	$(document).ready(function(){
        		
        		var firstsection=$( "#region-main div.notes_section" ).attr('id');
        		
        		$('#'+firstsection+'  a#icon1').click();
//        		$("$region-main div#"+firstsection).click();
        		
        		$(".notes_section").click(function(){

        			var eventId=this.id;
//        			$('.collapse').collapse();
//        			$('.collapseOne'+eventId+'').toggle();
//        			$('.collapseOne'+eventId+'').collapse('toggle');
//        			console.log('.collapse'+eventId+'');
//        			console.log(eventId);
//        			$('#notes_table_id'+eventId).toggle();
        		});
        		
        		$(".notes_section").click(function(){
        			var eventId=this.id;
        			
        			var classname=$( "div#"+eventId ).children()[0].className;
        			
        			if (classname === 'notes_course fa fa-chevron-circle-right'){
        				
        				$( "#icon"+eventId ).removeClass( 'notes_course fa fa-chevron-circle-right' );
        				$( "#icon"+eventId ).addClass( 'notes_course fa fa-chevron-circle-down' );
        			}
        			else if (classname === 'notes_course fa fa-chevron-circle-down'){
        				$( "#icon"+eventId ).removeClass( 'notes_course fa fa-chevron-circle-down' );
        				$( "#icon"+eventId ).addClass( 'notes_course fa fa-chevron-circle-right' );
        			}

        		});
        		
        		
        		$("#excel_download").click(function(){
        			var rootPath = M.cfg.wwwroot
        			
        			 var arg = {
                            action: 'download',
                            
                        };
        			
                        $.ajax({
                            url: rootPath+"/blocks/mynotes/notes_excel.php",
                            type: "POST",
                            data: arg,
                            success: function(response){
                                  //do action  
                            },
                            error: function(){
                                  // do action
                            }
        			
                        });
        			
        		});
        		


        		$("a.delete_note").click(function(){

        			var deleteId=this.id;

        			var arg = {
        					action: 'delete',
        					noteid: deleteId,
        			};

        			var rootPath = M.cfg.wwwroot;
        			$.ajax({
        				type: 'post',
        				url: rootPath+'/blocks/mynotes/allnotes_ajax.php',
        				data:arg,
        				success: function( data ) {
        					var deleteid=data.noteid;
        					$("#notes"+deleteid).remove();
        				},
        				error: function(data, errorThrown)
        		          {
        		              alert('request failed :'+errorThrown);
        		          }
        			});

        			
        		});
        		
        		
        		
        		$("a.edit_note").click(function(){

        			var editId=this.id;

//      			notes_content+editId;
        			var vals=document.getElementById('notes_content'+editId).contentEditable = true;
        			document.getElementById('notes_content'+editId).focus();
//      			console.log('notes_content'+editId);
        			$('#notes_content'+editId).keypress(function(event) {

        				if (event.keyCode == 13) {

        					var newstring= $('#notes_content'+editId).text();
//      					console.log(newstring);

        					var vals=document.getElementById('notes_content'+editId).contentEditable = false;

        					var arg = {
        							action: 'edit',
        							noteid: editId,
        							newnotes:newstring,
        					};

        					var rootPath = M.cfg.wwwroot;
        					$.ajax({
        						type: 'post',
        						url: rootPath+'/blocks/mynotes/allnotes_ajax.php',
        						data:arg,
        						success: function( data ) {

        						},
        						error: function(data, errorThrown)
        						{
        							alert('request failed :'+errorThrown);
        							var vals=document.getElementById('notes_content'+editId).contentEditable = true;
        						}
        					}); 

        				}

        			});

        		});


     
      * mynotesopener
      * 
         		$('#'+firstsection+'  a#icon1').click();
        	    
        	});*/

        }
    };
});

//require(['jquery'], function($) {
	
//	require(['jquery', 'jqueryui'], function($, jqui) {
//		var url=  $(location).attr('href');

		! function(e, t) {
    "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define('block_activity_notes/player', t) : (e.Vimeo = e.Vimeo || {}, e.Vimeo.Player = t())
     }(this, function() {
    "use strict";

    function e(e, t) {
        for (var n = 0; n < t.length; n++) {
            var o = t[n];
            o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o)
        }
    }
    var t = "undefined" != typeof global && "[object global]" === {}.toString.call(global);

    function n(e, t) {
        return 0 === e.indexOf(t.toLowerCase()) ? e : "".concat(t.toLowerCase()).concat(e.substr(0, 1).toUpperCase()).concat(e.substr(1))
    }

    function o(e) {
        return /^(https?:)?\/\/((player|www).)?vimeo.com(?=$|\/)/.test(e)
    }

    function r() {
        var e, t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : {},
            n = t.id,
            r = t.url,
            i = n || r;
        if (!i) throw new Error("An id or url must be passed, either in an options object or as a data-vimeo-id or data-vimeo-url attribute.");
        if (e = i, !isNaN(parseFloat(e)) && isFinite(e) && Math.floor(e) == e) return "https://vimeo.com/".concat(i);
        if (o(i)) return i.replace("http:", "https:");
        if (n) throw new TypeError("“".concat(n, "” is not a valid video id."));
        throw new TypeError("“".concat(i, "” is not a vimeo.com url."))
    }
    var i = void 0 !== Array.prototype.indexOf,
        a = "undefined" != typeof window && void 0 !== window.postMessage;
    if (!(t || i && a)) throw new Error("Sorry, the Vimeo Player API is not available in this browser.");
    var u = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : {};
    ! function(e) {
        if (!e.WeakMap) {
            var t = Object.prototype.hasOwnProperty,
                n = function(e, t, n) {
                    Object.defineProperty ? Object.defineProperty(e, t, {
                        configurable: !0,
                        writable: !0,
                        value: n
                    }) : e[t] = n
                };
            e.WeakMap = function() {
                function e() {
                    if (void 0 === this) throw new TypeError("Constructor WeakMap requires 'new'");
                    if (n(this, "_id", "_WeakMap_" + i() + "." + i()), 0 < arguments.length) throw new TypeError("WeakMap iterable is not supported")
                }

                function r(e, n) {
                    if (!o(e) || !t.call(e, "_id")) throw new TypeError(n + " method called on incompatible receiver " + typeof e)
                }

                function i() {
                    return Math.random().toString().substring(2)
                }
                return n(e.prototype, "delete", function(e) {
                    if (r(this, "delete"), !o(e)) return !1;
                    var t = e[this._id];
                    return !(!t || t[0] !== e || (delete e[this._id], 0))
                }), n(e.prototype, "get", function(e) {
                    if (r(this, "get"), o(e)) {
                        var t = e[this._id];
                        return t && t[0] === e ? t[1] : void 0
                    }
                }), n(e.prototype, "has", function(e) {
                    if (r(this, "has"), !o(e)) return !1;
                    var t = e[this._id];
                    return !(!t || t[0] !== e)
                }), n(e.prototype, "set", function(e, t) {
                    if (r(this, "set"), !o(e)) throw new TypeError("Invalid value used as weak map key");
                    var i = e[this._id];
                    return i && i[0] === e ? i[1] = t : n(e, this._id, [e, t]), this
                }), n(e, "_polyfill", !0), e
            }()
        }

        function o(e) {
            return Object(e) === e
        }
    }("undefined" != typeof self ? self : "undefined" != typeof window ? window : u);
    var c, s, l, f, d, h = (s = c = {
            exports: {}
        }, d = function() {
            var e, t, n, o, r, i, a = Object.prototype.toString,
                u = "undefined" != typeof setImmediate ? function(e) {
                    return setImmediate(e)
                } : setTimeout;
            try {
                Object.defineProperty({}, "x", {}), e = function(e, t, n, o) {
                    return Object.defineProperty(e, t, {
                        value: n,
                        writable: !0,
                        configurable: !1 !== o
                    })
                }
            } catch (a) {
                e = function(e, t, n) {
                    return e[t] = n, e
                }
            }

            function c(e, o) {
                n.add(e, o), t || (t = u(n.drain))
            }

            function s(e) {
                var t, n = typeof e;
                return null == e || "object" != n && "function" != n || (t = e.then), "function" == typeof t && t
            }

            function l() {
                for (var e = 0; e < this.chain.length; e++) f(this, 1 === this.state ? this.chain[e].success : this.chain[e].failure, this.chain[e]);
                this.chain.length = 0
            }

            function f(e, t, n) {
                var o, r;
                try {
                    !1 === t ? n.reject(e.msg) : (o = !0 === t ? e.msg : t.call(void 0, e.msg)) === n.promise ? n.reject(TypeError("Promise-chain cycle")) : (r = s(o)) ? r.call(o, n.resolve, n.reject) : n.resolve(o)
                } catch (e) {
                    n.reject(e)
                }
            }

            function d(e) {
                var t = this;
                t.triggered || (t.triggered = !0, t.def && (t = t.def), t.msg = e, t.state = 2, 0 < t.chain.length && c(l, t))
            }

            function h(e, t, n, o) {
                for (var r = 0; r < t.length; r++) ! function(r) {
                    e.resolve(t[r]).then(function(e) {
                        n(r, e)
                    }, o)
                }(r)
            }

            function v(e) {
                this.def = e, this.triggered = !1
            }

            function p(e) {
                if ("function" != typeof e) throw TypeError("Not a function");
                if (0 !== this.__NPO__) throw TypeError("Not a promise");
                this.__NPO__ = 1;
                var t = new function(e) {
                    this.promise = e, this.state = 0, this.triggered = !1, this.chain = [], this.msg = void 0
                }(this);
                this.then = function(e, n) {
                    var o = {
                        success: "function" != typeof e || e,
                        failure: "function" == typeof n && n
                    };
                    return o.promise = new this.constructor(function(e, t) {
                        if ("function" != typeof e || "function" != typeof t) throw TypeError("Not a function");
                        o.resolve = e, o.reject = t
                    }), t.chain.push(o), 0 !== t.state && c(l, t), o.promise
                }, this.catch = function(e) {
                    return this.then(void 0, e)
                };
                try {
                    e.call(void 0, function(e) {
                        (function e(t) {
                            var n, o = this;
                            if (!o.triggered) {
                                o.triggered = !0, o.def && (o = o.def);
                                try {
                                    (n = s(t)) ? c(function() {
                                        var r = new v(o);
                                        try {
                                            n.call(t, function() {
                                                e.apply(r, arguments)
                                            }, function() {
                                                d.apply(r, arguments)
                                            })
                                        } catch (e) {
                                            d.call(r, e)
                                        }
                                    }): (o.msg = t, o.state = 1, 0 < o.chain.length && c(l, o))
                                } catch (e) {
                                    d.call(new v(o), e)
                                }
                            }
                        }).call(t, e)
                    }, function(e) {
                        d.call(t, e)
                    })
                } catch (e) {
                    d.call(t, e)
                }
            }
            n = {
                add: function(e, t) {
                    i = new function(e, t) {
                        this.fn = e, this.self = t, this.next = void 0
                    }(e, t), r ? r.next = i : o = i, r = i, i = void 0
                },
                drain: function() {
                    var e = o;
                    for (o = r = t = void 0; e;) e.fn.call(e.self), e = e.next
                }
            };
            var y = e({}, "constructor", p, !1);
            return e(p.prototype = y, "__NPO__", 0, !1), e(p, "resolve", function(e) {
                return e && "object" == typeof e && 1 === e.__NPO__ ? e : new this(function(t, n) {
                    if ("function" != typeof t || "function" != typeof n) throw TypeError("Not a function");
                    t(e)
                })
            }), e(p, "reject", function(e) {
                return new this(function(t, n) {
                    if ("function" != typeof t || "function" != typeof n) throw TypeError("Not a function");
                    n(e)
                })
            }), e(p, "all", function(e) {
                var t = this;
                return "[object Array]" != a.call(e) ? t.reject(TypeError("Not an array")) : 0 === e.length ? t.resolve([]) : new t(function(n, o) {
                    if ("function" != typeof n || "function" != typeof o) throw TypeError("Not a function");
                    var r = e.length,
                        i = Array(r),
                        a = 0;
                    h(t, e, function(e, t) {
                        i[e] = t, ++a === r && n(i)
                    }, o)
                })
            }), e(p, "race", function(e) {
                var t = this;
                return "[object Array]" != a.call(e) ? t.reject(TypeError("Not an array")) : new t(function(n, o) {
                    if ("function" != typeof n || "function" != typeof o) throw TypeError("Not a function");
                    h(t, e, function(e, t) {
                        n(t)
                    }, o)
                })
            }), p
        }, (f = u)[l = "Promise"] = f[l] || d(), s.exports && (s.exports = f[l]), c.exports),
        v = new WeakMap;

    function p(e, t, n) {
        var o = v.get(e.element) || {};
        t in o || (o[t] = []), o[t].push(n), v.set(e.element, o)
    }

    function y(e, t) {
        return (v.get(e.element) || {})[t] || []
    }

    function m(e, t, n) {
        var o = v.get(e.element) || {};
        if (!o[t]) return !0;
        if (!n) return o[t] = [], v.set(e.element, o), !0;
        var r = o[t].indexOf(n);
        return -1 !== r && o[t].splice(r, 1), v.set(e.element, o), o[t] && 0 === o[t].length
    }
    var w = ["autopause", "autoplay", "background", "byline", "color", "height", "id", "loop", "maxheight", "maxwidth", "muted", "playsinline", "portrait", "responsive", "speed", "title", "transparent", "url", "width"];

    function g(e) {
        var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {};
        return w.reduce(function(t, n) {
            var o = e.getAttribute("data-vimeo-".concat(n));
            return (o || "" === o) && (t[n] = "" === o ? 1 : o), t
        }, t)
    }

    function b(e, t) {
        var n = e.html;
        if (!t) throw new TypeError("An element must be provided");
        if (null !== t.getAttribute("data-vimeo-initialized")) return t.querySelector("iframe");
        var o = document.createElement("div");
        return o.innerHTML = n, t.appendChild(o.firstChild), t.setAttribute("data-vimeo-initialized", "true"), t.querySelector("iframe")
    }

    function k(e) {
        var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {},
            n = 2 < arguments.length ? arguments[2] : void 0;
        return new Promise(function(r, i) {
            if (!o(e)) throw new TypeError("“".concat(e, "” is not a vimeo.com url."));
            var a = "https://vimeo.com/api/oembed.json?url=".concat(encodeURIComponent(e), "&domain=").concat(window.location.hostname);
            for (var u in t) t.hasOwnProperty(u) && (a += "&".concat(u, "=").concat(encodeURIComponent(t[u])));
            var c = "XDomainRequest" in window ? new XDomainRequest : new XMLHttpRequest;
            c.open("GET", a, !0), c.onload = function() {
                if (404 !== c.status)
                    if (403 !== c.status) try {
                        var t = JSON.parse(c.responseText);
                        if (403 === t.domain_status_code) return b(t, n), void i(new Error("“".concat(e, "” is not embeddable.")));
                        r(t)
                    } catch (t) {
                        i(t)
                    } else i(new Error("“".concat(e, "” is not embeddable.")));
                    else i(new Error("“".concat(e, "” was not found.")))
            }, c.onerror = function() {
                var e = c.status ? " (".concat(c.status, ")") : "";
                i(new Error("There was an error fetching the embed code from Vimeo".concat(e, ".")))
            }, c.send()
        })
    }

    function E(e) {
        return "string" == typeof e && (e = JSON.parse(e)), e
    }

    function T(e, t, n) {
        if (e.element.contentWindow && e.element.contentWindow.postMessage) {
            var o = {
                method: t
            };
            void 0 !== n && (o.value = n);
            var r = parseFloat(navigator.userAgent.toLowerCase().replace(/^.*msie (\d+).*$/, "$1"));
            8 <= r && r < 10 && (o = JSON.stringify(o)), e.element.contentWindow.postMessage(o, e.origin)
        }
    }
    var _ = new WeakMap,
        j = new WeakMap,
        M = function() {
            function t(e) {
                var n = this,
                    i = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {};
                if (function(e, n) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this), window.jQuery && e instanceof jQuery && (1 < e.length && window.console && console.warn && console.warn("A jQuery object with multiple elements was passed, using the first element."), e = e[0]), "undefined" != typeof document && "string" == typeof e && (e = document.getElementById(e)), !(e instanceof window.HTMLElement)) throw new TypeError("You must pass either a valid element or a valid id.");
                if ("IFRAME" !== e.nodeName) {
                    var a = e.querySelector("iframe");
                    a && (e = a)
                }
                if ("IFRAME" === e.nodeName && !o(e.getAttribute("src") || "")) throw new Error("The player element passed isn’t a Vimeo embed.");
                if (_.has(e)) return _.get(e);
                this.element = e, this.origin = "*";
                var u = new h(function(t, a) {
                    var u = function(e) {
                        if (o(e.origin) && n.element.contentWindow === e.source) {
                            "*" === n.origin && (n.origin = e.origin);
                            var r = E(e.data),
                                i = "event" in r && "ready" === r.event,
                                a = "method" in r && "ping" === r.method;
                            if (i || a) return n.element.setAttribute("data-ready", "true"), void t();
                            ! function(e, t) {
                                var n, o = [];
                                if ((t = E(t)).event) "error" === t.event && y(e, t.data.method).forEach(function(n) {
                                    var o = new Error(t.data.message);
                                    o.name = t.data.name, n.reject(o), m(e, t.data.method, n)
                                }), o = y(e, "event:".concat(t.event)), n = t.data;
                                else if (t.method) {
                                    var r = function(e, t) {
                                        var n = y(e, t);
                                        if (n.length < 1) return !1;
                                        var o = n.shift();
                                        return m(e, t, o), o
                                    }(e, t.method);
                                    r && (o.push(r), n = t.value)
                                }
                                o.forEach(function(t) {
                                    try {
                                        if ("function" == typeof t) return void t.call(e, n);
                                        t.resolve(n)
                                    } catch (t) {}
                                })
                            }(n, r)
                        }
                    };
                    if (window.addEventListener ? window.addEventListener("message", u, !1) : window.attachEvent && window.attachEvent("onmessage", u), "IFRAME" !== n.element.nodeName) {
                        var c = g(e, i);
                        k(r(c), c, e).then(function(t) {
                            var o, r, i, a = b(t, e);
                            return n.element = a, n._originalElement = e, o = e, r = a, i = v.get(o), v.set(r, i), v.delete(o), _.set(n.element, n), t
                        }).catch(function(e) {
                            return a(e)
                        })
                    }
                });
                return j.set(this, u), _.set(this.element, this), "IFRAME" === this.element.nodeName && T(this, "ping"), this
            }
            var i, a;
            return i = t, (a = [{
                key: "callMethod",
                value: function(e) {
                    var t = this,
                        n = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {};
                    return new h(function(o, r) {
                        return t.ready().then(function() {
                            p(t, e, {
                                resolve: o,
                                reject: r
                            }), T(t, e, n)
                        }).catch(function(e) {
                            r(e)
                        })
                    })
                }
            }, {
                key: "get",
                value: function(e) {
                    var t = this;
                    return new h(function(o, r) {
                        return e = n(e, "get"), t.ready().then(function() {
                            p(t, e, {
                                resolve: o,
                                reject: r
                            }), T(t, e)
                        })
                    })
                }
            }, {
                key: "set",
                value: function(e, t) {
                    var o = this;
                    return h.resolve(t).then(function(t) {
                        if (e = n(e, "set"), null == t) throw new TypeError("There must be a value to set.");
                        return o.ready().then(function() {
                            return new h(function(n, r) {
                                p(o, e, {
                                    resolve: n,
                                    reject: r
                                }), T(o, e, t)
                            })
                        })
                    })
                }
            }, {
                key: "on",
                value: function(e, t) {
                    if (!e) throw new TypeError("You must pass an event name.");
                    if (!t) throw new TypeError("You must pass a callback function.");
                    if ("function" != typeof t) throw new TypeError("The callback must be a function.");
                    0 === y(this, "event:".concat(e)).length && this.callMethod("addEventListener", e).catch(function() {}), p(this, "event:".concat(e), t)
                }
            }, {
                key: "off",
                value: function(e, t) {
                    if (!e) throw new TypeError("You must pass an event name.");
                    if (t && "function" != typeof t) throw new TypeError("The callback must be a function.");
                    m(this, "event:".concat(e), t) && this.callMethod("removeEventListener", e).catch(function(e) {})
                }
            }, {
                key: "loadVideo",
                value: function(e) {
                    return this.callMethod("loadVideo", e)
                }
            }, {
                key: "ready",
                value: function() {
                    var e = j.get(this) || new h(function(e, t) {
                        t(new Error("Unknown player. Probably unloaded."))
                    });
                    return h.resolve(e)
                }
            }, {
                key: "addCuePoint",
                value: function(e) {
                    var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {};
                    return this.callMethod("addCuePoint", {
                        time: e,
                        data: t
                    })
                }
            }, {
                key: "removeCuePoint",
                value: function(e) {
                    return this.callMethod("removeCuePoint", e)
                }
            }, {
                key: "enableTextTrack",
                value: function(e, t) {
                    if (!e) throw new TypeError("You must pass a language.");
                    return this.callMethod("enableTextTrack", {
                        language: e,
                        kind: t
                    })
                }
            }, {
                key: "disableTextTrack",
                value: function() {
                    return this.callMethod("disableTextTrack")
                }
            }, {
                key: "pause",
                value: function() {
                    return this.callMethod("pause")
                }
            }, {
                key: "play",
                value: function() {
                    return this.callMethod("play")
                }
            }, {
                key: "unload",
                value: function() {
                    return this.callMethod("unload")
                }
            }, {
                key: "destroy",
                value: function() {
                    var e = this;
                    return new h(function(t) {
                        j.delete(e), _.delete(e.element), e._originalElement && (_.delete(e._originalElement), e._originalElement.removeAttribute("data-vimeo-initialized")), e.element && "IFRAME" === e.element.nodeName && e.element.remove(), t()
                    })
                }
            }, {
                key: "getAutopause",
                value: function() {
                    return this.get("autopause")
                }
            }, {
                key: "setAutopause",
                value: function(e) {
                    return this.set("autopause", e)
                }
            }, {
                key: "getColor",
                value: function() {
                    return this.get("color")
                }
            }, {
                key: "setColor",
                value: function(e) {
                    return this.set("color", e)
                }
            }, {
                key: "getCuePoints",
                value: function() {
                    return this.get("cuePoints")
                }
            }, {
                key: "getCurrentTime",
                value: function() {
                    return this.get("currentTime")
                }
            }, {
                key: "setCurrentTime",
                value: function(e) {
                    return this.set("currentTime", e)
                }
            }, {
                key: "getDuration",
                value: function() {
                    return this.get("duration")
                }
            }, {
                key: "getEnded",
                value: function() {
                    return this.get("ended")
                }
            }, {
                key: "getLoop",
                value: function() {
                    return this.get("loop")
                }
            }, {
                key: "setLoop",
                value: function(e) {
                    return this.set("loop", e)
                }
            }, {
                key: "getPaused",
                value: function() {
                    return this.get("paused")
                }
            }, {
                key: "getPlaybackRate",
                value: function() {
                    return this.get("playbackRate")
                }
            }, {
                key: "setPlaybackRate",
                value: function(e) {
                    return this.set("playbackRate", e)
                }
            }, {
                key: "getTextTracks",
                value: function() {
                    return this.get("textTracks")
                }
            }, {
                key: "getVideoEmbedCode",
                value: function() {
                    return this.get("videoEmbedCode")
                }
            }, {
                key: "getVideoId",
                value: function() {
                    return this.get("videoId")
                }
            }, {
                key: "getVideoTitle",
                value: function() {
                    return this.get("videoTitle")
                }
            }, {
                key: "getVideoWidth",
                value: function() {
                    return this.get("videoWidth")
                }
            }, {
                key: "getVideoHeight",
                value: function() {
                    return this.get("videoHeight")
                }
            }, {
                key: "getVideoUrl",
                value: function() {
                    return this.get("videoUrl")
                }
            }, {
                key: "getVolume",
                value: function() {
                    return this.get("volume")
                }
            }, {
                key: "setVolume",
                value: function(e) {
                    return this.set("volume", e)
                }
            }]) && e(i.prototype, a), t
        }();
    return t || !window.Vimeo || window.Vimeo.Player || (function() {
        var e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : document,
            t = function(e) {
                "console" in window && console.error && console.error("There was an error creating an embed: ".concat(e))
            };
        [].slice.call(e.querySelectorAll("[data-vimeo-id], [data-vimeo-url]")).forEach(function(e) {
            try {
                if (null !== e.getAttribute("data-vimeo-defer")) return;
                var n = g(e);
                k(r(n), n, e).then(function(t) {
                    return b(t, e)
                }).catch(t)
            } catch (n) {
                t(n)
            }
        })
    }(), function() {
        var e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : document,
            t = function(t) {
                if (o(t.origin) && t.data && "spacechange" === t.data.event)
                    for (var n = e.querySelectorAll("iframe"), r = 0; r < n.length; r++)
                        if (n[r].contentWindow === t.source) {
                            n[r].parentElement.style.paddingBottom = "".concat(t.data.data[0].bottom, "px");
                            break
                        }
            };
        window.addEventListener ? window.addEventListener("message", t, !1) : window.attachEvent && window.attachEvent("onmessage", t)
    }()), M
  });
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
//		});
	
//});	
define('block_assessment_scheduler/support', ['jquery'], function($) {
	
	return {
		init: function(args) {			
			var url=  $(location).attr('href');
        	var rootPath = M.cfg.wwwroot;
        	var flag = args.flag;
        	var download = args.download;
        	
        	var errorHtml =
				' <div id="errorModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div id = "errordialog" class="modal-dialog">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: #020082;height: 50px;">' +
				' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;color: white;padding-top: 10px;"> Feedback Download </h4> </div>' +
				' <div class="modal-body" id="errorRegister"></div>'+
				' <div class="modal-footer">'+ 									
				' <button type="button" class="btn btn-primary" id="errorok" aria-expanded="false" >Ok</button></div>'+
				' </div>'+
				' </div></div>';
        	
        	$("#page-header").append(errorHtml);        	        	
        	
        	var extend_modal =
				' <div id="extendModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div id = "extenddialog" class="modal-dialog" style="max-width:351px">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: #020082;height: 50px;">' +
				' <h4 class="modal-title" id="extendModalTitle" style="margin-left: 20px;color: white;padding-top: 10px;">Extend Time</h4> </div>' +
				' <div class="modal-body" id="extendTime">'+
				' <div id="extend">'+
				' <label><b>Time to be extended (in minutes): </b></label> &nbsp;' +    			
    		    ' <input type="number" id="extend_minutes" required>' +
    		    ' </div>'+
				' </div>'+
				' <div class="modal-footer">'+ 					
				' <button type="button" class="btn btn-primary" id="extendOk" aria-expanded="false" >OK</button>'+
				' <button type="button" class="btn btn-primary" id="extendCancel" aria-expanded="false" >Cancel</button></div>'+
				' </div>'+
				' </div></div>';
        	
        	$("#page-header").append(extend_modal);
        	
        	var reenable_modal =
				' <div id="reenableModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div id ="reenabledialog" class="modal-dialog" style="max-width:460px">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: #020082;height: 50px;">' +
				' <h4 class="modal-title" id="reenableModalTitle" style="margin-left: 20px;color: white;padding-top: 10px;">Re-enable Attempts</h4> </div>' +
				' <div class="modal-body" id="reenableAttempt">'+
				' <div id="assessmentstart">'+
				' <label><b>Assessment Start Time: </b></label> &nbsp;' +    			
				' <input type="date" name="start-date" id="start_date" value="" required> &nbsp; &nbsp;'+
    		    ' <input type="time" name="start-time" id="start_time" value="" required><br>' + 
    		    ' </div>'+
    		    ' <div id="assessmentend">'+
    		    ' <label><b>Assessment End Time: </b></label> &nbsp;' +    			
    		    ' <input type="date" name="end-date" id="end_date" value="" required> &nbsp; &nbsp;'+
    		    ' <input type="time" name="end-time" id="end_time" value="" required>' + 
    		    ' </div>'+
				' </div>'+
				' <div class="modal-footer">'+ 					
				' <button type="button" class="btn btn-primary" id="reenableok" aria-expanded="false" >OK</button>'+
				' <button type="button" class="btn btn-primary" id="reenablecancel" aria-expanded="false" >Cancel</button></div>'+
				' </div>'+
				' </div></div>';
        	
        	$("#page-header").append(reenable_modal);
        	
        	var drop_modal =
				' <div id="dropModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div id = "dropdialog" class="modal-dialog" style="max-width:351px">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: #020082;height: 50px;">' +
				' <h4 class="modal-title" id="dropTitle" style="margin-left: 20px;color: white;padding-top: 10px;">Drop Assessment</h4> </div>' +
				' <div class="modal-body" id="dropAssessment">'+
				' <label>Do you want to drop the assessment for the selected associates?</label>' +    			    		    
				' </div>'+
				' <div class="modal-footer">'+ 					
				' <button type="button" class="btn btn-primary" id="dropOk" aria-expanded="false" >OK</button>'+
				' <button type="button" class="btn btn-primary" id="dropCancel" aria-expanded="false" >Cancel</button></div>'+
				' </div>'+
				' </div></div>';
        	
        	$("#page-header").append(drop_modal);        	        	
        	
        	$(document).on("click","#errorok",function() {    				
				$("#errorModal").modal("hide");				
			});
        	
        	var assessment_code = '';
        	$(document).on("click","#extendOk",function() {				
				$extend_time = $("#extend_minutes").val();
				assessment_code = $("#activityCode >div > div > button > span").text();
				
				if($extend_time == '' || $extend_time == ' '){
					$("#extend").append("<span style=\"color:#fb6464;\">*Minutes cannot be empty.</span>");
				} else if ($extend_time <= 0){
					$("#extend").append("<span style=\"color:#fb6464;\">*Provide a valid data.</span>");
				} else {					
					var assessment = [];	
        			$("input[name='selected_associates']:checked").each(function() {
        				assessment.push($(this).val());		   
        			});	
        			
        			var assessment_data = JSON.stringify(assessment);
        			
        			$.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/support_ajax.php",
    					data: {
    						"choice" : "extend_time",
    						"assessment_date" : $("#assessment_date").val(),
    						"assessment_code" : assessment_code,
    						"extend_minutes" : $extend_time,
    						"associate_data" : assessment_data,
    						"flag" : flag,
    						"download" : download
    					}
    				}).done(function(response) {
    					alert("Extended time for the selected associates successfully.");
    					$("#extendModal").modal("hide");
    					$("span", "#extend").empty().remove();
    					$("#associates_content").empty();
    					$("#associates_content").append(response);  					
    				});        			
				}				
			});
        	
        	$(document).on("click","#extendCancel",function() {        		
				$("#extendModal").modal("hide");
				$("span", "#extend").empty().remove();
			});
        	
        	$(document).on("click","#dropOk",function() {
        		
        		var assessment = [];
        		assessment_code = $("#activityCode > div > div > button > span").text();
        		var $date = $("#assessment_date").val();
        		
    			$("input[name='selected_associates']:checked").each(function() {
    				assessment.push($(this).val());		   
    			});	
    			
        		var assessment_data = JSON.stringify(assessment);
        		
				$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/support_ajax.php",
					data: {
						"choice" : "dropassessment",
						"assessment_date" : $("#assessment_date").val(),
						"assessment_code" : assessment_code,
						"associate_data" : assessment_data,
						"flag" : flag,
						"download" : download
					}
				}).done(function(response) {
					$("#dropModal").modal("hide"); 	
					document.location.reload(true);
				});
			});
        	
        	$(document).on("click","#dropCancel",function() {	
        		$("#dropModal").modal("hide");
			});
        	
        	$(document).on("click","#reenableok",function() {
        		
        		var $start_date = $("#start_date").val();
				var $start_time = $("#start_time").val();
				var $end_date = $("#end_date").val();
				var $end_time = $("#end_time").val();
				assessment_code = $("#activityCode > div > div > button > span").text();
				
				if($start_date == '' || $start_time == ''){
					$("#assessmentstart").append("<span style=\"color:#fb6464;\">*Assessment start time and end time is mandatory.</span>");
				} else if ($end_date == '' || $end_time == ''){
					$("#assessmentend").append("<span style=\"color:#fb6464;\">*Assessment start time and end time is mandatory.</span>");
				} else {															
					var assessment = [];	
        			$("input[name='selected_associates']:checked").each(function() {
        				assessment.push($(this).val());		   
        			});	
        			
        			var assessment_data = JSON.stringify(assessment);
        			
					$.ajax({
						method: "GET",
						url: M.cfg.wwwroot + "/blocks/assessment_scheduler/support_ajax.php",
						data: {
							"choice" : "re-open",
							"assessment_date" : $("#assessment_date").val(),
							"assessment_code" : assessment_code,
							"assessment_start_date" : $start_date+" "+$start_time,
							"assessment_end_date" : $end_date+" "+$end_time,
							"associate_data" : assessment_data,
							"flag" : flag,
							"download" : download
						}
					}).done(function(response) {
						if(response == "failure"){
							$("span", "#assessmentend").empty().remove();
							$("#assessmentend").append("<span style=\"color:#fb6464;\">*Assessment end time should be greater than assessment start time.</span>");
						} else if(response == "failure1"){
							$("span", "#assessmentstart").empty().remove();
							$("#assessmentstart").append("<span style=\"color:#fb6464;\">*Choose time greater than the current time.</span>");
						} else {							
							$("#reenableModal").modal("hide"); 
							if (response.indexOf(' ### ') >= 0){
								var res = response.split(" ### ");
								$success = res[1];
								$failure = res[0];
								$("span", "#assessmentstart").empty().remove();
								$("span", "#assessmentend").empty().remove();
								$("#associates_content").empty();
								$("#associates_content").append($success);
								$("#errorRegister").empty();        
								$("#errorRegister").append($failure);
								$("#errorModal").modal("show");
							} else {
								alert("Assessment has been re-opened successfully.");
								$("span", "#assessmentstart").empty().remove();
								$("span", "#assessmentend").empty().remove();
								$("#associates_content").empty();
								$("#associates_content").append(response);
							}								
						}						
					});
				}
								
			});
        	
        	$(document).on("click","#reenablecancel",function() {        		
				$("#reenableModal").modal("hide");
				$("span", "#assessmentstart").empty().remove();
				$("span", "#assessmentend").empty().remove();
			});        	        	        	      
        	
        	$("#code1").change(function(){
        		$assessment_code = $("#code1 option:selected").val();        		
        	});        		        	    	
        	
        	$("#search_assessment").click(function(){
        		
        		var $date = $("#assessment_date").val();
        		assessment_code = $("#activityCode > div > div > button > span").text();
        		
        		$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/support_ajax.php",
					data: {
						"choice" : "search",
						"assessment_date" : $date,
						"assessment_code" : assessment_code,
						"flag" : flag,
						"download" : download
					}
				}).done(function(response) {
					$("#associates_content").empty();
					$("#associates_content").append(response);
				});
        		
        	});
        	
        	$("#extendassociates").click(function(){
        		
        		var $date = $("#assessment_date").val();
        		var assessment = [];	
    			$("input[name='selected_associates']:checked").each(function() {
    				assessment.push($(this).val());		   
    			});	
    			
    			if(assessment.length > 0){
    				if($date != ''){    					
    					$.ajax({
        					method: "GET",
        					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/support_ajax.php",
        					data: {
        						"choice" : "check_time",
        						"assessment_date" : $date, 
        						"flag" : flag,
        						"download" : download
        					}
        				}).done(function(response) {
        					if(response == "failure"){
        						alert("Cannot extend time because the selected time is lesser or greater than the current date.");
        					} else {
        						$("#extendModal").modal("show");
        					}    					
        				});    					
    				} else {
    					$("#extendModal").modal("show");
    				}   				    				    		
    			} else {
    				alert("Please select the associates for time extension.");
    			}
        	});
        	
        	$("#unlock").click(function(){
        		var assessment = [];
        		assessment_code = $("#activityCode > div > div > button > span").text();
        		
    			$("input[name='selected_associates']:checked").each(function() {
    				assessment.push($(this).val());		   
    			});	
    			if(assessment.length > 0){
    				var assessment_data = JSON.stringify(assessment);
    				$.ajax({
						method: "GET",
						url: M.cfg.wwwroot + "/blocks/assessment_scheduler/support_ajax.php",
						data: {
							"choice" : "active",
							"assessment_date" : $("#assessment_date").val(),
							"assessment_code" : assessment_code,
							"associate_data" : assessment_data,
							"flag" : flag,
							"download" : download
						}
					}).done(function(response) {
						if(response == "failure"){
							alert("Cannot activate assessments because the selected time is lesser or greater than the current date.");
						} else {
							alert("Selected associates has been activated.");
							$("#associates_content").empty();
							$("#associates_content").append(response);
						}															
					});
    			} else {
    				alert("Please select the associates to activate the assessment.");
    			}
    			
        	});

			$("#re-enable").click(function(){
				var assessment = [];	
    			$("input[name='selected_associates']:checked").each(function() {
    				assessment.push($(this).val());		   
    			});	
    			
    			if(assessment.length > 0){
    				$("#reenableModal").modal("show");    				
    			} else {
    				alert("Please select the associates for re-opening the assessment.");
    			}				
			});						
			
			$("#dropassessment").click(function(){
				var assessment = [];
        		assessment_code = $("#activityCode > div > div > button > span").text();
        		var $date = $("#assessment_date").val();
        		
    			$("input[name='selected_associates']:checked").each(function() {
    				assessment.push($(this).val());		   
    			});	
    			
    			if(assessment_code == '' || assessment_code == 'Select Activity Code') {
    				$("#activityCode").append("<span style=\"color:#fb6464;padding-left: 14px;\">*Activity Code cannot be empty.</span>");
    			} else if($date == '') {
    				$("#date_check").append("<span style=\"color:#fb6464;padding-left: 14px;\">*Date cannot be empty.</span>");
    			} else if(assessment.length > 0){
    				$("#dropModal").modal("show"); 
    			} else {
    				alert("Please select the associates to drop assessment.");
    			}				
			});
			
			 $(document).ready(function(){
				 $('#select-all').click(function(event) {   
					 if(this.checked) {       
						 $("input[name='selected_associates']").each(function() {
							 $(this).prop('checked', true);		   
						 });
					 } else {
						 $("input[name='selected_associates']").each(function() {
							 $(this).prop('checked', false);		   
						 });
					 }
				});
			 });			
			
			$("#exportgrade").click(function(){
								
        		assessment_code = $("#activityCode > div > div > button > span").text();
        		
        		$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/support_ajax.php",
					data: {
						"choice" : "gradeexport",
						"assessment_date" : $("#assessment_date").val(),
						"assessment_code" : assessment_code						
					}
				}).done(function(response) {
					if(response == "failure"){
						alert("None of the associates are graded on the filtered activity code and date.");
					} else {
						alert("Grade has been downloaded for the filtered activity code, date and the associates who have been graded.");
						$('head').append(response);
					}															
				});
        		
			});
		}
	};
});
define('block_assessment_scheduler/pdf_report', ['jquery'], function($) {

    return {
        init: function() {
            var rootPath = M.cfg.wwwroot;
            $("#bcid").change(function() {
                $('#cohortid').prop('selectedIndex', 0);
                $('#milestoneid').prop('selectedIndex', 0);
                $('#assessmentid').prop('selectedIndex', 0);
                $cohort = $('#cohortid option:selected').text();
                $("#studentid").load('pdf_ajax.php', "choice=get_data&cohorttext=" + $cohort);
                // $('#report_filter').removeClass('hidden');
            });
            $("#milestoneid").change(function() {
                $('#cohortid').prop('selectedIndex', 0);
                $cohort = $('#cohortid option:selected').text();
                $("#studentid").load('pdf_ajax.php', "choice=get_data&cohorttext=" + $cohort);
                // $('#report_filter').removeClass('hidden');
            });
            $("#assessmentid").change(function() {
                $('#cohortid').prop('selectedIndex', 0);
                $cohort = $('#cohortid option:selected').text();
                $("#studentid").load('pdf_ajax.php', "choice=get_data&cohorttext=" + $cohort);
                // $('#report_filter').removeClass('hidden');
            });

            $("#milestoneid").change(function() {
                $bu = $('#bcid option:selected').text();
                $cohort = $('#cohortid option:selected').text();
                $milestone = $('#milestoneid option:selected').text();
                $lp_data = 1;
                $("#assessmentid").load('pdf_ajax.php', "choice=get_data&butext=" + $bu + "&cohorttext=" + $cohort + "&milestonetext=" + $milestone + "&lptext=" + $lp_data);
            });

            $("#milestoneid").change(function() {
                $bu = $('#bcid option:selected').text();
                $milestone = $('#milestoneid option:selected').text();
                $cohort_param = 1;
                $("#cohortid").load('pdf_ajax.php', "choice=get_data&butext=" + $bu + "&milestonetext=" + $milestone + "&cohort_param=" + $cohort_param);
            });

            $("#cohortid").change(function() {
                $bu = $('#bcid option:selected').text();
                $cohort = $('#cohortid option:selected').text();
                $milestone = $('#milestoneid option:selected').text();
                $assessment = $('#assessmentid option:selected').val();
                $assessment_data = JSON.stringify($assessment);
                $("#cohortid option").each(function() {
                    $allcohort_data = $(this).text();
                });
                $('#studentid').html('<img src="https://media.giphy.com/media/NzMn60baeGIOA/giphy.gif" class="middle"/>');
                $("#studentid").load('pdf_ajax.php', "choice=get_data&butext=" + $bu + "&cohorttext=" + $cohort + "&milestonetext=" + $milestone + "&assessmenttext=" + $assessment + "&allcohorttext=" + $allcohort_data + "&assessmenttext1=" + $assessment_data);
                $('#report_filter').removeClass('hidden');
            });

            $(document).ready(function() {

                $(document).on('click', 'tr .reportclass', function() {
                    var studentvalues;
                    var milestone;
                    var assessment;
                    milestone = $('#milestoneid option:selected').text();
                    assessment = $('#assessmentid option:selected').val();
                    

                    var studentvalues = $(this).attr('id');
                    var assessment_courseids = $(this).closest('tr .reportclass').attr('class');;
                    var assessment_courseid = parseInt(assessment_courseids);


                    var student_data = JSON.stringify(studentvalues);
                    var milestone_data = JSON.stringify(milestone);
                    var assessment_data = JSON.stringify(assessment);

                    location.replace(rootPath + "/blocks/assessment_scheduler/pdf_ajax.php?choice=get_feedback&studentvalues=" + student_data + 
                    				"&milestone=" + milestone_data + "&assessment=" + assessment_data + "&assessment_courseid=" + assessment_courseid);
                });
            });
        }
    };
});
define('block_assessment_scheduler/script', ["jquery"],function(e){return{init:function(){e(location).attr("href"),M.cfg.wwwroot;e(document).ready(function(){e('#assessment a[href = "#completed"]').click(function(){document.getElementById("completed").style.display="block",document.getElementById("upcoming").style.display="none",document.getElementById("all").style.display="none",e("#completed_assessment").attr("class","nav-link active"),e("#upcoming_assessment").attr("class","nav-link"),e("#all_assessment").attr("class","nav-link")}),e('#assessment a[href = "#upcoming"]').click(function(){document.getElementById("upcoming").style.display="block",document.getElementById("completed").style.display="none",document.getElementById("all").style.display="none",e("#completed_assessment").attr("class","nav-link"),e("#upcoming_assessment").attr("class","nav-link active"),e("#all_assessment").attr("class","nav-link")}),e('#assessment a[href = "#all"]').click(function(){document.getElementById("upcoming").style.display="none",document.getElementById("completed").style.display="none",document.getElementById("all").style.display="block",e("#completed_assessment").attr("class","nav-link"),e("#upcoming_assessment").attr("class","nav-link"),e("#all_assessment").attr("class","nav-link active")});var t=new Date,s=+t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2),a=+t.getHours()+":"+("0"+t.getMinutes()).slice(-2),l=' <div id="assessmentModal" class="modal fade" style="padding-top: 100px;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog" style="max-width: 581px;"> <div class="modal-content"> <div class="modal-headers" style="background: #020082;height: 50px;"> <h4 class="modal-title" style="margin-left: 20px;color: white;padding-top: 10px;"> Reschedule Assessment </h4> </div> <div class="modal-body" > <div> <label><b>Assessment : </b></label> &nbsp; <label id="rescheduleAssessment"></label> </div> <div> <label><b>Assessment Date and Time: </b></label> &nbsp; <label id="actualDate"></label> </div> <div id="datetime"> <label><b>Assessment Date and Time to be changed: </b></label> &nbsp; <input type="date" name="Ext-date" id="ByDate" value="'+s+'" min="'+s+'"> &nbsp; &nbsp; <input type="time" name="Ext-time" id="ByTime" value="'+a+'" min="'+a+'"> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-primary" id="changeassessmentdate" aria-expanded="false"  > Reschedule </button> <button type="button" class="btn btn-primary" id="reschedulechanges" aria-expanded="false"  > Cancel </button> </div> </div></div>',n=' <div id="assessmentRegister" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog" style="max-width:550px"> <div class="modal-content" > <div class="modal-headers" style="background: #020082;height: 50px;"> <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;padding-top: 10px;"> <strong> Assessment Registration </strong> </div>  <div class="modal-body" > <div id="assessment_select"><label> <b> Assessment: </b> </label>  &nbsp; <select id="register_select" required>  </select></div><br> <div id="assessment_duration" style="display:none;"><label> <b>  Duration (In minutes): </b></label> &nbsp;  <input type="text" id="register_duration" name="duration"></div><br> <div id="register_datetime"> <label><b>Assessment Date and Time: </b></label> &nbsp; <input type="date" name="Ext-date" id="register_Date" value="'+s+'" min="'+s+'" required> &nbsp; &nbsp; <input type="time" name="Ext-time" id="register_Time" value="'+a+'" min="'+a+'" required> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-primary" id="register_submit" aria-expanded="false"> Register </button> <button type="button" class="btn btn-primary" id="register_cancel" aria-expanded="false"> Cancel </button></div> </div> </div></div>';e("#page-header").append(l),e("#page-header").append(' <div id="cancelassessmentModal" class="modal fade" style="padding-top: 100px;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog" style="max-width:404px"> <div class="modal-content"> <div class="modal-headers" style="background: #020082;height: 50px;"> <h4 class="modal-title" style="margin-left: 20px;color: white;padding-top: 10px;"> Cancel Assessment </h4> </div> <div class="modal-body" > <label>Do you want to cancel the following assessment?</label><br> <div> <label><b>Assessment : </b></label> &nbsp; <label id="assessmentName"></label> </div> <div> <label><b>Assessment Date and Time: </b></label> &nbsp; <label id="assessmentDate"></label> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-primary" id="cancelassessment" aria-expanded="false"  > OK </button> <button type="button" class="btn btn-primary" id="cancelchanges" aria-expanded="false"  > Cancel </button> </div> </div></div>'),e("#page-header").append(n),e("#page-header").append(' <div id="errorModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div id = "errordialog" class="modal-dialog" style="max-width:351px"> <div class="modal-content"> <div class="modal-headers" style="background: #020082;height: 50px;"> <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;color: white;padding-top: 10px;"> </h4> </div> <div class="modal-body" id="errorRegister"></div> <div class="modal-footer"> <button type="button" class="btn btn-primary" id="errorOk" style="display: none;" aria-expanded="false" >Ok</button> <button type="button" class="btn btn-primary" id="errorCancel" aria-expanded="false" >Ok</button></div> </div> </div></div>'),e("#assessment_registration").click(function(){e("span","#assessment_select").empty().remove(),e("span","#register_datetime").empty().remove(),e("#register_duration").prop("readonly",!1),d.val(""),e("#assessment_duration").attr("style","display:none;"),e("#register_select").val(""),e("#register_Date").val(s),e("#register_Time").val(a),e("#register_select").load(M.cfg.wwwroot+"/blocks/assessment_scheduler/register.php","assessment=technology"),e("#assessmentRegister").modal("show")}),e(document).on("click","#register_cancel",function(){e("#assessmentRegister").modal("hide")}),e(document).on("click","#errorCancel",function(){e("#errorModal").modal("hide"),e("#errorCancel").text("Ok"),e("#errorOk").attr("style","display:none;"),e("#errordialog").attr("style","width:351px;"),e("#confirmActionModalTitle").text("")}),e(document).on("click","#register_submit",function(){e("span","#assessment_select").empty().remove(),e("span","#register_datetime").empty().remove();var t=Number(e("#register_select").val().trim()),s=e("#register_Date").val(),a=e("#register_Time").val();""==e("#register_select").val()?(e("#assessment_select").append('<span style="color:#fb6464;">*Assessment is required.</span>'),""!=s&&""!=a||e("#register_datetime").append('<span style="color:#fb6464;">*Date and time are required.</span>')):e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/assessment_scheduler/register.php",data:{register:"register",date:s+" "+a,categoryid:t}}).done(function(t){"success"==t?(e("span","#register_datetime").empty().remove(),e("#assessmentRegister").modal("hide"),e("#errorRegister").html("<p>Successfully registered for this assessment.</p>"),e("#confirmActionModalTitle").text(""),e("#errorModal").modal("show"),document.location.reload(!0)):"failure"==t?e("#register_datetime").append('<span style="color:#fb6464;">*Choose time greater than the current time.</span>'):(1==t.includes("table")&&e("#errordialog").attr("style","width:600px;"),e("span","#register_datetime").empty().remove(),e("#assessmentRegister").modal("hide"),e("#errorRegister").html(t),e("#confirmActionModalTitle").text("Failed Registration"),e("#errorModal").modal("show"))})});var i=e("#register_select"),d=e("#register_duration");"Select"===e("#register_select option:selected").text()&&(e("#register_duration").prop("readonly",!1),d.val(""),e("#assessment_duration").attr("style","display:none;")),i.change(function(){var t=e("#register_select option:selected").text(),s=Number(i.val().trim());"Select"===t?(e("#register_duration").prop("readonly",!1),d.val(""),e("#assessment_duration").attr("style","display:none;")):e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/assessment_scheduler/ajax.php",data:{duration:s}}).done(function(t){d.val(t),e("#register_duration").prop("readonly",!0),e("#assessment_duration").removeAttr("style").hide(),e("#assessment_duration").show()})})})},report:function(){e(location).attr("href").includes("blocks/assessment_scheduler/report.php")&&(e("#choose_skill").change(function(){e("#attempt_element").css("display","none"),e("#pdf_report").css("display","none"),e("#response_msg").css("display","none");var t=e("#choose_skill option:selected").val();e("#choose_attempt").load("report_ajax.php","action=chooseattempt&id="+t),e("#attempt_element").css("display","block")}),e("#choose_attempt").change(function(){var t=e("#choose_attempt option:selected").val();e("#response_msg").css("display","none"),e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/assessment_scheduler/report_ajax.php",data:{action:"check_pdf",id:t}}).done(function(t){var s=JSON.parse(t);s.success?(e("#pdf_report_path").attr("href",s.response),e("#pdf_report").css("display","block")):(e("#response_msg").css("display","block"),e("#response_msg").html(s.response))})}))}}});
define('block_assessment_scheduler/enrol', ['jquery'], function($) {

    return {
        init: function(activity_code) {


            $(document).ready(function() {

                $('#confirm').click(function() {
                    $('#enrol').hide();
                    $data = 1;
                    var hrefurl = M.cfg.wwwroot + "/blocks/assessment_scheduler/enrol_assessment.php?activitycode=" + activity_code + "&data=" + $data;
                    window.location.href = hrefurl;
                });
                $('#cancel').click(function() {
                    $('#enrol').hide();
                    var hrefurl = M.cfg.wwwroot;

                    window.location.href = hrefurl;
                });
            });

        }
    };
});
define('block_assessment_scheduler/schedule', ['jquery'], function($) {
	 return {
		 init: function() {
			 var url=  $(location).attr('href');
			 
			 $( document ).ready(function() {
				 
		      //$('milestonediv').hide();
			
			  $("#searchcohort").on("mouseup",function() {
				                  
                    var tagstr=$("#searchcohort").val();
                    if(tagstr!=''){
                     var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)"> &times;</button>');
                             var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                             spant.append(st);
                             $('#divcohort').append('    ');
                             $('#divcohort').append(spant);
                            $("#searchcohort").val('');
                            tagex=tagex+1;
                            tagspanexid=tagspanexid+1;
           
                      }
			  });
				        		 
        		 $("#searchcohort").keypress(function(e) {
               	    if(e.which == 13) {
               	    	 var tagstr=$("#searchcohort").val();
               	    	if(tagstr!=''){
               	    	 var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)"> &times;</button>');
                 		 var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                 		 spant.append(st);
                 		 $('#divcohort').append('    ');
                 		 $('#divcohort').append(spant);
                 		$("#searchcohort").val('');
                 		tagex=tagex+1;
                 		tagspanexid=tagspanexid+1;
               	    	}	
               	    }
               	});
				 
				 

function autocomplete(inp, arr) {
	        				
	  /*the autocomplete function takes two arguments,
	  the text field element and an array of possible autocompleted values:*/
	  var currentFocus;
	  /*execute a function when someone writes in the text field:*/
	  inp.addEventListener("input", function(e) {
	      var a, b, i, val = this.value;
	      /*close any already open lists of autocompleted values*/
	      closeAllLists();
	      if (!val) { return false;}
	      currentFocus = -1;
	      /*create a DIV element that will contain the items (values):*/
	      a = document.createElement("DIV");
	      a.setAttribute("id", this.id + "autocomplete-list");
	      a.setAttribute("class", "autocomplete-items");
	      /*append the DIV element as a child of the autocomplete container:*/
	      this.parentNode.appendChild(a);
	      /*for each item in the array...*/
	      for (i = 0; i < arr.length; i++) {
	        /*check if the item starts with the same letters as the text field value:*/
	        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
	          /*create a DIV element for each matching element:*/
	          b = document.createElement("DIV");
	          /*make the matching letters bold:*/
	          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
	          b.innerHTML += arr[i].substr(val.length);
	          /*insert a input field that will hold the current array item's value:*/
	          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
	          /*execute a function when someone clicks on the item value (DIV element):*/
	              b.addEventListener("click", function(e) {
	              /*insert the value for the autocomplete text field:*/
	              inp.value = this.getElementsByTagName("input")[0].value;
	              /*close the list of autocompleted values,
	              (or any other open lists of autocompleted values:*/
	              closeAllLists();
	          });
	          a.appendChild(b);
	        }
	      }
	  });
	  
	  /*execute a function presses a key on the keyboard:*/
	  inp.addEventListener("keydown", function(e) {
	      var x = document.getElementById(this.id + "autocomplete-list");
	      if (x) x = x.getElementsByTagName("div");
	      if (e.keyCode == 40) {
	    	
	        /*If the arrow DOWN key is pressed,
	        increase the currentFocus variable:*/
	        currentFocus++;
	        
	        
	        
	        /*and and make the current item more visible:*/
	        addActive(x);
	        
	      } else if (e.keyCode == 38) { //up
	        /*If the arrow UP key is pressed,
	        decrease the currentFocus variable:*/
	        currentFocus--;
	        /*and and make the current item more visible:*/
	        addActive(x);
	      } else if (e.keyCode == 13) {
	        /*If the ENTER key is pressed, prevent the form from being submitted,*/
	        
	        if (currentFocus > -1) {
	          /*and simulate a click on the "active" item:*/
	          if (x) x[currentFocus].click();
	        }
	      }
	  });
	  
	  function addActive(x) {
	    /*a function to classify an item as "active":*/
	    if (!x) return false;
	    /*start by removing the "active" class on all items:*/
	    removeActive(x);
	    if (currentFocus >= x.length) currentFocus = 0;
	    if (currentFocus < 0) currentFocus = (x.length - 1);
	    /*add class "autocomplete-active":*/
	    x[currentFocus].classList.add("autocomplete-active");
	  }
	  function removeActive(x) {
	    /*a function to remove the "active" class from all autocomplete items:*/
	    for (var i = 0; i < x.length; i++) {
	      x[i].classList.remove("autocomplete-active");
	    }
	  }
	  function closeAllLists(elmnt) {
	    /*close all autocomplete lists in the document,
	    except the one passed as an argument:*/
	    var x = document.getElementsByClassName("autocomplete-items");
	    for (var i = 0; i < x.length; i++) {
	      if (elmnt != x[i] && elmnt != inp) {
	      x[i].parentNode.removeChild(x[i]);
	    }
	  }
	}
	/*execute a function when someone clicks in the document:*/
	document.addEventListener("click", function (e) {
	    closeAllLists(e.target);
     				
var tagstr=$("#searchcohort").val();
if(tagstr!=''){
         var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)"> &times; </button>');
         var spant = $('<span id="'+tagstr+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
         spant.append(st);
         $('#divcohort').append('    ');
         $('#divcohort').append(spant);
         $("#searchcohort").val('');
         tagex=tagex+1;
         tagspanexid=tagspanexid+1;
   
        }
});


}

$.ajax({	
		method: "POST",
		url: M.cfg.wwwroot + '/blocks/assessment_scheduler/scheduleajax.php',
		data: {"choice" : "get_cohorts"}
	})
	.done(function( response ) {     				
		if(response.indexOf("font") == -1){
			var ary=response.substring(0, response.length-1);
			ary=ary.substring(1);
			ary=ary.replace(/"/g, '');
			var final=ary.split(',');
			//autocomplete(document.getElementById("taginclude"), final);
			autocomplete(document.getElementById("searchcohort"), final);
		}
		else {
			$('#errormessage').append(response);
			$('#error_div').removeAttr('hidden');
		}
		
	});


$("#subcohort").click( function() {
	
		var cohorts='';
		$('#divcohort').find('span').each(function() { 
		   var tagids = this.id;
		   if(tagids!=''){
		       cohorts=cohorts+tagids+',';
		   }
		
		});
		cohorts = cohorts.substring(0, cohorts.length-1);
		
		$.ajax({	
			method: "POST",
			url: M.cfg.wwwroot + '/blocks/assessment_scheduler/scheduleajax.php',
			data: {"choice" : "get_milestones","cohorts" :cohorts }
		})
		.done(function( response ) { 
			
			if(response.indexOf("font") == -1){
				$('#milestoneselect').empty();
				$('#milestonediv').removeAttr('hidden');
    			$('#milestoneselect').append(response);
			}
			else {
				$('#errormessage').append(response);
				$('#error_div').removeAttr('hidden');
			}
			
		});

		
			 
     });
   		      

$("#milestoneselect").change(function() {
	
	 var milestonecode = $( "#milestoneselect option:selected" ).val();
	 
	 var cohorts='';
		$('#divcohort').find('span').each(function() { 
		   var tagids = this.id;
		   if(tagids!=''){
		       cohorts=cohorts+tagids+',';
		   }
		
		});
		cohorts = cohorts.substring(0, cohorts.length-1);
	 
	 
	 if(milestonecode == "ICT") {
		 $.ajax({	
				method: "POST",
				url: M.cfg.wwwroot + '/blocks/assessment_scheduler/scheduleajax.php',
				data: { "choice" : "get_ict","cohorts" :cohorts }
			})
			.done(function( response ) {

			if(response.indexOf("font") == -1){
				if($('#assessment_table tr').length !=0) {
					$('#assessment_table tr:gt(0)').remove();
				}
				$('#assessment_table').append(response);
				
				var today = (new Date()).toISOString().split('T')[0];
				
				$('.start').prop('min', today);
				$('.end').prop('min', today);
				
				var dt = new Date();
				var time = dt.getHours() + ":" + dt.getMinutes();
			
				$('.start_time').prop('min', time);
				$('.end_time').prop('min', time);
				
				$('.start').change(function(){
				    var str1 = this.id; 
				    var endDateID = str1.replace('start','end'); 
				    var startDateValue = $('#'+ str1).val();  
				    $('#'+ endDateID).prop('min', startDateValue);
				    
				  });
				  $('.end').change(function(){
				    var str2 = this.id; 
				    var startDateID = str2.replace('end','start');
				    var endDateValue = $('#'+ str2).val(); 
				    $('#'+ startDateID).prop('max', endDateValue);
				  });
				
				  $("#selectall").click(function () {
			            $('.name').attr('checked', this.checked);
			        });
				    // if all checkbox are selected, then check the select all checkbox
			        // and viceversa
				  $('.name').change(function () {
				        var check = ($('.name').filter(":checked").length == $('.name').length);
				        $('#selectall').prop("checked", check);
				    });
				
				$('#ccdiv').removeAttr('hidden');
				$('#buttondiv').removeAttr('hidden');
			}
			else {
				$('#milestoneselect').remove();
				$('#errormessage').append(response);
				$('#error_div').removeAttr('hidden');
			}


				
				
			});
	 }
	 
	 else {
		 $.ajax({	
				method: "POST",
				url: M.cfg.wwwroot + '/blocks/assessment_scheduler/scheduleajax.php',
				data: { "choice" : "get_cc","milestonecode" :milestonecode }
			})
			.done(function( response ) {

            if(response.indexOf("font") == -1){
				if($('#assessment_table tr').length !=0) {
					$('#assessment_table tr:gt(0)').remove();
				}
				$('#assessment_table').append(response);
				
				var today = (new Date()).toISOString().split('T')[0];
				
				$('.start').prop('min', today);
				$('.end').prop('min', today);
				
				var dt = new Date();
				var time = dt.getHours() + ":" + dt.getMinutes();
			
				$('.start_time').prop('min', time);
				$('.end_time').prop('min', time);
				
				$('.start').change(function(){
				    var str1 = this.id; 
				    var endDateID = str1.replace('start','end'); 
				    var startDateValue = $('#'+ str1).val();  
				    $('#'+ endDateID).prop('min', startDateValue);
				    
				  });
				  $('.end').change(function(){
				    var str2 = this.id; 
				    var startDateID = str2.replace('end','start');
				    var endDateValue = $('#'+ str2).val(); 
				    $('#'+ startDateID).prop('max', endDateValue);
				  });
				
				  
				  $("#selectall").click(function () {
			            $('.name').attr('checked', this.checked);
			        });
				    // if all checkbox are selected, then check the select all checkbox
			        // and viceversa
				  $('.name').change(function () {
				        var check = ($('.name').filter(":checked").length == $('.name').length);
				        $('#selectall').prop("checked", check);
				    });
				  
				
				$('#ccdiv').removeAttr('hidden');
				$('#buttondiv').removeAttr('hidden');
			}
			else {
				$('#milestoneselect').remove();
				$('#errormessage').append(response);
				$('#error_div').removeAttr('hidden');
			}
				
				
			});
	 }

});	


$("#resetpage").click( function() {
	$("#milestonediv").attr("hidden",true);
	$('#ccdiv').attr("hidden",true);
	$("#buttondiv").attr("hidden",true);
	$("#finalerror").attr("hidden",true);
	$("#errordiv").remove();
});

$("#reload").click( function() {
	location.replace(M.cfg.wwwroot + '/blocks/assessment_scheduler/schedule_assessment.php');
			
});


$("#scheduleass").click(function() {
    var cohorts='';
	$('#divcohort').find('span').each(function() { 
	   var tagids = this.id;
	   if(tagids!=''){
	       cohorts=cohorts+tagids+',';
	   }
	
	});
	cohorts = cohorts.substring(0, cohorts.length-1);

	var TableData;
	TableData = storeTblValuesEdit();
	
    var excludeusers = $('textarea#excledeusers').val();
	
	if( excludeusers ) {
		$.ajax({	
			method: "POST",
			url: M.cfg.wwwroot + '/blocks/assessment_scheduler/scheduleajax.php',
			data: {"choice" : "schedule_assessments", "assessments" :TableData, "excludeusers" : excludeusers, "cohorts" :cohorts}
		})
		.done(function( response ) {
			if(response.indexOf("font") == -1){
				location.replace(M.cfg.wwwroot + '/blocks/assessment_scheduler/schedule_assessment_success.php');
			}
			else {
				$('#finalerror').removeAttr('hidden');
			}
	     });
	}
	
	else {
		$.ajax({	
			method: "POST",
			url: M.cfg.wwwroot + '/blocks/assessment_scheduler/scheduleajax.php',
			data: {"choice" : "schedule_assessments", "assessments" :TableData, "cohorts" :cohorts}
		})
		.done(function( response ) {

			if(response.indexOf("font") == -1){
				location.replace(M.cfg.wwwroot + '/blocks/assessment_scheduler/schedule_assessment_success.php');
			}
			else {
				$('#finalerror').removeAttr('hidden');
			}

         });
	}
    
    
    
    
    function storeTblValuesEdit()  {
             var TableData = new Array();
             $('#assessment_table tr').each(function(row, tr){ 
            	 if($(tr).find('td:eq(0) input').is(':checked') == true) { 
            		 TableData[row]={  
            	               "assessmentname": $(tr).find('td:eq(1)').text(),
            	                    "startdate" : $(tr).find('td:eq(2) input').val(),
            	                    "starttime" : $(tr).find('td:eq(3) input').val(),
            	                    "enddate" : $(tr).find('td:eq(4) input').val(),
            	                    "endtime" : $(tr).find('td:eq(5) input').val(),
            	                 } 
            	  }
              }); 
            	
             
            TableData.shift(); 
            TableData= JSON.stringify(TableData);
            return TableData;
     }
});
	        		 
	       });
			 
		 }
	 
	 };	
	
});
define('block_assessment_scheduler/manage', ['jquery'], function($) {
 
    return {
        init: function(args) {        	
        	var url=  $(location).attr('href');
        	var rootPath = M.cfg.wwwroot; 
        	var $assessment_id = args;
        	
        	var modalHtml =
				' <div id="confirmationModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:351px">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;color: white;"> </h4> </div>' +
				' <div class="modal-body" id="confirmActionBody"></div>'+
				' <div class="modal-footer">'+ 					
				' <button type="button" class="btn btn-default" id="ok" aria-expanded="false" >Ok</button>'+
				' <button type="button" class="btn btn-default" id="cancel" aria-expanded="false" >Cancel</button></div>'+
				' </div>'+
				' </div></div>';
						        						
			if(url.includes('blocks/assessment_scheduler/view.php')){
				
				$('#assessment a[href = "#completed"]').click( function(){        			
        			document.getElementById("completed").style.display = "block";
        			document.getElementById("reevaluation").style.display = "none";
        			document.getElementById("notstarted").style.display = "none";
        			$("#completed_users").attr("class","nav-link active");
        			$("#reevaluation_users").attr("class","nav-link");
        			$("#notstarted_users").attr("class","nav-link");
        		});
        		
        		$('#assessment a[href = "#reevaluation"]').click( function(){        			
        			document.getElementById("completed").style.display = "none";
        			document.getElementById("reevaluation").style.display = "block";  
        			document.getElementById("notstarted").style.display = "none";
        			$("#completed_users").attr("class","nav-link");
        			$("#reevaluation_users").attr("class","nav-link active");
        			$("#notstarted_users").attr("class","nav-link");
        		});
        		
        		$('#assessment a[href = "#notstarted"]').click( function(){        			
        			document.getElementById("completed").style.display = "none";
        			document.getElementById("reevaluation").style.display = "none";
        			document.getElementById("notstarted").style.display = "block";
        			$("#completed_users").attr("class","nav-link");
        			$("#reevaluation_users").attr("class","nav-link");
        			$("#notstarted_users").attr("class","nav-link active");
        		});
			}
			
        	if(url.includes('blocks/assessment_scheduler/add.php')){
        		
        		$("#page-header").append(modalHtml);
        		
        		var $category = $('#id_categoryId');
        		var $duration = $("#id_frm .fitem:nth-child(5)");
        		var $passmark = $("#id_frm .fitem:nth-child(6)");
        		var $password = $("#id_frm .fitem:nth-child(7)");
        		var $profile = $("#id_frm .fitem:nth-child(8)");
        		var $maximumUsers = $("#id_frm .fitem:nth-child(9)");
        		var $threshold = $("#id_frm .fitem:nth-child(10)");
        		var $reattemptCount = $("#id_frm .fitem:nth-child(11)");
        		var $reattemptDuration = $("#id_frm .fitem:nth-child(12)");
        		
        		if($('#id_categoryId option:selected').text() === "Select"){
        			$duration.removeClass('show');
        			$duration.addClass('hidden');
        			$passmark.removeClass('show');
        			$passmark.addClass('hidden');
        			$password.removeClass('show');
        			$password.addClass('hidden');
        			$profile.removeClass('show');
        			$profile.addClass('hidden');
        			$maximumUsers.removeClass('show');
        			$maximumUsers.addClass('hidden'); 
        			$threshold.removeClass('show');
        			$threshold.addClass('hidden'); 
        			$reattemptCount.removeClass('show');
        			$reattemptCount.addClass('hidden'); 
        			$reattemptDuration.removeClass('show');
        			$reattemptDuration.addClass('hidden');  
        		}
        		
        		$category.change(function(){
        			var $categoryName = $('#id_categoryId option:selected').text();
        			
        			if($categoryName === "Select"){        				
        				$duration.removeClass('show');
            			$duration.addClass('hidden'); 
            			$passmark.removeClass('show');
            			$passmark.addClass('hidden');
            			$password.removeClass('show');
            			$password.addClass('hidden');
            			$profile.removeClass('show');
            			$profile.addClass('hidden');
            			$maximumUsers.removeClass('show');
            			$maximumUsers.addClass('hidden'); 
            			$threshold.removeClass('show');
            			$threshold.addClass('hidden'); 
            			$reattemptCount.removeClass('show');
            			$reattemptCount.addClass('hidden'); 
            			$reattemptDuration.removeClass('show');
            			$reattemptDuration.addClass('hidden'); 
        			} else {
        				$duration.removeClass('hidden');
        				$duration.addClass('show'); 
        				$passmark.removeClass('hidden');
        				$passmark.addClass('show'); 
        				$password.removeClass('hidden');
        				$password.addClass('show'); 
        				$profile.removeClass('hidden');
        				$profile.addClass('show'); 
            			$maximumUsers.removeClass('hidden');
            			$maximumUsers.addClass('show'); 
            			$threshold.removeClass('hidden');
            			$threshold.addClass('show'); 
            			$reattemptCount.removeClass('hidden');
            			$reattemptCount.addClass('show'); 
            			$reattemptDuration.removeClass('hidden');
            			$reattemptDuration.addClass('show'); 
        			}
        		});
        	}
        	
        	if(url.includes('blocks/assessment_scheduler/edit.php')){
        		var $category = $('#id_categoryId');
        		var $technology = $('#id_assessmentName');
        		var $activityCode = $('#id_activityCode');
        		var $activityFK = $('#id_activityFK');
        		$category.prop('disabled', true);
        		$technology.prop('readonly', true);
        		$activityCode.prop('readonly', true);
        		$activityFK.prop('readonly', true);
        		
        		$('#id_edit').click(function(){
        			$category.prop('disabled', false);
        		});
        	}
        	
        	if(url.includes('blocks/assessment_scheduler/manageassessments.php')){
        		
        		$("#page-header").append(modalHtml);
        		
        		$('#manageAssessments a[href = "#activeAssessments"]').click( function(){        			
             		$("#activeAssessments").attr("class","nav-link active");
        			$("#draftAssessments").attr("class","nav-link");
        			$("#inactiveAssessments").attr("class","nav-link");        			
        			$("#active").css("display", "block");
        			$("#draft").css("display", "none");
        			$("#inactive").css("display", "none");
        		});
        		
        		$('#manageAssessments a[href = "#draftAssessments"]').click( function(){           			
        			$("#activeAssessments").attr("class","nav-link");
        			$("#draftAssessments").attr("class","nav-link active");
        			$("#inactiveAssessments").attr("class","nav-link");        			
        			$("#active").css("display", "none");
        			$("#draft").css("display", "block");
        			$("#inactive").css("display", "none");
        		});

        		$('#manageAssessments a[href = "#inactiveAssessments"]').click( function(){        			        			
        			$("#activeAssessments").attr("class","nav-link");
        			$("#draftAssessments").attr("class","nav-link");
        			$("#inactiveAssessments").attr("class","nav-link active");        			
        			$("#active").css("display", "none");
        			$("#draft").css("display", "none");
        			$("#inactive").css("display", "block");
        		});
        		
        		$('input[type="checkbox"]').click(function(){
                    if($(this).prop("checked") == true){
                    	$('#publishAssessment').attr("disabled", false);
                    } else if($(this).prop("checked") == false){
						var course = [];	
        				$("input[name='draft_assessment']:checked").each(function() {
        					course.push($(this).val());		   
        				});
						if(course.length <= 0) {
							$('#publishAssessment').attr("disabled", true);
						}	                    	
                    }
                });
        		
        		$('#publishAssessment').click(function(){
        			var course = [];	
        			$("input[name='draft_assessment']:checked").each(function() {
        				course.push($(this).val());		   
        			});	

        			var coursedata = JSON.stringify(course);

        			var coursename = '';
        			var course_name = '';
        			
        			for (index = 0; index < course.length; index++) {		
        				courseid = course[index].split(" # ");
        				var course_name = '';
        				for(i = 1; i < courseid.length; i++){
        					if(i == courseid.length-1){
        						course_name = course_name +''+ courseid[i];
        					} else {
        						course_name = course_name +''+ courseid[i]+' ';
        					}			
        				}
        				if(index == course.length-1){
        					if(index == 0){
        						coursename = coursename +''+ course_name;
        					} else {
        						coursename = coursename +'and '+ course_name;
        					}			
        				} else {
        					coursename = coursename +''+ course_name +', ';
        				}			
        			} 
        			
        			$("#confirmationModal").modal("show");	
        			$('#confirmActionModalTitle').text("Confirmation");
        			$('#confirmActionBody').html("<p>Do you want to publish the following assessments?</p>");	
        			
        			var attempt_html = "";
        			
        			for (index = 0; index < course.length; index++) {	
        				courseid = course[index].split(" # ");
        				Course_id = courseid[0];
						var temp = '<label for="cars">Select Status: </label>&nbsp;&nbsp;'+
									'<select name="Status" id="status_'+Course_id+'">'+
  										'<option value="Active">Active</option>'+
										'<option value="New">New</option>'+
									'</select><br>';
						temp += '<label>'+course[index]+'</label><br>';									
        				temp += '<label>Attempt</label> : <input type="number" value="" id='+Course_id+'></input><br>';
        				attempt_html += temp;
        			}
        			$('#confirmActionBody').append(attempt_html);
        			
        			$(document).on("click","#cancel",function() {
        				$("#confirmationModal").modal("hide");
        			});
        			
        			$(document).on("click","#ok",function() {
        				$("#confirmationModal").modal("hide");	
						$('#ok').attr("disabled", true);
        				var course_list = [];
        				for (index = 0; index < course.length; index++) {	
            				courseid = course[index].split(" # ");
            				Course_id = courseid[0];
            				attempt = $('#'+Course_id).val();
							status = $('#status_'+Course_id+' option:selected').val();
            				course_list.push(course[index]+' # '+attempt + ' # '+status); 
        				}  
        				var coursedata = JSON.stringify(course_list);
        				$.ajax({
        					method: "GET",
        					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/ajax.php",
        					data: {"publish" : coursedata,"assessment_id" : $assessment_id}
        				}).done(function( response ) {
        					$('#publishAssessment').attr("disabled", true);
							$('#ok').attr("disabled", false);
        					document.location.reload(true);        					
        				});
        			});
        		});
        		
        		var active_course_id = 0;
        		var active_coure_name = '';
        		var inactive_course_id = 0;
        		var inactive_course_name = '';
				var inactive_status = '';
        		
        		$('input[type=radio][name=active_assessment]').change(function() {
        			$('#retireAssessment').attr("disabled", false);
        			$('#suspendAssessment').attr("disabled", false);
        			var active_course = this.value;    
        		    var res = active_course.split(" ");
        		    active_course_id = Number(res[0]);        		        
        		    
        		    for(i = 1; i < res.length; i++){
    					if(i == res.length-1){
    						active_coure_name = active_coure_name +''+ res[i];
    					} else {
    						active_coure_name = active_coure_name +''+ res[i]+' ';
    					}			
    				}
        		});
        		
        		$('input[type=radio][name=inactive_assessment]').change(function() {
        			$('#activateAssessment').attr("disabled", false);
        			var inactive_course = this.value; 
        			var res = inactive_course.split("##");
        			inactive_course_id = Number(res[0]);  
					inactive_status = res[2];      			
        			
        			for(i = 1; i < res.length; i++){
    					if(i == res.length-1){
    						inactive_course_name = inactive_course_name +''+ res[i];
    					} else {
    						inactive_course_name = inactive_course_name +''+ res[i]+' ';
    					}			
    				}
        		});
        		
        		$('#retireAssessment').click(function(){
        			
        			$("#confirmationModal").modal("show");	
        			$('#confirmActionModalTitle').text("Confirmation");
					var temp = "<p>Do you want to retire <b>"+active_coure_name+"</b> assessment?</p><br>";
					temp += '<label>Reasons : </label> <textarea class="form-control" id="reason"></textarea>';
        			$('#confirmActionBody').html(temp);	
        			
        			$(document).on("click","#cancel",function() {
        				$("#confirmationModal").modal("hide");
        			});
        			
        			$(document).on("click","#ok",function() {
						var reason = $("#reason").val();
        				$("#confirmationModal").modal("hide");		
        				$.ajax({
        					method: "GET",
        					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/ajax.php",
        					data: {"retire" : "retire", "reason":reason, "courseId" : active_course_id}
        				}).done(function( response ) {        					
        					document.location.reload(true);
        				});
        			});
        		});
        		
        		$('#suspendAssessment').click(function(){
        			
        			$("#confirmationModal").modal("show");	
        			$('#confirmActionModalTitle').text("Confirmation");
					var temp = "<p>Do you want to suspend <b>"+active_coure_name+"</b> assessment?</p><br>";
					temp += '<label>Reasons : </label> <textarea class="form-control" id="reason"></textarea>';
        			$('#confirmActionBody').html(temp);        				
        			
        			$(document).on("click","#cancel",function() {
        				$("#confirmationModal").modal("hide");
        			});
        			
        			$(document).on("click","#ok",function() {
						var reason = $("#reason").val();
        				$("#confirmationModal").modal("hide");		
        				$.ajax({
        					method: "GET",
        					url: M.cfg.wwwroot + "/blocks/assessment_scheduler/ajax.php",
        					data: {"suspend" : "suspend", "reason":reason, "courseId" : active_course_id}
        				}).done(function( response ) {        					
        					document.location.reload(true);
        				});
        			});
        		});
        		
        		$('#activateAssessment').click(function(){					
        			$("#confirmationModal").modal("show");	
        			$('#confirmActionModalTitle').text("Confirmation");
					var temp = '';
					if(inactive_status == "New") {
						temp += '<label for="cars">Select Status: </label>&nbsp;&nbsp;'+
									'<select name="Status" id="status">'+
										'<option value="">Select</option>'+
  										'<option value="Active">Active</option>'+										
									'</select><br>';
					} else if (inactive_status == "Retired"){
						temp += '<label for="cars">Select Status: </label>&nbsp;&nbsp;'+
									'<select name="Status" id="status">'+
										'<option value="">Select</option>'+
  										'<option value="Active">Active</option>'+
										'<option value="New">New</option>'+
										'<option value="Suspended">Suspend</option>'+										
									'</select><br>';
					} else {
						temp += '<label for="cars">Select Status: </label>&nbsp;&nbsp;'+
									'<select name="Status" id="status">'+
										'<option value="">Select</option>'+
  										'<option value="Active">Active</option>'+
										'<option value="New">New</option>'+
										'<option value="Retired">Retire</option>'+										
									'</select><br>';
					}
					
					temp += '<label>Attempt </label>: <input type="number" value="" id="attempt"></input><br>';
					
        			$('#confirmActionBody').html(temp);
        			
        			$(document).on("click","#cancel",function() {
        				$("#confirmationModal").modal("hide");
        			});
        			
        			$(document).on("click","#ok",function() {
						$status = $('#status option:selected').val();
						$('#ok').attr("disabled", true);	
						$attempt = $('#attempt').val();					
						if($status != '') {							
							$("#confirmationModal").modal("hide");								
        					$.ajax({
        						method: "GET",
        						url: M.cfg.wwwroot + "/blocks/assessment_scheduler/ajax.php",
        						data: {"activate" : "activate", "status" : $status, "attempt" : $attempt, "courseId" : inactive_course_id}
        					}).done(function( response ) {        					
        						document.location.reload(true);
        					});	
						} else {
							$('#ok').attr("disabled", false);
							$("#status").append("<span style=\"color:#fb6464;\">*Choose the appropriate status.</span>");							
						}        				
        			});
        		});        		        	
        	}
        	
        	if(url.includes('blocks/assessment_scheduler/upload_users.php')){
        		$('#continue').click(function(){
        			window.location.href = M.cfg.wwwroot + "/blocks/assessment_scheduler/upload_users.php";
        		});
        	}
        }
    };
});
define('block_coursetimer/participant', ['jquery', 'core/ajax'], function($, ajax) {
	return { 
		init: function() {

		$('#ct_clearchanges').click(function(){	
					var courseid = GetUrlParameter('courseid');
			    	var promises = ajax.call([{
			        methodname: 'block_coursetimer_clear_enroll',
					args: { 'courseid': courseid }
			       },
			]);
			
		    promises[0].done(function(response) {
		        window.location.href = M.cfg.wwwroot + "/blocks/coursetimer/admin/enrolled_details.php?courseid="+courseid;
		    }).fail(function(ex) {
		        console.log(ex);
			});
				
			});
			
		$(document).ready(function () {
		   $("#adduser").click(function () {
				var email = $("#exampleInputEmail1").val();
	          	var promises = ajax.call([{
		          	methodname: 'block_coursetimer_validate_new_proctor',
		      		args: { 'email' : email  }
	                },
	          	]);
	          
	            promises[0].done(function(response) {
	          	if(response.success==1)
	          	{
	              	$('#alertmsg').html('Verified user.').css('color', 'green');	              	
					var courseid = GetUrlParameter('courseid');
					var email = $("#exampleInputEmail1").val();
					var role = $('#selectedrole option:selected').val();
					var groupid = $('#selectedgroup option:selected').val();
					
					var promises = ajax.call([{
				        methodname: 'block_coursetimer_add_user',
						args: { 'courseid': courseid, 'email' : email, 'role' : role, 'groupid' : groupid }
				       },
					]);
				
				    promises[0].done(function(response) {
				        window.location.href = M.cfg.wwwroot + "/blocks/coursetimer/admin/enrolled_details.php?courseid="+courseid;
				    }).fail(function(ex) {
				        console.log(ex);
				});	
	          	}
	          	else if(response.success==0)
	          	{
	            	$('#alertmsg').html('This user is not valid. You have to create this user.').css('color', 'red');
	          	}
	          	else if(response.success=='')
	          	{
	            	$('#alertmsg').html('This user is not valid. You have to create this user.').css('color', 'red');
	          	}
	            
	            }).fail(function(ex) {
	                console.log(ex);
	          	});					
		    });
		});
		
		
		$(document).ready(function () {			
			jQuery('.removebtn').on('click', function() {
				
				var courseid = GetUrlParameter('courseid');
				var iagree = $(this).val();
				
			    var $row = jQuery(this).closest('tr');
			    var $columns = $row.find('td');
			
			    $columns.addClass('row-highlight');
			    var values = [];
			    var count = 0;
			    jQuery.each($columns, function(i, item) {
			        values[count] = item.innerHTML;
			        count++;
			    });
			    
				var useremail = values[0];
				var groupname = values[2];
				$('#removeusermodal').modal('show');
				
				$('#removeconfirm').click(function () {
					
					if (iagree == 0)
					{
						var promises = ajax.call([{
				        methodname: 'block_coursetimer_remove_user',
						args: { 'courseid': courseid, 'useremail' : useremail, 'groupname' : groupname }
				       	},
						]);
				
					    promises[0].done(function(response) {
					        window.location.href = M.cfg.wwwroot + "/blocks/coursetimer/admin/enrolled_details.php?courseid="+courseid;
					    }).fail(function(ex) {
					        console.log(ex);
						});
					}
					else
					{
						$('#removeactiveusermodal').modal('show');
						$('#removeactiveuserconfirm').click(function () {
							var promises = ajax.call([{
					        methodname: 'block_coursetimer_remove_user',
							args: { 'courseid': courseid, 'useremail' : useremail, 'groupname' : groupname }
					       	},
							]);
					
						    promises[0].done(function(response) {
						        window.location.href = M.cfg.wwwroot + "/blocks/coursetimer/admin/enrolled_details.php?courseid="+courseid;
						    }).fail(function(ex) {
						        console.log(ex);
							});
						});
					}
					
				});		
			})
		});
			
			function GetUrlParameter(sParam)
			{
			    var sPageURL = window.location.search.substring(1);
			
			    var sURLVariables = sPageURL.split('&');
			
			    for (var i = 0; i < sURLVariables.length; i++)
			    {
			        var sParameterName = sURLVariables[i].split('=');
			
			        if (sParameterName[0] == sParam)
			
			        {
			            return sParameterName[1];
			        }
			    }
			}
		},
		
		proctor_replace_init: function() {
		
			$(document).ready(function () {
				$("#future_data").change(function(){
				    if($(this).prop("checked") == true){
				       $("#toggle_message").text('For all future enrollments');
				    }else{
				       $("#toggle_message").text("Only for today's enrollments");
				    }
				});
				
				var confirmationmodal =
                	'<div class="modal fade" id="replaceenrollmentsmodal" tabindex="-1" role="dialog" aria-labelledby="replaceenrollmentsmodalTitle" aria-hidden="true">'+
				  	'<div class="modal-dialog modal-dialog-centered" role="document">'+
			    	'<div class="modal-content" style="width: 700px;">'+
			      	'<div class="modal-header">'+
		        	'<h4 class="modal-title" id="replaceenrollmentsmodalTitle">Replace Confirmation</h4>'+
			       	'<button type="button" class="close" data-dismiss="modal">&times;</button></div>'+
			      	'<div class="modal-body">'+
					'<div id="modal-body-text"></div>'+
			      	'</div>'+
			      	'<div class="modal-footer">'+
			        '<button type="button" class="btn btn-danger" data-dismiss="modal">No</button>'+
			        '<button type="button" class="btn btn-success" data-dismiss="modal" id="replace_proctor">Yes</button>'+
			      	'</div></div></div></div>';		                    
            	$("#page-header").append(confirmationmodal);
				
				$("#replaceenrollment").click(function () {
					var oldproctor = $("#oldproctorlist option:selected").text();
					var newproctor = $("#proctor_email").val();
					
					$("#replaceenrollmentsmodal #modal-body-text").text('Are you sure you want to replace '+oldproctor+' to '+newproctor+' ?');					
					
					if ($("#oldproctorlist option:selected").val() && newproctor)
					{
						$("#replaceenrollmentsmodal").modal("show");
					}					
				});
					
		   		$("#replace_proctor").click(function () {
					var old_proctor = $("#oldproctorlist option:selected").val();
					var new_proctor = $("#proctor_email").val();
					var user_choice = false;
					
					if($("#future_data").prop("checked") == true){
					   var user_choice = true;
					}
					
			    	var promises = ajax.call([{
			        methodname: 'block_coursetimer_proctor_replace',
					args: { 'old_proctor' : old_proctor, 'new_proctor' : new_proctor, 'user_choice' : user_choice }
			       	},
					]);
			
				    promises[0].done(function(response) {
						if (response.success){
							if (!alert('Proctor has been replaced successfully'))
							{
								window.location.href = M.cfg.wwwroot + "/blocks/coursetimer/admin/proctor_replace.php";
							}
							
						}else {
							alert('Invalid proctor ID/Email');
						}
				        
				    }).fail(function(ex) {
				        console.log(ex);
					});

				});
			});
		}
	};
});
define('block_coursetimer/livefeed', ['jquery', 'core/ajax'], function($, ajax) {

    return {
        init: function(args) {
            var rootPath = M.cfg.wwwroot;
            var courseid = args.courseid;
            var langcloseAttemptHeader = args.langcloseAttemptHeader;
            var langCloseAttemptConfirmation = args.langCloseAttemptConfirmation;
            var forcfullyassessmentclosed = args.forcfullyassessmentclosed;
            var refresh_timeinterval = 30000;
            var refresh_pendingapproval = 15000;

            var storagePrefixD = 'coursetimer_' + courseid + "_livemodal";

            var livefeed_tabactive = true;
            var approval_tabactive = false;
            var approved_tabactive = false;

            //confirmation modal for closing the attempt
            var closeAttemptConfirmationmodal =
                `<div class="modal modal-backdrop fade text-center" id="close-attempt-confirm" style="z-index:1200 !important; opacity:1;" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="width:50%;margin-left: 25%;">
                        <div class="modal-header">
                            <h5 class="modal-title text-danger">` + langcloseAttemptHeader + `</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                            <div class="container confirm-msg" align="center">
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        <textarea class="form-control border border-dark" name="procEndtesttext"
                                        rows="3" placeholder="Ex : Frequently accessing external devices"></textarea>  
                                    </div>
                                </div>
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        
                                    </div>
                                </div>
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-danger mt-3" id="close-attempt-confirmed">End Test</button>
                                    </div>
                                </div>
                            </div>
                            <div class="loading hidden" align="center"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></div>
                            <p class="hidden closed-msg">` + forcfullyassessmentclosed + `</p>
                            
                        </div>
                        <div class="modal-footer hidden" style="margin-top:0rem;">
                            <button type="button" id="close-attempt-Yes" class="btn btn-danger hidden">Yes</button>
                            <button type="button" id="close-attempt-cancel" onclick="$('#close-attempt-confirm').modal('hide')" class="btn btn-success">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>`;
            $("#page-header").append(closeAttemptConfirmationmodal);

            var rejectapprovalmodal =
                `<div class="modal fade" id="rejectapproval" role="dialog">
					<div class="modal-dialog">
      
					 <div class="modal-content">
						<div class="modal-header border border-white" style="text-align: center;">
						<h4 style="flex: auto;">Please specify reasons for rejecting the approval<h5>
						<button type="button" class="close closemodal" data-dismiss="modal">&times;</button>
						</div>
 
						<div class="modal-body">          
							<div class="container" align="center">
								<div class="row"  align="center">
									<div class="col-md-12">
										<textarea class="form-control border border-dark" name="rejecttext"
										rows="3" placeholder="Ex : Re-upload images capturing them from brighter lighting conditions"></textarea>  
									</div>
								</div>
								<div class="row"  align="center">
									<div class="col-md-12">
										
									</div>
								</div>
								<div class="row"  align="center">
									<div class="col-md-12">
										<button type="button" class="btn btn-danger mt-3" id="submitreject">Reject</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>`;
            $("#page-header").append(rejectapprovalmodal);


            var verificationdetailsmodal =
                `<div class="modal modal-backdrop fade text-center" id="verificationimages" style="z-index:1200 !important; opacity:1;" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="width:100%">
                        <div class="modal-header">
                            <h5 class="modal-title text-danger col-sm">Approval Details</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
							<div class="row">
								<div class="col-sm">
                                    <h6>Reference Image</h6><img src="" class="card-img-top" alt="reference_image" id="referenceimage">
								</div>
								<div class="col-sm">
                                    <h6>Verification ID</h6><img src="" class="card-img-top" alt="verification_image" id="verificationimage">
								</div>
							</div>
                            
							<p class="confirm-msg"></p>
                        </div>
                        <div class="modal-footer" style="margin-top:0rem;">
                            
                        </div>
                    </div>
                </div>
            </div>`;
            $("#page-header").append(verificationdetailsmodal);




            $("#livefeed_tab").click(function() {
                livefeed_tabactive = true;
                approval_tabactive = false;
                approved_tabactive = false;

                $("#livefeed_tab").attr("class", "nav-link active");
                $("#approved_notstarted_tab").attr("class", "nav-link");
                $("#approval_tab").attr("class", "nav-link");
                $("#pending_approvals").html("");
                $("#approved_notstarted").html("");

                $("#proc_livefeed_data").html("<img align='center' style='width:70px' src='" +
                    M.cfg.wwwroot +
                    "/blocks/coursetimer/pix/loading.gif' / > ");

                ct_livefeed_update(0, courseid);

                $('#user_pendingapproval_modal').css('display', 'none');
                $('#user_live_data_modal').css('display', 'flex');
                $("#userfeedcontrols").removeClass('hidden');
            });

            $("#approval_tab").click(function() {
                livefeed_tabactive = false;
                approval_tabactive = true;
                approved_tabactive = false;

                $("#livefeed_tab").attr("class", "nav-link");
                $("#approved_notstarted_tab").attr("class", "nav-link");
                $("#approval_tab").attr("class", "nav-link active");
                $("#proc_livefeed_data").html("");
                $("#approved_notstarted").html("");

                $("#pending_approvals").html("<img align='center' style='width:70px' src='" +
                    M.cfg.wwwroot +
                    "/blocks/coursetimer/pix/loading.gif' / > ");
                ct_pendingApprovals(courseid);

                $('#user_pendingapproval_modal').css('display', 'block');
                $('#user_live_data_modal').css('display', 'none');
                $("#userfeedcontrols").addClass('hidden');
            });

            $("#approved_notstarted_tab").click(function() {
                livefeed_tabactive = false;
                approval_tabactive = false;
                approved_tabactive = true;

                $("#livefeed_tab").attr("class", "nav-link");
                $("#approval_tab").attr("class", "nav-link");
                $("#approved_notstarted_tab").attr("class", "nav-link active");
                $("#proc_livefeed_data").html("");
                $("#pending_approvals").html("");

                $("#approved_notstarted").html("<img align='center' style='width:70px' src='" +
                    M.cfg.wwwroot +
                    "/blocks/coursetimer/pix/loading.gif' / > ");
                ct_approvedNotstarted(courseid);

                $('#user_pendingapproval_modal').css('display', 'none');
                $('#user_live_data_modal').css('display', 'none');
                $("#userfeedcontrols").addClass('hidden');
            });

            // Update KPI  Data
            ct_kpi_update(courseid);

            ct_pendingApprovalCount(courseid);

            $("#started_kpi").change(function() {
                ct_kpi_update(courseid);
                ct_livefeed_update(1, courseid);
            });

            $("#notstarted_kpi").change(function() {
                ct_kpi_update(courseid);
                ct_livefeed_update(1, courseid);
            });

            $("#locked_kpi").change(function() {
                ct_kpi_update(courseid);
                ct_livefeed_update(1, courseid);
            });

            $("#paused_kpi").change(function() {
                ct_kpi_update(courseid);
                ct_livefeed_update(1, courseid);
            });


            $("#completed_kpi").change(function() {
                ct_kpi_update(courseid);
                ct_livefeed_update(1, courseid);
            });

            $("#flaggedusersonly").change(function() {
                ct_livefeed_update(1, courseid);
            });

            function ct_pendingApprovalCount(courseidval = 0) {

                if (courseidval == 0) {
                    courseidval = courseid;
                }

                var livemodalstatus = localStorage.getItem(storagePrefixD + "livemodalstatus")
                    // If modal is open, no need to update the kpi data
                if (livemodalstatus === "open") {
                    return;
                }

                var data = ajax.call([{
                    methodname: 'block_coursetimer_fetch_pendingapproval_count',
                    args: {
                        courseid: courseid
                    }
                }]);

                data[0].done(function(response) {
                    $("#approval_tab").html(" Pending Approvals (" + response.total + ")");
                    if(response.approvedNotstarted>=0){
                        $("#approved_notstarted_tab").html(" Approved-Yet to start (" + response.approvedNotstarted + ")");
                    }
                }).fail(function(ex) {
                    // do something with the exception
                    console.log("Failed");
                });

            }

            function ct_pendingApprovals(courseidval = 0) {

                if (courseidval == 0) {
                    courseidval = courseid;
                }
                if (approval_tabactive !== false) {

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'notapprovedusers',
                            courseid: courseidval
                        })
                        .done(function(result) {
                            if (approval_tabactive !== false) {
                                $("#approval_tab").html(" Pending Approvals (" + result[1] + ")");
                                $('#pending_approvals').html(result[0]);
                            }
                        });
                }
            }

            function ct_approvedNotstarted(courseidval = 0) {

                if (courseidval == 0) {
                    courseidval = courseid;
                }
                if (approved_tabactive !== false) {

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'approvednotstartedusers',
                            courseid: courseidval
                        })
                        .done(function(result) {
                            if (approved_tabactive !== false) {
                                $("#approved_notstarted_tab").html(" Approved-Yet to start (" + result[1] + ")");
                                $('#approved_notstarted').html(result[0]);
                            }
                        });
                }
            }

            // Method to update the live feed KPI data
            function ct_kpi_update(courseid) {

                var livemodalstatus = localStorage.getItem(storagePrefixD + "livemodalstatus")
                    // If modal is open, no need to update the kpi data
                if (livemodalstatus === "open") {
                    return;
                }

                var data = ajax.call([
                    { methodname: 'block_coursetimer_fetch_proctoring_kpi', args: { courseid: courseid } }
                ]);

                data[0].done(function(response) {

                    $('#totalusers').html(response.total);
                    $('#startedusers').html(response.started);
                    $('#notstartedusers').html(response.yettostart);
                    $('#lockedusers').html(response.locked);
                    $('#pausedusers').html(response.paused);
                    $('#completedusers').html(response.completed);

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'proctoringtime',
                            courseid: courseid,
                            totaluser: response.total,
                            comuser: response.completed
                        })
                        .done(function(result) {
                            if (result != null) {
                                $('#starttime').html(result.starttime);
                                $('#endtime').html(result.endtime);
                            }

                        })



                }).fail(function(ex) {
                    // do something with the exception
                    //console.log("Failed");
                });
            }

            function ct_livefeed_update(idval, courseid) {

                var livemodalstatus = localStorage.getItem(storagePrefixD + "livemodalstatus")
                    // If modal is open, no need to update the kpi data
                if (livemodalstatus === "open") {
                    return;
                }

                if (idval == 0) {
                    var idval = $('.active.paginationlivefeed > a').html();
                    if (typeof idval === "undefined") {
                        idval = 1;
                    }
                }

                var started = 0;
                var notstarted = 0;
                var locked = 0;
                var completed = 0;
                var paused = 0;
                var flagged = 0;
                var viewscreenimage = false;

                if ($('#started_kpi').prop("checked") == true) {
                    started = 1;
                }

                if ($('#notstarted_kpi').prop("checked") == true) {
                    notstarted = 1;
                }

                if ($('#locked_kpi').prop("checked") == true) {
                    locked = 1;
                }

                if ($('#paused_kpi').prop("checked") == true) {
                    paused = 1;
                }

                if ($('#completed_kpi').prop("checked") == true) {
                    completed = 1;
                }

                if ($('#flaggedusersonly').prop("checked") == true) {
                    flagged = 1;
                }

                if ($('#displayuserimage').prop("checked") == true) {
                    viewscreenimage = true;
                }

                $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                        action: 'proclivedata',
                        page: idval,
                        courseid: courseid,
                        started: started,
                        notstarted: notstarted,
                        locked: locked,
                        paused: paused,
                        completed: completed,
                        flagged: flagged
                    })
                    .done(function(result) {

                        var modalstatus = 0;
                        var dialoguecontent = '';
                        var buttontext = '';
                        var modalstatus = $("#confirmationflag").hasClass('show');
                        if (modalstatus == true) {
                            modalstatus = 1;
                            dialoguecontent = $(".confirmationflagcontent").text();
                            buttontext = $('#flagevent').text();
                        } else {
                            modalstatus = 0;
                        }

                        if (livefeed_tabactive !== false) {
                            $('#proc_livefeed_data').html(result[0]);
                            $("#flaggedUserCount").html(result[1]);

                            if (modalstatus == 1) {
                                //$(".modal-backdrop").removeClass('show');
                                $('.modal-backdrop').remove();
                                $(".confirmationflagcontent").text(dialoguecontent);
                                $('#flagevent').text(buttontext);
                                $("#confirmationflag").modal('show');
                            }

                            //display screenshare in default
                            if (viewscreenimage !== false) {
                                $('.userimagecaptured').addClass('hidden');
                                $('.screenimagecaptured').removeClass('hidden');
                            }
                        }
                    });
            }

            $('#accept_image_approval').click(function() {

                if (confirm("Are you sure you want to approve this user for the assessment?")) {

                    var userid = $('#user_approval_image').attr('userid');
                    var courseid = $('#user_approval_image').attr('courseid');

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'acceptapproval',
                            userid: userid,
                            courseid: courseid
                        })
                        .done(function(result) {
                            $('#userLiveData').modal('hide');
                            $('#userpendingapproval').modal('hide');
                            ct_pendingApprovals(0); // TODO: this is users courseid
                            ct_pendingApprovalCount(0);
                        });
                } else {
                    $('#userLiveData').modal('hide');
                    $('#userpendingapproval').modal('hide');
                    // console.log("No");
                }
            });

            $('#reject_image_approval').click(function() {


                $('#userpendingapproval').modal('hide');
                $('#userLiveData').modal('hide');
                $("textarea[name=rejecttext]").val('');
                $('#rejectapproval').modal('show');


                /*              if (confirm("Are you sure you want to reject this user for the assessment?")) {
                    var userid = $('#user_approval_image').attr('userid');
                    var courseid = $('#user_approval_image').attr('courseid');

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'rejectapproval',
                            userid: userid,
                            courseid: courseid
                        })
                        .done(function(result) {
                            $('#userLiveData').modal('hide');
							$('#userpendingapproval').modal('hide');
                            ct_pendingApprovals(0);
                        });

                } else {
                    $('#userLiveData').modal('hide');
					$('#userpendingapproval').modal('hide');
                    // console.log("No");;
                } */
            });

            $('#submitreject').click(function() {

                var userid = $('#user_approval_image').attr('userid');
                var courseid = $('#user_approval_image').attr('courseid');
                var rejectmessage = $("textarea[name=rejecttext]").val();
                if (rejectmessage.length >= 10) {
                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                        action: 'rejectapproval',
                        userid: userid,
                        courseid: courseid,
                        rejectmessage: rejectmessage
                    }).done(function(result) {
                        $('#rejectapproval').modal('hide');
                        ct_pendingApprovals(0);
                    });
                } else {
                    $('#page-blocks-coursetimer-livefeed textarea[name="rejecttext"]').removeClass('border-dark');
                    $('#page-blocks-coursetimer-livefeed textarea[name="rejecttext"]').addClass('border-danger');
                    var errorElement = `
                        <p class="text-left mt-2 text-danger" id="approval-error">
                            Please specify your reason for rejecting the approval in not less than 10 characters
                        </p>
                    `;
                    $('#page-blocks-coursetimer-livefeed #approval-error').remove();
                    $(errorElement).insertAfter('#page-blocks-coursetimer-livefeed textarea[name="rejecttext"]');
                }
            });

            //Handle reject approval close action
            $('#rejectapproval').on('hide.bs.modal', function(e) {
                $('#page-blocks-coursetimer-livefeed #approval-error').remove();
                $('#page-blocks-coursetimer-livefeed textarea[name="rejecttext"]').removeClass('border-danger');
                $('#page-blocks-coursetimer-livefeed textarea[name="rejecttext"]').addClass('border-dark');
            });


            // Refresh data in regular interval
            var stopHandle = setInterval(function() {
                ct_kpi_update(courseid);
                ct_pendingApprovalCount(courseid);

                if (livefeed_tabactive !== false) {
                    ct_livefeed_update(0, courseid);
                }

            }, refresh_timeinterval);

            // Refresh pending approval data in regular interval
            var stopHandle2 = setInterval(function() {
                if (approval_tabactive !== false) {
                    ct_pendingApprovals(courseid);
                }
            }, refresh_pendingapproval);

            // Refresh approved-yet to start data in regular interval
            var stopHandle2 = setInterval(function() {
                if (approved_tabactive !== false) {
                    ct_approvedNotstarted(courseid);
                }
            }, refresh_pendingapproval);

            //Event to capture pause attempt button
            $('#pause_test_link').click(function() {

                userid = $('#livefeed_username').attr('userid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'pauseattempt' },
                    success: function() {
                        $('#pause_test_link').addClass('hidden');
                        $('#resume_test_link').removeClass('hidden');
                    }
                });
            });

            //Event to capture resume attempt button
            $('#resume_test_link').click(function() {

                userid = $('#livefeed_username').attr('userid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'resumeattempt' },
                    success: function() {
                        $('#resume_test_link').addClass('hidden');
                        $('#pause_test_link').removeClass('hidden');
                    }
                });
            });

            //Event to capture unlock attempt button
            $('#unlock_test_link').click(function() {

                userid = $('#livefeed_username').attr('userid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'unlockattempt' },
                    success: function() {
                        $('#unlock_test_link').addClass('hidden');
                        $('#pause_test_link').removeClass('hidden');
                    }
                });
            });

            $('#verificationdetails').click(function() {
                userid = $('#livefeed_username').attr('userid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'getverificationimages' },
                    success: function(response) {
                        $("#referenceimage").attr("src", response.reference);
                        $("#verificationimage").attr("src", response.verification);
                        $("#verificationimages").attr("userid", "userid_" + userid);
                        $('#verificationimages').modal('show');
                        $('#userLiveData').modal('hide');
                    }
                });
            });


            //Event to capture close attempt button
            $('#end_test_link').click(function() {
                $("textarea[name=procEndtesttext]").val('');
                $('#close-attempt-cancel').text('Cancel');
                $('#close-attempt-confirmed').removeClass('hidden');
                $('#close-attempt-confirm .modal-body .loading').addClass('hidden');
                $('#close-attempt-confirm .modal-body .closed-msg').addClass('hidden');
                $('#close-attempt-confirm .modal-body .confirm-msg').removeClass('hidden');
                $('#close-attempt-confirm .modal-footer').addClass('hidden');
                $('#close-attempt-confirm').modal('show');
            });

            $('#close-attempt-confirmed').click(function() {
                var userid = $('#livefeed_username').attr('userid');
                var endtestmessage = $("textarea[name=procEndtesttext]").val();
                if (endtestmessage.length >= 10){
                    $('#close-attempt-confirm .modal-body .loading').removeClass('hidden');
                    $('#close-attempt-confirm .modal-body .confirm-msg').addClass('hidden');
                    $.ajax({
                        type: "POST",
                        url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                        data: { 'courseid': courseid, 'userid': userid, 'action': 'closeattempt', 'endtestmessage': endtestmessage },
                        success: function() {
                            $('#close-attempt-cancel').text('Close');
                            $('#close-attempt-confirmed').addClass('hidden');
                            $('#close-attempt-confirm .modal-body .closed-msg').removeClass('hidden');
                            $('#close-attempt-confirm .modal-body .loading').addClass('hidden');
                            $('#close-attempt-confirm .modal-footer').removeClass('hidden');
                        }
                    });
                } else {
                    $('#page-blocks-coursetimer-livefeed textarea[name="procEndtesttext"]').removeClass('border-dark');
                    $('#page-blocks-coursetimer-livefeed textarea[name="procEndtesttext"]').addClass('border-danger');
                    var errorElement = `
                        <p class="text-left mt-2 text-danger" id="endtest-error">
                            Please specify your reason for Closing the User's attempt in not less than 10 characters
                        </p>
                    `;
                    $('#page-blocks-coursetimer-livefeed #endtest-error').remove();
                    $(errorElement).insertAfter('#page-blocks-coursetimer-livefeed textarea[name="procEndtesttext"]');
                }
            });

            //Handle close-attempt-confirm close action
            $('#close-attempt-confirm').on('hide.bs.modal', function(e) {
                $('#page-blocks-coursetimer-livefeed #endtest-error').remove();
                $('#page-blocks-coursetimer-livefeed textarea[name="procEndtesttext"]').removeClass('border-danger');
                $('#page-blocks-coursetimer-livefeed textarea[name="procEndtesttext"]').addClass('border-dark');
            });

            $(document).ready(function() {
                var tagspanexid = 1;
                var tagex = 1;
                var final = [];
                var finalJson = [];

                function autocomplete(inp, arr) {

                    /*the autocomplete function takes two arguments,
                    the text field element and an array of possible autocompleted values:*/
                    var currentFocus;
                    /*execute a function when someone writes in the text field:*/
                    inp.addEventListener("input", function(e) {
                        var a, b, i, val = this.value;
                        /*close any already open lists of autocompleted values*/

                        closeAllLists();
                        if (!val) { return false; }
                        currentFocus = -1;
                        /*create a DIV element that will contain the items (values):*/
                        a = document.createElement("DIV");
                        a.setAttribute("id", this.id + "autocomplete-list");
                        a.setAttribute("class", "autocomplete-items");
                        /*append the DIV element as a child of the autocomplete container:*/
                        this.parentNode.appendChild(a);
                        /*for each item in the array...*/
                        for (i = 0; i < arr.length; i++) {
                            res = arr[i].split("-");
                            var name = res[0].toUpperCase();
                            var email = res[2].toUpperCase();
                            var idnmuber = '';
                            if (res[3]) {
                                idnmuber = res[3].toUpperCase();
                            }
                            /*check if the item starts with the same letters as the text field value:*/
                            if (name.includes(val.toUpperCase())) {
                                /*create a DIV element for each matching element:*/
                                b = document.createElement("DIV");
                                /*make the matching letters bold:*/
                                // var boldletters = "<strong>" + val + "</strong>";
                                b.innerHTML = res[0];
                                // b.innerHTML = res[0].replace(/val/gi,boldletters);
                                /*insert a input field that will hold the current array item's value:*/
                                b.innerHTML += "<input type='hidden' value='" + res[0] + "'>";
                                b.innerHTML += "<input id='userId" + res[1] + "' type='hidden' value='" + res[1] + "'>";
                                /*execute a function when someone clicks on the item value (DIV element):*/
                                b.addEventListener("click", function(e) {
                                    userid = this.getElementsByTagName("input")[1].value;
                                    var userdata = {
                                        id: "userid_" + userid
                                    };
                                    // fetch this single user data - courseid - getlivefeedsearch - userid
                                    $.ajax({
                                        method: "POST",
                                        url: M.cfg.wwwroot + '/blocks/coursetimer/proctoring_ajax.php',
                                        data: { "action": "getlivefeedsearch", "courseid": courseid, "userid": userid }
                                    }).done(function(response) {
                                        $('#livesearch_result').html(response);
                                        userliveModal(userdata);
                                    });

                                });
                                a.appendChild(b);
                            } else if (email.includes(val.toUpperCase())) {
                                /*create a DIV element for each matching element:*/
                                b = document.createElement("DIV");
                                /*make the matching letters bold:*/
                                b.innerHTML = res[2];
                                // b.innerHTML = "<strong>" + res[0].substr(0, val.length) + "</strong>";
                                // b.innerHTML += res[0].substr(val.length);
                                /*insert a input field that will hold the current array item's value:*/
                                b.innerHTML += "<input type='hidden' value='" + res[2] + "'>";
                                b.innerHTML += "<input id='userId" + res[1] + "' type='hidden' value='" + res[1] + "'>";
                                /*execute a function when someone clicks on the item value (DIV element):*/
                                b.addEventListener("click", function(e) {
                                    userid = this.getElementsByTagName("input")[1].value;
                                    var userdata = {
                                        id: "userid_" + userid
                                    };
                                    // fetch this single user data - courseid - getlivefeedsearch - userid
                                    $.ajax({
                                        method: "POST",
                                        url: M.cfg.wwwroot + '/blocks/coursetimer/proctoring_ajax.php',
                                        data: { "action": "getlivefeedsearch", "courseid": courseid, "userid": userid }
                                    }).done(function(response) {
                                        $('#livesearch_result').html(response);
                                        userliveModal(userdata);
                                    });

                                });
                                a.appendChild(b);
                            } else if (idnmuber.includes(val.toUpperCase())) {
                                /*create a DIV element for each matching element:*/
                                b = document.createElement("DIV");
                                /*make the matching letters bold:*/
                                b.innerHTML = res[3];
                                // b.innerHTML = "<strong>" + res[0].substr(0, val.length) + "</strong>";
                                // b.innerHTML += res[0].substr(val.length);
                                /*insert a input field that will hold the current array item's value:*/
                                b.innerHTML += "<input type='hidden' value='" + res[3] + "'>";
                                b.innerHTML += "<input id='userId" + res[1] + "' type='hidden' value='" + res[1] + "'>";
                                /*execute a function when someone clicks on the item value (DIV element):*/
                                b.addEventListener("click", function(e) {
                                    userid = this.getElementsByTagName("input")[1].value;
                                    var userdata = {
                                        id: "userid_" + userid
                                    };
                                    // fetch this single user data - courseid - getlivefeedsearch - userid
                                    $.ajax({
                                        method: "POST",
                                        url: M.cfg.wwwroot + '/blocks/coursetimer/proctoring_ajax.php',
                                        data: { "action": "getlivefeedsearch", "courseid": courseid, "userid": userid }
                                    }).done(function(response) {
                                        $('#livesearch_result').html(response);
                                        userliveModal(userdata);
                                    });

                                });
                                a.appendChild(b);
                            }
                        }
                    });
                    /*execute a function presses a key on the keyboard:*/
                    inp.addEventListener("keydown", function(e) {
                        var x = document.getElementById(this.id + "autocomplete-list");
                        if (x) x = x.getElementsByTagName("div");
                        if (e.keyCode == 40) {

                            /*If the arrow DOWN key is pressed,
                            increase the currentFocus variable:*/
                            currentFocus++;

                            /*and and make the current item more visible:*/
                            addActive(x);

                        } else if (e.keyCode == 38) { //up
                            /*If the arrow UP key is pressed,
                            decrease the currentFocus variable:*/
                            currentFocus--;
                            /*and and make the current item more visible:*/
                            addActive(x);
                        } else if (e.keyCode == 13) {
                            /*If the ENTER key is pressed, prevent the form from being submitted,*/

                            if (currentFocus > -1) {
                                /*and simulate a click on the "active" item:*/
                                if (x) x[currentFocus].click();
                            }
                        }
                    });

                    function addActive(x) {
                        /*a function to classify an item as "active":*/
                        if (!x) return false;
                        /*start by removing the "active" class on all items:*/
                        removeActive(x);
                        if (currentFocus >= x.length) currentFocus = 0;
                        if (currentFocus < 0) currentFocus = (x.length - 1);
                        /*add class "autocomplete-active":*/
                        x[currentFocus].classList.add("autocomplete-active");
                    }

                    function removeActive(x) {
                        /*a function to remove the "active" class from all autocomplete items:*/
                        for (var i = 0; i < x.length; i++) {
                            x[i].classList.remove("autocomplete-active");
                        }
                    }

                    function closeAllLists(elmnt) {
                        /*close all autocomplete lists in the document,
                        except the one passed as an argument:*/
                        var x = document.getElementsByClassName("autocomplete-items");
                        for (var i = 0; i < x.length; i++) {
                            if (elmnt != x[i] && elmnt != inp) {
                                x[i].parentNode.removeChild(x[i]);
                            }
                        }
                    }
                    /*execute a function when someone clicks in the document:*/
                    document.addEventListener("click", function(e) {
                        closeAllLists(e.target);
                    });
                }

                function coursetimer_populateSearch() {
                    var data = ajax.call([{
                        methodname: 'block_coursetimer_fetch_proctoring_userlist',
                        args: {
                            courseid: courseid
                        }
                    }]);

                    data[0].done(function(response) {
                        data = $.parseJSON(JSON.stringify(response));
                        $.each(data, function(i, v) {
                            final.push(v.name + '-' + v.id + '-' + v.email + '-' + v.idnumber);
                            finalJson.push({
                                "id": v.id,
                                "name": v.name
                            });
                        });
                        autocomplete(document.getElementById("livefeedsearch"), final);
                    }).fail(function(ex) {
                        // do something with the exception
                        console.log("Search Failed");
                    });
                }

                coursetimer_populateSearch();
            });

        }

    };
});
define('block_coursetimer/floatingvideo', ['jquery'], function($) {
    return {
        initFloatingWindow: function(args) {
            $( document ).ready(function() {
                setTimeout(function(){  
                    var webcamMandated = args.webcamEnabled;
                    var allowUserStream = args.allowUserStream;

                    var constraints='';
                    var mediaPrefix = 'coursetimer_' + 'deviceID' + "_";

                    // var audiodevice = localStorage.getItem(mediaPrefix + "audio");
                    var videodevice = localStorage.getItem(mediaPrefix + "video");
                    if(videodevice){
                        constraints = {
                            video: {deviceId: videodevice ? {exact: videodevice} : undefined}
                        };
                    } else{
                        constraints = { video: true };
                    }

                    /**** Program execution starts here ***/
                    if(webcamMandated && allowUserStream){
                        var video = document.getElementById('floatingVideo');
                        $("#floatingVideoDiv").draggable();

                        navigator.mediaDevices.getUserMedia(constraints)
                        //we are good to go
                        .then(function(stream) {
                            video.srcObject = stream;
                            $('#floatingVideoDiv #floatingVideo').removeClass('hidden');
                            $('#floatingVideoDiv #connection_lost_img').addClass('hidden');
                        })
                        //something wrong. Permission denied or no web cam or some similar problem
                        .catch(function(error) {
                            $('#floatingVideoDiv #floatingVideo').addClass('hidden');
                            $('#floatingVideoDiv #connection_lost_img').removeClass('hidden');
                            console.log(error);
                        });
                    }
                }, 1500);
            });
        }
    };
});
define('block_coursetimer/edit', ['jquery'], function($) {
    return {
        init: function(args) {
            $( document ).ready(function() {
            	var flag = false;
            	var params = new window.URLSearchParams(window.location.search);
            	var courseid = params.get('id');
            	$.post(M.cfg.wwwroot + "/blocks/coursetimer/ajax_edit.php?action=getconfirmationmessage&cid="+courseid)
                .done(function(result) {
                		
                	console.log(result);
                	var modalHtml =
        				' <div id="confirmationModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
        				' <div class="modal-dialog" style="max-width:351px">' +
        				' <div class="modal-content">' +					
        				' <div class="modal-headers" style="background: black;height: 50px;">' +
        				' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;color: white;"> Are you sure to change settings</h4> </div>' +
        				' <div class="modal-body" id="confirmActionBody">'+result+'</div>'+
        				' <div class="modal-footer">'+ 					
        				' <button type="button" class="btn btn-default" id="ok" aria-expanded="false" >Ok</button>'+
        				' <button type="button" class="btn btn-default" id="cancel" aria-expanded="false" >Cancel</button></div>'+
        				' </div>'+
        				' </div></div>';	
                	$("#page-header").append(modalHtml); 
                })
                .fail (function(jqXHR, textStatus, errorThrown) { 
                	console.log('failed');
                });
            	
            	
            	
            	$(document).on("click","#cancel",function() {
    				$("#confirmationModal").modal("hide");
    				console.log('cancel clicked');
    			});
            	
            	$(document).on("click","#ok",function() {
    				$("#confirmationModal").modal("hide");
    				flag = true;
    				console.log('ok clicked');
    				var formdataval = $("#mform1").serialize();
    				$.post(M.cfg.wwwroot + "/blocks/coursetimer/ajax_edit.php", {
        				action: 'addeditlog',
        				formdata:formdataval,
        				cid:courseid

        			}).done(function(data, textStatus, jqXHR) { 

        				$("#id_submitbutton").click();
        			})

        			.fail (function(jqXHR, textStatus, errorThrown) { 

        			});
    					
    			});
    			
            	$("#id_submitbutton").click(function(event) {
            		 //self = jQuery(event.target);
            		 //var form = self.closest('form'), formdataval = form.serialize();//$("#mform1").serialize()
            		if(flag == false){
            			event.preventDefault();
            			$("#confirmationModal").modal("show");
            		}   
       			});

            });
        }
    };
});
define('block_coursetimer/screenshare', ['jquery', 'core/ajax', 'core/config', 'core/str'], function($, ajax, mdlcfg, str) {
    return {
        init: function(args) {
            var videoStream = null;
            var recordRTC = null;
            var mimeType = 'video/webm';
            var recorderType = null;
            var type = 'video';
            var stopHandle = null;
            var recordingPlayer = document.getElementById('videoPlayer');
            var screenShareEnabled = args.screen_share_enabled == 1 ? true : false;
            var proctoringEnabled = args.proctoring;
            var screenshotCaptureFrequency = args.screenshot_capture_frequency ? (args.screenshot_capture_frequency * 1000) : 40000;
            var courseid = args.courseid;
            var userid = args.userid;
            var wwwroot = args.wwwroot;
            var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
            var windowObjectReference = undefined;
            var langStrings = new Array();
            var screenoffcheck = 1;
            var screensharelock = parseInt(args.screensharelock);
            var parentTimeSet = "";
            var finalprocessingtime = parseInt(args.finalprocessingtime);

            //lets fetch the required lang strings (Recommend practice :p )
            var strings = [
                { key: 'proctitle', component: 'block_coursetimer' },
            ];

            str.get_strings(strings).then(function(results) {
                langStrings = results;
            });

            function addStreamStopListener(stream, callback) {
                stream.addEventListener('ended', function() {
                    callback();
                    callback = function() {};
                }, false);
                stream.addEventListener('inactive', function() {
                    callback();
                    callback = function() {};
                }, false);
                stream.getTracks().forEach(function(track) {
                    track.addEventListener('ended', function() {
                        callback();
                        callback = function() {};
                    }, false);
                    track.addEventListener('inactive', function() {
                        callback();
                        callback = function() {};
                    }, false);
                });
            }

            var commonConfig = {
                onMediaCaptured: function(stream) {
                    videoStream = stream;
                    if (mediaCapturedCallback) {
                        mediaCapturedCallback();
                    }
                    afterScreenshare();
                },
                onMediaStopped: function() {

                    //Screenshare stopped. Lets stop the ajax call
                    // Disable the proceed btn and enable the st
                    if (stopHandle) {
                        var startTime = parseInt(localStorage.getItem(storagePrefix + "startTime"), 10);
                        var closeTime = parseInt(localStorage.getItem(storagePrefix + "closeTime"), 10);
                        var completed = parseInt(localStorage.getItem(storagePrefix + "completed"), 10);
                        var currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10);

                        // User has started so add a log for screenshare off
                        if (startTime != 0 && closeTime > currentTime && completed == 0) {
                            if (screenoffcheck) {
                                $.ajax({
                                    type: "POST",
                                    url: wwwroot + "/blocks/coursetimer/log_ajax.php?action=screenshareoff&courseid=" + courseid,
                                    complete: function(response) {
                                        //do stuff here	
                                        if (screensharelock) {
                                            screenoffcheck = 0;
                                            //lock the user
                                            $.post(wwwroot + "/blocks/coursetimer/proctoring_ajax.php", { action: 'lock', courseid: courseid })
                                                .done(function(result) {
                                                    //location.reload();
                                                });
                                        }
                                    }
                                });
                            }
                        } else {
                            location.reload();
                        }
                        clearInterval(stopHandle);
                    }
                },
                onMediaCapturingFailed: function(error) {
                    console.error('onMediaCapturingFailed:', error);

                    if (error.toString().indexOf('no audio or video tracks available') !== -1) {
                        alert('RecordRTC failed to start because there are no audio or video tracks available.');
                    }

                    if (error.name === 'PermissionDeniedError' && DetectRTC.browser.name === 'Firefox') {
                        alert('Firefox requires version >= 52. Firefox also requires HTTPs.');
                    }

                    commonConfig.onMediaStopped();
                }
            };

            function mediaCapturedCallback() {
                var options = {
                    type: type,
                    mimeType: mimeType,
                    disableLogs: true,
                    getNativeBlob: false, // enable it for longer recordings
                    video: document.getElementById('videoPlayer')
                };
                options.ignoreMutedMedia = false;
                recordRTC = RecordRTC(videoStream, options);

                recordRTC.startRecording();
            };

            function captureScreen(config) {
                if (navigator.getDisplayMedia) {
                    navigator.getDisplayMedia({
                        video: true
                    }).then(screenStream => {
                        config.onMediaCaptured(screenStream);
                        addStreamStopListener(screenStream, function() {
                            config.onMediaStopped();
                        });
                    }).catch(function(error) {
                        config.onMediaCapturingFailed(error);
                    });
                } else if (navigator.mediaDevices.getDisplayMedia) {
                    navigator.mediaDevices.getDisplayMedia({
                        video: true
                    }).then(screenStream => {
                        config.onMediaCaptured(screenStream);
                        addStreamStopListener(screenStream, function() {
                            config.onMediaStopped();
                        });
                        setVideoURL(screenStream, true);
                    }).catch(function(error) {
                        config.onMediaCapturingFailed(error);
                    });
                }else if ( navigator.mediaDevices.getUserMedia ){
                    navigator.mediaDevices.getUserMedia({
                        video: {
                          mediaSource: 'screen'
                        }
                      }).then(screenStream => {
                        config.onMediaCaptured(screenStream);
                        addStreamStopListener(screenStream, function() {
                            config.onMediaStopped();
                        });
                        setVideoURL(screenStream, true);
                      }).catch(function(error) {
                        config.onMediaCapturingFailed(error);
                    });
                }
                 else {
                    var error = 'getDisplayMedia API are not supported in this browser.';
                    config.onMediaCapturingFailed(error);
                    alert(error);
                }
            }

            function stopStream() {

                if (videoStream && videoStream.stop) {
                    videoStream.stop();
                    videoStream = null;
                }

                if (videoStream instanceof Array) {
                    videoStream.forEach(function(stream) {
                        stream.stop();
                    });
                    videoStream = null;
                }

                videoBitsPerSecond = null;
            }

            function getURL(arg) {
                var url = arg;

                if (arg instanceof Blob || arg instanceof File) {
                    url = URL.createObjectURL(arg);
                }

                if (arg instanceof RecordRTC || arg.getBlob) {
                    url = URL.createObjectURL(arg.getBlob());
                }
                return url;
            }

            function setVideoURL(arg, forceNonImage) {
                var url = getURL(arg);

                var elem = 'video';
                if (type == 'gif' && !forceNonImage) {
                    elem = 'img';
                }
                if (type == 'audio') {
                    elem = 'audio';
                }

                if (arg instanceof MediaStream) {
                    recordingPlayer.muted = true;
                }

                recordingPlayer.addEventListener('loadedmetadata', function() {
                    if (navigator.userAgent.toLowerCase().indexOf('android') == -1) return;

                    // android
                    setTimeout(function() {
                        if (typeof recordingPlayer.play === 'function') {
                            recordingPlayer.play();
                        }
                    }, 2000);
                }, false);

                recordingPlayer.poster = '';

                if (arg instanceof MediaStream) {
                    recordingPlayer.srcObject = arg;
                } else {
                    recordingPlayer.src = url;
                }

                if (typeof recordingPlayer.play === 'function') {
                    recordingPlayer.play();
                }

                recordingPlayer.addEventListener('ended', function() {
                    url = getURL(arg);

                    if (arg instanceof MediaStream) {
                        recordingPlayer.srcObject = arg;
                    } else {
                        recordingPlayer.src = url;
                    }
                });
            }

            function checkChromeOrFirefox() {
                //https://stackoverflow.com/questions/9847580/how-to-detect-safari-chrome-ie-firefox-and-opera-browser

                // Firefox 1.0+
                var isFirefox = typeof InstallTrigger !== 'undefined';

                // Chrome 1 - 71
                var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);

                if (isFirefox || isChrome) {
                    return true;
                } else {
                    return false;
                }
            }

            function isUserSharingEntireScreen() {
                var label = videoStream.getVideoTracks()[0].label;
                //Substr is done to ensure Mac compatibility
                return label == 'Primary Monitor' || !isNaN(label.substring(label.lastIndexOf("screen:") + 7, label.lastIndexOf(":0"))) ? true : false;
            }

            function afterScreenshare() {
                if (isUserSharingEntireScreen()) {
                    //All good. Lets allow user to proceed to next steps
                    $('#screenshare_fail').addClass('hidden');
                    $('#screenSharingNote').addClass('hidden');
                    $('#startScreenShareDiv').addClass('hidden');
                    $('#proceedButtonDiv').removeClass('hidden');
                } else {
                    //Lets stop screenshare
                    stopStream();

                    //Lets prevent ajax call
                    if (stopHandle) {
                        clearInterval(stopHandle);
                    }
                    alert('You are required to share the entire screen to proceed further');
                }
            }

            function updateLocalStorage() {
                // var currentTime = Math.round(new Date().getTime()/1000);
                var currentTime = localStorage.getItem(storagePrefix + "currentTime")
                localStorage.setItem(storagePrefix + "lastScreenshotTime", currentTime);
            }

            function saveScreenshot(imagedata) {
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_save_screenshot',
                    args: { 'courseid': courseid, 'userid': userid, 'imagedata': imagedata }
                }]);

                promises[0].done(function(response) {
                    //Don't have anything to be done here
                }).fail(function(ex) {
                    //TODO: Lets see what next
                    console.log(ex);
                });
            }

            function startScreenCapture() {
                captureScreen(commonConfig);
                stopHandle = setInterval(function() {
                    captureScreenAndSave();
                }, screenshotCaptureFrequency)
            }

            function hideurlsduringassessment() {
                $("li.breadcrumb-item >a:contains('Dashboard')").attr('href', '#');
                $("div.dropdown-menu-right >a:contains('Dashboard')").attr("href", "#");
                $("div.dropdown-menu-right >a:contains('Profile')").attr("href", "#");
                $("div.dropdown-menu-right >a:contains('Grades')").attr("href", "#");
                $("div.dropdown-menu-right >a:contains('Messages')").attr("href", "#");
                $("div.dropdown-menu-right >a:contains('Preferences')").attr("href", "#");
                $("div.dropdown-menu-right >a:contains('Log out')").attr("href", "#");
                $("div.branding-inner >.site-logo-wrapper >a").attr("href", "#");
                $("div.navbar-brand > a").attr("href", "#");
            }

            function captureScreenAndSave() {
                //Lets do the additional condition checks
                var lastPollTime = parseInt(localStorage.getItem(storagePrefix + "lastPollTime"), 10);
                var startTime = parseInt(localStorage.getItem(storagePrefix + "startTime"), 10);
                var closeTime = parseInt(localStorage.getItem(storagePrefix + "closeTime"), 10);
                var completed = parseInt(localStorage.getItem(storagePrefix + "completed"), 10);
                var currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10);

                if (completed == 0 && currentTime > startTime && closeTime > currentTime &&
                    lastPollTime + 60 >= currentTime) {
                    navigator.mediaDevices.enumerateDevices().then(
                        (devices) => {
                            //console.log(devices)
                        }
                    )
                    var canvas = document.getElementById('canvas');
                    canvas.width = Math.ceil(recordingPlayer.videoWidth);
                    canvas.height = Math.ceil(recordingPlayer.videoHeight);

                    var context = canvas.getContext('2d');
                    context.drawImage(recordingPlayer, 0, 0);

                    var data = canvas.toDataURL('image/jpeg', 0.1);
                    var output = data.replace(/^data:image\/(png|jpeg);base64,/, "");

                    //Lets update this info in local storage
                    updateLocalStorage();

                    saveScreenshot(output);
                }
            }

            function openRelevantWindow() {

                //Lets have this tab for all internal purpose and open the assessment in new window
                var windowFeatures = "scrollbars=on,toolbar=on,left=0,top=0,height=" + (screen.height - 100) + ",width=" + screen.width;
                if (proctoringEnabled == 1) {
                    windowObjectReference = window.open(wwwroot + "/blocks/coursetimer/verify.php?id=" + courseid + "&action=fullscreen", "Assessment Tab", windowFeatures);
                } else {
                    clearTimeout(parentTimeSet);
                    parentWindowActive(); // This will indicate that the parent is active from now on
                    if (finalprocessingtime != 0) {
                        setTimeout(function() {
                            $('#finalprocessingpage').addClass('hidden');
                            windowObjectReference = window.open(wwwroot + "/course/view.php?id=" + courseid + "&coursetimer=1&action=continue&iagree=1", "Assessment Tab", windowFeatures);
                        }, finalprocessingtime);
                    } else {
                        windowObjectReference = window.open(wwwroot + "/course/view.php?id=" + courseid + "&coursetimer=1&action=continue&iagree=1", "Assessment Tab", windowFeatures);
                    }
                }
                windowObjectReference.focus();

                // Triggered when the child window is closed
                windowObjectReference.addEventListener("unload", function(event) {
                    var redirectURLonFail = localStorage.getItem(storagePrefix + "redirectURLonFail");
                    if (redirectURLonFail != null && redirectURLonFail.length != 0) {
                        // localStorage.setItem(storagePrefix + "redirectURLonFail", "");
                        location.replace(redirectURLonFail);
                        // console.log(redirectURLonFail)
                    }
                });
            }

            // Update parent active value every second
            function parentWindowActive() {

                parentTimeSet = setInterval(function() {
                    var now = new Date() / 1000;
                    localStorage.setItem(storagePrefix + "parentActiveTime", now);
                }, 1000);

            }

            $(window).on("unload", function(e) {

                var lastactiveTime = parseInt(localStorage.getItem(storagePrefix + "lastPollTime"), 10);
                var valueAvailableStatus = Number.isInteger(lastactiveTime);
                if (valueAvailableStatus) {

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/log_ajax.php", {
                        action: 'forcescreensharingclosed',
                        courseid: courseid,
                        userid: userid,
                        lastactive: lastactiveTime
                    }).done(function(result) {});
                }

                if (windowObjectReference) {
                    windowObjectReference.close();
                }
            });

            $('#screenshare_proceedButton').click(function() {
                $('div.finalscreen-messages').removeClass('hidden');
                if (finalprocessingtime != 0) {
                    $('#finalprocessingpage').removeClass('hidden');
                }
                $('#forcescreensharing').addClass('hidden');
                $('#proc-title').text(langStrings[0]);
                hideurlsduringassessment();
                $.ajax({
                    type: "POST",
                    url: M.cfg.wwwroot + "/blocks/coursetimer/log_ajax.php?action=screenshareon&courseid=" + courseid,
                    complete: function(response) {
                        // Capture the Screen Image once after 5 seconds
                        setTimeout(function() {
                            captureScreenAndSave();
                        }, 5000);
                    }
                });

                $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                        action: 'updatelastactivetime',
                        courseid: courseid
                    })
                    .done(function(result) {
                        openRelevantWindow();
                    });
            });

            $('#final-screen-start').click(function() {
                $('div.finalscreen-messages').removeClass('hidden');
                if (finalprocessingtime != 0) {
                    $('#finalprocessingpage').removeClass('hidden');
                }
                $('#final-screen-div').addClass('hidden');

                $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                        action: 'updatelastactivetime',
                        courseid: courseid
                    })
                    .done(function(result) {
                        openRelevantWindow();
                    });
            });

            function getGetParamValue(paramName) {
                var url_string = window.location.href;
                var url = new URL(url_string);
                return url.searchParams.get(paramName);
            }

            /*******************Program execution starts here ****************/

            //Lets not do any of these if we are not in screenshare/finalscreen action
            if (($.inArray(getGetParamValue("action"), ["finalscreen", "forcescreensharing"])) != -1) {
                //Lets decide on the view. We have 2 views
                //1. Screensharing instruction view
                //2. View to directly start assessment
                if (screenShareEnabled) {
                    var action_param = getGetParamValue("action");
                    if (action_param == 'forcescreensharing') {
                        $('#forcescreensharing').removeClass('hidden');
                        $('#final-screen-div').addClass('hidden');
                    } else if (action_param == 'finalscreen') {
                        $('#forcescreensharing').addClass('hidden');
                        $('#final-screen-div').removeClass('hidden');
                    }
                } else {
                    //screensharing is not enabled. Lets just show the relevant messages
                    $('#forcescreensharing').addClass('hidden');
                    $('#final-screen-div').removeClass('hidden');
                }
            }

            //lets do anything. But only if config is enabled
            if (screenShareEnabled) {
                setTimeout(function() {
                    $('#screenshare_fail').removeClass('hidden');
                }, 20000);
                //Let handle the flow of screenshot getting triggered when startscreenshare is invoked
                $('#startScreenShare').click(function() {
                    startScreenCapture();
                });
            }
        }
    };
});
define('block_coursetimer/procfeed', ['jquery', 'core/ajax'], function($, ajax) {

    return {
        init: function(args) {
            var rootPath = M.cfg.wwwroot;
            //var courseid = args.courseid;
            var proctorid = args.proctorid;
            var langcloseAttemptHeader = args.langcloseAttemptHeader;
            var langCloseAttemptConfirmation = args.langCloseAttemptConfirmation;
            var forcfullyassessmentclosed = args.forcfullyassessmentclosed;
            var refresh_timeinterval = 30000;
            var refresh_pendingapproval = 15000;

            var storagePrefixD = 'coursetimer_' + proctorid + "_livemodal_proc";

            var livefeed_tabactive = true;
            var approval_tabactive = false;
            var approved_tabactive = false;

            //confirmation modal for closing the attempt
            var closeAttemptConfirmationmodal =
                `<div class="modal modal-backdrop fade text-center" id="close-attempt-confirm" style="z-index:1200 !important; opacity:1;" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="width:50%;margin-left: 25%;">
                        <div class="modal-header">
                            <h5 class="modal-title text-danger">` + langcloseAttemptHeader + `</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                            <div class="container confirm-msg" align="center">
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        <textarea class="form-control border border-dark" name="procEndtesttext"
                                        rows="3" placeholder="Ex : Re-upload images capturing them from brighter lighting conditions"></textarea>  
                                    </div>
                                </div>
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        
                                    </div>
                                </div>
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-danger mt-3" id="close-attempt-confirmed">End Test</button>
                                    </div>
                                </div>
                            </div>
                            <div class="loading hidden" align="center"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></div>
                            <p class="hidden closed-msg">` + forcfullyassessmentclosed + `</p>
                            
                        </div>
                        <div class="modal-footer hidden" style="margin-top:0rem;">
                            <button type="button" id="close-attempt-Yes" class="btn btn-danger hidden">Yes</button>
                            <button type="button" id="close-attempt-cancel" onclick="$('#close-attempt-confirm').modal('hide')" class="btn btn-success">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>`;
            $("#page-header").append(closeAttemptConfirmationmodal);

            var rejectapprovalmodal =
                `<div class="modal fade" id="rejectapproval" role="dialog">
                    <div class="modal-dialog">
      
                     <div class="modal-content">
                        <div class="modal-header border border-white" style="text-align: center;">
                        <h4 style="flex: auto;">Please specify reasons for rejecting the approval<h5>
                        <button type="button" class="close closemodal" data-dismiss="modal">&times;</button>
                        </div>
 
                        <div class="modal-body">          
                            <div class="container" align="center">
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        <textarea class="form-control border border-dark" name="rejecttext"
                                        rows="3" placeholder="Ex : Re-upload images capturing them from brighter lighting conditions"></textarea>  
                                    </div>
                                </div>
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        
                                    </div>
                                </div>
                                <div class="row"  align="center">
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-danger mt-3" id="submitreject">Reject</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            $("#page-header").append(rejectapprovalmodal);


            var verificationdetailsmodal =
                `<div class="modal modal-backdrop fade text-center" id="verificationimages" style="z-index:1200 !important; opacity:1;" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="width:100%">
                        <div class="modal-header">
                            <h5 class="modal-title text-danger col-sm">Approval Details</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-sm">
                                    <h6>Reference Image</h6><img src="" class="card-img-top" alt="reference_image" id="referenceimage">
                                </div>
                                <div class="col-sm">
                                    <h6>Verification ID</h6><img src="" class="card-img-top" alt="verification_image" id="verificationimage">
                                </div>
                            </div>
                            
                            <p class="confirm-msg"></p>
                        </div>
                        <div class="modal-footer" style="margin-top:0rem;">
                            
                        </div>
                    </div>
                </div>
            </div>`;
            $("#page-header").append(verificationdetailsmodal);

            $("#livefeed_tab").click(function() {
                livefeed_tabactive = true;
                approval_tabactive = false;
                approved_tabactive = false;

                $("#livefeed_tab").attr("class", "nav-link active");
                $("#approved_notstarted_tab").attr("class", "nav-link");
                $("#approval_tab").attr("class", "nav-link");
                $("#pending_approvals").html("");
                $("#approved_notstarted").html("");

                $("#proc_livefeed_data").html("<img align='center' style='width:70px' src='" +
                    M.cfg.wwwroot +
                    "/blocks/coursetimer/pix/loading.gif' / > ");

                ct_livefeed_update(0, proctorid);

                $('#user_pendingapproval_modal').css('display', 'none');
                $('#user_live_data_modal').css('display', 'flex');
                $("#userfeedcontrols").removeClass('hidden');
            });

            $("#approval_tab").click(function() {
                livefeed_tabactive = false;
                approval_tabactive = true;
                approved_tabactive = false;

                $("#livefeed_tab").attr("class", "nav-link");
                $("#approved_notstarted_tab").attr("class", "nav-link");
                $("#approval_tab").attr("class", "nav-link active");
                $("#proc_livefeed_data").html("");
                $("#approved_notstarted").html("");

                $("#pending_approvals").html("<img align='center' style='width:70px' src='" +
                    M.cfg.wwwroot +
                    "/blocks/coursetimer/pix/loading.gif' / > ");
                ct_pendingApprovals(proctorid);

                $('#user_pendingapproval_modal').css('display', 'block');
                $('#user_live_data_modal').css('display', 'none');
                $("#userfeedcontrols").addClass('hidden');
            });

            $("#approved_notstarted_tab").click(function() {
                livefeed_tabactive = false;
                approval_tabactive = false;
                approved_tabactive = true;

                $("#livefeed_tab").attr("class", "nav-link");
                $("#approval_tab").attr("class", "nav-link");
                $("#approved_notstarted_tab").attr("class", "nav-link active");
                $("#proc_livefeed_data").html("");
                $("#pending_approvals").html("");

                $("#approved_notstarted").html("<img align='center' style='width:70px' src='" +
                    M.cfg.wwwroot +
                    "/blocks/coursetimer/pix/loading.gif' / > ");
                ct_approvedNotstarted(proctorid);

                $('#user_pendingapproval_modal').css('display', 'none');
                $('#user_live_data_modal').css('display', 'none');
                $("#userfeedcontrols").addClass('hidden');
            });

            // Update KPI  Data
            ct_kpi_update(proctorid);

            ct_pendingApprovalCount(proctorid);

            $("#started_kpi").change(function() {
                ct_kpi_update(proctorid);
                ct_livefeed_update(1, proctorid);
            });

            $("#notstarted_kpi").change(function() {
                ct_kpi_update(proctorid);
                ct_livefeed_update(1, proctorid);
            });

            $("#locked_kpi").change(function() {
                ct_kpi_update(proctorid);
                ct_livefeed_update(1, proctorid);
            });

            $("#paused_kpi").change(function() {
                ct_kpi_update(proctorid);
                ct_livefeed_update(1, proctorid);
            });


            $("#completed_kpi").change(function() {
                ct_kpi_update(proctorid);
                ct_livefeed_update(1, proctorid);
            });

            $("#flaggedusersonly").change(function() {
                ct_livefeed_update(1, proctorid);
            });

            function ct_pendingApprovalCount(proctoridval = 0) {

                if (proctoridval == 0) {
                    proctoridval = proctorid;
                }

                var livemodalstatus = localStorage.getItem(storagePrefixD + "livemodalstatus")
                    // If modal is open, no need to update the kpi data
                if (livemodalstatus === "open") {
                    return;
                }

                var data = ajax.call([{
                    methodname: 'block_coursetimer_fetch_pendingapproval_count',
                    args: {
                        courseid: null,
                        proctorid: proctorid
                    }
                }]);

                data[0].done(function(response) {
                    $("#approval_tab").html(" Pending Approvals (" + response.total + ")");
                    if(response.approvedNotstarted>=0){
                        $("#approved_notstarted_tab").html(" Approved-Yet to start (" + response.approvedNotstarted + ")");
                    }
                }).fail(function(ex) {
                    // do something with the exception
                    console.log("Failed");
                });

            }

            function ct_pendingApprovals(proctoridval = 0) {

                if (proctoridval == 0) {
                    proctoridval = proctorid;
                }
                if (approval_tabactive !== false) {

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'notapprovedusers',
                            proctorid: proctoridval
                        })
                        .done(function(result) {
                            if (approval_tabactive !== false) {
                                $("#approval_tab").html(" Pending Approvals (" + result[1] + ")");
                                $('#pending_approvals').html(result[0]);
                            }
                        });
                }
            }

            function ct_approvedNotstarted(proctoridval = 0) {

                if (proctoridval == 0) {
                    proctoridval = proctorid;
                }
                if (approved_tabactive !== false) {

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'approvednotstartedusers',
                            proctorid: proctoridval
                        })
                        .done(function(result) {
                            if (approved_tabactive !== false) {
                                $("#approved_notstarted_tab").html(" Approved-Yet to start (" + result[1] + ")");
                                $('#approved_notstarted').html(result[0]);
                            }
                        });
                }
            }

            // Method to update the live feed KPI data
            function ct_kpi_update(proctorid) {

                var livemodalstatus = localStorage.getItem(storagePrefixD + "livemodalstatus")
                    // If modal is open, no need to update the kpi data
                if (livemodalstatus === "open") {
                    return;
                }

                var data = ajax.call([
                    { methodname: 'block_coursetimer_fetch_proctoring_kpi', args: { courseid: null, proctorid: proctorid } }
                ]);

                data[0].done(function(response) {

                    $('#totalusers').html(response.total);
                    $('#startedusers').html(response.started);
                    $('#notstartedusers').html(response.yettostart);
                    $('#lockedusers').html(response.locked);
                    $('#pausedusers').html(response.paused);
                    $('#completedusers').html(response.completed);

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'proctoringtime',
                            proctorid: proctorid,
                            totaluser: response.total,
                            comuser: response.completed
                        })
                        .done(function(result) {
                            if (result != null) {
                                $('#starttime').html(result.starttime);
                                $('#endtime').html(result.endtime);
                            }

                        })



                }).fail(function(ex) {
                    // do something with the exception
                    //console.log("Failed");
                });
            }

            function ct_livefeed_update(idval, proctorid) {

                var livemodalstatus = localStorage.getItem(storagePrefixD + "livemodalstatus")
                    // If modal is open, no need to update the kpi data
                if (livemodalstatus === "open") {
                    return;
                }

                if (idval == 0) {
                    var idval = $('.active.paginationlivefeed > a').html();
                    if (typeof idval === "undefined") {
                        idval = 1;
                    }
                }

                var started = 0;
                var notstarted = 0;
                var locked = 0;
                var completed = 0;
                var paused = 0;
                var flagged = 0;
                var viewscreenimage = false;

                if ($('#started_kpi').prop("checked") == true) {
                    started = 1;
                }

                if ($('#notstarted_kpi').prop("checked") == true) {
                    notstarted = 1;
                }

                if ($('#locked_kpi').prop("checked") == true) {
                    locked = 1;
                }

                if ($('#paused_kpi').prop("checked") == true) {
                    paused = 1;
                }

                if ($('#completed_kpi').prop("checked") == true) {
                    completed = 1;
                }

                if ($('#flaggedusersonly').prop("checked") == true) {
                    flagged = 1;
                }

                if ($('#displayuserimage').prop("checked") == true) {
                    viewscreenimage = true;
                }

                $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                        action: 'proclivedata',
                        page: idval,
                        proctorid: proctorid,
                        started: started,
                        notstarted: notstarted,
                        locked: locked,
                        paused: paused,
                        completed: completed,
                        flagged: flagged
                    })
                    .done(function(result) {

                        var modalstatus = 0;
                        var dialoguecontent = '';
                        var buttontext = '';
                        var modalstatus = $("#confirmationflag").hasClass('show');
                        if (modalstatus == true) {
                            modalstatus = 1;
                            dialoguecontent = $(".confirmationflagcontent").text();
                            buttontext = $('#flagevent').text();
                        } else {
                            modalstatus = 0;
                        }

                        if (livefeed_tabactive !== false) {
                            $('#proc_livefeed_data').html(result[0]);
                            $("#flaggedUserCount").html(result[1]);

                            if (modalstatus == 1) {
                                //$(".modal-backdrop").removeClass('show');
                                $('.modal-backdrop').remove();
                                $(".confirmationflagcontent").text(dialoguecontent);
                                $('#flagevent').text(buttontext);
                                $("#confirmationflag").modal('show');
                            }

                            //display screenshare in default
                            if (viewscreenimage !== false) {
                                $('.userimagecaptured').addClass('hidden');
                                $('.screenimagecaptured').removeClass('hidden');
                            }
                        }
                    });
            }

            $('#accept_image_approval').click(function() {

                if (confirm("Are you sure you want to approve this user for the assessment?")) {

                    var userid = $('#user_approval_image').attr('userid');
                    var courseid = $('#user_approval_image').attr('courseid');

                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                            action: 'acceptapproval',
                            userid: userid,
                            courseid: courseid
                        })
                        .done(function(result) {
                            $('#userLiveData').modal('hide');
                            $('#userpendingapproval').modal('hide');
                            ct_pendingApprovals(0); // TODO: this is users courseid
                            ct_pendingApprovalCount(0);
                        });
                } else {
                    $('#userLiveData').modal('hide');
                    $('#userpendingapproval').modal('hide');
                    // console.log("No");
                }
            });

            $('#reject_image_approval').click(function() {


                $('#userpendingapproval').modal('hide');
                $('#userLiveData').modal('hide');
                $("textarea[name=rejecttext]").val('');
                $('#rejectapproval').modal('show');

            });

            $('#submitreject').click(function() {

                var userid = $('#user_approval_image').attr('userid');
                var courseid = $('#user_approval_image').attr('courseid');
                var rejectmessage = $("textarea[name=rejecttext]").val();
                if (rejectmessage.length >= 10) {
                    $.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
                        action: 'rejectapproval',
                        userid: userid,
                        courseid: courseid,
                        rejectmessage: rejectmessage
                    }).done(function(result) {
                        $('#rejectapproval').modal('hide');
                        ct_pendingApprovals(0);
                    });
                } else {
                    $('#page-blocks-coursetimer-proctorfeed textarea[name="rejecttext"]').removeClass('border-dark');
                    $('#page-blocks-coursetimer-proctorfeed textarea[name="rejecttext"]').addClass('border-danger');
                    var errorElement = `
                        <p class="text-left mt-2 text-danger" id="approval-error">
                            Please specify your reason for rejecting the approval in not less than 10 characters
                        </p>
                    `;
                    $('#page-blocks-coursetimer-proctorfeed #approval-error').remove();
                    $(errorElement).insertAfter('#page-blocks-coursetimer-proctorfeed textarea[name="rejecttext"]');
                }
            });

            //Handle reject approval close action
            $('#rejectapproval').on('hide.bs.modal', function(e) {
                $('#page-blocks-coursetimer-proctorfeed #approval-error').remove();
                $('#page-blocks-coursetimer-proctorfeed textarea[name="rejecttext"]').removeClass('border-danger');
                $('#page-blocks-coursetimer-proctorfeed textarea[name="rejecttext"]').addClass('border-dark');
            });


            // Refresh data in regular interval
            var stopHandle = setInterval(function() {
                ct_kpi_update(proctorid);
                ct_pendingApprovalCount(proctorid);

                if (livefeed_tabactive !== false) {
                    ct_livefeed_update(0, proctorid);
                }

            }, refresh_timeinterval);

            // Refresh pending approval data in regular interval
            var stopHandle2 = setInterval(function() {
                if (approval_tabactive !== false) {
                    ct_pendingApprovals(proctorid);
                }
            }, refresh_pendingapproval);

            // Refresh approved-yet to start data in regular interval
            var stopHandle2 = setInterval(function() {
                if (approved_tabactive !== false) {
                    ct_approvedNotstarted(proctorid);
                }
            }, refresh_pendingapproval);

            //Event to capture pause attempt button
            $('#pause_test_link').click(function() {

                userid = $('#livefeed_username').attr('userid');
                var courseid = $('#livefeed_username').attr('courseid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'pauseattempt' },
                    success: function() {
                        $('#pause_test_link').addClass('hidden');
                        $('#resume_test_link').removeClass('hidden');
                    }
                });
            });

            //Event to capture resume attempt button
            $('#resume_test_link').click(function() {

                userid = $('#livefeed_username').attr('userid');
                var courseid = $('#livefeed_username').attr('courseid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'resumeattempt' },
                    success: function() {
                        $('#resume_test_link').addClass('hidden');
                        $('#pause_test_link').removeClass('hidden');
                    }
                });
            });

            //Event to capture unlock attempt button
            $('#unlock_test_link').click(function() {

                userid = $('#livefeed_username').attr('userid');
                var courseid = $('#livefeed_username').attr('courseid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'unlockattempt' },
                    success: function() {
                        $('#unlock_test_link').addClass('hidden');
                        $('#pause_test_link').removeClass('hidden');
                    }
                });
            });

            $('#verificationdetails').click(function() {
                userid = $('#livefeed_username').attr('userid');
                var courseid = $('#livefeed_username').attr('courseid');
                $.ajax({
                    type: "POST",
                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                    data: { 'courseid': courseid, 'userid': userid, 'action': 'getverificationimages' },
                    success: function(response) {
                        $("#referenceimage").attr("src", response.reference);
                        $("#verificationimage").attr("src", response.verification);
                        $("#verificationimages").attr("userid", "userid_" + userid);
                        $('#verificationimages').modal('show');
                        $('#userLiveData').modal('hide');
                    }
                });
            });


            //Event to capture close attempt button
            $('#end_test_link').click(function() {
                $("textarea[name=procEndtesttext]").val('');
                $('#close-attempt-cancel').text('Cancel');
                $('#close-attempt-confirmed').removeClass('hidden');
                $('#close-attempt-confirm .modal-body .loading').addClass('hidden');
                $('#close-attempt-confirm .modal-body .closed-msg').addClass('hidden');
                $('#close-attempt-confirm .modal-body .confirm-msg').removeClass('hidden');
                $('#close-attempt-confirm .modal-footer').addClass('hidden');
                $('#close-attempt-confirm').modal('show');
            });

            $('#close-attempt-confirmed').click(function() {
                var userid = $('#livefeed_username').attr('userid');
                var courseid = $('#livefeed_username').attr('courseid');
                var endtestmessage = $("textarea[name=procEndtesttext]").val();
                if (endtestmessage.length >= 10){
                    $('#close-attempt-confirm .modal-body .loading').removeClass('hidden');
                    $('#close-attempt-confirm .modal-body .confirm-msg').addClass('hidden');
                    $.ajax({
                        type: "POST",
                        url: rootPath + "/blocks/coursetimer/proctoring_ajax.php",
                        data: { 'courseid': courseid, 'userid': userid, 'action': 'closeattempt', 'endtestmessage': endtestmessage },
                        success: function() {
                            $('#close-attempt-cancel').text('Close');
                            $('#close-attempt-confirmed').addClass('hidden');
                            $('#close-attempt-confirm .modal-body .closed-msg').removeClass('hidden');
                            $('#close-attempt-confirm .modal-body .loading').addClass('hidden');
                            $('#close-attempt-confirm .modal-footer').removeClass('hidden');
                        }
                    });
                } else {
                    $('#page-blocks-coursetimer-proctorfeed textarea[name="procEndtesttext"]').removeClass('border-dark');
                    $('#page-blocks-coursetimer-proctorfeed textarea[name="procEndtesttext"]').addClass('border-danger');
                    var errorElement = `
                        <p class="text-left mt-2 text-danger" id="endtest-error">
                            Please specify your reason for Closing the User's attempt in not less than 10 characters
                        </p>
                    `;
                    $('#page-blocks-coursetimer-proctorfeed #endtest-error').remove();
                    $(errorElement).insertAfter('#page-blocks-coursetimer-proctorfeed textarea[name="procEndtesttext"]');
                }
            });

            //Handle close-attempt-confirm close action
            $('#rejectapproval').on('hide.bs.modal', function(e) {
                $('#page-blocks-coursetimer-proctorfeed #endtest-error').remove();
                $('#page-blocks-coursetimer-proctorfeed textarea[name="procEndtesttext"]').removeClass('border-danger');
                $('#page-blocks-coursetimer-proctorfeed textarea[name="procEndtesttext"]').addClass('border-dark');
            });

            $(document).ready(function() {
                var tagspanexid = 1;
                var tagex = 1;
                var final = [];
                var finalJson = [];

                function autocomplete(inp, arr) {

                    /*the autocomplete function takes two arguments,
                    the text field element and an array of possible autocompleted values:*/
                    var currentFocus;
                    /*execute a function when someone writes in the text field:*/
                    inp.addEventListener("input", function(e) {
                        var a, b, i, val = this.value;
                        /*close any already open lists of autocompleted values*/

                        closeAllLists();
                        if (!val) { return false; }
                        currentFocus = -1;
                        /*create a DIV element that will contain the items (values):*/
                        a = document.createElement("DIV");
                        a.setAttribute("id", this.id + "autocomplete-list");
                        a.setAttribute("class", "autocomplete-items");
                        /*append the DIV element as a child of the autocomplete container:*/
                        this.parentNode.appendChild(a);
                        /*for each item in the array...*/
                        for (i = 0; i < arr.length; i++) {
                            res = arr[i].split("-");
                            var name = res[0].toUpperCase();
                            var email = res[2].toUpperCase();
                            var idnmuber = '';
                            if (res[3]) {
                                idnmuber = res[3].toUpperCase();
                            }
                            /*check if the item starts with the same letters as the text field value:*/
                            if (name.includes(val.toUpperCase())) {
                                /*create a DIV element for each matching element:*/
                                b = document.createElement("DIV");
                                /*make the matching letters bold:*/
                                // var boldletters = "<strong>" + val + "</strong>";
                                b.innerHTML = res[0];
                                // b.innerHTML = res[0].replace(/val/gi,boldletters);
                                /*insert a input field that will hold the current array item's value:*/
                                b.innerHTML += "<input type='hidden' value='" + res[0] + "'>";
                                b.innerHTML += "<input id='userId" + res[1] + "' type='hidden' value='" + res[1] + "_" + res[4] + "'>";
                                /*execute a function when someone clicks on the item value (DIV element):*/
                                b.addEventListener("click", function(e) {
                                    var userdatatag = this.getElementsByTagName("input")[1].value;
                                    userdatatagvalue = userdatatag.split("_");
                                    userid = userdatatagvalue[0];
                                    courseid = userdatatagvalue[1];
                                    var userdata = {
                                        id: "userid_" + userid
                                    };
                                    // fetch this single user data - proctorid - getlivefeedsearch - userid
                                    $.ajax({
                                        method: "POST",
                                        url: M.cfg.wwwroot + '/blocks/coursetimer/proctoring_ajax.php',
                                        data: { "action": "getlivefeedsearch", "proctorid": proctorid, "userid": userid, "courseid": courseid }
                                    }).done(function(response) {
                                        $('#livesearch_result').html(response);
                                        userliveModal(userdata);
                                    });

                                });
                                a.appendChild(b);
                            } else if (email.includes(val.toUpperCase())) {
                                /*create a DIV element for each matching element:*/
                                b = document.createElement("DIV");
                                /*make the matching letters bold:*/
                                b.innerHTML = res[2];
                                // b.innerHTML = "<strong>" + res[0].substr(0, val.length) + "</strong>";
                                // b.innerHTML += res[0].substr(val.length);
                                /*insert a input field that will hold the current array item's value:*/
                                b.innerHTML += "<input type='hidden' value='" + res[2] + "'>";
                                b.innerHTML += "<input id='userId" + res[1] + "' type='hidden' value='" + res[1] + "_" + res[4] + "'>";
                                /*execute a function when someone clicks on the item value (DIV element):*/
                                b.addEventListener("click", function(e) {
                                    //userid = this.getElementsByTagName("input")[1].value;
                                    var userdatatag = this.getElementsByTagName("input")[1].value;
                                    userdatatagvalue = userdatatag.split("_");
                                    userid = userdatatagvalue[0];
                                    courseid = userdatatagvalue[1];
                                    var userdata = {
                                        id: "userid_" + userid
                                    };
                                    // fetch this single user data - proctorid - getlivefeedsearch - userid
                                    $.ajax({
                                        method: "POST",
                                        url: M.cfg.wwwroot + '/blocks/coursetimer/proctoring_ajax.php',
                                        data: { "action": "getlivefeedsearch", "proctorid": proctorid, "userid": userid, "courseid": courseid }
                                    }).done(function(response) {
                                        $('#livesearch_result').html(response);
                                        userliveModal(userdata);
                                    });

                                });
                                a.appendChild(b);
                            } else if (idnmuber.includes(val.toUpperCase())) {
                                /*create a DIV element for each matching element:*/
                                b = document.createElement("DIV");
                                /*make the matching letters bold:*/
                                b.innerHTML = res[3];
                                // b.innerHTML = "<strong>" + res[0].substr(0, val.length) + "</strong>";
                                // b.innerHTML += res[0].substr(val.length);
                                /*insert a input field that will hold the current array item's value:*/
                                b.innerHTML += "<input type='hidden' value='" + res[3] + "'>";
                                b.innerHTML += "<input id='userId" + res[1] + "' type='hidden' value='" + res[1] + "_" + res[4] + "'>";
                                /*execute a function when someone clicks on the item value (DIV element):*/
                                b.addEventListener("click", function(e) {
                                    //userid = this.getElementsByTagName("input")[1].value;
                                    var userdatatag = this.getElementsByTagName("input")[1].value;
                                    userdatatagvalue = userdatatag.split("_");
                                    userid = userdatatagvalue[0];
                                    courseid = userdatatagvalue[1];
                                    var userdata = {
                                        id: "userid_" + userid
                                    };
                                    // fetch this single user data - proctorid - getlivefeedsearch - userid
                                    $.ajax({
                                        method: "POST",
                                        url: M.cfg.wwwroot + '/blocks/coursetimer/proctoring_ajax.php',
                                        data: { "action": "getlivefeedsearch", "proctorid": proctorid, "userid": userid, "courseid": courseid }
                                    }).done(function(response) {
                                        $('#livesearch_result').html(response);
                                        userliveModal(userdata);
                                    });

                                });
                                a.appendChild(b);
                            }
                        }
                    });
                    /*execute a function presses a key on the keyboard:*/
                    inp.addEventListener("keydown", function(e) {
                        var x = document.getElementById(this.id + "autocomplete-list");
                        if (x) x = x.getElementsByTagName("div");
                        if (e.keyCode == 40) {

                            /*If the arrow DOWN key is pressed,
                            increase the currentFocus variable:*/
                            currentFocus++;

                            /*and and make the current item more visible:*/
                            addActive(x);

                        } else if (e.keyCode == 38) { //up
                            /*If the arrow UP key is pressed,
                            decrease the currentFocus variable:*/
                            currentFocus--;
                            /*and and make the current item more visible:*/
                            addActive(x);
                        } else if (e.keyCode == 13) {
                            /*If the ENTER key is pressed, prevent the form from being submitted,*/

                            if (currentFocus > -1) {
                                /*and simulate a click on the "active" item:*/
                                if (x) x[currentFocus].click();
                            }
                        }
                    });

                    function addActive(x) {
                        /*a function to classify an item as "active":*/
                        if (!x) return false;
                        /*start by removing the "active" class on all items:*/
                        removeActive(x);
                        if (currentFocus >= x.length) currentFocus = 0;
                        if (currentFocus < 0) currentFocus = (x.length - 1);
                        /*add class "autocomplete-active":*/
                        x[currentFocus].classList.add("autocomplete-active");
                    }

                    function removeActive(x) {
                        /*a function to remove the "active" class from all autocomplete items:*/
                        for (var i = 0; i < x.length; i++) {
                            x[i].classList.remove("autocomplete-active");
                        }
                    }

                    function closeAllLists(elmnt) {
                        /*close all autocomplete lists in the document,
                        except the one passed as an argument:*/
                        var x = document.getElementsByClassName("autocomplete-items");
                        for (var i = 0; i < x.length; i++) {
                            if (elmnt != x[i] && elmnt != inp) {
                                x[i].parentNode.removeChild(x[i]);
                            }
                        }
                    }
                    /*execute a function when someone clicks in the document:*/
                    document.addEventListener("click", function(e) {
                        closeAllLists(e.target);
                    });
                }

                function coursetimer_populateSearch() {
                    var data = ajax.call([{
                        methodname: 'block_coursetimer_fetch_proctoring_userlist',
                        args: {
                            courseid: null,
                            proctorid: proctorid
                        }
                    }]);

                    data[0].done(function(response) {
                        data = $.parseJSON(JSON.stringify(response));
                        $.each(data, function(i, v) {
                            final.push(v.name + '-' + v.id + '-' + v.email + '-' + v.idnumber + '-' + v.courseid);
                            finalJson.push({
                                "id": v.id,
                                "name": v.name
                            });
                        });
                        autocomplete(document.getElementById("livefeedsearch"), final);
                    }).fail(function(ex) {
                        // do something with the exception
                        console.log("Search Failed");
                    });
                }

                coursetimer_populateSearch();
            });

        }

    };
});
define('block_coursetimer/polling', ['jquery', 'core/ajax', 'core/config', 'core/modal_factory', 'core/pubsub', 'core_message/message_drawer_events'],
    function($, ajax, mdlcfg, ModalFactory, PubSub, MessageDrawerEvents) {
        return {
            init: function(args) {

                var failCount = 0;
                var baseURL = mdlcfg.wwwroot;
                var courseid = args.courseid;
                var userid = args.userid;
                var webcamproctoring = args.webcamproctoring;
                var forcescreensharing = args.forcescreensharing;
                var webcaminterval = args.webcaminterval;
                var webcamproctoringlock = args.webcamproctoringlock;
                var screenshotinterval = args.screenshotinterval;
                var screenshotfaillock = args.screenshotfaillock;
                var langPollFailMessage = args.nointernet_warning;
                var langPollSuccessMessage = args.internet_back_again;
                var langNoInternetWarning = args.noInternetWarning;
                var langNoInternetWarningHeader = args.noInternetWarningHeader;
                var lock_status = args.lock_status;
                var completed_status = args.completed_status;
                var current_url = window.location.href;
                var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
                var webcamfailCount = 0;
                var screenfailCount = 0;
                var redirectURLonFail = "";
                var currentTimerInterval = null;
                var desktopNotification = args.desktopNotification;
                var screensharepermissionMsg = args.screensharepermissionMsg;
                var webcampermissionMsg = args.webcampermissionMsg;
                var nointernetNotification = 0;
                var pollcall = args.pollcall;

                ////////////  Poll server implementation methods start ///////////////////////////
                function pollServer() {
                    var promises = ajax.call([{
                        methodname: 'block_coursetimer_poll_server',
                        args: { 'courseid': courseid }
                    }, ]);

                    promises[0].done(function(response) {
                        pollSuccess(response);
                        if (currentTimerInterval) clearInterval(currentTimerInterval)
                        currentTimerInterval = setInterval(() => {
                            localStorage.setItem(storagePrefix + "currentTime", (parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10) + 1))
                        }, 1000)
                    }).fail(function(ex) {
                        pollFail(ex);
                    });
                }

                //Method that polls server after 5 seconds of calling
                function pollAgain() {
                    setTimeout(function() {
                        pollServer();
                    }, pollcall);
                }

                function showInternetConnectivityWarning() {
                    if ($('#no-internet-warning').length == 0) {
                        $('#page-header').after(
                            `<div class="alert alert-danger" id="no-internet-warning" style="margin-left: 1em;" role="alert">` +
                            langPollFailMessage +
                            `</div>`
                        );
                    }
                }

                function removeInternetConnectivityWarning() {
                    $('#no-internet-warning').fadeTo(500, 0).slideUp(500, function() {
                        $(this).remove();
                    });
                }

                function beforeReload() {
                    //TODO:: Handling quiz essay or others?
                    if (current_url.includes("mod/vpl/forms/edit.php")) {
                        $('#vpl_ide_save')[0].click();
                    }

                }

                function checkResponseData(response) {

                    //If webstreaming is requested, lets inform that to imageCapture js
                    localStorage.setItem(storagePrefix + "shouldStream", response.shouldStreamWebcam);

                    if (response.lock_status != lock_status || response.completed_status != completed_status) {
                        beforeReload();
                        //Server data and client data doesn't match. 
                        //We should just refresh the page for updated data to be shown to user
                        setTimeout(function() {
                            location.reload();
                        }, 1000);
                    }

                }

                //Poll ajax is successfull.
                function pollSuccess(response) {

                    //Lets update necessary info in local storage 
                    var currentTime = Math.round(new Date().getTime() / 1000);
                    localStorage.setItem(storagePrefix + "lastPollTime", response.currentTime);
                    localStorage.setItem(storagePrefix + "startTime", response.startTime);
                    localStorage.setItem(storagePrefix + "closeTime", response.closeTime);
                    localStorage.setItem(storagePrefix + "completed", response.completed_status);
                    localStorage.setItem(storagePrefix + "lockStatus", response.lock_status);
                    localStorage.setItem(storagePrefix + "currentTime", response.currentTime);

                    //If internet is back after a failure, handle it
                    if (failCount != 0) {
                        removeInternetConnectivityWarning();
                        $('#page-header').after(
                            `<div class="alert alert-success" id="internet-back-again" style="margin-left: 1em;" role="alert">` +
                            langPollSuccessMessage +
                            `</div>`
                        );
                        //Auto dismiss internet success alert after 5 seconds
                        window.setTimeout(function() {
                            $("#internet-back-again").fadeTo(500, 0).slideUp(500, function() {
                                $(this).remove();
                            });
                        }, 5000);
                    }

                    checkResponseData(response);
                    failCount = 0;

                    // Reset notification since the connection is up
                    nointernetNotification = 0;

                    // Check for Webcam/Screenshare Fail
                    webcamScreenPollCheck(response);

                    //Lets ping server again
                    pollAgain();
                }

                function webcamScreenPollCheck(response) {

                    var permissionMessage = "Permission Denied";

                    var localflag = false;

                    if (response.webcam !== true) {
                        webcamfailCount++;
                        if (webcamfailCount > 4) {
                            webcamfailCount = 0;
                            screenfailCount = 0;
                            redirectURLonFail = M.cfg.wwwroot + "/blocks/coursetimer/verify.php?id=" + courseid + "&action=webcamcheck";
                            permissionMessage = webcampermissionMsg;
                            localflag = true;
                            // Make an ajax for cam off
                            $.ajax({
                                type: "POST",
                                url: M.cfg.wwwroot + "/blocks/coursetimer/log_ajax.php?action=webcamoff&redirect=1&courseid=" + courseid,
                                success: function(response) {
                                    //do stuff here				          		  		
                                }
                            });
                        }
                    } else {
                        webcamfailCount = 0;
                    }

                    if (localflag !== true && response.screenshare !== true) {
                        screenfailCount++;
                        if (screenfailCount > 4) {
                            screenfailCount = 0;
                            webcamfailCount = 0;
                            redirectURLonFail = M.cfg.wwwroot + "/blocks/coursetimer/verify.php?id=" + courseid + "&action=forcescreensharing";
                            permissionMessage = screensharepermissionMsg;
                            localflag = true;
                            // Make an ajax for screenshare off
                            $.ajax({
                                type: "POST",
                                url: M.cfg.wwwroot + "/blocks/coursetimer/log_ajax.php?action=screenshareoff&redirect=1&courseid=" + courseid,
                                success: function(response) {
                                    //do stuff here				          		  		
                                }
                            });
                        }
                    } else {
                        screenfailCount = 0;
                    }

                    if (localflag === true) {
                        // Send a desktop notiication
                        if (desktopNotification == 1) {
                            createNotification(permissionMessage, '', $(' head > link:nth-child(2)').attr('href'));
                        }

                        // Save the code before redirection
                        beforeReload();
                        setTimeout(function() {

                            // Screenshare/webcam image got stopped 
                            var lastactiveTime = parseInt(localStorage.getItem(storagePrefix + "parentActiveTime"), 10);
                            var now = (new Date() / 1000) - 5;

                            localStorage.setItem(storagePrefix + "redirectURLonFail", redirectURLonFail);

                            // If last active time is updated in last five seconds then parent is active
                            if (lastactiveTime >= now) {
                                // Close Child
                                window.top.close();
                            } else {
                                // Parent not active so redirect this page
                                location.replace(redirectURLonFail);
                            }
                        }, 1000);
                    }

                }

                function showErrorModal() {
                    //Very likely internet failed. Lets show appropriate message

                    var modal =
                        `<div class="modal modal-backdrop" id="noInternetWarningModal" role="dialog">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title text-danger">` + langNoInternetWarningHeader + `</h5>
                                    </div>
                                    <div class="modal-body">
                                        <p>` + langNoInternetWarning + `</p>
                                    </div>
                                    <div class="modal-footer" style="margin-top:0rem;">
                                        <button type="button" onclick="location.reload();" class="btn btn-primary">Refresh</button>
                                    </div>
                                </div>
                            </div>
                        </div>`;

                    $('#page-header').after(modal);
                    $('#noInternetWarningModal').show();

                    // console.log("No Internet Connection");

                    // Desktop notification for internet fail
                    if (desktopNotification == 1 && nointernetNotification == 0) {
                        createNotification(langNoInternetWarningHeader, "Your assessment could be locked due to bad connectivity.Please connect to a stable internet connection", $('head > link:nth-child(2)').attr('href'));
                        nointernetNotification = 1;
                    }

                }

                //Poll ajax failed. Lets retry making the necessary changes
                function pollFail(exception) {
                    if (failCount >= 4) {
                        showErrorModal();
                        //No more polling required. Attempt should ideally be locked by server now
                        return;
                    }

                    //Lets add appropriate message to the page.
                    showInternetConnectivityWarning();
                    failCount += 1;

                    //Lets ping server again
                    pollAgain();
                }

                function lockUser() {
                    $.ajax({
                        type: "POST",
                        url: baseURL + "/blocks/coursetimer/proctoring_ajax.php?action=lock&courseid=" + courseid,
                        success: function(response) {
                            location.reload();
                        }
                    });
                }

                function logMessage(action) {
                    $.ajax({
                        type: "POST",
                        url: baseURL + "/blocks/coursetimer/log_ajax.php?action=" + action + "&courseid=" + courseid,
                        success: function(response) {
                            //do stuff here				          		  		
                        }
                    });
                }

                //Desktop Notification Flow
                function askForApproval() {
                    if (Notification.permission === "granted") {
                        createNotification('Chat Message', 'New message from Proctor', $(' head > link:nth-child(2)').attr('href'));
                    } else {
                        Notification.requestPermission(permission => {
                            if (permission === 'granted') {
                                createNotification('Chat Message', 'New message from Proctor', $(' head > link:nth-child(2)').attr('href'));
                            }
                        });
                    }
                }

                function createNotification(title, text, icon) {
                    const noti = new Notification(title, {
                        body: text,
                        icon
                    });

                    noti.onclick = function(event) {
                        //     //event.preventDefault(); // prevent the browser from focusing the Notification's tab
                    }
                }

                //Check if webcam images and screenshot images are getting stored periodically
                var stopHandle = null;
                stopHandle = setInterval(function() {
                    var lastImageCaptureTime = parseInt(localStorage.getItem(storagePrefix + "lastImageCaptureTime"), 10);
                    var lastScreenshotTime = parseInt(localStorage.getItem(storagePrefix + "lastScreenshotTime"), 10);
                    var lockStatus = parseInt(localStorage.getItem(storagePrefix + "lockStatus"), 10);
                    var startTime = parseInt(localStorage.getItem(storagePrefix + "startTime"), 10);
                    var completed = parseInt(localStorage.getItem(storagePrefix + "completed"), 10);
                    // var currentTime = Math.round(new Date().getTime()/1000);
                    var currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10)

                    //lets do anything. But only if relevant values are set
                    if (completed != null && lockStatus != null && startTime != null &&
                        completed == 0 && lockStatus == 0 && currentTime > startTime) {
                        //Check webcamproctoring
                        if (webcamproctoring == 1) {
                            //Webcam based proctoring is mandated.
                            var imageCaptureTimeDifference = currentTime - lastImageCaptureTime;
                            if (imageCaptureTimeDifference > ((webcaminterval * 2) + 10)) {

                                //2 continuous image capturing failed. Let do the needful
                                if (webcamproctoringlock == 1) {
                                    //image capture fail lock is enabled. Lets lock the assessment
                                    lockUser();
                                } else {
                                    //image capture fail lock is disabled. Lets just keep track of this
                                    //logMessage('webcamoff');
                                }
                            }
                        }

                        //Check screenshare
                        if (forcescreensharing == 1) {
                            //screensharing is mandated.
                            var imageCaptureTimeDifference = currentTime - lastScreenshotTime;
                            if (imageCaptureTimeDifference > ((screenshotinterval * 2) + 10)) {
                                //2 continuous image capturing failed. Let do the needful
                                if (screenshotfaillock == 1) {
                                    //image capture fail lock is enabled. Lets lock the assessment
                                    lockUser();
                                } else {
                                    //image capture fail lock is disabled. Lets just keep track of this
                                    // logMessage('screenshareoff');
                                }
                            }
                        }
                    }
                }, 5000);
                ////////////  Poll server implementation methods end here ///////////////////////////

                //page execution starts here
                pollServer();

                //SEB - Hack to fix navigation for SEB
                if( $('body.gecko').length >=1 ){
                    $('html').css("overflow-y", "auto");
                    $('body').css("overflow-y", "auto");
                }
            }
        };
    });
define('block_coursetimer/extendtimer', ['jquery'], function($) {

	return {
		
		extendload: function(args) {
			
			$('document').ready(function(){
				
				CONFIG = args;
			    var title=CONFIG.title;
				var rootPath = M.cfg.wwwroot;
                var courseid=CONFIG.courseid;
				var usernotselectedalert=CONFIG.usernotselectedalert;
				var extendusertime=CONFIG.extendusertime;
				var extendbydate=CONFIG.extendbydate;
				var extendbyminutes=CONFIG.extendbyminutes;
				var datetimeerrormsg=CONFIG.datetimeerrormsg;
				var jsarray = new Array();
				var allUsers = 0;

				$("#extentend_user_buttonid").click(function(){

					 var selecteduserids=[];
					// change to default value
					allUsers = 0;
					noUsers = 0;
					
		            $.each($("input[name='extend-alluser']:checked"), function(){            
		            	allUsers = 1;
		            });
		            
		            if(allUsers === 0){
		            	$.each($("input[name='user_id']:checked"), function(){            
			            	selecteduserids.push($(this).val());
			            });
		            }
					
					
		            if(allUsers === 1){

		            }else{
		            	 if(typeof selecteduserids === "undefined" || selecteduserids.length === 0){
		            		 noUsers = 1;
		            	 }
		            }
				
				if(noUsers === 1){
           		 	alert(usernotselectedalert);
				}else{
					
					var encodeddata = JSON.stringify(selecteduserids);
					var encodeddata = JSON.parse(encodeddata);
					var selectedgroup = $('#selectedgroup').val();
					
					//action="'+rootPath+'/blocks/coursetimer/summary.php?id='+courseid+'"
					var modalHtml =
						' <div id="myModal-extendtime" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
						' <div class="modal-dialog" id="ct-et-modal-dialog">' +
						
						' <div class="modal-content" >' +
						' <div class="modal-header">'+
						' <h4 class="modal-title">'+extendusertime+
						' </h4><button type="button" class="close" data-dismiss="modal">&times;</button></div>'+				
						
						'<div class="modal-body">'+
			  			'<form id="extendTime" action="'+rootPath+'/blocks/coursetimer/summary.php?id='+courseid+'"  method="post" >'+
						'<input type="hidden" id="id" name="id" value="'+courseid+'">'+
						'<input type="hidden" id="useridstoextend" name="userids" value="'+encodeddata+'">'+
						'<input type="hidden" id="selectedgroupid" name="selectedgroupid" value="'+selectedgroup+'">'+
						
						'<input type="radio" onChange="typeOfInput(this)" name="type" value="ByDateTime" id="radioByDateTime" required="required"> '+extendbydate+'					&nbsp;&nbsp;'+
						'<input type="radio" onChange="typeOfInput(this)" name="type" value="ByMinutes" id="radioByMinutes" required="required"> '+extendbyminutes+' '+
						'<div id="timeInputs"></div>'+
						
						'<div id="usertype"></div>'+
						'<input type="button" value="submit" id="extendsubmitbutton">'+
						'</form></div>'+
						
						'<div class="modal-footer" id="errorMessage"></div>'+
						 '</div></div></div></div>';
					
					// insert HTML dynamically
					$("#page-header").append(modalHtml);
					// display
					$("#myModal-extendtime").modal('show');
					
					if(allUsers === 1){
							$("#timeInputs").append('<input type="hidden" id="all-users" name="users" value="All-Users">');
							$("#spec-users" ).remove();
					}else if(noUsers === 0){
							$("#all-users" ).remove();
							$("#timeInputs").append('<input type="hidden" id="spec-users" name="users" value="Spe-Users">');
					}
					
					
					$('#extendsubmitbutton').click(function (e) {

					     var currdate = $("#ByDate").val();
                         var currtime = $("#ByTime").val();
						 var currmins = $("#ByMins").val();
						 
						 var arg = {
									action: 'getcurrenttime',
									currdate: currdate,
									currtime: currtime,
									currmins: currmins,
									};
								
							$.ajax({
									url: rootPath+"/blocks/coursetimer/proctoring_ajax.php",
									type: "POST",
									data: arg,
									success: function(timeobj){
							
											document.getElementById("usertype").innerHTML="";
											$("#extendTime").submit();	
											
											},
											error: function(){
											document.getElementById("usertype").innerHTML="<span style='color: red;'>"+datetimeerrormsg+"</span>";						
											
											}
										});
					});
					
					

					   // var choosedoption;
					typeOfInput = function(item){
						 var choosedoption=item.value;
						if (choosedoption == "ByDateTime"){
							
							
							var hours = new Date().getHours();
							var ampm = (hours >= 12) ? "PM" : "AM";
							var currentdate = new Date(); 			   
										
							var defaultDate= + currentdate.getFullYear()+"-"
							                +("0" + (currentdate.getMonth() + 1)).slice(-2)  + "-"
							     			 +("0" + (currentdate.getDate())).slice(-2) ;							                 ; 	    

							var defaultTime= + currentdate.getHours() + ":"
                                             +("0" + (currentdate.getMinutes())).slice(-2);																    

								
									$("#timeInputs").append('<input type="date" name="Ext-date" id="ByDate" onChange="typeOfInputDate(this)" value="'+defaultDate+'" required="required">'+   
															 '<input type="time" name="Ext-time" id="ByTime" onChange="typeOfInputDate(this)" value="'+defaultTime+'" required="required" >');

							$("#ByMins" ).remove();
							document.getElementById("usertype").innerHTML="";
						}
						

						if (choosedoption == "ByMinutes"){
							
							$("#timeInputs").append('<input type="number" name="Ext-Mins" required="required" id="ByMins" min="0" >');
							$("#ByDate" ).remove();
							$("#ByTime" ).remove();
							document.getElementById("usertype").innerHTML="";
								
						}
						
						
					}
					
				//onchange event to remove error message
				typeOfInputDate = function(item){
				document.getElementById("usertype").innerHTML="";	
					
				}	

					
					
				}
					
				});
				
			});
			
		},
		
	};

});

define('block_coursetimer/chat_candidate', ['jquery', 'core/ajax'], function($, ajax) {
	return { 
		init: function(args) {

            //Frequency in milliseconds to poll for new messages
            var courseid = args.courseid;
            var userid = args.userid;
            var desktopNotification = args.desktopNotification;
            var chat_tone = args.chat_tone;

            var latest_desktopNotify = 0;
            var messagePollInterval = args.msgpollinterval;
            var active_chats = [];

            function displayChatBox(){ 
                i = 270 ; // start position
                j = 260;  //next position
                
                $.each( active_chats, function( index, value ) {  
                   if(index < 4){
                     $('[rel="'+value+'"]').css("right",i);
                     $('[rel="'+value+'"]').show();
                     i = i+j;			 
                   }
                   else{
                     $('[rel="'+value+'"]').hide();
                   }
                });		
            }

            function showLoadingIcon( selector ){
                var html = `<div class="d-flex loading-icon align-items-center justify-content-center mt-4">
                                <i class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>
                            </div>`;
                $(selector).append(html);
            }
    
            function hideLoadingIcon( selector ){
                selector += " .loading-icon"
                $(selector).remove();
            }

            function updateConversationsListUI( responses ){
                responses.forEach(function(response) {
                    if( parseInt( response.unreadcount ) > 0){
                        //This proctor has sent messages and is unread. Lets open chat window
                        openIndividualUserChat( userid, response.userid);
                    }
                });
            }

            function openIndividualUserChat( userid, proctorid=0, username="Proctor", highlighting=true ){
                //Check if chat window is already loaded
                if( $('.msg_box[rel="'+ proctorid + '"]').length > 0 ){
                    fetchMessagesAjax( courseid, userid, proctorid );
                    $('.msg_box[rel="' + proctorid + '"] .msg_wrap').removeClass('hidden').addClass('show');
                    if( highlighting ){
                        setTimeout(function(){ 
                            //Let make it fancy
                            $('.msg_box[rel="' + proctorid + '"] .msg_head').addClass('bg-success');
                        }, 500 );
                    }
                }else{
                    if ($.inArray(proctorid, active_chats) != -1){
                        active_chats.splice($.inArray(proctorid, active_chats), 1);
                    }
                    fetchMessagesAjax( courseid, userid, proctorid );

                    active_chats.unshift(proctorid);
                    chatPopup =  '<div class="msg_box" style="right:270px" chatid="0" rel="'+ proctorid+'">'+
                                    '<div class="msg_head">'+
                                    '<div class="name">'+ username +'</div>'+
                                    '<div class="close"><i class="fa fa-times" aria-hidden="true"></i></div>'+
                                    '<div class="minimize mt-1 mr-1 pl-1"><i class="fa fa-window-minimize" aria-hidden="true"></i></div> </div>'+
                                    '<div class="msg_wrap show"> <div class="msg_body"></div>'+
                                    '<div class="msg_footer"></div></div></div>' ;					
                                
                    $("body").append( chatPopup );
                    displayChatBox();
                    showLoadingIcon( '.msg_box[rel="' + proctorid + '"] .msg_body');
                    if( highlighting ){
                        $('.msg_box[rel="' + proctorid + '"] .msg_head').addClass('bg-success');
                    }
                    
                }
            }

            function updateChatWindow( response, userid ){
                //Lets first update the chatid in message window
                $( '.msg_box[rel="' +  userid + '"]' ).attr('chatid', response.chatid);
                
                //Lets update the messages in the chat window
                var messagesHtml = "";
                var notifyUser = true;

                response.messages.forEach(function(message) {
					
						var timestr=message.timecreated;
						var timearray=timestr.split(" ");
						var timetoappend=timearray[1]+' '+timearray[2];
                    if( message.senderid == userid ){
                        //Message was sent by candidate
                        messagesHtml += '<div messageid="'+ message.messageid + '" class="msg-left ';
                        //Lets add unread class if flag is set
                        if( message.markasread == 0 ){
                            notifyUser ? notifyChat( message.messageid ) : null ;
                            notifyUser = false;
                            messagesHtml += 'unread-msg';
                        }
                        messagesHtml += '"><li>'+ message.message +'</li><li id="floatright">'+timetoappend+'</li></div>';
                    }else{
                        messagesHtml += '<div messageid="'+ message.messageid +'" class="msg-right"><li>'+ message.message +'</li><li id="floatright">'+timetoappend+'</li></div>';
                    }
                });
                
                messagesHtml += '<div class="msg_push"></div>';
                $( '.msg_box[rel="' +  userid + '"] .msg_body' ).children().remove();
                $( '.msg_box[rel="' +  userid + '"] .msg_body' ).append( messagesHtml );
                
                //Its now safe to send new messages. lets add text area if its not available earlier
                if( $('.msg_box[rel="' + userid + '"] .msg_footer .msg_input').length == 0 ){
                    var html = `<textarea class="msg_input" rows="1"></textarea>`;
                    $('.msg_box[rel="' + userid + '"] .msg_footer').append(html);
                }

                //Lets scroll to bottom and show the latest message
                $('.msg_box[rel="'+ userid +'"] .msg_body').scrollTop( $('.msg_box[rel="'+ userid +'"] .msg_body')[0].scrollHeight );
            }

            function fetchMessagesAjax( courseid, userid, proctorid){
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_fetch_messages',
                    args: {'courseid': courseid, 'userid' : userid, 'proctorid' : proctorid }
                }, ]);
    
                promises[0].done(function(response) {
                    hideLoadingIcon( '.msg_box[rel="' + proctorid + '"]' );
                    updateChatWindow( response, proctorid );
                }).fail(function(ex) {
                    console.log(ex);
                });
            }

            function markMessagesAsReadAjax( messageid ){
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_markmessagesasread',
                    args: {'messageid': messageid }
                }, ]);
    
                promises[0].done(function(response) {
                    //Nothing to do here as of now
                }).fail(function(ex) {
                    console.log(ex);
                });
            }

            function sendMessageAjax( chatid, message ){
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_send_message',
                    args: {'chatid': chatid, 'message' : message, 'broadcast': false }
                }, ]);
    
                promises[0].done(function(response) {
                    //Nothing to do here as of now
                }).fail(function(ex) {
                    console.log(ex);
                });
            }
            
            function fetchConversationsAjax( ){
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_fetch_candidate_conversations',
                    args: {'courseid': courseid }
                }, ]);
    
                promises[0].done(function(response) {
                    updateConversationsListUI(response);
                    setTimeout(function(){ fetchConversationsAjax() }, messagePollInterval );
                }).fail(function(ex) {
                    console.log(ex);
                    setTimeout(function(){ fetchConversationsAjax() }, messagePollInterval );
                });
            }

            function markMessageAsRead( userid ){
                var unreadMessagesSelector =  $( '.msg_box[rel="' +  userid + '"] .msg_body .msg-left.unread-msg');

                //We have unread messages. Let fix it
                if( unreadMessagesSelector.length >= 1){
                    //lets request server to mark messages as read
                    var lastUnreadMessageId = unreadMessagesSelector.last().attr('messageid');
                    markMessagesAsReadAjax( lastUnreadMessageId );

                    //Now its time to do the same at client side
                    $('.msg_box[rel="' + userid + '"] .msg_head').removeClass('bg-success');
                    unreadMessagesSelector.removeClass('unread-msg');
                    $('#message-drawer-coursetimer .sidebar-user-box[userid="'+userid+'"] .badge-pill').remove();
                }
            }

            function notifyChat( messageID ){
                var tmp = "";
                var playPromise = null;
                var mediaElement = document.getElementById("chat_tone");
                
                if (chat_tone == 1) {
                    playPromise = mediaElement.play();

                    if (typeof playPromise !== 'undefined'){
                        playPromise.then(
                            function(result) {
                                mediaElement.play();
                            },
                            function(error) {
                                console.log(error);
                            }
                        );
                    }
                }

                // Desktop Notification enabled and its an incoming message
                if (desktopNotification == 1 && messageID != 0) {
                    tmp = "conv_" + messageID;
                    if (tmp != latest_desktopNotify) {
                        latest_desktopNotify = tmp;
                        askForApproval();
                    }
                }
            }

            //Desktop Notification Flow
            function askForApproval() {
                if (Notification.permission === "granted") {
                    createNotification('Chat Message', 'New message from Proctor', $(' head > link:nth-child(2)').attr('href'));
                } else {
                    Notification.requestPermission(permission => {
                        if (permission === 'granted') {
                            createNotification('Chat Message', 'New message from Proctor', $(' head > link:nth-child(2)').attr('href'));
                        }
                    });
                }
            }

            function createNotification(title, text, icon) {
                const noti = new Notification(title, {
                    body: text,
                    icon
                });
                noti.onclick = function(event) {

                }
            }

            //Triggered when user clicks on floating chat icon
            $('#ct_floating_chat').click(function(){
                var proctorID = $(this).attr('proctorid');
                openIndividualUserChat( userid, proctorID, "Proctor", false );
            });
            
            //Triggered when user clicks on enter to send message
            $(document).on('keypress', '.msg_box textarea.msg_input' , function(e) {       
                if (e.keyCode == 13 ) {
                    e.preventDefault();
                    var msg = $(this).val();
                    var chatid = $(this).parents().parents().parents().attr("chatid") ;
					
					date=new Date;
					var hours = date.getHours();
					var minutes = date.getMinutes();
					var ampm = hours >= 12 ? 'PM' : 'AM';
					hours = hours % 12;
					hours = hours ? hours : 12;
					minutes = minutes < 10 ? '0'+minutes : minutes;
					var strTime = hours + ':' + minutes + ' ' + ampm;
					
                    $(this).val('');

                    if(msg.trim().length != 0){
                        sendMessageAjax( chatid, msg );

                        var chatbox = $(this).parents().parents().parents().attr("rel") ;
                        var mesageBodySelector = $( '.msg_box[rel="'+ chatbox +'"] .msg_body' );
                        $('<div class="msg-right"> <li>'+msg+'</li><li id="floatright">'+strTime+'</li></div>').insertBefore('[rel="'+chatbox+'"] .msg_push');
                        $( mesageBodySelector ).scrollTop($( mesageBodySelector )[0].scrollHeight);
                    }
                }
            });

            //Triggered when user collapses / Opens chat window
            $(document).on('click', '.msg_box .msg_head', function(){
                var chatbox = $(this).parents().attr("rel") ;
                $('[rel="'+chatbox+'"] .msg_wrap').toggleClass("show hidden");
                return false;
            });

            //Triggered when user clicks close icon to close chat panel
            $(document).on('click', '.close', function() {
                var chatbox = $(this).parents().parents().attr("rel") ;
                markMessageAsRead( chatbox );
                $('[rel="'+chatbox+'"]').remove();
                active_chats.splice($.inArray(chatbox, active_chats), 1);
                displayChatBox();
                return false;
            });

            //Triggered when a textarea gets to focus
            $(document).on('focus', 'textarea', function() {
                var userid = $(this).parents().parents().parents().attr("rel");
                markMessageAsRead( userid );
            });

            fetchConversationsAjax();
        }
	};
});

define('block_coursetimer/summary', ["jquery"],function(e){return{init:function(t){var n=M.cfg.wwwroot,o=t.courseid;e("document").ready(function(){e.post(n+"/blocks/coursetimer/summary_ajax.php",{action:"started",courseid:o}).done(function(t){var n=JSON.parse(t);e("#ct_total").text(n.total),e("#ct_started").text(n.started),e("#ct_notstarted").text(n.notstarted),e("#ct_locked").text(n.locked),e("#ct_completed").text(n.completed)})});var a=e(location).attr("href"),r=[],i=[];e("document").ready(function(){var t,n=0;a.includes("/coursetimer/summary.php")&&e.ajax({method:"POST",url:M.cfg.wwwroot+"/blocks/coursetimer/summary_ajax.php",data:{action:"get_User_Details",courseid:o}}).done(function(a){data=e.parseJSON(a),e.each(data,function(e,t){r.push(t.name+"-"+t.id),i.push({id:t.id,name:t.name})}),function(a,r){var i;function s(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),i>=e.length&&(i=0),i<0&&(i=e.length-1),e[i].classList.add("autocomplete-active")}function u(e){for(var t=document.getElementsByClassName("autocomplete-items"),n=0;n<t.length;n++)e!=t[n]&&e!=a&&t[n].parentNode.removeChild(t[n])}a.addEventListener("input",function(s){var c,m,d,p=this.value;if(u(),!p)return!1;for(i=-1,(c=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),c.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(c),d=0;d<r.length;d++)(t=r[d].split("-"))[0].substr(0,p.length).toUpperCase()==p.toUpperCase()&&((m=document.createElement("DIV")).innerHTML="<strong>"+t[0].substr(0,p.length)+"</strong>",m.innerHTML+=t[0].substr(p.length),m.innerHTML+="<input type='hidden' value='"+t[0]+"'>",m.innerHTML+="<input id='userId' type='hidden' value='"+t[1]+"'>",m.addEventListener("click",function(t){a.value=this.getElementsByTagName("input")[0].value,n=this.getElementsByTagName("input")[1].value;var r=document.getElementById("searchName").value,i=M.cfg.wwwroot+"/blocks/coursetimer/summary.php?id="+o,s=e('<form action="'+i+'" method="post"><input type="text" name="userid" value="'+n+'" /><input type="text" name="username" value="'+r+'" /></form>');e("body").append(s),s.submit()}),c.appendChild(m))}),a.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(i++,s(t)):38==e.keyCode?(i--,s(t)):13==e.keyCode&&i>-1&&t&&t[i].click()}),document.addEventListener("click",function(e){u(e.target)})}(document.getElementById("searchName"),r)}),e("#searchName").keypress(function(t){if(13==t.keyCode){var a=e("#searchName").val();if(""!=a&&0!=n){console.log(n);var r=document.getElementById("searchName").value,s=M.cfg.wwwroot+"/blocks/coursetimer/summary.php?id="+o,u=e('<form action="'+s+'" method="post"><input type="text" name="userid" value="'+n+'" /><input type="text" name="username" value="'+r+'" /></form>');e("body").append(u),u.submit()}else if(""!=a&&0==n){for(var c=0;c<i.length;c++)if(i[c].name.toUpperCase()===a.toUpperCase()){n=i[c].id;break}if(0!=n){s=M.cfg.wwwroot+"/blocks/coursetimer/summary.php?id="+o,u=e('<form action="'+s+'" method="post"><input type="text" name="userid" value="'+n+'" /><input type="text" name="username" value="'+a+'" /></form>');e("body").append(u),u.submit()}else{s=M.cfg.wwwroot+"/blocks/coursetimer/summary.php?id="+o,u=e('<form action="'+s+'" method="post"><input type="text" name="userid" value="'+n+'" /><input type="text" name="username" value="'+a+'" /></form>');e("body").append(u),u.submit()}}else location.replace(M.cfg.wwwroot+"/blocks/coursetimer/summary.php?id="+o)}}),e("#user1").click(function(){e("#inone").remove(),location.replace(M.cfg.wwwroot+"/blocks/coursetimer/summary.php?id="+o)})})}}});
define('block_coursetimer/timer', ['jquery'], function($) {

	return {
		timer: function(args) {
			
			$( "i[title='Toggle messaging drawer']" ).css("display", "none");

			CONFIG = args;
			var countDownDate = CONFIG.countDownDate;
			var rootPath = M.cfg.wwwroot;
			var now = CONFIG.now;
			var courseid = CONFIG.courseid;
			var userid = CONFIG.userid;
			var proctoring = CONFIG.proctoring;
			var completedwarning_msg=CONFIG.completedwarning_msg;
			var submitassessment_btn=CONFIG.submitassessment_btn;
			var continueassessment_btn=CONFIG.continueassessment_btn;
			var timeIntervalCheck = 10 * 60;
			var distance = 0;
			var lastwarngmsg = CONFIG.lastwarngmsg;
			var firstwarngmsg = CONFIG.firstwarngmsg;
			var confirmmsg = CONFIG.confirmmsg;
			var assessmentcombtn = CONFIG.assessmentcombtn;
			var assessmenthome = CONFIG.assessmenthome;
			var url=  $(location).attr('href');
			var safebrowser = CONFIG.safebrowser;
			var chatstatus = CONFIG.chat;
			var disablelinks=CONFIG.disablelinks;
			
			//Lets remove unwanted links that can take users to external sites.
			$(".site-footer a" ).prop('href', '#');
			$(".site-footer a" ).prop('target', '_self');
    		$( "#toggleFullscreen" ).css('display','none');
    		$("a.nav-link:contains('Performance Dashboard')").css('display','none');
    		$("a.nav-link:contains('FAQ')").css('display','none');
			
			$('document').ready(function(){
				
				history.pushState(null, null, location.href);
				   window.onpopstate = function () {
				       history.go(1);
				   };
				
				   function goBack() {
					   window.history.back();
					 }
				   
				//handle user re visiting the same assessment link after clicking "Assessment completed" button 
				if(url.includes('enrol/index.php')){
					
					//remove course timer which could cause confusion to user
					$(".block_coursetimer").remove();
					
					//If Safe exam browser is used, provide a way of closing the browser
					if( safebrowser ){
						var modal =
							' <div id="seb_close" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
							' <div class="modal-dialog" >' +
							' <div class="modal-content">' +
							' <div class="coursetimer-text">'+
							' <div class="modal-headers">' +
							' <h4 class="modal-title">'+ CONFIG.alreadycompleted + '</h4> </div>' +
							' <div class="modal-body" ></div>'+
							' <div class="modal-footer">'+ 
							' <a type="button" href="https://lms.tekstac.com/closesafebrowser.php" class="btn btn-danger" aria-expanded="false">'+ CONFIG.closebrowser +'</a> </div>'+
							' </div></div>'+
							' </div></div>';

						// insert HTML dynamically
						$("#page-header").append(modal);
						setTimeout(function(){
							$("#seb_close").modal('show');
						},500);
					}
				}
				
				var currenttime=now;
				
				function closeTimeCheck(){
	  		  		
	  		  		$.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'endtimecheck',courseid:courseid })
      		  		.done(function( result ) {
      		  			var response = result;
      		  			if(response.update && countDownDate < response.closetime){
          		  			countDownDate = response.closetime;
          		  			currenttime = response.currenttime+1000;
      		  			}
      		  		});

				}

				if ( window.performance.getEntriesByType("navigation")[0] ){ 
					var navigationType = (window.performance.getEntriesByType("navigation")[0]).type;
					//back_forward value is duplicate tab
					if(navigationType == 'back_forward'){
						location.reload();
					}
				}
				
				var dateset ;

					$(window).focus(function() {
						var current_time_flag = new Date();
						var diff_time = current_time_flag.getTime()- dateset;
						dateset = current_time_flag.getTime();
						if(diff_time >= 60000)
						{
							var url = window.location.href;
							if (url.includes("mod/vpl/forms/edit.php")) {
								// VPL
								$('#vpl_ide_save')[0].click();
								setTimeout(function() {
									location.reload();
								}, 5000);
		
							} else if (url.includes("/mod/quiz/attempt.php")) {
								// QUIZ
								$('.submitbtns .mod_quiz-next-nav').click();
		
							} else if (url.includes("mod/assign/view.php") && url.includes("action=editsubmission")) {
								// ASSIGNMENT
								$('#id_submitbutton').click();

							} else {
								location.reload();
							}
							
						}
					});

					$(window).blur(function() {
						var d = new Date();
						dateset = d.getTime();
						
					});

				var x = setInterval(function() {
			
					currenttime=currenttime+1000;

					distance = countDownDate - currenttime;

					var days = Math.floor(distance / (1000 * 60 * 60 * 24))*24;
					var hour = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					var hours=days+hour;
					var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
					var seconds = Math.floor((distance % (1000 * 60)) / 1000);

					var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
					var lockStatus = parseInt(localStorage.getItem(storagePrefix + "lockStatus"), 10);

					if(url.includes('enrol/index.php')){
						$(".block_coursetimer").remove();
					}else{
						
					$('#clockdiv').css("display","block");

					}

					if (distance < 0 && lockStatus==0 ) {
						clearInterval(x);
						if (document.location.href.indexOf('enrol/index.php') === -1){ 
							var rootPath = M.cfg.wwwroot;
							var coursePath = rootPath+'/course/view.php?id='+courseid;
							location.replace(rootPath+"/blocks/coursetimer/iagree.php?id="+courseid+"&closed=1");
						}
					}else{
						if(url.includes('/mod/vpl/forms/edit.php')){
							if(distance == 60000){
								$('<div class="alert alert-danger alert-dismissible"> <button type="button" class="close" data-dismiss="alert">×</button>'+lastwarngmsg+'</div>').insertBefore( "#region-main " ); 
							}else if(distance == 300000){
							    $('<div class="alert alert-warning alert-dismissible"> <button type="button" class="close" data-dismiss="alert">×</button>'+firstwarngmsg+'</div>').insertBefore( "#region-main " ); 
							} 
						}
						$("#ct-hours").html(hours);
						$("#ct-minutes").html(minutes);
						$("#ct-seconds").html(seconds);     

						if(distance == 300000 || distance == 60000 || distance == 120000 || distance == 12000){
							closeTimeCheck();
						}
					}
				}, 1000);
				
				//Enable assessment completed button if proctoring enabled or safebrowser mandated
				if ( true || safebrowser ){
				
				//assesment completed modal
				
				var modalHtml =
					' <div class="modal fade" id="assesment-completed" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">'+
					' <div class="modal-dialog" id="assesment-modal-dialog">'+
					' <div class="modal-content">'+
					' <div class="coursetimer-text">'+
					' <div class="modal-headers">'+
					' <h4 class="modal-title" id="myModalLabeltwo" style="color: red;">'+confirmmsg+'</h4>'+
					' </div><div class="modal-body">'+completedwarning_msg+'</div></div>'+
					' <div class="modal-footer">'+
					'<button type="button" class="btn btn-info" id="submit-asses" aria-expanded="false">'+submitassessment_btn+'</button> '+
					'<button type="button" class="btn btn-info" id="continue-asses" aria-expanded="false">'+continueassessment_btn+'</button> '+
					'</div>'+
					' </div></div></div>';

				// insert HTML dynamically
				$("#page-header").append(modalHtml);
				
				
				//append continue button
				
				var buttonHtml ='<div id="ctm-completed" style="display:none;" ><button type="button" class="btn btn-success" id="asses-completed" aria-expanded="false">' +assessmentcombtn+'</button></div>';
				var assessmentHome ='<div id="assessment-home-div" style="display:none;" ><button type="button" class="btn btn-info" id="assessment-home-btn" aria-expanded="false">' +assessmenthome+'</button></div>';
				
				setTimeout(function (){
					$("#clockdiv").append(buttonHtml);
					$("#clockdiv").append(assessmentHome);
					
					if(url.includes('course/view.php')){
						$('#ctm-completed').css('display','block');
					}else{
						$('#assessment-home-div').css('display','block');
					}
					
					
				}, 500);
				
				
				$(document).on("click","#asses-completed",function() {
					
					
					$("#assesment-completed").modal('show');					
					/*
					 * 
					 * completed assesment button clicked
					 */				
					
					$.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'submissionclicked',courseid:courseid})
	  		  		.done(function( result ) {
	  		  		
	  		  		})
					
					
				});
				
				//Method to redirect user to home page
				$(document).on("click","#assessment-home-btn",function() {					
					//assessment home button clicked
					window.location.href = rootPath + '/course/view.php?id=' + courseid;
					
				});
				
				$(document).on("click","#submit-asses",function() {
					
					$.post(M.cfg.wwwroot + "/blocks/coursetimer/proctoring_ajax.php", {
							action: 'activateproctorconversation',
							courseid: courseid,
							userid:userid,
							deactivateonly:1
						}).done(function(result) {
							});	

					$.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'completed',courseid:courseid})
	  		  		.done(function( result ) {
						var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
						localStorage.setItem(storagePrefix + "completed", '1');
						
	  		  			//Safe browser used. Lets close the browser as the assessment is completed
	  		  			if ( safebrowser ){
	  		  				location.replace( "https://lms.tekstac.com/closesafebrowser.php" );
	  		  			}else{
	  		  				location.replace(rootPath+"/blocks/coursetimer/iagree.php?id="+courseid+"&submit=1");
	  		  			} 
	  		  		})
					
				});
				$(document).on("click","#continue-asses",function() {
					/*
					 * 
					 * cancelled completed assesment buton clicked
					 */
					 $.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'submissioncanceed',courseid:courseid})
	  		  		.done(function( result ) {
					 
					 })
					$("#assesment-completed").modal('hide');
				});
				
				if(chatstatus ==1){
					
					$( "i[title='Toggle messaging drawer']" ).css("display", "block");
				}
				
				if(disablelinks ==1){
					
				$("li.breadcrumb-item >a:contains('Dashboard')").attr('href','#');
				$("div.dropdown-menu-right >a:contains('Dashboard')").attr("href", "#");
				$("div.dropdown-menu-right >a:contains('Profile')").attr("href", "#");
				$("div.dropdown-menu-right >a:contains('Grades')").attr("href", "#");
				$("div.dropdown-menu-right >a:contains('Preferences')").attr("href", "#");
				$("div.dropdown-menu-right >a:contains('Log out')").attr("href", "#");
				$("div.branding-inner >.site-logo-wrapper >a").attr("href", "#");
				$("div.navbar-brand > a").attr("href", "#");
			
				$("li.usermenu > div.dropdown-menu").css('display','none');

				}	

				}

			});        	

		},
		Listview: function() {
			

			$('document').ready(function(){
				
				
				history.pushState(null, null, location.href);
				   window.onpopstate = function () {
				       history.go(1);
				   };
								
				   
				   function goBack() {
					   window.history.back();
					 }
				
				var container = document.getElementById("btnContainer");
				var btns = container.getElementsByClassName("btn");
				for (var i = 0; i < btns.length; i++) {
				  btns[i].addEventListener("click", function() {
				    var current = document.getElementsByClassName("active");
				    current[0].className = current[0].className.replace(" active", "");
				    this.className += " active";
				  });
				}
				
				

			$('#proctored-users').click(function() {
		       $('#proctored-list').css('display','block');
		       $('#completed-list').css('display','none');

	         });
			
			$('#completed-users').click(function() {
			
			$('#proctored-list').css('display','none');
			$('#completed-list').css('display','block');

	         }); 
			
			
			});
			
			
			
		}
		
	}

});
define('block_coursetimer/replaceproctor', ["jquery","core/ajax"],function(e,o){return{init:function(){function r(e){for(var o=window.location.search.substring(1).split("&"),r=0;r<o.length;r++){var t=o[r].split("=");if(t[0]==e)return t[1]}}e(document).ready(function(){e("#currentproctor").change(function(){document.getElementById("currentproctor").style.borderColor="inherit",document.getElementById("newproctor1").style.borderColor="inherit",e("#message1").html(""),e("#message2").html("");var t=e(this).val(),n=r("courseid");o.call([{methodname:"block_coursetimer_fetch_proctor_group",args:{courseid:n,email:t}}])[0].done(function(o){e("#hidden").show(),window.value=o.success,document.getElementById("newproctor1").value=o.success}).fail(function(e){console.log(e)})}),e("#frmbtn").click(function(){var t=document.getElementById("userenrolltable"),n=e("#newproctor").val(),c=document.getElementById("newproctor1").value,l=0,s=0;for(""===document.getElementById("currentproctor").value&&(document.getElementById("currentproctor").style.borderColor="red",e("#message1").html("Field is required").css("color","red")),""===document.getElementById("newproctor1").value&&(document.getElementById("newproctor1").style.borderColor="red",e("#message2").html("Field is required").css("color","red")),a=1;a<t.rows.length;a++)for(var d=t.rows.item(a).cells,i=0;i<1;i++)if(d.item(i).innerHTML==n&&"Candidate"==d.item(1).innerHTML){l=1;break}if(1!=l)if(e("#currentproctor").val()!=e("#newproctor").val()){for(var m=window.value.split(","),u=c.split(","),a=0;a<m.length;a++)for(i=0;i<u.length;i++)if(m[a]==u[i])s=1;if(1==s)document.getElementById("newproctor1").style.borderColor="inherit",e("#message2").html(""),o.call([{methodname:"block_coursetimer_validate_new_proctor",args:{email:n}}])[0].done(function(t){if(1==t.success){var n=e("#currentproctor").val(),c=document.getElementById("newproctor1").value,l=document.getElementById("newproctor").value,s=r("courseid");o.call([{methodname:"block_coursetimer_proctor_update",args:{courseid:s,current_proctor:n,proct_grp:c,new_proctor:l}}])[0].done(function(e){window.location.href=M.cfg.wwwroot+"/blocks/coursetimer/admin/enrolled_details.php?courseid="+s}).fail(function(e){window.location.href=M.cfg.wwwroot+"/blocks/coursetimer/admin/enrolled_details.php?courseid="+s,console.log(e)})}else 0==t.success?(document.getElementById("newproctor").style.borderColor="red",e("#message").html("User not found").css("color","red")):""==t.success&&(document.getElementById("newproctor").style.borderColor="red",e("#message").html("User not found").css("color","red"))}).fail(function(e){console.log(e)});else document.getElementById("newproctor1").style.borderColor="red",e("#message2").html("Current proctor dosenot belongs to this group").css("color","red")}else document.getElementById("newproctor").style.borderColor="red",e("#message").html("Enter the new proctor").css("color","red");else document.getElementById("newproctor").style.borderColor="red",e("#message").html("Candidate belongs to the same course cannot be a proctor").css("color","red")})})}}});
define('block_coursetimer/chat_proctor', ['jquery', 'core/ajax'], function($, ajax) {
    return {
        init: function(args) {
            var courseid = args.courseid;

            //currently logged in user
            var proctorid = args.userid;

            //Frequency in milliseconds to poll for new messages
            var messagePollInterval = 5000;

            //chat templates
            var chattemplates = args.chattemplates;

            var active_chats = [];

            function displayChatBox() {
                i = 270; // start position
                j = 260; //next position

                $.each(active_chats, function(index, value) {
                    if (index < 4) {
                        $('[rel="' + value + '"]').css("right", i);
                        $('[rel="' + value + '"]').show();
                        i = i + j;
                    } else {
                        $('[rel="' + value + '"]').hide();
                    }
                });
            }

            function showLoadingIcon(selector) {
                var html = `<div class="d-flex loading-icon align-items-center justify-content-center mt-4">
                                <i class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>
                            </div>`;
                $(selector).append(html);
            }

            function hideLoadingIcon(selector) {
                selector += " .loading-icon"
                $(selector).remove();
            }

            function adjustChatIconAlignment() {
                if ($('#message-drawer-coursetimer.show').length == 1) {
                    $('#ct_floating_chat').css("right", "20%");
					$('#broadcast').css("right", "20%");
                } else {
                    $('#ct_floating_chat').css("right", "3%");
					$('#broadcast').css("right", "3%");
                }
            }

            function updateConversationsListUI(responseArray) {
                var html = "";
                var unreadUsers = 0;
                var chatNotificationSelector = $('#ct_floating_chat .count-container-customized');

                responseArray.forEach(function(response) {
                    html += `<div class="sidebar-user-box" userid="` + response.userid + `"  courseid="` + response.courseid + `"> 
                                <img src="` + M.cfg.wwwroot + `/blocks/coursetimer/pix/default.jpg" />
                                <span class="sidebar-username">` + response.name + `</span>`;
                    if (parseInt(response.unreadcount) > 0) {

                        //If chat panel is open and has unread messages. Lets load them
                        if ($('.msg_box[rel="' + response.userid + '"]').length > 0) {
                            fetchMessagesAjax(response.courseid, response.userid, proctorid);
                            setTimeout(function() {
                                //Let make it fancy
                                $('.msg_box[rel="' + response.userid + '"] .msg_head').addClass('bg-success');
                            }, 1000);
                        }
                        unreadUsers++;
                        html += `<span class="badge badge-pill badge-danger ml-3 mt-2 mr-2">` + response.unreadcount + `</span>`
                    }
                    html += `<span></span></div>`;
                });
                $('#message-drawer-coursetimer div').remove();
                $("#message-drawer-coursetimer").append(html);

                //Lets intimate proctor that there are unred chat messages using floating icon
                if (unreadUsers >= 1) {
                    chatNotificationSelector.text(unreadUsers);
                    chatNotificationSelector.removeClass('hidden');
                } else {
                    chatNotificationSelector.addClass('hidden');
                }
            }

            function fetchConversationsAjax() {
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_fetch_conversations',
                    args: { 'courseid': courseid, 'proctorid': proctorid }
                }, ]);

                promises[0].done(function(response) {
                    updateConversationsListUI(response);
                    setTimeout(function() { fetchConversationsAjax() }, messagePollInterval);
                }).fail(function(ex) {
                    console.log(ex);
                    setTimeout(function() { fetchConversationsAjax() }, messagePollInterval);
                });
            }

            function openIndividualUserChat(userID, username, courseid) {
                //Check if chat window is already loaded
                if ($('.msg_box[rel="' + userID + '"]').length > 0) {
                    $('.msg_box[rel="' + userID + '"] .msg_wrap').removeClass('hidden').addClass('show');
                } else {
                    if ($.inArray(userID, active_chats) != -1) {
                        active_chats.splice($.inArray(userID, active_chats), 1);
                    }
                    fetchMessagesAjax(courseid, userID, proctorid);

                    active_chats.unshift(userID);
                    chatPopup = '<div class="msg_box" style="right:270px" chatid="0" rel="' + userID + '" id="userid_' + userID + '">' +
                        '<div class="msg_head">' +
                        '<div class="name" id="' + userID + '">' + username + '</div>' +
                        '<div class="close"><i class="fa fa-times" aria-hidden="true"></i></div>' +
                        '<div class="minimize mt-1 mr-1 pl-1"><i class="fa fa-window-minimize" aria-hidden="true"></i></div> </div>' +
                        '<div class="msg_wrap show"> <div class="msg_body"></div>' +
                        '<div class="msg_footer"></div></div></div>';

                    $("body").append(chatPopup);

                    displayChatBox();
                    showLoadingIcon('.msg_box[rel="' + userID + '"] .msg_body');
                }
            }


            function updateChatWindow(response, userid) {
                //Lets first update the chatid in message window
                $('.msg_box[rel="' + userid + '"]').attr('chatid', response.chatid);

                //Lets update the messages in the chat window
                var messagesHtml = "";
                response.messages.forEach(function(message) {

                    var timestr = message.timecreated;
                    var timearray = timestr.split(" ");
                    var timetoappend = timearray[1] + ' ' + timearray[2];
                    if (message.senderid == userid) {
                        //Message was sent by candidate
                        messagesHtml += '<div messageid="' + message.messageid + '" class="msg-left ';
                        //Lets add unread class if flag is set
                        if (parseInt(message.markasread) == 0) {
                            messagesHtml += 'unread-msg';
                        }
                        messagesHtml += '"><li>' + message.message + '</li><li id="floatright">' + timetoappend + '</li></div>';
                    } else {
                        messagesHtml += '<div messageid="' + message.messageid + '" class="msg-right"><li>' + message.message + '</li><li id="floatright">' + timetoappend + '</li></div>';
                    }
                });


                //Add templates
                $templatetext = '';
                $templateicon = '';

                if (chattemplates) {
                    $templatetext = '<div class="container" id="templatecontainer" style="padding:4px;height:160px;display: none;overflow: auto;border: 1px solid;">' +
                        '<ul class="nav nav-pills nav-stacked" style="display: block;">';
                    $i = 1;
                    chattemplates.forEach(function(message) {

                        $templatetext += '<li id="temp' + $i + '" class="tempclas" rel="' + userid + '"> <a href="#"  class="temptext" >' + message + '</a></li><hr/>';
                        $i = $i + 1;
                    });
                    $templatetext += '</ul></div>';
                    $templateicon = '<span class="text-icon"><i class="fa fa-ellipsis-v fa-lg" id="displaytemplate" rel="' + userid + '"></i></span>';
                }

                messagesHtml += '<div class="msg_push">' + $templatetext + '</div>';
                $('.msg_box[rel="' + userid + '"] .msg_body').children().remove();
                $('.msg_box[rel="' + userid + '"] .msg_body').append(messagesHtml);


                //Its now safe to send new messages. lets add text area if its not available earlier
                if ($('.msg_box[rel="' + userid + '"] .msg_footer .msg_input').length == 0) {
                    var html = '<textarea class="msg_input" rows="1"></textarea>' + $templateicon;
                    $('.msg_box[rel="' + userid + '"] .msg_footer').append(html);
                }

                //Lets scroll to bottom and show the latest message
                $('.msg_box[rel="' + userid + '"] .msg_body').scrollTop($('.msg_box[rel="' + userid + '"] .msg_body')[0].scrollHeight);
            }

            function fetchMessagesAjax(courseid, userid, proctorid) {
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_fetch_messages',
                    args: { 'courseid': courseid, 'userid': userid, 'proctorid': proctorid }
                }, ]);

                promises[0].done(function(response) {
                    hideLoadingIcon('.msg_box[rel="' + userid + '"]');
                    updateChatWindow(response, userid);
                }).fail(function(ex) {
                    console.log(ex);
                });
            }

            function sendMessageAjax(chatid, message, chatbox, broadcast = false) {
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_send_message',
                    args: { 'chatid': chatid, 'message': message, 'broadcast': broadcast }
                }, ]);

                promises[0].done(function(response) {

                    if (response.messageid < 1) {

                        $errortoappend = "<div class='alert alert-primary' style='background:none;border:none;color:red;padding:0px;'><span><i class='fa fa-exclamation-circle' aria-hidden='true' style='font-size: 18px;'></i></span> Since the attempt has completed You can't send message</div>";
                        $("#userid_" + chatbox + " .msg_body").append($errortoappend);
                        $("#userid_" + chatbox + " .msg_input").remove();
                        var mesageBodySelector = $('.msg_box[rel="' + chatbox + '"] .msg_body');
                        $(mesageBodySelector).scrollTop($(mesageBodySelector)[0].scrollHeight);
                    } else {

                    }
                    //Nothing to do here as of now
                }).fail(function(ex) {
                    console.log(ex);
                });
            }

            function markMessagesAsReadAjax(messageid) {
                var promises = ajax.call([{
                    methodname: 'block_coursetimer_markmessagesasread',
                    args: { 'messageid': messageid }
                }, ]);

                promises[0].done(function(response) {
                    //Nothing to do here as of now
                }).fail(function(ex) {
                    console.log(ex);
                });
            }

            function markMessageAsRead(userid) {
                var unreadMessagesSelector = $('.msg_box[rel="' + userid + '"] .msg_body .msg-left.unread-msg');

                //Remove green background of chat head
                $('.msg_box[rel="' + userid + '"] .msg_head').removeClass('bg-success');

                //We have unread messages. Let fix it
                if (unreadMessagesSelector.length >= 1) {
                    //lets request server to mark messages as read
                    var lastUnreadMessageId = unreadMessagesSelector.last().attr('messageid');
                    markMessagesAsReadAjax(lastUnreadMessageId);

                    //Now its time to do the same at client side
                    unreadMessagesSelector.removeClass('unread-msg');
                    $('#message-drawer-coursetimer .sidebar-user-box[userid="' + userid + '"] .badge-pill').remove();
                }
            }

            //Triggered when user clicks on floating chat icon
            $('#ct_floating_chat').click(function() {
                $("#message-drawer-coursetimer").toggleClass("hidden show");
				$(".ChatPanel").css("display", "none");
                adjustChatIconAlignment();
            });

            //Triggered when proctor clicks on a user from message drawer
            $(document).on('click', '.sidebar-user-box', function() {
                var userID = $(this).attr("userid");
                var courseid = $(this).attr("courseid");
                var username = $('.sidebar-user-box[userid="' + userID + '"] .sidebar-username').text();
                openIndividualUserChat(userID, username, courseid);
            });

            //Triggered when individual user's chat icon is clicked
            $(document).on('click', '#chat_link', function() {
                var userID = $('#livefeed_username').attr('userid');
                var courseid = $('#livefeed_username').attr('courseid');
                var username = $('#livefeed_username').text().trim();
                openIndividualUserChat(userID, username, courseid);
            });

            //Triggered when user clicks on enter to send message
            $(document).on('keypress', '.msg_box textarea.msg_input', function(e) {
                if (e.keyCode == 13) {
                    e.preventDefault();
                    var msg = $(this).val();
                    var chatid = $(this).parents().parents().parents().attr("chatid");

                    date = new Date;
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    var ampm = hours >= 12 ? 'PM' : 'AM';
                    hours = hours % 12;
                    hours = hours ? hours : 12;
                    minutes = minutes < 10 ? '0' + minutes : minutes;
                    var strTime = hours + ':' + minutes + ' ' + ampm;

                    $(this).val('');
                    if (msg.trim().length != 0) {

                        var chatbox = $(this).parents().parents().parents().attr("rel");
                        sendMessageAjax(chatid, msg, chatbox);
                        var mesageBodySelector = $('.msg_box[rel="' + chatbox + '"] .msg_body');
                        $('<div class="msg-right"><li>' + msg + '</li><li id="floatright">' + strTime + '</li></div>').insertBefore('[rel="' + chatbox + '"] .msg_push');
                        $(mesageBodySelector).scrollTop($(mesageBodySelector)[0].scrollHeight);
                    }
                }
            });

            //Triggered when user collapses / Opens chat window
            $(document).on('click', '.msg_box .msg_head', function() {
                var chatbox = $(this).parents().attr("rel");
                $('[rel="' + chatbox + '"] .msg_wrap').toggleClass("show hidden");
                return false;
            });

            //Triggered when user clicks close icon to close chat panel
            $(document).on('click', '.close', function() {
                var chatbox = $(this).parents().parents().attr("rel");
                if (chatbox) {
                    markMessageAsRead(chatbox);
                    $('[rel="' + chatbox + '"]').remove();
                    active_chats.splice($.inArray(chatbox, active_chats), 1);
                    displayChatBox();
                    return false;
                }
            });


            //Triggered when a textarea gets to focus
            $(document).on('focus', 'textarea', function() {
                var userid = $(this).parents().parents().parents().attr("rel");
                markMessageAsRead(userid);
            });


            $(document).on('click', '#displaytemplate', function() {
                $usrid = $(this).attr("rel");
                $("#userid_" + $usrid + " #templatecontainer").slideToggle("slow");
                $('.msg_box[rel="' + $usrid + '"] .msg_body').animate({ scrollTop: $(document).height() }, 'slow');
            });

            $(document).on('click', '.tempclas', function() {
                $userid = $(this).attr("rel");
                $id = $(this).attr("id");
                //$("#"+$id+" .temptext").text();
                $textvalue = $("#userid_" + $userid + " #" + $id + " a.temptext").text();

                $("#userid_" + $userid + " .msg_input").val($textvalue);

                var e = $.Event("keypress");
                e.keyCode = 13; // # Some key code value
                $("#userid_" + $userid + " .msg_input").trigger(e);

                $("#userid_" + $userid + " #templatecontainer").slideToggle("slow");

            });

            $(document).on('click', '.msg_input', function() {
                var chatbox = $(this).parents().parents().parents().attr("rel");

                $templatestatus = $("#userid_" + chatbox + " #templatecontainer").css('display') === 'none';

                if ($templatestatus) {

                } else {
                    $("#userid_" + chatbox + " #templatecontainer").slideToggle("slow");
                }

            });

			$(document).on('click', '#broadcast_message', function() {
                var msg = $('#broadcast_message_body').val();
				if (msg){
					$(".ChatPanel").css("display", "none");
					$('#broadcast_message_body').val('');
					$('#emptymsg_warning').text('');
					var promises = ajax.call([{
	                    methodname: 'block_coursetimer_broadcast_message',
                    	args: { 'proctorid': proctorid }
	                }, ]);
	
	                promises[0].done(function(response) {
						response.forEach(function(broadcast) {
		                    var chatid = broadcast.chatid;
							var chatbox = broadcast.userid;	
							
							date = new Date;
		                    var hours = date.getHours();
		                    var minutes = date.getMinutes();
		                    var ampm = hours >= 12 ? 'PM' : 'AM';
		                    hours = hours % 12;
		                    hours = hours ? hours : 12;
		                    minutes = minutes < 10 ? '0' + minutes : minutes;
		                    var strTime = hours + ':' + minutes + ' ' + ampm;
							
		                    if (msg.trim().length != 0) {		                        
		                        sendMessageAjax(chatid, msg, chatbox, true);
		                        $('.msg_box[rel="' + chatbox + '"] .msg_body');
		                        $('<div class="msg-right"><li>' + msg + '</li><li id="floatright">' + strTime + '</li></div>').insertBefore('[rel="' + chatbox + '"] .msg_push');
																
		                    }				
						});	                    
	                    //Nothing to do here as of now
	                }).fail(function(ex) {
	                    console.log(ex);
	                });					
				}
				else {
					$('#emptymsg_warning').text('Please type broadcast message.');
				}
            });

            fetchConversationsAjax();
        }
    };
});
define('block_coursetimer/modalscript', ['jquery', 'core/ajax'], function($, ajax) {

	return {
		init: function(args) {

			CONFIG = args;
			
			var title=CONFIG.title;
			var body=CONFIG.body;
			var button=CONFIG.button;
			var nextattemptbtn = CONFIG.nextattemptbtn;
			var nextattemptavailable = CONFIG.nextattemptavailable;
			var instruction = CONFIG.instruction;
			var rootPath = M.cfg.wwwroot;
			var currenttime = CONFIG.currenttime;
			var coursestarttime = CONFIG.starttime;
			var courseid = CONFIG.courseid;
			var startassessment=CONFIG.startassessment;
			var startassessmentmsg=CONFIG.startassessmentmsg;
			var ct_days=CONFIG.ct_days;
			var ct_hrs=CONFIG.ct_hrs;
			var ct_min=CONFIG.ct_min;
			var ct_sec=CONFIG.ct_sec;
			var clickhere=CONFIG.clickhere;
			var sysreqir_check=CONFIG.sysreqir_check;
			var safebrowser = CONFIG.safebrowser;
			var closebrowser = CONFIG.closebrowser;
			var url=  $(location).attr('href');
			var courseurl = rootPath+"/course/view.php?id="+courseid;
			var backbtnlink = CONFIG.backbtnlink;
			
			$('document').ready(function(){
				
				
//				if( !url.includes('/coursetimer/iagree.php')){
//					location.replace(rootPath+"/blocks/coursetimer/iagree.php?id="+courseid);
//				}
				
				history.pushState(null, null, location.href);
				   window.onpopstate = function () {
				       history.go(1);
				   };
				   
				   function goBack() {
					   window.history.back();
					 }
				
				setTimeout(function(){

					var modalHtml =
						' <div id="myModal-coursetimer" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
						' <div class="modal-dialog" id="ct-modal-dialog">' +
						' <div class="modal-content" >' +
						' <div class="modal-headers">' +
						' <h4 class="modal-title coursetimer-text" id="myModalLabelone" style="color: red;">'+title+'</h4> </div>' +
						' <div class="modal-body coursetimer-text" style="border-style: solid; margin: auto;" > <p id ="myModalLabelonebody">  '+body+'</p>'+
						' <div>' ; 
						
						// link for trail check
						modalHtml += '<div><strong><a href="'+rootPath+'/blocks/coursetimer/trial.php">'+clickhere+'</a></strong>'+sysreqir_check+'</div>';
						
						//If safeBrowser is mandated, provide provision for User to close browser instead of rerouting to dashboard
						if ( safebrowser ){
							modalHtml += '<a href="https://lms.tekstac.com/closesafebrowser.php" type="button" class="btn btn btn-info" id="seb_closebrowser" aria-expanded="false">'+closebrowser+'</a>';
						}else{
							modalHtml += ' <button type="button" class="btn btn-info" id="back_to_dash" aria-expanded="false">' + 
							' <a href="'+backbtnlink+'">'+button+'</a></button>';
							/* if(nextattemptavailable){
								modalHtml += ' <button type="button" class="btn btn-info" id="new_attempt" aria-expanded="false">' + 
								nextattemptbtn+'</button>';
							}*/
						}
						
						/* modalHtml += '<button type="button" class="btn btn-info" style="display:none" id="startassessment" aria-expanded="false">'+ 
						' <a href="'+courseurl+'">' + startassessment + '</a></button></div></div>'+
						' <div id ="ct_instruction" style="overflow:auto; width:84%; height:400px; margin:auto; display:none; ">'+instruction+' </div>'+
						' <div class="modal-footer">' +
						' </div>';*/
						
						modalHtml += '</div></div></div></div></div>';

					// insert HTML dynamically
					$("#page-header").append(modalHtml);
					
					// display
					$("#myModal-coursetimer").modal('show');

				 }, 1000);
			});
			
			
			$('document').ready(function(){
				
				// starting time for the course
				var countDownDate = coursestarttime; 

				// Update the count down every 1 second
				var x = setInterval(function() {
					if(instruction != undefined  && instruction.length  ){
						$('#ct_instruction').css('display','');
					}
					
					currenttime = currenttime + 1000;
					
				  // Find the distance between now and the count down date
				  var distance = countDownDate - currenttime;

				  // Time calculations for days, hours, minutes and seconds
				  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
				  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
				  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

				  // Display the result in the element
				  if(days > 0){
					  document.getElementById("countdowntimer").innerHTML = days + ct_days + hours + ct_hrs
					  + minutes + ct_min + seconds + ct_sec;
				  }else if(seconds > 0){
					 
					  document.getElementById("countdowntimer").innerHTML =  hours + ct_hrs
					  + minutes + ct_min + seconds + ct_sec;
				  }

				  // If the count down is finished, write some text 
				  if (distance < 0) {
				    clearInterval(x);
/*				    $('#myModalLabelone').html(startassessmentmsg);
				    $('#myModalLabelone').addClass('blink_me');
				    $('#myModalLabelonebody').html('');
				    
				    $('#back_to_dash').css('display','none');
				    $('#startassessment').css('display','');*/
           		  	location.replace(courseurl); 
				    
				  }
				}, 1000);
				
			});
			

		},
		initpassword: function(args) {

			CONFIG = args;
			var title= CONFIG.title;
			var body=  CONFIG.body;
			var button= CONFIG.button;
			var rootPath = M.cfg.wwwroot;
			var courseid = CONFIG.courseid;
			var submitbtn= CONFIG.submitbtn;
			var passwderror= CONFIG.passwderror;

			$('document').ready(function(){

				history.pushState(null, null, location.href);
				   window.onpopstate = function () {
				       history.go(1);
				   };
				
				setTimeout(function(){

					var modalHtml =
						' <div id="myModal-Password" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
						' <div class="modal-dialog" align="center" id="ct-modal-password">' +
						' <div class="modal-content">' +
						' <div class="coursetimer-text">'+
						' <div class="modal-headers">' +
						' <h4 class="modal-title" id="myModalPassword" style="color: red;">'+title+'</h4> </div>' +
						' <div class="modal-body" id="myModalPasswordBody">' +body+'</div>'+
						' <div><button type="button" class="btn btn-info" id="submitPassword" aria-expanded="false">'+submitbtn+' </button> '+
						' </div><div class="modal-footer"></div>'+
						' </div></div>'+
						' </div></div>';

					// insert HTML dynamically
					$("#page-header").append(modalHtml);
					// display
					$("#myModal-Password").modal('show');
					
					var input = document.getElementById("myInput");
					
					input.addEventListener("keyup", function(event) {
					  if (event.keyCode === 13) {
					   event.preventDefault();
					   document.getElementById("submitPassword").click();
					  }
					});
					
				 }, 1000);
				
			});
			
			
			$('document').ready(function(){
				
				$(document).on("click","#showPassword",function() {
					var x = document.getElementById("myInput");
					if (x.type === "password") {
						x.type = "text";
					} else {
						x.type = "password";
					}		
				});
				
				$(document).on("click","#submitPassword",function() {
					
					var password = $('#myInput').val();
					
					//Make an ajax and validate the passoword
					 $.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'validate',courseid:courseid,password:password})
       		  		.done(function( result ) {
       		  			if(result === "true"){
               		  		var redirecturl=rootPath+"/course/view.php?id="+courseid;
                   		  	location.replace(redirecturl); 
       		  			}else{
       		  				var incorrect = body+"<br> <span style='color:red'> "+ passwderror +"</span>";
       		  				$('#myModalPasswordBody').html(incorrect);
       		  				
       		  			var input = document.getElementById("myInput");
    					
    					input.addEventListener("keyup", function(event) {
    					  if (event.keyCode === 13) {
    					   event.preventDefault();
    					   document.getElementById("submitPassword").click();
    					  }
    					});
       		  				
       		  			}
       		  		})
				});

				
				
			});

		},
		initone: function(args) {

			CONFIG = args;
//			var title=CONFIG.title;
			var body=CONFIG.body;
			var rootPath = M.cfg.wwwroot;			
			var courseid=CONFIG.courseid;
			var ctproctoring = CONFIG.ctproctoring;
			var webcamproctoring = CONFIG.webcamproctoring;
			var browserzoommsg = CONFIG.browserzoommsg;
			var browserresetmsgone = CONFIG.browserresetmsgone;
			var browserresetmsgtwo = CONFIG.browserresetmsgtwo;
			var submitted = CONFIG.submitted;
			var backbtnlink = CONFIG.backbtnlink;
			var completed = CONFIG.completed;

			$('document').ready(function(){
				
				history.pushState(null, null, location.href);
				   window.onpopstate = function () {
				       history.go(1);
				   };
				
				   function goBack() {
					   window.history.back();
					 }
				   
				setTimeout(function(){
					
					$('#clockdiv').css('display','none');
					
					if(webcamproctoring == 1){
						$('#iagree_footer').css('display','none');
					}
					
			 }, 1000);
			});



			$('document').ready(function(){

				if(submitted == 1){	
		   		  	$('#userattemptsummary').empty();
	            	$('#userattemptsummary').html('<img src="pix/loading.gif" style="display: block; margin-left: auto; margin-right: auto; width: 50%;"/>');
	            	$.post( rootPath+"/blocks/coursetimer/getresult.php", { action: 'evaluate_flow',courseid:courseid})
	            	.done(function( result ) {
	            		$('#userattemptsummary').empty();
	                	$('#userattemptsummary').html(result);
	                });

				}
				
				$(document).on("click","#back_to_dashboard",function() {
					if(backbtnlink != ''){
						location.replace(backbtnlink);
					}else{
						location.replace(rootPath);
					}
					
//					goBack();
				});
				
				$(document).on("click","#continue_timer",function() {
					location.replace(rootPath+'/course/view.php?id='+courseid+'&coursetimer=1&iagree=1');
				});
				
				
				$(document).on("click","#new_attempt",function() {
					
					$.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'newattempt',courseid:courseid})
   		  		.done(function( result ) {
   		  		var outcome = JSON.parse(result);
   		  			if(outcome){
           		  		var redirecturl=rootPath+"/course/view.php?id="+courseid;
               		  	location.replace(redirecturl); 
   		  			}else{
   		  				$('#new_attempt').css('display','none');
   		  				$('#myModalLabelonebody').html("<strong style='color:red'> Assessment Limit Reached </strong>");
   		  				
   		  			}
   		  		})
					  
					  
				});
				
				//Webcam Logic starts here
				/*************** WEB CAM DAA *****************/
				if(webcamproctoring == 1 && completed == 0){

					var constraints='';
					var mediaPrefix = 'coursetimer_' + 'deviceID' + "_";

	                // var audiodevice = localStorage.getItem(mediaPrefix + "audio");
	                var videodevice = localStorage.getItem(mediaPrefix + "video");
	                if(videodevice){
	                    constraints = {
	                        video: {deviceId: videodevice ? {exact: videodevice} : undefined}
	                    };
	                } else{
	                    constraints = { video: true };
	                }

					$('#webcam_proctoring').css("display","");
					$('#webcamsnap').css("display","");
					checkwebcam();
					
					function checkwebcam(){
						var video = document.getElementById('my_camera');
			        	navigator.mediaDevices.getUserMedia(constraints)
						//we are good to go
						.then(function(stream) {
							$('#webcam_warning').css('display','none');
							$('#webcam_proctoring').css('display','');
							video.srcObject = stream;
//							location.reload();
						})
						//something wrong. Permission denied or no web cam or some similar problem
						.catch(function(error) {
							//lock the user
							$('#webcam_warning').css('display','');
							$('#webcam_proctoring').css('display','none');
//							location.reload();
							
						});
			        	
			        	setTimeout(checkwebcam, 1000);
					}
					
					
					function SaveProctoringImage(){
						 var base64image = '';
						 Webcam.snap( function(data_uri) { //document.getElementById('imageprev').innerHTML = '<img src="'+data_uri+'"/>';
								   	 base64image = data_uri;
								   });
						
						  $.ajax({
							   url: rootPath+"/blocks/coursetimer/upload.php",
							   type: "POST",
							   data: { data: base64image,courseid : courseid, reference : true},
							   async: true,
							  success: function (response) {
								  $('#iagree_footer').css('display','');
							  }
						  });
					}
					
					$(document).on("click","#webcamsnap",function() {
						console.log("Pic taken");
						$("#my_camera").css("display","none");
				   		$("#webcamsnap").css("display","none");
				   		$("saveimage_msg").css("display","none");
				   		$("#webcamsave_img").css("display","");
				   		$("#webcamresnap").css("display","");
				   		$("#imageprev").css("display","");

					});
					
					$(document).on("click","#webcamresnap",function() {
						console.log("Pic Retake");
						$("#my_camera").css("display","");
						$('#webcamsnap').css("display","");
						$("saveimage_msg").css("display","");
				   		$("#webcamresnap").css("display","none");
				   		$("#webcamsave_img").css("display","none");
						$("#imageprev").css("display","none");
				   		$("#imageprev").css("display","none");
					});
					
					$(document).on("click","#webcamsave_img",function() {
						SaveProctoringImage();
					});
				}

				if(ctproctoring != undefined && ctproctoring){
					//Why do we have this?
				//	$("#continue_timer" ).toggleClass( "disabled" );
					
	            	//Track event of fullscreen change
	            	setInterval(function(){
	            		var isIE = /*@cc_on!@*/false || !!document.documentMode;
	            		
	            		var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);
	            		var browserZoomLevel = Math.round(window.devicePixelRatio * 100);
	            		
	            		var modalBodyContent = '';
	            		
	            		if(browserZoomLevel !== 100 && isChrome){
	            			
	            			modalBodyContent = body;
	            			if(browserZoomLevel < 100){
		            			modalBodyContent = body+"<br><strong class='blink_me' style ='font-weight: bold;color: black;display: none;'>"+ browserzoommsg +""+browserZoomLevel+""+browserresetmsgone+"</strong> ";
	            			}else if(browserZoomLevel > 100){
		            			modalBodyContent = body+"<br><strong class='blink_me' style ='font-weight: bold;color: black;display: none;'>"+ browserzoommsg +""+browserZoomLevel+""+browserresetmsgtwo+"</strong> ";
	            			}

	            			$('#cotime-modal-body').html(modalBodyContent);

	            		}else{
	            			$('#cotime-modal-body').html(body);
	            		}

	            		
	            		
	                	if(!isIE){
//	                		console.log(window.innerHeight,screen.height);
	                		
	    	        		if( (window.innerWidth == screen.width && (window.innerHeight == screen.height || window.innerHeight == (screen.height-1)) ) || (window.fullScreen) ) {
	    	        			//inFullScreen
	    	        			$('#continue_timer').prop('disabled', false);
	    	        			$('#new_attempt').prop('disabled', false);
	    	            	}else{
	    	            		//notInFullscreen
	    	            		$('#continue_timer').prop('disabled', true);
	    	            		$('#new_attempt').prop('disabled', true);
	    	            	}
	                	}
	                	 else{
	                		 $('#continue_timer').prop('disabled', true);
	                		 $('#new_attempt').prop('disabled', true);
	                		 // If its a IE
	                	 }
	            	}, 300);
				}
				
			});

		},

		timeup: function(args){

			CONFIG = args;
			var title=CONFIG.title;
			var body=CONFIG.body;
			var rootPath = M.cfg.wwwroot;
			var safebrowser = CONFIG.safebrowser;
			var closebrowser = CONFIG.closebrowser;

			$('document').ready(function(){ 
				
				history.pushState(null, null, location.href);
				   window.onpopstate = function () {
				       history.go(1);
				   };
				   
				   function goBack() {
					   window.history.back();
					 }

				var modalHtml =
					' <div class="modal fade" id="myModal-closedtimer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">'+
					' <div class="modal-dialog" id="cotime-modal-dialog">'+
					' <div class="modal-content">'+
					' <div class="coursetimer-text">'+
					' <div class="modal-headers">'+
					' <h4 class="modal-title" id="myModalLabeltwo" style="color: red;">'+ title +'</h4>'+
					' </div><div class="modal-body">'+ body;
				
				if( safebrowser ){
					modalHtml += '<div><a class="btn btn-outline-warning text-center" style="margin-top:5px" href="https://lms.tekstac.com/closesafebrowser.php" '+ closebrowser +'</a></div>';
				}
				
				modalHtml += '</div>'+
					' <button type="button" class="btn btn-info" aria-expanded="false" onclick="goBack()">Back</button>'+
					'</div>'+
					' <div class="modal-footer"></div>'+
					' </div></div></div>';
					
				// insert HTML dynamically
				$("#page-header").append(modalHtml);

			});
		},
		
		unlock: function(args){

			CONFIG = args;
			var title=CONFIG.action;
			var courseid=CONFIG.courseid;
			var rootPath = M.cfg.wwwroot;					
			
			$('document').ready(function(){
				$(document).on("click","#submitFormData",function() {
					
					  var userids = [];
					  var ids = [];
			            $.each($("input[name='userid']:checked"), function(){
			            	
			            	var enabledata = $(this).val();
			            	var res = enabledata.split("-");
			            	ids.push(res[0]);
			            	userids.push(res[1]);
			                
			            });
					
			            $.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'unlock', courseid:courseid, userids:userids, attemptids:ids })
          		  		.done(function( result ) {
              		  		var redirecturl=rootPath+"/blocks/coursetimer/reenable_proctoring.php?id="+courseid;
                  		  	location.replace(redirecturl); 
          		  		})
				});
			});
			


		},
		cleardata: function(args){

			CONFIG = args;
			var action=CONFIG.action;
			var courseid=CONFIG.courseid;
			var rootPath = M.cfg.wwwroot;
			
			$('document').ready(function(){
				$(document).on("click","#submitCacheData",function() {
					
					var userids = [];
		            $.each($("input[name='userid']:checked"), function(){            
		            	userids.push($(this).val());
		                
		            });
		            $('#staticBackdrop').modal('show');

		            $('#cc_clearudata').click(function(){
						$.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: action,courseid:courseid,userids:userids })
          		  		.done(function( result ) {
              		  		var redirecturl=rootPath+"/blocks/coursetimer/cleardata.php?id="+courseid;
                  		  	location.replace(redirecturl); 
          		  		})
					});

					$('#cc_cancel').click(function(){
						var redirecturl=rootPath+"/blocks/coursetimer/cleardata.php?id="+courseid;
                  		  	location.replace(redirecturl);
					});
				});
				
			});
			
			$("#group").on('change', function () {
    			var groupid = $(this).val();

    			var promises = ajax.call([{
                    methodname: 'block_coursetimer_filter_userdata',
                    args: {'groupid': groupid, 'courseid' : courseid }
                }, ]);
    
                promises[0].done(function(response) {
                    document.getElementById('cacheuser-list').innerHTML = response.html;
                    $("#checkall").click(function () {
					    $(".check").prop('checked', $(this).prop('checked'));
					});
                }).fail(function(ex) {
                    console.log(ex);
                });
			});	

		},		
		
		activate: function(args){

			CONFIG = args;
			var courseid=CONFIG.courseid;
			var rootPath = M.cfg.wwwroot;					
			
			$('document').ready(function(){
				$(document).on("click","#activeCompletedusr",function() {
					
					  var userids = [];
			            $.each($("input[name='userid']:checked"), function(){            
			            	userids.push($(this).val());
			                
			            });
						if (Array.isArray(userids) && userids.length) {
							
							$.post( rootPath+"/blocks/coursetimer/proctoring_ajax.php", { action: 'active',courseid:courseid,userids:userids })
          		  		    .done(function( result ) {
              		  		var redirecturl=rootPath+"/blocks/coursetimer/reenable_proctoring.php?id="+courseid;
                  		  	location.replace(redirecturl); 
          		  		    }) 	
							
                        }else{
							alert("Users Not Selected");
						}
				
			           
				});
			});
		},
		
		attemptcompleted: function(args){
			$('document').ready(function(){
			CONFIG = args;
			var title=CONFIG.title;
			var body=CONFIG.body;
			var button=CONFIG.button;
			var rootPath = M.cfg.wwwroot;
				
				modalHtml += '</div>'+
					' <button type="button" class="btn btn-info" aria-expanded="false" onclick="goBack()">Back</button>'+
					'</div>'+
					' <div class="modal-footer"></div>'+
					' </div></div></div>';
			
			var modalHtml =
					' <div class="modal fade" id="myModal-attemptclosed" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">'+
					' <div class="modal-dialog" id="cotime-modal-dialog">'+
					' <div class="modal-content">'+
					' <div class="coursetimer-text">'+
					' <div class="modal-headers">'+
					' <h4 class="modal-title" id="myModalLabeltwo" style="color: red;margin-top: 16px;">'+ title +'</h4>'+
					' </div><div class="modal-body">'+ body;
			
			modalHtml += '</div>'+
					' <button type="button" id="goback_dashboard" class="btn btn-info" aria-expanded="false" >Back</button>'+
					'</div>'+
					' <div class="modal-footer"></div>'+
					' </div></div></div>';
					
				// insert HTML dynamically
				$("#page-header").append(modalHtml);
			$("#myModal-attemptclosed").modal('show');
			
			
				$(document).on("click","#goback_dashboard",function() {
					
						location.replace(rootPath);
				});
			
			
			})
		}
	};

});

define('block_coursetimer/verification', ['jquery'], function($) {
    return {
        fullscreen: function(args) {

            //Track event of fullscreen change
            setInterval(function() {

                var isIE = /*@cc_on!@*/ false || !!document.documentMode;
                var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);
                var browserZoomLevel = Math.round(window.devicePixelRatio * 100);

                if (browserZoomLevel !== 100 && isChrome) {
                    $('#verify_fullscreen').prop('disabled', true);
                }

                if (!isIE) {
                    $('#fullscreen_message').css('display', 'none');
                    if ((window.innerWidth == screen.width && (window.innerHeight == screen.height || window.innerHeight == (screen.height - 1))) || (window.fullScreen)) {
                        //inFullScreen
                        $('#verify_fullscreen').prop('disabled', false);
                    } else {
                        //notinFullScreen
                        $('#verify_fullscreen').prop('disabled', true);

                    }
                } else {
                    // User using IE browser
                    $('#verify_fullscreen').prop('disabled', true);
                    $('#fullscreen_message').css('display', 'block');
                }
            }, 300);

        },
        webcamcheck: function(args) {

            function streaming(){
                $('#verify_webcam').prop('disabled', true);
                navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {

                    // webcam is available
                    cam_mic_allowed = true;
                    $('#cam_mic_fail').addClass('hidden');

                    //when the control enters first time after allowing cam access.
                    if(flag==1){
                        flag++;

                        //get the available media devices
                        navigator.mediaDevices.enumerateDevices()
                        .then(get_mediaDevices)
                        .catch(function(err) {
                            console.log(err.name + ": " + err.message);
                        });
                    }
                }).catch( function(error) {
                    // webcam is not available
                    cam_mic_allowed = false;
                    $('#verify_webcam').prop('disabled', true);
                    streaming();
                });

                if(cam_mic_allowed==true){
                    var videodevice = $('#webcamdevices').val();
                    start_streaming(videodevice);
                }
            }

            function start_streaming(videodevice){
                var constraints_stream = {
                    video: {deviceId: videodevice ? {exact: videodevice} : undefined}
                };

                var constraints_audio = {
                    audio: {deviceId: $('#microphonedevices').val() ? {exact: $('#microphonedevices').val()} : undefined}
                };

                navigator.mediaDevices.getUserMedia(constraints_stream).then(function(stream) {

                    //Stream the video in the modal
                    window.stream = stream; // make stream available to console
                    videoElement.srcObject = stream;
                    streamed = 1;
                }).catch( function(error) {
                    // webcam is not available
                    cam_mic_allowed = false;
                    $('#verify_webcam').prop('disabled', true);
                    streaming();
                });

                navigator.mediaDevices.getUserMedia(constraints_audio).then(startUserMedia).catch(function(e) {
                    console.log('No live audio input: ' + e);
                });
            }

            function get_mediaDevices(devices){
                devices.forEach(function(device) {
                    if(device.kind === 'audioinput'){
                        $('#microphonedevices')
                            .append($("<option></option>")
                                .attr("value", device.deviceId)
                                .text(device.label)
                                .addClass("audiodevice"));
                    }
                    if(device.kind === 'videoinput'){
                        $('#webcamdevices')
                            .append($("<option></option>")
                                .attr("value", device.deviceId)
                                .text(device.label)
                                .addClass("videodevice"));
                    }
                });
                if(localStorage.getItem(mediaPrefix + "video") && localStorage.getItem(mediaPrefix + "audio")){
                    var audiodevice = localStorage.getItem(mediaPrefix + "audio");
                    var videodevice = localStorage.getItem(mediaPrefix + "video");

                    $('[name=audioOptions]').val( audiodevice );
                    $('[name=videoOptions]').val( videodevice );
                } else{
                    $('#microphonedevices>option:eq(0)').attr('selected', true);
                    $('#webcamdevices>option:eq(0)').attr('selected', true);

                    localStorage.setItem(mediaPrefix + "audio", $('#microphonedevices').val());
                    localStorage.setItem(mediaPrefix + "video", $('#webcamdevices').val());

                    var audiodevice = localStorage.getItem(mediaPrefix + "audio");
                    var videodevice = localStorage.getItem(mediaPrefix + "video");

                    // localStorage.setItem(mediaPrefix + "video", $('#webcamdevices').val());
                    // localStorage.setItem(mediaPrefix + "audio", $('#microphonedevices').val());
                }

                constraints = {
                    audio: {deviceId: audiodevice ? {exact: audiodevice} : undefined},
                    video: {deviceId: videodevice ? {exact: videodevice} : undefined}
                };
                navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {webcam_check();});
            }

            $('#microphonedevices,#webcamdevices').change(function() {

                localStorage.setItem(mediaPrefix + "audio", $('#microphonedevices').val());
                localStorage.setItem(mediaPrefix + "video", $('#webcamdevices').val());

                var audiodevice = localStorage.getItem(mediaPrefix + "audio");
                var videodevice = localStorage.getItem(mediaPrefix + "video");

                constraints = {
                    audio: {deviceId: audiodevice ? {exact: audiodevice} : undefined},
                    video: {deviceId: videodevice ? {exact: videodevice} : undefined}
                };
                streaming();
            });

            $( ".media_devices" ).on( "click", function() {
                var videodevice = $('#webcamdevices').val();
                start_streaming(videodevice);
                $("#check_media").modal("show");
            });

            //Track event of webcam allowed
            var flag=1;
            var streamed = 0;
            var x= '';
            var y='';
            var videoElement = document.getElementById('video_stream');
            var cam_mic_allowed = false;
            var constraints ={
                video: true, 
                audio: true
            };
            var mediaPrefix = 'coursetimer_' + 'deviceID' + "_";

            var meter = null;
            var WIDTH = 500;
            var recordingStarted = false;

            // initialize SpeechRecognition object
            // let recognition = new webkitSpeechRecognition();
            // recognition.maxAlternatives = 1;
            // recognition.continuous = true;

            streaming();

            function webcam_check(){
                setInterval(function() {
                    // navigator.getMedia = (navigator.getUserMedia || // use the proper vendor prefix
                    //     navigator.webkitGetUserMedia ||
                    //     navigator.mozGetUserMedia ||
                    //     navigator.msGetUserMedia);
                    navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {

                        // webcam is available
                        cam_mic_allowed = true;

                        $('#cam_mic_fail').addClass('hidden');
                        $('#verify_webcam').prop('disabled', false);
                    }).catch( function(error) {
                        // webcam is not available
                        cam_mic_allowed = false;
                        $('#verify_webcam').prop('disabled', true);
                    });
                }, 500);
            }
            if (cam_mic_allowed == false) {
                setTimeout(function() {
                    $('#cam_mic_fail').removeClass('hidden');
                }, 15000);
            }
            x=setInterval(function() {
                if(window.stream){
                    window.stream.oninactive = function(event) {
                        $('#verify_webcam').prop('disabled', true);
                        clearInterval(x);
                    }
                }
            }, 1000);

            function startUserMedia(stream) {
                recordingStarted = true;
                const ctx = new AudioContext();
                const analyser = ctx.createAnalyser();
                const streamNode = ctx.createMediaStreamSource(stream);
                streamNode.connect(analyser);

                // Create a new volume meter and connect it.
                meter = createAudioMeter(ctx);
                streamNode.connect(meter);

                drawLoop();

            }

            // Create pitch bar
            function drawLoop( time ) {

                var pitchVolume = meter.volume*WIDTH*1.4;

                  var height = 0;
                  var color;

                // Pitch detection minimum volume
                var minimum_volume = 1;

                // Get height if Recording started
                if(recordingStarted){

                    if(pitchVolume < minimum_volume){
                           height = 0;
                           color = 'green';
                    }else if(pitchVolume >= minimum_volume && pitchVolume < (minimum_volume+20) ){
                           height = 10;
                           color = 'green';
                    }else if(pitchVolume >= (minimum_volume+20) && pitchVolume < (minimum_volume+40)){
                           height = 20;
                           color = 'green';
                    }else if(pitchVolume >= (minimum_volume+40) && pitchVolume < (minimum_volume+60)){
                           height = 30;
                           color = 'orange';
                    }else if(pitchVolume >= (minimum_volume+60) && pitchVolume < (minimum_volume+80)){
                           height = 40;
                           color = 'orange';
                    }else if(pitchVolume >= (minimum_volume+80) && pitchVolume < (minimum_volume+100)){
                           height = 50;
                           color = 'orange';
                    }else if(pitchVolume >= (minimum_volume+100) && pitchVolume < (minimum_volume+120)){
                           height = 60;
                           color = 'orange';
                    }else if(pitchVolume >= (minimum_volume+120) && pitchVolume < (minimum_volume+140)){
                           height = 70;
                           color = 'red';
                    }else if(pitchVolume >= (minimum_volume+140) && pitchVolume < (minimum_volume+160)){
                           height = 80;
                           color = 'red';
                    }else if(pitchVolume >= (minimum_volume+160) && pitchVolume < (minimum_volume+180)){
                           height = 90;
                           color = 'red';
                    }else if(pitchVolume >= (minimum_volume+180)){
                           height = 100;
                           color = 'red';
                    }

                }

                // Update height
                  document.getElementById('voiceVolume').style.height = height+'%';
                  document.getElementById('voiceVolume').style.background = color;
                  

                rafID = window.requestAnimationFrame( drawLoop );
            }
        },
        init: function(args) {
			var server_check = args.servercheck;
            setInterval(function() {
				if (server_check){
	                if ($('#verify_checkme').prop("checked") == true) {
	                    $('#iagreetoterms').prop('disabled', false);
	                } else {
	                    $('#iagreetoterms').prop('disabled', true);
	                }					
				}else {
					$('#verify_checkme').attr("disabled", "disabled");
					$('.checkmark').css("pointer-events", "none");
					$('.downservermessage').css("display", "block");
				}

            }, 500);
        },
        approvalcheck: function(args) {

            var rootPath = M.cfg.wwwroot;

            var courseid = args.courseid;
            var userid = args.userid;

            $(document).ready(function() {
                checkUserApproval();
            });

            function createNotification(title, text, icon) {
                const noti = new Notification(title, {
                    body: text,
                    icon
                });
            }

            function checkUserApproval() {

                $.post(rootPath + "/blocks/coursetimer/proctoring_ajax.php", {
                        action: 'userprocdata',
                        courseid: courseid,
                        userid: userid
                    })
                    .done(function(result) {
                        if (result === "true") {
                            userApproved = true;
                            createNotification('Approval Acccepted', 'Your approval has been Accepted. Now you can proceed to the next step.', $(' head > link:nth-child(2)').attr('href'));
                            $('#begin_assessment').css('display', 'block');
                            $('#ct_loading').css('display', 'none');
                        } else if (result === "false") {
                            setTimeout(function() { checkUserApproval(); }, 3000);
                        } else if (result === "rejected") {
                            createNotification('Approval Declined', 'Your approval has been Declined. Please check the Reason and Retry.', $(' head > link:nth-child(2)').attr('href'));
                            $.post(rootPath + "/blocks/coursetimer/proctoring_ajax.php", {
                                action: 'getrejectedmsg',
                                courseid: courseid,
                                userid: userid
                            }).done(function(messageresult) {

                                $('#proctorreason').html(messageresult.rejectedcomment);
                                //console.log();
                            });


                            // Take photo Again Flow
                            $('#begin_assessment').css('display', 'none');
                            $('#ct_loading').css('display', 'none');
                            $('#approval_rejected').css('display', 'block');
                        }
                    });
            }

        },
        desktopnotification: function(args) {

            //Desktop Notification Flow
            function askForApproval() {
                if (Notification.permission === "granted") {
                    createNotification('Assessment', 'Desktop Notification Enabled', $(' head > link:nth-child(2)').attr('href'));
                    $('#verify_notification').prop('disabled', false);
                } else {
                    setTimeout(function() {
                        $('#notification_fail').removeClass('hidden');
                    }, 15000);
                    Notification.requestPermission(permission => {
                        if (permission === 'granted') {
                            $('#notification_fail').addClass('hidden');
                            createNotification('Assessment', 'Desktop Notification Enabled', $(' head > link:nth-child(2)').attr('href'));
                            $('#verify_notification').prop('disabled', false);
                        } else {
                            setTimeout(function() { askForApproval(); }, 1000);
                        }
                    });
                }
            }

            function createNotification(title, text, icon) {
                const noti = new Notification(title, {
                    body: text,
                    icon
                });
            }
            $(document).ready(function() {
                askForApproval();
            });
        }
    };
});
define('block_coursetimer/addremove', ['jquery'], function($) {
	return { 
		init: function() {
			var url=  $(location).attr('href');
			var courseid = url.substring(url.indexOf("id=") + 3);
				/*var addnewuserstocoursetimer =
				' <div id="add_users" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog modal-lg">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: White;height: 50px;">' +
				' <h4 class="modal-title" style="margin-left: 20px;color: white;"> <strong> Please confirm </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div><br> Are you sure you want to add these users?'+								
				' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="new_table_add" aria-expanded="false">Add</button>'+
				' <button type="button" class="btn btn-info" id="new_table_cancel" aria-expanded="false">Cancel</button>'+
				' </div>'+
				' </div>'+
				' </div></div></div>';
			$("#page-header").append(addnewuserstocoursetimer);*/
			
			var addremovenewuserstocoursetimer = 
				' <div id="addorremove_users" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers">' +
				' <h4 class="modal-title" style="margin-left: 20px;margin-top: 20px;"> <strong> Please confirm </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div><br> Are you sure you want to add/remove these users?'+								
				' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="remove_table_add" aria-expanded="false">Yes proceed</button>'+
				' <button type="button" class="btn btn-info" id="remove_table_cancel" aria-expanded="false" data-dismiss="modal">No Cancel</button>'+
				' </div>'+
				' </div>'+
				' </div></div></div>';
				
			var clearcacheuserstocoursetimer = 
				' <div id="clearcache_users" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers">' +
				' <h4 class="modal-title" style="margin-left: 20px;margin-top: 20px;"> <strong> Please confirm </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div><br> Are you sure you want to clear cache for these users?'+								
				' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="remove_table_add" aria-expanded="false">Yes proceed</button>'+
				' <button type="button" class="btn btn-info" id="remove_table_cancel" aria-expanded="false" data-dismiss="modal">No Cancel</button>'+
				' </div>'+
				' </div>'+
				' </div></div></div>';
			$("#page-header").append(addremovenewuserstocoursetimer);
			$("#page-header").append(clearcacheuserstocoursetimer);			
			
			$("#ar_selectctype").change(function() {
				var action = $('#ar_selectctype option:selected').text();
				if( action == 'Add') {
					$('input').removeAttr('disabled');
				}
				else if( action == 'Remove') {
					 $('input').attr('disabled', 'disabled');
				}
			});
			
			$(document).on("click","#addremoveusers",function() { 
				var action = $('#ar_selectctype option:selected').text();
				var query = $.trim($("#ar_text").val());
				var starttime = $("#ar-start-time").val(); 
				var endtime = $("#ar-end-time").val();
				
				if( action == 'Add') {
					if(query !== '' && starttime !=='' && endtime !== '') {
						$("#addorremove_users").modal("show");
					}
					else {
						alert("Please provide all fields for add or remove users.");
					}
				}
				else if (action == 'Remove') {
					if(query !== '') {
						$("#addorremove_users").modal("show");
					}
					else {
						alert("Please provide all fields for add or remove users.");
					}
				}
				else if (action == 'Clear Cache') {
					if(query !== '') {
						$("#clearcache_users").modal("show");
					}
					else {
						alert("Please provide query field for clear users cache.");
					}
				}
							   				
		    });
			
			$(document).on("click","#remove_table_add",function() { 
				var action = $('#ar_selectctype option:selected').text();
				if( action == 'Add') {
					var query = $.trim($("#ar_text").val());
					var starttime = $("#ar-start-time").val(); 
					var endtime = $("#ar-end-time").val();
					//var duration = $("#ar-duration").val();
					var epoch_starttime = new Date(starttime);
					var epoch_stime = epoch_starttime.getTime()/1000.0; 
					var epoch_endtime = new Date(endtime);
					var epoch_etime = epoch_endtime.getTime()/1000.0; 
					
					if(query !== '' && epoch_stime !=='' && epoch_etime !== '') {
						$.ajax({
	                        method: "GET",
	                        url: M.cfg.wwwroot + '/blocks/coursetimer/ajax_addremoveusers.php',
	                        data: {"action" : "addusers","query" : query,"courseid" : courseid,"starttime" :epoch_stime,"endtime" :epoch_etime}
	                    }).done(function(response) {
	                    	location.reload();
	                    	
	                    });
					}
					
				}
				else if (action == 'Remove') {
					var query = $.trim($("#ar_text").val());
					if( query !== '') {
						$("#addorremove_users").modal("show");
						$.ajax({
	                        method: "GET",
	                        url: M.cfg.wwwroot + '/blocks/coursetimer/ajax_addremoveusers.php',
	                        data: {"action" : "removeusers","query" : query,"courseid" : courseid}
	                    }).done(function(response) {
	                    	location.reload();
	                    	
	                    });
					}
					
				}
				else if (action == 'Clear Cache') {
					var query = $.trim($("#ar_text").val());
					if( query !== '') {
						$("#clearcache_users").modal("show");
						$.ajax({
	                        method: "GET",
	                        url: M.cfg.wwwroot + '/blocks/coursetimer/ajax_addremoveusers.php',
	                        data: {"action" : "clearcache","query" : query,"courseid" : courseid}
	                    }).done(function(response) {
	                    	location.reload();
	                    	
	                    });
					}
					
				}
		    });
			
		}
	};
});
define('block_coursetimer/proctoring', ['jquery', 'core/str'], function($, str) {

    return {
        init: function(Procargs) {

            var langStrings = new Array();
            var lockedmsg;
            var unlockedmsg;
            var resumedmsg;
            var pausedmsg;
            var warningmsg;
            var completedMsg;
            var closedMsg;
            var button;
            var refreshbutton;
            var continueassmt;
            var Understoodbtn;
            var browserzoommsg;
            var browserresetmsgone;
            var browserresetmsgtwo;
            var unlockedmessage;
            //lets fetch the required lang strings (Recommend practice :p )
            var strings = [
                { key: 'locked_msg', component: 'block_coursetimer' },
                { key: 'unlocked_msg', component: 'block_coursetimer' },
                { key: 'resumedmsg', component: 'block_coursetimer' },
                { key: 'pausedmsg', component: 'block_coursetimer' },
                { key: 'warning_msg', component: 'block_coursetimer' },
                { key: 'completed_msg', component: 'block_coursetimer' },
                { key: 'assessment_closed_msg', component: 'block_coursetimer' },
                { key: 'dashboardbutton', component: 'block_coursetimer' },
                { key: 'refreshbutton', component: 'block_coursetimer' },
                { key: 'continueassmt', component: 'block_coursetimer' },
                { key: 'Understoodbtn', component: 'block_coursetimer' },
                { key: 'browserzoommsg', component: 'block_coursetimer' },
                { key: 'browserresetmsgone', component: 'block_coursetimer' },
                { key: 'browserresetmsgtwo', component: 'block_coursetimer' },
                { key: 'unlocked_msg_without_proc', component: 'block_coursetimer' },
            ];

            str.get_strings(strings).then(function(results) {
                langStrings = results;
                lockedmsg = langStrings[0];
                unlockedmsg = langStrings[1];
                resumedmsg = langStrings[2];
                pausedmsg = langStrings[3];
                warningmsg = langStrings[4];
                completedMsg = langStrings[5];
                closedMsg = langStrings[6];
                button = langStrings[7];
                refreshbutton = langStrings[8];
                continueassmt = langStrings[9];
                Understoodbtn = langStrings[10];
                browserzoommsg = langStrings[11];
                browserresetmsgone = langStrings[12];
                browserresetmsgtwo = langStrings[13];
                unlockedmessage = langStrings[14];
            });

            CONFIG = Procargs;

            var dontleave = false;
            var courseid = CONFIG.courseid;
            var userid = CONFIG.userid;
            var courselocked = parseInt(CONFIG.courselocked);
            var exceptionAllowed = parseInt(CONFIG.exceptionAllowed);
            var exceptionUsed = parseInt(CONFIG.exceptionUsed);
            var completed = parseInt(CONFIG.completed);
            var title = CONFIG.proctitle;
            var modalBodyContent = '';
            var waitingforresponse = false;
            var fullScreenCheck = parseInt(CONFIG.fullscreencheck);
            var pausedTitle = 'Assessment Paused';
            var closedTitle = 'Assessment Closed';
            var completedTitle = 'Assessment Completed';
            var lockedTitle = 'Assessment Locked';
            var resumeTitle = 'Resume Assessment';
            var continueTitle = 'Continue Assessment';
            var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
            //console.log(Procargs);

            $('document').ready(function() {

                history.pushState(null, null, location.href);
                window.onpopstate = function() {
                    history.go(1);
                };

                function goBack() {
                    window.history.back();
                }

                var url = window.location.href;
                var rootPath = M.cfg.wwwroot;
                var modalshown = false;
                var modalcreated = false;

                function createNotification(title, text, icon) {
                    const noti = new Notification(title, {
                        body: text,
                        icon
                    });

                    noti.onclick = function(event) {
                        //     //event.preventDefault(); // prevent the browser from focusing the Notification's tab
                    }
                }

                function create_modal() {
                    //var title=  'Proctored Assessment' ;

                    var modalHtml =
                        ' <div id="ct_proc_modal" class="modal fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
                        ' <div class="modal-dialog" >' +
                        ' <div class="modal-content">' +
                        ' <div class="coursetimer-text">' +
                        ' <div class="modal-headers">' +
                        ' <h4 class="modal-title" id="myModalProc" style="color: red;">' + title + '</h4> </div>' +
                        ' <div class="modal-body" ></div>' +
                        ' <div class="modal-footer">' +
                        ' <button type="button" class="btn btn-info" id="back_to_db" aria-expanded="false" style="display:none;" >' + refreshbutton + ' </button>' +
                        ' <button type="button" class="btn btn-info" id="back_to_home" aria-expanded="false" style="display:none;">' + button + '</button>' +
                        ' <button type="button" class="btn btn-info" id="unlock_proctoring" aria-expanded="false" style="display:none">' + continueassmt + '</button> </div>' +
                        ' <button type="button" class="btn btn-info" id="lock_warning" aria-expanded="false" style="display:none">' + Understoodbtn + '</button> </div>' +

                        ' </div></div>' +
                        ' </div></div>';

                    // insert HTML dynamically
                    $("#page-header").append(modalHtml);
                    modalcreated = true;
                    //If the user has already locked for this course
                }

                create_modal();

                setTimeout(function() {
                    if (completed == 1) {
                        $('#ct_proc_modal .modal-body').html(completedMsg);
                        $('#myModalProc').html(completedTitle);
                        $('#back_to_home').css('display', '');
                        $('#back_to_db').css('display', '');
                        modalshown = true;
                        $("#ct_proc_modal").modal('show');
                    } else if (completed == 3) {
                        $('#myModalProc').html(closedTitle);
                        $('#ct_proc_modal .modal-body').html(closedMsg);
                        $('#back_to_home').css('display', '');
                        $('#back_to_db').css('display', '');
                        modalshown = true;
                        $("#ct_proc_modal").modal('show');
                    } else if (courselocked != undefined && (courselocked == 1 || courselocked == -1 || courselocked == -2 || courselocked == 2)) {
                        // Changing body content based on the course lock status
                        if (courselocked == -1) {
                            $('#myModalProc').html(continueTitle);
                            // createNotification(continueTitle, continueTitle, $(' head > link:nth-child(2)').attr('href'));
                            if (fullScreenCheck == 1) {
                                $('#ct_proc_modal .modal-body').html(unlockedmsg);
                            } else {
                                $('#ct_proc_modal .modal-body').html(unlockedmessage);
                            }
                            $('#unlock_proctoring').css('display', '');
                            $('#back_to_db').css('display', 'none');
                            $('#lock_warning').css('display', 'none');
                        } else if (courselocked == -2) {
                            $('#myModalProc').html(resumeTitle);
                            $('#ct_proc_modal .modal-body').html(resumedmsg);
                            $('#unlock_proctoring').css('display', '');
                            $('#back_to_db').css('display', 'none');
                            $('#lock_warning').css('display', 'none');
                            createNotification(resumeTitle, resumedmsg, $(' head > link:nth-child(2)').attr('href'));
                        } else if (courselocked == 1 || courselocked == 2) {
                            if (courselocked == 2) {
                                $('#myModalProc').html(pausedTitle);
                                $('#ct_proc_modal .modal-body').html(pausedmsg);
                                createNotification(pausedTitle, pausedmsg, $(' head > link:nth-child(2)').attr('href'));
                            } else {
                                $('#myModalProc').html(lockedTitle);
                                $('#ct_proc_modal .modal-body').html(lockedmsg);
                                // createNotification(lockedTitle, lockedmsg, $(' head > link:nth-child(2)').attr('href'));
                            }
                            $('#unlock_proctoring').css('display', 'none');
                            $('#back_to_db').css('display', '');
                            $('#lock_warning').css('display', 'none');
                        }
                        $("#ct_proc_modal").modal('show');
                    }
                }, 500);

                document.getElementById('unlock_proctoring').addEventListener('click', function() {

                    //Lets update localstorage of webcam and screenshare to ensure old values don't cause problems
                    // var currentTime = Math.round(new Date().getTime()/1000);
                    var currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10)
                    localStorage.setItem(storagePrefix + "lastScreenshotTime", currentTime);
                    localStorage.setItem(storagePrefix + "lastImageCaptureTime", currentTime);

                    $("#ct_proc_modal").modal('hide');
                    courselocked = 0;
                    $.post(rootPath + "/blocks/coursetimer/proctoring_ajax.php", { action: 'continue', courseid: courseid })
                        .done(function(result) {
                            //refresh to take current data for timer from db
                            window.location.reload();
                        });
                }, false);

                $(document).on("click", "#back_to_db", function() {
                    location.replace(rootPath + "/course/view.php?id=" + courseid);
                });

                $(document).on("click", "#back_to_home", function() {
                    location.replace(rootPath);
                    //					goBack();
                });
                $(document).on("click", "#lock_warning", function() {
                    $("#ct_proc_modal").modal('hide');
                    window.location.reload();
                });

                if (true) {
                    function notInFullscreen() {
                        //console.log("Not in full");
                        //Show modal and redirect

                        if (!modalshown && dontleave === false && waitingforresponse === false) {
                            // Exceeded the count, Now lock the user

                            if (completed == 1) {
                                $('#myModalProc').html(completedTitle);
                                $('#ct_proc_modal .modal-body').html(completedMsg);
                                $('#back_to_home').css('display', '');
                                $('#back_to_db').css('display', '');
                                $('#unlock_proctoring').css('display', 'none');
                                $('#lock_warning').css('display', 'none');
                                modalshown = true;
                                $("#ct_proc_modal").modal('show');
                            } else if (completed == 3) {
                                $('#myModalProc').html(closedTitle);
                                $('#ct_proc_modal .modal-body').html(closedMsg);
                                $('#back_to_home').css('display', '');
                                $('#back_to_db').css('display', '');
                                modalshown = true;
                                $("#ct_proc_modal").modal('show');
                            } else if (fullScreenCheck != 0 && (exceptionAllowed == 0 || exceptionUsed >= exceptionAllowed)) {
                                $('#myModalProc').html(lockedTitle);
                                $('#ct_proc_modal .modal-body').html(lockedmsg);
                                $('#back_to_db').css('display', '');
                                $('#unlock_proctoring').css('display', 'none');
                                $('#lock_warning').css('display', 'none');

                                waitingforresponse = true;
                                $.ajax({
                                    type: "POST",
                                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php?action=lock&courseid=" + courseid,
                                    success: function(response) {
                                        waitingforresponse = false;
                                        $("#clockdiv").remove();
                                        $("#webcam_proctoring").remove;

                                        $("#ct_proc_modal").modal('show');
                                        modalshown = true;

                                        if (!url.includes('course/view.php') && !url.includes('enrol/index.php')) {
                                            location.replace(rootPath + "/course/view.php?id=" + courseid);
                                        }
                                        //console.log(result);
                                    },
                                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                                        setTimeout(function() {
                                            waitingforresponse = false;
                                            notInFullscreen();
                                        }, 3000);
                                    }
                                });

                            } else if (fullScreenCheck != 0 && exceptionUsed < exceptionAllowed) {
                                //show warning message
                                $('#myModalProc').html(title);
                                $('#ct_proc_modal .modal-body').html(warningmsg);
                                $('#back_to_db').css('display', 'none');
                                $('#unlock_proctoring').css('display', 'none');
                                $('#lock_warning').css('display', '');

                                waitingforresponse = true;
                                $.ajax({
                                    type: "POST",
                                    url: rootPath + "/blocks/coursetimer/proctoring_ajax.php?action=lockcount&courseid=" + courseid,
                                    success: function(response) {
                                        waitingforresponse = false;
                                        //				            				$( "#clockdiv" ).remove();
                                        $("#webcam_proctoring").remove;

                                        modalshown = true;
                                        $("#ct_proc_modal").modal('show');
                                        //refresh to take current data for timer from db
                                        //window.location.reload();

                                    },
                                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                                        setTimeout(function() {
                                            waitingforresponse = false;
                                            notInFullscreen();
                                        }, 3000);

                                    }
                                });
                            }
                        }
                    }

                    function inFullScreen() {
                        //Hide modal
                        if (modalshown) {
                            //	                		console.log("Modal Hide");
                            $("#ct_proc_modal").modal('hide');
                            modalshown = false;
                        }
                    }

                    //Track event of fullscreen change
                    var flagfullscreen = 1;
                    var flagnotinfullscreen = 1;
                    var updatefullscreen = 0;
                    setInterval(function() {
                        var isIE = /*@cc_on!@*/ false || !!document.documentMode;

                        if (!isIE) {

                            var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);
                            var browserZoomLevel = Math.round(window.devicePixelRatio * 100);

                            if (courselocked == -1) {
                                if (fullScreenCheck == 1) {
                                    modalBodyContent = unlockedmsg;
                                } else {
                                    modalBodyContent = unlockedmessage;
                                }
                            } else if (courselocked == -2) {
                                modalBodyContent = resumedmsg;
                            } else if (exceptionUsed < exceptionAllowed) {
                                modalBodyContent = warningmsg;
                            }

                            if (browserZoomLevel !== 100 && isChrome) {
                                if (browserZoomLevel < 100) {
                                    modalBodyContent = modalBodyContent + " <br> <strong class='blink_me' style = 'font-weight: bold;color: black; display: none;'>" + browserzoommsg + "" + browserZoomLevel + "" + browserresetmsgone + "</strong> ";
                                } else if (browserZoomLevel > 100) {
                                    modalBodyContent = modalBodyContent + " <br> <strong class='blink_me' style = 'font-weight: bold;color: black; display: none;'>" + browserzoommsg + "" + browserZoomLevel + "" + browserresetmsgtwo + "</strong> ";
                                }
                            }

                            if (completed == 1) {
                                $('#myModalProc').html(completedTitle);
                                $('#ct_proc_modal .modal-body').html(completedMsg);
                                $('#back_to_home').css('display', '');
                                $('#back_to_db').css('display', '');
                                $('#unlock_proctoring').css('display', 'none');
                                $('#lock_warning').css('display', 'none');
                                modalshown = true;
                                $("#ct_proc_modal").modal('show');
                            } else if (completed == 3) {
                                $('#myModalProc').html(closedTitle);
                                $('#ct_proc_modal .modal-body').html(closedMsg);
                                $('#back_to_home').css('display', '');
                                $('#back_to_db').css('display', '');
                                $('#unlock_proctoring').css('display', 'none');
                                $('#lock_warning').css('display', 'none');
                                modalshown = true;
                                $("#ct_proc_modal").modal('show');
                            } else if (courselocked == -1 || courselocked == -2 || (exceptionUsed < exceptionAllowed && fullScreenCheck != 0)) {
                                $('#ct_proc_modal .modal-body').html(modalBodyContent);
                            }

                            var windowheight = window.innerHeight;
                            var screenheight = screen.height;

                            var screenheightmatch = false;

                            var differenceinheight = screenheight - windowheight;
                            if (differenceinheight <= 5) {
                                screenheightmatch = true;
                            }
                            if ((window.innerWidth == screen.width && screenheightmatch) || (window.fullScreen)) {
                                //inFullScreen();
                                $('#unlock_proctoring').prop('disabled', false);
                                $('#lock_warning').prop('disabled', false);

                                if (fullScreenCheck != 0 && flagfullscreen && updatefullscreen) {
                                    updatefullscreen = 0;
                                    //log for not in full screen 
                                    //console.log("Page in full screen");
                                    flagfullscreen = 0;
                                    $.ajax({
                                        type: "POST",
                                        url: rootPath + "/blocks/coursetimer/log_ajax.php?action=backtofullscreen&courseid=" + courseid,
                                        success: function(response) {
                                            //do stuff here				          		  		
                                        }
                                    });
                                }

                            } else {

                                $('#lock_warning').prop('disabled', true);
                                if (fullScreenCheck != 0 && flagnotinfullscreen) {
                                    updatefullscreen = 1;
                                    //log for Back to full screen 
                                    //console.log("Not in full screen");
                                    flagnotinfullscreen = 0;
                                    $.ajax({
                                        type: "POST",
                                        url: rootPath + "/blocks/coursetimer/log_ajax.php?action=notinfullscreen&courseid=" + courseid,
                                        success: function(response) {
                                            //do stuff here				          		  		
                                        }
                                    });

                                }

                                //console.log(window.innerWidth,screen.width,window.innerHeight,screen.height);
                                if (courselocked != -1) {
                                    //console.log(dontleave);
                                    notInFullscreen();
                                }
                                dontleave = false;
                                if (fullScreenCheck != 0) {
                                    $('#unlock_proctoring').prop('disabled', true);
                                }
                            }
                        } else {
                            // If its a IE
                            $('#lock_warning').prop('disabled', true);
                            $('#unlock_proctoring').prop('disabled', true);

                            if (fullScreenCheck != 1) {
                                $('#unlock_proctoring').prop('disabled', false);
                                $('#lock_warning').prop('disabled', false);
                            }

                        }
                    }, 300);
                    $(window).blur(function() {
                        window.onbeforeunload = null;
                        //Show modal & redirect
                        if (courselocked != -1) {
                            notInFullscreen();
                        }

                        $.ajax({
                            type: "POST",
                            url: rootPath + "/blocks/coursetimer/log_ajax.php?action=notinfocus&courseid=" + courseid,
                            success: function(response) {
                                //do stuff here				          		  		
                            }
                        });

                        //console.log("BLUR");
                    });


                    $(window).focus(function() {

                        //console.log("back to focus")
                        $.ajax({
                            type: "POST",
                            url: rootPath + "/blocks/coursetimer/log_ajax.php?action=backtofocus&courseid=" + courseid,
                            success: function(response) {
                                //do stuff here				          		  		
                            }
                        });

                    });

                    var validNavigation = false;
                    //             $(".qnbutton,.endtestlink,.submitbtns, .cell").click(function(){
                    //                     validNavigation=true;
                    //             });


                    // To disable changes made may not be saved popup
                    window.onbeforeunload = null;
                    window.addEventListener("beforeunload", function(event) {
                        window.onbeforeunload = null;
                        if (!validNavigation) {
                            dontleave = true;
                            //console.log("-------");
                        }
                    }, false);

                }
            });
        }
    };

});
define('block_coursetimer/imageCapture', ['jquery'], function($) {
    return {
        imageCapture: function(args) {

            var userid = args.userid;
            var courseid = args.courseid;
            var imageCaptureFrequency = parseInt(args.image_capture_frequency ? args.image_capture_frequency : 60, 10);
            var webproctoringEnabled = args.web_proctoring_enabled == 1 ? true : false;
            var serverBaseURL = args.server_base_url;
            var APIEndpointURL = args.apiendpoint_url;
            var turnurl = args.turnurl;
            var stunurl = args.stunurl;
            var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
            var capturingSnapshots = false;
            var streamingVideo = false;
            var token = $('#proc-title').attr('token');

            //lets do whatever we want. But only if its enabled
            if (webproctoringEnabled) {
                if (!OTProctor) {
                    console.log('FAILED to find OTProctor Library');
                }

                let otproc = new OTProctor();

                let init = otproc.initialize(
                    "STUDENT",
                    userid,
                    courseid,
                    token,
                    "wss://" + serverBaseURL + "/proctor",
                    "https://" + APIEndpointURL, [{
                            "url": "stun:" + stunurl
                        },
                        {
                            "url": "turn:" + turnurl,
                        }
                    ],
                    'teknoturf',
                    55,
                    0, //LOG_LEVEL
                );

                var streamStartSuccess = function() {
                    streamingVideo = true;
                    console.log("Live stream iniated from student side");
                }

                var streamDisconnected = function() {
                    streamingVideo = false;
                    console.log("Live stream disconnected");
                }

                var stopSuccess = function() {
                    streamingVideo = false;
                    console.log("Live stream stopped from student side");
                }

                stopHandle = setInterval(function() {
                    var lastPollTime = parseInt(localStorage.getItem(storagePrefix + "lastPollTime"), 10);
                    var startTime = parseInt(localStorage.getItem(storagePrefix + "startTime"), 10);
                    var closeTime = parseInt(localStorage.getItem(storagePrefix + "closeTime"), 10);
                    var completed = parseInt(localStorage.getItem(storagePrefix + "completed"), 10);
                    var shouldStream = (localStorage.getItem(storagePrefix + "shouldStream") == "true" ? true : false);

                    //Lets get live streaming logic done first
                    if (shouldStream && !(streamingVideo)) {
                        //Should be streaming. But not streaming now. So lets start it
                        console.log("Should be streaming. But not streaming now. So lets start it");
                        otproc.startRecording("webcamvideoplayer", streamStartSuccess, streamDisconnected);
                    } else if (!(shouldStream) && streamingVideo) {
                        //should'nt be streaming. But streamin now. Lets stop it
                        console.log("should'nt be streaming. But streamin now. Lets stop it");
                        otproc.stopRecording(stopSuccess);
                    }

                    //Lets save images only if required conditions are met
                    currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10)

                    if (completed == 0 && currentTime > startTime && closeTime > currentTime) { // && lastPollTime + 60 >= currentTime

                        //Initial checks passed. Lets send image only if it is after image capture interval
                        var lastImageCaptureTime = parseInt(localStorage.getItem(storagePrefix + "lastImageCaptureTime"), 10);
                        isNaN(lastImageCaptureTime) ? lastImageCaptureTime = 0 : lastImageCaptureTime;
                        //Call this method only if capturing is not happening earlier
                        if (!capturingSnapshots) {
                            var snapshotReference = otproc.startPeriodicSnapshot(imageCaptureFrequency, "320");
                            snapshotReference.then((ref) => {
                                capturingSnapshots = true;
                            }).catch((err) => {
                                console.log(err);
                            });
                        }
                    } else {
                        //if capturing is happening. Lets stop it now
                        if (capturingSnapshots) {
                            otproc.stopPeriodicSnapshot();
                            capturingSnapshots = false;
                            location.replace(M.cfg.wwwroot + '/blocks/coursetimer/iagree.php?id=' + courseid);
                        }
                    }
                }, 3000);
            }
        }
    }
});
define('block_coursetimer/trial', ['jquery', 'core/ajax', 'core/config', 'core/str'], function($, ajax, mdlcfg, str) {
    return {
        init: function(args) {

            CONFIG = args;
            var enableDeskNotify = CONFIG.enableDeskNotify;

            $(document).ready(function() {

                var current_fs, next_fs, previous_fs; //fieldsets
                var opacity;
                var current = 1;
                var steps = $("fieldset").length;

                setProgressBar(current);

                $(".next").click(function() {

                    $('#topcontrol').click();

                    current_fs = $(this).parent();
                    next_fs = $(this).parent().next();

                    //Add Class Active
                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");

                    //show the next fieldset
                    next_fs.show();
                    //hide the current fieldset with style
                    current_fs.animate({ opacity: 0 }, {
                        step: function(now) {
                            // for making fielset appear animation
                            opacity = 1 - now;

                            current_fs.css({
                                'display': 'none',
                                'position': 'relative'
                            });
                            next_fs.css({ 'opacity': opacity });
                        },
                        duration: 500
                    });
                    setProgressBar(++current);
                });

                $(".previous").click(function() {

                    $('#topcontrol').click();

                    current_fs = $(this).parent();
                    previous_fs = $(this).parent().prev();

                    //Remove class active
                    $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

                    //show the previous fieldset
                    previous_fs.show();

                    //hide the current fieldset with style
                    current_fs.animate({ opacity: 0 }, {
                        step: function(now) {
                            // for making fielset appear animation
                            opacity = 1 - now;

                            current_fs.css({
                                'display': 'none',
                                'position': 'relative'
                            });
                            previous_fs.css({ 'opacity': opacity });
                        },
                        duration: 500
                    });
                    setProgressBar(--current);
                });

                function setProgressBar(curStep) {
                    var percent = parseFloat(100 / steps) * curStep;
                    percent = percent.toFixed();
                    $(".progress-bar")
                        .css("width", percent + "%")
                }

                $(".submit").click(function() {
                    return false;
                })

            });


            $(document).ready(function() {
                //Webcam check
                Webcam.attach("#webcam-test");

                var webcam_allowed = false;
                setTimeout(function() {
                    if (webcam_allowed == false) {
                        // Its been 10sec still webcam not allowed
                        $('#webcam_fail').removeClass('hidden');
                        $('#paarticipant_snap').css('display', 'none');
                    }
                }, 10000);

                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        webcam_allowed = true;
                        // webcam is available
                        // $('#verify_webcam').prop('disabled', false);
                        //setTimeout(function() { $('#verify_webcam').click(); }, 500);
                    })
                    .catch(function(err) {
                        // webcam is not available
                        $('#verify_webcam').prop('disabled', true);
                    });
            });
            //Microphone Check
            $('#verify_webcam').click(function() {
                var mic_allowed = false;
                setTimeout(function() {
                    if (mic_allowed == false) {
                        // Its been 10sec still mic not allowed
                        $('#mic_fail').removeClass('hidden');
                    }
                }, 10000);
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function(stream) {
                        mic_allowed = true;
                        // mic is available
                        $('#verify_mic').prop('disabled', false);
                        setTimeout(function() { $('#verify_mic').click(); }, 500);
                    })
                    .catch(function(err) {
                        // mic is not available
                        $('#verify_mic').prop('disabled', true);
                    });
            });
            //Desktop Notification Check
            if (enableDeskNotify == 1) {
                $('#verify_mic').click(function() {
                    var noti_allowed = false;
                    setTimeout(function() {
                        if (noti_allowed == false) {
                            // Its been 10sec still notification not allowed
                            $('#notification_fail').removeClass('hidden');
                        }
                    }, 10000);

                    function createNotification(title, text, icon) {
                        const noti = new Notification(title, {
                            body: text,
                            icon
                        });
                        noti.onclick = function(event) {

                        }
                    }
                    if (Notification.permission === "granted") {
                        noti_allowed = true;
                        // notification is available
                        $('#verify_noti').prop('disabled', false);
                        setTimeout(function() { $('#verify_noti').click(); }, 500);
                        createNotification('Chat  Message', 'Desktop Notification Enabled', $(' head > link:nth-child(2)').attr('href'));
                    } else {
                        Notification.requestPermission(permission => {
                            if (permission === 'granted') {
                                noti_allowed = true;
                                // notification is available
                                $('#verify_noti').prop('disabled', false);
                                setTimeout(function() { $('#verify_noti').click(); }, 500);
                                createNotification('Chat Message', 'Desktop Notification Enabled', $(' head > link:nth-child(2)').attr('href'));
                            } else {
                                // notificaton is not available
                                $('#verify_noti').prop('disabled', true);
                            }
                        });
                    }
                });
            }
            //Screenshare Check
            $('#startScreenShare').click(function() {
                var screen_allowed = false;
                setTimeout(function() {
                    if (screen_allowed == false) {
                        // Its been 10sec still screen not allowed
                    }
                }, 6000);
                navigator.mediaDevices.getDisplayMedia({
                    video: true
                }).then(screenStream => {
                    screen_allowed = true;
                    $('#verify_screenshare').prop('disabled', false);
                    $('#verify_screenshare').click();
                }).catch(function(error) {
                    $('#verify_screenshare').prop('disabled', true);
                });
            });
        }
    };
});
define('block_coursetimer/monitor', ['jquery'], function($) {
    return {
        webcam: function(args) {
            /*  Track event of webcam allowed every half a second 
	            Invoke this at last once all validations are done and user is good to go */

            CONFIG = args;
            var rootPath = M.cfg.wwwroot;
            var courseid = CONFIG.courseid;
            var userid = CONFIG.userid;
            var webcamlock = parseInt(CONFIG.webcamlock);
            var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
            var mediaPrefix = 'coursetimer_' + 'deviceID' + "_";
            var startTime = parseInt(localStorage.getItem(storagePrefix + "startTime"), 10);
            var closeTime = parseInt(localStorage.getItem(storagePrefix + "closeTime"), 10);
            var completed = parseInt(localStorage.getItem(storagePrefix + "completed"), 10);
            var currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10);

            var camoncheck = 0;
            var camoffcheck = 1;
            var oncount = 0;
            var offcount = 0;

            // Check every 5second whether user has started the attempt
            var refreshIntervalId = setInterval(function() {
                startTime = parseInt(localStorage.getItem(storagePrefix + "startTime"), 10);
                if (!Number.isNaN(startTime) && startTime != 0) {
                    startMonitoring();
                    clearInterval(refreshIntervalId);
                }
            }, 5000);

            //Log webcam on / off action


            // Once started monitoring process will be invoked
            function startMonitoring() {
                closeTime = parseInt(localStorage.getItem(storagePrefix + "closeTime"), 10);
                completed = parseInt(localStorage.getItem(storagePrefix + "completed"), 10);
                currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10);
                var constraints='';

                var audiodevice = localStorage.getItem(mediaPrefix + "audio");
                var videodevice = localStorage.getItem(mediaPrefix + "video");
                if(videodevice && audiodevice){
                    constraints = {
                        audio: {deviceId: audiodevice ? {exact: audiodevice} : undefined},
                        video: {deviceId: videodevice ? {exact: videodevice} : undefined}
                    };
                } else{
                    constraints = { audio: true, video: true };
                }

                // If the user has started, the user closetime is not reached yet, doesnt have any completed status DO MONITORING
                if (startTime != 0 && closeTime > currentTime && completed == 0) {
                    // check for webcam availability every second
                    navigator.mediaDevices.getUserMedia(constraints)
                    .then(function(stream) {
                        //Got the permission. Lets log it if not already done
                        oncount++;
                        offcount = 0;
                        if (camoncheck) {
                            //To handle frequent issue of webcam off, on
                            if( oncount > 3 ){
                                camoncheck = 0;
                                camoffcheck = 1;
                                $.ajax({
                                    type: "POST",
                                    url: rootPath + "/blocks/coursetimer/log_ajax.php?action=webcamon&courseid=" + courseid,
                                    success: function(response) {
                                        //do stuff here				          		  		
                                    }
                                });
                            }
                        }
                    })
                    .catch(function(err) {
                        //Permission Denied. Lets log it if not already done.
                        offcount++;
                        oncount = 0;
                        if (camoffcheck) {
                            //To handle frequent issue of webcam off, on
                            if( offcount > 3 ){
                                camoffcheck = 0;
                                camoncheck = 1;
                                $.ajax({
                                    type: "POST",
                                    url: rootPath + "/blocks/coursetimer/log_ajax.php?action=webcamoff&courseid=" + courseid,
                                    success: function(response) {
                                        //do stuff here				          		  		
                                    }
                                });
                            }

                            //If webcam lock is enabled, lets handle that too..
                            if (webcamlock) {
                                //lock the user
                                $.post(rootPath + "/blocks/coursetimer/proctoring_ajax.php", { action: 'lock', courseid: courseid })
                                .done(function(result) {
                                    location.reload();
                                });
                            }
                        }
                    })
                    .finally(function( ){
                        //Let wait for 2 seconds and call the method again
                        setTimeout(startMonitoring, 2000);
                    });
                }
            }
        },
        screenshare: function(args) {
            CONFIG = args;
            var rootPath = M.cfg.wwwroot;
            var courseid = CONFIG.courseid;
            var userid = CONFIG.userid;
            var screensharelock = parseInt(CONFIG.screensharelock);
            var storagePrefix = 'coursetimer_' + courseid + "_" + userid + "_";
            var startTime = parseInt(localStorage.getItem(storagePrefix + "startTime"), 10);
            var closeTime = parseInt(localStorage.getItem(storagePrefix + "closeTime"), 10);
            var completed = parseInt(localStorage.getItem(storagePrefix + "completed"), 10);
            var currentTime = parseInt(localStorage.getItem(storagePrefix + "currentTime"), 10)

            var camoncheck = 1;
            var camoffcheck = 1;

            if (startTime != 0 && closeTime < currentTime && completed == 0) {}
        }
    };
});
define('block_emailer/script', ['jquery'], function($) {
    return {
        init: function() {
        	//console.log("EMAILER BLOCK");
        	
        	var url=  $(location).attr('href');
        	
        	if( url.includes('/blocks/emailer/choose_template.php') ){
        		
            	var $templatename = $('#id_name'); 
            	var $subject =  $('#id_subject'); 
            	var $query = $('#id_query');
            	var $template =  $('#id_template');
        		
            	

            	$templatename.change(function(){
            		console.log("EMAILER BLOCK");
                	var $temp = $templatename.val();

            	    $.post( "ajax.php", { choose_template: $temp })
      		  		.done(function( result ) {
      		  			var response = JSON.parse(result);
	      		  		$subject.val(response.subject);
	      		  		$query.val(response.query);
	      		  		$template.val( response.template);
      		  		});
            		
            	}).change();
        		
        	}
        	
        	if(url.includes('/blocks/emailer/index.php')){
        		
        		$(".class_send_image").on('click',function () {
        			  var templateId = this.getAttribute('urltogo');
        			  $.post( "ajax.php", { template : templateId })
        		  		.done(function( result ) {
						result = result.split("#");
					   	var response = JSON.parse(result[1]);
        		  			alert(response.success);
        		  		});
        			});
        		
        		 $('.class_trash_image').on('click', function() {	 
      			  var templateId = this.getAttribute('urltogo');
      			  $.post( "ajax.php", { remove : templateId })
      		  	 	.done(function( result ) {
      		  	 		var response = JSON.parse(result);
      		  	 		alert(response.success);
					location.reload(true);
      		  	 	});
      			});
        		
        	}
        }
    };
});

define('block_faq/script', ["jquery"],function(e){return{init:function(){var t=e(location).attr("href"),a=(M.cfg.wwwroot,[]),o=[];if(t.includes("blocks/faq/faq.php")){var n=e("#id_content");e("#id_question").css("width","900px"),e("#id_question").css("height","75px"),n.load("ajax.php","choice=content")}if(t.includes("blocks/faq/edit.php")){n=e("#id_content");var i=e("#id_question"),d=e("#id_frm .fitem:nth-child(2)");d.removeClass("show"),d.addClass("hidden"),n.load("ajax.php","choice=content"),n.change(function(){var t=e("#id_content option:selected").text();if("Select"===t)console.log(t),d.removeClass("show"),d.addClass("hidden");else{d.removeClass("hidden"),d.addClass("show");var a=Number(n.val().trim());i.load("ajax.php","question=question&contentid="+a)}}),i.change(function(){var t=Number(i.val().trim());e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/faq/ajax.php",data:{answer:"answer",questionid:t}}).done(function(t){"failure"!==t?e("#id_detail_editoreditable").html(t):e("#id_detail_editoreditable").html("")})})}e("document").ready(function(){(t.includes("blocks/faq/index.php")||t.includes("blocks/faq/search.php"))&&(e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/faq/ajax.php",data:{search:"search"}}).done(function(t){data=e.parseJSON(t),e.each(data,function(e,t){a.push(t.question+"-"+t.id),o.push({id:t.id,name:t.question})}),function(t,a){var o;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),o>=e.length&&(o=0),o<0&&(o=e.length-1),e[o].classList.add("autocomplete-active")}function i(e){for(var a=document.getElementsByClassName("autocomplete-items"),o=0;o<a.length;o++)e!=a[o]&&e!=t&&a[o].parentNode.removeChild(a[o])}t.addEventListener("input",function(n){var d,s,c,r=this.value;if(i(),!r)return!1;for(o=-1,(d=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),d.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(d),c=0;c<a.length;c++)res=a[c].split("-"),res[0].toLowerCase().includes(r.toLowerCase())&&((s=document.createElement("DIV")).innerHTML=res[0].toLowerCase().replace(r.toLowerCase(),"<strong>"+r.toLowerCase()+"</strong>"),s.innerHTML+='<input type="hidden" value=" '+res[0].replace(/"/g,"&quot;")+' ">',s.innerHTML+="<input id='userId' type='hidden' value='"+res[1]+"'>",s.addEventListener("click",function(a){t.value=this.getElementsByTagName("input")[0].value,id=this.getElementsByTagName("input")[1].value,document.getElementById("faqsearch").value;var o=M.cfg.wwwroot+"/blocks/faq/search.php",n=e('<form action="'+o+'" method="post"><input type="text" name="id" value="'+id+'" /></form>');e("body").append(n),n.submit()}),d.appendChild(s))}),t.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(o++,n(t)):38==e.keyCode?(o--,n(t)):13==e.keyCode&&o>-1&&t&&t[o].click()}),document.addEventListener("click",function(e){i(e.target)})}(document.getElementById("faqsearch"),a)}),e("#faqsearchbutton").click(function(){if(0!=id){document.getElementById("searchName").value;var t=M.cfg.wwwroot+"/blocks/faq/search.php",a=e('<form action="'+t+'" method="post"><input type="text" name="id" value="'+id+'" /></form>');e("body").append(a),a.submit()}}),e("#faqsearch").keypress(function(t){if(13==t.keyCode){var a=e("#faqsearch").val();if(""!=a&&0!=id){document.getElementById("faqsearch").value;var n=M.cfg.wwwroot+"/blocks/faq/search.php",i=e('<form action="'+n+'" method="post"><input type="text" name="id" value="'+id+'" /></form>');e("body").append(i),i.submit()}else if(""!=a&&0==id){for(var d=0;d<o.length;d++)if(o[d].name.toUpperCase()===a.toUpperCase()){id=o[d].id;break}if(0!=id){n=M.cfg.wwwroot+"/blocks/faq/search.php",i=e('<form action="'+n+'" method="post"><input type="text" name="id" value="'+id+'" /></form>');e("body").append(i),i.submit()}else{n=M.cfg.wwwroot+"/blocks/faq/search.php",i=e('<form action="'+n+'" method="post"><input type="text" name="id" value="'+id+'" /></form>');e("body").append(i),i.submit()}}else location.replace(M.cfg.wwwroot+"/blocks/faq/search.php")}}))})}}});
define('block_fn_mentor/all_reviews', ['jquery'], function($) {

return {
init: function() {
var url=  $(location).attr('href');
var rootPath = M.cfg.wwwroot;
$( document ).ready(function() {
$("#filtermentorsfeedback").click( function() {
   var mentorid = $('#fn_mentor_feedback_smeid option:selected').text();
   var bu = $('#fn_mentor_feedback_bu option:selected').text();
   var smegrade = $('#fn_mentor_feedback_smegrades option:selected').text();
   var cohort = $('#fn_mentor_feedback_cohorts option:selected').text();
   var lp = $('#fn_mentor_feedback_lp option:selected').text();
   var ctype = $('#fn_mentor_feedback_ctypes option:selected').text();
   var fb_rating= $('#fn_mentor_feedback_rating option:selected').val();
   var reporttype = $('input[name="mentor_report"]:checked').val();

   if ( ! $(".fnmentorfeedbackreport").is(':checked') ) {
       alert("Kindly provide report type");
}

   else{ 
if( (mentorid =='Select') && (bu =='Select') && (smegrade =='Select') && (cohort =='Select') && (lp =='Select') && (ctype =='Select') && (fb_rating =='Select') ) {
alert("Kindly provide any one filter");
}
else {
	if(reporttype == 'detailedreport') {

	 $.ajax({
         method: "GET",
         url: M.cfg.wwwroot + '/blocks/fn_mentor/all_mentors_reviews_ajax.php',
         data: {"action" : "get_report","reporttype" : reporttype,"mentorid" : mentorid,"bu" : bu, "smegrade" : smegrade, "cohort" : cohort, "lp" : lp, "ctype" : ctype, "fb_rating" : fb_rating}
     }).done(function(response) {
    	 var data = JSON.parse(response);
         var userdata =  JSON.parse(data.userData);
         DataTable_detailed.clear().draw();
         DataTable_detailed.rows.add(userdata).draw();
         
         $('#mentorfeedback_detailed_div').removeAttr('hidden');
         $('#mentorfeedback_summary_div').attr("hidden",true);
     });
}
	
	else if(reporttype == 'summaryreport') {

		 $.ajax({
	         method: "GET",
	         url: M.cfg.wwwroot + '/blocks/fn_mentor/all_mentors_reviews_ajax.php',
	         data: {"action" : "get_report","reporttype" : reporttype,"mentorid" : mentorid,"bu" : bu, "smegrade" : smegrade, "cohort" : cohort, "lp" : lp, "ctype" : ctype, "fb_rating" : fb_rating}
	     }).done(function(response) {
	    	 var data = JSON.parse(response);
	         var userdata =  JSON.parse(data.userData);
	         DataTable_detailed.clear().draw();
	         DataTable_detailed.rows.add(userdata).draw();
	         
	         $('#mentorfeedback_summary_div').removeAttr('hidden');
	         $('#mentorfeedback_detailed_div').attr("hidden",true);

	     });
	}
	
}

}
});

$("#removefiltermentorsfeedback").click( function() {
    $('#fn_mentor_feedback_smeid').prop('selectedIndex',0);
    $('#fn_mentor_feedback_bu').prop('selectedIndex',0);
    $('#fn_mentor_feedback_smegrades').prop('selectedIndex',0);
    $('#fn_mentor_feedback_cohorts').prop('selectedIndex',0);
    $('#fn_mentor_feedback_lp').prop('selectedIndex',0);
    $('#fn_mentor_feedback_ctypes').prop('selectedIndex',0);
    $('#fn_mentor_feedback_rating').prop('selectedIndex',0);
    $('input[name=mentor_report]').prop('checked',false);
    $('#mentorfbtable_summary').attr("hidden",true);
    $('#mentorfbtable_detailed').attr("hidden",true);


});

});
}
};
});
    define('block_fn_mentor/conversation', ['jquery', 'core/templates'], function($, templates) {

        return {

            init: function() {
                // $('[data-userid]').click(function() {
                $(document).on('click', '.mentors[data-userid]', function() {
                    var userId = $(this).data('userid');
                    var ismentor = $(this).data('ismentor');
                    var onlyopen = $(this).data('onlyopen')
                    var sentitem = $(this).data('sentitem');
                    var mentor = $(this).data('mentor');

                    // Mentor to mentee conversation
                    if (typeof sentitem == 'undefined') {
                        sentitem = false;
                    } else {
                        sentitem = true;
                    }

                    // console.log(onlyopen)
                    if (typeof onlyopen == 'undefined') {
                        $('.list-group-item.mentors.active').removeClass('active')
                    } else {
                        $(this).parent().find('.active').removeClass('active')
                    }
                    $(this).addClass('active')

                    $.post("/blocks/fn_mentor/ajax_oneonone.php", {
                        "action": "conversation",
                        "mentorid": $(this).data('userid'),
                        "onlyopen": (onlyopen != false),
                        "sentitem": sentitem
                    }, function(data) {
                        // console.log(data)
                        if (sentitem) {
                            data.simpleview = (onlyopen != false)
                        } else {
                            data.onlyopen = (onlyopen != false)
                        }

                        templates.render('block_fn_mentor/conversation_block', data).done(function(html, js) {
                            $('#conversationBlock').replaceWith(html);
                            templates.runTemplateJS(js);

                            if (ismentor == '') $('#FnMentor-isMentor').hide()
                        })
                    })
                })

                $(document).on('click', '[data-cohortid]', function() {
                    var cohortid = ($(this).data('cohortid') != '') ? $(this).data('cohortid') : null;
                    console.log(cohortid)
                    console.log(($(this).data('cohortid') != ''))
                    $.post('/blocks/fn_mentor/ajax_oneonone.php', {
                        action: 'filtermenteeslist',
                        cohortid: cohortid,
                    }, (data) => {
                        // console.log(data)
                        templates.render('block_fn_mentor/conversation_mentees', data).done(function(html, js) {
                            $('#conversationMentees').html(html);
                            templates.runTemplateJS(js);
                            console.log($('[data-userid]')[0])
                            $('.mentors[data-userid]')[0].click()
                        })
                    })
                })

                $(document).on('click', '[data-filter-mentors]', function() {
                    var filterby = ($(this).data('filter-mentors') != '') ? $(this).data('filter-mentors') : null;
                    console.log(filterby)
                    console.log(($(this).data('filter-mentors') != ''))
                    $.post('/blocks/fn_mentor/ajax_oneonone.php', {
                        action: 'filtermentorslist',
                        filterby: filterby,
                    }, (data) => {
                        // console.log(data)
                        templates.render('block_fn_mentor/conversation_mentors', data).done(function(html, js) {
                            $('#conversationMentees').html(html);
                            templates.runTemplateJS(js);
                            console.log($('[data-userid]')[0])
                            $('.mentors[data-userid]')[0].click()
                        })
                    })
                })

                $(document).on('click', '.mark_as_favourite', function() {
                    if ($(this).hasClass('fa-star-o')) {
                        $(this).removeClass('fa-star-o').addClass('fa-star').attr('title', 'Remove Favourite')
                    } else {
                        $(this).removeClass('fa-star').addClass('fa-star-o').attr('title', 'Mark as Favourite')
                    }
                    $.post("/blocks/fn_mentor/ajax_oneonone.php", {
                        "action": "markasfavourite",
                        "mentorid": $(this).data('mentorid')
                    }, (data) => {
                        // console.log(data)
                    })
                })



                $(document).on('click', '.like-question', function() {
                    var actionId = $(this).data('action-id')
                    $.post('/blocks/fn_mentor/ajax_oneonone.php', {
                        action: 'likequestion',
                        ticketid: actionId,
                    }, (data) => {
                        if ($(this).hasClass('text-success')) {
                            $(this).attr('title', 'Like Question')
                            $(this).removeClass('text-success');
                            $(this).find('.fa-thumbs-up').addClass('fa-thumbs-o-up text-muted').removeClass('fa-thumbs-up')
                        } else {
                            $(this).attr('title', 'Remove Like Question')
                            $(this).addClass('text-success');
                            $(this).find('.fa-thumbs-o-up').addClass('fa-thumbs-up').removeClass('fa-thumbs-o-up text-muted')
                        }
                    })
                })

                $(document).on('click', '.conversation-rating', function() {
                    var rating = $(this).data('rating')
                    var actionId = $(this).data('action-id')
                    var mentorid = $(this).data('mentor-id')
                    var ismentor = $(this).data('ismentor')

                    if (typeof ismentor == 'undefined') {
                        $(this).parent().find('.conversation-rating').each(function() {
                            if ($(this).hasClass('fa-star')) $(this).removeClass('fa-star').addClass('fa-star-o')
                        })
                        for (var value = 1; value <= rating; value++) {
                            $(this).parent().find('[data-rating="' + value + '"]').removeClass('fa-star-o').addClass('fa-star')
                        }

                        $.post('/blocks/fn_mentor/ajax_oneonone.php', {
                            action: 'rateconversation',
                            mentorid: mentorid,
                            ticketid: actionId,
                            rating: rating
                        }, (data) => {
                            // console.log(data)
                            if ($('.conversation-rating-block-' + actionId + ' .add-more-reply').length == 1) {
                                $('.conversation-rating-block-' + actionId + ' .add-more-reply').next().removeClass('border-top').removeClass('pt-3')
                                $('.conversation-rating-block-' + actionId + ' .add-more-reply').remove()
                            }
                        })
                    }
                })
            }
        };
    });
define('block_fn_mentor/timesheet', ['jquery'], function($) { 
	return { 
		init: function( max_hrs ) {
			var url=  $(location).attr('href');
			var remainingtime = max_hrs;
			$( document ).ready(function() {
				// admin search
				$("#downloadmentortimesheet").click( function() {
					
					var TableData;
					TableData = storeTblValuesEdit();
					var data = JSON.stringify(TableData);
					//var Title = data.replace("&", "_");
					
					var rootPath = M.cfg.wwwroot;
					location.replace(rootPath+"/blocks/fn_mentor/mentorstimesheetreport.php?tabledatas="+data);
					 
			    });
				
				function storeTblValuesEdit()  {
		             var TableData = new Array();
		             $('#mentortimeetstable tr').each(function(row, tr){ 
		            	  
		            		 TableData[row]={ 
		            				       "id":$(tr).find('td:eq(0)').text().replace("&", "***"),
		            	               "smeid": $(tr).find('td:eq(1)').text().replace("&", "***"),
		            	                    "smename" : $(tr).find('td:eq(2)').text().replace("&", "***"),
		            	                    "cohortname" : $(tr).find('td:eq(3)').text().replace("&", "***"),
		            	                    "date" : $(tr).find('td:eq(4)').text().replace("&", "***"),
		            	                    "hours" : $(tr).find('td:eq(5)').text().replace("&", "***"),
		            	                    "skill" : $(tr).find('td:eq(6)').text().replace("&", "***"),
		            	                    "ctype" : $(tr).find('td:eq(7)').text().replace("&", "***"),
		            	                    "sl" : $(tr).find('td:eq(8)').text().replace("&", "***"),
		            	                    "track" : $(tr).find('td:eq(9)').text().replace("&", "***"),
		            	                 } 
		            	  
		              }); 
		            	
		             
		            TableData.shift(); 
		            TableData= JSON.stringify(TableData);
		            return TableData;
		        }
				
				//pop-up
				var addnewtimesheet =
					' <div id="timesheet_add" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
					' <div class="modal-dialog" style="max-width:800px">' +
					' <div class="modal-content" >' +
					' <div class="modal-headers" style="background: #0033a0;height: 50px;">' +
					' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;margin-top: 10px;color: white;"> <strong>Timesheet </strong> </div> ' +
					' <div class="modal-body" >' +
					'<div id="fn_mentor_cohort_div" hidden><label><b>Cohort Details : </b></label></div>'+
					'<table id ="fn_mentor_timesheet_cohort_details" style="width: 100%;" class="table">'+
					'<tbody>'+
					'</tbody>'+
					'</table>'+
					'<div id="fn_mentor_coach_div" hidden><label><b>Coach Details : </b></label></div>'+
					'<table id ="fn_mentor_timesheet_coach_details" style="width: 100%;" class="table">'+
					'<tbody>'+
					'</tbody>'+
					'</table>'+
					'<div id="fn_mentor_sme_div" hidden></div>'+
					'<table id ="mentor_timesheet_label" style="width: 100%;" class="table table-borderless">'+
					'<tbody>'+
					'</tbody>'+
					'</table>'+
					'<div id="fn_mentor_error_div"></div>'+
					' <div class="modal-footer">'+
					' <button type="button" class="btn btn-info" id="new_table_add" aria-expanded="false">Add</button>'+
					' <button type="button" class="btn btn-info" id="new_table_cancel" aria-expanded="false" data-dismiss="modal">Cancel</button>'+
					' </div>'+
					' </div>'+
					' </div></div></div>';
				$("#page-header").append(addnewtimesheet);
				
				$("#mentortimesheetdiv").click( function() {
					
					$("#selectcohort").load('timesheetajax.php', 'loadcohorts');        		
	        		$("#timesheet_add").modal("show");
					
						 
			    });
				
				$("#selectcohort").change(function() {
					
					 $cohort_name = $('#selectcohort option:selected').text();
					 $cohortid = $('#selectcohort option:selected').val(); 
					 if($cohortid !== '') { 
						 $.ajax({
			 					method: "GET",
			 					url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
			 					data: {"add_cohort_details" : "add_cohort_details", "cohortid" : $cohortid },
	                            success: function(response){
	                                       var responsedata = $.parseJSON(response);
	                                       var tablerow='';
	                                       var tablerow_coach ='';
	                                       var tablerow_cohort = '';
	                                      $.each(responsedata, function(key, value) {
	                                    	  var today = (new Date()).toISOString().split('T')[0];
	                                    	    
	                                    	    tablerow_cohort += '<tr id="count"><td style="width: 50%;"># of GenC / interns Mapped</td><td style="width: 50%;">'+value.count+'</td></tr>'+
												'<tr id="csl"><td style="width: 50%;">Cohort SL</td><td style="width: 50%;">'+value.cohortsl+'</td></tr>'+
												'<tr id="track"><td style="width: 50%;">Cohort Curriculum Track</td><td style="width: 50%;">'+value.track+'</td></tr>'+
												'<tr id="type"><td style="width: 50%;">Cohort Type</td><td style="width: 50%;">'+value.ctype+'</td></tr>'+
												'<tr id="status"><td style="width: 50%;">Cohort Current Status</td><td style="width: 50%;">'+value.status+'</td></tr>';
	                                    	    
	                                    	    tablerow_coach = '<tr id="coachid"><td style="width: 50%;">Coach ID</td><td style="width: 50%;">'+value.coachid+'</td></tr>'+
												'<tr id="coachname"><td style="width: 50%;">Coach Name</td><td style="width: 50%;">'+value.coachname+'</td></tr>';
												if(value.trainer) {
													$('#fn_mentor_sme_div').append('<label><b>Trainer Details : </b></label>');
													tablerow += 
														'<tr id="smeid"><td style="width: 50%;">Trainer ID</td><td style="width: 50%;">'+value.smeid+'</td></tr>'+
														'<tr id="smename"><td style="width: 50%;">Trainer name</td><td style="width: 50%;">'+value.smename+'</td></tr>'+														
														'<tr id="mentoctypes"><td style="width: 50%;">Contribution Types</td><td style="width: 50%;"><select id = "mentorctypes"><option>Select contribution type</option>';													
													} else {
														$('#fn_mentor_sme_div').append('<label><b>SME Details : </b></label>');
	                                    	    tablerow += 
												'<tr id="smeid"><td style="width: 50%;">SME ID</td><td style="width: 50%;">'+value.smeid+'</td></tr>'+
												'<tr id="smename"><td style="width: 50%;">SME name</td><td style="width: 50%;">'+value.smename+'</td></tr>'+
												'<tr id="smegrade"><td style="width: 50%;">SME Grade</td><td style="width: 50%;">'+value.smegrade+'</td></tr>'+
												'<tr id="smesl"><td style="width: 50%;">SME SL</td><td style="width: 50%;">'+value.smesl+'</td></tr>'+
												'<tr id="mentoctypes"><td style="width: 50%;">Contribution Types</td><td style="width: 50%;"><select id = "mentorctypes"><option>Select contribution type</option>';
													}
	                                    	    var mentor_ctypes= value.mentorctypes.split(','); 
												$.each(mentor_ctypes, function(newkey, newvalue) {
													
													tablerow += '<option value="'+newvalue+'">'+newvalue+'</option>';
												})
					                           tablerow += '</select></td></tr>';
												
												$('#start-time').prop('max', today);
	                                      })
					                       
	                                       if($('#fn_mentor_timesheet_cohort_details tr').length !=0) {
					                    	   	$('#fn_mentor_timesheet_cohort_details tr').remove();
					                       }
					                       if($('#fn_mentor_timesheet_coach_details tr').length !=0) {
					                    	   	$('#fn_mentor_timesheet_coach_details tr').remove();
					                       }
					                       if($('#mentor_timesheet_label tr').length !=0) {
					                    	   	$('#mentor_timesheet_label tr').remove();
					                       }
					                      $('#alertlabel').remove();
	                                      $('#fn_mentor_cohort_div').removeAttr('hidden');
	                                      $('#timesheet_add').find('#fn_mentor_timesheet_cohort_details tbody').append(tablerow_cohort);
	                                      $('#fn_mentor_coach_div').removeAttr('hidden');
	                                      $('#timesheet_add').find('#fn_mentor_timesheet_coach_details tbody').append(tablerow_coach);
	                                      $('#fn_mentor_sme_div').removeAttr('hidden');
	                                      $('#timesheet_add').find('#mentor_timesheet_label tbody').append(tablerow);
			                            }
			 				}).done(function( response ) {	
			 					if(response === "success"){
			 				       console.log("true");
			 					}
			 				});
						 
					 }
					 
					
				});
				
				$(document).on("change","#mentorctypes",function() {
					$mentorctype = $('#mentorctypes option:selected').text();
					$cohortid = $('#selectcohort option:selected').val();
					var select = 'Select';
					if($mentorctype.indexOf(select) != -1) {
						$('#mentor_timesheet_label #mskills').remove();
                		//$('#mentor_timesheet_label #date').remove();
                	   	$('#mentor_timesheet_label #hours').remove();
                	   	$('#alertlabel').remove();
					}
					else {
						$.ajax({
	                        method: "GET",
	                        url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
	            			data: {"loadskills" : "loadskills","cohortid" : $cohortid ,"mentorctype" : $mentorctype},
	            			success: function(response){
	            				var responsedata = $.parseJSON(response);
	            				var tablerow='';
	            				 $.each(responsedata, function(key, value) {
	            					 tablerow +=
	            						 '<tr id="mskills"><td style="width: 50%;">Skills</td><td style="width: 50%;"><select id = "mentorskills"><option>Select skill</option>';
	            					       var mentor_skills= value.skills.split(','); 
											$.each(mentor_skills, function(newkey, newvalue) {
												
												tablerow += '<option value="'+newvalue+'">'+newvalue+'</option>';
											})
				                           tablerow += '</select></td></tr>';
	            				 })
	            				 if($('#mentor_timesheet_label #mskills').length !=0) {
						                    	   	$('#mentor_timesheet_label #mskills').remove();
						                    		//$('#mentor_timesheet_label #date').remove();
						                    	   	$('#mentor_timesheet_label #hours').remove();
						                    	   	//$('#mentor_timesheet_label #alertlabel').remove();
						         }
	            				 $('#alertlabel').remove();
	            				 $('#timesheet_add').find('#mentor_timesheet_label tbody').append(tablerow);
	            				 
	            			}
	                    });  
					}
					
					
					
				});
				
				$(document).on("change","#mentorskills",function() {
					$mskill = $('#mentorskills option:selected').text();
					$mentorctype = $('#mentorctypes option:selected').text();
					$cohortid = $('#selectcohort option:selected').val();
					var select = 'Select';
					if($mskill.indexOf(select) != -1) {
						//$('#mentor_timesheet_label #date').remove();
                	   	$('#mentor_timesheet_label #hours').remove();
                	   	$('#mentor_timesheet_label #alertlabel').remove();
					}
					else {
						var today = (new Date()).toISOString().split('T')[0];
						var tablerow='';
        				tablerow +=
   						   '<tr id="hours"><td style="width: 50%;">Contribution Hours</td><td style="width: 50%;"> Hrs <input type="number" id="c_hours" name="time" min="0" max="24" maxlength="2" style="width:50px;" required>&nbsp;mins <input type="number" id="c_mins" name="c_mins" min="0" max="59" maxlength="2" style="width:50px;" required></td></tr>';
   					   
        				 
        				 if($('#mentor_timesheet_label #date').length !=0) {
				                    	   	//$('#mentor_timesheet_label #date').remove();
				                    	   	$('#mentor_timesheet_label #hours').remove();
				                    	   	
				         }
        				 $('#alertlabel').remove();
        				 $('#timesheet_add').find('#mentor_timesheet_label tbody').append(tablerow);
					}
					
				});
			
				
				$(document).on("change","#mentor_timesheet_label tr:eq(6) td:eq(1) #start-time",function() { 
					$('#alertlabel').remove();
					var date = $('#mentor_timesheet_label tr:eq(6) td:eq(1) input').val();
					$.ajax({
                        method: "GET",
                        url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
                        data: {"calculate_time" : "calculate_time","date" : date}
                    }).done(function(response) {
                    	remainingtime = response;
                    	
                    });   				
			    });
				
				
				$(document).on("click","#new_table_cancel",function() { 
                    location.reload();   				
			    });
				
				$(document).on("click","#new_table_add",function() {
					var arrData=[];
					var cohort_name = $('#sme_cohortname').text();
					var date = $('#start-time').text();
					var hours = $('#c_hours').val();
					var mins = $('#c_mins').val();
					var skill = $('#mentorskills option:selected').text();
					var ctype = $('#mentor_ctype').text();
					var others_hours = $('#others_c_hours').val();
					var others_mins = $('#others_c_mins').val();
					var c_mins = parseInt(mins);
					var c_hours = parseInt(hours);
					var mins_to_hours =  c_mins/60;
					var hours_to_mins = c_hours*60;
					
					var hours_of_distribution = c_hours + mins_to_hours;
					var mins_of_distribution = c_mins+hours_to_mins;
					
					if(isNaN(hours_of_distribution) && isNaN(mins_of_distribution)) {
						hours_of_distribution = 0; mins_of_distribution = 0;
					}
					
					var totalhours = c_hours + mins_to_hours;
					var totalmins = c_mins+hours_to_mins;
					var flag = 0;
					if(ctype === 'Trainer') {
						var mentor_skills = new Array();
					  	$('input[name="metor_skill_checkbox"]:checked').each(function() {
	                          mentor_skills.push(this.value);
	                    });
                        var separator = ',';
				        skill = mentor_skills.join(separator); 

						if($('#Others_id').is(":checked")) {
							flag = 1;
							if(others_hours == '' && others_mins == '') {
								flag = 2;
							}
							else {
								var others_c_mins = parseInt(others_mins);
								var others_c_hours = parseInt(others_hours);
								
								var others_mins_hours = others_c_mins/60;
								var others_hours_to_mins = others_c_hours*60;
								var others_hours_of_distribution = others_c_hours + others_mins_hours;
								var others_mins_of_distribution = others_c_mins+others_hours_to_mins;
								
								if(isNaN(totalhours) && isNaN(totalmins)) {
									totalhours = 0; totalmins = 0;
								}
								
								totalhours = totalhours + others_c_hours + others_mins_hours;
								totalmins = totalmins + others_c_mins+others_hours_to_mins;
								
							}
						}
						
					}
					
					
				   if(flag == 0 && (totalhours == 0 && mins_of_distribution == 0)) { 
				       tablerow = '<label id="alertlabel"><font color="red">Please enter valid contribution hours</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
				   }
					else if (flag == 0 &&  ( isNaN(hours_of_distribution) && isNaN(mins_of_distribution))){
						 tablerow = '<label id="alertlabel"><font color="red">Please enter valid contribution hours</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
					}
				   else if(skill === 'Select Skill' || skill === '') {
							tablerow = '<label id="alertlabel"><font color="red">Please Select Skill</font></label>';
							
							if(('#alertlabel').length != 0 ) {
								$('#alertlabel').remove();
							}
							$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
				   }
	               else if(totalhours == 0 || isNaN(totalhours) || isNaN(totalmins)) {  
						tablerow = '<label id="alertlabel"><font color="red">Please enter valid contribution hours</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
					}
					else if (totalhours > remainingtime || totalmins > 7080 || c_mins > 59) {
						tablerow = '<label id="alertlabel"><font color="red">The total hours contributed for the day cannot be greater than ' + max_hrs + ' hrs.</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
						
					}
					else if(flag == 2) {
						tablerow = '<label id="alertlabel"><font color="red">Kindly provide contributed hours for others skills.</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
					}
					else {
						$.ajax({
	                        method: "GET",
	                        url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
	                        data: {"add_timesheet" : "add_timesheet","cohort_name" : cohort_name,"date" : date,"hours" : hours_of_distribution, "skill" : skill, "ctype" : ctype,"mins" :mins_of_distribution,"other_skills_hours" :others_hours_of_distribution,"other_skills_mins" :  others_mins_of_distribution}
	                    }).done(function(response) {
	                    	var error = 'exceeding';
	                    	var error1 = 'loggedin';
	                    	var error2 = 'Exceeded';
	                    	var error3 = 'wrong';
	                    	var ctypeerror = '****';
	                    	if(response.indexOf(error) != -1){
	                    		if(response.indexOf(ctypeerror) != -1) {
	                    			var split = response.split("****");
	                    			tablerow ='<label id="alertlabel"><font color="red">You have already logged your contribution as '+ split[1] +' for the same day.</font></label>';
	                    			if(('#alertlabel').length != 0 ) {
		    							$('#alertlabel').remove();
		    						}
		                    		$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		}
	                    		else {
	                    			tablerow = '<label id="alertlabel"><font color="red">The total hours contributed for the day cannot be greater than ' + max_hrs + ' hrs.</font></label>';
		                    		if(('#alertlabel').length != 0 ) {
		    							$('#alertlabel').remove();
		    						}
		                    		$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		}
	                    		
	                    	}
	                    	else if(response.indexOf(error1) != -1) {
	                    		tablerow = '<label id="alertlabel"><font color="red">You are logging time sheet for future date</font></label>';
	                    		if(('#alertlabel').length != 0 ) {
	    							$('#alertlabel').remove();
	    						}
	                    		$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		
	                    	}
	                    	else if(response.indexOf(error2) != -1) {
	                    		tablerow = '<label id="alertlabel"><font color="red">You have exceeded the time limit.</font></label>';
	                    		if(('#alertlabel').length != 0 ) {
	    							$('#alertlabel').remove();
	    						}
	                    		$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		
	                    	}
	                    	else if(response.indexOf(error3) != -1) {
	                    		var spliterror = response.split(':');
	                    		tablerow = '<label id="alertlabel"><font color="red">You have provided wrong date. </font><br><b> Your contribution dates are </b>'+spliterror[1]+'</label>';
	                    		if(('#alertlabel').length != 0 ) {
	    							$('#alertlabel').remove();
	    						}
	                    		$('#timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		
	                    	}
	                    	else {
	                    		location.reload();
	                    	}
	                    	
	
	                    });
					}
					
				}); 
				
				 $(".fn_mentor_ch").on("keypress keyup blur", function(event) {
				     $(this).val($(this).val().replace(/[^0-9\,]/g, ''));
					  if ((event.which != 58 ) && (event.which < 48 || event.which > 57)) {
					    event.preventDefault();
					  }
                });
				
				$(document).on('click', '.mentor_timesheet_edit', function() {
					  var id = this.id; 
					  var rowid = id.split("-");
					  var mentorid = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(1)').text(); 
					  var cohort = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(2)').text();
					  var date = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(5)').text();
					  var ctype = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(3)').text();
					  var old_hours = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(6)').text();
			          var split_time = old_hours.split(":");
				      var new_hours = parseInt(split_time[0]);
					  var new_mins = parseInt(split_time[1]);
			          var others_skills_hours = '';
			
			          $.ajax({
		 					method: "GET",
		 					url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
		 					data: {"add_mentors_ctypes" : "add_mentors_ctypes", "cohort" : cohort,"smeid" : mentorid,"date" :date, "ctype" : ctype },
                          success: function(response){
                        	  var responsedata = $.parseJSON(response);
              				  var input_hours_others = '';
                              var removeSkill = $('#'+rowid[0]+'_skills').text();
							  var skill = '';
					
                              if(ctype === 'Trainer') {
		                          var removeSkill = $('#'+rowid[0]+'_skills').text();
	              			      var array_skills = removeSkill.split(",");
	              				  $.each(responsedata, function(key, value) { 
	              					
	                                  skill +='<div class="row">';
									  var mentor_skills= value.skills.split(','); 
												$.each(mentor_skills, function(newkey, newvalue) { 
													if(jQuery.inArray(newvalue, array_skills) !== -1) {
														skill += '<div id="'+newvalue+'_div" style="height:20px;margin-left: 10px;"><input type="checkbox" id="'+newvalue+'_id" class = "mentorskills" name="metor_skill_checkbox" value="'+newvalue+'" style="width:11px;height:11px;" checked>&nbsp;<label for="'+newvalue+'_id" style="font-size: 14px;">'+newvalue+'</label></div>';
													}
													else {
														skill += '<div id="'+newvalue+'_div" style="height:20px;margin-left: 10px;"><input type="checkbox" id="'+newvalue+'_id" class = "mentorskills" name="metor_skill_checkbox" value="'+newvalue+'" style="width:11px;height:11px;">&nbsp;<label for="'+newvalue+'_id" style="font-size: 14px;">'+newvalue+'</label></div>';
													}
													
													
												})
										skill += '</div>';
	  							        others_skills_hours = value.other_skills_hours;
                                        var skills_hours = value.skills_hours; 
                                        $('#'+rowid[0]+'_contributedhours').text(''); 
										var total_mins_other_skills = skills_hours*60;
                                        var hours = Math.floor(total_mins_other_skills / 60);          
										var minutes = total_mins_other_skills % 60; 
										minutes = Math.round(minutes);
					                    var input_hours = '<input type="number" id="old_c_hours" name="time" value="'+hours+'" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;: <input type="number" id="old_c_mins" name="c_mins" value="'+minutes+'" min="0" max="59" maxlength="2" style="width:50px;" required>';
					                    $('#'+rowid[0]+'_contributedhours').append(input_hours);
	              				    })
                                    
                              }
							
							 else if(ctype === 'Mentoring'){
								$('#'+rowid[0]+'_contributedhours').text('');  
								new_mins = Math.round(new_mins);
					            var input_hours = '<input type="number" id="old_c_hours" name="time" value="'+new_hours+'" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;: <input type="number" id="old_c_mins" name="c_mins" value="'+new_mins+'" min="0" max="59" maxlength="2" style="width:50px;" required>';
					            $('#'+rowid[0]+'_contributedhours').append(input_hours); 
			
								$.each(responsedata, function(key, value) {
								skill += 
  									 '<select id = "'+id+'_skillselect" class="mentorskillschange"><option value="'+removeSkill+'">'+removeSkill+'</option>';
		       					         var mentor_skills= value.skills.split(','); 
											$.each(mentor_skills, function(newkey, newvalue) {
												if(newvalue !== removeSkill) {
													skill += '<option value="'+newvalue+'">'+newvalue+'</option>';
												}
												
											})
		                          skill += '</select>';	
                               })
							}
							
							else {
								$('#'+rowid[0]+'_contributedhours').text('');  
								new_mins = Math.round(new_mins);
					            var input_hours = '<input type="number" id="old_c_hours" name="time" value="'+new_hours+'" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;: <input type="number" id="old_c_mins" name="c_mins" value="'+new_mins+'" min="0" max="59" maxlength="2" style="width:50px;" required>';
					            $('#'+rowid[0]+'_contributedhours').append(input_hours); 

								$.each(responsedata, function(key, value) {
									skill += 
	  									 '<select id = "'+id+'_skillselect" class="mentorskillschange"><option value="'+removeSkill+'">'+removeSkill+'</option>';
				       					      if(value.skills !== removeSkill) {
													skill += '<option value="'+value.skills+'">'+value.skills+'</option>';
											  }
												
			                        skill += '</select>';	
                               })
							}

              				if($('#'+rowid[0]+'_skillselect option').length !=1) {
	                    	   	$('#'+rowid[0]+'_skillselect option').remove();
	                        }
              				$('#'+rowid[0]+'_skills').text(''); 
              				$('#'+rowid[0]+'_skills').append(skill);
                           
                           if(ctype === 'Trainer') {
								  if($('#updatedtimesheet_table #'+rowid[0]+' td:eq(4)').find('#Others_id').is(":checked")) { 
										var other_skills_hours_trainer = others_skills_hours;
										if(other_skills_hours_trainer != '') { 
											var total_mins_other_skills = other_skills_hours_trainer*60;
											var hours = Math.floor(total_mins_other_skills / 60);          
											var minutes = total_mins_other_skills % 60;
											minutes = Math.round(minutes);
									        input_hours_others = '<br><br><div id ="others_skills_contributed_hours_trainer"><input type="number" id="old_c_hours_others" name="time" value="'+hours+'" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;: <input type="number" id="old_c_mins_others" name="c_mins" value="'+minutes+'" min="0" max="59" maxlength="2" style="width:50px;" required></div>';
					                         
										}
										$('#'+rowid[0]+'_contributedhours').append(input_hours_others);
									}
		                            
									else {
										input_hours_others = '<br><br><div id ="others_skills_contributed_hours_trainer" hidden><input type="number" id="old_c_hours_others" name="time" value="0" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;: <input type="number" id="old_c_mins_others" name="c_mins" value="0" min="0" max="59" maxlength="2" style="width:50px;" required></div>';
					                    $('#'+rowid[0]+'_contributedhours').append(input_hours_others);    
									}
                           }
                           
                               
                          }
		 				}).done(function( response ) {	
		 					if(response === "success"){
			 				       console.log("true");
			 					}
			 				});
				
					  
					  $(this).siblings('.mentor_timesheet_save').show();
					  $(this).hide();
					});
					
					
				    $(document).on("click","#Others_id",function() {
						if($('#Others_id').is(":checked")) {
								$('#others_skills_contributed_hours_trainer').removeAttr('hidden');
								$('#othershours').removeAttr('hidden');
								$('#old_c_hours_others').val('');
								$('#old_c_mins_others').val('');
								$('#others_c_hours').val('');
								$('#others_c_mins').val('');  
								$('#alertlabel').remove();
	                    }
	                            
	                    else {
								$('#others_skills_contributed_hours_trainer').attr('hidden',true);
								$('#old_c_hours_others').val('');
								$('#old_c_mins_others').val('');
								$('#othershours').attr('hidden',true); 
								$('#others_c_hours').val('');
								$('#others_c_mins').val('');
								$('#alertlabel').remove();
	                    }
                   
				    });
				
					$(document).on('click', '.mentor_timesheet_save', function() {
					    var id = this.id; 
						var rowid = id.split("-");
						var contributiontype = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(3)').text(); 
						var date = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(5)').text();
						var hours = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(6) #old_c_hours').val();
						var mins = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(6) #old_c_mins').val();
						var cohort = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(2)').text();
						var hours_new = hours+':'+mins;
						
						var other_skills_hours = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(6) #old_c_hours_others').val();
						var other_skills_mins = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(6) #old_c_mins_others').val();
						var hours_new_others = other_skills_hours+':'+other_skills_mins;
						
						var skill = ''; var totalhours = parseInt(0); var hours_others = ''; var hours_of_contribution = 0;
						var new_hours = 0;var new_mins = 0; var newflag = 0; var flag2 = 0; var flag3 = 0;
						if(contributiontype === 'Trainer') {
							  var mentor_skills = new Array(); 
							  $('input[name="metor_skill_checkbox"]:checked').each(function() {
									  mentor_skills.push(this.value);
										if(this.value != 'Others') {
											newflag = 1;
										}
							  });
							  var separator = ',';
							  skill = mentor_skills.join(separator);
					          
							  if($('#updatedtimesheet_table #'+rowid[0]+' td:eq(4)').find('#Others_id').is(":checked")) {
								    var split_time = hours_new_others.split(":"); 
									new_hours = parseInt(split_time[0]);
									new_mins = parseInt(split_time[1]);
									var mins_to_hours =  new_mins/60;
									totalhours = totalhours + new_hours + mins_to_hours; 
									hours_others = new_hours + mins_to_hours;
									if( (new_hours === '')  ||  (new_mins === '') || !(new_hours >= 0 && new_hours <= max_hrs) || !(new_mins >=0  && new_mins <=59)){
										flag2 = 1;
									}
									else if((new_hours == 0) && (new_mins == 0)) {
										flag2 = 1;
									}
									
				               }
							   if(newflag == 1) { 
									var split_time = hours_new.split(":"); 
									var new_hours = parseInt(split_time[0]);
									var new_mins = parseInt(split_time[1]);
									var mins_to_hours =  new_mins/60;
									if(flag2 == 1) {
										totalhours = parseInt(0);
									}
									totalhours = totalhours + new_hours + mins_to_hours;
									hours_of_contribution = new_hours + mins_to_hours;
									if( (new_hours === '')  ||  (new_mins === '') || !(new_hours >= 0 && new_hours <= max_hrs) || !(new_mins >=0  && new_mins <=59)){
										flag3 = 1;
									}
									else if((new_hours == 0) && (new_mins == 0)) {
										flag3 = 1;
									}
									
							   }
						}
					    else {
							    skill = $('#updatedtimesheet_table #'+rowid[0]+' td:eq(4) option:selected').val();
					            var split_time = hours_new.split(":"); 
								new_hours = parseInt(split_time[0]);
								new_mins = parseInt(split_time[1]);
								var mins_to_hours =  new_mins/60;
								totalhours = totalhours + new_hours + mins_to_hours;
								hours_of_contribution = new_hours + mins_to_hours;
								
					    }
					    
	                    if(skill === '' || skill.indexOf('Select') != -1) {
	                              alert("Please select skill");
                        }
                        else if( (new_hours === '')  ||  (new_mins === '') || !(new_hours >= 0 && new_hours <= max_hrs) || !(new_mins >=0  && new_mins <=59)){
                                    alert("Please enter valid contribution hours");
						}
						else if((new_hours == 0) && (new_mins == 0)) {
								    alert("Please enter valid contribution hours");
						}
						else if((totalhours === '') || !(totalhours >= 0 && totalhours <= max_hrs)) {
							alert("The total hours contributed for the day cannot be greater than " + max_hrs + "hrs.");
						}
						else if (flag2 == 1) {
							alert("Kindly provide contributed hours for others skills.");
						}
						else if(flag3 == 1) {
							alert("Please enter valid contribution hours");
						}
						else {
							  $.ajax({
									method: "GET",
									url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
									data: {"update_timesheet" : "update_timesheet","rowid" : rowid[0],"ctype" : contributiontype,"skill" : skill, "hours" : hours_of_contribution,"date" : date,"cohort" : cohort,"hours_others" : hours_others}
								}).done(function(response) {
									var error = 'exceeding';
									var error1 = 'loggedin';
									var ctypeerror = '****';
									if(response.indexOf(error) != -1){
						
										if(response.indexOf(ctypeerror) != -1) {
											var split = response.split("****");
											alert('You have already logged your contribution as '+ split[1] +' for the same day.');
										}
										else {
											alert("The total hours contributed for the day cannot be greater than " + max_hrs + "hrs.");
										}
										
									}
									
									else {
										
										if(contributiontype === 'Trainer') {
											var total_mins = totalhours*60;
											var hours = Math.floor(total_mins / 60);          
											var minutes = total_mins % 60;
											minutes = Math.round(minutes);
											$('input').each(function() {
												var content = $(this).val();  
												$(this).html(content);
												$(this).contents().unwrap();
											});
											var final_hours_mins = hours +':'+ minutes;
											$('#'+rowid[0]+'_contributedhours').text(''); 
											$('#'+rowid[0]+'_contributedhours').append(final_hours_mins); 
										}
										else {
											$('input').each(function() {
											var content = $(this).val();  
											$(this).html(content);
											$(this).contents().unwrap();
										  });
										}
										
										
										var editid = id.replace('save','edit');
										
										$('#'+id).hide();
										$('#'+editid).show();
										
										$('#'+rowid[0]+'_ctypes').empty();
										$('#'+rowid[0]+'_ctypes').text(contributiontype);
										$('#'+rowid[0]+'_skills').empty();
										$('#'+rowid[0]+'_skills').text(skill);
										
										setTimeout(function() {
											$('#'+editid).prop('disabled', true);
											$('#'+id).prop('disabled', true);
										},1800000);
										
									}
									
								});
						  }
					});
					
					/*-------------------------------------------------------*/
					
					$(document).on('click', '.mentor_timesheet_notapplicable', function() {
						var id = this.id; 
						var rowid = id.split("-");
						var recordid = this.value;
						if($('#'+rowid[0]+'-open').prop('disabled')) {
							$('#'+rowid[0]+'-open').prop('disabled',false);
							$.ajax({
								method: "GET",
		 					    url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
		                        data:{"update_notapplicable_status" : "update_notapplicable_status","status" : 0,"recordid" : recordid},
								success: function(response) {
									console.log("true");
								}
								
							});
						}
						else {
							$('#'+rowid[0]+'-open').prop('disabled',true);
							$.ajax({
								method: "GET",
		 					    url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
		                        data:{"update_notapplicable_status" : "update_notapplicable_status","status" : 1,"recordid" : recordid},
								success: function(response) {
									console.log("true");
								}
							});
						}
						
					});
					
					$(document).on('click', '.mentor_timesheet_open', function() {
					  var id = this.id;  
					  var rowid = id.split("-");
					  var mentorid = $('#availabletimesheet_table #'+rowid[0]+' td:eq(1)').text(); 
					  var cohort = $('#availabletimesheet_table #'+rowid[0]+' td:eq(2)').text();
					  var ctype = $('#availabletimesheet_table #'+rowid[0]+' td:eq(3)').text();
					  var skill = $('#availabletimesheet_table #'+rowid[0]+' td:eq(4)').text();
					  var date = $('#availabletimesheet_table #'+rowid[0]+' td:eq(5)').text();
					  
					  $.ajax({
		 					method: "GET",
		 					url: M.cfg.wwwroot + '/blocks/fn_mentor/timesheetajax.php',
		 					data: {"add_popup_details" : "add_popup_details", "cohort" : cohort,"smeid" : mentorid,"date" :date, "ctype" : ctype, "skill" : skill },
                            success: function(response){
                        	  var responsedata = $.parseJSON(response);
						      var tablerow='';
						      var tablerow_coach ='';
						      var tablerow_cohort = '';
							  
							  $.each(responsedata, function(key, value) {
								  var today = (new Date()).toISOString().split('T')[0];
									
									tablerow_cohort += '<tr id="cohortname"><td style="width: 50%;">Cohort</td><td id="sme_cohortname" style="width: 50%;">'+value.cohortname+'</td></tr>'+
									'<tr id="count"><td style="width: 50%;"># of GenC / interns Mapped</td><td style="width: 50%;">'+value.count+'</td></tr>'+
									'<tr id="csl"><td style="width: 50%;">Cohort SL</td><td style="width: 50%;">'+value.cohortsl+'</td></tr>'+
									'<tr id="track"><td style="width: 50%;">Cohort Curriculum Track</td><td style="width: 50%;">'+value.track+'</td></tr>'+
									'<tr id="type"><td style="width: 50%;">Cohort Type</td><td style="width: 50%;">'+value.ctype+'</td></tr>'+
									'<tr id="status"><td style="width: 50%;">Cohort Current Status</td><td style="width: 50%;">'+value.status+'</td></tr>';
									
									tablerow_coach = '<tr id="coachid"><td style="width: 50%;">Coach ID</td><td style="width: 50%;">'+value.coachid+'</td></tr>'+
									'<tr id="coachname"><td style="width: 50%;">Coach Name</td><td style="width: 50%;">'+value.coachname+'</td></tr>';
									if(value.trainer) {
										$('#fn_mentor_sme_div').append('<label><b>Trainer Details : </b></label>');
										tablerow += 
											'<tr id="smeid"><td style="width: 50%;">Trainer ID</td><td style="width: 50%;">'+value.smeid+'</td></tr>'+
											'<tr id="smename"><td style="width: 50%;">Trainer name</td><td style="width: 50%;">'+value.smename+'</td></tr>'+														
											'<tr id="mentoctypes"><td style="width: 50%;">Contribution Types</td><td id="mentor_ctype" style="width: 50%;">'+value.mentorctypes+'</td></tr>'+
                                            '<tr id="mskills"><td style="width: 50%;">Skills</td><td style="width: 50%;">';//<select id = "mentorskills">';											
										} else {
											$('#fn_mentor_sme_div').append('<label><b>SME Details : </b></label>');
									tablerow += 
									'<tr id="smeid"><td style="width: 50%;">SME ID</td><td style="width: 50%;">'+value.smeid+'</td></tr>'+
									'<tr id="smename"><td style="width: 50%;">SME name</td><td style="width: 50%;">'+value.smename+'</td></tr>'+
									'<tr id="smegrade"><td style="width: 50%;">SME Grade</td><td style="width: 50%;">'+value.smegrade+'</td></tr>'+
									'<tr id="smesl"><td style="width: 50%;">SME SL</td><td style="width: 50%;">'+value.smesl+'</td></tr>'+
									'<tr id="mentoctypes"><td style="width: 50%;">Contribution Types</td><td id="mentor_ctype" style="width: 50%;">'+value.mentorctypes+'</td></tr>'+
									'<tr id="mskills"><td style="width: 50%;">Skills</td><td style="width: 50%;">';//<select id = "mentorskills">
									
										}
									var contribution = value.mentorctypes;
									
									if(contribution === 'Trainer') {
									var mentor_skills= value.skills.split(','); 
									tablerow += '<div class="row">';
											$.each(mentor_skills, function(newkey, newvalue) {
												tablerow += '<div class="col-6" style="height:20px"><input type="checkbox" id="'+newvalue+'_id" class = "mentorskills" name="metor_skill_checkbox" value="'+newvalue+'" style="width:11px;height:11px;">&nbsp;<label for="'+newvalue+'_id" style="font-size: 14px;">'+newvalue+'</label></div>';
											})
											
											tablerow += '</div></td></tr>';//</select>
									} else if(contribution === 'Mentoring'){
										tablerow += '<select id = "mentorskills"><option value = "select_skill">Select Skill</option>';
										var mentor_skills= value.skills.split(','); 
										$.each(mentor_skills, function(newkey, newvalue) {
											
											tablerow += '<option value="'+newvalue+'">'+newvalue+'</option>';
											//tablerow += '<div class="col-6" style="height:20px"><input type="checkbox" id="'+newvalue+'_id" class = "mentorskills" name="metor_skill_checkbox" value="'+newvalue+'" style="width:11px;height:11px;">&nbsp;<label for="'+newvalue+'_id" style="font-size: 14px;">'+newvalue+'</label></div>';
										})
										tablerow += '</select></td></tr>'; //</select>
										
									}
									else {
										tablerow += '<select id = "mentorskills"><option value = "select_skill">Select Skill</option>';
										tablerow += '<option value="'+value.skills+'">'+value.skills+'</option>';
										tablerow += '</select></td></tr>';
									}
				                           
								    tablerow +=
   						            '<tr id="date"><td style="width: 50%;">Date</td><td id="start-time" style="width: 50%;">'+value.date+'</td></tr>'+
   						            '<tr id="hours"><td style="width: 50%;">Contribution Hours</td><td style="width: 50%;"> Hrs <input type="number" id="c_hours" name="time" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;mins <input type="number" id="c_mins" name="c_mins" min="0" max="59" maxlength="2" style="width:50px;" required></td></tr>';
   					   
                                   if(contribution === 'Trainer') {
	                                     tablerow += '<tr id="othershours" hidden><td style="width: 50%;">Contribution Hours of Others</td><td style="width: 50%;"> Hrs <input type="number" id="others_c_hours" name="time" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;mins <input type="number" id="others_c_mins" name="c_mins" min="0" max="59" maxlength="2" style="width:50px;" required></td></tr>';
                                   }
									
									$('#start-time').prop('max', today);
	                            })
                               
							   if($('#fn_mentor_timesheet_cohort_details tr').length !=0) {
					                    	   	$('#fn_mentor_timesheet_cohort_details tr').remove();
					            }
		                       if($('#fn_mentor_timesheet_coach_details tr').length !=0) {
		                    	   	$('#fn_mentor_timesheet_coach_details tr').remove();
		                       }
		                       if($('#mentor_timesheet_label tr').length !=0) {
		                    	   	$('#mentor_timesheet_label tr').remove();
		                       }
		                      $('#alertlabel').remove();
                              $('#fn_mentor_cohort_div').removeAttr('hidden');
                              $('#timesheet_add').find('#fn_mentor_timesheet_cohort_details tbody').append(tablerow_cohort);
                              $('#fn_mentor_coach_div').removeAttr('hidden');
                              $('#timesheet_add').find('#fn_mentor_timesheet_coach_details tbody').append(tablerow_coach);
                              $('#fn_mentor_sme_div').removeAttr('hidden');
                              $('#timesheet_add').find('#mentor_timesheet_label tbody').append(tablerow);
                              $("#timesheet_add").modal("show");
                          }
		 				}).done(function( response ) {	
		 					if(response === "success"){
			 				       console.log("true");
			 					}
			 				});
				
					  
					  $(this).siblings('.mentor_timesheet_save').show();
					  $(this).hide();
					});
				
				 
				
			});
			
			
		}
	};
	
});
define('block_fn_mentor/alltimesheet', ['jquery'], function($) { 
	
	return { 
		init: function() {
			var url=  $(location).attr('href');
			var rootPath = M.cfg.wwwroot;
			$( document ).ready(function() {
				$("#filtermentorstimesheet").click( function() {
				    var mentorid = $('#fn_mentor_timesheet_smeid option:selected').text();
				    var bu = $('#fn_mentor_timesheet_bu option:selected').text();
				    var smegrade = $('#fn_mentor_timesheet_smegrades option:selected').text();
				    var cohort = $('#fn_mentor_timesheet_cohorts option:selected').text();
				    var lp = $('#fn_mentor_timesheet_lp option:selected').text();
				    var ctype = $('#fn_mentor_timesheet_ctypes option:selected').text();
					var ctypefromdate = $('#mentorctypefromdate').val();
					var ctypetodate = $('#mentorctypetodate').val();
					var reporttype = $('input[name="mentor_report"]:checked').val();
					if ( ! $(".fnmentortimesheetreport").is(':checked') ) {
						alert("Kindly provide report type");
					}
					
					else {
						if((mentorid =='Select') && ( bu =='Select') && (smegrade =='Select' ) &&(cohort =='Select' ) &&( lp =='Select') &&(ctype =='Select' ) &&( ctypefromdate =='') && ( ctypetodate =='')) {
							alert("Kindly provide any one filter");
						}
						else {
							if(reporttype == 'detailedreport') {
								
								$.ajax({
			                        method: "GET",
			                        url: M.cfg.wwwroot + '/blocks/fn_mentor/all_timesheetajax.php',
			                        data: {"action" : "get_report","reporttype" : reporttype,"mentorid" : mentorid,"bu" : bu, "smegrade" : smegrade, "cohort" : cohort, "lp" : lp, "ctype" : ctype, "ctypefromdate" : ctypefromdate, "ctypetodate" : ctypetodate}
			                    }).done(function(response) {
			                    	 var data = JSON.parse(response);
			                    	 var userdata =  JSON.parse(data.userData);
			                    	 var DataTable = "";
			                    	 DataTable = $('#migration_userreport_table').DataTable( {
			                         });   
			                         DataTable.clear().draw();
			                         DataTable.rows.add(userdata).draw();
			                    	
			                    });
								
							}
							else if(reporttype == 'summaryreport'){
								
								$.ajax({
			                        method: "GET",
			                        url: M.cfg.wwwroot + '/blocks/fn_mentor/all_timesheetajax.php',
			                        data: {"action" : "get_report","reporttype" : reporttype,"mentorid" : mentorid,"bu" : bu, "smegrade" : smegrade, "cohort" : cohort, "lp" : lp, "ctype" : ctype, "ctypefromdate" : ctypefromdate, "ctypetodate" : ctypetodate}
			                    }).done(function(response) {
			                    	var nodata = '****';
			                    	$('#mentortimeetstable_summary').removeAttr('hidden');
			                    	$('#mentortimeetstable_detailed').attr("hidden",true);
			                    	if(response.indexOf(nodata) != -1) {
			                    		if($('#mentortimeetstable_summary tbody tr').length != 0) {
				                    	   	$('#mentortimeetstable_summary tbody tr').remove();
				                        }
				                    	$('#mentortimeetstable_summary .odd').remove();
				                    	var emptydata = '<tr class="odd"><td valign="top" colspan="9" class="dataTables_empty">No data available in table</td></tr>';
				                    	$('#mentortimeetstable_summary tbody').append(emptydata);
			                    	}
			                    	else {
			                    		if($('#mentortimeetstable_summary tbody tr').length != 0) {
				                    	   	$('#mentortimeetstable_summary tbody tr').remove();
				                        }
				                    	$('#mentortimeetstable_summary .odd').remove();
				                    	$('#mentortimeetstable_summary tbody').append(response);
			                    	}
							
						});
								
							}
							
					     }
					}
			    });
				
				 $("#removefiltermentorstimesheet").click( function() {
				     $('#fn_mentor_timesheet_smeid').prop('selectedIndex',0);
				     $('#fn_mentor_timesheet_bu').prop('selectedIndex',0);
				     $('#fn_mentor_timesheet_smegrades').prop('selectedIndex',0);
				     $('#fn_mentor_timesheet_cohorts').prop('selectedIndex',0);
				     $('#fn_mentor_timesheet_lp').prop('selectedIndex',0);
				     $('#fn_mentor_timesheet_ctypes').prop('selectedIndex',0);
					 $('#mentorctypefromdate').val('');
					 $('#mentorctypetodate').val('');
					 $('input[name=mentor_report]').prop('checked',false);
					 $('#mentortimeetstable_summary').attr("hidden",true);
					 $('#mentortimeetstable_detailed').attr("hidden",true);
			    });

			});
		}
	};
});
define('block_fn_mentor/script', ['jquery'], function() {
    return {
        mentor_ui: function(args) {

            $('#mentorskill').change(function() {
                $("#viewDiscussions").html('<img style="height:50px;width:50px" src="' + M.cfg.wwwroot + '/blocks/fn_mentor/pix/load.gif" />');

                var skill = $(this).val();
                var status = $('#mentorcommunitystatus').val();
                var cohort = $('#mentorcohort').val()
                skill = skill.replace('#', '@@');
                $("#viewDiscussions").load(M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php', "action=mentor&cohort=" + cohort + "&skill=" + skill + "&status=" + status);

                $('#alert_mentor').css('display', 'none');

                $.post(M.cfg.wwwroot + "/blocks/fn_mentor/ajax.php", { action: 'mentor_oc', skill: skill, cohort: cohort, status: status })
                    .done(function(result) {
                        $('#opendiscussions').html('Open queries : ' + result.open);
                        $('#closeddiscussions').html('Closed queries : ' + result.closed);
                        if (skill != 'All')
                            $("#mentor_newdiscussion").attr("href", M.cfg.wwwroot + "/mod/tekforum/view.php?id=" + result.cmid);
                        else
                            $("#mentor_newdiscussion").removeAttr("href");

                        // if (status.includes("open")) {
                        //     $('#alldiscussions').html('Community Support (' + result.open + ')');
                        // } else if (status.includes("close")) {
                        //     $('#alldiscussions').html('Community Support (' + result.closed + ')');
                        // } else {
                        //     $('#alldiscussions').html('Community Support (' + result.total + ')');
                        // }
                    });
            });

            $('#mentorcohort').change(function() {
                $("#viewDiscussions").html('<img style="height:50px;width:50px" src="' + M.cfg.wwwroot + '/blocks/fn_mentor/pix/load.gif" />');

                var cohort = $(this).val();
                var status = $('#mentorcommunitystatus').val();
                var skill = $('#mentorskill').val()
                skill = skill.replace('#', '@@');
                $("#viewDiscussions").load(M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php', "action=mentor&cohort=" + cohort + "&skill=" + skill + "&status=" + status);

                $('#alert_mentor').css('display', 'none');

                $.post(M.cfg.wwwroot + "/blocks/fn_mentor/ajax.php", { action: 'mentor_oc', skill: skill, cohort: cohort, status: status })
                    .done(function(result) {
                        $('#opendiscussions').html('Open queries : ' + result.open);
                        $('#closeddiscussions').html('Closed queries : ' + result.closed);
                        // $("#mentor_newdiscussion").attr("href", M.cfg.wwwroot + "/mod/tekforum/view.php?id=" + result.cmid);

                        // if (status.includes("open")) {
                        //     $('#alldiscussions').html('Community Support (' + result.open + ')');
                        // } else if (status.includes("close")) {
                        //     $('#alldiscussions').html('Community Support (' + result.closed + ')');
                        // } else {
                        //     $('#alldiscussions').html('Community Support (' + result.total + ')');
                        // }
                    });
            });

            $('#mentorcommunitystatus').change(function() {
                $("#viewDiscussions").html('<img style="height:50px;width:50px" src="' + M.cfg.wwwroot + '/blocks/fn_mentor/pix/load.gif" />');

                var cohort = $('#mentorcohort ').val();
                var skill = $('#mentorskill').val()
                var status = $(this).val();

                skill = skill.replace('#', '@@');
                $("#viewDiscussions").load(M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php', "action=mentor&cohort=" + cohort + "&skill=" + skill + "&status=" + status);

                $('#alert_mentor').css('display', 'none');

                $.post(M.cfg.wwwroot + "/blocks/fn_mentor/ajax.php", { action: 'mentor_oc', skill: skill, cohort: cohort, status: status })
                    .done(function(result) {
                        $('#opendiscussions').html('Open queries : ' + result.open);
                        $('#closeddiscussions').html('Closed queries : ' + result.closed);

                        // if (status.includes("open")) {
                        //     $('#alldiscussions').html('Community Support (' + result.open + ')');
                        // } else if (status.includes("close")) {
                        //     $('#alldiscussions').html('Community Support (' + result.closed + ')');
                        // } else {
                        //     $('#alldiscussions').html('Community Support (' + result.total + ')');
                        // }

                    });
            });


            $('#queryreply').click(function() {

                var id = $("#queryreply").attr("discussion");
                var message = $('#reply_textarea').val();
                if (message != "") {
                    $('#reply_discussion_load').css('display', 'block');
                    $('#reply_discussion_successful').css('display', 'none');
                    $('#reply_discussion_mentor').css('display', 'none');
                    message = JSON.stringify(message);

                    $.post(M.cfg.wwwroot + "/blocks/fn_mentor/ajax.php", { action: 'quickreply', id: id, message: message })
                        .done(function(result) {
                            $('#reply_discussion_load').css('display', 'none');
                            $('#reply_discussion_successful').css('display', 'block');
                        });
                } else {
                    // Empty message
                    alert("Response cannot be Empty");
                }

            });

            $("#mentortickets").click(function() {
                $("#mentortickets").attr("class", "nav-link active top");
                $("#alldiscussions").attr("class", "nav-link top");
                $("#viewMentorTickets").css("display", "block");
                $("#viewDiscussions").css("display", "none");
            });

            $("#alldiscussions").click(function() {
                $("#mentortickets").attr("class", "nav-link top");
                $("#alldiscussions").attr("class", "nav-link active top");
                $("#viewMentorTickets").css("display", "none");
                $("#viewDiscussions").css("display", "block");
            });

            //Cohort summary change events

            $('#mentorcohortsummary').change(function() {
                var cohort = $(this).val();
                $("#cohortsummary").html('<img style="height:50px;width:50px" src="' + M.cfg.wwwroot + '/blocks/fn_mentor/pix/load.gif" />');
                $("#cohortsummary").load(M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php', "action=mentor_cohort&cohort=" + cohort);
            });

            //pop-up
            var mentorrating_cohort =
                ' <div id="mentorrating_cohort" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
                ' <div class="modal-dialog" style="max-width:500px">' +
                ' <div class="modal-content" >' +
                ' <div class="modal-headers" style="height: 60px;border-bottom: 1px solid #e9ecef;">' +
                ' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: black;margin-top: 20px;"> <strong> Ratings </strong> </div> ' +
                ' <div class="modal-body" >' +
                '<table id ="mentorrating_cohort_table" class="table" border="1">' +
                '<tbody>' +
                '</tbody>' +
                '</table>' +
                ' <div class="modal-footer">' +
                ' <button type="button" data-dismiss="modal" style="width: 80px;height: 35px;">Close</button>' +
                ' </div>' +
                ' </div>' +
                ' </div></div></div>';

            $("#page-header").append(mentorrating_cohort);

            var mentorreviews_cohort =
                ' <div id="mentorreview_cohort" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
                ' <div class="modal-dialog modal-xl" style="max-width:500px">' +
                ' <div class="modal-content">' +
                ' <div class="modal-headers" style="height: 60px;border-bottom: 1px solid #e9ecef;">' +
                ' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: black;margin-top: 20px;"> <strong> Ratings </strong> </div> ' +
                ' <div class="modal-body" style="height: 350px;overflow-y: auto;">' +
                ' </div>' +
                ' <div class="modal-footer">' +
                ' <button type="button" data-dismiss="modal" style="width: 80px;height: 35px;">Close</button>' +
                ' </div>' +
                ' </div></div></div>';

            $("#page-header").append(mentorreviews_cohort);



            $("#mentorreviews").click(function() {
                $cohort_name = $('#mentorcohortsummary option:selected').text().trim();
                $.ajax({
                    method: "GET",
                    url: M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php',
                    data: { "action": "showreviews", "cohort_name": $cohort_name },
                    success: function(response) {
                        console.log(response);
                        //var responsedata = $.parseJSON(response);
                        var responsedata = JSON.parse(JSON.stringify(response));
                        var content = '';

                        $.each(responsedata, function(key, value) {

                            content += '<div align="left"><span><i class="fa fa-user" aria-hidden="true" style="font-size: 25px;"></i></span>' +
                                '<span>&nbsp;' + value.name + '</span></div>' +
                                '<div align = "left" style="text-indent: 50px;">' + value.suggestion + '</div>';

                        })
                        if ($('#mentorreview_cohort').find('.modal-body div').length != 0) {
                            $('#mentorreview_cohort').find('.modal-body div').remove();
                        }

                        $('#mentorreview_cohort').find('.modal-body').append(content);
                        $("#mentorreview_cohort").modal("show");
                    }
                }).done(function(response) {

                });

            });

            //$('document').ready(function() {
            $("#mentorratings").click(function() {
                $cohort_name = $('#mentorcohortsummary option:selected').text().trim();
                $.ajax({
                    method: "GET",
                    url: M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php',
                    data: { "action": "showratings", "cohort_name": $cohort_name },
                    success: function(response) {
                        console.log(response);
                        //var responsedata = $.parseJSON(response);
                        var responsedata = JSON.parse(JSON.stringify(response));
                        var tablerow = '';

                        $.each(responsedata, function(key, value) {

                            tablerow += '<tr><td><b>Contribution Type</b></td><td><b>Overall Rating</b></td><td><b>Individual Rating</b></td></tr><tr><td scope="row" align="center">' + value.contributiontype + '</td><td scope="row" align="center">' + value.overallfb + '</td><td scope="row">' + value.indivual + '</td></tr>';

                        })

                        if ($('#mentorrating_cohort_table tr').length != 0) {
                            $('#mentorrating_cohort_table tr').remove();

                        }
                        $('#mentorrating_cohort').find('.modal-body .table tbody').append(tablerow);
                        $("#mentorrating_cohort").modal("show");
                    }
                }).done(function(response) {

                });
            });

            // });

            $('document').ready(function() {

                /*$('.paginationmentorpost').click(function(){
                var idval = $(this).attr('id');
                console.log(idval);
                 var cohort = $('#mentorcohort').val();
                 var skill = $('#mentorskill').val();
                 $("#viewDiscussions").load( M.cfg.wwwroot+'/blocks/fn_mentor/ajax.php',"action=paginationdata&cohort="+cohort+"&skill="+skill+"&page="+idval);
				
				
                });*/
            });


        },
        mentee_ui: function(args) {

            $("#myfntickets").click(function() {

                $("#myfntickets").attr("class", "nav-link top active");
                $("#myfndiscussions").attr("class", "nav-link top");
                $("#viewfntickets").css("display", "block");
                $("#viewfndiscussions").css("display", "none");

                $("#mentee_newdiscussion").css("display", "none");
                $("#mentee_raisequery").css("display", "block");

                $("#mentee_discussion").css("display", "none");
                $("#co_mentee_discussion").css("display", "none");
            });

            $("#myfndiscussions").click(function() {
                $("#myfntickets").attr("class", "nav-link top");
                $("#myfndiscussions").attr("class", "nav-link top active");
                $("#viewfntickets").css("display", "none");
                $("#viewfndiscussions").css("display", "block");

                $("#mentee_raisequery").css("display", "none");
                $("#mentee_newdiscussion").css("display", "block");

                $("#mentee_discussion").css("display", "block");
                $("#co_mentee_discussion").css("display", "none");
            });



            $("#mydiscussion").click(function() {
                $("#mydiscussion").attr("class", "nav-link active");
                $("#mycohortdiscussion").attr("class", "nav-link");
                $("#mentee_discussion").css("display", "block");
                $("#co_mentee_discussion").css("display", "none");
            });

            $("#mycohortdiscussion").click(function() {
                $("#mydiscussion").attr("class", "nav-link");
                $("#mycohortdiscussion").attr("class", "nav-link active");
                $("#mentee_discussion").css("display", "none");
                $("#co_mentee_discussion").css("display", "block");
            });

            var showmydiscussion = 'true'

            $('#mycohortdiscussion').click(function() {
                showmydiscussion = 'false'
            })

            $('#mydiscussion').click(function() {
                showmydiscussion = 'true'
            })


            $('#queryreply').click(function() {
                var id = $("#queryreply").attr("discussion");
                var message = $('#reply_textarea').val();
                if (message != "") {
                    $('#reply_discussion_load').css('display', 'block');
                    $('#reply_discussion_successful').css('display', 'none');
                    $('#reply_discussion_mentee').css('display', 'none');
                    message = JSON.stringify(message);

                    $.post(M.cfg.wwwroot + "/blocks/fn_mentor/ajax.php", { action: 'quickreply', id: id, message: message })
                        .done(function(result) {
                            $('#reply_discussion_load').css('display', 'none');
                            $('#reply_discussion_successful').css('display', 'block');
                        });
                } else {
                    // Empty message
                    alert("Response cannot be Empty");
                }

            });


            $('#menteeskill').change(function() {

                $('#alert_mentee').css('display', 'none');

                $("#viewDiscussions").html('<img style="height:50px;width:50px" src="' + M.cfg.wwwroot + '/blocks/fn_mentor/pix/load.gif" />');

                var myd_class = $('#mydiscussion').attr("class");
                var myc_class = $('#mycohortdiscussion').attr("class");
                var skill = $(this).val();
                skill = skill.replace('#', '@@');
                var status = $('#menteecommunitystatus').val();
                $("#viewDiscussions").load(M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php', "action=mentee&skill=" + skill + "&status=" + status +
                    "&showmydiscussion=" + showmydiscussion);

                if (skill != "All") {
                    // $("#mentee_newdiscussion").attr("target", "_blank");
                } else
                    $("#mentee_newdiscussion").removeAttr("target");


                $.post(M.cfg.wwwroot + "/blocks/fn_mentor/ajax.php", { action: 'mentee_oc', skill: skill, status: status })
                    .done(function(result) {
                        $('#myfndiscussions').html('Community Support (' + result.total + ') ');
                        $('#mydiscussion').html('My Discussion (' + result.myopen + ')');
                        $('#mycohortdiscussion').html('My Cohort Discussions (' + result.copen + ')');
                        if (skill != "All")
                            $("#mentee_newdiscussion").attr("href", M.cfg.wwwroot + "/mod/tekforum/view.php?id=" + result.cmid);
                        else
                            $("#mentee_newdiscussion").removeAttr("href")

                        setTimeout(function() {
                            if (myd_class.includes("active")) {
                                $("#mydiscussion").attr("class", "nav-link active");
                                $("#mycohortdiscussion").attr("class", "nav-link");
                                $("#mentee_discussion").css("display", "block");
                                $("#co_mentee_discussion").css("display", "none");
                            } else {
                                $("#mydiscussion").attr("class", "nav-link");
                                $("#mycohortdiscussion").attr("class", "nav-link active");
                                $("#mentee_discussion").css("display", "none");
                                $("#co_mentee_discussion").css("display", "block");
                            }
                        }, 200);

                    });

            });

            $('#menteecommunitystatus').change(function() {

                $("#viewDiscussions").html('<img style="height:50px;width:50px" src="' + M.cfg.wwwroot + '/blocks/fn_mentor/pix/load.gif" />');

                var myd_class = $('#mydiscussion').attr("class");
                var myc_class = $('#mycohortdiscussion').attr("class");
                var skill = $('#menteeskill').val();
                skill = skill.replace('#', '@@');
                var status = $(this).val();
                $("#viewDiscussions").load(M.cfg.wwwroot + '/blocks/fn_mentor/ajax.php', "action=mentee&skill=" + skill + "&status=" +
                    status + "&showmydiscussion=" + showmydiscussion);

                if (skill != "All") {
                    //  $("#mentee_newdiscussion").attr("target", "_blank");
                } else
                    $("#mentee_newdiscussion").removeAttr("target");

                $.post(M.cfg.wwwroot + "/blocks/fn_mentor/ajax.php", { action: 'mentee_oc', skill: skill, status: status })
                    .done(function(result) {
                        $('#myfndiscussions').html('Community Support (' + result.total + ') ');
                        $('#mydiscussion').html('My Discussion (' + result.myopen + ')');
                        $('#mycohortdiscussion').html('My Cohort Discussions (' + result.copen + ')');
                        if (skill != "All")
                            $("#mentee_newdiscussion").attr("href", M.cfg.wwwroot + "/mod/tekforum/view.php?id=" + result.cmid);
                        else
                            $("#mentee_newdiscussion").removeAttr("href")

                        setTimeout(function() {

                            if (myd_class.includes("active")) {
                                $("#mydiscussion").attr("class", "nav-link active");
                                $("#mycohortdiscussion").attr("class", "nav-link");
                                $("#mentee_discussion").css("display", "block");
                                $("#co_mentee_discussion").css("display", "none");
                            } else {
                                $("#mydiscussion").attr("class", "nav-link");
                                $("#mycohortdiscussion").attr("class", "nav-link active");
                                $("#mentee_discussion").css("display", "none");
                                $("#co_mentee_discussion").css("display", "block");
                            }
                        }, 200);
                    });

            });

            $(document).on('click', '#mentee_newdiscussion', function() {

                var skill = $('#menteeskill').val();

                if (skill == "All") {
                    $('#alert_mentee').html('<div class="alert alert-danger alert-dismissable" style="font-size: 0.75em;"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button> Please select any skill </div></div>');
                    $("#alert_mentee").css('display', 'block');
                } else {
                    $("#alert_mentee").css('display', 'none');
                }
            });
        }
    }
});
define('block_fn_mentor/newquery', ["jquery"],function(e){return{init:function(){var t=e(location).attr("href");M.cfg.wwwroot;e("document").ready(function(){(t.includes("helpdesk/update.php")||t.includes("fn_mentor/new_query.php"))&&e("#mform1").on("submit",function(e){document.querySelector("input[type=submit]").disabled=!0});var i,o,d;e("#page-header").append(' <div id="confirmActionModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog" > <div class="modal-content"> <div class="modal-headers"> <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;"> </h4> </div> <div class="modal-body" ></div> <div class="modal-footer"> <button type="button" class="btn btn-info" id="ticketgotinfo" aria-expanded="false"  > Got Required Information </button> <button type="button" class="btn btn-default" id="ticketcontinue" aria-expanded="false" >Continue Raising Ticket</button> </div> </div> </div></div>');var l=e("#id_relatedto"),a=e("#id_summary"),n=e("#id_section"),s=e("#id_activity"),c=e("#id_others");t.includes("blocks/fn_mentor/new_query.php")?(i=e("#id_frm .fitem:nth-child(5)"),$section=e("#id_frm .fitem:nth-child(4)"),d=e("#id_frm .fitem:nth-child(3)"),o=e("#id_frm .fitem:nth-child(2)")):t.includes("blocks/helpdesk/edit.php")&&(i=e("#id_frm .fitem:nth-child(6)"),$section=e("#id_frm .fitem:nth-child(5)"),d=e("#id_frm .fitem:nth-child(4)"),o=e("#id_frm .fitem:nth-child(3)")),t.includes("blocks/fn_mentor/new_query.php")&&(e(document).on("click","#ticketcontinue",function(t){e("#confirmActionModal").modal("hide")}),e(document).on("click","#ticketgotinfo",function(t){e("#confirmActionModal").modal("hide"),location.replace(M.cfg.wwwroot+"/my")})),$count=0,l.change(function(){var l=e("#id_relatedto option:selected").val();if(0==l.length?($section.removeClass("show"),$section.addClass("hidden"),i.removeClass("show"),i.addClass("hidden"),o.removeClass("show"),o.addClass("hidden"),d.removeClass("show"),d.addClass("hidden"),c.prop("required",!1),n.prop("required",!1),s.prop("required",!1)):"Content / Course"===l||"Hands-On"===l?(o.removeClass("hidden"),o.addClass("show"),$section.removeClass("hidden"),$section.addClass("show"),i.removeClass("hidden"),i.addClass("show"),d.removeClass("show"),d.addClass("hidden"),c.prop("required",!1),n.prop("required",!0),s.prop("required",!0),t.includes("blocks/fn_mentor/new_query.php")?(e("#id_frm .fitem:nth-child(2) div.col-md-3 label").text("Select a course"),e("#id_frm .fitem:nth-child(5) div.col-md-3 label").text("Select an activity")):t.includes("blocks/helpdesk/edit.php")&&(e("#id_frm .fitem:nth-child(3) div.col-md-3 label").text("Select a course"),e("#id_frm .fitem:nth-child(6) div.col-md-3 label").text("Select an activity"))):"Contest / Mock"===l||"Knockout Challenge"===l?(o.removeClass("hidden"),o.addClass("show"),$section.removeClass("hidden"),$section.addClass("show"),i.removeClass("hidden"),i.addClass("show"),d.removeClass("show"),d.addClass("hidden"),c.prop("required",!1),n.prop("required",!0),s.prop("required",!0),t.includes("blocks/fn_mentor/new_query.php")?(e("#id_frm .fitem:nth-child(2) div.col-md-3 label").text("Select your "+e("#id_relatedto option:selected").text()),e("#id_frm .fitem:nth-child(5) div.col-md-3 label").text("Select your activity / issue")):t.includes("blocks/helpdesk/edit.php")&&(e("#id_frm .fitem:nth-child(3) div.col-md-3 label").text("Select your "+e("#id_relatedto option:selected").text()),e("#id_frm .fitem:nth-child(6) div.col-md-3 label").text("Select your activity / issue"))):(o.removeClass("hidden"),o.addClass("show"),$section.removeClass("show"),$section.addClass("hidden"),i.removeClass("show"),i.addClass("hidden"),d.removeClass("show"),d.addClass("hidden"),c.prop("required",!1),n.prop("required",!1),s.prop("required",!1),t.includes("blocks/fn_mentor/new_query.php")?e("#id_frm .fitem:nth-child(2) div.col-md-3 label").text("Subject"):t.includes("blocks/helpdesk/edit.php")&&e("#id_frm .fitem:nth-child(3) div.col-md-3 label").text("Subject")),$subjectid="",$activityid="",$sectionid="",$other="",""!==l)if(t.includes("hd_userid=")){var r=t.substring(t.indexOf("hd_userid=")+10);a.load("ajax.php","relatedto="+l+"&userid="+r)}else if(t.includes("/blocks/helpdesk/new.php"))a.load("ajax.php","relatedto="+l);else if(t.includes("/blocks/helpdesk/edit.php")){r=e("#mform1 input[name=hd_userid]").val();var p=t.substring(t.indexOf("id=")+3);e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/helpdesk/ajax.php",data:{ticketid:p}}).done(function(e){if("Content / Course"===l||"Contest / Mock"===l||"Hands-On"===l||"Knockout Challenge"===l){var t=e.split(" ");$subjectid=" "+t[1],$activityid=" "+t[3],$sectiondata=t[4],"NA"!==$sectiondata?$sectionid=$sectiondata:($section.removeClass("show"),$section.addClass("hidden"))}else{t=e.split(".");$subjectid=""+t[0],"Others"===$subjectid&&($other=""+t[1])}}),a.load("ajax.php","relatedto="+l+"&userid="+r),setTimeout(function(){0==$count&&(e('#id_summary option[value="'+$subjectid+'"]').prop("selected",!0),"The Platform"===l&&("Others"==$subjectid?(d.removeClass("hidden"),d.addClass("show"),c.prop("required",!0),c.val($other)):(d.removeClass("show"),d.addClass("hidden"),c.val(""),c.prop("required",!1)),$count++))},400)}"Content / Course"!==l&&"Contest / Mock"!==l&&"Hands-On"!==l&&"Knockout Challenge"!==l||((t.includes("/blocks/helpdesk/new.php")||t.includes("/blocks/helpdesk/edit.php")||t.includes("hd_userid="))&&setTimeout(function(){var i=0;if(null!=a.val()&&(i=Number(a.val().trim())),0!=i){if(t.includes("hd_userid=")){var o=t.substring(t.indexOf("hd_userid=")+10);n.load("ajax.php","course_id="+i+"&related_to="+l+"&section=all&user_id="+o)}else n.load("ajax.php","course_id="+i+"&related_to="+l+"&section=all");s.load("ajax.php","course_id="+i+"&related_to="+l)}else $val=e("#id_relatedto option:selected").text(),"Contest / Mock"===l||"Knockout Challenge"===l?(a.children("option").remove(),a.append('<option value="">Select a '+$val+"</option>")):(a.children("option").remove(),a.append('<option value="">Select a course</option>')),n.children("option").remove(),n.append('<option value="">Select a section</option>'),s.children("option").remove(),s.append('<option value="">Select an activity</option>')},500),t.includes("/blocks/helpdesk/edit.php")&&setTimeout(function(){0==$count&&(""!=$sectionid?e('#id_section option[value="'+$sectionid+'"]').prop("selected",!0):($section.removeClass("show"),$section.addClass("hidden"),n.prop("required",!1)),e('#id_activity option[value="'+$activityid+'"]').prop("selected",!0),$count++)},900))}).change(),a.change(function(){var i=e("#id_relatedto option:selected").val();if("Content / Course"===i||"Contest / Mock"===i||"Hands-On"===i||"Knockout Challenge"===i){var o=0;if(null!=a.val()&&(o=Number(a.val().trim())),0!=o){if(t.includes("hd_userid=")){var l=t.substring(t.indexOf("hd_userid=")+10);n.load("ajax.php","course_id="+o+"&related_to="+i+"&section=all&user_id="+l)}else n.load("ajax.php","course_id="+o+"&related_to="+i+"&section=all");s.load("ajax.php","course_id="+o+"&related_to="+i)}else $val=e("#id_relatedto option:selected").text(),"Contest / Mock"===i||"Knockout Challenge"===i?(a.children("option").remove(),a.append('<option value="">Select a '+$val+"</option>")):(a.children("option").remove(),a.append('<option value="">Select a course</option>')),n.children("option").remove(),n.append('<option value="">Select a section</option>'),s.children("option").remove(),s.append('<option value="">Select an activity</option>')}else"Others"===a.val()?(d.removeClass("hidden"),d.addClass("show"),c.prop("required",!0)):(d.removeClass("show"),d.addClass("hidden"),c.prop("required",!1)),t.includes("blocks/fn_mentor/new_query.php")&&""!=a.val()&&"Select"!=a.val()&&"The Platform"===i&&e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/helpdesk/ajax.php",data:{choice:"faq",relatedTo:i,subject:a.val()}}).done(function(t){"failure"!==t&&""!==t&&(e(".modal-body").html(t),e("#confirmActionModalTitle").text("FAQ - "+a.val()),e("#confirmActionModal").modal("show"))})}),n.change(function(){var t=e("#id_relatedto option:selected").val();$temp=Number(a.val().trim()),$sectionid=Number(n.val().trim()),s.load("ajax.php","loadactivity=activity&courseid="+$temp+"&sectionid="+$sectionid+"&related="+t)}),s.change(function(){e("#id_relatedto option:selected").val();if(t.includes("blocks/fn_mentor/new_query.php")&&""!=e("#id_activity option:selected").text()&&"Select an activity"!=e("#id_activity option:selected").text()&&"The Platform"!==l.val()){var i=s.val();e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/helpdesk/ajax.php",data:{choice:"faq",relatedTo:l.val(),entityid:i}}).done(function(t){"failure"!==t&&""!==t&&(e(".modal-body").html(t),e("#confirmActionModalTitle").text("FAQ - "+e("#id_activity option:selected").text()),e("#confirmActionModal").modal("show"))})}})})}}});
define('block_fn_mentor/rep_timesheet', ['jquery'], function($) { 
	return { 
		init: function(max_hrs) {
			var url=  $(location).attr('href');
			var remainingtime = max_hrs;
			$( document ).ready(function() {
				
				function storeTblValuesEdit()  {
		             var TableData = new Array();
		             $('#mentortimeetstable tr').each(function(row, tr){ 
		            	  
		            		 TableData[row]={ 
		            				       "id":$(tr).find('td:eq(0)').text().replace("&", "***"),
		            	               "smeid": $(tr).find('td:eq(1)').text().replace("&", "***"),
		            	                    "smename" : $(tr).find('td:eq(2)').text().replace("&", "***"),
		            	                    "cohortname" : $(tr).find('td:eq(3)').text().replace("&", "***"),
		            	                    "date" : $(tr).find('td:eq(4)').text().replace("&", "***"),
		            	                    "hours" : $(tr).find('td:eq(5)').text().replace("&", "***"),
		            	                    "skill" : $(tr).find('td:eq(6)').text().replace("&", "***"),
		            	                    "ctype" : $(tr).find('td:eq(7)').text().replace("&", "***"),
		            	                    "sl" : $(tr).find('td:eq(8)').text().replace("&", "***"),
		            	                    "track" : $(tr).find('td:eq(9)').text().replace("&", "***"),
		            	                 } 
		            	  
		              }); 
		            	
		             
		            TableData.shift(); 
		            TableData= JSON.stringify(TableData);
		            return TableData;
		        }
				
				//pop-up
				var addnewtimesheet =
					' <div id="rep_timesheet_add" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
					' <div class="modal-dialog" style="max-width:800px">' +
					' <div class="modal-content" >' +
					' <div class="modal-headers" style="background: #0033a0;height: 50px;">' +
					' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;margin-top: 10px;color: white;"> <strong>Timesheet </strong> </div> ' +
					' <div class="modal-body" >' +
					'<div id="fn_mentor_rep_div" hidden></div>'+
					'<table id ="rep_timesheet_label" style="width: 100%;" class="table table-borderless">'+
					'<tbody>'+
					'</tbody>'+
					'</table>'+
					'<div id="fn_mentor_error_div"></div>'+
					' <div class="modal-footer">'+
					' <button type="button" class="btn btn-info" id="rep_timesheet_addbutton" aria-expanded="false">Add</button>'+
					' <button type="button" class="btn btn-info" id="rep_timesheet_cancel" aria-expanded="false" data-dismiss="modal">Cancel</button>'+
					' </div>'+
					' </div>'+
					' </div></div></div>';
				$("#page-header").append(addnewtimesheet);
				
				$(document).on("click","#rep_timesheet_addbutton",function() {
					
					var cohort_name = $('#rep_cohortname').text();
					var mentorid = $('#mentor_idnumber').text();
					var mentorname = $('#mentor_name').text();
					var date = $('#start-time').text();
					var hours = $('#c_hours').val();
					var mins = $('#c_mins').val();
					var skill = $('#mentorskills option:selected').text();
					var ctype = $('#mentor_ctype').text();
					
					
					var c_mins = parseInt(mins);
					var c_hours = parseInt(hours);
					var mins_to_hours =  c_mins/60;
					var hours_to_mins = c_hours*60;
					
					var totalhours = c_hours + mins_to_hours;
					var totalmins = c_mins+hours_to_mins;
					
					if( (hours === '') || !(hours >= 0 && hours <= max_hrs) ){
						tablerow = '<label id="alertlabel"><font color="red">Please enter valid contribution hours</font></label>';
						
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
					}
					else if( (mins === '') || !(mins >=0  && mins <=59)) {
						tablerow = '<label id="alertlabel"><font color="red">Please enter valid contribution mintues</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
					}
					else if( (hours == 0) && (mins == 0) ) {
						tablerow = '<label id="alertlabel"><font color="red">Please enter valid contribution hours</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
					}
					else if (totalhours > remainingtime) {
						tablerow = '<label id="alertlabel"><font color="red">The total hours contributed for the day cannot be greater than '+max_hrs+' hrs.</font></label>';
						if(('#alertlabel').length != 0 ) {
							$('#alertlabel').remove();
						}
						$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
					}
					else {
						$.ajax({
	                        method: "GET",
	                        url: M.cfg.wwwroot + '/blocks/fn_mentor/rep_timesheetajax.php',
	                        data: {"add_rep_timesheet" : "add_rep_timesheet","cohort_name" : cohort_name,"date" : date,"hours" : totalhours, "skill" : skill, "ctype" : ctype,"mins" :totalmins, "mentorid" : mentorid }
	                    }).done(function(response) {
	                    	var error = 'exceeding';
	                    	var error1 = 'loggedin';
	                    	var error2 = 'Exceeded';
	                    	var error3 = 'wrong';
	                    	var ctypeerror = '****';
	                    	if(response.indexOf(error) != -1){
	                    		if(response.indexOf(ctypeerror) != -1) {
	                    			var split = response.split("****");
	                    			tablerow ='<label id="alertlabel"><font color="red">You have already logged your contribution as '+ split[1] +' for the same day.</font></label>';
	                    			if(('#alertlabel').length != 0 ) {
		    							$('#alertlabel').remove();
		    						}
		                    		$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		}
	                    		else {
	                    			tablerow = '<label id="alertlabel"><font color="red">The total hours contributed for the day cannot be greater than '+max_hrs+' hrs.</font></label>';
		                    		if(('#alertlabel').length != 0 ) {
		    							$('#alertlabel').remove();
		    						}
		                    		$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		}
	                    		
	                    		
	                    		//alert("The total hours contributed for the day cannot be greater than 8 hrs.");
	                    	}
	                    	else if(response.indexOf(error1) != -1) {
	                    		tablerow = '<label id="alertlabel"><font color="red">You are logging time sheet for future date</font></label>';
	                    		if(('#alertlabel').length != 0 ) {
	    							$('#alertlabel').remove();
	    						}
	                    		$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		//alert("You are not loggedin to this date.");
	                    	}
	                    	else if(response.indexOf(error2) != -1) {
	                    		tablerow = '<label id="alertlabel"><font color="red">You have exceeded the time limit.</font></label>';
	                    		if(('#alertlabel').length != 0 ) {
	    							$('#alertlabel').remove();
	    						}
	                    		$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		//alert("Time limit crossed.");
	                    	}
	                    	else if(response.indexOf(error3) != -1) {
	                    		var spliterror = response.split(':');
	                    		tablerow = '<label id="alertlabel"><font color="red">You have provided wrong date. </font><br><b> Your contribution dates are </b>'+spliterror[1]+'</label>';
	                    		if(('#alertlabel').length != 0 ) {
	    							$('#alertlabel').remove();
	    						}
	                    		$('#rep_timesheet_add').find('#fn_mentor_error_div').append(tablerow);
	                    		//alert("Time limit crossed.");
	                    	}
	                    	else {
	                    		location.reload();
	                    	}
	                    	
	
	                    });
					}
					
				});
				
				$(document).on("click","#rep_timesheet_cancel",function() { 
                    location.reload();   				
			    });

				
				$(document).on("change","#mentorskills",function() {
					$mskill = $('#mentorskills option:selected').text();
					
					var select = 'Select';
					if($mskill.indexOf(select) != -1) {
						$('#rep_timesheet_label #hours').remove();
                	   	$('#rep_timesheet_label #alertlabel').remove();
					}
					else {
						var today = (new Date()).toISOString().split('T')[0];
						var tablerow='';
        				tablerow +=
   						 '<tr id="hours"><td style="width: 50%;">Contribution Hours</td><td style="width: 50%;"> Hrs <input type="number" id="c_hours" name="time" min="0" max="24" maxlength="2" style="width:50px;" required>&nbsp;mins <input type="number" id="c_mins" name="c_mins" min="0" max="59" maxlength="2" style="width:50px;" required></td></tr>';
   					   
        				 
        				 if($('#rep_timesheet_label #date').length !=0) {
				                 $('#rep_timesheet_label #hours').remove();
				                    	   	
				         }
        				 $('#alertlabel').remove();
        				 $('#rep_timesheet_add').find('#rep_timesheet_label tbody').append(tablerow);
					}
					 
					
					
				});
			
				
				$(document).on("change","#mentor_timesheet_label tr:eq(6) td:eq(1) #start-time",function() { 
					$('#alertlabel').remove();
					var date = $('#mentor_timesheet_label tr:eq(6) td:eq(1) input').val();
					$.ajax({
                        method: "GET",
                        url: M.cfg.wwwroot + '/blocks/fn_mentor/rep_timesheetajax.php',
                        data: {"calculate_time" : "calculate_time","date" : date}
                    }).done(function(response) {
                    	remainingtime = response;
                    	
                    });   				
			    });
				
				$(".fn_mentor_ch").on("keypress keyup blur", function(event) {
					     $(this).val($(this).val().replace(/[^0-9\,]/g, ''));
						  if ((event.which != 58 ) && (event.which < 48 || event.which > 57)) {
						    event.preventDefault();
						  }
                    });
				
				$(document).on('click', '.rep_timesheet_edit', function() {
					  var id = this.id; console.log(id);
					  var rowid = id.split("-");
					  var mentorid = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(1)').text(); 
					  var cohort = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(3)').text();
					  var date = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(6)').text();
					  var ctype = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(4)').text();
					  var old_hours = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(7)').text();
			          var split_time = old_hours.split(":");
				      var new_hours = parseInt(split_time[0]);
					  var new_mins = parseInt(split_time[1]);
			          new_mins = Math.round(new_mins);

                      $('#'+rowid[0]+'_contributedhours').text('');  
					  var input_hours = '<input type="number" id="old_c_hours" name="time" value="'+new_hours+'" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;: <input type="number" id="old_c_mins" name="c_mins" value="'+new_mins+'" min="0" max="59" maxlength="2" style="width:50px;" required>';
					  $('#'+rowid[0]+'_contributedhours').append(input_hours);   
			 
					/*$(this).parent().siblings('td.data').each(function() {
     					    var content = $(this).html();
     					    $(this).html('<input value="' + content + '" />');
     					  });*/
					  
					  $.ajax({
		 					method: "GET",
		 					url: M.cfg.wwwroot + '/blocks/fn_mentor/rep_timesheetajax.php',
		 					data: {"add_mentors_ctypes" : "add_mentors_ctypes", "cohort" : cohort,"smeid" : mentorid,"date" :date, "ctype" : ctype },
                          success: function(response){
                        	  var responsedata = $.parseJSON(response);
                        	  var skill = '';
              				  var removeMentor = $('#'+rowid[0]+'_mentorname').text();
              				  var removeItem = $('#'+rowid[0]+'_ctypes').text();
              				  var removeSkill = $('#'+rowid[0]+'_skills').text();
              				
              				 $.each(responsedata, function(key, value) {
              					skill += 
  									 '<select id = "'+id+'_skillselect" class="mentorskillschange"><option value="'+removeSkill+'">'+removeSkill+'</option>';
		       					         var mentor_skills= value.skills.split(','); 
											$.each(mentor_skills, function(newkey, newvalue) {
												if(newvalue !== removeSkill) {
													skill += '<option value="'+newvalue+'">'+newvalue+'</option>';
												}
												
											})
		                          skill += '</select>';
								
              				 })
              				 
              			   
              				if($('#'+rowid[0]+'_skillselect option').length !=1) {
	                    	   	$('#'+rowid[0]+'_skillselect option').remove();
	                        }
              				$('#'+rowid[0]+'_skills').text('');  
              				$('#'+rowid[0]+'_skills').append(skill);
                               
                          }
		 				}).done(function( response ) {	
		 					if(response === "success"){
			 				       console.log("true");
			 					}
			 				});
				
					  
					  $(this).siblings('.rep_timesheet_save').show();
					  $(this).hide();
					});
				
				    $(document).on('change', '.mentorctypeschange', function() {
				    	  var id = this.id; 
						  var rowid = id.split("-");
						  var mentorid = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(1)').text(); 
						  var cohort = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(3)').text();
						  var ctype = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(4) option:selected').val();
						  var date = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(6)').text();
						  
						  var select = 'Select';
						  if(ctype.indexOf(select) != -1) {
							  
						  }
						  else {
							  $.ajax({
				 					method: "GET",
				 					url: M.cfg.wwwroot + '/blocks/fn_mentor/rep_timesheetajax.php',
				 					data: {"add_mentors_skills" : "add_mentors_skills", "cohort" : cohort,"smeid" : mentorid,"ctype" : ctype, "date" :date },
		                          success: function(response){
		                        	  var responsedata = $.parseJSON(response);
		              				  var input='';
		              				 $.each(responsedata, function(key, value) {
		              					input +=
		              						 '<select id = "'+id+'_skillselect" class="mentorskillschange"><option>Select Skill</option>';
		              					       var mentor_skills= value.skills.split(','); 
		  										$.each(mentor_skills, function(newkey, newvalue) {
		  											
		  											input += '<option value="'+newvalue+'">'+newvalue+'</option>';
		  										})
		  			                           input += '</select>';
		              				 })
		                         
		              				if($('#'+rowid[0]+'_skillselect option').length !=1) {
			                    	   	$('#'+rowid[0]+'_skillselect option').remove();
			                       }
		              				   $('#'+rowid[0]+'_skills').text('');
		                               $('#'+rowid[0]+'_skills').append(input);
		                          }
				 				}).done(function( response ) {	
				 					if(response === "success"){
					 				       console.log("true");
					 					}
					 				});
						  }
						  
						  
				    });

					

					$(document).on('click', '.rep_timesheet_save', function() {
					  
					  var id = this.id; 
					  var rowid = id.split("-");
					  var contributiontype = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(4)').text(); 
					  var skill = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(5) option:selected').val();
					  var date = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(6)').text();
					  var hours = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(7) #old_c_hours').val();
			          var mins = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(7) #old_c_mins').val();
					  var mentorid = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(1)').text();
			          var cohortname = $('#rep_updatedtimesheet_table #'+rowid[0]+' td:eq(3)').text();
					  var select = 'Select';
					  var hours_new = hours+':'+mins;
					  
		              if (hours_new.indexOf(":") <= 0) {
	                  		alert("Please enter valid contribution hours");
	                  }
					  
					  else {
						  var split_time = hours_new.split(":");
						  var new_hours = parseInt(split_time[0]);
						  var new_mins = parseInt(split_time[1]);
						  var mins_to_hours =  new_mins/60;
						  var totalhours = new_hours + mins_to_hours;
						  
						  if( (new_hours === '')  ||  (new_mins === '')){
							    //tablerow = '<tr><td></td><td><font color="red">Please fill the valuable hours of distribution</font></td></tr>';
								//$('#timesheet_add').find('.modal-body .table tbody').append(tablerow);
							  alert("Please enter valid contribution hours");
						  }
							else if(!(new_hours >= 0 && new_hours <=max_hrs) || !(new_mins >=0  && new_mins <=59)) {
								alert("The total hours contributed for the day cannot be greater than '+max_hrs+' hrs.");
							}
						  else if((new_hours == 0) && (new_mins == 0)) {
							  // tablerow = '<tr><td></td><td><font color="red">Please fill the valuable hours of distribution</font></td></tr>';
								//$('#timesheet_add').find('.modal-body .table tbody').append(tablerow);
							  alert("Please enter valid contribution hours");
						   }
						  else {
							  if(contributiontype.indexOf(select) != -1) {
								  alert("Please select Contribution type");
							  }
							  else if(skill.indexOf(select) != -1) {
								  alert("Please select skill");
							  }
							  else {
								  $.ajax({
				                        method: "GET",
				                        url: M.cfg.wwwroot + '/blocks/fn_mentor/rep_timesheetajax.php',
				                        data: {"update_timesheet" : "update_timesheet","rowid" : rowid[0],"ctype" : contributiontype,"skill" : skill, "hours" : totalhours,"date" : date, "mentorid" : mentorid,"cohortname" : cohortname}
				                    }).done(function(response) {
				                    	var error = 'exceeding';
				                    	var error1 = 'loggedin';
				                    	var ctypeerror = '****';
				                    	if(response.indexOf(error) != -1){

				                    		if(response.indexOf(ctypeerror) != -1) {
				                    			var split = response.split("****");
				                    			alert('You have already logged your contribution as '+ split[1] +' for the same day.');
				                    		}
				                    		else {
				                    			alert("The total hours contributed for the day cannot be greater than '+max_hrs+' hrs.");
				                    		}
				                    		//alert("The total hours contributed for the day cannot be greater than 8 hrs.");
				                    	}
				                    	
				                    	else {
				                    		$('input').each(function() {
				         					    var content = $(this).val();  
				         					    $(this).html(content);
				         					    $(this).contents().unwrap();
				         					  });
				                    		 var editid = id.replace('save','edit');
				                    		
				                    		$('#'+id).hide();
				                    		$('#'+editid).show();
				                    		
				                    		$('#'+rowid[0]+'_skills').empty();
				                    		$('#'+rowid[0]+'_skills').text(skill);
				                    		
				                    		setTimeout(function() {
				                    			$('#'+editid).prop('disabled', true);
				                    			$('#'+id).prop('disabled', true);
				                    	    },1800000);
				                    		
				                    		
				                    	}
				                    	
				                    });
							  }
							  
						  }
						  
						  
					  }
					  
					});
				/*----------------------------------------------------------------------------------------------------------*/
				$(document).on('click', '.rep_timesheet_open', function() {
					  var id = this.id; 
					  var rowid = id.split("-");
					  var smeid = $('#rep_availabletimesheet_table #'+rowid[0]+' td:eq(1)').text(); 
					  var cohort = $('#rep_availabletimesheet_table #'+rowid[0]+' td:eq(3)').text();
					  var ctype = $('#rep_availabletimesheet_table #'+rowid[0]+' td:eq(4)').text();
					  var skill = $('#rep_availabletimesheet_table #'+rowid[0]+' td:eq(5)').text();
					  var date = $('#rep_availabletimesheet_table #'+rowid[0]+' td:eq(6)').text();
					  
					  $.ajax({
		 					method: "GET",
		 					url: M.cfg.wwwroot + '/blocks/fn_mentor/rep_timesheetajax.php',
		 					data: {"add_rep_popup_details" : "add_rep_popup_details", "cohort" : cohort,"smeid" : smeid,"date" :date, "ctype" : ctype, "skill" : skill },
                            success: function(response){
                        	  var responsedata = $.parseJSON(response);
						      var tablerow='';
						     
							  $.each(responsedata, function(key, value) {
								  var today = (new Date()).toISOString().split('T')[0];
									
									tablerow += '<tr id="cohortname"><td style="width: 50%;">Cohort</td><td id="rep_cohortname" style="width: 50%;">'+value.cohortname+'</td></tr>';
									if(value.trainer) {
										$('#fn_mentor_sme_div').append('<label><b>Trainer Details : </b></label>');
										tablerow += 
											'<tr id="smeid"><td style="width: 50%;">Trainer ID</td><td id="mentor_idnumber" style="width: 50%;">'+value.smeid+'</td></tr>'+
											'<tr id="smename"><td style="width: 50%;">Trainer name</td><td id="mentor_name" style="width: 50%;">'+value.smename+'</td></tr>'+														
											'<tr id="mentoctypes"><td style="width: 50%;">Contribution Types</td><td id="mentor_ctype" style="width: 50%;">'+value.mentorctypes+'</td></tr>'+
                                            '<tr id="mskills"><td style="width: 50%;">Skills</td><td style="width: 50%;"><select id = "mentorskills">';											
										} else {
											$('#fn_mentor_sme_div').append('<label><b>SME Details : </b></label>');
									tablerow += 
									'<tr id="smeid"><td style="width: 50%;">SME ID</td><td id="mentor_idnumber" style="width: 50%;">'+value.smeid+'</td></tr>'+
									'<tr id="smename"><td style="width: 50%;">SME name</td><td id="mentor_name" style="width: 50%;">'+value.smename+'</td></tr>'+
									'<tr id="mentoctypes"><td style="width: 50%;">Contribution Types</td><td id="mentor_ctype" style="width: 50%;">'+value.mentorctypes+'</td></tr>'+
									'<tr id="mskills"><td style="width: 50%;">Skills</td><td style="width: 50%;"><select id = "mentorskills">';
									
										}
									var mentor_skills= value.skills.split(','); 
											$.each(mentor_skills, function(newkey, newvalue) {
												
												tablerow += '<option value="'+newvalue+'">'+newvalue+'</option>';
											})
				                           tablerow += '</select></td></tr>';
								    tablerow +=
   						            '<tr id="date"><td style="width: 50%;">Date</td><td id="start-time" style="width: 50%;">'+value.date+'</td></tr>'+
   						            '<tr id="hours"><td style="width: 50%;">Contribution Hours</td><td style="width: 50%;"> Hrs <input type="number" id="c_hours" name="time" min="0" max="24" maxlength="1" style="width:50px;" required>&nbsp;mins <input type="number" id="c_mins" name="c_mins" min="0" max="59" maxlength="2" style="width:50px;" required></td></tr>';
   					   
									
									$('#start-time').prop('max', today);
	                            })
                               
							   if($('#rep_timesheet_label tr').length !=0) {
					                $('#rep_timesheet_label tr').remove();
					            }
		                       
		                      $('#alertlabel').remove();
                              $('#fn_mentor_rep_div').removeAttr('hidden');
                              $('#rep_timesheet_add').find('#rep_timesheet_label tbody').append(tablerow);
                              $("#rep_timesheet_add").modal("show");
                          }
		 				}).done(function( response ) {	
		 					if(response === "success"){
			 				       console.log("true");
			 					}
			 				});
				
					  
					  $(this).siblings('.rep_timesheet_save').show();
					  $(this).hide();
					});
				/*----------------------------------------------------------------------------------------------------------*/
			});
			
			
		}
	};
	
});
define('block_fn_mentor/all_mentees_reviews', ['jquery'], function($) { 
	
	return { 
		init: function() {
			var url=  $(location).attr('href');
			var rootPath = M.cfg.wwwroot;
			$( document ).ready(function() {
				$("#filtermenteesfeedback").click( function() {
				    /*var mentorid = $('#fn_mentor_timesheet_smeid option:selected').text();
				    var bu = $('#fn_mentor_timesheet_bu option:selected').text();
				    var smegrade = $('#fn_mentor_timesheet_smegrades option:selected').text();
				    var cohort = $('#fn_mentor_timesheet_cohorts option:selected').text();
				    var lp = $('#fn_mentor_timesheet_lp option:selected').text();
				    var ctype = $('#fn_mentor_timesheet_ctypes option:selected').text();
					var ctypefromdate = $('#mentorctypefromdate').val();
					var ctypetodate = $('#mentorctypetodate').val();
					var reporttype = $('input[name="mentor_report"]:checked').val();
					if ( ! $(".fnmentortimesheetreport").is(':checked') ) {
						alert("Kindly provide report type");
					}
					
					else {
						if((mentorid =='Select') && ( bu =='Select') && (smegrade =='Select' ) &&(cohort =='Select' ) &&( lp =='Select') &&(ctype =='Select' ) &&( ctypefromdate =='') && ( ctypetodate =='')) {
							alert("Kindly provide any one filter");
						}
						else {
							if(reporttype == 'detailedreport') {
								
								$.ajax({
			                        method: "GET",
			                        url: M.cfg.wwwroot + '/blocks/fn_mentor/all_timesheetajax.php',
			                        data: {"action" : "get_report","reporttype" : reporttype,"mentorid" : mentorid,"bu" : bu, "smegrade" : smegrade, "cohort" : cohort, "lp" : lp, "ctype" : ctype, "ctypefromdate" : ctypefromdate, "ctypetodate" : ctypetodate}
			                    }).done(function(response) {
			                    	 var data = JSON.parse(response);
			                    	 var userdata =  JSON.parse(data.userData);
			                    	 var DataTable = "";
			                    	 DataTable = $('#migration_userreport_table').DataTable( {
			                         });   
			                         DataTable.clear().draw();
			                         DataTable.rows.add(userdata).draw();
			                    	
			                    });
								
							}
							else if(reporttype == 'summaryreport'){
								
								$.ajax({
			                        method: "GET",
			                        url: M.cfg.wwwroot + '/blocks/fn_mentor/all_timesheetajax.php',
			                        data: {"action" : "get_report","reporttype" : reporttype,"mentorid" : mentorid,"bu" : bu, "smegrade" : smegrade, "cohort" : cohort, "lp" : lp, "ctype" : ctype, "ctypefromdate" : ctypefromdate, "ctypetodate" : ctypetodate}
			                    }).done(function(response) {
			                    	var nodata = '****';
			                    	$('#mentortimeetstable_summary').removeAttr('hidden');
			                    	$('#mentortimeetstable_detailed').attr("hidden",true);
			                    	if(response.indexOf(nodata) != -1) {
			                    		if($('#mentortimeetstable_summary tbody tr').length != 0) {
				                    	   	$('#mentortimeetstable_summary tbody tr').remove();
				                        }
				                    	$('#mentortimeetstable_summary .odd').remove();
				                    	var emptydata = '<tr class="odd"><td valign="top" colspan="9" class="dataTables_empty">No data available in table</td></tr>';
				                    	$('#mentortimeetstable_summary tbody').append(emptydata);
			                    	}
			                    	else {
			                    		if($('#mentortimeetstable_summary tbody tr').length != 0) {
				                    	   	$('#mentortimeetstable_summary tbody tr').remove();
				                        }
				                    	$('#mentortimeetstable_summary .odd').remove();
				                    	$('#mentortimeetstable_summary tbody').append(response);
			                    	}
							
						});
								
							}
							
					     }
					}*/
			    });
				
				 $("#removefiltermenteesfeedback").click( function() {
				     $('#fn_mentor_mentee_idnumber').prop('selectedIndex',0);
				     $('#fn_mentor_mentee_bu').prop('selectedIndex',0);
				     $('#fn_mentor_mentee_cohorts').prop('selectedIndex',0);
				     $('#fn_mentor_mentee_lp').prop('selectedIndex',0);
				     $('#fn_mentor_mentee_ctypes').prop('selectedIndex',0);
				     $('#fn_mentee_feedback_rating').prop('selectedIndex',0);
					 $('input[name=mentor_report]').prop('checked',false);
					 $('#menteefbtable_detailed_div').attr("hidden",true);
					 $('#menteefbtable_summary_div').attr("hidden",true);
			    });

			});
		}
	};
});
define('block_fn_mentor/feedback', ['jquery'], function($) {
	return { 
		init: function() { 
			var url=  $(location).attr('href');
			
			$( document ).ready(function() {
				
				$("#menteefeedback").click( function() {
					location.replace(M.cfg.wwwroot + '/blocks/fn_mentor/mentee_feedback.php');
				});
				
				/*$("#menteefeedbacksubmit").click( function() {
					var tableid = $('.modal-body').find('.modaltbl').attr("id"); console.log(tableid);
					
					
					var ctype = $('#menteefeedbacktable').find('tbody').attr("id");
					var topics = $('#menteefeedbacktable tr:eq(0) td:eq(1) textarea').val();
					var additionalexarray = [];
					$('#menteefeedbacktable tr:eq(1) td:eq(1) input[name="rating_new"]:checked').each(function() {
						additionalexarray.push(this.value);
					});
					var selecttedex = additionalexarray.join(",");
					var sessioneff = $('#menteefeedbacktable tr:eq(2) td:eq(1) input:checked').val();
					var interationlevel = $('#menteefeedbacktable tr:eq(3) td:eq(1) input:checked').val();
					var comments = $('#menteefeedbacktable #menteesuggestion td:eq(1) textarea').val();
					
					$.ajax({
                        method: "GET",
                        url: M.cfg.wwwroot + '/blocks/fn_mentor/menteefeedbackajax.php',
                        data: {"menteefeedback" : "menteefeedback","smecontributiontype" : ctype,"topics" : topics, "sessioneff" : sessioneff, "interactionlevel": interationlevel,"selecttedex" : selecttedex, "comments" : comments}
                    }).done(function(response) {
                    	
                    });
				});*/
				
                 

				
                 
                 
			});
		}
	};
});
define('block_gamefy/gamefy', ['jquery'], function() {
	return {
		init: function(args) {

			var url=  $(location).attr('href');
			var rootPath = M.cfg.wwwroot;
			var level = args.level;
			var url = '';
			var group1html = '';
			var group2html = '';
			var learningpathid=0;
			var batchname=0;
			var batchstring=args.selectbatch;
			var noscore=args.notscored;	
			for(var i=1; i<=10; i++){            		            		            		
        		if(i <= 5) {
        			if(i <= level) {
        				url = M.cfg.wwwroot+'/blocks/gamefy/pix/star-selected.svg';            				
        			} else {
        				url = M.cfg.wwwroot+'/blocks/gamefy/pix/star-grey.svg';            				
        			}   
        			group1html += "<object class='star'"+i+" type='image/svg+xml' data='"+url+"'></object>";
        			if(i == 5){
        				$("#group1").html(group1html);
        			}
        		} else {
        			if(i <= level) {
        				url = M.cfg.wwwroot+'/blocks/gamefy/pix/star-selected.svg';
        			} else {
        				url = M.cfg.wwwroot+'/blocks/gamefy/pix/star-grey.svg';
        			}
        			group2html += "<object class='star'"+i+" type='image/svg+xml' data='"+url+"'></object>";
        			if(i == 10){
        				$("#group2").html(group2html);
        			}
        		}            		
    		}	
			
			$('document').ready(function(){
				var url=  $(location).attr('href');
				if(url.includes('/my')){
				//do nothing
				}else{
				
				  $('[data-toggle="tooltip"]').tooltip();
				}
				});
				
				
			$('document').ready(function(){
					var url=  $(location).attr('href');

                   if(url.includes('/my')){
                        $('#learningpaths').on('change', function() {
                            $('#batches').val(0);
							learningpathid=$( "#learningpaths option:selected" ).val();
							batchname=$( "#batches option:selected" ).val();
							//add toppers list into table
							 $.post( rootPath+"/blocks/gamefy/leader_ajax.php",{action: 'getdashboarddata',lpid:learningpathid,batchname:batchname})
							 .done(function( result ) {
								var tablerow='';
								//console.log(result);
								  if (result[1] === undefined){
								  tablerow +='<tr><td colspan="4" style="text-align: center;">'+noscore+'</td></tr>'; 
								  }
								  else{
									$.each(result, function(key, value) {
								 tablerow +='<tr><td>'+value.rank+'</td><td>'+value.name+'</td><td>'+value.xp+'</td><td>'+value.lvl+'</td></tr>';
								
									})
								 }
								
								$("#leaderboardtable  tbody").empty();
								$("#leaderboardtable tbody").append(tablerow);
								$('#learningpaths').val(learningpathid);
								
								var tablerow='';
								})
								
								
								//append dropdown values
								$.post( rootPath+"/blocks/gamefy/leader_ajax.php",{action: 'getbatchnames',lpid:learningpathid})
							 .done(function( result ) {
								
								 //console.log(result);
								 var select='<option value="0" disabled selected>'+batchstring+'</option>';
								 $.each(result, function(key, value) {
				
									 select +='<option value="'+value.profile3+'" >'+value.profile3+'</option>';
								 })
								$("#batches option").remove();
								$("#batches").append(select);
							 })
								
                        });
						
						
						$('#batches').on('change', function() {
						
						//batchname= $(this).find(":selected").val();
						learningpathid=$("#learningpaths option:selected").val();
						batchname=$("#batches option:selected").val();
						$.post( rootPath+"/blocks/gamefy/leader_ajax.php",{action: 'getdashboarddata',lpid:learningpathid,batchname:batchname})
							 .done(function( result ) {
								 var tablerow='';
								 //console.log()
								 if (result[1] === undefined){
								  tablerow +='<tr><td colspan="4" style="text-align: center;">'+noscore+'</td></tr>'; 
								  }else{
									$.each(result, function(key, value) {
								
										tablerow +='<tr><td>'+value.rank+'</td><td>'+value.name+'</td><td>'+value.xp+'</td><td>'+value.lvl+'</td></tr>';
									})
								}
								
								$("#leaderboardtable  tbody").empty();
								$("#leaderboardtable tbody").append(tablerow);
								$('#learningpaths').val(learningpathid);
								$('#batches').val(batchname);
								var tablerow='';
								 
							 })
						
                        });
                     }
              });            
		}
	}
});
define('block_gamefy/script', ["jquery","core/modal_factory"],function(e,t){return{init:function(){var t=e(location).attr("href"),o=(M.cfg.wwwroot,[]),n=[];e("document").ready(function(){var a,i=0;t.includes("/blocks/gamefy/")&&e('[title="Back to Learning Path"]').parent().remove(),e("document").ready(function(){t.includes("/my")||(e("#tooltip-demo").tooltip(),e("#tooltip-qcourse").tooltip(),e("#tooltip-vcm").tooltip(),e("#tooltip-vcourse").tooltip())}),t.includes("/gamefy/log_table.php")&&(e.ajax({method:"POST",url:M.cfg.wwwroot+"/blocks/gamefy/ajax.php",data:{choice:"get_User_Details"}}).done(function(t){data=e.parseJSON(t),e.each(data,function(e,t){o.push(t.name+"-"+t.id),n.push({id:t.id,name:t.name})}),function(t,o){var n;function l(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),n>=e.length&&(n=0),n<0&&(n=e.length-1),e[n].classList.add("autocomplete-active")}function r(e){for(var o=document.getElementsByClassName("autocomplete-items"),n=0;n<o.length;n++)e!=o[n]&&e!=t&&o[n].parentNode.removeChild(o[n])}t.addEventListener("input",function(l){var u,c,s,p=this.value;if(r(),!p)return!1;for(n=-1,(u=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),u.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(u),s=0;s<o.length;s++)(a=o[s].split("-"))[0].substr(0,p.length).toUpperCase()==p.toUpperCase()&&((c=document.createElement("DIV")).innerHTML="<strong>"+a[0].substr(0,p.length)+"</strong>",c.innerHTML+=a[0].substr(p.length),c.innerHTML+="<input type='hidden' value='"+a[0]+"'>",c.innerHTML+="<input id='userId' type='hidden' value='"+a[1]+"'>",c.addEventListener("click",function(o){t.value=this.getElementsByTagName("input")[0].value,i=this.getElementsByTagName("input")[1].value;var n=document.getElementById("searchName").value,a=M.cfg.wwwroot+"/blocks/gamefy/log_table.php",l=e('<form action="'+a+'" method="post"><input type="text" name="userid" value="'+i+'" /><input type="text" name="username" value="'+n+'" /></form>');e("body").append(l),l.submit()}),u.appendChild(c))}),t.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(n++,l(t)):38==e.keyCode?(n--,l(t)):13==e.keyCode&&n>-1&&t&&t[n].click()}),document.addEventListener("click",function(e){r(e.target)})}(document.getElementById("searchName"),o)}),e("#id_submitbutton").click(function(){if(0!=i){var t=document.getElementById("searchName").value,o=M.cfg.wwwroot+"/blocks/gamefy/log_table.php",n=e('<form action="'+o+'" method="post"><input type="text" name="userid" value="'+i+'" /><input type="text" name="username" value="'+t+'" /></form>');e("body").append(n),n.submit()}}),e("#searchName").keypress(function(t){if(13==t.keyCode){var o=e("#searchName").val();if(""!=o&&0!=i){console.log(i);var a=document.getElementById("searchName").value,l=M.cfg.wwwroot+"/blocks/gamefy/log_table.php",r=e('<form action="'+l+'" method="post"><input type="text" name="userid" value="'+i+'" /><input type="text" name="username" value="'+a+'" /></form>');e("body").append(r),r.submit()}else if(""!=o&&0==i){for(var u=0;u<n.length;u++)if(n[u].name.toUpperCase()===o.toUpperCase()){i=n[u].id;break}if(0!=i){l=M.cfg.wwwroot+"/blocks/gamefy/log_table.php",r=e('<form action="'+l+'" method="post"><input type="text" name="userid" value="'+i+'" /><input type="text" name="username" value="'+o+'" /></form>');e("body").append(r),r.submit()}else{l=M.cfg.wwwroot+"/blocks/gamefy/log_table.php",r=e('<form action="'+l+'" method="post"><input type="text" name="userid" value="'+i+'" /><input type="text" name="username" value="'+o+'" /></form>');e("body").append(r),r.submit()}}else location.replace(M.cfg.wwwroot+"/blocks/gamefy/log_table.php")}}),e("#user1").click(function(){e("#inone").remove(),location.replace(M.cfg.wwwroot+"/blocks/gamefy/log_table.php")}))}),e("document").ready(function(){e("body").on("click",function(t){e("[data-toggle=popover]").each(function(){e(this).is(t.target)||0!==e(this).has(t.target).length||0!==e(".popover").has(t.target).length||e(this).popover("hide")})})}),e("document").ready(function(){t.includes("/my")&&e(".page-aside").mouseenter(function(){setTimeout(function(){e("div.scrollable-container").scroll(function(){e(".popover").popover("hide")})},2e3)})})}}});
define('block_gamefy/leaderlog', ['jquery'], function() {
	return {
		init: function(args){
				
			CONFIG = args;
				
			var reporttype=CONFIG.reporttype;
			var url=  $(location).attr('href');
			var rootPath = M.cfg.wwwroot;
			
			$('document').ready(function(){
				
				$('#lpaths').on('change', function() {
					
					var lpath = $("#lpaths option:selected").val();
					if(reporttype === 'learningpath'){
					var url=rootPath+"/blocks/gamefy/leaderboard.php?id="+lpath
					}else{
					var url=rootPath+"/blocks/gamefy/report_table.php?p1="+lpath	
					}
					location.replace(url);
				});
				
				$('#obbatches').on('change', function() {
					var batches=$("#obbatches option:selected").val();
					var lpath = $("#lpaths option:selected").val();
					if(reporttype === 'learningpath'){
					var url=rootPath+"/blocks/gamefy/leaderboard.php?id="+lpath+"&name="+batches
					}else{
					var url=rootPath+"/blocks/gamefy/report_table.php?p1="+lpath+"&p3="+batches	
					}
					location.replace(url);
					
				});
				
				$('#profile24').on('change', function() {
					var lpath = $("#lpaths option:selected").val();
					var batches=$("#obbatches option:selected").val();
					var btype = $("#profile24 option:selected").val();
					if(reporttype === 'learningpath'){
					var url=rootPath+"/blocks/gamefy/leaderboard.php?id="+lpath+"&name="+batches+"&btn="+btype
					}else{
					var url=rootPath+"/blocks/gamefy/report_table.php?p1="+lpath+"&p3="+batches+"&inst="+btype	
					}
					location.replace(url);
					
				});
				
				$('#profile23').on('change', function() {
					var lpath = $("#lpaths option:selected").val();
					var batches=$("#obbatches option:selected").val();
					var btype = $("#profile24 option:selected").val();
					var cohort =$("#profile23 option:selected").val();
					if(reporttype === 'learningpath'){
					var url=rootPath+"/blocks/gamefy/leaderboard.php?id="+lpath+"&name="+batches+"&btn="+btype+"&cid="+cohort
					}else{
					var url=rootPath+"/blocks/gamefy/report_table.php?p1="+lpath+"&p3="+batches+"&inst="+btype+"&cid="+cohort	
					}
					location.replace(url);
					
				});
				
				$('input[name=groupOfDefaultRadios]').click(function(){
					var idval = $(this).attr('id');
					var url=rootPath+"/blocks/gamefy/report_table.php?name="+idval	
					location.replace(url);
				});
				
				$('.levelpoints').click(function(){
					var lpath = $("#lpaths option:selected").val();
					var url=rootPath+"/blocks/gamefy/info_table.php?lpath="+lpath	
					 window.open(url, '_blank');
				});
				
				
			});
		
	
	  }
	}
})
define('block_helpdesk/assign', ['jquery'], function($) {

    return {

        init: function() {    
        	
        	$( document ).ready(function() {
        		var tagspanexid = 1;
        		var tagex = 1;
        		var final = [];
                var finalJson = [];
                
        		$("#tagexclude").on("mouseup",function() {
        			var nameJson = JSON.stringify(finalJson);
        			var tagstr=$("#tagexclude").val();
                    if(tagstr!=''){
                    	var flag = 0;
     					$.each(JSON.parse(nameJson) , function (key, value) {
        					 if(tagstr === value.name){
        					   flag = 1;
        					 }         					 
        				});
     					if(flag == 1) {
     						tagex=tagex+1;
             				tagspanexid=tagspanexid+1;
         					var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
         					var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
         					spant.append(st);       
         					$('#error').remove();         					
         					$('#cdropdown').prepend('    ');
         					$('#cdropdown').prepend(spant); 
							$("#tagexclude").val(''); 
     					} else {
     						$('#error').remove();         					
     					}                  	                    	                  	
                    } else {
		            	$('#error').remove();       					
		            }
                 });
         		 
         		 $("#tagexclude").keypress(function(e) {
         			 if(e.which == 13) {    
         				var nameJson = JSON.stringify(finalJson);         				
         				var tagstr=$("#tagexclude").val();
         				if(tagstr!=''){
         					var flag = 0;
         					$.each(JSON.parse(nameJson) , function (key, value) {
            					 if(tagstr === value.name){
            					   flag = 1;
            					 }         					 
            				});
         					if(flag == 1) {
         						tagex=tagex+1;
                 				tagspanexid=tagspanexid+1;
             					var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
             					var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
             					spant.append(st);       
             					$('#error').remove();
             					$('#cdropdown').prepend('    ');
         						$('#cdropdown').prepend(spant); 
								$("#tagexclude").val('');  
         					} else {
         						$('#error').remove();             					
         					}         					       					         			
         				} else {
			            	$('#error').remove();	         					
			            }	
         			 }
         		 });  
         		 
         		function autocomplete(inp, arr) {
	 				
					  /*the autocomplete function takes two arguments,
					  the text field element and an array of possible autocompleted values:*/
					  var currentFocus;
					  /*execute a function when someone writes in the text field:*/
					  inp.addEventListener("input", function(e) {
					      var a, b, i, val = this.value;
					      /*close any already open lists of autocompleted values*/
					      
					      closeAllLists();
					      if (!val) { return false;}
					      currentFocus = -1;
					      /*create a DIV element that will contain the items (values):*/
					      a = document.createElement("DIV");
					      a.setAttribute("id", this.id + "autocomplete-list");
					      a.setAttribute("class", "autocomplete-items");
					      /*append the DIV element as a child of the autocomplete container:*/
					      this.parentNode.appendChild(a);
					      /*for each item in the array...*/
					      for (i = 0; i < arr.length; i++) {
					    	  res = arr[i].split("-");
					        /*check if the item starts with the same letters as the text field value:*/
					        if (res[0].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
					          /*create a DIV element for each matching element:*/
					        	b = document.createElement("DIV");
					          /*make the matching letters bold:*/
					          b.innerHTML = "<strong>" + res[0].substr(0, val.length) + "</strong>";
					          b.innerHTML += res[0].substr(val.length);
					          /*insert a input field that will hold the current array item's value:*/
					          b.innerHTML += "<input type='hidden' value='" + res[0] + "'>";
					          b.innerHTML += "<input id='userId' type='hidden' value='" + res[1] + "'>";
					          /*execute a function when someone clicks on the item value (DIV element):*/
					              b.addEventListener("click", function(e) {
					              /*insert the value for the autocomplete text field:*/
					              inp.value = this.getElementsByTagName("input")[0].value;
					              id = this.getElementsByTagName("input")[1].value;
					              var tagstr=$("#tagexclude").val();
					              if(tagstr != '') {
					            	  tagex=tagex+1;
			             				tagspanexid=tagspanexid+1;
			             				var temp = tagstr.concat('-', id);
			             				if(final.indexOf(temp) >= 0) {
			             					var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
				         					var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
				         					spant.append(st);   
				         					$('#error').remove();				         					
				         					$('#cdropdown').prepend('    ');
				         					$('#cdropdown').prepend(spant);
											$("#tagexclude").val(''); 											
			             				} else {
			             					$('#error').remove();				         					
				         					$("#tagexclude").val('');
			             				}			         					
					              } else {
					            	  $('#error').remove();			         					
					              }			              			         							         				
					              closeAllLists();					              
					          });
					          a.appendChild(b);
					        }
					      }
					  });
					  /*execute a function presses a key on the keyboard:*/
					  inp.addEventListener("keydown", function(e) {
					      var x = document.getElementById(this.id + "autocomplete-list");
					      if (x) x = x.getElementsByTagName("div");
					      if (e.keyCode == 40) {
					    	
					        /*If the arrow DOWN key is pressed,
					        increase the currentFocus variable:*/
					        currentFocus++;
					        
					        /*and and make the current item more visible:*/
					        addActive(x);
					        
					      } else if (e.keyCode == 38) { //up
					        /*If the arrow UP key is pressed,
					        decrease the currentFocus variable:*/
					        currentFocus--;
					        /*and and make the current item more visible:*/
					        addActive(x);
					      } else if (e.keyCode == 13) {
					        /*If the ENTER key is pressed, prevent the form from being submitted,*/
					        
					        if (currentFocus > -1) {
					          /*and simulate a click on the "active" item:*/
					          if (x) x[currentFocus].click();
					        }
					      }
					  });
					  function addActive(x) {
					    /*a function to classify an item as "active":*/
					    if (!x) return false;
					    /*start by removing the "active" class on all items:*/
					    removeActive(x);
					    if (currentFocus >= x.length) currentFocus = 0;
					    if (currentFocus < 0) currentFocus = (x.length - 1);
					    /*add class "autocomplete-active":*/
					    x[currentFocus].classList.add("autocomplete-active");
					  }
					  function removeActive(x) {
					    /*a function to remove the "active" class from all autocomplete items:*/
					    for (var i = 0; i < x.length; i++) {
					      x[i].classList.remove("autocomplete-active");
					    }
					  }
					  function closeAllLists(elmnt) {
					    /*close all autocomplete lists in the document,
					    except the one passed as an argument:*/
					    var x = document.getElementsByClassName("autocomplete-items");
					    for (var i = 0; i < x.length; i++) {
					      if (elmnt != x[i] && elmnt != inp) {
					      x[i].parentNode.removeChild(x[i]);
					    }
					  }
					}
					/*execute a function when someone clicks in the document:*/
					document.addEventListener("click", function (e) {
					    closeAllLists(e.target);					    
					});
				} 
         		
         		$.ajax({
                    method: "POST",
                    url: M.cfg.wwwroot + '/blocks/helpdesk/search_ajax.php',
                    data: {"action" : "get_User_Details", "cap" : "block/helpdesk:answer" }
         		}).done(function( response ) {                    
         			data = $.parseJSON(response);
         			$.each(data, function (i,v)  {
         				final.push(v.email+'-'+v.id);
         				finalJson.push({
         					"id" : v.id,
         					"name" : v.email
         				});
         			});                   
         			autocomplete(document.getElementById("tagexclude"), final);
         		});         		
        	});

			$("#category").change(function(){   
				$categoryid = $("#category option:selected").val();
				$("#courseone1").load('search_ajax.php', 'action=get_courses'+ '&categoryid='+$categoryid);
			});
			
			$("#courseone1").change(function(){   				
				$courseid = $("#courseone1 option:selected").val();
				$('#cdropdown').find('br').remove();
				$('#cdropdown').find('span').remove();
				if($courseid != '') {
					$.ajax({
						method: "POST",
						url: M.cfg.wwwroot + '/blocks/helpdesk/search_ajax.php',
						data: {
							"action" : "get_assigned_user", 
							"courseid" : $courseid						
						}
					}).done(function( response ) {                    
						if(response !== 'nodata') {
							data = $.parseJSON(response);
							$i = 1;							
         					$.each(data, function (i,v)  {
								var st = $('<button type="button" id="exdata'+$i+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
					         	var spant = $('<span id="exspan'+$i+'" class="tag label label-info" value='+v.email+'>'+v.email+'</span>');
					         	spant.append(st);   
				         		$('#error').remove();				         	
				         		$('#cdropdown').prepend('    ');
				         		$('#cdropdown').prepend(spant);  
								$i += 1;       						
         					}); 							
						} 
					});	
				} else {
					$("#courseone1").append("<span style=\"color:#fb6464;\">*Course is required.</span>");
				}				
			});
			
			$("#tag").change(function(){   
				$tagid = $("#tag option:selected").val();
				$("#courseone1").load('search_ajax.php', 'action=get_courses'+ '&tagid='+$tagid);				
			});
        	
        	$("#auto_assign").click(function(){
        		var usernames = '';
        		var count = 0;
        		$("#cdropdown").find('span').each(function() { 
        			var tagids = this.id;
        			if(tagids!=''){
        				count = count + 1;
        				var tagstr=$('#'+tagids).text();
						tagstr = tagstr.substring(0, tagstr.length-1);
       		 			usernames = usernames+tagstr+',';        				        				
        			}
       		 	});  
				usernames = usernames.substring(0, usernames.length-1);
        		var courseid = $("#courseone1 option:selected").val();
        		var relatedto = $("#relatedto option:selected").val();
        		if(count != 0){
        			if(courseid != '' && relatedto!='') {  
						if(courseid === "all") {
							$tagid = $("#tag option:selected").val();
							$.ajax({
                            	method: "POST",
                            	url: M.cfg.wwwroot + '/blocks/helpdesk/search_ajax.php',
                            	data: {
                            		"action" : "auto_assign", 
                            		"tagid" : $tagid,
                            		"userlist" : usernames,
                            		"relatedto" : relatedto
                            	}
                 			}).done(function( response ) {                    
                 				location.replace(M.cfg.wwwroot + '/blocks/helpdesk/auto_assign.php');
                 			});
						} else {
							$.ajax({
                            	method: "POST",
                            	url: M.cfg.wwwroot + '/blocks/helpdesk/search_ajax.php',
                            	data: {
                            		"action" : "auto_assign", 
                            		"courseid" : courseid,
                            		"userlist" : usernames,
                            		"relatedto" : relatedto
                            	}
                 			}).done(function( response ) {                    
                 				location.replace(M.cfg.wwwroot + '/blocks/helpdesk/auto_assign.php');
                 			});
						}    				        				 
        			} else {
        				if(courseid == '') {
        					$("#courseone1").append("<span style=\"color:#fb6464;\">*Course is required.</span>");
        				}
        				if(relatedto == '') {
        					$("#relatedto").append("<span style=\"color:#fb6464;\">*Relatedto is required.</span>");
        				}
        			}        			
        		} else {
        			$("#cdropdown").prepend("<span id='error' style=\"color:#fb6464;\">*User is required.</span><br>");
        		}
        	});
        }
    };
});
define('block_helpdesk/faq', ['jquery'], function($) {

    return {

        init: function() {         	        
        	
        	var url=  $(location).attr('href');
        	var rootPath = M.cfg.wwwroot;        	
        	$('document').ready(function(){        		        		        		     		               
        		        		
        		var $relatedTo = $('#id_relatedto'); 
    			var $subjectSelect = $("#id_summary");
    			var $courseSelect = $("#id_course");
    			var $sectionSelect = $("#id_section"); 
    			var $activitySelect = $('#id_activity'); 
    			 	    			
    			var $summary;    	
    			var $course;
    			var $section;
    			var $activity;
    			
    			$summary = $("#id_frm .fitem:nth-child(2)");    			
    			$course = $("#id_frm .fitem:nth-child(3)");
    			$section = $("#id_frm .fitem:nth-child(4)");
    			$activity = $("#id_frm .fitem:nth-child(5)");    			    			
    			
    			//Let ensure double clicks don't result in many tickets and responses as first thing
        		if (url.includes("helpdesk/faq.php")){ 
        			$("#mform1").on('submit', function(e){
        				document.querySelector('input[type=submit]').disabled=true;        				
        				if(!$subjectSelect.prop('required')){
        					$subjectSelect.children('option').remove();     
                    		$subjectSelect.append('<option value="">Select an issue</option>');
        				}
        				if(!$courseSelect.prop('required')){
        					$courseSelect.children('option').remove();     
        					$courseSelect.append('<option value="">Select an issue</option>');
        				}
        				if(!$sectionSelect.prop('required')){
        					$sectionSelect.children('option').remove();     
        					$sectionSelect.append('<option value="">Select an issue</option>');
        				}
        				if(!$activitySelect.prop('required')){
        					$activitySelect.children('option').remove();     
        					$activitySelect.append('<option value="">Select an issue</option>');
        				}
        			});
        		}
        		    			
    			if(url.includes('blocks/helpdesk/faq.php')){ 
    				$summary.removeClass('show');
    				$summary.addClass('hidden');    				
    				$course.removeClass('show');
    				$course.addClass('hidden');
    				$section.removeClass('show');
    				$section.addClass('hidden');
    				$activity.removeClass('show');
    				$activity.addClass('hidden');
        		}
    			        	       	     
				$flag = 0;
				$checkRelated = 0;
    			$relatedTo.change(function(){    				
    				$issubject = 1;    				
    				$checkRelated = 0;
    				$flag = 0;
    				var $issueRelatedTo = $('#id_relatedto option:selected').val();
    				
    				if($issueRelatedTo == ''){
    					$summary.removeClass('show');
    					$summary.addClass('hidden');    					
    					$course.removeClass('show');
    					$course.addClass('hidden');
    					$section.removeClass('show');
    					$section.addClass('hidden');
    					$activity.removeClass('show');
    					$activity.addClass('hidden');    					
    					$subjectSelect.prop('required',false);
    					$courseSelect.prop('required',false);
            			$sectionSelect.prop('required',false);
            			$activitySelect.prop('required',false);
    				}
    				document.querySelector('input[type=submit]').disabled=true;
					$.ajax({
						method: "GET",
						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
						data: {"action" : "checkRelated" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject}
					}).done(function( response ) {
						document.querySelector('input[type=submit]').disabled=false;
						var res = response.split("-");
						var related = res[0];
						var subject = res[1];
						if(related === "course"){
							$checkRelated = 1;
						}
						if(subject === "success"){
							$flag = 1;
						}
					}); 
					
    				setTimeout(function(){    					
    					if($flag == 1){    										
	    					$course.removeClass('show');
	    					$course.addClass('hidden');
	    					$section.removeClass('show');
	    					$section.addClass('hidden');
	    					$activity.removeClass('show');
	    					$activity.addClass('hidden');
    						$summary.removeClass('hidden');
        					$summary.addClass('show'); 
        					$subjectSelect.prop('required',true);        					            				
        					$courseSelect.prop('required',false);
                			$sectionSelect.prop('required',false);
                			$activitySelect.prop('required',false);
    						$subjectSelect.load('new_ajax.php', 'action=loadSubject'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject);    						
    					} else {        						
    						if($checkRelated == 1){
								$summary.removeClass('show');
            					$summary.addClass('hidden');             					
            					$subjectSelect.prop('required',false);            					
    							$course.removeClass('hidden');
    							$course.addClass('show'); 
    							$courseSelect.prop('required',true);
    							$activity.removeClass('hidden');
    	    					$activity.addClass('show');                	    					
                    			$activitySelect.prop('required',true);
                    			$courseSelect.load( 'ajax.php', 'relatedto='+ $issueRelatedTo);
    							
    							setTimeout(function() {
    								var $temp = 0;
    	        					if($courseSelect.val() != null){
    	        						$temp = Number($courseSelect.val().trim());
    	        					}    	        					        	    					
    	        					if($temp != 0){ 
    	        						$sectionSelect.load('ajax.php', 'course_id='+ $temp + '&related_to='+$issueRelatedTo+'&section=all');
    	                            	setTimeout(function(){            	                            		
    	                            		if($sectionSelect.val() != null){
    	                            			$section.removeClass('hidden');
                    	    					$section.addClass('show');
                    	    					$sectionSelect.prop('required',true);
            	        						$sectionid = Number($sectionSelect.val().trim());
            	        						$activitySelect.load('ajax.php', 'loadactivity=activity&courseid='+$temp+'&sectionid='+$sectionid+'&related='+$issueRelatedTo);
            	        					} else {
            	        						$section.removeClass('show');
                    	    					$section.addClass('hidden');
                    	    					$sectionSelect.prop('required',false);
            	        						$activitySelect.load('ajax.php', 'course_id='+ $temp + '&related_to='+$issueRelatedTo );
            	        					}                	                                
    	                            	},500);            	                            	
    	                            } else{             	                            	
    	                            	$courseSelect.children('option').remove();                                       		
	                            		$courseSelect.append('<option value="">Select a course/issue</option>');
    	                            	$sectionSelect.children('option').remove();     
    	                            	$sectionSelect.append('<option value="">Select a section/issue</option>');
    	                            	$activitySelect.children('option').remove();     
    	                            	$activitySelect.append('<option value="">Select an activity/issue</option>');                            	            
    	                             }
    							},500);
    						}        						        						
    					}
    				},500);
    			});
    			
    			var $subject_content = '';
    			$subjectSelect.change(function(){    				
    				$section.removeClass('show');
					$section.addClass('hidden');
					$activity.removeClass('show');
					$activity.addClass('hidden');					
					$sectionSelect.prop('required',false);
        			$activitySelect.prop('required',false);
    				$issueRelatedTo = $('#id_relatedto option:selected').val();
    				$subject_content = $('#id_summary option:selected').val();
    				$check_subject = 0;
    				$issubject = 2;
    				document.querySelector('input[type=submit]').disabled=true;
    				if($subject_content != ''){
    					$.ajax({
    						method: "GET",
    						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
    						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $subject_content}
    					}).done(function( response ) {	
    						document.querySelector('input[type=submit]').disabled=false;
    						if(response === "failure"){
    							$check_subject = 1;
    						}
    					});
        				
        				setTimeout(function() {
        					if($checkRelated == 0){        					
        						if($check_subject == 0){
        							$course.removeClass('hidden');
        	    					$course.addClass('show');
        	    					$courseSelect.prop('required',true);
        							$courseSelect.load('new_ajax.php', 'action=loadCourse'+ '&relatedTo='+$issueRelatedTo+'&subject_content='+$subject_content+'&isSubject='+$issubject);
            					} else {
            						$course.removeClass('show');
        	    					$course.addClass('hidden');
        	    					$courseSelect.prop('required',false); 
        	    					if($('#id_summary option:selected').val() != ''){            		    						
    		                    		$.ajax({
    		                    			method: "GET",
    		                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
    		                    			data: {
    		                    				"action" : "faq" , 
    		                    				"relatedTo" : $issueRelatedTo , 
    		                    				"subject_content" : $subject_content
    		                    			}
    		                    		}).done(function( response ) {                        			
    		                    				if(response !== 'failure'){
    		                    					$('#id_detail_editoreditable').html(response);
    		                    				} else {
    		                    					$('#id_detail_editoreditable').html("");
    		                    				}                        			                        			
    		                             });
    		                         }
            					}      					
            				} else {
            					$course.removeClass('hidden');
    	    					$course.addClass('show');
    	    					$courseSelect.prop('required',true);
            					$courseSelect.load('new_ajax.php', 'action=loadCourse'+ '&relatedTo='+$issueRelatedTo +'&subject_content='+$subject_content+'&isSubject='+$issubject);
            				}    					
        				},500);
    				} else {
    					$course.removeClass('show');
    					$course.addClass('hidden');
    					$courseSelect.prop('required',false);
    				}    				    				    				    					    		
    			});
    			
    			$courseSelect.change(function(){    				
    				$issueRelatedTo = $('#id_relatedto option:selected').val();    				
    				$subject_content = $('#id_summary option:selected').val();
    				$course_content = $('#id_course option:selected').val();
    				$issubject = 3;
    				$check_subject = 0;
    				if($course_content != ''){
    					document.querySelector('input[type=submit]').disabled=true;
    					$.ajax({
    						method: "GET",
    						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
    						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $course_content}
    					}).done(function( response ) {	
    						document.querySelector('input[type=submit]').disabled=false;
    						if(response === "failure"){
    							$check_subject = 1;
    						} else if(response === "course"){
    							$check_subject = 2;
    						}
    					});
    					
    					setTimeout(function() {    						
    						if($check_subject == 1){
								$section.removeClass('show');
		    					$section.addClass('hidden');
		    					$activity.removeClass('show');
		    					$activity.addClass('hidden');		    					
		    					$sectionSelect.prop('required',false);
		            			$activitySelect.prop('required',false);
		            			if($('#id_course option:selected').val() != ''){            		    						
		                    		$.ajax({
		                    			method: "GET",
		                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
		                    			data: {
		                    				"action" : "faq" , 
		                    				"relatedTo" : $issueRelatedTo , 
		                    				"subject_content" : $subject_content,
		                    				"course_content" : $course_content
		                    			}
		                    		}).done(function( response ) {                        			
		                    				if(response !== 'failure'){
		                    					$('#id_detail_editoreditable').html(response);
		                    				} else {
		                    					$('#id_detail_editoreditable').html("");
		                    				}                        			                        			
		                             });
		                         }
							} else {										
								$sectionSelect.load('new_ajax.php', 'action=loadSection'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject+'&subject_content='+$subject_content +'&course_content='+$course_content);
								$temp = Number($courseSelect.val().trim());
								setTimeout(function(){
									if($sectionSelect.val() != null){
										$section.removeClass('hidden');
										$section.addClass('show');
										$sectionSelect.prop('required',true);
										$section_subject = $sectionSelect.val();
										$issubject = 4;
										$check_subject = 0;
										document.querySelector('input[type=submit]').disabled=true;
										$.ajax({
				    						method: "GET",
				    						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
				    						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $section_subject}
				    					}).done(function( response ) {								
				    						document.querySelector('input[type=submit]').disabled=false;
				    						if(response === "failure"){
				    							$check_subject = 1;
				    						} else if(response === "course"){
				    							$check_subject = 2;
				    						}
				    					});
										
										setTimeout(function(){
											if($check_subject == 1){
												$section_subject = $sectionSelect.val();
												$activity.removeClass('show');
						    					$activity.addClass('hidden');
						    					$activitySelect.prop('required',false);
						    					if($('#id_course option:selected').val() != ''){            		    						
						                    		$.ajax({
						                    			method: "GET",
						                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
						                    			data: {
						                    				"action" : "faq" , 
						                    				"relatedTo" : $issueRelatedTo , 
						                    				"subject_content" : $subject_content,
						                    				"course_content" : $course_content,
						                    				"section_content" : $section_subject
						                    			}
						                    		}).done(function( response ) {                        			
						                    			if(response !== 'failure'){
					                    					$('#id_detail_editoreditable').html(response);
					                    				} else {
					                    					$('#id_detail_editoreditable').html("");
					                    				}                        			                        			
						                             });
						                         }
											} else {
												$activity.removeClass('hidden');
						    					$activity.addClass('show');
						    					$activitySelect.prop('required',true);
												$sectionid = Number($section_subject.trim());
												if(isNaN($sectionid) == true){
													$activitySelect.load('new_ajax.php', 'action=loadActivity'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject+'&course_content='+$section_subject);
												} else {
													$activitySelect.load('ajax.php', 'loadactivity=activity&courseid='+$temp+'&sectionid='+$sectionid+'&related='+$issueRelatedTo);
												}													
											}
										},800);
									} else {
										$section.removeClass('show');
            	    					$section.addClass('hidden');
            	    					$sectionSelect.prop('required',false);
            	    					$activity.removeClass('hidden');
            	    					$activity.addClass('show');                	    					
                            			$activitySelect.prop('required',true);	
                            			$activitySelect.load('ajax.php', 'course_id='+ $temp + '&related_to='+$issueRelatedTo );
									}								
								},500);								
							}
    						
    					},500);
    				} else {
    					$section.removeClass('show');
    					$section.addClass('hidden');
    					$activity.removeClass('show');
    					$activity.addClass('hidden');    					
    					$sectionSelect.prop('required',false);
            			$activitySelect.prop('required',false);
    				}    				
    			});
    			
    			$sectionSelect.change(function(){    				
    				$issueRelatedTo = $('#id_relatedto option:selected').val(); 
    				$temp = Number($courseSelect.val().trim());
    				$subject_content = $('#id_summary option:selected').val();
    				$course_content = $('#id_course option:selected').val();
    				$section_subject = $sectionSelect.val();
    				$issubject = 4;
					$check_subject = 0;
					document.querySelector('input[type=submit]').disabled=true;
					$.ajax({
						method: "GET",
						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $section_subject}
					}).done(function( response ) {	
						document.querySelector('input[type=submit]').disabled=false;
						if(response === "failure"){
							$check_subject = 1;
						} else if(response === "course"){
							$check_subject = 2;
						}
					});
					setTimeout(function(){
						if($check_subject == 1){
							$activity.removeClass('show');
	    					$activity.addClass('hidden');
	    					$activitySelect.prop('required',false);
	    					if($('#id_section option:selected').val() != ''){            		    						
	                    		$.ajax({
	                    			method: "GET",
	                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
	                    			data: {
	                    				"action" : "faq" , 
	                    				"relatedTo" : $issueRelatedTo , 
	                    				"subject_content" : $subject_content,
	                    				"course_content" : $course_content,
	                    				"section_content" : $section_subject	                    				
	                    			}
	                    		}).done(function( response ) {                        			
	                    				if(response !== 'failure'){
	                    					$('#id_detail_editoreditable').html(response);
	                    				} else {
	                    					$('#id_detail_editoreditable').html("");
	                    				}                        			                        			
	                             });
	                         }
						} else {
							$activity.removeClass('hidden');
	    					$activity.addClass('show');
	    					$activitySelect.prop('required',true);
							$sectionid = Number($section_subject.trim());
							if(isNaN($sectionid) == true){
								$activitySelect.load('new_ajax.php', 'action=loadActivity'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject+'&course_content='+$section_subject);
							} else {
								$activitySelect.load('ajax.php', 'loadactivity=activity&courseid='+$temp+'&sectionid='+$sectionid+'&related='+$issueRelatedTo);
							}							
						}
					},800);
    			});
    			
    			$activitySelect.change(function(){
    				$relatedto = $('#id_relatedto option:selected').val();
        			$subject_content = $('#id_summary option:selected').val();
    				$course_content = $('#id_course option:selected').val();
    				$section_subject = $sectionSelect.val();
        			$activity = $('#id_activity option:selected').val();            			
        			if($activity != ''){            		    						
                		$.ajax({
                			method: "GET",
                			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
                			data: {
                				"action" : "faq" , 
                				"relatedTo" : $relatedto , 
                				"subject_content" : $subject_content,
                				"course_content" : $course_content,
                				"section_content" : $section_subject,
                				"activity_content" : $activity
                				}
                		}).done(function( response ) {                        			
                				if(response !== 'failure'){
                					$('#id_detail_editoreditable').html(response);
                				} else {
                					$('#id_detail_editoreditable').html("");
                				}                        			                        			
                         });
                     }
    			});
        });
       }
    };
});
define('block_helpdesk/script', ["jquery"],function(e){return{init:function(){var t=e(location).attr("href");M.cfg.wwwroot;e("document").ready(function(){(t.includes("helpdesk/update.php")||t.includes("helpdesk/new.php"))&&e("#mform1").on("submit",function(e){document.querySelector("input[type=submit]").disabled=!0});var d,i,o;e("#page-header").append(' <div id="confirmActionModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog" > <div class="modal-content"> <div class="modal-headers"> <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;"> </h4> </div> <div class="modal-body" ></div> <div class="modal-footer"> <button type="button" class="btn btn-info" id="ticketgotinfo" aria-expanded="false"  > Got Required Information </button> <button type="button" class="btn btn-default" id="ticketcontinue" aria-expanded="false" >Continue Raising Ticket</button> </div> </div> </div></div>');var l=e("#id_relatedto"),a=e("#id_summary"),s=e("#id_section"),n=e("#id_activity"),c=e("#id_others");t.includes("blocks/helpdesk/new.php")?(d=e("#id_frm .fitem:nth-child(5)"),$section=e("#id_frm .fitem:nth-child(4)"),o=e("#id_frm .fitem:nth-child(3)"),i=e("#id_frm .fitem:nth-child(2)")):t.includes("blocks/helpdesk/edit.php")&&(d=e("#id_frm .fitem:nth-child(6)"),$section=e("#id_frm .fitem:nth-child(5)"),o=e("#id_frm .fitem:nth-child(4)"),i=e("#id_frm .fitem:nth-child(3)")),t.includes("blocks/helpdesk/new.php")&&(e(document).on("click","#ticketcontinue",function(t){e("#confirmActionModal").modal("hide")}),e(document).on("click","#ticketgotinfo",function(t){e("#confirmActionModal").modal("hide"),location.replace(M.cfg.wwwroot+"/my")})),$count=0,l.change(function(){var l=e("#id_relatedto option:selected").val();if(0==l.length?($section.removeClass("show"),$section.addClass("hidden"),d.removeClass("show"),d.addClass("hidden"),i.removeClass("show"),i.addClass("hidden"),o.removeClass("show"),o.addClass("hidden"),c.prop("required",!1),s.prop("required",!1),n.prop("required",!1)):"Content / Course"===l||"Hands-On"===l?(i.removeClass("hidden"),i.addClass("show"),$section.removeClass("hidden"),$section.addClass("show"),d.removeClass("hidden"),d.addClass("show"),o.removeClass("show"),o.addClass("hidden"),c.prop("required",!1),s.prop("required",!0),n.prop("required",!0),t.includes("blocks/helpdesk/new.php")?(e("#id_frm .fitem:nth-child(2) div.col-md-3 label").text("Select a course"),e("#id_frm .fitem:nth-child(5) div.col-md-3 label").text("Select an activity")):t.includes("blocks/helpdesk/edit.php")&&(e("#id_frm .fitem:nth-child(3) div.col-md-3 label").text("Select a course"),e("#id_frm .fitem:nth-child(6) div.col-md-3 label").text("Select an activity"))):"Contest / Mock"===l||"Knockout Challenge"===l?(i.removeClass("hidden"),i.addClass("show"),$section.removeClass("hidden"),$section.addClass("show"),d.removeClass("hidden"),d.addClass("show"),o.removeClass("show"),o.addClass("hidden"),c.prop("required",!1),s.prop("required",!0),n.prop("required",!0),t.includes("blocks/helpdesk/new.php")?(e("#id_frm .fitem:nth-child(2) div.col-md-3 label").text("Select your "+e("#id_relatedto option:selected").text()),e("#id_frm .fitem:nth-child(5) div.col-md-3 label").text("Select your activity / issue")):t.includes("blocks/helpdesk/edit.php")&&(e("#id_frm .fitem:nth-child(3) div.col-md-3 label").text("Select your "+e("#id_relatedto option:selected").text()),e("#id_frm .fitem:nth-child(6) div.col-md-3 label").text("Select your activity / issue"))):(i.removeClass("hidden"),i.addClass("show"),$section.removeClass("show"),$section.addClass("hidden"),d.removeClass("show"),d.addClass("hidden"),o.removeClass("show"),o.addClass("hidden"),c.prop("required",!1),s.prop("required",!1),n.prop("required",!1),t.includes("blocks/helpdesk/new.php")?e("#id_frm .fitem:nth-child(2) div.col-md-3 label").text("Subject"):t.includes("blocks/helpdesk/edit.php")&&e("#id_frm .fitem:nth-child(3) div.col-md-3 label").text("Subject")),$subjectid="",$activityid="",$sectionid="",$other="",""!==l)if(t.includes("hd_userid=")){var r=t.substring(t.indexOf("hd_userid=")+10);a.load("ajax.php","relatedto="+l+"&userid="+r)}else if(t.includes("/blocks/helpdesk/new.php"))a.load("ajax.php","relatedto="+l);else if(t.includes("/blocks/helpdesk/edit.php")){r=e("#mform1 input[name=hd_userid]").val();var p=t.substring(t.indexOf("id=")+3);e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/helpdesk/ajax.php",data:{ticketid:p}}).done(function(e){if("Content / Course"===l||"Contest / Mock"===l||"Hands-On"===l||"Knockout Challenge"===l){var t=e.split(" ");$subjectid=" "+t[1],$activityid=" "+t[3],$sectiondata=t[4],"NA"!==$sectiondata?$sectionid=$sectiondata:($section.removeClass("show"),$section.addClass("hidden"))}else{t=e.split(".");$subjectid=""+t[0],"Others"===$subjectid&&($other=""+t[1])}}),a.load("ajax.php","relatedto="+l+"&userid="+r),setTimeout(function(){0==$count&&(e('#id_summary option[value="'+$subjectid+'"]').prop("selected",!0),"The Platform"===l&&("Others"==$subjectid?(o.removeClass("hidden"),o.addClass("show"),c.prop("required",!0),c.val($other)):(o.removeClass("show"),o.addClass("hidden"),c.val(""),c.prop("required",!1)),$count++))},400)}"Content / Course"!==l&&"Contest / Mock"!==l&&"Hands-On"!==l&&"Knockout Challenge"!==l||((t.includes("/blocks/helpdesk/new.php")||t.includes("/blocks/helpdesk/edit.php")||t.includes("hd_userid="))&&setTimeout(function(){var d=0;if(null!=a.val()&&(d=Number(a.val().trim())),0!=d){if(t.includes("hd_userid=")){var i=t.substring(t.indexOf("hd_userid=")+10);s.load("ajax.php","course_id="+d+"&related_to="+l+"&section=all&user_id="+i)}else s.load("ajax.php","course_id="+d+"&related_to="+l+"&section=all");n.load("ajax.php","course_id="+d+"&related_to="+l)}else $val=e("#id_relatedto option:selected").text(),"Contest / Mock"===l||"Knockout Challenge"===l?(a.children("option").remove(),a.append('<option value="">Select a '+$val+"</option>")):(a.children("option").remove(),a.append('<option value="">Select a course</option>')),s.children("option").remove(),s.append('<option value="">Select a section</option>'),n.children("option").remove(),n.append('<option value="">Select an activity</option>')},500),t.includes("/blocks/helpdesk/edit.php")&&setTimeout(function(){0==$count&&(""!=$sectionid?e('#id_section option[value="'+$sectionid+'"]').prop("selected",!0):($section.removeClass("show"),$section.addClass("hidden"),s.prop("required",!1)),e('#id_activity option[value="'+$activityid+'"]').prop("selected",!0),$count++)},900))}).change(),a.change(function(){var d=e("#id_relatedto option:selected").val();if("Content / Course"===d||"Contest / Mock"===d||"Hands-On"===d||"Knockout Challenge"===d){var i=0;if(null!=a.val()&&(i=Number(a.val().trim())),0!=i){if(t.includes("hd_userid=")){var l=t.substring(t.indexOf("hd_userid=")+10);s.load("ajax.php","course_id="+i+"&related_to="+d+"&section=all&user_id="+l)}else s.load("ajax.php","course_id="+i+"&related_to="+d+"&section=all");n.load("ajax.php","course_id="+i+"&related_to="+d)}else $val=e("#id_relatedto option:selected").text(),"Contest / Mock"===d||"Knockout Challenge"===d?(a.children("option").remove(),a.append('<option value="">Select a '+$val+"</option>")):(a.children("option").remove(),a.append('<option value="">Select a course</option>')),s.children("option").remove(),s.append('<option value="">Select a section</option>'),n.children("option").remove(),n.append('<option value="">Select an activity</option>')}else"Others"===a.val()?(o.removeClass("hidden"),o.addClass("show"),c.prop("required",!0)):(o.removeClass("show"),o.addClass("hidden"),c.prop("required",!1)),t.includes("blocks/helpdesk/new.php")&&""!=a.val()&&"Select"!=a.val()&&"The Platform"===d&&e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/helpdesk/ajax.php",data:{choice:"faq",relatedTo:d,subject:a.val()}}).done(function(t){"failure"!==t&&""!==t&&(e(".modal-body").html(t),e("#confirmActionModalTitle").text("FAQ - "+a.val()),e("#confirmActionModal").modal("show"))})}),s.change(function(){var t=e("#id_relatedto option:selected").val();$temp=Number(a.val().trim()),$sectionid=Number(s.val().trim()),n.load("ajax.php","loadactivity=activity&courseid="+$temp+"&sectionid="+$sectionid+"&related="+t)}),n.change(function(){e("#id_relatedto option:selected").val();if(t.includes("blocks/helpdesk/new.php")&&""!=e("#id_activity option:selected").text()&&"Select an activity"!=e("#id_activity option:selected").text()&&"The Platform"!==l.val()){var d=n.val();e.ajax({method:"GET",url:M.cfg.wwwroot+"/blocks/helpdesk/ajax.php",data:{choice:"faq",relatedTo:l.val(),entityid:d}}).done(function(t){"failure"!==t&&""!==t&&(e(".modal-body").html(t),e("#confirmActionModalTitle").text("FAQ - "+e("#id_activity option:selected").text()),e("#confirmActionModal").modal("show"))})}})})}}});
define('block_helpdesk/new', ['jquery'], function($) {

    return {

        init: function() {         	        
        	
        	var url=  $(location).attr('href');
        	var rootPath = M.cfg.wwwroot;        	
        	$('document').ready(function(){        		        		
        		
        		if(url.includes("helpdesk/update.php")){
        			$("#mform1").on('submit', function(e){
        				document.querySelector('input[type=submit]').disabled=true;
        			});
        		}      
        		
        		var modalHtml =
					' <div id="confirmActionModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
					' <div class="modal-dialog" >' +
					' <div class="modal-content">' +					
					' <div class="modal-headers">' +
					' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;"> </h4> </div>' +
					' <div class="modal-body" ></div>'+
					' <div class="modal-footer">'+ 
					' <button type="button" class="btn btn-info" id="ticketgotinfo" aria-expanded="false"  > Got Required Information </button>' +
					' <button type="button" class="btn btn-default" id="ticketcontinue" aria-expanded="false" >Continue Raising Ticket</button> </div>'+
					' </div>'+
					' </div></div>';
							
        		$("#page-header").append(modalHtml);
        		
        		$(document).on("click", "#ticketcontinue", function(event){	
					$("#confirmActionModal").modal('hide');
	           });
				$(document).on("click", "#ticketgotinfo", function(event){
					$('#confirmActionModal').modal('hide');
					location.replace( M.cfg.wwwroot + '/my');
	           });
				
        		var $othersWrite = $("#id_others");
        		var $relatedTo = $('#id_relatedto'); 
    			var $subjectSelect = $("#id_summary");
    			var $courseSelect = $("#id_course");
    			var $sectionSelect = $("#id_section"); 
    			var $activitySelect = $('#id_activity'); 
    			
    			var $userid = 0;
    			
    			if(url.includes('hd_userid=')){
            		$userid = url.substring(url.indexOf("hd_userid=") + 10);
    			} else if(url.includes('blocks/helpdesk/edit.php')){
    				$userid = $("#mform1 input[name=hd_userid]").val();
    			}
    			    	    			
    			var $summary;
    			var $others; 
    			var $course;
    			var $section;
    			var $activity;
    			
    			if(url.includes('blocks/helpdesk/new.php')){
    				$summary = $("#id_frm .fitem:nth-child(2)");
        			$others = $("#id_frm .fitem:nth-child(3)"); 
        			$course = $("#id_frm .fitem:nth-child(4)");
        			$section = $("#id_frm .fitem:nth-child(5)");
        			$activity = $("#id_frm .fitem:nth-child(6)"); 
    			} else if(url.includes('blocks/helpdesk/edit.php')){
    				$summary = $("#id_frm .fitem:nth-child(3)");
        			$others = $("#id_frm .fitem:nth-child(4)"); 
        			$course = $("#id_frm .fitem:nth-child(5)");
        			$section = $("#id_frm .fitem:nth-child(6)");
        			$activity = $("#id_frm .fitem:nth-child(7)");
        			        			
	    			var $ticketid = url.substring(url.indexOf("id=") + 3);
	    			
	    			$.ajax({
						method: "GET",
						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
						data: {"action" : "edittickets", "ticketid" : $ticketid}
					}).done(function( response ) {
						
						v = $.parseJSON(response);						
                    	$summarydata = v.summary;
                    	if($summarydata !== null){                    		
                    		if($summarydata === "Others"){
                    			$othersWrite.val(v.others);
                    		} else {
                    			$others.removeClass('show');
                				$others.addClass('hidden');
                    		}
                    	} else {
                    		$summary.removeClass('show');
            				$summary.addClass('hidden');
                    	}
                    	$coursedata = v.course;
                    	if($coursedata === null || $coursedata === ""){
                    		$course.removeClass('show');
                    		$course.addClass('hidden');
                    	}
                    	$sectiondata = v.section;
                    	if($sectiondata === null || $sectiondata === ""){
                    		$section.removeClass('show');
                    		$section.addClass('hidden');
                    	} 
                    	$activitydata = v.activity;
                    	if($activitydata === null || $activitydata === ""){
                    		$activity.removeClass('show');
                    		$activity.addClass('hidden');
                    	}	                   				    									
					});  
    			}
    			
    			//Let ensure double clicks don't result in many tickets and responses as first thing
        		if (url.includes("helpdesk/new.php") || url.includes('blocks/helpdesk/edit.php')){ 
        			$("#mform1").on('submit', function(e) {
        				document.querySelector('input[type=submit]').disabled=true;
        				if(!$othersWrite.prop('required')){
        					$othersWrite.val = '';
        				}
        				if(!$subjectSelect.prop('required')){
        					$subjectSelect.children('option').remove();     
                    		$subjectSelect.append('<option value="">Select an issue</option>');
        				}
        				if(!$courseSelect.prop('required')){
        					$courseSelect.children('option').remove();     
        					$courseSelect.append('<option value="">Select an issue</option>');
        				}
        				if(!$sectionSelect.prop('required')){
        					$sectionSelect.children('option').remove();     
        					$sectionSelect.append('<option value="">Select an issue</option>');
        				}
        				if(!$activitySelect.prop('required')){
        					$activitySelect.children('option').remove();     
        					$activitySelect.append('<option value="">Select an issue</option>');
        				}
        			});
        		}
        		    			
    			if(url.includes('blocks/helpdesk/new.php')){ 
    				$summary.removeClass('show');
    				$summary.addClass('hidden');
    				$others.removeClass('show');
    				$others.addClass('hidden');
    				$course.removeClass('show');
    				$course.addClass('hidden');
    				$section.removeClass('show');
    				$section.addClass('hidden');
    				$activity.removeClass('show');
    				$activity.addClass('hidden');
        		}
    			        	       	     
				$flag = 0;
				$checkRelated = 0;
    			$relatedTo.change(function(){    				
    				$issubject = 1;    				
    				$checkRelated = 0;
    				$flag = 0;
    				var $issueRelatedTo = $('#id_relatedto option:selected').val();
    				
    				if($issueRelatedTo == ''){
    					$summary.removeClass('show');
    					$summary.addClass('hidden');
    					$others.removeClass('show');
    					$others.addClass('hidden');
    					$course.removeClass('show');
    					$course.addClass('hidden');
    					$section.removeClass('show');
    					$section.addClass('hidden');
    					$activity.removeClass('show');
    					$activity.addClass('hidden');
    					$othersWrite.prop('required',false);
    					$subjectSelect.prop('required',false);
    					$courseSelect.prop('required',false);
            			$sectionSelect.prop('required',false);
            			$activitySelect.prop('required',false);
    				}
    				document.querySelector('input[type=submit]').disabled=true;
					$.ajax({
						method: "GET",
						async: false,
						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
						data: {"action" : "checkRelated" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject}
					}).done(function( response ) {
						document.querySelector('input[type=submit]').disabled=false;
						var res = response.split("-");
						var related = res[0];
						var subject = res[1];
						if(related === "course"){
							$checkRelated = 1;
						}
						if(subject === "success"){
							$flag = 1;
						}
					}); 
										
					if($flag == 1){    									
						$summary.removeClass('hidden');
    					$summary.addClass('show');
    					$others.removeClass('show');
    					$others.addClass('hidden');
    					$course.removeClass('show');
    					$course.addClass('hidden');
    					$section.removeClass('show');
    					$section.addClass('hidden');
    					$activity.removeClass('show');
        				$activity.addClass('hidden');
    					$subjectSelect.prop('required',true);
    					$othersWrite.prop('required',false);            					
    					$courseSelect.prop('required',false);
            			$sectionSelect.prop('required',false);
            			$activitySelect.prop('required',false);
            			document.querySelector('input[type=submit]').disabled=true;
						$subjectSelect.load('new_ajax.php', 'action=loadSubject'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject,function(){document.querySelector('input[type=submit]').disabled=false;});    						
					} else {        						
						if($checkRelated == 1){
							$summary.removeClass('show');
        					$summary.addClass('hidden'); 
        					$others.removeClass('show');
	    					$others.addClass('hidden');
        					$subjectSelect.prop('required',false);
        					$othersWrite.prop('required',false);
							$course.removeClass('hidden');
							$course.addClass('show'); 
							$courseSelect.prop('required',true);
							$activity.removeClass('hidden');
	    					$activity.addClass('show');                	    					
                			$activitySelect.prop('required',true);
                			document.querySelector('input[type=submit]').disabled=true;
							if (url.includes('hd_userid=') || url.includes('/blocks/helpdesk/edit.php')){
		    					$courseSelect.load('ajax.php', 'relatedto='+ $issueRelatedTo+'&userid=' + $userid,function(){document.querySelector('input[type=submit]').disabled=false;});				
		    				} else if( url.includes('/blocks/helpdesk/new.php') ){    					    				
		    					$courseSelect.load( 'ajax.php', 'relatedto='+ $issueRelatedTo),function(){document.querySelector('input[type=submit]').disabled=false;};    				    					
		    				}
							
							setTimeout(function() {								
								var $temp = 0;
	        					if($courseSelect.val() != null){
	        						$temp = Number($courseSelect.val().trim());
	        					}    	        					        	    					
	        					if($temp != 0){ 
	        						document.querySelector('input[type=submit]').disabled=true;
	                            	if(url.includes('hd_userid=') || url.includes('/blocks/helpdesk/edit.php')){            	                            		
	                            		$sectionSelect.load('ajax.php', 'course_id='+ $temp + '&related_to='+$issueRelatedTo+'&section=all&user_id='+$userid);
	                            	} else {
	                            		$sectionSelect.load('ajax.php', 'course_id='+ $temp + '&related_to='+$issueRelatedTo+'&section=all');
	                            	} 
	                            	setTimeout(function(){    	                            		
	                            		if($sectionSelect.val() != null){	                            			
	                            			$section.removeClass('hidden');
                	    					$section.addClass('show');
                	    					$sectionSelect.prop('required',true);
        	        						$sectionid = Number($sectionSelect.val().trim());
        	        						$activitySelect.load('ajax.php', 'loadactivity=activity&courseid='+$temp+'&sectionid='+$sectionid+'&related='+$issueRelatedTo,function(){document.querySelector('input[type=submit]').disabled=false;});
        	        					} else {        	        						
        	        						$section.removeClass('show');
                	    					$section.addClass('hidden');
                	    					$sectionSelect.prop('required',false);
        	        						$activitySelect.load('ajax.php', 'course_id='+ $temp + '&related_to='+$issueRelatedTo,function(){document.querySelector('input[type=submit]').disabled=false;});
        	        					}                	                                
	                            	},500);            	                            	
	                            } else{             	                            	
	                            	$courseSelect.children('option').remove();                                       		
                            		$courseSelect.append('<option value="">Select a course/issue</option>');
	                            	$sectionSelect.children('option').remove();     
	                            	$sectionSelect.append('<option value="">Select a section/issue</option>');
	                            	$activitySelect.children('option').remove();     
	                            	$activitySelect.append('<option value="">Select an activity/issue</option>');                            	            
	                             }
							},500);
						}        						        						
					}				
    			});
    			
    			var $subject_content = '';
    			$subjectSelect.change(function(){    				
    				$section.removeClass('show');
					$section.addClass('hidden');
					$activity.removeClass('show');
					$activity.addClass('hidden');
					$others.removeClass('show');
        			$others.addClass('hidden');
        			$othersWrite.prop('required',false); 
					$sectionSelect.prop('required',false);
        			$activitySelect.prop('required',false);
    				$issueRelatedTo = $('#id_relatedto option:selected').val();
    				$subject_content = $('#id_summary option:selected').val();
    				$check_subject = 0;
    				$issubject = 2;    				
    				if($subject_content != ''){
    					document.querySelector('input[type=submit]').disabled=true;
    					$.ajax({
    						method: "GET",
    						async: false,
    						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
    						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $subject_content}
    					}).done(function( response ) {	
    						document.querySelector('input[type=submit]').disabled=false;
    						if(response === "failure"){
    							$check_subject = 1;
    						}
    					});
        				
    					if($checkRelated == 0){        					
    						if($check_subject == 0){
    							$course.removeClass('hidden');
    	    					$course.addClass('show');
    	    					$courseSelect.prop('required',true);
    	    					document.querySelector('input[type=submit]').disabled=true;
    							$courseSelect.load('new_ajax.php', 'action=loadCourse'+ '&relatedTo='+$issueRelatedTo+'&subject_content='+$subject_content+'&isSubject='+$issubject+'&user_id='+$userid,function(){document.querySelector('input[type=submit]').disabled=false;});
        					} else {
        						$course.removeClass('show');
    	    					$course.addClass('hidden');
    	    					$courseSelect.prop('required',false);
    	    					if($subject_content != "Others"){
    	    						if($('#id_summary option:selected').val() != ''){            		    						
    		                    		$.ajax({
    		                    			method: "GET",
    		                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
    		                    			data: {
    		                    				"action" : "faq" , 
    		                    				"relatedTo" : $issueRelatedTo , 
    		                    				"subject_content" : $subject_content
    		                    			}
    		                    		}).done(function( response ) {                        			
    		                    			if(response !== 'failure' && response !== ''){                        					
    		                    				$('.modal-body').html(response);
    		                    				$('#confirmActionModalTitle').text("FAQ - "+$('#id_summary option:selected').text());
    		                    				$('#confirmActionModal').modal('show');
    		                    			}                        			                        			
    		                             });
    		                         }
    	    					}        	    					
    	    					if($subject_content === "Others"){
    	    						$others.removeClass('hidden');
    	                			$others.addClass('show');
    	                			$othersWrite.prop('required',true); 
    	    					} else {
    	    						$others.removeClass('show');
    	                			$others.addClass('hidden');
    	                			$othersWrite.prop('required',false); 
    	    					}
        					}      					
        				} else {
        					$course.removeClass('hidden');
	    					$course.addClass('show');
	    					$courseSelect.prop('required',true);
	    					document.querySelector('input[type=submit]').disabled=true;
        					$courseSelect.load('new_ajax.php', 'action=loadCourse'+ '&relatedTo='+$issueRelatedTo +'&subject_content='+$subject_content+'&isSubject='+$issubject+'&user_id='+$userid,function(){document.querySelector('input[type=submit]').disabled=false;});
        				}    					    				    					
    				} else {
    					$course.removeClass('show');
    					$course.addClass('hidden');
    					$courseSelect.prop('required',false);
    				}    				    				    				    					    		
    			});
    			
    			$courseSelect.change(function(){    				
    				$issueRelatedTo = $('#id_relatedto option:selected').val();    				
    				$subject_content = $('#id_summary option:selected').val();
    				$course_content = $('#id_course option:selected').val();
    				$issubject = 3;
    				$check_subject = 0;
    				if($course_content != ''){
    					document.querySelector('input[type=submit]').disabled=true;
    					$.ajax({
    						method: "GET",
    						async: false,
    						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
    						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $course_content}
    					}).done(function( response ) {	
    						document.querySelector('input[type=submit]').disabled=false;
    						if(response === "failure"){
    							$check_subject = 1;
    						} else if(response === "course"){
    							$check_subject = 2;
    						}
    					});
    											
						if($check_subject == 1){
							$section.removeClass('show');
	    					$section.addClass('hidden');
	    					$activity.removeClass('show');
	    					$activity.addClass('hidden');
	    					$others.removeClass('show');
	            			$others.addClass('hidden');
	            			$othersWrite.prop('required',false); 
	    					$sectionSelect.prop('required',false);
	            			$activitySelect.prop('required',false);
	            			if($('#id_course option:selected').val() != ''){            		    						
	                    		$.ajax({
	                    			method: "GET",
	                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
	                    			data: {
	                    				"action" : "faq" , 
	                    				"relatedTo" : $issueRelatedTo , 
	                    				"subject_content" : $subject_content,
	                    				"course_content" : $course_content
	                    			}
	                    		}).done(function( response ) {                        			
	                    			if(response !== 'failure' && response !== ''){                        					
	                    				$('.modal-body').html(response);
	                    				$('#confirmActionModalTitle').text("FAQ - "+$('#id_course option:selected').text());
	                    				$('#confirmActionModal').modal('show');
	                    			}                       			                        			
	                             });
	                         }
						} else {		
							document.querySelector('input[type=submit]').disabled=true;
							$sectionSelect.load('new_ajax.php', 'action=loadSection'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject+'&subject_content='+$subject_content +'&course_content='+$course_content+'&user_id='+$userid,function(){document.querySelector('input[type=submit]').disabled=false;});
							$temp = Number($courseSelect.val().trim());
							setTimeout(function(){								
								if($sectionSelect.val() != null){
									$section.removeClass('hidden');
									$section.addClass('show');
									$sectionSelect.prop('required',true);
									$section_subject = $sectionSelect.val();
									$issubject = 4;
									$check_subject = 0;
									document.querySelector('input[type=submit]').disabled=true;
									$.ajax({
			    						method: "GET",
			    						async: false,
			    						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
			    						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $section_subject}
			    					}).done(function( response ) {								
			    						document.querySelector('input[type=submit]').disabled=false;
			    						if(response === "failure"){
			    							$check_subject = 1;
			    						} else if(response === "course"){
			    							$check_subject = 2;
			    						}
			    					});
									
									if($check_subject == 1){
										$section_subject = $sectionSelect.val();
										$activity.removeClass('show');
				    					$activity.addClass('hidden');
				    					$activitySelect.prop('required',false);
				    					if($('#id_course option:selected').val() != ''){            		    						
				                    		$.ajax({
				                    			method: "GET",
				                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
				                    			data: {
				                    				"action" : "faq" , 
				                    				"relatedTo" : $issueRelatedTo , 
				                    				"subject_content" : $subject_content,
				                    				"course_content" : $course_content,
				                    				"section_content" : $section_subject
				                    			}
				                    		}).done(function( response ) {                        			
				                    			if(response !== 'failure' && response !== ''){                        					
				                    				$('.modal-body').html(response);
				                    				$('#confirmActionModalTitle').text("FAQ - "+$('#id_course option:selected').text());
				                    				$('#confirmActionModal').modal('show');
				                    			}                       			                        			
				                             });
				                         }
									} else {
										$activity.removeClass('hidden');
				    					$activity.addClass('show');
				    					$activitySelect.prop('required',true);
										$sectionid = Number($section_subject.trim());
										if(isNaN($sectionid) == true){
											$activitySelect.load('new_ajax.php', 'action=loadActivity'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject+'&course_content='+$section_subject,function(){document.querySelector('input[type=submit]').disabled=false;});
										} else {
											$activitySelect.load('ajax.php', 'loadactivity=activity&courseid='+$temp+'&sectionid='+$sectionid+'&related='+$issueRelatedTo,function(){document.querySelector('input[type=submit]').disabled=false;});
										}													
									}
								
								} else {
									$section.removeClass('show');
        	    					$section.addClass('hidden');
        	    					$sectionSelect.prop('required',false);
        	    					$activity.removeClass('hidden');
        	    					$activity.addClass('show');                	    					
                        			$activitySelect.prop('required',true);	
                        			$activitySelect.load('ajax.php', 'course_id='+ $temp + '&related_to='+$issueRelatedTo,function(){document.querySelector('input[type=submit]').disabled=false;});
								}								
							},500);								
						}										
    				} else {
    					$section.removeClass('show');
    					$section.addClass('hidden');
    					$activity.removeClass('show');
    					$activity.addClass('hidden');
    					$others.removeClass('show');
            			$others.addClass('hidden');
            			$othersWrite.prop('required',false); 
    					$sectionSelect.prop('required',false);
            			$activitySelect.prop('required',false);
    				}    				
    			});
    			
    			$sectionSelect.change(function(){    				
    				$issueRelatedTo = $('#id_relatedto option:selected').val(); 
    				$temp = Number($courseSelect.val().trim());
    				$subject_content = $('#id_summary option:selected').val();
    				$course_content = $('#id_course option:selected').val();
    				$section_subject = $sectionSelect.val();
    				$issubject = 4;
					$check_subject = 0;
					document.querySelector('input[type=submit]').disabled=true;
					$.ajax({
						method: "GET",
						async: false,
						url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
						data: {"action" : "checkContent" , "relatedTo" : $issueRelatedTo, "isSubject" : $issubject, "subject_content" : $section_subject}
					}).done(function( response ) {	
						document.querySelector('input[type=submit]').disabled=false;
						if(response === "failure"){
							$check_subject = 1;
						} else if(response === "course"){
							$check_subject = 2;
						}
					});

					if($check_subject == 1){
						$activity.removeClass('show');
    					$activity.addClass('hidden');
    					$activitySelect.prop('required',false);
    					if($('#id_section option:selected').val() != ''){            		    						
                    		$.ajax({
                    			method: "GET",
                    			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
                    			data: {
                    				"action" : "faq" , 
                    				"relatedTo" : $issueRelatedTo , 
                    				"subject_content" : $subject_content,
                    				"course_content" : $course_content,
                    				"section_content" : $section_subject	                    				
                    			}
                    		}).done(function( response ) {                        			
                    			if(response !== 'failure' && response !== ''){                        					
                    				$('.modal-body').html(response);
                    				$('#confirmActionModalTitle').text("FAQ - "+$('#id_section option:selected').text());
                    				$('#confirmActionModal').modal('show');
                    			}                        			                        			
                             });
                         }
					} else {
						$activity.removeClass('hidden');
    					$activity.addClass('show');
    					$activitySelect.prop('required',true);
						$sectionid = Number($section_subject.trim());
						document.querySelector('input[type=submit]').disabled=true;
						if(isNaN($sectionid) == true){
							$activitySelect.load('new_ajax.php', 'action=loadActivity'+ '&relatedTo='+$issueRelatedTo+'&isSubject='+$issubject+'&course_content='+$section_subject,function(){document.querySelector('input[type=submit]').disabled=false;});
						} else {
							$activitySelect.load('ajax.php', 'loadactivity=activity&courseid='+$temp+'&sectionid='+$sectionid+'&related='+$issueRelatedTo,function(){document.querySelector('input[type=submit]').disabled=false;});
						}							
					}				
    			});
    			
    			$activitySelect.change(function(){
    				$relatedto = $('#id_relatedto option:selected').val();
        			$subject_content = $('#id_summary option:selected').val();
    				$course_content = $('#id_course option:selected').val();
    				$section_subject = $sectionSelect.val();
        			$activityid = $('#id_activity option:selected').val();            			
        			if($activity != ''){            		    						
                		$.ajax({
                			method: "GET",
                			url: M.cfg.wwwroot + '/blocks/helpdesk/new_ajax.php',
                			data: {
                				"action" : "faq" , 
                				"relatedTo" : $relatedto , 
                				"subject_content" : $subject_content,
                				"course_content" : $course_content,
                				"section_content" : $section_subject,
                				"activity_content" : $activityid
                				}
                		}).done(function( response ) {                        			
                			if(response !== 'failure' && response !== ''){                        					
                				$('.modal-body').html(response);
                				$('#confirmActionModalTitle').text("FAQ - "+$('#id_activity option:selected').text());
                				$('#confirmActionModal').modal('show');
                			}                        			                        			
                         });
                     }
    			});
        });
       }
    };
});
define('block_helpdesk/search', ['jquery'], function($) {

	return {
		init: function(args) {
			var rootPath = M.cfg.wwwroot;
			var ticketid = args.ticketid;
			var cap = args.cap;

			var url=  $(location).attr('href');
			var final = [];
            var finalJson = [];
			$('document').ready(function(){
				var res;
                var id = 0;
				function autocomplete(inp, arr) {
	 				
					  /*the autocomplete function takes two arguments,
					  the text field element and an array of possible autocompleted values:*/
					  var currentFocus;
					  /*execute a function when someone writes in the text field:*/
					  inp.addEventListener("input", function(e) {
					      var a, b, i, val = this.value;
					      /*close any already open lists of autocompleted values*/
					      
					      closeAllLists();
					      if (!val) { return false;}
					      currentFocus = -1;
					      /*create a DIV element that will contain the items (values):*/
					      a = document.createElement("DIV");
					      a.setAttribute("id", this.id + "autocomplete-list");
					      a.setAttribute("class", "autocomplete-items");
					      /*append the DIV element as a child of the autocomplete container:*/
					      this.parentNode.appendChild(a);
					      /*for each item in the array...*/
					      for (i = 0; i < arr.length; i++) {
					    	  res = arr[i].split("-");
					        /*check if the item starts with the same letters as the text field value:*/
					        if (res[0].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
					          /*create a DIV element for each matching element:*/
					        	b = document.createElement("DIV");
					          /*make the matching letters bold:*/
					          b.innerHTML = "<strong>" + res[0].substr(0, val.length) + "</strong>";
					          b.innerHTML += res[0].substr(val.length);
					          /*insert a input field that will hold the current array item's value:*/
					          b.innerHTML += "<input type='hidden' value='" + res[0] + "'>";
					          b.innerHTML += "<input id='userId' type='hidden' value='" + res[1] + "'>";
					          /*execute a function when someone clicks on the item value (DIV element):*/
					              b.addEventListener("click", function(e) {
					              /*insert the value for the autocomplete text field:*/
					              inp.value = this.getElementsByTagName("input")[0].value;
					              id = this.getElementsByTagName("input")[1].value;
					              
					              /*close the list of autocompleted values,
					              (or any other open lists of autocompleted values:*/
					              
					              var name=document.getElementById("searchName").value;
									var url = M.cfg.wwwroot + '/blocks/helpdesk/assign.php?tid='+ticketid;
									var form = $('<form action="' + url + '" method="post">' +
									  '<input type="text" name="userid" value="' + id + '" />' +
									  '<input type="text" name="username" value="' + name + '" />' +
									  '</form>');
									$('body').append(form);
									form.submit();
					              
//					              closeAllLists();
					              
					          });
					          a.appendChild(b);
					        }
					      }
					  });
					  /*execute a function presses a key on the keyboard:*/
					  inp.addEventListener("keydown", function(e) {
					      var x = document.getElementById(this.id + "autocomplete-list");
					      if (x) x = x.getElementsByTagName("div");
					      if (e.keyCode == 40) {
					    	
					        /*If the arrow DOWN key is pressed,
					        increase the currentFocus variable:*/
					        currentFocus++;
					        
					        /*and and make the current item more visible:*/
					        addActive(x);
					        
					      } else if (e.keyCode == 38) { //up
					        /*If the arrow UP key is pressed,
					        decrease the currentFocus variable:*/
					        currentFocus--;
					        /*and and make the current item more visible:*/
					        addActive(x);
					      } else if (e.keyCode == 13) {
					        /*If the ENTER key is pressed, prevent the form from being submitted,*/
					        
					        if (currentFocus > -1) {
					          /*and simulate a click on the "active" item:*/
					          if (x) x[currentFocus].click();
					        }
					      }
					  });
					  function addActive(x) {
					    /*a function to classify an item as "active":*/
					    if (!x) return false;
					    /*start by removing the "active" class on all items:*/
					    removeActive(x);
					    if (currentFocus >= x.length) currentFocus = 0;
					    if (currentFocus < 0) currentFocus = (x.length - 1);
					    /*add class "autocomplete-active":*/
					    x[currentFocus].classList.add("autocomplete-active");
					  }
					  function removeActive(x) {
					    /*a function to remove the "active" class from all autocomplete items:*/
					    for (var i = 0; i < x.length; i++) {
					      x[i].classList.remove("autocomplete-active");
					    }
					  }
					  function closeAllLists(elmnt) {
					    /*close all autocomplete lists in the document,
					    except the one passed as an argument:*/
					    var x = document.getElementsByClassName("autocomplete-items");
					    for (var i = 0; i < x.length; i++) {
					      if (elmnt != x[i] && elmnt != inp) {
					      x[i].parentNode.removeChild(x[i]);
					    }
					  }
					}
					/*execute a function when someone clicks in the document:*/
					document.addEventListener("click", function (e) {
					    closeAllLists(e.target);
					});
				} 

				if(url.includes('/helpdesk/assign.php'))  {					
				   $.ajax({
                      method: "POST",
                      url: M.cfg.wwwroot + '/blocks/helpdesk/search_ajax.php',
                      data: {"action" : "get_User_Details", "cap" : cap }
				   }).done(function( response ) {                    
                    data = $.parseJSON(response);
                    $.each(data, function (i,v)  {
                            final.push(v.name+'-'+v.id);
                            finalJson.push({
                                "id" : v.id,
                                "name" : v.name
                        });
                    });
                     
                     autocomplete(document.getElementById("searchName"), final);
				  });
			    }

				$('#searchName').keypress(function(event) {
					 if(event.keyCode == 13) {
					
						var textarea = $('#searchName').val();
						if(textarea != '' && id != 0){						   
						   console.log(id);						   
							var name=document.getElementById("searchName").value;
							var url = M.cfg.wwwroot + '/blocks/helpdesk/assign.php?tid='+ticketid;
							var form = $('<form action="' + url + '" method="post">' +
							  '<input type="text" name="userid" value="' + id + '" />' +
							  '<input type="text" name="username" value="' + name + '" />' +
							  '</form>');
							$('body').append(form);
//							console.log(form);
							form.submit();							
						} else if(textarea != '' && id == 0){
							for(var i=0; i<finalJson.length; i++){
                                if(finalJson[i].name.toUpperCase() === textarea.toUpperCase()){
                                		id = finalJson[i].id;
                                        break;
                                } 
							}
							if(id != 0){
								var url = M.cfg.wwwroot + '/blocks/helpdesk/assign.php?tid='+ticketid;
                                var form = $('<form action="' + url + '" method="post">' +
                                        '<input type="text" name="userid" value="' + id + '" />' +
                                        '<input type="text" name="username" value="' + textarea + '" />' +
                                        '</form>');
                                $('body').append(form);
                                form.submit();
							} else {
                            	var url = M.cfg.wwwroot + '/blocks/helpdesk/assign.php?tid='+ticketid;
                                var form = $('<form action="' + url + '" method="post">' +
                                        '<input type="text" name="userid" value="' + id + '" />' +
                                        '<input type="text" name="username" value="' + textarea + '" />' +
                                        '</form>');
                                $('body').append(form);
                                form.submit();
                            }
						} else{
							location.replace(M.cfg.wwwroot + '/blocks/helpdesk/assign.php?tid='+ticketid);
						}
				
					 }					 					 
			});

				
			
			$('#user1').click(function(){
			   $('#inone').remove();
				 location.replace(M.cfg.wwwroot + '/blocks/helpdesk/assign.php?tid='+ticketid);
            });

         
function autocompletefortemplatecontent(inp, arr) {
	 				
					  /*the autocomplete function takes two arguments,
					  the text field element and an array of possible autocompleted values:*/
					  var currentFocus;
					  /*execute a function when someone writes in the text field:*/
					  inp.addEventListener("input", function(e) {
					      var a, b, i, val = this.value;
					      /*close any already open lists of autocompleted values*/
					      
					      closeAllLists();
					      if (!val) { return false;}
					      currentFocus = -1;
					      /*create a DIV element that will contain the items (values):*/
					      a = document.createElement("DIV");
					      a.setAttribute("id", this.id + "autocomplete-list");
					      a.setAttribute("class", "autocomplete-items");
					      /*append the DIV element as a child of the autocomplete container:*/
					      this.parentNode.appendChild(a);
					      /*for each item in the array...*/
					      for (i = 0; i < arr.length; i++) {
					    	  res = arr[i].split("-");
					        /*check if the item starts with the same letters as the text field value:*/
					        if (res[0].includes(val.toLowerCase())) {
					          /*create a DIV element for each matching element:*/
					        	b = document.createElement("DIV");
					          /*make the matching letters bold:*/
					          b.innerHTML = res[0].replace(val.toLowerCase(), "<strong>"+val.toLowerCase()+"</strong>");					          
					          /*insert a input field that will hold the current array item's value:*/
					          b.innerHTML += "<input type='hidden' value='" + res[0] + "'>";
					          b.innerHTML += "<input id='userId' type='hidden' value='" + res[1] + "'>";
					          /*execute a function when someone clicks on the item value (DIV element):*/
					              b.addEventListener("click", function(e) {
					              /*insert the value for the autocomplete text field:*/
					              inp.value = this.getElementsByTagName("input")[0].value;
					              id = this.getElementsByTagName("input")[1].value;
					              
					              /*close the list of autocompleted values,
					              (or any other open lists of autocompleted values:*/
					              
					              var template_content=document.getElementById("template").value;
									var url = M.cfg.wwwroot + '/blocks/helpdesk/update.php?id='+ticketid;
									//var richtext = document.getElementById("id_notes_editoreditable").value
									var content = document.getElementById("id_notes_editoreditable").textContent;
									if(content.includes("Thanks for reaching us.")) {
                                      document.getElementById("id_notes_editoreditable").innerHTML = "Hi,<br>Thanks for reaching us.<br><br>"+template_content+"<br><br><b>Happy learning!!!</b>";
									}
									else {
										document.getElementById("id_notes_editoreditable").innerHTML = "Hi,<br><br>"+template_content+"<br><br><b>Happy learning!!!</b>";
									}
							        //document.getElementById("id_notes_editoreditable").textContent = template_content;
									document. getElementById('template'). value = '';
					              
					          });
					          a.appendChild(b);
					        }
					      }
					  });
					  /*execute a function presses a key on the keyboard:*/
					  inp.addEventListener("keydown", function(e) {
					      var x = document.getElementById(this.id + "autocomplete-list");
					      if (x) x = x.getElementsByTagName("div");
					      if (e.keyCode == 40) {
					    	
					        /*If the arrow DOWN key is pressed,
					        increase the currentFocus variable:*/
					        currentFocus++;
					        
					        /*and and make the current item more visible:*/
					        addActive(x);
					        
					      } else if (e.keyCode == 38) { //up
					        /*If the arrow UP key is pressed,
					        decrease the currentFocus variable:*/
					        currentFocus--;
					        /*and and make the current item more visible:*/
					        addActive(x);
					      } else if (e.keyCode == 13) {
					        /*If the ENTER key is pressed, prevent the form from being submitted,*/
					        
					        if (currentFocus > -1) {
					          /*and simulate a click on the "active" item:*/
					          if (x) x[currentFocus].click();
					        }
					      }
					  });
					  function addActive(x) {
					    /*a function to classify an item as "active":*/
					    if (!x) return false;
					    /*start by removing the "active" class on all items:*/
					    removeActive(x);
					    if (currentFocus >= x.length) currentFocus = 0;
					    if (currentFocus < 0) currentFocus = (x.length - 1);
					    /*add class "autocomplete-active":*/
					    x[currentFocus].classList.add("autocomplete-active");
					  }
					  function removeActive(x) {
					    /*a function to remove the "active" class from all autocomplete items:*/
					    for (var i = 0; i < x.length; i++) {
					      x[i].classList.remove("autocomplete-active");
					    }
					  }
					  function closeAllLists(elmnt) {
					    /*close all autocomplete lists in the document,
					    except the one passed as an argument:*/
					    var x = document.getElementsByClassName("autocomplete-items");
					    for (var i = 0; i < x.length; i++) {
					      if (elmnt != x[i] && elmnt != inp) {
					      x[i].parentNode.removeChild(x[i]);
					    }
					  }
					}
					/*execute a function when someone clicks in the document:*/
					document.addEventListener("click", function (e) {
					    closeAllLists(e.target);
					});
				}		

            if(url.includes('/helpdesk/update.php'))  {
				   $.ajax({
                      method: "POST",
                      url: M.cfg.wwwroot + '/blocks/helpdesk/search_ajax.php',
                      data: {"action" : "sample_templates_content" }
				   }).done(function( response ) {                    
                    data = $.parseJSON(response);
                    $.each(data, function (i,v)  {
                            final.push(v.template_content+'-'+v.id);
                            finalJson.push({
                                "id" : v.id,
                                "template_content" : v.template_content
                        });
                    });
                     
                     autocompletefortemplatecontent(document.getElementById("template"), final);
				  });
			    }

            $('#template').keypress(function(event) {
					 if(event.keyCode == 13) {
					
						var textarea = $('#template').val();
						if(textarea != ''){						   
						   console.log(id);						   
							var template_content=document.getElementById("template").value;
							var url = M.cfg.wwwroot + '/blocks/helpdesk/update.php?id='+ticketid;
							/*var richtext = document.getElementById("id_notes_editoreditable").value
							richtext.value(template_content);*/
							/*var form = $('<form action="' + url + '" method="post">' +
							  '<input type="text" name="userid" value="' + id + '" />' +
							  '<input type="text" name="template_content" value="' + template_content + '" />' +
							  '</form>');
							$('body').append(form);
//							console.log(form);
							form.submit();	*/					
						} else if(textarea != ''){
							for(var i=0; i<finalJson.length; i++){
                                if(finalJson[i].name.toUpperCase() === textarea.toUpperCase()){
                                		id = finalJson[i].id;
                                        break;
                                } 
							}
							
						} else{
							location.replace(M.cfg.wwwroot + '/blocks/helpdesk/update.php?id='+ticketid);
						}
				
					 }					 					 
			});
           
		});	
           
	}
};

});

define('block_leaders/script', ['jquery'], function($) {
 
    return {
        init: function() {
        	var url=  $(location).attr('href');
        	
        	/* Check if page is contest LeaderBoard*/
        	
        		$('document').ready(function(){
        			
        			setTimeout(function(){
        				$('#myModal2').modal('show');
    		    		}, 1000);

        		    });
        		       	/* contest polling */
        		if(url.includes('/my')){
        		setTimeout( function(){ 
              		$('#myModal-polling').modal('show');
               		
            		var x = document.getElementsByClassName('fitemtitle');
            		var y = document.getElementsByClassName('felement');
            		
            		for (var i = 0; i < x.length; i++) {
            			  x[i].classList.add('newclassname');
            			  x[i].style.width = "60%";
            			}	
            		for (var i = 0; i < y.length; i++) {
          			  y[i].classList.add('newclassname');
          			  y[i].style.width = "40%";
          			}     		
            			$('#contest-score-close').click(function() {	
            			 window.location.reload(true);
            			}); 
            	  }  , 1000 );	
        		
        		setTimeout( function(){ 
              		$('#myModal-userfieldcapture').modal('show');
               		
            		/*var x = document.getElementsByClassName('fitemtitle');
            		var y = document.getElementsByClassName('felement');
            		
            		for (var i = 0; i < x.length; i++) {
            			  x[i].classList.add('newclassname');
            			  x[i].style.width = "60%";
            			}	
            		for (var i = 0; i < y.length; i++) {
          			  y[i].classList.add('newclassname');
          			  y[i].style.width = "40%";
          			}     		*/
            			
            	  }  , 1000 );	
        		
        		}
        	
        
        		
        }
    
    };
});
define('block_learningpath/chooselearningpath', ["jquery","jqueryui"],function(n){return{init:function(a){n(location).attr("href"),M.cfg.wwwroot;CONFIG=a;var o=CONFIG.userid,t=CONFIG.first,i=CONFIG.second,c=null;n("document").ready(function(){n(document).on("click",".submitpath",function(){n("#chooselp_label").css("display","none");var a=n(this).attr("id");c=a.replace("submitlearningpath","");var o=n("#lpathrowid"+c+" div:nth-child(1) #lpathname").html(),e=t+o+"."+i;n("#lp-confirmation .modal-body").html(e),n("#lp-confirmation").modal("show")}),n(document).on("click","#confirmlearningpath",function(){var a={action:"learningpath",userid:o,data:parseInt(c)},t=M.cfg.wwwroot;n.ajax({url:t+"/blocks/learningpath/enrollearningpath_ajax.php",type:"POST",data:a,success:function(n){location.replace(t)},error:function(){location.replace(t)}})}),n(document).on("click","#lp_cancel",function(){n("#lp-confirmation").modal("hide")})})}}});
define('block_learningpath/track_week_schedule', ['jquery'], function($) {
    return {
        init: function() {
        	 $('#milestone').hide();$('#handson_activities').hide();$('#cc_courses').hide();$('#ict_courses').hide();$('#mockict_courses').hide();$('#mentor').hide();$('#project').hide();$('#xp').hide();$('#pass_percent').hide();	
        	 $('#add_handson').hide();$('#add_cc').hide();$('#add_ict').hide();$('#add_mockict').hide();$('#add_mentor').hide();$('#add_project').hide();$('#add_track').hide();$('#cancel').hide();
        	 $('#add_track_table').hide();$('#no_track').hide();$('#code').hide();$('#assessment_type').hide();
        	 
        	 $("#activity").change(function() {
        		 if($("#check_box").prop('checked') == false){
    			 $('#activity_code').val('');$('#xp_points').val('');$('#pass_grade').val('');$('#assessment_types').val('Select');$('#milestone').val('Select');$('#skill_type').val('');
        		 $activity_type = $('#activity_type option:selected').text();
        		 if($activity_type == 'Select'){
                	 $('#milestone').hide();$('#handson_activities').hide();$('#cc_courses').hide();$('#ict_courses').hide();$('#mentor').hide();$('#project').hide();
                	 $('#xp').hide();$('#pass_percent').hide();$('#add_handson').hide();$('#add_ict').hide();$('#add_cc').hide();$('#add_project').hide();
                	 $('#add_mentor').hide();$('#mockict_courses').hide();$('#add_mockict').hide();$('#assessment_type').hide();$('#skill_types').hide();
        		 }
        		 if($activity_type == 'Practice'){
        			 $('#handson_activities').hide();$('#milestone').show();$('#cc_courses').hide();$('#ict_courses').hide();$('#mentor').hide();$('#project').hide();
        			 $('#code').show();$('#xp').hide();$('#pass_percent').hide();$('#add_handson').show();$('#add_cc').hide();$('#add_ict').hide();$('#add_mentor').hide();
        			 $('#add_project').hide();$('#mockict_courses').hide();$('#add_mockict').hide();$('#assessment_type').hide();$('#skill_types').show();
        		 }
        		 if($activity_type == 'CC'){
    			 	 $('#cc_courses').show();$('#milestone').hide();$('#handson_activities').hide();$('#ict_courses').hide();$('#mentor').hide();$('#project').hide();
    			 	$('#code').show();$('#xp').show();$('#pass_percent').show();$('#add_cc').show();$('#add_handson').hide();$('#add_ict').hide();$('#add_mentor').hide();
    			 	$('#add_project').hide();$('#mockict_courses').hide();$('#add_mockict').hide();$('#assessment_type').show();$('#skill_types').show();
        		 }
        		 if($activity_type == 'ICT'){
        			 $('#ict_courses').show();$('#milestone').hide();$('#handson_activities').hide();$('#cc_courses').hide();$('#mentor').hide();$('#project').hide();
        			 $('#code').show();$('#xp').show();$('#pass_percent').show();$('#add_ict').show();$('#add_handson').hide();$('#add_cc').hide();$('#add_mentor').hide();
        			 $('#add_project').hide();$('#mockict_courses').hide();$('#add_mockict').hide();$('#assessment_type').show();$('#skill_types').hide();
        		 }
        		 if($activity_type == 'Project'){
        			 $('#project').show();$('#milestone').hide();$('#handson_activities').hide();$('#cc_courses').hide();$('#ict_courses').hide();$('#mentor').hide();
     	        	 $('#xp').hide();$('#pass_percent').hide();$('#add_project').show();$('#add_handson').hide();$('#add_ict').hide();$('#add_mentor').hide();
     	        	 $('#add_cc').hide();$('#mockict_courses').hide();$('#add_mockict').hide();$('#assessment_type').hide();$('#skill_types').hide();
        		 }
        		 if($activity_type == 'Mentor'){
        			 $('#mentor').show();$('#milestone').hide();$('#handson_activities').hide();$('#cc_courses').hide();$('#ict_courses').hide();$('#project').hide();
      	        	 $('#xp').hide();$('#pass_percent').hide();$('#add_mentor').hide();$('#add_handson').hide();$('#add_ict').hide();$('#add_cc').hide();
      	        	 $('#add_project').hide();$('#mockict_courses').hide();$('#add_mockict').hide();$('#assessment_type').hide();$('#skill_types').hide();
        		 }
        		 if($activity_type == 'Mock ICT'){
        			 $('#mockict_courses').show();$('#ict_courses').hide();$('#milestone').hide();$('#handson_activities').hide();$('#cc_courses').hide();$('#mentor').hide();$('#project').hide();
        			 $('#code').show();$('#xp').show();$('#pass_percent').show();$('#add_mockict').show();$('#add_ict').hide();$('#add_handson').hide();$('#add_cc').hide();
        			 $('#add_mentor').hide();$('#add_project').hide();$('#assessment_type').show();$('#skill_types').hide();
        		 }
    		 }
         });
        	 
        	 $("#select_mentor").change(function() {
        		 $mentor_show = $('#select_mentor option:selected').val();
        		 if($mentor_show === 'Yes')
        			 {
        			 	$('#add_mentor').show();
        			 }else{
         			 	$('#add_mentor').hide();
         			 }
        	 });
        	 
        	 $('#add_handson, #add_cc, #add_mockict,#add_ict, #add_mentor, #add_project, #add_week,#no_track').click(function(){
           		$lp_name = $('#lpname option:selected').text();
          		if($lp_name == 'Select'){
          			alert('Kindly Choose Learning Path');
          			 return false;
          		 }          		
          		
          		if($('#max_week').val() == ''){
          			alert('Kindly Fill the Maximum Week');
          			return false;
          		}
	    		   
          		if($('#week_no').val() == ''){
          			alert('Kindly Fill the Week Number');
          			return false;
          		}
        		   
	    		 $activity_type = $('#activity_type option:selected').text();
	      		 if($activity_type == 'Select'){
	      			alert('Kindly Choose Activity Type');
	      			 return false;
	      		 }
        	 });
        	 
    	 	$('#add_cc, #add_mockict,#add_ict').click(function(){
    	 		$assessment_type = $('#assessment_types option:selected').text();
          		if($assessment_type == 'Select'){
          			alert('Kindly Choose Assessment Type');
          			 return false;
          		 }	 
        	 });
        	        		
        	 
        	 $(' #add_project').click(function(){

           		/*$milestone_name = $('#milestone_name option:selected').text();
           		if($milestone_name == 'Select'){
           			alert('Kindly Choose Milestone');
           			 return false;
           		 }*/
           		
	        	 $project_name = $('#select_project option:selected').text();
	       			if($project_name == 'Select'){
	       				alert('Kindly Choose Project');
	       				return false;
	       			}
        	 });
       		
        	 $("#lpname").change(function() {
        		 $('#milestone').hide();$('#cc_courses').hide();$('#ict_courses').hide();$('#mockict_courses').hide();$('#project').hide();$('#handson_activities').hide();
        		 $('#xp').hide();$('#pass_percent').hide();$('#code').hide();$('#mentor').hide();$("input:text").val("");$('#assessment_type').hide();$('#skill_types').hide();
        		 $('#activity_type').val('Select');
        		 
        		 if($("#trackname").is(":visible")){
        			 $('#trackname').addClass("hidden");
                	 $('#tracktype').addClass("hidden");
                	 $('#addtrackbtn').addClass("hidden");
        		 }
        		 var learningpathpid = $('#lpname').val();
        		 if(learningpathpid != "Select"){
        		 $.post(M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php", {
                     choice: 'getlptrack',
                     lpid:learningpathpid
     
                 }).done(function(data, textStatus, jqXHR) { 
                 var data = JSON.parse(data);
                 
                 if($("#userfeedback").length){
 							$("#userfeedback").remove();
         			} 
                 if(data.trackid == undefined){
                	 alert("Please add track for the selected learning path");
                	 $('#trackname').removeClass("hidden");
                	 $('#tracktype').removeClass("hidden");
                	 $('#addtrackbtn').removeClass("hidden");
                	 var tracktypeval = $('#tracktype').val();
                	 var defaultname = $('#lpname option:selected').text();
                	 $('#trackname').val(defaultname);
                 	console.log("track doesn't exist");
                 }
                 else{	
                  		console.log("track exists");
                  	}
         }).fail (function(jqXHR, textStatus, errorThrown) { 
    		 console.log('failed');
         });
        		 }
        		 
        		 $('#add_week').show();$('#add_track').hide();$('#cancel').hide();$('#add_track_table').hide();$('#track_summarytable').hide();$('#week_summarytable').hide();            	 
             });
        	 
        	 $("#activity").change(function() {
        		 $lp_name = $('#lpname option:selected').text();
            	 $lp_id = $('#lpname option:selected').val();
                 $("#milestone_name").load('ajax_track_week_schedule.php', "choice=get_lp&lp_name=" + $lp_name + "&lp_id=" + $lp_id);
                 $("#cc_activity").load('ajax_track_week_schedule.php', "choice=load_cc&lp_id=" + $lp_id);
                 $("#ict_activity").load('ajax_track_week_schedule.php', "choice=load_ict&lp_id=" + $lp_id);
                 $("#mockict_activity").load('ajax_track_week_schedule.php', "choice=load_mockict&lp_id=" + $lp_id);
                 $("#select_project").load('ajax_track_week_schedule.php', "choice=load_project&lp_id=" + $lp_id);
        	 });
        	 
        	 $("#milestone").change(function() {
        		 $('#add_week').show();$('#add_track').hide();$('#cancel').hide();$('#add_track_table').hide();$('#track_summarytable').hide();$('#assessment_type').hide();
        		 $('#week_summarytable').hide();
        		 $activity_type = $('#activity_type option:selected').text();
        		 if($activity_type == 'Practice'){
        			 $('#handson_activities').show();
        		 }
        		 $handson_activity = $('#milestone_name option:selected').val();
                 $("#handson_activity").load('ajax_track_week_schedule.php', "choice=get_milestone&milestone_id=" + $handson_activity);
                 //$("#select_project").load('ajax_track_week_schedule.php', "choice=get_project&milestone_id=" + $handson_activity);
             });
        	 	 
        		 
        	 $("#addtrackbtn").click(function() {
        		 var lpidval = $('#lpname').val();
        		 var tracktypeval = $('#tracktype option:selected').text();
        		 var tracknameval = $('#trackname').val();
        		 
        		 if(tracktypeval=="Select" || tracknameval==""){
        			 alert("Tracktype or trackname is mandatory ");
        			 return false;
        		 }
        		 $("#addtrackbtn").prop('disabled', true);
        		 $.post(M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php", {
                     choice: 'setlptrack',
                     lpid:lpidval,
                     tracktype:tracktypeval,
        		 	 trackname:tracknameval
     
                 }).done(function(data, textStatus, jqXHR) { 
                 alert("Added Track successfully");
                 $('#trackname').addClass("hidden");
            	 $('#tracktype').addClass("hidden");
            	 $('#addtrackbtn').addClass("hidden");
            	 $("#addtrackbtn").prop('disabled', false);
            	 location.reload(true);
                 
         })
         
         .fail (function(jqXHR, textStatus, errorThrown) { 
        	 alert("Add Track failed");
                  });
        		 
        	 });
        	 
        	 
        	 $("#week_no, #max_week, #activity_type, #handson_activity,#cc_activity,#ict_activity,#mockict_activity,#select_mentor,#select_project,#xp_points, #pass_grade").on('change keyup',function() {
        		 if($("#check_box").prop('checked') == false){
	        		 $activity_type = $('#activity_type option:selected').text();
	        		 if($activity_type == 'Practice'){
	        			 $('#add_handson').show();
	        		 }if($activity_type == 'CC'){
	        			 $('#add_cc').show();
	        		 }if($activity_type == 'ICT'){
	        			 $('#add_ict').show();
	        		 }if($activity_type == 'Project'){
	        			 $('#add_project').show();
	        		 }if($activity_type == 'Mock ICT'){
	        			 $('#add_mockict').show();
	        		 }
	
	        		 $('#add_week').show();$('#add_track').hide();$('#cancel').hide();$('#add_track_table').hide();$('#track_summarytable').hide();
	        		 $('#week_summarytable').hide();$('#message').hide();
        		 }
        		 
        	 });
        	 
        	$("#week_no , #max_week, #xp_points, #pass_grade").on("keypress keyup blur", function(event) {
                 $(this).val($(this).val().replace(/[^0-9\,]/g, ''));
                     if ( event.which < 48 || event.which > 57) {
                     event.preventDefault();
                             }
                  });
        	 
        	 $(document).on('click', '#add_handson', function() {

	           		$milestone_name = $('#milestone_name option:selected').text();
	           		if($milestone_name == 'Select'){
	           			alert('Kindly Choose Milestone');
	           			 return false;
	           		 }
	           		
        		 if($('#handson_activity option:selected').text() == ''){
        		      alert('Kindly Choose Hands-on');
        		      return false;
        		   }
        		 
        		 $lp_id = $('#lpname option:selected').val();
        		 $week_no = $('#week_no').val();
        		 $activity_code = $('#activity_code').val();
        		 $milestone_names = $('#milestone_name option:selected').text();
        		 $activity_types = $('#activity_type option:selected').text();
        		 $skill_type = $('#skill_type').val();
        		 var handson_details = [];
        		  $('#handson_activity option:selected').each(function(i, sel){ 
        			  handson_details[i] = {
                              "id" : $(sel).val(),
                              "name" : $(sel).text(),
                          };
                  });

        		  var handson_detail = JSON.stringify(handson_details);
        	      var milestone_name = JSON.stringify($milestone_names);
        	      var activity_type = JSON.stringify($activity_types);
        		  
  				$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
					data: {"choice" : "assessment_details", "lp_id" : $lp_id, "week_no" : $week_no, "activity_type" : activity_type,
							"handson_detail" : handson_detail, "milestone_name" : milestone_name, "activity_code" : $activity_code, "skill_type" : $skill_type }
				}).done(function( response ) {        					
					
				});
  				$('#add_handson').hide();
        	 });
        	 
        	 $(document).on('click', '#add_cc', function() {
        		 if($('#cc_activity option:selected').text() == ''){
          		      alert('Kindly Choose Assess Type 1');
          		      return false;
          		   }
        		 
        		 $lp_id = $('#lpname option:selected').val();
        		 $week_no = $('#week_no').val();
        		 $activity_code = $('#activity_code').val();
        		 $xp_points = $('#xp_points').val();
        		 $pass_grade = $('#pass_grade').val();
        		 $activity_types = $('#activity_type option:selected').text();
        		 $assessment_types = $('#assessment_type option:selected').text();
        		 $skill_type = $('#skill_type').val();
        		 
        		 var cc_details = [];
        		  $('#cc_activity option:selected').each(function(i, sel){ 
        			  cc_details[i] = {
                              "id" : $(sel).val(),
                              "name" : $(sel).text(),
                          };
                  });

        		  var cc_detail = JSON.stringify(cc_details);
        	      var activity_type = JSON.stringify($activity_types);
        	      var assessment_type = JSON.stringify($assessment_types);
        		  
  				$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
					data: {"choice" : "assessment_details", "lp_id" : $lp_id, "week_no" : $week_no, "activity_type" : activity_type,
							"cc_detail" : cc_detail, "xp_points" : $xp_points, "pass_grade" : $pass_grade, "activity_code" : $activity_code, 
							"assessment_type" : assessment_type, "skill_type" : $skill_type }
				}).done(function( response ) {   
					//console.log(response);
					const parseddata = JSON.parse(response);
					if(parseddata.status == 'failed'){
						alert("Kindly add coursetimer setting for the courseid : "+ parseddata.course);
						return false;
					}
					
					
				});
  				$('#add_cc').hide();
        	 });
        	 
        	 $(document).on('click', '#add_ict', function() {
        		 if($('#ict_activity option:selected').text() == ''){
         		      alert('Kindly Choose Assess Type 2');
         		      return false;
         		   }
        		 
        		 $lp_id = $('#lpname option:selected').val();
        		 $week_no = $('#week_no').val();
        		 $activity_code = $('#activity_code').val();
        		 $xp_points = $('#xp_points').val();
        		 $pass_grade = $('#pass_grade').val();
        		 $activity_types = $('#activity_type option:selected').text();
        		 $assessment_types = $('#assessment_type option:selected').text();
        		 $skill_type = $('#skill_type').val();
        		 
        		 var ict_details = [];
        		  $('#ict_activity option:selected').each(function(i, sel){ 
        			  ict_details[i] = {
                              "id" : $(sel).val(),
                              "name" : $(sel).text(),
                          };
                  });

        		  var ict_detail = JSON.stringify(ict_details);
        	      var activity_type = JSON.stringify($activity_types);
        	      var assessment_type = JSON.stringify($assessment_types);
        		  
  				$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
					data: {"choice" : "assessment_details", "lp_id" : $lp_id, "week_no" : $week_no, "activity_type" : activity_type,
							"ict_detail" : ict_detail, "xp_points" : $xp_points, "pass_grade" : $pass_grade, "activity_code" : $activity_code,
							"assessment_type" : assessment_type, "skill_type" : $skill_type}
				}).done(function( response ) {        					
					const parseddata = JSON.parse(response);
					if(parseddata.status == 'failed'){
						alert("Kindly add coursetimer setting for the courseid : "+ parseddata.course);
						return false;
					}
				});
  				$('#add_ict').hide();
        	 });
        	 
        	 $(document).on('click', '#add_mockict', function() {
        		 if($('#mockict_activity option:selected').text() == ''){
         		      alert('Kindly Choose Mock ICT');
         		      return false;
         		   }
        		 
        		 $lp_id = $('#lpname option:selected').val();
        		 $week_no = $('#week_no').val();
        		 $activity_code = $('#activity_code').val();
        		 $xp_points = $('#xp_points').val();
        		 $pass_grade = $('#pass_grade').val();
        		 $activity_types = $('#activity_type option:selected').text();
        		 $assessment_types = $('#assessment_type option:selected').text();
        		 
        		 var mockict_details = [];
        		  $('#mockict_activity option:selected').each(function(i, sel){ 
        			  mockict_details[i] = {
                              "id" : $(sel).val(),
                              "name" : $(sel).text(),
                          };
                  });

        		  var mockict_detail = JSON.stringify(mockict_details);
        	      var activity_type = JSON.stringify($activity_types);
        	      var assessment_type = JSON.stringify($assessment_types);
        		  
  				$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
					data: {"choice" : "assessment_details", "lp_id" : $lp_id, "week_no" : $week_no, "activity_type" : activity_type,
							"mockict_detail" : mockict_detail, "xp_points" : $xp_points, "pass_grade" : $pass_grade, "activity_code" : $activity_code,
							"assessment_type" : assessment_type}
				}).done(function( response ) {        					
					
				});
  				$('#add_mockict').hide();
        	 });
        	 
        	 $(document).on('click', '#add_mentor, #add_project', function() {
        		 $lp_id = $('#lpname option:selected').val();
        		 $week_no = $('#week_no').val();
        		 $milestone_names = $('#milestone_name option:selected').text();
        		 $activity_types = $('#activity_type option:selected').text();
        		 $activity_id = $('#select_project option:selected').val();
        		 $project_names = $('#select_project option:selected').text();
        		 
	    	      var milestone_name = JSON.stringify($milestone_names);
	    	      var activity_type = JSON.stringify($activity_types);
	    	      var project_name = JSON.stringify($project_names);
        		  
  				$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
					data: {"choice" : "add_mentor_project", "lp_id" : $lp_id, "week_no" : $week_no, "activity_type" : activity_type,
							"milestone_name" : milestone_name, "activity_id" : $activity_id, "project_name" : project_name }
				}).done(function( response ) {        					
					
				});
  				$('#add_mentor').hide();$('#add_project').hide();
        	 });
        	 
        	 $(document).on('click', '#add_week', function() {
        		 $('#add_track').show();$('#cancel').show();
        		 $schedule = "week";
        		 $lp_id = $('#lpname option:selected').val();
        		 $week_no = $('#week_no').val();
        		 $("#week_summarytable").html('<img src="https://media.giphy.com/media/NzMn60baeGIOA/giphy.gif" class="middle"/>');
        		 setTimeout(function(){ 
        			 $("#week_summarytable").load('ajax_track_week_schedule.php', "choice=table_details&lp_id=" + $lp_id + "&week_no=" + $week_no + "&schedule=" + $schedule);
        		 }, 100);
                 $('#week_summarytable').show();$('#add_week').hide();
        	 });
        	 
        	 $(document).on('click', '#add_track', function() {
        		 $('#add_week').hide();$("#week_summarytable").hide();$('#add_track_table').show();
        		 $schedule = "track";
        		 $lp_id = $('#lpname option:selected').val();
        		 $("#track_summarytable").html('<img src="https://media.giphy.com/media/NzMn60baeGIOA/giphy.gif" class="middle"/>');
        		 setTimeout(function(){
        			 $("#track_summarytable").load('ajax_track_week_schedule.php', "choice=table_details&lp_id=" + $lp_id + "&schedule=" + $schedule );
        		 }, 100);
                 $('#track_summarytable').show();$('#add_track').hide();
        	 });
        	 
        	 $(document).on('click', '#cancel', function() {
        		 $('#track_summarytable').hide();$('#week_summarytable').hide();$('#add_track').hide();$('#cancel').hide();$('#add_track_table').hide();
        		 $('#add_week').show();
        	 });
        	 
        	 $(document).on('click', '#add_track_table', function() {
        		 $max_week = $('#max_week').val();
        		 $lp_id = $('#lpname option:selected').val();
        		 $('#add_track_table').hide();$('#message').show();
        		 
        		 $("#message").load('ajax_track_week_schedule.php', "choice=add_track_schedule&track_schedlue=track_schedlue&lp_ids=" + $lp_id + "&max_week=" + $max_week );
        		 $('#track_summarytable').hide();$('#cancel').hide();
        	 });
        	 
        	 $(document).on('click', '#track_delete', function() {
        		 $('#add_track').hide();$('#cancel').show();
        		 $("#add_track").click();
        		 var currentRow=$(this).closest("tr");
                 var trackid=currentRow.find("td:eq(1)").html();
                 var week_no=currentRow.find("td:eq(2)").html(); 
                 var activity_type=currentRow.find("td:eq(3)").html();
                 var activity_id=currentRow.find("td:eq(6)").html();

        		 $.ajax({
 					method: "GET",
 					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
 					data: {"choice" : "delete", "delete_table" : "track", "trackid" : trackid, "week_no" : week_no, "activity_type" : activity_type, "activity_id" : activity_id  }
 				}).done(function( response ) {        					
 					
 				});
         	 });
        	 
        	 $('#check_box').click(function(){
        		 if( $("#check_box").prop('checked') == true )
 	    			{
		        		 $('#no_track').show();$('#milestone').hide();$('#handson_activities').hide();$('#cc_courses').hide();$('#ict_courses').hide();$('#mentor').hide();$('#project').hide();$('#xp').hide();$('#pass_percent').hide();	
		            	 $('#add_handson').hide();$('#add_cc').hide();$('#add_ict').hide();$('#add_mentor').hide();$('#add_project').hide();$('#add_track').hide();$('#cancel').hide();
		            	 $('#add_track_table').hide();$('#add_week').hide();$('#code').hide();$('#assessment_type').hide();
 	    			}else{
 	    				$('#no_track').hide();$('#add_week').show();
 	    			}
		            	 
        	 });
        		 
        	  
        	 $('#no_track').click(function(){
        	    	if( $("#check_box").is(":checked") )
    	    		{
	        	    	 $week = $('#week_no').val();
	               		 $lp_id = $('#lpname option:selected').val();
	               		 $activity_types = $('#activity_type option:selected').text();
	               		 $activity_type = JSON.stringify($activity_types);
	               		 $.ajax({
	         					method: "GET",
	         					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
	         					data: {"choice" : "checkbox_add", "lp_id" : $lp_id, "week_no" : $week, "activity_type" : $activity_type }
	         				}).done(function( response ) {        					
	         					
	         				});
    	    		}
        	    	
        	    	$('#no_track').hide();$('#add_week').show();$('#checkbox').prop('checked', false);
        				});
        	 
        	 $(document).on('click', '#week_delete', function() {
        		 $('#add_track').hide();$('#cancel').show();
        		 $("#add_week").click();
        		 var currentRow=$(this).closest("tr");
                 var trackid=currentRow.find("td:eq(1)").html();
                 var week_no=currentRow.find("td:eq(2)").html(); 
                 var activity_type=currentRow.find("td:eq(3)").html();
                 var activity_id=currentRow.find("td:eq(6)").html();
        		 $.ajax({
  					method: "GET",
  					url: M.cfg.wwwroot + "/blocks/learningpath/ajax_track_week_schedule.php",
  					data: {"choice" : "delete", "delete_table" : "week", "trackid" : trackid, "week_no" : week_no, "activity_type" : activity_type, "activity_id" : activity_id  }
  				}).done(function( response ) {        					
  					
  				});
        	 });        	 
    	   }
        };
    });
define('block_learningpath/stage_change', ['jquery'], function($) {

    return {
        init: function() {

            var rootPath = M.cfg.wwwroot;
            $box = "false";		
            $box2 = "false";		

                $('#confirmid').hide();
                $('#cancel').hide();

		 $("#cohortname").on("mouseup",function() {
                $('#submit').show();
                    var tagstr=$("#cohortname").val();
                    if(tagstr!=''){
                            $("#cohortname").val(tagstr);
                            tagex=tagex+1;
                            tagspanexid=tagspanexid+1;
           
                      }
			  });
				        		 
        		 $("#cohortname").keypress(function(e) {
                  $('#submit').show();
		  $('#summarytable').hide();
		  $('#confirmid').hide();
		  $('#cancel').hide();
               	    if(e.which == 13) {
               	    	 var tagstr=$("#cohortname").val();
               	    	if(tagstr!=''){
                 		$("#cohortname").val(tagstr);
                 		tagex=tagex+1;
                 		tagspanexid=tagspanexid+1;
               	    	}	
               	    }
               	});
				 
		
            $('#stagename, #lpname, #checkbox1, #checkbox2').change(function() {
		  $('#summarytable').hide();
		  $('#confirmid').hide();
		  $('#cancel').hide();
                  $('#submit').show();
		});
 	    $("#userid").keypress(function() {
		  $('#summarytable').hide();
		  $('#confirmid').hide();
		  $('#cancel').hide();
                  $('#submit').show();
		});
				 
function autocomplete(inp, arr) {
	        				
	  /*the autocomplete function takes two arguments,
 *  *  * 	  the text field element and an array of possible autocompleted values:*/
	  var currentFocus;
	  /*execute a function when someone writes in the text field:*/
	  inp.addEventListener("input", function(e) {
	      var a, b, i, val = this.value;
	      /*close any already open lists of autocompleted values*/
	      closeAllLists();
	      if (!val) { return false;}
	      currentFocus = -1;
	      /*create a DIV element that will contain the items (values):*/
	      a = document.createElement("DIV");
	      a.setAttribute("id", this.id + "autocomplete-list");
	      a.setAttribute("class", "autocomplete-items");
	      /*append the DIV element as a child of the autocomplete container:*/
	      this.parentNode.appendChild(a);
	      /*for each item in the array...*/
	      for (i = 0; i < arr.length; i++) {
	        /*check if the item starts with the same letters as the text field value:*/
	        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
	          /*create a DIV element for each matching element:*/
	          b = document.createElement("DIV");
	          /*make the matching letters bold:*/
	          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
	          b.innerHTML += arr[i].substr(val.length);
	          /*insert a input field that will hold the current array item's value:*/
	          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
	          /*execute a function when someone clicks on the item value (DIV element):*/
	              b.addEventListener("click", function(e) {
	              /*insert the value for the autocomplete text field:*/
	              inp.value = this.getElementsByTagName("input")[0].value;
	              /*close the list of autocompleted values,
 *  *  * 	              (or any other open lists of autocompleted values:*/
	              closeAllLists();
	          });
	          a.appendChild(b);
	        }
	      }
	  });
	  
	  /*execute a function presses a key on the keyboard:*/
	  inp.addEventListener("keydown", function(e) {
	      var x = document.getElementById(this.id + "autocomplete-list");
	      if (x) x = x.getElementsByTagName("div");
	      if (e.keyCode == 40) {
	    	
	        /*If the arrow DOWN key is pressed,
 *  *  * 	        increase the currentFocus variable:*/
	        currentFocus++;
	        
	        
	        
	        /*and and make the current item more visible:*/
	        addActive(x);
	        
	      } else if (e.keyCode == 38) { //up
	        /*If the arrow UP key is pressed,
 *  *  * 	        decrease the currentFocus variable:*/
	        currentFocus--;
	        /*and and make the current item more visible:*/
	        addActive(x);
	      } else if (e.keyCode == 13) {
	        /*If the ENTER key is pressed, prevent the form from being submitted,*/
	        
	        if (currentFocus > -1) {
	          /*and simulate a click on the "active" item:*/
	          if (x) x[currentFocus].click();
	        }
	      }
	  });
	  
	  function addActive(x) {
	    /*a function to classify an item as "active":*/
	    if (!x) return false;
	    /*start by removing the "active" class on all items:*/
	    removeActive(x);
	    if (currentFocus >= x.length) currentFocus = 0;
	    if (currentFocus < 0) currentFocus = (x.length - 1);
	    /*add class "autocomplete-active":*/
	    x[currentFocus].classList.add("autocomplete-active");
	  }
	  function removeActive(x) {
	    /*a function to remove the "active" class from all autocomplete items:*/
	    for (var i = 0; i < x.length; i++) {
	      x[i].classList.remove("autocomplete-active");
	    }
	  }
	  function closeAllLists(elmnt) {
	    /*close all autocomplete lists in the document,
 *  *  * 	    except the one passed as an argument:*/
	    var x = document.getElementsByClassName("autocomplete-items");
	    for (var i = 0; i < x.length; i++) {
	      if (elmnt != x[i] && elmnt != inp) {
	      x[i].parentNode.removeChild(x[i]);
	    }
	  }
	}
	/*execute a function when someone clicks in the document:*/
	document.addEventListener("click", function (e) {
	    closeAllLists(e.target);
     				
var tagstr=$("#cohortname").val();
if(tagstr!=''){
         $("#cohortname").val(tagstr);
         tagex=tagex+1;
         tagspanexid=tagspanexid+1;
   
        }
});
}
$.ajax({	
		method: "POST",
		url: M.cfg.wwwroot + '/blocks/learningpath/stage_ajax.php',
		data: {"choice" : "get_cohort"}
	})
	.done(function( response ) {     				
		/*var arycon=[response.join(',')];
 *  *  * 		console.log(arycon);*/
		var ary=response.substring(0, response.length-1);
		ary=ary.substring(1);
		ary=ary.replace(/"/g, '');
		var final=ary.split(',');
				autocomplete(document.getElementById("cohortname"), final);
					});



   	    $(".userbox").on("keypress keyup blur", function(event) {
   	    $(this).val($(this).val().replace(/[^0-9\,]/g, ''));
   		if ((event.which != 44 ) && (event.which < 48 || event.which > 57)) {
    	 	event.preventDefault();
   			}
 	     });	    


	   $('#cohortname').change(function(){
		   setTimeout(function(){
               $cohort1 = $('#cohortname').val();
               $cohort = $cohort1.toUpperCase();

               $cohort_text = JSON.stringify($cohort);
               $("#stagename").load( 'stage_ajax.php',"choice=get_stage&cohorttext="+$cohort_text);
               }, 500);
            });



		var checkboxHtml1 =
                        ' <div id="do_not" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true                           " data-backdrop="static" data-keyboard="false">' +
                        ' <div class="modal-dialog" style="max-width:550px">' +
                        ' <div class="modal-content" style="width: 75%">' +
                        ' <div class="modal-headers" style="background: black;height: 35px;">' +
                        ' <h4 class="modal-title coursetimer-text" style="margin-left: 1%;color: white;"> <strong> It will suspend the Previous Learning Path Module</strong> </div> ' +
                        ' <div class="modal-body" ></div>' +
                        ' <p style="margin-left: 20%"><b>Are You Sure you want to confirm</b></p>' +
                               ' <div class="modal-footer">'+
                               ' <button type="button" data-toggle="modal" id="confirm" >Confirm</button>'+
                               ' <button type="button" data-toggle="modal" id="default" >Default</button></div>'+

                        ' </div><br>'+
                        ' </div></div>';

		var checkboxHtml2 =
                        ' <div id="passgrade" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true                           " data-backdrop="static" data-keyboard="false">' +
                        ' <div class="modal-dialog" style="max-width:550px">' +
                        ' <div class="modal-content" style="width: 75%">' +
                        ' <div class="modal-headers" style="background: black;height: 55px;">' +
                        ' <h4 class="modal-title coursetimer-text" style="margin-left: 4%;color: white;"> <strong> It will consider only users clearing current Learning Path</strong> </div> ' +
                        ' <div class="modal-body" ></div>' +
                        ' <p style="margin-left: 20%"><b>Are You Sure you want to confirm</b></p>' +
                               ' <div class="modal-footer">'+
                               ' <button type="button" data-toggle="modal" id="confirm1" >Confirm</button>'+
                               ' <button type="button" data-toggle="modal" id="default1" >Default</button></div>'+

                        ' </div><br>'+
                        ' </div></div>';

		$("#page-header").append(checkboxHtml1);
		$("#page-header").append(checkboxHtml2);

	    $('#checkbox1').click(function(){
	    $('#do_not').modal('show'); 
                $('#submit').show();

	    	$('#confirm').click(function(){
	    	$("#checkbox1").prop('checked', true);
	    	$('#do_not').modal('hide'); 
				});
	    	$('#default').click(function(){
	    	$("#checkbox1").prop('checked', false);
	    	$('#do_not').modal('hide'); 
				});
			});

	    $('#checkbox2').click(function(){
	    $('#passgrade').modal('show'); 
                $('#submit').show();

	    	$('#confirm1').click(function(){
	    	$("#checkbox2").prop('checked', true);
	    	$('#passgrade').modal('hide'); 
				});
	    	$('#default1').click(function(){
	    	$("#checkbox2").prop('checked', false);
	    	$('#passgrade').modal('hide'); 
				});
                        });
	    
            $('#newlp').hide();
            $('#stagename').change(function() {
                $('#submit').show();
                if ($('#stagename option:selected').text() == 'Others') {
                    $('#newlp').show();
                } else {
                    $('#newlp').hide();
                }
            });

	    $('#checkbox1').click(function(){
	        if($(this).prop("checked") == true){
		    $box = "true";		
            	 	}
            	else if($(this).prop("checked") == false){
		    $box = "false";		
            		}
        		});

	    $('#checkbox2').click(function(){
	        if($(this).prop("checked") == true){
		    $box2 = "true";		
            	 	}
            	else if($(this).prop("checked") == false){
		    $box2 = "false";		
            		}
        		});

            $(document).on('click', '#submit', function() {
                $cohort1 = $('#cohortname').val();
		$success = "false";
                
                $userid = $('#userid').val();
                $raw_oldlp = $('#stagename option:selected').text();
                $oldlp = $raw_oldlp.replace(/&/g, "@");
                $raw_lp = $('#lpname option:selected').text();
                $lp = $raw_lp.replace(/&/g, "@");
                $cohort = $cohort1.toUpperCase();

                $cohort_text = JSON.stringify($cohort);
                $("#summarytable").html('<img src="https://media.giphy.com/media/NzMn60baeGIOA/giphy.gif" class="middle"/>');
                $("#summarytable").load('stage_ajax.php', "choice=get_data&cohort_data=" + $cohort_text + "&oldlp_data=" + $oldlp + "&lp_data=" + $lp + "&box_data=" + $box +"&box2_data=" + $box2 + "&userid_data=" + $userid + "&confirm_data=" + $success);

                $('#summarytable').show();
                $('#confirmid').show();
                $('#cancel').show();
                $('#submit').hide();
            });
	   $(document).on('click', '#confirmid', function() {
		$success = "true";
                $cohort1 = $('#cohortname').val();
                $userid = $('#userid').val();
                $raw_oldlp = $('#stagename option:selected').text();
                $oldlp = $raw_oldlp.replace(/&/g, "@");
                $raw_lp = $('#lpname option:selected').text();
                $lp = $raw_lp.replace(/&/g, "@");
                $cohort = $cohort1.toUpperCase();

                $cohort_text = JSON.stringify($cohort);
                $("#summarytable").load('stage_ajax.php', "choice=get_data&cohort_data=" + $cohort_text + "&oldlp_data=" + $oldlp + "&lp_data=" + $lp + "&box_data=" + $box +"&box2_data=" + $box2 + "&userid_data=" + $userid + "&confirm_data=" + $success);
		
                $('#confirmid').hide();
                $('#cancel').hide();
		
            });

	   $(document).on('click', '#cancel', function() {
		location.replace(rootPath+"/blocks/learningpath/stage_change.php");
            });
        }
    };
});
define('block_learningpath/script', ['jquery','jqueryui'], function($) {
 
    return {
        init: function(args) {        	
        	var url=  $(location).attr('href');
        	var rootPath = M.cfg.wwwroot; 
        	var $learningpath_id = args;
        	
        	var addLearningPathHtml =
				' <div id="learningpath_add" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:550px">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Create Learning Path </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div id="learning_path_name"><label style="width:36%;"> <b> Learning Path Name: </b></label> &nbsp; '+
				' <input type="text" id="learningPath_name" name="name" style="width:60%;" required>'+				
				' </div><br>'+
				' <div id="learning_path_description"><label style="width:36%;"> <b> Learning Path Description: </b></label><br>'+
				' <textarea rows="4" cols="50" id="learningPath_description" style="width:98%;" required></textarea>'+				
				' </div><br>'+
                ' <div id="learningpath_type"><br><label style="width:36%;"><b> Learning Path Type </b></label> &nbsp; '+
                ' <select id="lp_types" style="width:60%;" required>'+
                '<option value="Standard">Standard</option>'+
                ' <option value="Custom" selected>Custom</option>'+
                ' <option value="Niche">Niche</option>'+                                                                                                                                                                 ' </select>'+                                                                                                                         ' </div> ' +
				' <div id="learning_path_duration"><label style="width:36%;"> <b> Duration (In days): </b></label> &nbsp; '+
				' <input type="text" pattern= "[0-9]" id="learningPath_duration" name="duration" style="width:60%;" required>'+				
				' </div><br>'+
				' <div id="learning_path_certification"><label style="width:36%;"> <b> Applicable for certification: </b></label> &nbsp; '+
				' <select id="learningPath_certification" style="width:60%;" required>'+
				' <option value="">Select</option>'+
				' <option value="yes">Yes</option>'+
				' <option value="no">No</option>'+
				' </select>'+				
				' </div>'+
				' <div id="learning_path_certificate_name" style="display:none;"><br><label style="width:36%;"> <b> Certificate Name: </b></label> &nbsp; '+
				' <input type="text" id="learningPath_certificate_name" name="certificate_name" style="width:60%;" required>'+				
				' </div>'+
				' <div id="learning_path_order"><br><label style="width:36%;"> <b> Completion Order: </b></label> &nbsp; '+
				' <select id="learningPath_order" style="width:60%;" required>'+
				' <option value="">Select</option>'+
				' <option value="inorder">All in order</option>'+
				' <option value="notinorder">All in any order</option>'+
				' </select>'+								
				' </div>'+
				' <div id="course_sequencing"><label style="width:36%;"> <b> Course sequential opening: </b></label> &nbsp; '+
				' <select id="coursesequencing" style="width:60%;" required>'+
				' <option value="yes">Yes</option>'+
				' <option value="no" selected>No</option>'+
				' </select>'+				
				' </div>'+
		        ' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="add_submit" aria-expanded="false">Add</button>'+
				' <button type="button" class="btn btn-info" id="add_cancel" aria-expanded="false">Cancel</button>'+
				' </div>'+
				' </div>'+
				' </div></div>';
				
				var editLearningPathHtml =
				' <div id="learningpath_edit" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:550px">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Create Learning Path </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div id="learning_path_name_edit"><label style="width:36%;"> <b> Learning Path Name: </b></label> &nbsp; '+
				' <input type="text" id="learningPath_name" name="name" style="width:60%;" required>'+				
				' </div><br>'+
				' <div id="learning_path_description_edit"><label style="width:36%;"> <b> Learning Path Description: </b></label><br>'+
				' <textarea rows="4" cols="50" id="learningPath_description" style="width:98%;" required></textarea>'+				
				' </div><br>'+
				' <div id="learning_path_duration_edit"><label style="width:36%;"> <b> Duration (In days): </b></label> &nbsp; '+
				' <input type="text" pattern= "[0-9]" id="learningPath_duration" name="duration" style="width:60%;" required>'+				
				' </div><br>'+
				' <div id="learning_path_certification"><label style="width:36%;"> <b> Applicable for certification: </b></label> &nbsp; '+
				' <select id="learningPath_certification_edit" style="width:60%;" required>'+
				' <option value="">Select</option>'+
				' <option value="yes">Yes</option>'+
				' <option value="no">No</option>'+
				' </select>'+				
				' </div>'+
				' <div id="learning_path_certificate_name" style="display:none;"><br><label style="width:36%;"> <b> Certificate Name: </b></label> &nbsp; '+
				' <input type="text" id="learningPath_certificate_name_edit" name="certificate_name" style="width:60%;" required>'+				
				' </div>'+
				' <div id="learning_path_order"><br><label style="width:36%;"> <b> Completion Order: </b></label> &nbsp; '+
				' <select id="learningPath_order_edit" style="width:60%;" required>'+
				' <option value="">Select</option>'+
				' <option value="inorder">All in order</option>'+
				' <option value="notinorder">All in any order</option>'+
				' </select>'+								
				' </div>'+
				' <div id="course_sequencing"><label style="width:36%;"> <b> Course sequential opening: </b></label> &nbsp; '+
				' <select id="coursesequencing" style="width:60%;" required>'+
				' <option value="yes">Yes</option>'+
				' <option value="no" selected>No</option>'+
				' </select>'+				
				' </div>'+
                ' <div id="learningpath_type"><br><label style="width:36%;"><b> Milestone Type </b></label> &nbsp; '+
                ' <select id="lp_types" style="width:60%;" required>'+
                ' <option value="Standard">Standard</option>'+
				' <option value="Custom" selected>Custom</option>'+
                ' <option value="Niche">Niche</option>'+	
				' </select>'+	
                ' </div> ' +
				' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="add_submit" aria-expanded="false">Add</button>'+
				' <button type="button" class="btn btn-info" id="add_cancel" aria-expanded="false">Cancel</button>'+
				' </div>'+
				' </div>'+
				' </div></div>';
        	
        	var courseModalHTML = 
        		' <div id="course_add" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:550px">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Course </strong> </div> ' +
				' <div class="modal-body" >' +				
				' <div id="learning_path_course"><br><label style="width:36%;"><b> Select a course: </b></label> &nbsp; '+
				' <select id="learningPath_course" style="width:60%;" required>'+					
				' </select>'+								
				' </div>'+				
				' <div id="learning_path_mandatory"><br><label style="width:36%;"> <b> Mandatory to learn: </b></label> &nbsp; '+
				' <select id="learningPath_mandatory" style="width:60%;" required>'+
				' <option value="">Select</option>'+
				' <option value="yes">Yes</option>'+
				' <option value="no">No</option>'+
				' </select>'+								
				' </div>'+
				' <div id="learning_path_stages"><br><label style="width:36%;"><b> Choose the learning path stage: </b></label> &nbsp; '+
				' <select id="learningPath_stages" style="width:60%;" required>'+				
				' </select>'+
				' </div>'+
				' <div id="learning_path_milestone" style="display:none;"><br><label style="width:36%;"><b> Choose the milestone: </b></label> &nbsp; '+
				' <select id="learningPath_milestone" style="width:60%;" required>'+				
				' </select>'+
				' </div>'+
				' <div id="learning_path_codeChallenge"><br><label style="width:36%;"><b> Choose the component type: </b></label> &nbsp; '+
				' <select id="learningPath_codeChallenge" style="width:60%;" required>'+				
				' </select>'+
				' </div>'+
				' <div id="course_section_confirmation"><br><label style="width:36%;"><b> Do you want to add section: </b></label> &nbsp; '+
				' <select id="confirmation_course_section" style="width:60%;" required>'+
				' <option value="">Select</option>'+
				' <option value="yes">Yes</option>'+
				' <option value="no">No</option>'+
				' </select>'+								
				' </div>'+
				' <div id="learning_path_course_section" style="display:none;"><br><label style="width:36%;"><b> Select a section: </b></label> &nbsp; '+
				' <select id="learningPath_course_section" style="width:60%;" required>'+								
				' </select>'+								
				' </div>'+
				' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="course_submit" aria-expanded="false"> Add </button>'+
				' <button type="button" class="btn btn-info" id="course_cancel" aria-expanded="false"> Cancel </button>'+
				' </div>'+
				' </div>'+
				' </div></div>';
        	
        	var addExternalLinkHtml =
				' <div id="external_add" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:550px">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> External Link </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div id="learning_path_external_link"> '+
				' <label style="width:36%;"> <b> Name : </b> </label> &nbsp;'+
				' <input type="text" id="learningPath_external_link_name" name="external_link_name" style="width:60%;" required>'+
				' <label style="width:36%;"> <b> External Link: </b></label> &nbsp; '+
				' <input type="text" id="learningPath_external_link" name="external_link" style="width:60%;" required>'+
				' </div>'+				
				' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="external_link_submit" aria-expanded="false"> Add </button>'+
				' <button type="button" class="btn btn-info" id="external_link_cancel" aria-expanded="false"> Cancel </button>'+
				' </div>'+
				' </div>'+
				' </div></div>';
				
			var addStageHtml =
				' <div id="stage_add" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:550px">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Add New Stage </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div id="stagename"><label style="width:36%;"> <b> Stage Name: </b></label> &nbsp; '+
				' <input type="text" id="Stage_Name" name="name" style="width:60%;" required>'+				
				' </div><br>'+
				' <div id="stagedescription"><label style="width:36%;"> <b> Stage Description: </b></label><br>'+
				' <textarea rows="4" cols="50" id="Stage_Description" style="width:98%;" required></textarea>'+				
				' </div><br>'+
                                ' <div id="stagenumber"><label style="width:36%;"> <b> Stage Number: </b></label> &nbsp; '+
                                ' <input type="text" id="Stage_Number" name="name" style="width:60%;" required>'+
                                ' </div><br>'+

				' <div id="sortorder"><label style="width:36%;"> <b> Sort Order (In numbers): </b></label> &nbsp; '+
				' <input type="text" pattern= "[0-9]" id="stage_sortorder" name="sortorder" style="width:60%;" required>'+				
				' </div><br>'+
				' <div id="stagecode"><label style="width:36%;"> <b> Stagecode </b></label> &nbsp; '+
				' <input type="text" id="Stage_code" name="Stage_code" style="width:60%;" required>'+				
				' </div><br>'+
				' </div>'+
				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="stage_submit" aria-expanded="false">Add</button>'+
				' <button type="button" class="btn btn-info" id="stage_cancel" aria-expanded="false">Cancel</button>'+
				' </div>'+
				' </div>'+
				' </div></div>';
				
			var addMilestoneHtml =
				' <div id="milestone_add" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:550px">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Add Milestone </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div id="learning_path_milestone"><label style="width:36%;"><b> Select a stage </b></label> &nbsp; '+
				' <select id="milestone_stage" style="width:60%;" required>'+					
				' </select>'+								
				' </div><br>'+
				' <div id="milestone"><label style="width:36%;"> <b> Milestone </b></label> &nbsp; '+
				' <input type="text" id="Milestone_Name" name="name" style="width:60%;" required>'+				
				' </div><br>'+
                                 ' <div id="stage_select"><label style="width:36%;"> <b> StageNumber </b></label> &nbsp; '+
                                ' <input type="text" id="Stage_type" name="name"  style="width:60%;" required>'+
                                ' </div><br>'+
                                ' <div id="category_id"><label style="width:36%;"><b> Category </b></label> &nbsp; '+
                                ' <select id="Category" style="width:60%;" required>'+
                                ' <option value="">Select</option>'+
				' <option value="category">category</option>'+
				' <option value="course">course</option>'+
                                ' </select>'+
                                ' </div><br>'+
				' <div id="course_id1" style="display:none;"><label style="width:36%;"> <b> Courseid </b></label> &nbsp' +
				' <input type="text" id="crseid" name="name"  style="width:60%;" required>' +
				' </div><br>'+
                                ' <div id="category_section" style ="display:none;"><label style="width:36%;"><b> Category ID </b></label> &nbsp; '+
                                ' <select id="cat_sec" style="width:60%;" required>'+
                                ' </select>'+
                                ' </div><br>'+
				' <div id="course_Points"><label style="width:36%;"> <b> Points </b></label> &nbsp' +
				' <input type="text" id="points_id" name="name"  style="width:60%;" required>' +
				' </div><br>'+
				' <div id="milestonecode"><label style="width:36%;"> <b> Milestonecode: </b></label> &nbsp; '+
				' <input type="text" id="Milestone_code" name="name" style="width:60%;" required>'+				
				' </div><br>'+
				' <div id="sort_Points"><label style="width:36%;"> <b> SortOrder </b></label> &nbsp' +
				' <input type="text" id="sort_id" name="name"  style="width:60%;" required>' +
                                ' </div><br>'+
                                ' <div id="duration_id"><label style="width:36%;"> <b> Duration </b></label> &nbsp' +
                                ' <input type="text" id="time_id" name="name"  style="width:60%;" required>' +
                                ' </div><br>'+
				' </div>'+

				

				' <div class="modal-footer">'+
				' <button type="button" class="btn btn-info" id="milestone_submit" aria-expanded="false">Add</button>'+
				' <button type="button" class="btn btn-info" id="milestone_cancel" aria-expanded="false">Cancel</button>'+
				' </div>'+
				' </div>'+
				' </div></div>';	
				
				
        	
        	var confirmationHtml =
				' <div id="confirmationModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div id = "errordialog" class="modal-dialog" style="max-width:351px">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;color: white;"> Confirmation </h4> </div>' +
				' <div class="modal-body" id="confirmation"></div>'+
				' <div class="modal-footer">'+ 					
				' <button type="button" class="btn btn-default" id="confirmationOk" aria-expanded="false" >Ok</button>'+
				' <button type="button" class="btn btn-default" id="confirmationCancel" aria-expanded="false" >Cancel</button></div>'+
				' </div>'+
				' </div></div>';
        	    
				
            var milestone_edit = 
        		' <div id="milestone_edit" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:550px">' +
				' <div class="modal-content" >' +
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Edit Milestone </strong> </div> ' +
				' <div class="modal-body" >' +
				' <div id="edit_learning_path_milestone"><br><label style="width:36%;"><b> Select a stage: </b></label> &nbsp; '+
				' <select id="milestoneedit_stage" style="width:60%;" required>'+					
				' </select>'+		
                ' <div class="modal-footer">'+
                ' </div><br>'+
                ' </div></div>';
            var milestone_delete = ' <div id="milestone_delete" class="modal fade" tabindex="-1" style="padding-top: 60px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
                                ' <div class="modal-dialog" style="max-width:550px">' +
                                ' <div class="modal-content" >' +
                                ' <div class="modal-headers" style="background: black;height: 50px;">' +
                                ' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Delete Milestone </strong> </div> ' +
                                ' <div class="modal-body" >' +
                                ' <div id="delete_learning_path_milestone"><br><label style="width:36%;"><b> Select a stage: </b></label> &nbsp; '+
                                ' <select id="milestonedelete_stage" style="width:60%;" required>'+
                                ' </select>'+
                                ' <div class="modal-footer">'+
                                ' </div><br>'+
                                ' </div></div>';

			var cleardata_modal =
				' <div id="cleardataModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:351px">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;margin-top: 10px;color: white;"> Confirmation </h4> </div>' +
				' <div class="modal-body" id="cleardata_confirmation"></div>'+
				' <div class="modal-footer">'+ 					
				' <button type="button" class="btn btn-default" id="cleardataOk" aria-expanded="false" >Ok</button>'+
				' <button type="button" class="btn btn-default" id="cleardataCancel" aria-expanded="false" >Cancel</button></div>'+
				' </div>'+
				' </div></div>';
				
			var description_modal =
				' <div id="descriptionModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
				' <div class="modal-dialog" style="max-width:1000px">' +
				' <div class="modal-content">' +					
				' <div class="modal-headers" style="background: black;height: 50px;">' +
				' <button type="button" class="close" data-dismiss="modal" style="margin: 10px;color: #fff;">&times;</button>' +
				' <h4 class="modal-title" id="descriptionModalTitle" style="margin: 10px;color: #fff;"> Description </h4> </div>' +
				' <div class="modal-body" id="descriptionModalContent"></div>'+
				' </div>'+
				' </div></div>';

    
                     var testing = '';
              
        	
        	$("#page-header").append(addLearningPathHtml);
        	$("#page-header").append(courseModalHTML);
			$("#page-header").append(editLearningPathHtml)
        	$("#page-header").append(addExternalLinkHtml);
		    $("#page-header").append(addStageHtml);
		    $("#page-header").append(addMilestoneHtml);
        	$("#page-header").append(confirmationHtml);
        	$("#page-header").append(milestone_edit);
			$("#page-header").append(cleardata_modal);
            $("#page-header").append(milestone_delete);
			$("#page-header").append(description_modal);
        	 $("#page-header").append(testing);
        	$('#addLearningPath a[href = "#add_learningpath"]').click( function(){   
                        id = 30;     			
        		$("#learningpath_add").modal("show");
                        $("#lp_types").load('/blocks/learningpath/ajax.php', 'lptypes='+id);
    		});
        	        	        	
        	var id = 0;
        	
        	$("#Learning_Path").click( function(){        			
        		id = $(this).data("value");        		
        		$("#learningpath_add").modal("show");
                         $("#lp_types").load('ajax.php', 'lptypes='+id);
    		});
        	
        	$("#Course").click( function(){        			
        		id = $(this).data("value");           		
        		$("#learningPath_course").load('ajax.php', 'learningpath_course='+id);
        		$("#learningPath_codeChallenge").load('ajax.php', 'addcodechallenge=addcodechallenge');
        		$("#learningPath_stages").load('ajax.php', 'stages=stage&stagelpid='+id);
        		$("#course_add").modal("show");
    		});        	         	
        	
        	$("#External_Link").click( function(){        			
        		id = $(this).data("value");        		
        		$("#external_add").modal("show");
    		}); 
				
			$("#Stage").click( function(){        			
        		id = $(this).data("value");        		
        		$("#stage_add").modal("show");
                        //$("#edit_table").modal("show");
    		});

                                        

                    $("#Delete_MILESTONE").click(function(){
                     id = $(this).data("value");
                      $("#milestonedelete_stage").load('ajax.php', 'editmilestone='+id);
                      $("#milestone_delete").modal("show");
                     });
			
			$("#Milestone").click( function(){        			
        		id = $(this).data("value");
				$("#milestone_stage").load('ajax.php', 'loadmilestone='+id);        		
        		$("#milestone_add").modal("show");
    		});	
            
			 $("#MILESTONE").click(function(){
				id = $(this).data("value");
                                $("#milestoneedit_stage").load('ajax.php', 'editmilestone='+id);
                                $("#milestone_edit").modal("show");
				});
            $("#Delete_STAGE").click( function(){
                  id = $(this).data("value");
                 $.ajax({
                                        method: "GET",
                                        url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
                                        data: {"edit_stage" : "edit_stage","lpid" : id },
                                        success: function(response){
                                           var responsedata = $.parseJSON(response);
                                           var tablerow = '';
                                         $.each(responsedata, function(key, value) {
                                                        tablerow +='<tr contenteditable="true" id="'+value.id+'" ><td>'+value.contextname+'</td><td>'+value.stage_description+'</td><td>'+value.sortorder+'</td><td input type="text" contenteditable="false" class="unchanges" >'+value.learningpathid+'</td><td> <button class="stagedelete">Delete</button> </td></tr>';
                                })
                                 Displaytable1(tablerow);
                                }
                               }).done(function( response ) {
                                        if(response === "success"){

                                                 console.log("truee");
                                        }
                                });
                });
        
            $("#Delete_Learning").click( function(){
            console.log("hii");
            });
   
           
              $("#STAGE").click(function(){
                 id = $(this).data("value");
                  $.ajax({
 					method: "GET",
 					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
 					data: {"edit_stage" : "edit_stage","lpid" : id },
                                        success: function(response){
                                           var responsedata = $.parseJSON(response);
                                           var tablerow = '';
                                            var newresponsedata = $.parseJSON(response);
   
                                         $.each(responsedata, function(key, value) {
                                   			tablerow +='<tr contenteditable="true" id="'+value.id+'" sid="'+value.sid+'" ><td>'+value.contextname+'</td><td>'+value.stage_description+'</td><td>'+value.sortorder+'</td><td input type="text" contenteditable="false" class="unchanges" >'+value.learningpathid+'</td></tr>';
                              	})
                                 Displaytable(tablerow);
                                }
                               }).done(function( response ) {	
 					if(response === "success"){
 				 
 						 console.log("truee");
 					}
 				});
        	});
         
                      	
        	$('#manageLearningPath a[href = "#learningpathContent"]').click( function(){        			
    			document.getElementById("contents_learningpath").style.display = "block";
    			document.getElementById("users_learningpath").style.display = "none";
    			$("#content").attr("class","nav-link active");
    			$("#userDetail").attr("class","nav-link");    			
    		});
        	
        	$('#manageLearningPath a[href = "#userLearningpath"]').click( function(){      
        		$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
					data: {"populate_user_data" : "populate_user_data", "populate_learningpath_id" : $learningpath_id}
				}).done(function( response ) {	
					$( "#user_table" ).html(response);
					document.getElementById("contents_learningpath").style.display = "none";
	    			document.getElementById("users_learningpath").style.display = "block";
	    			$("#userDetail").attr("class","nav-link active");
	    			$("#content").attr("class","nav-link");    			
				});    			
    		});
        	
                var $category_selection = $('#Category');
        	var $learningpath_certification_select = $('#learningPath_certification');
        	var $learningpath_order_select = $('#learningPath_order');
        	var $learningpath_name = $("#learningPath_name");
        	var $learningpath_duration = $("#learningPath_duration");
        	var $learningPath_certificate_name = $("#learningPath_certificate_name");
        	var $learningPath_description = $("#learningPath_description");
        	var $learningpath_certification_val = '';
        	var $learningpath_order_val = '';
        	var $learningpath_name_val = '';
        	var $learningpath_duration_val = '';
        	var $learningPath_certificate_name_val = '';
        	var $learningpath_course_val = '';
        	var $course_section_val = '';
        	var $course_section_confirmation = '';
        	var $learningPath_description_val = '';
        	var $course_mandatory = '';
        	var $learningPath_codeChallenge = $("#learningPath_codeChallenge option:selected").val();
        	var $learningPath_stage = '';
        	var $learningPath_milestone = $("#learningPath_milestone option:selected").val();
        	var  $stage_id = $('#milestoneedit_stage option:selected').val();
                var $lptypes = '';
 
        	
        	$("#learningPath_course").change(function(){
        		$learningpath_course_val = $("#learningPath_course").val();
        		$("#confirmation_course_section").val("");
        		$("#learning_path_course_section").css("display","none");        		
        	});
        	
        	$("#learningPath_stages").change(function(){
        		$learningPath_stage = $("#learningPath_stages").val();
        		if($learningPath_stage !== ''){
        			$stage_id = Number($learningPath_stage.trim());
        			$("#learningPath_milestone").load('ajax.php', 'milestone=milestone&milestonestageid='+$stage_id);
        			$("#learning_path_milestone").css("display","block");
        		} else {
        			$("#learning_path_milestone").css("display","none");
        		}
        	});
        	
        	$("#learningPath_milestone").change(function(){
        		$learningPath_milestone = $("#learningPath_milestone").val();        		
        	});
        	
        	$("#learningPath_codeChallenge").change(function(){
        		$learningPath_codeChallenge = $("#learningPath_codeChallenge").val();        		        		
        	});
        	
        	$("#confirmation_course_section").change(function(){
        		$course_section_confirmation = $("#confirmation_course_section").val();
        		$temp = Number($learningpath_course_val.trim());
        		if($course_section_confirmation === "yes"){
        			$("#learningPath_course_section").load('ajax.php', 'learningpath_course_section='+$temp+'&section_lp_id='+id);
        			$("#learning_path_course_section").css("display","block");
        		} else {        			
        			$("#learning_path_course_section").css("display","none");
        		}
        		
        	});   

                $("#milestonedelete_stage").change(function(){
                         $stage_name = $('#milestonedelete_stage option:selected').val();
                         $learningpath_id;
                         $.ajax({
                                        method: "GET",
                                        url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
                                        data: {"editmilestone_stage" : "editmilestone_stage", "$stage_name" : $stage_name,"lpid" : $learningpath_id },
                                        success: function(response){
                                                   var responsedata = $.parseJSON(response);
                                                   var tablerow='';
                                                  $.each(responsedata, function(key, value) {
                                                tablerow +='<tr contenteditable="true" id="'+value.id+'" ><td scope="row"  class="unchanges" contenteditable="false" >'+value.coursename+'</td><td scope="row"  class="unchanges"  contenteditable="false" >'+value.type+'</td><td scope="row">'+value.duration+'</td><td scope="row">'+value.points+'</td><td scope="row"  >'+value.sort+'</td><td scope="row"  class="unchanges"  contenteditable="false">'+value.lpid+'</td> <td> <button class="btndelete">Delete</button>  </td> </tr>';
                                        })
                                Displaymodaltables1(tablerow);
                                }
                                }).done(function( response ) {
                                        if(response === "success"){

                                                 console.log("truee");
                                        }
                                });
                });

          function Displaymodaltables1(tablerow){
                var testing = '<div id="delete_table" class="modal fade" tabindex="-1" style="padding-top: 100px;overflow:scroll;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
                ' <div  class="modal-dialog" style="max-width:700px">' +
                ' <div class="modal-content" >' +
                ' <div class="modal-headers" style="background: black;height: 50px;">' +
                ' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Delete  Milestone </strong> </div> ' +
                ' <div class="modal-body"  >'+
                '<h6> click on the column for which you have to delete</h6>'+
                '  <table   class="table table-bordered " id = "new_edits1" >'+
                ' <thead> <tr> <th scope="col" >Milestone Name</th> <th scope="col">Learning Type</th> <th scope="col" >Duration</th> <th scope="col">Points</th> <th  scope="col">SortOrder</th> <th scope="col">Lpid</th> <th scope="col">  </th> </tr> </thead>'+
                '  </table>'+
                ' </div>'+
                ' <div class="modal-footer">'+
                ' <button type="button" class="btn btn-info" id="edit_table_cancel" aria-expanded="false"> Cancel </button>'+
                ' </div>'+
                ' </div></div>';
                 $("#page-header").append(testing);
                 $("#milestone_edit").modal("hide");
                 $("#delete_table").modal("show");
                 $("#new_edits1").append(tablerow);
                 $('.unchanges').attr("disabled",true);
                 $('td.unchanges').css('opacity', '0.5').click(function () {
               event.preventDefault();
               return false;
               });
                }


              $(document).on("click",".btndelete",function() {
                        var id = this.id;
                       var currentRow=$(this).closest("tr");
                       var milestonename=currentRow.find("td:eq(0)").html();
                       var LPID=currentRow.find("td:eq(5)").text();
                       var id = this.id;
					   var mid = $(this).closest('tr').attr('id');
                     
                $.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
    					data: {"delete_milestone" : "delete_milestone", 
    						"mid" : mid, 
    						"milestonename" : milestonename, 
    						"LPID" : LPID
    						}        		
    				}).done(function( response ) {	
    					if(response === "success"){
    						$("#delete_table").modal("hide");
    				          	document.location.reload(true);
    					}
    				}); 
           
                       });
                       
                      	
        	$("#milestoneedit_stage").change(function(){
        		 $stage_name = $('#milestoneedit_stage option:selected').val();
        		 $learningpath_id;
           		 $.ajax({
 					method: "GET",
 					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
 					data: {"editmilestone_stage" : "editmilestone_stage", "$stage_name" : $stage_name,"lpid" : $learningpath_id },
                                        success: function(response){
                                                   var responsedata = $.parseJSON(response);
                                                   var tablerow='';
                                                  $.each(responsedata, function(key, value) {
						tablerow +='<tr contenteditable="true" id="'+value.id+'" ><td scope="row"  class="unchanges" contenteditable="false" >'+value.coursename+'</td><td scope="row"  class="unchanges"  contenteditable="false" >'+value.type+'</td><td scope="row">'+value.duration+'</td><td scope="row">'+value.points+'</td><td scope="row"  >'+value.sort+'</td><td scope="row"  class="unchanges"  contenteditable="false">'+value.lpid+'</td> </tr>';
                                  	})
                                Displaymodaltable(tablerow);
                                }
 				}).done(function( response ) {	
 					if(response === "success"){
 				 
 						 console.log("truee");
 					}
 				});
        	});
                           

		function Displaymodaltable(tablerow){
                var testing = '<div id="edit_table" class="modal fade" tabindex="-1" style="padding-top: 100px;overflow:scroll;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
                ' <div  class="modal-dialog" style="max-width:600px">' +
                ' <div class="modal-content" >' +
	        ' <div class="modal-headers" style="background: black;height: 50px;">' +
                ' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Edit  Milestone </strong> </div> ' +
                ' <div class="modal-body"  >'+
				'<h6> click on the column for which you have to edit</h6>'+
                '  <table   class="table table-bordered " id = "new_edit" >'+
                ' <thead> <tr> <th scope="col" >Milestone Name</th> <th scope="col">Learning Type</th> <th scope="col" >Duration</th> <th scope="col">Points</th> <th  scope="col">SortOrder</th> <th scope="col">Lpid</th> </tr> </thead>'+
                '  </table>'+
		' </div>'+
                ' <div class="modal-footer">'+
                ' <button type="button" class="btn btn-info" id="edit_table_cancel" aria-expanded="false"> Cancel </button>'+
		' <button type="button" class="btn btn-info" id="edit_table_add" aria-expanded="false"> Save </button>'+
		' </div>'+
	        ' </div></div>';
                 $("#page-header").append(testing);           
                 $("#milestone_edit").modal("hide");
                 $("#edit_table").modal("show");
                 $("#new_edit").append(tablerow);
                 $('.unchanges').attr("disabled",true);
                 $('td.unchanges').css('opacity', '0.5').click(function () {
               event.preventDefault();
               return false;
               });
		}
         
                 $(document).on("click","#edit_table_cancel",function() { 
                   $("#edit_table").modal("hide");
                    location.reload();   				
			});
			$(document).on("click","#edit_table_add",function() {
                    var arrData=[];
                        $("#new_edit tr").each(function(){
                       var id = this.id;
                       var currentRow=$(this);
                       var milestonename=currentRow.find("td:eq(0)").text();
                       var learningtype=currentRow.find("td:eq(1)").text();
                       var duration=currentRow.find("td:eq(2)").text();
                       var points=currentRow.find("td:eq(3)").text();
		       var sortorder=currentRow.find("td:eq(4)").text();
		       var LPID=currentRow.find("td:eq(5)").text();
                       var id = this.id;
                  

                   var obj={};
                   obj.milestonename=milestonename;
                   obj.learningtype=learningtype;
                   obj.sortorder=sortorder;
                   obj.learningpathid=LPID;
	           obj.duration=duration;
		   obj.points=points;
                   obj.id=id;
                   arrData.push(obj);
             });
			    var  newarray = arrData.shift();
          $.ajax({
                                method: "GET",
                                url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
                                        data: {"update_stage" : "update_stage",
                                               "arrData" : arrData
                                               }
                                               }).done(function(response)
                                                   {
                                                     if(response === "success" )
                                                             {
                                                              location.reload();
                                                             }

                                       });
          });
              function Displaytable(tablerow){
               var newtesting = '<div id="edit_stage_table" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
               ' <div  class="modal-dialog" style="max-width:600px">' +
               ' <div class="modal-content" >' +
	       ' <div class="modal-headers" style="background: black;height: 50px;">' +
               ' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Edit Stage </strong> </div> ' +
               ' <div class="modal-body" >'+  
               ' <table   class="table table-bordered" id = "edit1" >'+
			    '<h6> click on the column for which you have to edit</h6>'+
               ' <thead> <tr> <th  >Stage Name</th> <th>Stage Description</th> <th>sortorder</th> <th disabled >Learningpath</th> </tr> </thead>'+
               '  </table>'+
			   '</div>'+
               ' <div class="modal-footer">'+
               ' <button type="button" class="btn btn-info" id="edit_stagetable_cancel" aria-expanded="false"> Cancel </button>'+
			   ' <button type="button" class="btn btn-info" id="edit_stagetable_Add" aria-expanded="false"> Save </button>'+
	       ' </div>'+
	       ' </div></div>';
               $("#page-header").append(newtesting);
               $("#edit_stage_table").modal("show");
               $("#edit1").append(tablerow);
               $('.unchanges').attr("disabled",true);
               $('td.unchanges').css('opacity', '0.5').click(function () {
               event.preventDefault();
               return false;
               });
               }

               function Displaytable1(tablerow){
               var newtesting = '<div id="delete_stage_table" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
               ' <div  class="modal-dialog" style="max-width:600px">' +
               ' <div class="modal-content" >' +
               ' <div class="modal-headers" style="background: black;height: 50px;">' +
               ' <h4 class="modal-title coursetimer-text" style="margin-left: 20px;color: white;"> <strong> Delete Stage </strong> </div> ' +
               ' <div class="modal-body" >'+
               ' <table   class="table table-bordered" id = "delete_edit1" >'+
               '<h6> click on the column for which you have to delete</h6>'+
               ' <thead> <tr> <th  >Stage Name</th> <th>Stage Description</th> <th>sortorder</th> <th disabled >Learningpath</th> <th> </th> </tr> </thead>'+
               '  </table>'+
               '</div>'+
               ' <div class="modal-footer">'+
               ' <button type="button" class="btn btn-info" id="delete_stagetable_cancel" aria-expanded="false"> Cancel </button>'+
               ' </div>'+
               ' </div></div>';
               $("#page-header").append(newtesting);
               $("#delete_stage_table").modal("show");
               $("#delete_edit1").append(tablerow);
               $('.unchanges').attr("disabled",true);
               $('td.unchanges').css('opacity', '0.5').click(function () {
               event.preventDefault();
               return false;
               });
               }
           
               $(document).on("click",".stagedelete",function() {
                    var id = this.id;
                    var currentRow=$(this).closest("tr");
                    var stagename=currentRow.find("td:eq(0)").text();
                    var stagedescription=currentRow.find("td:eq(1)").text();
                    var sortorder=currentRow.find("td:eq(2)").text();
                    var learningpathid=currentRow.find("td:eq(3)").text();
                    var id = this.id;
 
                      $.ajax({
                                method: "GET",
                                url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
                                        data: {"delete_stage_table" : "delete_stage_table",
                                                "stagename" : stagename,
                                                "stagedescription" : stagedescription,
                                                "sortorder" : sortorder,
                                                "learningpathid" : learningpathid
                                               }
                                               }).done(function(response)
                                                   {
                                                     location.reload();
                                                     if(response === "success" )
                                                             {
                                                              location.reload();
                                                             }

                                       });
                        });
                 
                $(document).on("click","#edit_stagetable_cancel",function() { 
                    location.reload();   				
			});
                    
                $(document).on("click","#delete_stagetable_cancel",function() {
                    location.reload();
                        });

			
		  $(document).on("click","#edit_stagetable_Add",function() {
                    var arrData=[];
                        $("#edit1 tr").each(function(){
                        var id = this.id;
                       var sid = this.sid;
                       var currentRow=$(this);
                       var stagename=currentRow.find("td:eq(0)").text();
                       var stagedescription=currentRow.find("td:eq(1)").text();
                       var sortorder=currentRow.find("td:eq(2)").text();
                       var learningpathid=currentRow.find("td:eq(3)").text();
                       var sid = $(this).closest('tr').attr('sid'); 
                       var id = this.id;

                   var obj={};
                   obj.stagename=stagename;
                   obj.stagedescription=stagedescription;
                   obj.sortorder=sortorder;
                   obj.learningpathid=learningpathid;
                   obj.id=id;
                   obj.sid=sid;
                   arrData.push(obj);
             });
			    var  newarray = arrData.shift();
          $.ajax({
                     
                                method: "GET",
                                url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
                                        data: {"update_stage_table" : "update_stage_table",
                                               "arrData" : arrData
                                               }
                                               }).done(function(response)
                                                   {
                                                   //  location.reload();
                                                     if(response === "success" )
                                                             {
                                                            location.reload();
                                                             }

                                       });
});     
        	$("#learningPath_course_section").change(function(){
        		$course_section_val = $("#learningPath_course_section").val();        		
        	});
        	
        	$("#learningPath_mandatory").change(function(){
        		$course_mandatory = $("#learningPath_mandatory").val();
        	});
        	
        	$learningpath_certification_select.change(function(){
        		$learningpath_certification_val = $learningpath_certification_select.val();
        		if($learningpath_certification_val === "yes"){
        			$("#learning_path_certificate_name").css("display","block");
        		} else {
        			$("#learning_path_certificate_name").css("display","none");
        		}
        		
        	});        	        	
        	
                $category_selection.change(function(){
                           $category_selection_val = $category_selection.val();
                           console.log($category_selection_val);
                          if($category_selection_val === "course"){
                            $("#course_id1").css("display","block");
                            $("#category_section").css("display","none"); 
                           } else if ($category_selection_val === "category"){
                             $("#category_section").css("display","block"); 
                              $("#course_id1").css("display","none");
                              $("#cat_sec").load('ajax.php', 'catsection=catsection');
                           }else {
                                $("#course_id1").css("display","none");
                                 $("#category_section").css("display","none");
                            } 
                  }); 
        	$learningpath_order_select.change(function(){
        		$learningpath_order_val = $learningpath_order_select.val();
        	});        	        	
        	
        	if(url.includes('/blocks/learningpath/manage_learningpath.php')){        		        		
        		$(document).on("click","#add_submit",function() {      
        	        $("span", "#learning_path_name").empty().remove();
            		$learningpath_name_val = $learningpath_name.val();
            		$learningpath_duration_val = $learningpath_duration.val();
                        $learningPath_description_val = $learningPath_description.val();
                        $lptypes = $('#lp_types option:selected').val();
                        $learningPath_description_array = [$learningPath_description_val];
                        $coursesequence=$('#coursesequencing').val();
                        var $learningPath_description_arr = JSON.stringify($learningPath_description_array);
            		if($learningpath_certification_val === "yes"){
            			$learningPath_certificate_name_val = $learningPath_certificate_name.val();
            			$.ajax({
        					method: "GET",
        					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
        					data: {"create_learningpath" : "create", "learningpath_name" : $learningpath_name_val, "learningpath_duration" : $learningpath_duration_val, "learningpath_certification" : $learningpath_certification_val, "learningpath_description" : $learningPath_description_arr, "learningpath_certificate_name" : $learningPath_certificate_name_val, "learningpath_order" : $learningpath_order_val,  "coursesequencing" : $coursesequence, "lptypes" : $lptypes, "parent_learningpath" : id}
        				}).done(function( response ) {	
        					if(response === "success"){
        						$("#learningpath_add").modal("hide");
        						document.location.reload(true);
        					}
        				});
            		} else if($learningpath_certification_val === "no"){
            			$.ajax({
        					method: "GET",
        					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
        				data: {"create_learningpath" : "create", "learningpath_name" : $learningpath_name_val, "learningpath_duration" : $learningpath_duration_val, "learningpath_certification" : $learningpath_certification_val, "learningpath_description" : $learningPath_description_arr, "learningpath_order" : $learningpath_order_val, "lptypes" : $lptypes , "coursesequencing" : $coursesequence, "parent_learningpath" : id}
        				}).done(function( response ) {	
        					if(response === "success"){
        						$("#learningpath_add").modal("hide");
        						document.location.reload(true);
        					}
        				});
            		}
        		});
        	} else {
        		$(document).on("click","#add_submit",function() { 
        			$("span", "#learning_path_name").empty().remove();
        			$learningpath_certification_val = $learningpath_certification_select.val();
        			$learningpath_name_val = $learningpath_name.val();
            		$learningpath_duration_val = $learningpath_duration.val();
            		$learningpath_order_val = $learningpath_order_select.val();
                         $lptypes = $('#lp_types option:selected').val();
            		$learningPath_description_val = $learningPath_description.val();
            		$learningPath_description_array = [$learningPath_description_val];
            		var $learningPath_description_arr = JSON.stringify($learningPath_description_array);
					$coursesequence=$('#coursesequencing').val();
            		
        			if($("#add_submit").text() === "Add"){
        				
        				if($learningpath_certification_val === "yes"){
                			$learningPath_certificate_name_val = $learningPath_certificate_name.val();
                			$.ajax({
            					method: "GET",
            					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
            					data: {"create_learningpath" : "create", 
            						"learningpath_name" : $learningpath_name_val, 
            						"learningpath_description" : $learningPath_description_arr,
            						"learningpath_duration" : $learningpath_duration_val, 
            						"learningpath_certification" : $learningpath_certification_val, 
            						"learningpath_certificate_name" : $learningPath_certificate_name_val, 
            						"learningpath_order" : $learningpath_order_val,
                                                        "lptypes" : $lptypes,
									"coursesequencing" : $coursesequence
            					}
            				}).done(function( response ) {	
            					if(response === "success"){
            						$("span", "#learning_path_name").empty().remove();
            						$("#learningpath_add").modal("hide");
            						document.location.reload(true);
            					} else {
            						$("#learning_path_name").append("<span style=\"color:#fb6464;\">*Learning Path already exists.</span>");
            					}
            				});
                		} else if($learningpath_certification_val === "no"){
                			$.ajax({
            					method: "GET",
            					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
            					data: {"create_learningpath" : "create",
            						"learningpath_name" : $learningpath_name_val, 
            						"learningpath_description" : $learningPath_description_arr,
            						"learningpath_duration" : $learningpath_duration_val, 
            						"learningpath_certification" : $learningpath_certification_val, 
            						"learningpath_order" : $learningpath_order_val,
                                                         "lptypes" : $lptypes,
									"coursesequencing" : $coursesequence
            					}
            				}).done(function( response ) {	
            					if(response === "success"){
            						$("span", "#learning_path_name").empty().remove();
            						$("#learningpath_add").modal("hide");
            						document.location.reload(true);
            					} else {
            						$("#learning_path_name").append("<span style=\"color:#fb6464;\">*Learning Path already exists.</span>");
            					}
            				});
                		}
        			} else if($("#add_submit").text() === "Edit"){
        				
        				if($learningpath_certification_val === "yes"){
                			$learningPath_certificate_name_val = $learningPath_certificate_name.val();
                                     
                			$.ajax({
            					method: "GET",
            					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
            					data: {"edit_learningpath" : "edit_learningpath",
					              "edit_learningpath_name" : $learningpath_name_val,
            						"edit_learningpath_id" : learningpathId,
            						"edit_learningpath_description" : $learningPath_description_arr,
            						"edit_learning_duration" : $learningpath_duration_val,
            						"edit_learningpath_certification" : $learningpath_certification_val,
            						"edit_learningpath_certificate_name" : $learningPath_certificate_name_val,
            						"edit_learningpath_order" : $learningpath_order_val,
                                                        "editlptypes" : $lptypes ,
							"edit_coursesequencing" : $coursesequence
            					}
            				}).done(function( response ) {	
            					if(response === "success"){
            						$("#learningpath_add").modal("hide");     
            						$("#add_submit").text("Add");
            						document.location.reload(true);
            					}
            				});
                		} else if($learningpath_certification_val === "no"){
                			$.ajax({
            					method: "GET",
            					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
            					data: {"edit_learningpath" : "edit_learningpath",
                                                       "edit_learningpath_name" : $learningpath_name_val,
            						"edit_learningpath_description" : $learningPath_description_arr,
            						"edit_learningpath_id" : learningpathId,
            						"edit_learning_duration" : $learningpath_duration_val,
            						"edit_learningpath_certification" : $learningpath_certification_val,           
                                                        "editlptypes" : $lptypes , 						
            						"edit_learningpath_order" : $learningpath_order_val,
						        "edit_coursesequencing" : $coursesequence
            					}
            				}).done(function( response ) {	
            					if(response === "success"){
            						$("#learningpath_add").modal("hide");
            						$("#add_submit").text("Add");
            						document.location.reload(true);
            					}
            				});
                		}
        			}        			            		            		           
            		
        		});
        	}
        	        	
        	$(document).on("click","#add_cancel",function() { 
        		$("span", "#learning_path_name").empty().remove();
				$("#learningpath_add").modal("hide");			
				$("#learningPath_name").val("");
				$("#learningPath_certification").val("");
				$("#learningPath_certificate_name").val("");
				$("#learningPath_order").val("");
				$("#learningPath_duration").val("");
				$("#learning_path_certificate_name").css("display","none");
                       $("#learningPath_name").prop("readonly", false);
			});
        	
        	$(document).on("click","#course_submit",function() {   
        		$course_mandatory = $("#learningPath_mandatory").val();
        		$code_challenge_val = Number($("#learningPath_codeChallenge").val().trim());
        		$stage_val = Number($("#learningPath_stages").val().trim());
        		$milestone_val = Number($("#learningPath_milestone").val().trim());
        			if($course_section_confirmation === "yes"){
        			$temp = Number($("#learningPath_course_section").val().trim());        			
        			$.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
    					data: {"add_course" : "add_course", 
    						"course_learningpath_id" : id, 
    						"course_id" : $learningpath_course_val, 
    						"course_section" : $temp,
    						"course_mandatory" : $course_mandatory,
    						"code_challenge" : $code_challenge_val,
    						"stage_id" : $stage_val,
    						"milestone_id" : $milestone_val
    						}        		
    				}).done(function( response ) {	
    					if(response === "success"){
    						$("#course_add").modal("hide");
    						document.location.reload(true);
    					}
    				}); 
        		} else {
        			$.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
    					data: {"add_course" : "add_course", 
    						"course_learningpath_id" : id, 
    						"course_id" : $learningpath_course_val,
    						"course_mandatory" : $course_mandatory,
    						"code_challenge" : $code_challenge_val,
    						"stage_id" : $stage_val,
    						"milestone_id" : $milestone_val
    						}
    				}).done(function( response ) {	
    					if(response === "success"){
    						$("#course_add").modal("hide");
    						document.location.reload(true);
    					}
    				}); 
        		}        		        		       	
        	});
        	
        	$(document).on("click","#course_cancel",function() {    				
				$("#course_add").modal("hide");				
			});
			
			
			//functions related to stage
			
			$(document).on("click","#stage_submit",function() {   
        		$stage_name = $("#Stage_Name").val().trim();
        		$stage_description = $("#Stage_Description").val();
		        $stage_sortorder = Number($("#stage_sortorder").val().trim());
		        //$stage_number =Number($("#stage_Number").val().trim());
                       $stage_number = $("#Stage_Number").val();
                       $stagecode = $("#Stage_code").val().trim();
             
							
				$sort_order=1;
				if($stage_sortorder > 9){
				alert("sort order should between 1-9");
				$sort_order=0;
					
				}
				
        		if(($stage_name)  && ($sort_order==1) && ($stagecode)){    			
        			$.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
    					data: {"add_stage" : "add_stage", 
    						"stage_learningpath_id" : id, 
    						"stagename" : $stage_name, 
    						"stage_description" : $stage_description,
                              "stage_number" : $stage_number,
    						"stage_sortorder" : $stage_sortorder,
    						"stagecode" : $stagecode
    						}        		
    				}).done(function( response ) {	
    					if(response === "success"){
                                                        $("#Stage_Number").val("");
							$("#Stage_Name").val("");
							$("#Stage_Description").val("");
							$("#stage_sortorder").val("");
							$("#Stage_code").val("");
							
    						$("#stage_add").modal("hide");
    						//document.location.reload(true);
    					}
    				}); 
        		}else{
				alert("Please fill all fields");
				}
        	});
			
			
			
			$(document).on("click","#stage_cancel",function() {
					$("#Stage_Name").val("");
					$("#Stage_Description").val("");
					$("#stage_sortorder").val("");				
					$("#stage_add").modal("hide");				
			});
        	
			// functions related to milestone_cancel
			
			$(document).on("click","#milestone_submit",function() { 
			
			$stagename= $( "#milestone_stage option:selected" ).val();
			$milestonename = $("#Milestone_Name").val();
                        $stagenumber = $("#Stage_type").val();
                         if($category_selection_val === "course")
                           {
                               $crseid = $("#crseid").val();
							   $category = "course";
                           }else if($category_selection_val === "category") 
                           {
                             $crseid =  $( "#cat_sec option:selected" ).val();
                               $category = "category";
                             }
                  
			$points = $("#points_id").val();
			$sortorder = $("#sort_id").val();
                        $duration = $("#time_id").val();
                        $milestonecode = $("#Milestone_code").val().trim();
                   
			
			if(($stagename) && ($milestonename) &&($stagenumber) &&($milestonecode)) {    			
        			$.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
    					data: {"add_milestone" : "add_milestone", 
    						"stagename" : $stagename, 
    						"milestonename" : $milestonename,
                                   "stagenumber" : $stagenumber,
								    "category" : $category,
        			                "Courseid" : $crseid,
        			                "points" : $points,
        			                "sortorder" : $sortorder,
                                                "lpid" : $learningpath_id,
                                                "duration" : $duration,
                                                "milestonecode" : $milestonecode 
    						}        		
    				}).done(function( response ) {	
    					if(response === "success"){
                                                        $("#time_id").val("");
                                                        $("#sort_id").val("");
							$("#points_id").val("");
							$("#crseid").val("");
							$("#stage_type").val("");
							$("#Milestone_Name").val("");
							$("#Milestone_code").val("");
                            $("#cat_sec").val("");
							$("#category_section").val("");
							$('option:selected', this).remove();
							$("#stage_add").modal("hide");
    						document.location.reload(true);
                                                
    					}
    				}); 
        		}else{
					alert("Please fill all fields");
				}
			
			
			});
			$(document).on("click","#milestone_cancel",function() {
					$("#Milestone_Name").val("");
					$('option:selected', this).remove();		
					$("#milestone_add").modal("hide");				
			});
			
        	var getMetaContent = function(html, name) {
          	  return html.filter(
          	  (index, tag) => tag && tag.name && tag.name == name).attr('content');
          	}
          	        	
        	$(document).on("click","#external_link_submit",function() {
        		
        		var name = '';
        		var description = '';
        		var image_url = '';
        		
/*        		$.ajax({
        			url: 'https://cors-anywhere.herokuapp.com/' + $("#learningPath_external_link").val()
        		}).then(function(data) {
            	    var html = $(data);            	    
            	    name = getMetaContent(html, 'title') || 'no keywords found';
            	    description = getMetaContent(html, 'description') || 'no description found';
            	    image_url = getMetaContent(html,'twitter:image') || 'no image found';            	                	    
        		});  */ 
        		
        		setTimeout(function() {
        			$.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
    					data: {"external_link" : "external_link", 
    						"external_link_learningpath_id" : id, 
    						"external_link_data" : $("#learningPath_external_link").val(),
    						"external_link_name" : $("#learningPath_external_link_name").val(),
    						"image_url" : image_url,
    						"description" : description
    					}
    				}).done(function( response ) {	
    					if(response === "success"){
    						$("#external_add").modal("hide");
    						document.location.reload(true);
    					}
    				});          	
        		},2000);
        		        		        		        				
			});
        	
        	$(document).on("click","#external_link_cancel",function() {    				
				$("#external_add").modal("hide");				
			});        	        	        	
        	        	
        	if( url.includes('/my/')){
        		$(document).on("click","#confirmationOk",function() {
            		$.ajax({
    					method: "GET",
    					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
    					data: {"delete_learningpath" : "delete_learningpath", "delete_learningpath_id" : learningpathId}
    				}).done(function( response ) {
    					if(response === "success"){
    						$("#confirmationModal").modal("hide");
    						document.location.reload(true);
    					}    					
    				}); 							
    			});
        	}        	
        	
        	$(document).on("click","#confirmationCancel",function() {    				
				$("#confirmationModal").modal("hide");				
			});
        	
        	if(url.includes('/blocks/learningpath/manage_learningpath.php')){
        		$(document).on("click","#confirmationOk",function() {
        			$.ajax({
        				method: "GET",
        				url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
        				data: {"delete_content" : "delete_content", "content_id" : contentId}
        			}).done(function( response ) {						
        				if(response === "success"){
        					$("#confirmationModal").modal("hide");
        					document.location.reload(true);
        				}
        			}); 							
        		});
        		
        		$( init );

                function init() {
                	$( ".droppable-area1, .droppable-area2" ).sortable({
                		connectWith: ".connected-sortable",
                		stack: '.connected-sortable ul',
                		update: function (event, ui) {
                			var idarray = new Array();
                            $('#draggableContent li').each(function(i)
                            {
                            	idarray.push($(this).attr('id'));
                            });
                            
                            $.ajax({
                				method: "GET",
                				url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
                				data: {"draggable_content" : idarray}
                			}).done(function( response ) {						
                				
                			}); 
                		}
                	}).disableSelection();
                }

        	}

			$("#milestonedata").click( function(){        			
        		var pathid=$(this).attr('data-value');
				$("#cleardata_confirmation").text("Are you sure you want to clear milestone data for learningpath id "+pathid+"?");
				$("#cleardataOk").attr("cleardata-value", "milestonedata");
				$("#cleardataOk").attr("lpid-value", pathid);
        		$("#cleardataModal").modal("show");
    		});

			$("#lvlpoint").click( function(){        			
        		var pathid=$(this).attr('data-value');
				$("#cleardata_confirmation").text("Are you sure you want to clear level point data for learningpath id "+pathid+"?");
				$("#cleardataOk").attr("cleardata-value", "levelpointdata");
				$("#cleardataOk").attr("lpid-value", pathid);
        		$("#cleardataModal").modal("show");
    		});

    		$(document).on("click","#cleardataOk",function() {
				var learningpathid = $(this).attr('lpid-value');
				var cleardatavalue = $(this).attr('cleardata-value');
				$.ajax({
					method: "GET",
					url: M.cfg.wwwroot + '/blocks/learningpath/ajax.php',
					data: {"cleardata_learningpath" : "cleardata_learningpath", "cleardata_learningpath_id" : learningpathid, "cleardata_resource" : cleardatavalue}
				}).done(function( response ) {
					if(response === "success"){
						$("#cleardata_confirmation").text("");  				
						$("#cleardataModal").modal("hide");
						document.location.reload(true);
					}    					
				}); 
			});       	
        	
        	$(document).on("click","#cleardataCancel",function() {  
				$("#cleardata_confirmation").text("");  				
				$("#cleardataModal").modal("hide");				
			});
			
			$( document ).ready(function() {
				function description_ellipsis(selector, maxLength) {
				    var element = document.querySelectorAll(selector);        
					var i;
					
					for (i = 0; i < element.length; i++) {
						var truncated = element[i].innerText;
						if (truncated.length > maxLength) {
						    truncated = truncated.substr(0,maxLength) + '...';
							element[i].innerText =  truncated;	
					    }
				  	}
				    
				}				
				description_ellipsis('.lp_desc_overflow', 100);
			});
			
			$('#lpsummarytable tbody').on('click', '.lp_desc_overflow', function () {     			
        		var description=$(this).attr('description');
				$("#descriptionModalContent").text('');
				$("#descriptionModalContent").html(description);
        		$("#descriptionModal").modal("show");
    		});

        }
    };
});





define('block_learningpath/self_enrol', ["jquery","core/ajax"],function(e,o){return{init:function(){e(document).ready(function(){$("#search").keyup(function(){var e=$(this).val().toLowerCase();$(".content").hide(),$(".content").each(function(){-1!=$(this).text().toLowerCase().indexOf(""+e)&&$(this).closest(".content").show()})})}),e("button").click(function(){var t=e(this).val(),n=this.id;e("#myModal").modal("show"),$("#proceed_self_enrol").click(function(){e("#myModal").modal("hide"),document.getElementById(n).disabled=!0,o.call([{methodname:"block_learningpath_self_enrol",args:{lpid:t}}])[0].done(function(e){1==e.success?(alert("You have successfully registered to the Learningpath."),location.reload()):(alert("Registration Failed"),location.reload())}).fail(function(e){console.log(e)})})})}}});
define('block_myoverview/selectors', [],function(){return{courseView:{region:'[data-region="courses-view"]',regionContent:'[data-region="course-view-content"]'}}});
define('block_myoverview/view_nav', ["jquery","core/custom_interaction_events","block_myoverview/repository","block_myoverview/view","block_myoverview/selectors"],function(a,b,c,d,e){var f={FILTERS:'[data-region="filter"]',FILTER_OPTION:"[data-filter]",DISPLAY_OPTION:"[data-display-option]"},g=function(a,b){var d=null;d="display"==a?"block_myoverview_user_view_preference":"sort"==a?"block_myoverview_user_sort_preference":"block_myoverview_user_grouping_preference",c.updateUserPreferences({preferences:[{type:d,value:b}]})},h=function(c){var h=c.find(f.FILTERS);b.define(h,[b.events.activate]),h.on(b.events.activate,f.FILTER_OPTION,function(b,f){var h=a(b.target);if(!h.hasClass("active")){var i=h.attr("data-filter"),j=h.attr("data-pref");c.find(e.courseView.region).attr("data-"+i,h.attr("data-value")),g(i,j),d.init(c),f.originalEvent.preventDefault()}}),b.define(h,[b.events.activate]),h.on(b.events.activate,f.DISPLAY_OPTION,function(b,f){var h=a(b.target);if(!h.hasClass("active")){var i=h.attr("data-display-option"),j=h.attr("data-pref");c.find(e.courseView.region).attr("data-display",h.attr("data-value")),g(i,j),d.reset(c),f.originalEvent.preventDefault()}})},i=function(b){b=a(b),h(b)};return{init:i}});
define('block_myoverview/repository', ["core/ajax","core/notification"],function(a,b){var c=function(b){var c={methodname:"core_course_get_enrolled_courses_by_timeline_classification",args:b},d=a.call([c])[0];return d},d=function(b){var c={methodname:"core_course_set_favourite_courses",args:b},d=a.call([c])[0];return d},e=function(c){var d={methodname:"core_user_update_user_preferences",args:c};a.call([d])[0].fail(b.exception)};return{getEnrolledCoursesByTimeline:c,setFavouriteCourses:d,updateUserPreferences:e}});
define('block_myoverview/view', ["jquery","block_myoverview/repository","core/paged_content_factory","core/pubsub","core/custom_interaction_events","core/notification","core/templates","core_course/events","block_myoverview/selectors","core/paged_content_events"],function(a,b,c,d,e,f,g,h,i,j){var k={COURSE_REGION:'[data-region="course-view-content"]',ACTION_HIDE_COURSE:'[data-action="hide-course"]',ACTION_SHOW_COURSE:'[data-action="show-course"]',ACTION_ADD_FAVOURITE:'[data-action="add-favourite"]',ACTION_REMOVE_FAVOURITE:'[data-action="remove-favourite"]',FAVOURITE_ICON:'[data-region="favourite-icon"]',ICON_IS_FAVOURITE:'[data-region="is-favourite"]',ICON_NOT_FAVOURITE:'[data-region="not-favourite"]',PAGED_CONTENT_CONTAINER:'[data-region="page-container"]'},l={COURSES_CARDS:"block_myoverview/view-cards",COURSES_LIST:"block_myoverview/view-list",COURSES_SUMMARY:"block_myoverview/view-summary",NOCOURSES:"block_myoverview/no-courses"},m=[12,24,48],n=[],o=0,p=0,q=0,r=null,s=function(a){var b=a.find(i.courseView.region);return{display:b.attr("data-display"),grouping:b.attr("data-grouping"),sort:b.attr("data-sort")}},t={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,persistentLimitKey:"block_myoverview_user_paging_preference"},u=function(a,c){return b.getEnrolledCoursesByTimeline({offset:o,limit:c,classification:a.grouping,sort:a.sort})},v=function(a,b){return a.find(k.FAVOURITE_ICON+'[data-course-id="'+b+'"]')},w=function(a,b){return a.find('[data-region="paged-content-page"][data-page="'+b+'"]')},x=function(a){return a.attr("data-course-id")},y=function(a,b){var c=v(a,b),d=c.find(k.ICON_IS_FAVOURITE);d.addClass("hidden"),d.attr("aria-hidden",!0);var e=c.find(k.ICON_NOT_FAVOURITE);e.removeClass("hidden"),e.attr("aria-hidden",!1)},z=function(a,b){var c=v(a,b),d=c.find(k.ICON_IS_FAVOURITE);d.removeClass("hidden"),d.attr("aria-hidden",!1);var e=c.find(k.ICON_NOT_FAVOURITE);e.addClass("hidden"),e.attr("aria-hidden",!0)},A=function(a,b){return a.find('[data-action="add-favourite"][data-course-id="'+b+'"]')},B=function(a,b){return a.find('[data-action="remove-favourite"][data-course-id="'+b+'"]')},C=function(a,b){var c=B(a,b),e=A(a,b);F(b,!0).then(function(g){g?(d.publish(h.favourited),c.removeClass("hidden"),e.addClass("hidden"),z(a,b)):f.alert("Starring course failed","Could not change favourite state")})["catch"](f.exception)},D=function(a,b){var c=B(a,b),e=A(a,b);F(b,!1).then(function(g){g?(d.publish(h.unfavorited),c.addClass("hidden"),e.removeClass("hidden"),y(a,b)):f.alert("Starring course failed","Could not change favourite state")})["catch"](f.exception)},E=function(b,d){var e=x(d),h=b.find('[data-region="paging-bar"]'),i=parseInt(h.attr("data-active-page-number")),j=n[i],k=j.courses.reduce(function(a,b){return e!=b.id&&a.push(b),a},[]);if(void 0!=n[i+1]){var l=n[i+1].courses.slice(0,1);n.forEach(function(b,c){if(c>i){var d=[];void 0!=n[c+1]&&(d=n[c+1].courses.slice(0,1)),n[c].courses=a.merge(n[c].courses.slice(1),d)}}),k=a.merge(k,l)}if(p==i+1&&0==n[i+1].courses.length){var m=b.find('[data-region="paged-content-container"]');c.resetLastPageNumber(a(m).attr("id"),i)}n[i].courses=k,o--;var q=w(b,i);G(b,n[i]).then(function(a,b){return g.replaceNodeContents(q,a,b)})["catch"](f.exception),n.forEach(function(a,c){if(c>i){var d=w(b,c);d.remove()}})},F=function(a,c){return b.setFavouriteCourses({courses:[{id:a,favourite:c}]}).then(function(b){return 0==b.warnings.length&&(n.forEach(function(b){b.courses.forEach(function(d,e){d.id==a&&(b.courses[e].isfavourite=c)})}),!0)})["catch"](f.exception)},G=function(a,b){var c=s(a),d="";if(d="cards"==c.display?l.COURSES_CARDS:"list"==c.display?l.COURSES_LIST:l.COURSES_SUMMARY,b.courses.length)return g.render(d,{courses:b.courses});var e=a.find(i.courseView.region).attr("data-nocoursesimg");return g.render(l.NOCOURSES,{nocoursesimg:e})},H=function(a){this.find(i.courseView.region).attr("data-paging",a)},I=function(a,b){var c=b+j.SET_ITEMS_PER_PAGE_LIMIT;d.subscribe(c,H.bind(a))},J=function(b){r="block_myoverview_"+b.attr("id")+"_"+Math.random();var d=m,e=parseInt(b.find(i.courseView.region).attr("data-paging"),10);e&&(d=m.map(function(a){var b=!1;return a==e&&(b=!0),{value:a,active:b}}));var h=s(b),j=a.extend({},t);j.eventNamespace=r;var k=c.createWithLimit(d,function(c,d){var e=[];return c.forEach(function(c){var g=c.pageNumber,i=c.limit;if(q!=i&&(n=[],o=0,p=0),p==g)return d.allItemsLoaded(p),void e.push(G(b,n[g]));q=i,void 0==n[g+1]&&void 0==n[g]&&(i*=2);var j=u(h,i).then(function(e){var f=e.courses,h=0,i=[];if(void 0!=n[g]){i=n[g].courses;var j=i.length;j<c.limit&&(h=c.limit-j,i=a.merge(n[g].courses,f.slice(0,h)))}else h=c.limit,i=f.slice(0,c.limit);n[g]={courses:i};var k=f.slice(h,f.length);return k.length&&(n[g+1]={courses:k}),n[g].courses.length<c.limit||!k.length?(p=g,d.allItemsLoaded(g)):void 0!=n[g+1]&&n[g+1].courses.length<c.limit&&(p=g+1),o=e.nextoffset,G(b,n[g])})["catch"](f.exception);e.push(j)}),e},j);k.then(function(a,c){return I(b,r),g.replaceNodeContents(b.find(i.courseView.region),a,c)})["catch"](f.exception)},K=function(c){e.define(c,[e.events.activate]),c.on(e.events.activate,k.ACTION_ADD_FAVOURITE,function(b,d){var e=a(b.target).closest(k.ACTION_ADD_FAVOURITE),f=x(e);C(c,f),d.originalEvent.preventDefault()}),c.on(e.events.activate,k.ACTION_REMOVE_FAVOURITE,function(b,d){var e=a(b.target).closest(k.ACTION_REMOVE_FAVOURITE),f=x(e);D(c,f),d.originalEvent.preventDefault()}),c.on(e.events.activate,k.FAVOURITE_ICON,function(a,b){b.originalEvent.preventDefault()}),c.on(e.events.activate,k.ACTION_HIDE_COURSE,function(d,e){var f=a(d.target).closest(k.ACTION_HIDE_COURSE),g=x(f),h={preferences:[{type:"block_myoverview_hidden_course_"+g,value:!0}]};b.updateUserPreferences(h),E(c,f),e.originalEvent.preventDefault()}),c.on(e.events.activate,k.ACTION_SHOW_COURSE,function(d,e){var f=a(d.target).closest(k.ACTION_SHOW_COURSE),g=x(f),h={preferences:[{type:"block_myoverview_hidden_course_"+g,value:null}]};b.updateUserPreferences(h),E(c,f),e.originalEvent.preventDefault()})},L=function(b){b=a(b),n=[],p=0,o=0,J(b),b.attr("data-init")||(K(b),b.attr("data-init",!0))},M=function(a){n.length>0?n.forEach(function(b,c){var d=w(a,c);G(a,b).then(function(a,b){return g.replaceNodeContents(d,a,b)})["catch"](f.exception)}):L(a)};return{init:L,reset:M}});
define('block_myoverview/main', ["jquery","block_myoverview/view","block_myoverview/view_nav"],function(a,b,c){var d=function(d){d=a(d),c.init(d),b.init(d)};return{init:d}});
define('block_navigation/ajax_response_renderer', ["jquery","core/templates","core/notification","core/url"],function(a,b,c,d){function e(g,h){var i=a("<ul></ul>");i.attr("role","group"),i.attr("aria-hidden",!0),a.each(h,function(g,h){if("object"==typeof h){var j=a("<li></li>"),k=a("<p></p>"),l=h.id||h.key+"_tree_item",m=null,n=!(!h.expandable&&!h.haschildren);k.addClass("tree_item"),k.attr("id",l),k.attr("role","treeitem"),k.attr("tabindex","-1"),h.requiresajaxloading&&(k.attr("data-requires-ajax",!0),k.attr("data-node-id",h.id),k.attr("data-node-key",h.key),k.attr("data-node-type",h.type)),n&&(j.addClass("collapsed contains_branch"),k.attr("aria-expanded",!1),k.addClass("branch"));var o=null;if(h.link){var p=a('<a title="'+h.title+'" href="'+h.link+'"></a>');o=p,p.append('<span class="item-content-wrap">'+h.name+"</span>"),h.hidden&&p.addClass("dimmed"),k.append(p)}else{var q=a("<span></span>");o=q,q.append('<span class="item-content-wrap">'+h.name+"</span>"),h.hidden&&q.addClass("dimmed"),k.append(q)}!h.icon||n&&h.type!==f.ACTIVITY&&h.type!==f.RESOURCE||(j.addClass("item_with_icon"),k.addClass("hasicon"),h.type===f.ACTIVITY||h.type===f.RESOURCE?(m=a("<img/>"),m.attr("alt",h.icon.alt),m.attr("title",h.icon.title),m.attr("src",d.imageUrl(h.icon.pix,h.icon.component)),a.each(h.icon.classes,function(a,b){m.addClass(b)}),o.prepend(m)):("moodle"==h.icon.component&&(h.icon.component="core"),b.renderPix(h.icon.pix,h.icon.component,h.icon.title).then(function(a){o.prepend(a)})["catch"](c.exception))),j.append(k),i.append(j),h.children&&h.children.length?e(k,h.children):n&&!h.requiresajaxloading&&(j.removeClass("contains_branch"),k.addClass("emptybranch"))}}),g.parent().append(i);var j=g.attr("id")+"_group";i.attr("id",j),g.attr("aria-owns",j),g.attr("role","treeitem")}var f={ACTIVITY:40,RESOURCE:50};return{render:function(a,b){if(b.children&&b.children.length){e(a,b.children);var c=a.children("[role='treeitem']").first(),d=a.find("#"+c.attr("aria-owns"));c.attr("aria-expanded",!0),d.attr("aria-hidden",!1)}else a.parent().hasClass("contains_branch")&&(a.parent().removeClass("contains_branch"),a.addClass("emptybranch"))}}});
define('block_navigation/navblock', ["jquery","core/tree"],function(a,b){return{init:function(a){var c=new b(".block_navigation .block_tree");c.finishExpandingGroup=function(c){b.prototype.finishExpandingGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})},c.collapseGroup=function(c){b.prototype.collapseGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})}}}});
define('block_navigation/nav_loader', ["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],function(a,b,c,d){function e(a){return a.closest("[data-block]").attr("data-instanceid")}var f=c.wwwroot+"/lib/ajax/getnavbranch.php";return{load:function(b){b=a(b);var g=a.Deferred(),h={elementid:b.attr("data-node-id"),id:b.attr("data-node-key"),type:b.attr("data-node-type"),sesskey:c.sesskey,instance:e(b)},i={type:"POST",dataType:"json",data:h};return a.ajax(f,i).done(function(a){d.render(b,a),g.resolve()}),g}}});
define('block_navigation/site_admin_loader', ["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],function(a,b,c,d){var e=71,f=c.wwwroot+"/lib/ajax/getsiteadminbranch.php";return{load:function(b){b=a(b);var g=a.Deferred(),h={type:e,sesskey:c.sesskey},i={type:"POST",dataType:"json",data:h};return a.ajax(f,i).done(function(a){d.render(b,a),g.resolve()}),g}}});
define('block_online_users/change_user_visibility', ["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){var e={CHANGE_VISIBILITY_LINK:"#change-user-visibility",CHANGE_VISIBILITY_ICON:"#change-user-visibility .icon"},f=function(a,c){var e="show"==a?1:0,f=[{name:"block_online_users_uservisibility",value:e,userid:c}],j={methodname:"core_user_set_user_preferences",args:{preferences:f}};b.call([j])[0].then(function(b){if(b.saved){var c=g(a);h(c),i(c)}})["catch"](d.exception)},g=function(a){return"show"==a?"hide":"show"},h=function(b){k(b).then(function(c){a(e.CHANGE_VISIBILITY_LINK).attr({"data-action":b,title:c})})["catch"](d.exception)},i=function(b){var c=a(e.CHANGE_VISIBILITY_ICON);k(b).then(function(d){a(c).attr({title:d,"aria-label":d}),c.is("img")?a(c).attr({src:M.util.image_url("t/"+b),alt:d}):(a(c).addClass(j(b)),a(c).removeClass(j(g(b))))})["catch"](d.exception)},j=function(a){return"show"==a?"fa-eye-slash":"fa-eye"},k=function(a){return c.get_string("online_status:"+a,"block_online_users")};return{init:function(){a(e.CHANGE_VISIBILITY_LINK).on("click",function(b){b.preventDefault();var c=a(this).attr("data-action"),d=a(this).attr("data-userid");f(c,d)})}}});
define('block_profile_page/displayprofilemodal', ['jquery'], function($) {

	return {
		profile: function(userdata) {
			
			CONFIG = userdata;
			var userid=CONFIG.userid;
			var pagecount = 0;
			
			
			$('document').ready(function(){
				
				$('#nextBtn').css('display','inline');

				var url = window.location.href;
	        	var rootPath = M.cfg.wwwroot;

	        	var title="Hello";
					
					var editContributionsIndex = null;
					//var contributionid = null;
	                var editaccomplishmentIndex = null;
	                var editinternshipIndex = null;
	                var editcertificationIndex = null;
	                var edittrainingndex = null;
					
					var programmings = [];
                    var frameworks = [];
				    var databases = [];
					var operatingsystems = [];
					var tools = [];
					var certificationsarray = [];
					var trainings = [];
					

					
					modalcreated = true;
					var currentTab = 0; // Current tab is set to be the first tab (0)
	        	    showTab(currentTab); // Display the current tab
					
					
					// Ajax to get skill sets from database
					
					 setTimeout(function(){

						$.post( rootPath+"/blocks/profile_page/get_userdetails_ajax.php", { action: 'programminglanguages', column:'programminglanguages'})
							.done(function( result ) {						 
									$.each(result, function (i,v)  {
									programmings.push(v.name);
									});
							});
						 
						  $.post( rootPath+"/blocks/profile_page/get_userdetails_ajax.php", { action: 'frameworks', column:'frameworks'})
							.done(function( result ) {
									$.each(result, function (i,v)  {
									frameworks.push(v.name);									
									});
							});
							
							 $.post( rootPath+"/blocks/profile_page/get_userdetails_ajax.php", { action: 'databases', column:'databases'})
							.done(function( result ) {
									$.each(result, function (i,v)  {
									databases.push(v.name);									
									});
							});
							
							 $.post( rootPath+"/blocks/profile_page/get_userdetails_ajax.php", { action: 'operatingsystems', column:'operatingsystems'})
							.done(function( result ) {
									$.each(result, function (i,v)  {
								operatingsystems.push(v.name);									
									});
							});
							
							 $.post( rootPath+"/blocks/profile_page/get_userdetails_ajax.php", { action: 'tools', column:'tools'})
							.done(function( result ) {
									$.each(result, function (i,v)  {
									tools.push(v.name);									
									});
							}); 
							
							$.post( rootPath+"/blocks/profile_page/get_userdetails_ajax.php", { action: 'certifications', column:'certifications'})
							.done(function( result ) {
									$.each( result, function( i, v ) {
									certificationsarray.push(v.name);	
									});
								});

							$.post( rootPath+"/blocks/profile_page/get_userdetails_ajax.php", { action: 'trainings', column:'trainings'})
							.done(function( result ) {
									$.each( result, function( i, v ) {
									trainings.push(v.name);
									});
								});
						 
						 }, 3000);
					
					
					/*
					 *  Technical Skill Set related javascripts  starts here
					 *
					 */
					
					/*
					 *  function to search languages,frameworks,databases,operating system,tools in search box drodown in programming languages section.
					 */
					
					//function to search languages
					
					$( "#searchName-programming" ).keyup(function(e) {
						
						var code = e.keyCode || e.which;
						var x = document.getElementById("searchName-programming").value;
                        $("#myDropdown-lang tr").remove();
						
						if(!programmings || !x){							
							$("#myDropdown-lang tr").remove();	
						}else{
								$("#myDropdown-lang tr").remove();
								$.each( programmings, function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										var tablerow='<tr ><td id="serchresult-programming" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td><td></td></tr>';									
										$('.dropdown-content-lang').append(tablerow);	
									}								
								});	
						}
					});
				
				//function to search frameworks
					$( "#searchName-framework" ).keyup(function(e) {
						
						var code = e.keyCode || e.which;
						var x = document.getElementById("searchName-framework").value;
                        $("#myDropdown-frame tr").remove();
						
						if(!frameworks  || !x){							
							$("#myDropdown-frame tr").remove();	
						}else{
							var i=0;
								$("#myDropdown-frame tr").remove();
								$.each( frameworks , function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										
										var tablerow='<tr ><td id="serchresult-framework" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td><td></td></tr>';
			                            $('.dropdown-content-frame').append(tablerow);											
									}								
								});	
						}
					});
				
					//function to search databases
					$("#searchName-db").keyup(function(e){
						
						var code = e.keyCode || e.which;
	                    var x = document.getElementById("searchName-db").value;
						$("#myDropdown-db tr").remove();

						if(!databases   || !x){							
							$("#myDropdown-db tr").remove();	
						}else{
							var i=0;
								$("#myDropdown-db tr").remove();
								$.each( databases  , function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										
										var tablerow='<tr ><td id="serchresult-db" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td><td></td></tr>';
			                            $('.dropdown-content-db').append(tablerow);											
									}								
								});	
						}
					});
					
					//function to search operating systems
					$("#searchName-os").keyup(function(e){
						
						var code = e.keyCode || e.which;
						var x = document.getElementById("searchName-os").value;	
						$("#myDropdown-os tr").remove();
						
						if(!operatingsystems    || !x){							
							$("#myDropdown-os tr").remove();	
						}else{
							var i=0;
								$("#myDropdown-os tr").remove();
								$.each( operatingsystems   , function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										
										var tablerow='<tr ><td id="serchresult-os" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td><td></td></tr>';
			                            $('.dropdown-content-os').append(tablerow);											
									}								
								});	
						}
					});
					
					//function to search tools
					$("#searchName-tool").keyup(function(e){
						
						var code = e.keyCode || e.which;
						var x = document.getElementById("searchName-tool").value;	
						$("#myDropdown-tool tr").remove();
						
						if(!tools || !x){							
							$("#myDropdown-tool tr").remove();	
						}else{
							var i=0;
								$("#myDropdown-tool tr").remove();
								$.each( tools, function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										
										var tablerow='<tr ><td id="serchresult-tools" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td><td></td></tr>';
			                            $('.dropdown-content-tool').append(tablerow);											
									}								
								});	
						}				
					});
					
					/*
					 * function to append rating in programming languages,framework,database,operating system,tools section.
					 */
					
					//function to append rating in language
					
					var programarray=[];
					var otherprogramingarray=[];
					$(document).on("click","#serchresult-programming",function(event){
						var text = $(event.target).text();
						var textclass= text.replace(/\s/g,''); 
						$("#myDropdown-lang tr").remove();

						document.getElementById("lang1").style.display = "contents";
	
						var rowCount = $('#ratingtable-programming tr').length;
						if(rowCount <= 3){
							
						$('#ratingtable-programming tr').each(function() {
					        var addedlanguage = $(this).find("td:first").html();
							if(addedlanguage != undefined){
								addedlanguage = addedlanguage.toLowerCase();
								addedlanguage= addedlanguage.replace(/\s/g,'');
							programarray.push(addedlanguage);
							}							
                          });
							
						var tablerow='<tr data-start-selector="lang'+textclass+'">'+
						              '<td>'+text+'</td>'+
									  '<td><div class="rating" id="lang-theory'+textclass+'" data-start-selector="lang-theory'+textclass+'">'+
									  '<span class="fa fa-star langtheory one" data-start-selector="langtheory'+textclass+'1" value="1" Title="Novice"></span>'+
									  '<span class="fa fa-star langtheory two" data-start-selector="langtheory'+textclass+'2" value="2" Title="Notable"></span>'+
			                          '<span class="fa fa-star langtheory three" data-start-selector="langtheory'+textclass+'3" value="3" Title="Average"></span>'+
									  '<span class="fa fa-star langtheory four" data-start-selector="langtheory'+textclass+'4" value="4" Title="Good"></span>'+
			                          '<span class="fa fa-star langtheory five" data-start-selector="langtheory'+textclass+'5" value="5" Title="Expert"></span></div></td>'+
												
			                          '<td><div class="rating" id="lang-practice'+textclass+'" data-start-selector="lang-practice'+textclass+'">'+
									  '<span class="fa fa-star langpractice one" data-start-selector="langpractice'+textclass+'1" value="1" Title="Novice"></span>'+
			                          '<span class="fa fa-star langpractice two" data-start-selector="langpractice'+textclass+'2" value="2" Title="Notable"></span>'+
									  '<span class="fa fa-star langpractice three" data-start-selector="langpractice'+textclass+'3" value="3" Title="Average"></span>'+
			                          '<span class="fa fa-star langpractice four" data-start-selector="langpractice'+textclass+'4"  value="4" Title="Good"></span>'+
									  '<span class="fa fa-star langpractice five" data-start-selector="langpractice'+textclass+'5"  value="5" Title="Expert"></span>'+								'</div></td><td><span class="fa fa-trash skillset" id="lang'+textclass+'" data-start-selector="lang'+textclass+'"></span></td></tr>';
			
							//check whether lang already exists
							var addedlanguage =text.toLowerCase();
							addedlanguage= addedlanguage.replace(/\s/g,'');
							var result = programarray.includes(addedlanguage);
						
							if(result){
								$("#myinfolang-repeat").css("display", "flow-root");
								$("#searchName-programming").val('');
								setTimeout(function(){
								 $("#myinfolang-repeat").css("display", "none");
								}, 4000);
							}else{
								$("#ratingtable-programming").append(tablerow);
								$("#myDropdown-lang tr").remove();
								$("#searchName-programming").val('');
							}
							programarray = [];
	
						}else{
				
							$("#myinfo-lang").css("display", "flow-root");
							$("#searchName-programming").val('');
							setTimeout(function(){
								 $("#myinfo-lang").css("display", "none");
								
								}, 4000);
						}
						
					});
					

					
					
					//function to append rating in framework
					var frameworkarray=[];
					var otherframeworkarray=[];
					$(document).on("click","#serchresult-framework",function(event){
						var text = $(event.target).text();
						var textclass= text.replace(/\s/g,''); 
						document.getElementById("frame1").style.display = "contents";
						
						$("#myDropdown-frame tr").remove();
						
						var rowCount = $('#ratingtable-framework tr').length;
						if(rowCount <= 3){
							
							$('#ratingtable-framework tr').each(function() {
								var addedframework = $(this).find("td:first").html();
								if(addedframework != undefined){
									addedframework = addedframework.toLowerCase();
									addedframework= addedframework.replace(/\s/g,'');
								frameworkarray.push(addedframework);
								}							
							});
						
						var tablerow='<tr data-start-selector="frame'+textclass+'">'+
									   '<td>'+text+'</td>'+
									   '<td><div class="rating" data-start-selector="frame-theory'+textclass+'">'+
									   '<span class="fa fa-star frametheory one" data-start-selector="frametheory'+textclass+'1" value="1" Title="Novice"></span>'+
									   '<span class="fa fa-star frametheory two" data-start-selector="frametheory'+textclass+'2" value="2" Title="Notable"></span>'+
									   '<span class="fa fa-star frametheory three" data-start-selector="frametheory'+textclass+'3" value="3" Title="Average"></span>'+
									   '<span class="fa fa-star frametheory four" data-start-selector="frametheory'+textclass+'4" value="4" Title="Good"></span>'+
									   '<span class="fa fa-star frametheory five" data-start-selector="frametheory'+textclass+'5" value="5" Title="Expert"></span>'+
									   '</div></td>'+
												
									   '<td><div class="rating" data-start-selector="frame-practice'+textclass+'">'+
									   '<span class="fa fa-star framepractice one" data-start-selector="framepractice'+textclass+'1" value="1" Title="Novice"></span>'+
									   '<span class="fa fa-star framepractice two" data-start-selector="framepractice'+textclass+'2" value="2" Title="Notable"></span>'+
									   '<span class="fa fa-star framepractice three" data-start-selector="framepractice'+textclass+'3" value="3" Title="Average"></span>'+
									   '<span class="fa fa-star framepractice four" data-start-selector="framepractice'+textclass+'4" value="4" Title="Good"></span>'+
									   '<span class="fa fa-star framepractice five" data-start-selector="framepractice'+textclass+'5" value="5" Title="Expert"></span>'+			'</div></td><td><span class="fa fa-trash skillset" id="frame'+textclass+'" data-start-selector="frame'+textclass+'"></span></td></tr>';
									
									
									
									var addedframework =text.toLowerCase();
									addedframework= addedframework.replace(/\s/g,'');
									var result = frameworkarray.includes(addedframework);
									
									if(result){
											$("#myinfoframe-repeat").css("display", "flow-root");
											$("#searchName-framework").val('');
										setTimeout(function(){
											$("#myinfoframe-repeat").css("display", "none");
										}, 4000);
									}else{
										$("#ratingtable-framework").append(tablerow);
										$("#myDropdown-frame tr").remove();
										$("#searchName-framework").val('');	
									}
									
						frameworkarray = [];
						
						}else{
							
							$("#myinfo-frame").css("display", "flow-root");
							$("#searchName-framework").val('');
							setTimeout(function(){
								 $("#myinfo-frame").css("display", "none");
								
								}, 4000);
							
						}
						
					});
					
					//function to append rating in database
					var databasearray=[];
					var otherdatabasearray=[];
					$(document).on("click","#serchresult-db",function(event){
						var text = $(event.target).text();
						var textclass= text.replace(/\s/g,''); 
						document.getElementById("db1").style.display = "contents";
						$("#myDropdown-db tr").remove();
						
						var rowCount = $('#ratingtable-db tr').length;
						if(rowCount <= 3){
							
							$('#ratingtable-db tr').each(function() {
								var addeddb = $(this).find("td:first").html();
								if(addeddb != undefined){
									addeddb = addeddb.toLowerCase();
									addeddb= addeddb.replace(/\s/g,'');
								databasearray.push(addeddb);
								}							
							});
						
						var tablerow='<tr  data-start-selector="db'+textclass+'">'+
										  '<td>'+text+'</td>'+
										  '<td><div class="rating" id="db-theory'+textclass+'" data-start-selector="db-theory'+textclass+'">'+
										  '<span class="fa fa-star dbtheory one" data-start-selector="dbtheory'+textclass+'1" value="1" Title="Novice"></span>'+
										  '<span class="fa fa-star dbtheory two"  data-start-selector="dbtheory'+textclass+'2" value="2" Title="Notable"></span>'+
									      '<span class="fa fa-star dbtheory three" data-start-selector="dbtheory'+textclass+'3" value="3" Title="Average"></span>'+
										  '<span class="fa fa-star dbtheory four" data-start-selector="dbtheory'+textclass+'4" value="4" Title="Good"></span>'+
										  '<span class="fa fa-star dbtheory five" data-start-selector="dbtheory'+textclass+'5" value="5" Title="Expert"></span>'+
										  '</div></td>'+
												
										  '<td><div class="rating" id="db-practice'+textclass+'" data-start-selector="db-practice'+textclass+'">'+
										  '<span class="fa fa-star dbpractice one" data-start-selector="dbpractice'+textclass+'1" value="1" Title="Novice"></span>'+
										  '<span class="fa fa-star dbpractice two" data-start-selector="dbpractice'+textclass+'2" value="2" Title="Notable"></span>'+
										  '<span class="fa fa-star dbpractice three" data-start-selector="dbpractice'+textclass+'3" value="3" Title="Average"></span>'+
										  '<span class="fa fa-star dbpractice four" data-start-selector="dbpractice'+textclass+'4" value="4" Title="Good"></span>'+
										  '<span class="fa fa-star dbpractice five" data-start-selector="dbpractice'+textclass+'5" value="5" Title="Expert"></span>'+				'</div></td><td><span class="fa fa-trash skillset" id="db'+textclass+'" data-start-selector="db'+textclass+'"></span></td></tr>';
												
										var addeddb=text.toLowerCase();
										    addeddb= addeddb.replace(/\s/g,'');
										var result = databasearray.includes(addeddb);
						
										if(result){
											$("#myinfodb-repeat").css("display", "flow-root");
											$("#searchName-db").val('');	
											setTimeout(function(){
												$("#myinfodb-repeat").css("display", "none");
											}, 4000);
										}else{
											$("#ratingtable-db").append(tablerow);
											$("#myDropdown-db tr").remove();
											$("#searchName-db").val('');	
										}
						databasearray = [];
						}else{
							
							$("#myinfo-db").css("display", "flow-root");
							$("#searchName-db").val('');
							setTimeout(function(){
								 $("#myinfo-db").css("display", "none");
								
								}, 4000);
							
						}
						
					});
					
					//function to append rating in operatingsystems
					var operatingsystemarray=[];
					var otheroperatingsystemarray=[];
					$(document).on("click","#serchresult-os",function(event){
						var text = $(event.target).text();
						var textclass= text.replace(/\s/g,''); 
						document.getElementById("os1").style.display = "contents";
						$("#myDropdown-os tr").remove();
						var rowCount = $('#ratingtable-os tr').length;
						if(rowCount <= 3){
							
							$('#ratingtable-os tr').each(function() {
								var addedos = $(this).find("td:first").html();
								if(addedos != undefined){
									addedos = addedos.toLowerCase();
									addedos= addedos.replace(/\s/g,'');
								operatingsystemarray.push(addedos);
								}							
							});
						           var tablerow='<tr data-start-selector="os'+textclass+'">'+
												'<td>'+text+'</td>'+
												'<td><div class="rating" id="os-theory'+textclass+'" data-start-selector="os-theory'+textclass+'">'+
												'<span class="fa fa-star ostheory one" data-start-selector="ostheory'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star ostheory two"  data-start-selector="ostheory'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star ostheory three" data-start-selector="ostheory'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star ostheory four" data-start-selector="ostheory'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star ostheory five" data-start-selector="ostheory'+textclass+'5" value="5" Title="Expert"></span>'+
												'</div></td>'+
												
												'<td><div class="rating" id="os-practice'+textclass+'" data-start-selector="os-practice'+textclass+'">'+
												'<span class="fa fa-star ospractice one" data-start-selector="ospractice'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star ospractice two" data-start-selector="ospractice'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star ospractice three" data-start-selector="ospractice'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star ospractice four" data-start-selector="ospractice'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star ospractice five" data-start-selector="ospractice'+textclass+'5" value="5" Title="Expert"></span>'+			'</div></td><td><span class="fa fa-trash skillset" id="os'+textclass+'" data-start-selector="os'+textclass+'"></span></td></tr>';
									
									var addedos=text.toLowerCase();
									addedos= addedos.replace(/\s/g,'');
									var result = operatingsystemarray.includes(addedos);
						
										if(result){
											$("#myinfoos-repeat").css("display", "flow-root");
											$("#searchName-os").val('');
											setTimeout(function(){
												$("#myinfoos-repeat").css("display", "none");
											}, 4000);
										}else{
											 $("#ratingtable-os").append(tablerow);
											 $("#myDropdown-os tr").remove();
											 $("#searchName-os").val('');
										}
										
										operatingsystemarray = [];
						}else{
							
							$("#myinfo-os").css("display", "flow-root");
							$("#searchName-os").val('');
							setTimeout(function(){
								 $("#myinfo-os").css("display", "none");
								
								}, 4000);
							
						}

						
					});
					
					//function to append rating in tools
					var toolsarray=[];
					var othertoolsarray=[];
					$(document).on("click","#serchresult-tools",function(event){
						var text = $(event.target).text();
						var textclass= text.replace(/\s/g,''); 
						document.getElementById("tool1").style.display = "contents";
						$("#myDropdown-tool tr").remove();
						var rowCount = $('#ratingtable-tool tr').length;
						if(rowCount <= 3){
							
							$('#ratingtable-tool tr').each(function() {
								var addedtools = $(this).find("td:first").html();
								if(addedtools != undefined){
									addedtools = addedtools.toLowerCase();
									addedtools= addedtools.replace(/\s/g,'');
								toolsarray.push(addedtools);
								}							
							});
							
						var tablerow='<tr data-start-selector="tools'+textclass+'">'+
											    '<td>'+text+'</td>'+
											    '<td><div class="rating" id="tools-theory'+textclass+'" data-start-selector="tools-theory'+textclass+'">'+
												'<span class="fa fa-star toolstheory one" data-start-selector="toolstheory'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star toolstheory two"  data-start-selector="toolstheory'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star toolstheory three" data-start-selector="toolstheory'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star toolstheory four" data-start-selector="toolstheory'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star toolstheory five" data-start-selector="toolstheory'+textclass+'5" value="5" Title="Expert"></span>'+
												'</div></td>'+
												
												'<td><div class="rating" id="tools-practice'+textclass+'" data-start-selector="tools-practice'+textclass+'">'+
												'<span class="fa fa-star toolspractice one" data-start-selector="toolspractice'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star toolspractice two" data-start-selector="toolspractice'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star toolspractice three" data-start-selector="toolspractice'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star toolspractice four" data-start-selector="toolspractice'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star toolspractice five" data-start-selector="toolspractice'+textclass+'5" value="5" Title="Expert"></span>'+
												'</div></td><td>'+
												'<span class="fa fa-trash skillset" id="tools'+textclass+'" data-start-selector="tools'+textclass+'"></span></td></tr>';
												
										var addedtools=text.toLowerCase();
										    addedtools= addedtools.replace(/\s/g,'');
										var result = toolsarray.includes(addedtools);
						
										if(result){
											$("#myinfotools-repeat").css("display", "flow-root");
											 $("#searchName-tool").val('');	
											setTimeout(function(){
												$("#myinfotools-repeat").css("display", "none");
											}, 4000);
										}else{
											 $("#ratingtable-tool").append(tablerow);
											 $("#myDropdown-tool tr").remove();
											 $("#searchName-tool").val('');	
										}
										
										toolsarray = [];
						}else{
							
							$("#myinfo-tool").css("display", "flow-root");
							$("#searchName-tool").val('');
							setTimeout(function(){
								 $("#myinfo-tool").css("display", "none");
								
								}, 4000);	
						}
					});
					
					//add other languages 
					
										
				$(document).on("click","#other-lang-add",function(event){
							
							var  text = document.getElementById("other-lang").value;	
			
							var textclass= text.replace(/\s/g,''); 
							
							var rowCount = $('#ratingtable-programming tr').length;
						if(rowCount <= 3){
							if(text){
							
							document.getElementById("lang1").style.display = "contents";
							
							$('#ratingtable-programming tr').each(function() {
								var addedlanguage = $(this).find("td:first").html();
									if(addedlanguage != undefined){
										addedlanguage = addedlanguage.toLowerCase();
										addedlanguage= addedlanguage.replace(/\s/g,'');
										otherprogramingarray.push(addedlanguage);
									}							
							});
					
										
						var tablerow='<tr data-start-selector="lang'+textclass+'">'+
						              '<td>'+text+'</td>'+
									  '<td><div class="rating" id="lang-theory'+textclass+'" data-start-selector="lang-theory'+textclass+'">'+
									  '<span class="fa fa-star langtheory one" data-start-selector="langtheory'+textclass+'1" value="1" Title="Novice"></span>'+
									  '<span class="fa fa-star langtheory two" data-start-selector="langtheory'+textclass+'2" value="2" Title="Notable"></span>'+
			                          '<span class="fa fa-star langtheory three" data-start-selector="langtheory'+textclass+'3" value="3" Title="Average"></span>'+
									  '<span class="fa fa-star langtheory four" data-start-selector="langtheory'+textclass+'4" value="4" Title="Good"></span>'+
			                          '<span class="fa fa-star langtheory five" data-start-selector="langtheory'+textclass+'5" value="5" Title="Expert"></span></div></td>'+
												
			                          '<td><div class="rating" id="lang-practice'+textclass+'" data-start-selector="lang-practice'+textclass+'">'+
									  '<span class="fa fa-star langpractice one" data-start-selector="langpractice'+textclass+'1" value="1" Title="Novice"></span>'+
			                          '<span class="fa fa-star langpractice two" data-start-selector="langpractice'+textclass+'2" value="2" Title="Notable"></span>'+
									  '<span class="fa fa-star langpractice three" data-start-selector="langpractice'+textclass+'3" value="3" Title="Average"></span>'+
			                          '<span class="fa fa-star langpractice four" data-start-selector="langpractice'+textclass+'4"  value="4" Title="Good"></span>'+
									  '<span class="fa fa-star langpractice five" data-start-selector="langpractice'+textclass+'5"  value="5" Title="Expert"></span>'+				'</div></td><td><span class="fa fa-trash skillset" id="lang'+textclass+'" data-start-selector="lang'+textclass+'"></span></td></tr>';
							

									var addedlanguage =text.toLowerCase();
									    addedlanguage= addedlanguage.replace(/\s/g,'');
									var result = otherprogramingarray.includes(addedlanguage);
										if(result){
											$("#myinfolang-repeat").css("display", "flow-root");
											$("#other-lang").val('');
											
											setTimeout(function(){
												$("#myinfolang-repeat").css("display", "none");
											}, 4000);
										}else{
											 
											$("#ratingtable-programming").append(tablerow);
											$("#other-lang").val('');
										}
										otherprogramingarray = [];
							}
						}else{
							 $("#myinfo-lang").css("display", "flow-root");
							$("#other-lang").val('');
							setTimeout(function(){
								 $("#myinfo-lang").css("display", "none");
								
								}, 4000);
						}
								
						});
						
				//add other frameworks 
				
				$(document).on("click","#other-frame-add",function(event){
							
							var  text = document.getElementById("other-frame").value;	
			
							var textclass= text.replace(/\s/g,''); 
							var rowCount = $('#ratingtable-framework tr').length;
						if(rowCount <= 3){
							if(text){
							document.getElementById("frame1").style.display = "contents";
							
							$('#ratingtable-framework tr').each(function() {
								var addedframework = $(this).find("td:first").html();
								if(addedframework != undefined){
									addedframework = addedframework.toLowerCase();
									addedframework= addedframework.replace(/\s/g,'');
								otherframeworkarray.push(addedframework);
								}							
							});
												
							var tablerow='<tr data-start-selector="frame'+textclass+'">'+
									   '<td>'+text+'</td>'+
									   '<td><div class="rating" data-start-selector="frame-theory'+textclass+'">'+
									   '<span class="fa fa-star frametheory one" data-start-selector="frametheory'+textclass+'1" value="1" Title="Novice"></span>'+
									   '<span class="fa fa-star frametheory two" data-start-selector="frametheory'+textclass+'2" value="2" Title="Notable"></span>'+
									   '<span class="fa fa-star frametheory three" data-start-selector="frametheory'+textclass+'3" value="3" Title="Average"></span>'+
									   '<span class="fa fa-star frametheory four" data-start-selector="frametheory'+textclass+'4" value="4" Title="Good"></span>'+
									   '<span class="fa fa-star frametheory five" data-start-selector="frametheory'+textclass+'5" value="5" Title="Expert"></span>'+
									   '</div></td>'+
												
									   '<td><div class="rating" data-start-selector="frame-practice'+textclass+'">'+
									   '<span class="fa fa-star framepractice one" data-start-selector="framepractice'+textclass+'1" value="1" Title="Novice"></span>'+
									   '<span class="fa fa-star framepractice two" data-start-selector="framepractice'+textclass+'2" value="2" Title="Notable"></span>'+
									   '<span class="fa fa-star framepractice three" data-start-selector="framepractice'+textclass+'3" value="3" Title="Average"></span>'+
									   '<span class="fa fa-star framepractice four" data-start-selector="framepractice'+textclass+'4" value="4" Title="Good"></span>'+
									   '<span class="fa fa-star framepractice five" data-start-selector="framepractice'+textclass+'5" value="5" Title="Expert"></span>'+			'</div></td><td><span class="fa fa-trash skillset" id="frame'+textclass+'" data-start-selector="frame'+textclass+'"></span></td></tr>';

										var addedframework =text.toLowerCase();
										    addedframework= addedframework.replace(/\s/g,'');
										var result = otherframeworkarray.includes(addedframework);
						
										if(result){
											$("#myinfoframe-repeat").css("display", "flow-root");
											 $("#other-frame").val('');
											setTimeout(function(){
												$("#myinfoframe-repeat").css("display", "none");
											}, 4000);
										}else{
											 
											$("#ratingtable-framework").append(tablerow);
											$("#other-frame").val('');
										}           
					
								otherframeworkarray = [];	
						
							}
							
						}else{
							 $("#myinfo-frame").css("display", "flow-root");
							$("#other-frame").val('');
							setTimeout(function(){
								 $("#myinfo-frame").css("display", "none");
								
								}, 4000);
						}
							
							
						});
				
				//add other databases 
				$(document).on("click","#other-db-add",function(event){
							
							var  text = document.getElementById("other-db").value;	
			
							var textclass= text.replace(/\s/g,''); 
							
							var rowCount = $('#ratingtable-db tr').length;
						if(rowCount <= 3){
							if(text){
								
								$('#ratingtable-db tr').each(function() {
								var addeddb = $(this).find("td:first").html();
								if(addeddb != undefined){
									addeddb = addeddb.toLowerCase();
									addeddb= addeddb.replace(/\s/g,'');
								otherdatabasearray.push(addeddb);
								}							
							  });
								
							document.getElementById("db1").style.display = "contents";
												
												
								var tablerow='<tr  data-start-selector="db'+textclass+'">'+
										  '<td>'+text+'</td>'+
										  '<td><div class="rating" id="db-theory'+textclass+'" data-start-selector="db-theory'+textclass+'">'+
										  '<span class="fa fa-star dbtheory one" data-start-selector="dbtheory'+textclass+'1" value="1" Title="Novice"></span>'+
										  '<span class="fa fa-star dbtheory two"  data-start-selector="dbtheory'+textclass+'2" value="2" Title="Notable"></span>'+
									      '<span class="fa fa-star dbtheory three" data-start-selector="dbtheory'+textclass+'3" value="3" Title="Average"></span>'+
										  '<span class="fa fa-star dbtheory four" data-start-selector="dbtheory'+textclass+'4" value="4" Title="Good"></span>'+
										  '<span class="fa fa-star dbtheory five" data-start-selector="dbtheory'+textclass+'5" value="5" Title="Expert"></span>'+
										  '</div></td>'+
												
										  '<td><div class="rating" id="db-practice'+textclass+'" data-start-selector="db-practice'+textclass+'">'+
										  '<span class="fa fa-star dbpractice one" data-start-selector="dbpractice'+textclass+'1" value="1" Title="Novice"></span>'+
										  '<span class="fa fa-star dbpractice two" data-start-selector="dbpractice'+textclass+'2" value="2" Title="Notable"></span>'+
										  '<span class="fa fa-star dbpractice three" data-start-selector="dbpractice'+textclass+'3" value="3" Title="Average"></span>'+
										  '<span class="fa fa-star dbpractice four" data-start-selector="dbpractice'+textclass+'4" value="4" Title="Good"></span>'+
										  '<span class="fa fa-star dbpractice five" data-start-selector="dbpractice'+textclass+'5" value="5" Title="Expert"></span>'+				'</div></td><td><span class="fa fa-trash skillset" id="db'+textclass+'" data-start-selector="db'+textclass+'"></span></td></tr>';
										
										var addeddatabase =text.toLowerCase();
										addeddatabase= addeddatabase.replace(/\s/g,'');
							            var result = otherdatabasearray.includes(addeddatabase);
						
										if(result){
											$("#myinfodb-repeat").css("display", "flow-root");
											 $("#other-db").val('');
											setTimeout(function(){
												$("#myinfodb-repeat").css("display", "none");
											}, 4000);
										}else{	 
											$("#ratingtable-db").append(tablerow);
						                    $("#other-db").val('');
										}
								otherdatabasearray = [];										
							}
						}else{
							 $("#myinfo-db").css("display", "flow-root");
							$("#other-db").val('');
							setTimeout(function(){
								 $("#myinfo-db").css("display", "none");
								
								}, 4000);
						}
							
						});
				
				
				//add other opersatind systems 
				$(document).on("click","#other-os-add",function(event){
							
							var  text = document.getElementById("other-os").value;	
			
							var textclass= text.replace(/\s/g,''); 
							var rowCount = $('#ratingtable-os tr').length;
						if(rowCount <= 3){
							if(text){
							document.getElementById("os1").style.display = "contents";
							
								$('#ratingtable-os tr').each(function() {
									var addedos = $(this).find("td:first").html();
										if(addedos != undefined){
											addedos = addedos.toLowerCase();
											addedos= addedos.replace(/\s/g,'');
											otheroperatingsystemarray.push(addedos);
										}
								});
							
												
							 var tablerow='<tr data-start-selector="os'+textclass+'">'+
												'<td>'+text+'</td>'+
												'<td><div class="rating" id="os-theory'+textclass+'" data-start-selector="os-theory'+textclass+'">'+
												'<span class="fa fa-star ostheory one" data-start-selector="ostheory'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star ostheory two"  data-start-selector="ostheory'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star ostheory three" data-start-selector="ostheory'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star ostheory four" data-start-selector="ostheory'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star ostheory five" data-start-selector="ostheory'+textclass+'5" value="5" Title="Expert"></span>'+
												'</div></td>'+
												
												'<td><div class="rating" id="os-practice'+textclass+'" data-start-selector="os-practice'+textclass+'">'+
												'<span class="fa fa-star ospractice one" data-start-selector="ospractice'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star ospractice two" data-start-selector="ospractice'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star ospractice three" data-start-selector="ospractice'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star ospractice four" data-start-selector="ospractice'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star ospractice five" data-start-selector="ospractice'+textclass+'5" value="5" Title="Expert"></span>'+			'</div></td><td><span class="fa fa-trash skillset" id="os'+textclass+'" data-start-selector="os'+textclass+'"></span></td></tr>';
												
										var addedoperasys =text.toLowerCase();
										addedoperasys= addedoperasys.replace(/\s/g,'');
										var result = otheroperatingsystemarray.includes(addedoperasys);
						
										if(result){
											$("#myinfoos-repeat").css("display", "flow-root");
											$("#other-os").val('');
											setTimeout(function(){
												$("#myinfoos-repeat").css("display", "none");
											}, 4000);
										}else{	 
											$("#ratingtable-os").append(tablerow);
											$("#other-os").val('');
										}          
								otheroperatingsystemarray = [];
							}

						}else{
							
							$("#myinfo-os").css("display", "flow-root");
							$("#other-os").val('');
							setTimeout(function(){
								 $("#myinfo-os").css("display", "none");
								
								}, 4000);
							
						}
						});
					
					
				//add other tool 	
				$(document).on("click","#other-tool-add",function(event){
							
							var  text = document.getElementById("other-tool").value;	
			
							var textclass= text.replace(/\s/g,''); 
							var rowCount = $('#ratingtable-tool tr').length;
						if(rowCount <= 3){
							
							if(text){
							document.getElementById("tool1").style.display = "contents";
							
							$('#ratingtable-tool tr').each(function() {
								var addedtools = $(this).find("td:first").html();
								if(addedtools != undefined){
									addedtools = addedtools.toLowerCase();
									addedtools= addedtools.replace(/\s/g,'');
								othertoolsarray.push(addedtools);
								}							
							});
												
							var tablerow='<tr data-start-selector="tools'+textclass+'">'+
											    '<td>'+text+'</td>'+
											    '<td><div class="rating" id="tools-theory'+textclass+'" data-start-selector="tools-theory'+textclass+'">'+
												'<span class="fa fa-star toolstheory one" data-start-selector="toolstheory'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star toolstheory two"  data-start-selector="toolstheory'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star toolstheory three" data-start-selector="toolstheory'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star toolstheory four" data-start-selector="toolstheory'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star toolstheory five" data-start-selector="toolstheory'+textclass+'5" value="5" Title="Expert"></span>'+
												'</div></td>'+
												
												'<td><div class="rating" id="tools-practice'+textclass+'" data-start-selector="tools-practice'+textclass+'">'+
												'<span class="fa fa-star toolspractice one" data-start-selector="toolspractice'+textclass+'1" value="1" Title="Novice"></span>'+
												'<span class="fa fa-star toolspractice two" data-start-selector="toolspractice'+textclass+'2" value="2" Title="Notable"></span>'+
												'<span class="fa fa-star toolspractice three" data-start-selector="toolspractice'+textclass+'3" value="3" Title="Average"></span>'+
												'<span class="fa fa-star toolspractice four" data-start-selector="toolspractice'+textclass+'4" value="4" Title="Good"></span>'+
												'<span class="fa fa-star toolspractice five" data-start-selector="toolspractice'+textclass+'5" value="5" Title="Expert"></span>'+	'</div></td>'+
												'<td><span class="fa fa-trash skillset" id="tools'+textclass+'" data-start-selector="tools'+textclass+'"></span></td></tr>';
										
										var addedtools =text.toLowerCase();
										    addedtools= addedtools.replace(/\s/g,'');
										var result = othertoolsarray.includes(addedtools);
						
										if(result){
											$("#myinfotools-repeat").css("display", "flow-root");
											$("#other-tool").val('');
											setTimeout(function(){
												$("#myinfotools-repeat").css("display", "none");
											}, 4000);
										}else{	 
											$("#ratingtable-tool").append(tablerow);
											$("#other-tool").val('');
										}          		
							othertoolsarray = [];
							}
							
						}else{
							
							$("#myinfo-tool").css("display", "flow-root");
							$("#other-tool").val('');
							setTimeout(function(){
								 $("#myinfo-tool").css("display", "none");
								
								}, 4000);
							
							
						}
							
						});
					
					
					/*
					 * function to rate star for theory in programming languages,framework,database,operating systems,tools.
					 */
					 
					//function to rate star for theory in programming languages section.
					
					$(document).on("click",".langtheory",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
						
					      //  eventid= eventid.replace(/\s/g,''); 
						var idstring=eventid.slice(0,-1)
					
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
								}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
								}
						}					
					});
					
					//function to rate star for theory in Framework section.
					
					$(document).on("click",".frametheory",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
						   // eventid= eventid.replace(/\s/g,'');

						var idstring=eventid.slice(0,-1)
		
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
								}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
								}
						}					
					});
					
					//function to rate star for theory in db section.
					
					$(document).on("click",".dbtheory",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
					        //eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
					
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
								}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
								}
						}					
					});
					
					//function to rate star for theory in os section.
					
					$(document).on("click",".ostheory",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
					       // eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
					
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
								}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
								}
						}					
					});
					
					//function to rate star for theory in tools section.
					
					$(document).on("click",".toolstheory",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
					       // eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
					
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
								}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
								}
						}					
					});
					
					/*
					 * function to rate star for practice in programming languages,frameworks,databases,opertaing systems and tools section.
					 */
					 
					//function to rate star for practice/hands-on in language section.
					
					$(document).on("click",".langpractice",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
					 	 //   eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
				
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
									}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
									}
						}					
					});
					
					//function to rate star for practice/hands-on in framework section.
					
					$(document).on("click",".framepractice",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
						    //eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
				
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
									}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
									}
						}					
					});
					
					
					//function to rate star for practice/hands-on in db section.
					
					$(document).on("click",".dbpractice",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
						    //eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
				
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
									}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
									}
						}					
					});
					
					//function to rate star for practice/hands-on in os section.
					
					$(document).on("click",".ospractice",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
						   // eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
				
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
									}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
									}
						}					
					});
					
					//function to rate star for practice/hands-on in tools section.
					
					$(document).on("click",".toolspractice",function(event){
					
						//var eventid = $(this).attr('id');
						var eventid = $(this).attr('data-start-selector');
						var eventclass = $(this).attr('class');
						var value = $(this).attr('value');
						   // eventid= eventid.replace(/\s/g,'');
						var idstring=eventid.slice(0,-1)
				
						var search='checked';
						var stringmatch = eventclass.includes(search);
					
						if(stringmatch){
							var j=5;
								for (j = 5; j > value; j--) {
										$('[data-start-selector="'+idstring+j+'"]').removeClass("checked");
									}	
						}else{
							var i=1;
								for (i = 1; i <= value; i++) {
										$('[data-start-selector="'+idstring+i+'"]').addClass("checked");
									}
						}					
					});
					
					
					$(document).on("click",".skillset",function(event){
						
						//var eventid = $(this).attr('id');
						var rowid = $(this).attr('row');
						var eventid = $(this).attr('data-start-selector');
						
						$('[data-start-selector="'+eventid+'"]').remove();
						
						
						if(rowid !== undefined && rowid){
							var arg = {
									action:'delete_skillset',
									row:rowid,
							};
							
							$.ajax({
								url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
								type: "POST",
								data: arg,
								success: function(obj){
									
								},
								error: function(){
								}
							});
						} 
						
					});	
					
					
					/*
					 *  Technical Skill Set related javascripts  ends here
					 *					 
					 */
					
					/*
					 *  Additional Training and certifications related javascripts  starts here
					 *					 
					 */
					 
					/*
					 * function to filter data for certifications and training section.
					 */
					
					//Search filter data for certifications section

					$("#searchName-certi").keyup(function(e){
						
						var code = e.keyCode || e.which;
						var x = document.getElementById("searchName-certi").value;
                        $("#myDropdown-certi tr").remove();
						
						if(!certificationsarray || !x){							
							$("#myDropdown-certi tr").remove();	
						}else{
								$("#myDropdown-certi tr").remove();
								$.each( certificationsarray, function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										var tablerow='<tr ><td id="certificate-result" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td></tr>';									
										$('.dropdown-content-certi').append(tablerow);
									}								
								});	
						}
					});
					
					
					//filter data for Trainings section

					$("#searchName-train").keyup(function(e){
						var code = e.keyCode || e.which;
						var x = document.getElementById("searchName-train").value;
						$("#myDropdown-train tr").remove();
						
						if(!trainings || !x){							
							$("#myDropdown-train tr").remove();	
						}else{
								$("#myDropdown-train tr").remove();
								$.each( trainings, function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										var tablerow='<tr ><td id="training-result" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td></tr>';									
										$('.dropdown-content-train').append(tablerow);
									}								
								});	
						}
					});
					
					/*
					 * function to append selected data in certifications and training section.
					 */
					
					// Append data in certifications section
					$(document).on("click","#certificate-result",function(event){
						var classn=$(event.target).attr('class');
						var text = $(event.target).text();		
						var name='<p id="certification-name" value="'+text+'">'+text+'</p>';
						
						$("#certification-name").remove();
						$("#certification").append(name); 
						 document.getElementById("parent_div_2").style.display = "inline-table";
						 $("#searchName-certi").val(text);
						  $("#myDropdown-certi tr").remove();
						 
						 
						
					});
					
					// Append data for Trainings section
					$(document).on("click","#training-result",function(event){
						var classn=$(event.target).attr('class');
						var text = $(event.target).text();
						var name='<p id="training-name" value="'+text+'">'+text+'</p>';
						
						 $("#training-name").remove();						
						 $("#training").append(name); 
						 document.getElementById("parent_div_3").style.display = "inline-table";
						 $("#searchName-train").val(text);
						  $("#myDropdown-train tr").remove();
						
					});
					
					// Append other data in certifications section
					
					$(document).on("click","#other-certi-add",function(event){
						var text = document.getElementById("other-certi").value;
						
						if(text !=''){
						
						//var classn=$(event.target).attr('class');
						//var text = $(event.target).text();
							if(text){
						     var name='<p id="certification-name" value="'+text+'">'+text+'</p>';
							 $("#certification-name").remove();
							 $("#certification").append(name); 
							 document.getElementById("parent_div_2").style.display = "inline-table";
							 $("#other-certi").val('');
							 $("#myDropdown-certi tr").remove();
							  $("#searchName-certi").val(''); 
							 
							}
						} 
						
					});
					
					// Append other data for Trainings section
					$(document).on("click","#other-train-add",function(event){
						var text = document.getElementById("other-train").value;
						
						if(text !=''){
						
							if(text){
						     var name='<p id="training-name" value="'+text+'">'+text+'</p>';
							 $("#training-name").remove();
							 $("#training").append(name); 
							 document.getElementById("parent_div_2").style.display = "inline-table";
							 $("#other-train").val('');
							  $("#searchName-train").val('');
							 
							 $("#myDropdown-train tr").remove();
							}
						} 
						
					});
					
					/*
					 * function to append selected data in certifications and training section.
					 */
					
					// add new row in certifications result table section
					$(document).on("click","#addcertification",function(event){
						
						
						
						 var certification=$('#certification-name').text();
						 var passingscore=document.getElementById("certification-score").value;
						 var passinggrade=document.getElementById("certification-grade").value;
						 var completionmonth=document.getElementById("certification-myMonth").value;
						 
						 var gradetopass=true;
						 
						 if(isNaN(passingscore)){
							        gradetopass=false; 
									$("#certification-score").focus();
								    $("#certification-score").addClass("invalid");
									$('#errormessagecertification').css('color', "red");
							        $("#errormessagecertification").text("Score should be a number")
							 
						 }else{
						  if( passingscore){
							  var passingscore =Math.round(passingscore);  
								  if(passingscore > 100){
									gradetopass=false; 
									$("#certification-score").focus();
								    $("#certification-score").addClass("invalid");
									$('#errormessagecertification').css('color', "red");
							        $("#errormessagecertification").text("Enter Valid Score");
								  }else{
									  gradetopass=true;
									 $("#certification-score").removeClass("invalid"); 
									 $("#errormessagecertification").text("");
								  }
							 }
						 }
						 
						if(certification  && completionmonth && gradetopass){
							
						   document.getElementById("certificationtr").style.display = "contents";
						  $("#emptycerfi").remove();
						  var count=document.getElementById("certification-resulttable").getElementsByTagName("tr").length;
						  var table=document.getElementById("certification-resulttable");
						  
						   var actionicons='<a class="edit-certi" title="Edit" id="certi'+count+'" style="color:#FFC107;"><i class="fa fa-pencil"></i></a> '+
                                          '&nbsp;&nbsp;&nbsp;<a class="delete-certi" title="Delete" style="color:red;"><i class="fa fa-trash"></i></a>';
						  
						  
						  if(editcertificationIndex){
							  
							 $('.certiname'+editcertificationIndex).html(certification);
							 $('.passscore'+editcertificationIndex).html(passingscore);
							 $('.passgrade'+editcertificationIndex).html(passinggrade);
							 $('.compltime'+editcertificationIndex).html(completionmonth);
							  
						  }else{
						  
						  
						  certification='<p class="certiname'+count+'">'+certification+'</p>';
						  passingscore='<p class="passscore'+count+'">'+passingscore+'</p>';
						  passinggrade='<p class="passgrade'+count+'">'+passinggrade+'</p>';
						  completionmonth='<p class="compltime'+count+'">'+completionmonth+'</p>';
						
						 var tablerow='<tr id="certification'+count+'"><td>'+count+'</td><td>'+certification+'</td>'+
							              '<td>'+passingscore+'</td><td>'+passinggrade+'</td><td>'+completionmonth+'</td><td>'+actionicons+'</td></tr>';
							 
							 $("#certification-resulttable tbody").append(tablerow);
						  
						  }
						  
						  $("#certification-searchbox").val('');
						  $("#certification-name").remove();
						  $("#certification-score").val('');
						  $("#certification-grade").val('');
						  $("#certification-myMonth").val('');	
						  $("#searchName-certi").val('');
						 editcertificationIndex=null
						}else{
							 //validation for save
							 if(! certification){
								 $("#searchName-certi").focus();
								 $("#searchName-certi").addClass("invalid");	 
							 }else{
								$("#searchName-certi").removeClass("invalid");
							 }
							 
							 if(! completionmonth){								 
								   $("#certification-myMonth").focus();
								   $("#certification-myMonth").addClass("invalid");								 
							 }else{
								$("#certification-myMonth").removeClass("invalid");								 
							 }
							 
						 }
						
					});
						// add new row in training result table section
					$(document).on("click","#addtraining",function(event){
						
						 var training=$('#training-name').text();
						 var passingscore=document.getElementById("training-score").value;
						 var passinggrade=document.getElementById("training-grade").value;
						 var completiondate=document.getElementById("training-myMonth").value;
						 
						 
						 var gradetopass=true;
						 
						 if(isNaN(passingscore)){
							
							gradetopass=false; 
							$("#training-score").focus();
							$("#training-score").addClass("invalid");
							$('#errormessagetraining').css('color', "red");
							$("#errormessagetraining").text("Score should be a number");
						 
						 }else{
						  if( passingscore){
							   passingscore =Math.round(passingscore);  
								  if(passingscore > 100){
									gradetopass=false; 
									$("#training-score").focus();
								    $("#training-score").addClass("invalid");
									$('#errormessagetraining').css('color', "red");
							        $("#errormessagetraining").text("Enter Valid Score");
								  }else{
									  gradetopass=true;
									$("#training-score").removeClass("invalid"); 
									 $("#errormessagetraining").text("");
								  }
							 }
						 }
						 
						if(training && completiondate && gradetopass){
							
						  document.getElementById("trainingtr").style.display = "contents";	
						  $("#emptytraining").remove();
						  var count=document.getElementById("training-resulttable").getElementsByTagName("tr").length;
						  var table = document.getElementById("training-resulttable");
						  
						   var actionicons='<a class="edit-train" title="Edit" id="train'+count+'" style="color:#FFC107;"><i class="fa fa-pencil"></i></a>'+
                                          '&nbsp;&nbsp;&nbsp;<a class="delete-train" title="Delete" style="color:red;"><i class="fa fa-trash"></i></a>';
						  
						  if(edittrainingndex){
							  
							  $('.tcertiname'+edittrainingndex).html(training);
							 $('.tpassscore'+edittrainingndex).html(passingscore);
							 $('.tpassgrade'+edittrainingndex).html(passinggrade);
							 $('.tcompltime'+edittrainingndex).html(completiondate);
							  
						  }else{
						  
						  training='<p class="tcertiname'+count+'">'+training+'</p>';
						  passingscore='<p class="tpassscore'+count+'">'+passingscore+'</p>';
						  passinggrade='<p class="tpassgrade'+count+'">'+passinggrade+'</p>';
						  completiondate='<p class="tcompltime'+count+'">'+completiondate+'</p>';
						  
						  
						  var tablerow='<tr id="training'+count+'"><td>'+count+'</td><td>'+training+'</td>'+
							              ' <td>'+passingscore+'</td><td>'+passinggrade+'</td><td>'+completiondate+'</td><td>'+actionicons+'</td></tr>';
							 
							 $("#training-resulttable tbody").append(tablerow);
						  
						 
						  }
						  $("#training-searchbox").val('');
						  $("#training-name").remove();
						  $("#training-score").val('');
						  $("#training-grade").val('');
						  $("#training-myMonth").val('');	
						   $("#searchName-train").val('');
						   
						   edittrainingndex=null
						}else{
							 //validation for save
							 if(! training){
								 $("#searchName-train").focus();
								 $("#searchName-train").addClass("invalid");	 
							 }else{
								$("#searchName-train").removeClass("invalid");
							 }
							 
							 if(! completiondate){								 
								   $("#training-myMonth").focus();
								   $("#training-myMonth").addClass("invalid");								 
							 }else{
								$("#training-myMonth").removeClass("invalid");								 
							 }
							 
						 }
						
					});
					
					/*
					 * edit,delete table row for certification and trainings
					 */ 
					
					$(document).on("click",".edit-certi",function(event){
						
						//var parent= $(this).parent().parent().attr('id');
						
						var currenttid = $(this).attr('id');
						var rownum = currenttid.replace("certi","");
						editcertificationIndex=rownum;
						var title=$(".certiname"+rownum).text();
						var score=$(".passscore"+rownum).text();
						var grade=$(".passgrade"+rownum).text();
						var month=$(".compltime"+rownum).text();
						
						$("#searchName-certi").val(title);
						$("#certification-score").val(score);
						$("#certification-grade").val(grade);
						$("#certification-myMonth").val(month);
						$("#certification-name").remove();
						var name='<p id="certification-name" value="'+title+'">'+title+'</p>';
						$("#certification").append(name); 
						
					  //	$('#'+parent).remove();
					});	
					
					$(document).on("click",".edit-train",function(event){
						
						//var parent= $(this).parent().parent().attr('id');
						
						var currenttid = $(this).attr('id');
						var rownum = currenttid.replace("train","");
						edittrainingndex=rownum;
						var title=$(".tcertiname"+rownum).text();
						var score=$(".tpassscore"+rownum).text();
						var grade=$(".tpassgrade"+rownum).text();
						var month=$(".tcompltime"+rownum).text();
						
						$("#searchName-train").val(title);
						$("#training-score").val(score);
						$("#training-grade").val(grade);
						$("#training-myMonth").val(month);
						 $("#training-name").remove();
						 var name='<p id="training-name" value="'+title+'">'+title+'</p>';
						 $("#training").append(name); 
						
					  //	$('#'+parent).remove();
					});	
					
					
					$(document).on("click","#cleartraining",function(event){					
						
						$("#searchName-train").val('');
						$("#other-train").val('');
						$("#training-score").val('');
						$("#training-grade").val('');
						$("#training-myMonth").val('');
						$("#training-name").text('');
						
						
						edittrainingndex=null;
						
					});	
					
					$(document).on("click","#clearcertification",function(event){					
						
						$("#searchName-certi").val('');
						$("#other-certi").val('');
						$("#certification-score").val('');
						$("#certification-grade").val('');
						$("#certification-myMonth").val('');
						$("#certification-name").text('');
						
						
						editcertificationIndex=null;
						
					});	
					
					
					
					/*
					 *  Additional Training and certifications related javascripts  ends here
					 *					 
					 */	
					
					
					
					/*
					 * Internship and training javascript starts here
					 */
					


					//function to search tools
					$("#searchName-intern").keyup(function(e){
						
						var x = document.getElementById("searchName-intern").value;	
						var code = e.keyCode || e.which;
						$("#myDropdown-intern tr").remove();
						
						if(!programmings || !x){							
							$("#myDropdown-intern tr").remove();	
						}else{
								$("#myDropdown-intern tr").remove();
								$.each( programmings, function( key, value ) { 
								
									var stringone=value.toUpperCase();
									var stringtwo=x.toUpperCase();
								
									var result = stringone.includes(stringtwo);
								
									if(result){									
										var tablerow='<tr ><td id="serchresult-intern" style="background:ghostwhite; width: 264px !important;line-height: 30px; text-decoration:none"><a href="#" class="result'+key+'">'+value+'</a></td><td></td></tr>';
		
									$('#myDropdown-intern').append(tablerow);	
									}								
								});	
						}
					}); 
					
					// Append other data for Trainings section
					$(document).on("click","#other-intern-add",function(event){
						var text = document.getElementById("other-intern").value;
						
						if(text !=''){
							if(text){
							 $("#searchName-intern").val(text);
							 $("#other-intern").val('');
							 $("#myDropdown-train tr").remove();
							}
						} 
						
					});
					
					$(document).on("click","#serchresult-intern",function(event){
						var classn=$(event.target).attr('class');
						var text = $(event.target).text();		
						
						 $("#myDropdown-intern tr").remove();
						 $("#searchName-intern").val(text);
						
					});
					
					
					
					$(document).on("click","#addintern",function(event){
						
					     var program = document.getElementById("program-intern").value;
						 var institue = document.getElementById("organization-intern").value;
						 var skills = document.getElementById("searchName-intern").value;
						 var completion = document.getElementById("intern-myMonth").value;						 
						 
						 if(program  && institue && skills && completion){
						
						 document.getElementById("interntr").style.display = "contents";
						  //remove error message
						  $("#errormessageinternship").text("");
						   $("#emptyintern").remove();
						  
						  var count=document.getElementById("Intern-resulttable").getElementsByTagName("tr").length;
						  var table = document.getElementById("Intern-resulttable");
						 
						  var actionicons='<a class="edit-intern" title="Edit" id="intern'+count+'" style="color:#FFC107;"><i class="fa fa-pencil"></i></a> '+
                                          '&nbsp;&nbsp;&nbsp;<a class="delete-intern" title="Delete" style="color:red;"><i class="fa fa-trash"></i></a>';
						 
						  if(editinternshipIndex){
							  
							 $('.internname'+editinternshipIndex).html(program);
							 $('.internins'+editinternshipIndex).html(institue);
							 $('.internskills'+editinternshipIndex).html(skills);
							 $('.interncompletion'+editinternshipIndex).html(completion);
							  
						  }else{
						   
						  program='<p class="internname'+count+'">'+program+'</p>';
						  institue='<p class="internins'+count+'">'+institue+'</p>';
						  skills='<p class="internskills'+count+'">'+skills+'</p>';
						  completion='<p class="interncompletion'+count+'">'+completion+'</p>';
						  
						  var tablerow='<tr id="internship'+count+'"><td>'+count+'</td><td>'+program+'</td>'+
							              ' <td>'+institue+'</td><td>'+skills+'</td><td>'+completion+'</td><td>'+actionicons+'</td></tr>';
							 
							 $("#Intern-resulttable tbody").append(tablerow);
						  
						  
						  }
						  $("#program-intern").val('');
						  $("#organization-intern").val('');
						  $("#searchName-intern").val('');
						  $("#intern-myMonth").val('');	
						  
						  editinternshipIndex=null
						  
						 }else{
							 
							 //validation for save
							 if(! completion){
								 $("#intern-myMonth").focus();
								 $("#intern-myMonth").addClass("invalid");	 
							 }else{
								$("#intern-myMonth").removeClass("invalid");
							 }
							 
							 if(! skills){
								   $("#searchName-intern").focus();
								   $("#searchName-intern").addClass("invalid");	
							 }else{
								 $("#searchName-intern").removeClass("invalid");
							 }
							 
							 if(! institue){								 
								   $("#organization-intern").focus();
								   $("#organization-intern").addClass("invalid");								 
							 }else{
								$("#organization-intern").removeClass("invalid");								 
							 }
							 
							 if(! program){								 
								   $("#program-intern").focus();
								   $("#program-intern").addClass("invalid");								 
							 }else{
								$("#program-intern").removeClass("invalid");								 
							 }
							 
							 $('#errormessageinternship').css('color', "red");
							 $("#errormessageinternship").text("Fill empty fields");
							 	 
						 }
						  
					});
					
					$(document).on("click",".edit-intern",function(event){
						
						//var parent= $(this).parent().parent().attr('id');
						
						var currenttid = $(this).attr('id');
						var rownum = currenttid.replace("intern","");
						editinternshipIndex =rownum;
						var title=$(".internname"+rownum).text();
						var inst=$(".internins"+rownum).text();
						var skill=$(".internskills"+rownum).text();
						var date=$(".interncompletion"+rownum).text();
						
						$("#program-intern").val(title);
						$("#organization-intern").val(inst);
						$("#searchName-intern").val(skill);
						$("#intern-myMonth").val(date);
						
					//	$('#'+parent).remove();
					});	
					$(document).on("click","#clearintern",function(event){
						
						     $("#program-intern").val('');
							 $("#organization-intern").val('');
							 $("#searchName-intern").val('');
							 $("#other-intern").val('');
							 $("#intern-myMonth").val('');
							 editinternshipIndex=null;
					});	
					
					
					/*
					 * Internship and training javascript ends here
					 */
					
					
					/*
					 * Accomplishments and accolades javascript starts here
					 */
					
					$(document).on("click","#addaccolades",function(event){
					     var title = document.getElementById("accolade-title").value;
						 var desc = document.getElementById("accolade-desc").value;
						 var accdate = document.getElementById("accolade-date").value;
										 
						 
						 if(title  && desc && accdate ){
							 
							 document.getElementById("accoladetr").style.display = "contents";
							 
							// remove error message
						  $("#errormessageaccomplishment").text("");
							
						  $("#emptyaccolades").remove();
						  
						  var count=document.getElementById("accolade-resulttable").getElementsByTagName("tr").length;
						  var table = document.getElementById("accolade-resulttable");
						  
						  var actionicons='<a class="edit-acco" title="Edit" id="acco'+count+'" style="color:#FFC107;"><i class="fa fa-pencil"></i></a> '+
                                          '&nbsp;&nbsp;&nbsp;<a class="delete-acco" title="Delete" style="color:red;"><i class="fa fa-trash"></i></a>';
						  
						  //console.log(editaccomplishmentIndex);
						  if(editaccomplishmentIndex){
							 
							 $('.acctitle'+editaccomplishmentIndex).html(title);
							 $('.accdesc'+editaccomplishmentIndex).html(desc);
							 $('.accaccomplish'+editaccomplishmentIndex).html(accdate);
							  
						  }else{
						  
						  title='<p class="acctitle'+count+'">'+title+'</p>';
						  desc='<p class="accdesc'+count+'">'+desc+'</p>';
						  accdate='<p class="accaccomplish'+count+'">'+accdate+'</p>';
						  
						   var tablerow='<tr id="accolade'+count+'"><td>'+count+'</td><td>'+title+'</td>'+
							              ' <td>'+desc+'</td><td>'+accdate+'</td><td>'+actionicons+'</td></tr>';
							 
							 $("#accolade-resulttable tbody").append(tablerow);
						  }
						  $("#accolade-title").val('');
						  $("#accolade-desc").val('');
						  $("#accolade-date").val('');
						  
						  editaccomplishmentIndex = null
						  
						 }else{
							 //validation for save
							 if(! accdate){
								 $("#accolade-date").focus();
								 $("#accolade-date").addClass("invalid");	 
							 }else{
								$("#accolade-date").removeClass("invalid");
							 }
							 
							 if(! desc){
								   $("#accolade-desc").focus();
								   $("#accolade-desc").addClass("invalid");	
							 }else{
								 $("#accolade-desc").removeClass("invalid");
							 }
							 
							 if(! title){								 
								   $("#accolade-title").focus();
								   $("#accolade-title").addClass("invalid");								 
							 }else{
								$("#accolade-title").removeClass("invalid");								 
							 }
							 $('#errormessageaccomplishment').css('color', "red");
							 $("#errormessageaccomplishment").text("Fill empty fields");
							 
						 }
						  
					});
					
					$(document).on("click",".edit-acco",function(event){
						
					//	var parent= $(this).parent().parent().attr('id');
						
						var currenttid = $(this).attr('id');
						var rownum = currenttid.replace("acco","");
						editaccomplishmentIndex = rownum;
						
						var title=$(".acctitle"+rownum).text();
						var desc=$(".accdesc"+rownum).text();
						var date=$(".accaccomplish"+rownum).text();
						
						$("#accolade-title").val(title);
						$("#accolade-desc").val(desc);
						$("#accolade-date").val(date);
						
						
					//	$('#'+parent).remove();
					});	
					$(document).on("click","#clearaccolades",function(event){
					
					$("#accolade-title").val('');
							 $("#accolade-desc").val('');
							 $("#searchName-intern").val('');
							 $("#accolade-date").val('');
							
							 editaccomplishmentIndex=null;
					});	
					
					// Delete for Accomplishment
					$(document).on("click",".delete-acco",function(event){
						
						var currenttid = $(this).attr('id');
						var immediateparentid=$('#'+currenttid).parent().prop('id');
						var rowid=$('#'+immediateparentid).parent().prop('id');
						$("#"+rowid).remove();
						
						for(var rowIndex = 2; rowIndex <= $('#accolade-resulttable tr').length; rowIndex++) {
							
							$('#accolade-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(1)').html(rowIndex - 1)
							$('#accolade-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(2) p').attr('class','acctitle'+(rowIndex - 1));
							$('#accolade-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(3) p').attr('class','accdesc'+(rowIndex - 1));
							$('#accolade-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(4) p').attr('class','accaccomplish'+(rowIndex - 1));
							$('#accolade-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(5) a').attr('id','acco'+(rowIndex - 1));
						}
						
						var avilablerow=$('#accolade-resulttable tr').length;;
						if(avilablerow == 1){
							var htmlrow='<tr id="emptyaccolades" style="border-color:white">'+
										'<td colspan="5" align="center" style="text-align: center;">No data available</td></tr>'
							document.getElementById("accoladetr").style.display = "none";
							//$("#accolade-resulttable tbody").append(htmlrow);
							
						}
						
						
						var rowvalue = $(this).attr('value');
						
						var arg = {
								action:'delete',
								title: 'acco',
								row:rowvalue,
						};
						
						var rootPath = M.cfg.wwwroot;
						$.ajax({
							url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
							type: "POST",
							data: arg,
							success: function(obj){
								
							},
							error: function(){
							}
						});	
					});

					// Delete for Intern
					$(document).on("click",".delete-intern",function(event){
						
						var currenttid = $(this).attr('id');
						var immediateparentid=$('#'+currenttid).parent().prop('id');
						var rowid=$('#'+immediateparentid).parent().prop('id');
						$("#"+rowid).remove();
						
						
						//for sl.no
						for(var rowIndex = 2; rowIndex <= $('#Intern-resulttable tr').length; rowIndex++) {
								
							$('#Intern-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(1)').html(rowIndex - 1)
							
							$('#Intern-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(2) p').attr('class','internname'+(rowIndex - 1));
			
							$('#Intern-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(3) p').attr('class','internins'+(rowIndex - 1));

							$('#Intern-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(4) p').attr('class','internskills'+(rowIndex - 1))
							
							$('#Intern-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(5) p').attr('class','interncompletion'+(rowIndex - 1))
							
							$('#Intern-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(6) a').attr('id','intern'+(rowIndex - 1));
							
						}
						
						var avilablerow=$('#Intern-resulttable tr').length;;
						if(avilablerow == 1){
							var htmlrow='<tr id="emptyintern" align="center" style="border-color:white"><td colspan="6">No data available</td></tr>'
							
							document.getElementById("interntr").style.display = "none";
							//$("#Intern-resulttable tbody").append(htmlrow);
							
						}
						
						
						var rowvalue = $(this).attr('value');
						
						var arg = {
								action:'delete',
								title: 'intern',
								row:rowvalue,
						};
						
						var rootPath = M.cfg.wwwroot;
						$.ajax({
							url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
							type: "POST",
							data: arg,
							success: function(obj){
								
							},
							error: function(){
							}
						});	
					});

					// Delete for certificate
						$(document).on("click",".delete-certi",function(event){
						
						var currenttid = $(this).attr('id');
						var immediateparentid=$('#'+currenttid).parent().prop('id');
						var rowid=$('#'+immediateparentid).parent().prop('id');
						$("#"+rowid).remove();
						
						//for sl.no and classnumber
						for(var rowIndex = 2; rowIndex <= $('#certification-resulttable tr').length; rowIndex++) {
							
							$('#certification-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(1)').html(rowIndex - 1)

							$('#certification-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(2) p').attr('class','certiname'+(rowIndex - 1));
			
							$('#certification-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(3) p').attr('class','passscore'+(rowIndex - 1));
							
							$('#certification-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(4) p').attr('class','passgrade'+(rowIndex - 1));

							$('#certification-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(5) p').attr('class','compltime'+(rowIndex - 1))
							
							$('#certification-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(6) a').attr('id','certi'+(rowIndex - 1));
							
						}
						
						var avilablerow=$('#certification-resulttable tr').length;;
						if(avilablerow == 1){
							var htmlrow='<tr id="emptycerfi" align="center" style="border-color:white"><td colspan="5">No data available</td></tr>'
							
							document.getElementById("certificationtr").style.display = "none";
							//$("#certification-resulttable tbody").append(htmlrow);
							
						}
						
						
						
						
						var rowvalue = $(this).attr('value');
						
						var arg = {
								action:'delete',
								title: 'certi',
								row:rowvalue,
						};
						
						var rootPath = M.cfg.wwwroot;
						$.ajax({
							url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
							type: "POST",
							data: arg,
							success: function(obj){
								
							},
							error: function(){
							}
						});	
					});
						// Delete for training
						$(document).on("click",".delete-train",function(event){
						
						var currenttid = $(this).attr('id');
						var immediateparentid=$('#'+currenttid).parent().prop('id');
						var rowid=$('#'+immediateparentid).parent().prop('id');
						$("#"+rowid).remove();
						
						
						//for sl.no and classnumber
						for(var rowIndex = 2; rowIndex <= $('#training-resulttable tr').length; rowIndex++) {
								
							$('#training-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(1)').html(rowIndex - 1);

							$('#training-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(2) p').attr('class','tcertiname'+(rowIndex - 1));
			
							$('#training-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(3) p').attr('class','tpassscore'+(rowIndex - 1));
							
							$('#training-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(4) p').attr('class','tpassgrade'+(rowIndex - 1));

							$('#training-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(5) p').attr('class','tcompltime'+(rowIndex - 1))
							
							$('#training-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(6) a').attr('id','train'+(rowIndex - 1));
							
						}
						
						var avilablerow=$('#training-resulttable tr').length;;
						if(avilablerow == 1){
							var htmlrow='<tr id="emptytraining" align="center" style="border-color:white"><td colspan="5">No data available</td></tr>'
							
							document.getElementById("trainingtr").style.display = "none";	
							//$("#training-resulttable tbody").append(htmlrow);
							
						}
						
						
						var rowvalue = $(this).attr('value');
						
						var arg = {
								action:'delete',
								title: 'train',
								row:rowvalue,
						};
						
						var rootPath = M.cfg.wwwroot;
						$.ajax({
							url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
							type: "POST",
							data: arg,
							success: function(obj){
								
							},
							error: function(){
							}
						});	
					});
						
						// Delete for community
					$(document).on("click",".delete-comm",function(event){
						
						var currenttid = $(this).attr('id');
						var immediateparentid=$('#'+currenttid).parent().prop('id');
						var rowid=$('#'+immediateparentid).parent().prop('id');
						$("#"+rowid).remove();
						
						
						//for sl.no
						for(var rowIndex = 2; rowIndex <= $('#communtity-resulttable tr').length; rowIndex++) {
							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(1)').html(rowIndex - 1);
							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(2) p').attr('class','comtitle'+(rowIndex - 1));
			
							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(3) p').attr('class','comurl'+(rowIndex - 1));

							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(4) p').attr('class','complatform'+(rowIndex - 1));
							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(5) p').attr('class','com-skill'+(rowIndex - 1));
			
							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(6) p').attr('class','com-contri'+(rowIndex - 1));

							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(7) p').attr('class','com-event'+(rowIndex - 1));
							
							$('#communtity-resulttable tr:nth-child('+(rowIndex - 1)+') td:nth-child(8) a').attr('id','com'+(rowIndex - 1));
							
						}
						
						var avilablerow=$('#communtity-resulttable tr').length;;
						if(avilablerow == 1){
							var htmlrow='<tr id="emptycommunity" align="center" style="border-color:white"><td colspan="8" style="text-align: center;">No data available</td></tr>';
							
							document.getElementById("contritr").style.display = "none";
							//$("#communtity-resulttable tbody").append(htmlrow);
							
						}
						
						
						var rowvalue = $(this).attr('value');
						
						
						
						var arg = {
								action:'delete',
								title: 'comm',
								row:rowvalue,
						};
						
						var rootPath = M.cfg.wwwroot;
						$.ajax({
							url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
							type: "POST",
							data: arg,
							success: function(obj){
								
							},
							error: function(){
							}
						});	
					});
					
					
					
					
					
					/*
					 * Community contributors javascript starts here
					 */
					
					$(document).on("click","#addcommunity",function(event){
					     var title = document.getElementById("com-title").value;
						 var url=document.getElementById("com-url").value;
						 var platform=document.getElementById("com-platform").value;
						 var skills=document.getElementById("com-skill").value;
						 var contribution = document.getElementById("com-contri").value;
						 var event = document.getElementById("com-event").value;
										 
						 
						 if(title && url && platform && skills && contribution ){
							 //url pattern validation
							var regexp =  /^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;
							
							if (regexp.test(url)){
							
						  document.getElementById("contritr").style.display = "contents";
						  $("#emptycommunity").remove();
						  
						  var count=document.getElementById("communtity-resulttable").getElementsByTagName("tr").length;
						  
						  var table = document.getElementById("communtity-resulttable");

						  var actionicons='<a class="edit-comm" title="Edit" id="com'+count+'" style="color:#FFC107;"><i class="fa fa-pencil"></i></a> '+
                                          '&nbsp;&nbsp;&nbsp;<a class="delete-comm" title="Delete" style="color:red;"><i class="fa fa-trash"></i></a>';
						  
						 if(editContributionsIndex) {
							 //for edit save purpose
							 $('.comtitle'+editContributionsIndex).html(title);
							 $('.comurl'+editContributionsIndex).html(url);
							 $('.complatform'+editContributionsIndex).html(platform);
							 $('.com-skill'+editContributionsIndex).html(skills);
							 $('.com-contri'+editContributionsIndex).html(contribution);
							 $('.com-event'+editContributionsIndex).html(event);
						 } else {
							 //for new entry purpose
						title='<p class="comtitle'+count+'">'+title+'</p>';
						  url='<p class="comurl'+count+'">'+url+'</p>';
						  platform='<p class="complatform'+count+'">'+platform+'</p>';
						  skills='<p class="com-skill'+count+'">'+skills+'</p>';
						  contribution='<p class="com-contri'+count+'">'+contribution+'</p>';
						  event='<p class="com-event'+count+'">'+event+'</p>';
							 
							 
							 var tablerow='<tr id="contribution'+count+'"><td>'+count+'</td><td>'+title+'</td>'+
							              ' <td>'+url+'</td><td>'+platform+'</td><td>'+skills+'</td><td>'+contribution+'</td><td>'+event+'</td><td>'+actionicons+'</td></tr>';
							 
							 $("#communtity-resulttable tbody").append(tablerow); 
						 }
						
						  $("#com-title").val('');
						  $("#com-url").val('');
						  $("#com-platform").val('');
						  $("#com-skill").val('');
						  $("#com-contri").val('');
						  $("#com-event").val('');
						  
							editContributionsIndex = null
							$("#errormessagecommunity").text("");
						}else{
								$("#com-url").focus();
								$("#com-url").addClass("invalid");
								$('#errormessagecommunity').css('color', "red");	
							    $("#errormessagecommunity").text("Enter valid url");
							}	
						 }else{
							//Validation for empty fields
							if(! contribution){
								 $("#com-contri").focus();
								 $("#com-contri").addClass("invalid");	 
							 }else{
								 $("#com-contri").removeClass("invalid");
							 }
							
							if(! skills){
								 $("#com-skill").focus();
								 $("#com-skill").addClass("invalid");	
							 }else{
								 $("#com-skill").removeClass("invalid");	
							 }		
							 
							 if(! platform){
								 $("#com-platform").focus();
								 $("#com-platform").addClass("invalid");	 
							 }else{
								$("#com-platform").removeClass("invalid");
							 }	
							 
							 if(! url){
								   $("#com-url").focus();
								   $("#com-url").addClass("invalid");	
							 }else{
								 $("#com-url").removeClass("invalid");
							 }
							
							 if(! title){								 
								  // $('#errormessagecommunity').css('color', "red");	
								 //  $("#errormessagecommunity").text("Fill empty fields");
								   $("#com-title").focus();
								   $("#com-title").addClass("invalid");								 
							 }else{
								$("#com-title").removeClass("invalid");								 
							 }						 
							 
						 }
						  
					});
					$(document).on("click",".edit-comm",function(event){
						var currenttid = $(this).attr('id');
						var rownum = currenttid.replace("com","");
						
						editContributionsIndex = rownum;
						
						var title=$(".comtitle"+rownum).text();
						var url=$(".comurl"+rownum).text();
						var platform=$(".complatform"+rownum).text();
						var skill=$(".com-skill"+rownum).text();
						var contri=$(".com-contri"+rownum).text();
						var compevent=$(".com-event"+rownum).text();
						
						$("#com-title").val(title);
						$("#com-url").val(url);
						$("#com-platform").val(platform);
						$("#com-skill").val(skill);
						$("#com-contri").val(contri);
						$("#com-event").val(compevent);
						
					//	$('#'+parent).remove();
					
					});	
					$(document).on("click","#clearcommunity",function(event){
						
						$("#com-title").val('');
						$("#com-url").val('');
						$("#com-platform").val('');
						$("#com-skill").val('');
						$("#com-contri").val('');
						$("#com-event").val('');
						
						editContributionsIndex=null;
						
					});	
					
					
					
					
					
					
					
				//Prev page button logics 	
				$(document).on("click","#prevBtn",function() {
					var n=-1;
					pagecount =pagecount- 1;
						
					//This function will figure out which tab to display
					var x = document.getElementsByClassName("tab");
					//Exit the function if any field in the current tab is invalid:
				  
					if (n == 1 && !validateForm()) return false;
					//Hide the current tab:
					x[currentTab].style.display = "none";
					//Increase or decrease the current tab by 1:
					currentTab = currentTab + n;
					//if you have reached the end of the form...
					if (currentTab >= x.length) {
						//... the form gets submitted:
						document.getElementById("regForm").submit();
						return false;
					}
					appendcss(currentTab);
					//Otherwise, display the correct tab:
					showTab(currentTab);
				});
				   
				   
				   
				//Next page button logics   
				$(document).on("click","#nextBtn",function() {
					var n=1;
					pagecount =(pagecount + 1);
			        var status=false;
				//  console.log(pagecount);
			        
					var title=$("#profile-page"+pagecount).attr('value');
					
					if(title === 'personalprofile'){
						var result=personal_page(n);
						if(result){
							status=true;
						}else{
							pagecount=pagecount-1;
							status=false;
						}
				   }else if(title === 'educationalprofile'){
						//var result=educational_page(n);
						//if(result){
							status=true;
						//}else{
						//	pagecount=pagecount-1;
						//	status=false;
						//}
					}else if(title === 'skillset'){
						var result=skillset();
						if(result){
							status=true;
						}else{
							pagecount=pagecount-1;
							status=false;
						}
					}else if(title === 'certifications'){
						var result=certifications();
						if(result){
							status=true;
						}else{
							pagecount=pagecount-1;
							status=false;
						}
					}else if(title === 'internship'){
						var result=internship();
						if(result){
							status=true;
						}else{
							pagecount=pagecount-1;
							status=false;
						}
					}else if(title === 'accolades'){
						var result=accolades();
						if(result){
							status=true;
						}else{
							pagecount=pagecount-1;
							status=false;
						}
					}else if(title === 'community'){
						var result=community();
						if(result){
							status=true;
						}else{
							pagecount=pagecount-1;
							status=false;
						}
					}else if(title === 'learningpath'){
						
						var result=chooselearningpath();
						if(result){
							status=true;
						}else{
							pagecount=pagecount-1;
							status=false;
						}
					}
					
				if(status){
					
					// This function will figure out which tab to display
					var x = document.getElementsByClassName("tab");

					// Exit the function if any field in the current tab is invalid:
				  //	if (n == 1 && !validateForm()) return false;
			
					// Hide the current tab:
					x[currentTab].style.display = "none";
					
					// Increase or decrease the current tab by 1:
					currentTab = currentTab + n;
					// if you have reached the end of the form...
					if (currentTab >= x.length) {
						// ... the form gets submitted:
					//	document.getElementById("regForm").submit();
					
					$("#prevBtn").css("display", "none");
					$("#nextBtn").css("display", "none");
					var rootPath = M.cfg.wwwroot;
								location.replace(rootPath);	
						//return false;
					}
				
				    appendcss(currentTab);
		//		    addnoneditable(currentTab);
				  
	        	    // Otherwise, display the correct tab:
	        	    showTab(currentTab);
				}
				});
				   
				   
				   //show each html tab
				   
				function showTab(n) {
					   
					// This function will display the specified tab of the form...
					var x = document.getElementsByClassName("tab");
					x[n].style.display = "block";
					//... and fix the Previous/Next buttons:
					if (n == 0) {
						document.getElementById("prevBtn").style.display = "none";
					} else {
						document.getElementById("prevBtn").style.display = "inline";
					}
					if (n == (x.length - 1)) {
						document.getElementById("nextBtn").innerHTML = "Submit";
					} else {
						document.getElementById("nextBtn").innerHTML = "Next";
					}
				  
				//  fixStepIndicator(n)
	        	}	
				
				
				
				
					
	        	//validate form filed value function
	        	function validateForm() {
					// This function deals with validation of the form fields
					var x, y, z, i, valid = true;
					x = document.getElementsByClassName("tab");
					y = x[currentTab].getElementsByTagName("input");
					z=x[currentTab].getElementsByTagName("textarea");
					var pattern=/^\d{10}$/;
					var patternpin=/^\d{6}$/;
					var patternsem=/^\d{0-6}{1}$/;
					// A loop that checks every input field in the current tab:
					
					if(currentTab < 1){
						
							var phone=$("input[name=phone]").val();
							var upin=$("input[name=upin]").val();	
							var notemptycolumns=false;
							var ustate=$("select[name=ustate]").val();	
								
								if( currentTab < 1){
							
										for (i = 0; i < y.length; i++) {
											// If a field is empty...
											if (y[i].value == "") {
											// add an "invalid" class to the field:
											y[i].className += " invalid";
											// and set the current valid status to false
							
											$("#errormessage1").text("Fill empty fields");
											valid = false;
											notemptycolumns = true;
										}
								}
								
									if( z != undefined){
										for (i = 0; i < z.length; i++) {
											if (z[i].value == "") {
											// add an "invalid" class to the field:
											z[i].className += " invalid";
											// and set the current valid status to false
											$("#errormessage1").text("Fill empty fields");
											valid = false;
											notemptycolumns = true;
											}
										}
									}
							}
							
							
							if(! notemptycolumns){
							if(!pattern.test(phone)){
									$('#errormessage1').css('color', "red");	
									$("#errormessage1").text("Enter valid 10 digit phone number");
									$("input[name=phone]").focus();
									valid = false;
								}
								
								if(!patternpin.test(upin)){
									$('#errormessage1').css('color', "red");	
									$("#errormessage1").text("Enter valid pin number");
									$("input[name=upin]").focus();
									valid = false;						
								}
								
								if(! ustate){
									$('#errormessage1').css('color', "red");	
									$("#errormessage1").text("Please select your state");
									$("select[name=ustate]").focus();
									$("select[name=ustate]").addClass("invalid");
									valid = false;						
								}
							
							}
					}

					if(currentTab == 1){
						
						var semester=$("input[name=semester]").val();
						var cpin=$("input[name=cpin]").val();
						var cstate=$("select[name=cstate]").val();
						
								if(! cstate){
									$('#errormessage2').css('color', "red");	
									$("#errormessage2").text("Please select state option");
									$("select[name=cstate]").focus();
									$("select[name=cstate]").addClass("invalid");
									valid = false;						
								}
						
						
						
								if(semester){
								if( semester > 10){
									$('#errormessage2').css('color', "red");
									$("#errormessage2").text("Enter valid semester number");									
									$("input[name=semester]").focus();
									$("input[name=semester]").addClass("invalid");
									valid = false;		
								}else{
									
									$("#errormessage1").text("");
								}
								}
						
						
							/*	if(!patternsem.test(semester)){	
									$('#errormessage2').css('color', "red");	
									$("#errormessage2").text("Enter valid semester number");
									$("input[name=semester]").focus();
									$("input[name=semester]").addClass("invalid");	
									valid = false;
								}else */

								if(!patternpin.test(cpin)){
									$('#errormessage2').css('color', "red");	
									$("#errormessage2").text("Enter valid pin number");
									$("input[name=cpin]").focus();
									$("input[name=cpin]").addClass("invalid");
									valid = false;						
								}
									
								
								if( currentTab ==1){
							
										for (i = 0; i < y.length; i++) {
											// If a field is empty...
											if (y[i].value == "") {
											// add an "invalid" class to the field:
											y[i].className += " invalid";
											// and set the current valid status to false
											$('#errormessage2').css('color', "red");
											$("#errormessage2").text("Fill empty fields");
											valid = false;
										}
								}
								
									if( z != undefined){
										for (i = 0; i < z.length; i++) {
											if (z[i].value == "") {
											// add an "invalid" class to the field:
											z[i].className += " invalid";
											// and set the current valid status to false
											$('#errormessage2').css('color', "red");
											$("#errormessage2").text("Fill empty fields");
											valid = false;
								
											}
										}
									}
							}
					}

				
				if(valid){
					
					$("#errormessage1").text("");
				}
				
	        	  return valid; // return the valid status
	        	}
				
				
				
				
				
				function fixStepIndicator(n) {
						// This function removes the "active" class of all steps...
						var i, x = document.getElementsByClassName("step");
						for (i = 0; i < x.length; i++) {
							x[i].className = x[i].className.replace(" active", "");
						}
						//... and adds the "active" class on the current step:
						x[n].className += " active";
				}



				//change background colour
				function appendcss(currentTab){
				
					if(currentTab >=2){
					/*    //after two slides background colour will change into white
						$("#regForm").css("border-radius", "0px 0px 0px 0px"); 	
						$("#regForm").css("width", "96%"); 	*/
					}
					if(currentTab <2){
					/*    //after two slides background colour will change into white
						//$("#regForm").css("background-color", "#7d7dd8"); 
						$("#regForm").css("border-radius", "82px 0px 0px 82px"); 		*/				
					}
					
				}
				

				
				
				//change form fields into non editable
				function addnoneditable(currentTab){
					
				  var x, y, z, i, valid = true;
					
	        	  x = document.getElementsByClassName("tab");
	        	  y =x[currentTab].getElementsByTagName("input");
				  
				  $(y).each(function(index, value){
					
						$userdate=$(this).attr('value');
						$class=$(this).attr('class');
					  if(currentTab < 2){
						if($userdate != undefined && $userdate !== 'null'){
							$('.'+$class).attr('readonly', true);
						}
					  }
						if($userdate =='null'){
							$('.'+$class).val(''); 	
						}
					});
					
				}
				
				/*
				 * add data to table
				 *
				 */
				function personal_page(n){				

					//Get personal profile.
				//	var fname=$("#profile-fname").val();
				//	var lname=$("#profile-lname").val();
				//	var email=$("#profile-email").val();
					var phone=$("#profile-phone").val();
				//	var cid=$("input[name=cid]").val();
				//	var uname=$("input[name=uname]").val();
					var uaddress=$("#useraddress").val();
					var ucity=$("#profile-city").val();
					var upin=$("#profile-pin").val();
					var ucountry=$('select[name="ucountry"]').val();
					var ustate=$("select[name=ustate]").val();					
					
					//Eductional Summary
					//var degree=$("#profile-degree").val();
					//var branch=$("#profile-branch").val();
					  var semester=$("#semester").val();
					//var graduated=$("#graduate").val();
					//var college=$("#college-address").val();
					var university=$("input[name=university]").val();
					var caddress=$("#college-address").val();
					var ccity=$("#profile-ccity").val();
					var cpin=$("#profile-cpin").val();
					var cstate=$("select[name=cstate]").val();
					var ccountry=$("select[name=ccountry]").val();
					
					
					//var result=validateForm();
					
					if(n == 1 && result){


					 var arg = {
								action:'personal_page',
								userid:userid,
								
								phone:phone,
								uaddress:uaddress,
								ucity:ucity,
								ustate:ustate,
								upin:upin,
								ucountry:ucountry,
								semester:semester,
								university:university,
								caddress:caddress,
								ccity:ccity,
								cpin:cpin,
								cstate:cstate,
								ccountry:ccountry,
							  }
							  
							  var rootPath = M.cfg.wwwroot;
							/*	$.ajax({
									url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
									type: "POST",
									data: arg,
									success: function(obj){
					
									},
									error: function(){
									}
								});		
							  
							  */
							  
								
					 return true;
					
					}else{

					 return true;
					}
					return true;
				}
				
				function educational_page(n){
					
					
					
					var degree=$("input[name=degree]").val();
					var branch=$("input[name=branch]").val();
					var semester=$("input[name=semester]").val();
					var college=$("input[name=college]").val();
					var university=$("input[name=university]").val();
					var caddress=$("#college-address").val();
					var ccity=$("input[name=ccity]").val();
					var cstate=$("select[name=cstate]").val();
					var cpin=$("input[name=cpin]").val();
					var ccountry=$("select[name=ccountry]").val();
					
					var upin=$("input[name=upin]").val();
					
					
					 var result=validateForm();
					
					 if(n == 1 && result){
					
					     var arg = {
										action:'educational_page',
										userid:userid,
										upin:upin,
										degree: degree,
										branch: branch,
										semester: semester,
										college:college,
										university: university,
										caddress: caddress,
										ccity: ccity,
										cstate:cstate,
										cpin: cpin,
										ccountry: ccountry,	
								   };
								
								
								var rootPath = M.cfg.wwwroot;
								$.ajax({
									url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
									type: "POST",
									data: arg,
									success: function(obj){
					
									},
									error: function(){
									}
								});		
					
					 return true;
					}else{

					 return false;
					}
				}	
				
			function skillset(){
				
				
				//get language data
				var programs = [];
				var programdata=[];
			    var count = $('#ratingtable-programming tr').length;
				
				for(var trow=2; trow <=count ; trow++){
					
				  programs.push($('#ratingtable-programming tr:nth-child('+trow+') td:nth-child(1)').html());		
				}

			 $.each( programs, function( key, value ) {
				 var newElement = {};
				 
				 newElement["language"+(key)]=value;
				  var value= value.replace(/\s/g,''); 
				 var ratingtheory = $('[data-start-selector="lang-theory'+value+'"] .checked').length;
				 newElement["theory"+(key)] = ratingtheory;
				 
				 var ratingpractice=  $('[data-start-selector="lang-practice'+value+'"] .checked').length;
				 newElement["practice"+(key)] = ratingpractice;
					
				 programdata.push(newElement); 
			  });
			  
				//get framework data
				
				var frameworks = [];
				var frameworkdata=[];
				var count = $('#ratingtable-framework tr').length;
				
				for(var trow=2; trow <=count ; trow++){
					
				  frameworks.push($('#ratingtable-framework tr:nth-child('+trow+') td:nth-child(1)').html());		
				}
				
				
				$.each( frameworks, function( key, value ) {
				 var newElement = {};
				 
				 newElement["frameork"+(key)]=value;
				  var value= value.replace(/\s/g,''); 
				 var ratingtheory = $('[data-start-selector="frame-theory'+value+'"] .checked').length;
				 newElement["theory"+(key)] = ratingtheory;
				 
				 var ratingpractice=  $('[data-start-selector="frame-practice'+value+'"] .checked').length;
				 newElement["practice"+(key)] = ratingpractice;
					
				 frameworkdata.push(newElement); 
			  });
				
				//get db data
				
				var db = [];
				var dbdata=[];
				var count = $('#ratingtable-db tr').length;
				
				for(var trow=2; trow <=count ; trow++){
					
				  db.push($('#ratingtable-db tr:nth-child('+trow+') td:nth-child(1)').html());		
				}
				
				$.each( db, function( key, value ) {
				 var newElement = {};
				 
				 newElement["database"+(key)]=value;
				  var value= value.replace(/\s/g,''); 
				 var ratingtheory = $('[data-start-selector="db-theory'+value+'"] .checked').length;
				 newElement["theory"+(key)] = ratingtheory;
				 
				 var ratingpractice=  $('[data-start-selector="db-practice'+value+'"] .checked').length;
				 newElement["practice"+(key)] = ratingpractice;
					
				 dbdata.push(newElement); 
			  });
				
				//get os data
				
				var os = [];
				var osdata=[];
				var count = $('#ratingtable-os tr').length;
			   
			    for(var trow=2; trow <=count ; trow++){
					
				  os.push($('#ratingtable-os tr:nth-child('+trow+') td:nth-child(1)').html());		
				}
				
				$.each( os, function( key, value ) {
				 var newElement = {};
				 
				 newElement["osys"+(key)]=value;
				  var value= value.replace(/\s/g,''); 
				 var ratingtheory = $('[data-start-selector="os-theory'+value+'"] .checked').length;
				 newElement["theory"+(key)] = ratingtheory;
				 
				 var ratingpractice=  $('[data-start-selector="os-practice'+value+'"] .checked').length;
				 newElement["practice"+(key)] = ratingpractice;
					
				 osdata.push(newElement); 
			  });
				
				//get tools data
				
				var tool = [];
				var tooldata=[];
			    var count = $('#ratingtable-tool tr').length;
				
				for(var trow=2; trow <=count ; trow++){
					
				  tool.push($('#ratingtable-tool tr:nth-child('+trow+') td:nth-child(1)').html());		
				}
				
				$.each( tool, function( key, value ) {
				 var newElement = {};
				 
				 newElement["tools"+(key)]=value;
				  var value= value.replace(/\s/g,''); 
				 var ratingtheory = $('[data-start-selector="tools-theory'+value+'"] .checked').length;
				 newElement["theory"+(key)] = ratingtheory;
				 
				 var ratingpractice=  $('[data-start-selector="tools-practice'+value+'"] .checked').length;
				 newElement["practice"+(key)] = ratingpractice;
					
				 tooldata.push(newElement); 
			  });
				
				 var arg = {
					action:'skillset',
					userid:userid,
					programming :JSON.stringify(programdata),
					framework : JSON.stringify(frameworkdata),
					database : JSON.stringify(dbdata),
					operatingsys : JSON.stringify(osdata),
					tools : JSON.stringify(tooldata),					
				  };

		var rootPath = M.cfg.wwwroot;
		$.ajax({
			url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
			type: "POST",
			data: arg,
			success: function(obj){
			},
			error: function(){
			}
		});	
				
				
				
				return true;
			}
			
			function certifications(){
				var i=1;
				var j=1;
                var count=document.getElementById("certification-resulttable").getElementsByTagName("tr").length;
			    var countone=document.getElementById("training-resulttable").getElementsByTagName("tr").length;
			   
			   var myAssociativeArr = [];
			   var myAssociativeArr2 = [];
			    
			   if(count){
				   
			    for(i=0; i<count; i++ ){
				    var newElement = {};
					
				    var value1=$(".certiname"+i).text();
				    var value2=$(".passscore"+i).text();
					var value3=$(".passgrade"+i).text();
				    var value4=$(".compltime"+i).text();
					var value5=$("#certi"+i).attr('value');			
					
					if(value5){
						newElement["id"+i]=value5;
					}
				   
                    newElement['name'+i] = value1;
                    newElement['passscore'+i] = value2;
					newElement['passgrade'+i] = value3;
                    newElement['compltime'+i] = value4;
                    myAssociativeArr.push(newElement);
			    }
			   }
			   
			   if(countone){
				   
				   for(j=0; j<countone; j++ ){
				    var newElement = {};
					
				    var value1=$(".tcertiname"+j).text();
				    var value2=$(".tpassscore"+j).text();
					var value3=$(".tpassgrade"+j).text();
				    var value4=$(".tcompltime"+j).text();
				     var value5=$("#train"+j).attr('value');			
					
					if(value5){
						newElement["id"+j]=value5;
					}
				   
                    newElement['tname'+j] = value1;
                    newElement['tpassscore'+j] = value2;
					newElement['tpassgrade'+j] = value3;
                    newElement['tcompltime'+j] = value4;
                    myAssociativeArr2.push(newElement);
			   }
				   
			   }

			   
			      var arg = {
					action:'certifications',
					userid:userid,
					certification :JSON.stringify(myAssociativeArr),
					training : JSON.stringify(myAssociativeArr2),										
				  };

				var rootPath = M.cfg.wwwroot;
				$.ajax({
					url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
					type: "POST",
					data: arg,
				success: function(obj){
				},
				error: function(){
				}
		});		
			   
			   
			   return true;
			   
			}
			function internship(){
				var i=0;
				var count=document.getElementById("Intern-resulttable").getElementsByTagName("tr").length;
				
				 var myAssociativeArr = [];
			   if(count){
			   for(i=1; i<count; i++ ){
				    var newElement = {};
					
				    var value1=$(".internname"+i).text();
				    var value2=$(".internins"+i).text();
				    var value3=$(".internskills"+i).text();
					var value4=$(".interncompletion"+i).text();
					var value5=$("#intern"+i).attr('value');			
					
					
					if(value5){
						newElement["id"+i]=value5;
					}
				   
                    newElement["internname"+i] = value1;
                    newElement["internins"+i] = value2;
                    newElement["internskills"+i] = value3;
					newElement["interncompletion"+i] = value4;
                    myAssociativeArr.push(newElement);
			   }
			      
			   var arg = {
							action:'internship',
							userid:userid,
							internship: JSON.stringify(myAssociativeArr),
						};
			   		   
						var rootPath = M.cfg.wwwroot;
								$.ajax({
									url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
									type: "POST",
									data: arg,
									success: function(obj){
										// do action
									},
									error: function(){
										// do action
									}
								});
			   
			   
			   } 
			   
			   	
	
	return true;
			}
				
			function accolades(){
				
				//var i=0;
				var count=document.getElementById("accolade-resulttable").getElementsByTagName("tr").length;
				
				 var myAssociativeArr = [];
			   if(count){
			   for(i=1; i<count; i++ ){
				    var newElement = {};
					
				    var value1=$(".acctitle"+i).text();
				    var value2=$(".accdesc"+i).text();
				    var value3=$(".accaccomplish"+i).text();
					
					var value4=$("#acco"+i).attr('value');			
					
					
					if(value4){
						newElement["id"+i]=value4;
					}
					
				   
                    newElement["acctitle"+i] = value1;
                    newElement["accdesc"+i] = value2;
                    newElement["accaccomplish"+i] = value3;
		
                    myAssociativeArr.push(newElement);
			   }
			   }

			    var arg = {
							action:'accolades',
							userid:userid,
							accolades: JSON.stringify(myAssociativeArr),
										
						};
			   
			   
						var rootPath = M.cfg.wwwroot;
								$.ajax({
									url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
									type: "POST",
									data: arg,
									success: function(obj){
										// do action
									},
									error: function(){
										// do action
									}
								});		


			   
      return true;
			}
				
			function community(){
				
				var valid=true;
				
				var i=0;
				var count=document.getElementById("communtity-resulttable").getElementsByTagName("tr").length;
				
				 var myAssociativeArr = [];
			   if(count){
			   for(i=1; i<count; i++ ){
				    var newElement = {};
					
				    var value1=$(".comtitle"+i).text();
				    var value2=$(".comurl"+i).text();
				    var value3=$(".complatform"+i).text();
					var value4=$(".com-skill"+i).text();
					var value5=$(".com-contri"+i).text();
					var value6=$(".com-event"+i).text();
					var value7=$("#com"+i).attr('value');			
					
					if(value7){
						newElement["id"+i]=value7;
					}
				  
				    
                    newElement["comtitle"+i] = value1;
                    newElement["comurl"+i] = value2;
                    newElement["complatform"+i] = value3;
					newElement["com-skill"+i] = value4;
					newElement["com-contri"+i] = value5;
					newElement["com-event"+i] = value6;
                    myAssociativeArr.push(newElement);
			   }
			   }
					
					
				var arg = {
							action:'community',
							userid:userid,
							community: JSON.stringify(myAssociativeArr),			
						};
			   
			   
						var rootPath = M.cfg.wwwroot;
							$.ajax({
								url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
								type: "POST",
								data: arg,
								success: function(obj){
										// do action
									//	 valid=true;
								},
								error: function(){
										// do action
									//	 valid=false;
								}
							});			
			return true;	

			}
			
			
			function chooselearningpath(){
				
				
				var selected_lp = $("input[name=learningpathid]:checked").val();
				
//				console.log(selected_lp);
				
				var arg = {
						action:'learningpath',
						userid:userid,	
						data:selected_lp
					};
		   
		   
					var rootPath = M.cfg.wwwroot;
						$.ajax({
							url: rootPath+"/blocks/profile_page/update_user_profile_ajax.php",
							type: "POST",
							data: arg,
							success: function(obj){
									// do action
								return true;
							},
							error: function(){
									// do action
								//	 valid=false;
								return false;
							}
						});
						
						return true;
				
			}
				
				
				
				
	        	
	        	setTimeout(function(){
					
					//triggers modal to display	        		
				//	$("#profile_page").modal('show');
				
					if(currentTab == 0){
				
						var x, y, z, i, valid = true;
						x = document.getElementsByClassName("tab");
						y =x[currentTab].getElementsByTagName("input");
						
						$(y).each(function(index, value){

							$userdate=$(this).attr('value');
							$class=$(this).attr('class');
						//	if($userdate.length  < 1){
						//		$('.'+$class).attr('readonly', false);
						//	}
						});
					}

	        	},500);
			
			} );
			
			
			
			$(document).ready(function() {
				
				var i;
		        var coll = document.getElementsByClassName("collapsible");

				   for (i = 0; i < coll.length; i++) {
						coll[i].addEventListener("click", function() {
							this.classList.toggle("active");
							var content = this.nextElementSibling;
								if (content.style.display === "block") {
									content.style.display = "none";
								} else {
									content.style.display = "block";
								}
						});
					}
		    });
			
			
			//function for toggle for all profile pages
			$(document).ready(function() {
				
				
				//script for accordian in skill set
			$(document).on("click",".accordionskillsetprofilepage",function(event){
				
				var id=$(this).attr('id');
				
				for( var i=1; i<=5; i++){
					
					var stringone="collapse"+i;
					
					if( stringone === id){
						$(".skillsetpanel"+i).css("display", "block");
					}else{
						$(".skillsetpanel"+i).css("display", "none");
					}
				}
				
				return false;
				
			});
				
			//script for accordian in certifications
			$(document).on("click",".accordioncertificationprofilepage",function(event){
				
				var id=$(this).attr('id');
				
				for( var i=1; i<=2; i++){
					
					var stringone="collapsecertiprofile"+i;
					
					if( stringone === id){
						$(".certificationpanelprofilepage"+i).css("display", "block");
					}else{
						$(".certificationpanelprofilepage"+i).css("display", "none");
					}
				}
				
				return false;
			});	
				
				
				
				
				
				$(document).on("click","#profile-lang",function() {

					var element1=document.getElementById('collapse1');
					var element2=document.getElementById('collapse2');
					var element3=document.getElementById('collapse3');
					var element4=document.getElementById('collapse4');
					var element5=document.getElementById('collapse5');
					var classname=element1.className;
	
					var search='show';
					var stringmatch = classname.includes(search);
					if (stringmatch){
						element1.classList.remove('show'); 	
					}else{
						element1.classList.add('show');
						element2.classList.remove('show');
						element3.classList.remove('show');
						element4.classList.remove('show');
						element5.classList.remove('show');
					}

				});
				$(document).on("click","#profile-frame",function() {

					var element1=document.getElementById('collapse1');
					var element2=document.getElementById('collapse2');
					var element3=document.getElementById('collapse3');
					var element4=document.getElementById('collapse4');
					var element5=document.getElementById('collapse5');
					var classname=element2.className;
	
					var search='show';
					var stringmatch = classname.includes(search);
					if (stringmatch){
						element2.classList.remove('show'); 	
					}else{
						element2.classList.add('show');
						element1.classList.remove('show');
						element3.classList.remove('show');
						element4.classList.remove('show');
						element5.classList.remove('show');
					}
					
				});
				$(document).on("click","#profile-db",function() {

					var element1=document.getElementById('collapse1');
					var element2=document.getElementById('collapse2');
					var element3=document.getElementById('collapse3');
					var element4=document.getElementById('collapse4');
					var element5=document.getElementById('collapse5');
					var classname=element3.className;
	
					var search='show';
					var stringmatch = classname.includes(search);
					if (stringmatch){
						element3.classList.remove('show'); 	
					}else{
						element3.classList.add('show');
						element1.classList.remove('show');
						element2.classList.remove('show');
						element4.classList.remove('show');
						element5.classList.remove('show');
					}
				});
				$(document).on("click","#profile-os",function() {

					var element1=document.getElementById('collapse1');
					var element2=document.getElementById('collapse2');
					var element3=document.getElementById('collapse3');
					var element4=document.getElementById('collapse4');
					var element5=document.getElementById('collapse5');
					var classname=element4.className;
	
					var search='show';
					var stringmatch = classname.includes(search);
					if (stringmatch){
						element4.classList.remove('show'); 	
					}else{
						element4.classList.add('show');
						element1.classList.remove('show');
						element2.classList.remove('show');
						element3.classList.remove('show');
						element5.classList.remove('show');
					}
				});
				$(document).on("click","#profile-tools",function() {

					var element1=document.getElementById('collapse1');
					var element2=document.getElementById('collapse2');
					var element3=document.getElementById('collapse3');
					var element4=document.getElementById('collapse4');
					var element5=document.getElementById('collapse5');
					var classname=element5.className;
	
					var search='show';
					var stringmatch = classname.includes(search);
					if (stringmatch){
						element5.classList.remove('show'); 	
					}else{
						element5.classList.add('show');
						element1.classList.remove('show');
						element2.classList.remove('show');
						element3.classList.remove('show');
						element4.classList.remove('show');
					}
				});
				$(document).on("click","#profile-certi",function() {

					var element1=document.getElementById('collapse6');
					var element2=document.getElementById('collapse7');
					var classname=element1.className;
	
					var search='show';
					var stringmatch = classname.includes(search);
					if (stringmatch){
						element1.classList.remove('show'); 	
					}else{
						element1.classList.add('show');
						element2.classList.remove('show');
					}
				});
				$(document).on("click","#profile-train",function() {
					var element1=document.getElementById('collapse6');
					var element2=document.getElementById('collapse7');
					var classname=element2.className;
	
					var search='show';
					var stringmatch = classname.includes(search);
					if (stringmatch){
						element2.classList.remove('show'); 	
					}else{
						element2.classList.add('show');
						element1.classList.remove('show');
					}
				});
				
				//key up function to fill empty field colour
				
						$("input").keyup(function(e){
  
							var valone=$(this).attr('id');
							$("#"+valone).removeClass("invalid");
							$("#errormessage1").text("");
							$("#errormessage2").text("");
							
						});
						
						$("textarea").keyup(function(e){
  
							var valone=$(this).attr('id');
							
							$("#"+valone).removeClass("invalid");
							$("#errormessage1").text("");
							$("#errormessage2").text("");
							
						});
						
						$("#userstate").change(function (e) {
							
							var valone=$(this).attr('id');
							$("#"+valone).removeClass("invalid");
							$('#errormessage1').text("");	
									
						});
						
						$("#collegestate").change(function (e) {
							
							var valone=$(this).attr('id');
							$("#"+valone).removeClass("invalid");
							$('#errormessage2').text("");	
									
						});
				
				
				
			
				
			 });
		}
	
	}

});
define('block_profile_page/newuipageone', ['jquery'], function($) {
	
	return {
		
		profilepageone: function() {
						
			$('document').ready(function(){							
				
				$(document).on("click","#student-semester",function(event){
					$("#graduatedYear").css("display","none");
					$("#studentsemester").css("display","initial");
				});	
				
				$(document).on("click","#graduated-year",function(event){
					$("#studentsemester").css("display","none");
					$("#graduatedYear").css("display","initial");										
				});	
				
				
				$("#nxtbtn").click(function(){
					var phoneno = /^\+?([0-9]{2})\)?[-. ]?([0-9]{4})[-. ]?([0-9]{4})$/;
					var phone = $("#profile-phone").val();

					if($("#profile-phone").val() == ''){
						//$("span", "#phone_validation").empty().remove();
						$("#phone_validation").append("<span id='profile-phone-msg' style=\"color:#fb6464;\">*Phone number is mandatory.</span>");
					} else if(!phone.match(phoneno)){
						//$("span", "#phone_validation").empty().remove();
						$("#phone_validation").append("<span id='profile-phone-msg' style=\"color:#fb6464;\">*Phone number should be a 10 digit and should not have characters.</span>");
					}
					
					if($("#useraddress").val() == ''){
						$("#address_validation").append("<span id='useraddress-msg' style=\"color:#fb6464;\">*Address is mandatory.</span>");
					}
					
					if($("#profile-city").val() == ''){
						$("#city_validation").append("<span id='profile-city-msg' style=\"color:#fb6464;\">*City is mandatory.</span>");
					}
					
				    var zipcodeValidate = /^[1-9][0-9]{5}$/;
				    var zipcode = $("#profile-pin").val();				    

					if($("#profile-pin").val() == ''){
						$("span", "#pin_validation").empty().remove();
						$("#pin_validation").append("<span id='profile-pin-msg' style=\"color:#fb6464;\">*Zip/Postal code is mandatory.</span>");
					} else if(!zipcode.match(zipcodeValidate)){
						$("span", "#pin_validation").empty().remove();
						$("#pin_validation").append("<span id='profile-pin-msg' style=\"color:#fb6464;\">*Zip/Postal should be a 6 digit number and should not have characters.</span>");
					}
					
					if($("#userstate option:selected").val() == ''){
						$("#state_validation").append("<span id='userstate-msg' style=\"color:#fb6464;\">*State is mandatory.</span>");
					}	
					
					if($("#profile-degree").val() == ''){
						$("#degree_validation").append("<span id='profile-degree-msg' style=\"color:#fb6464;\">*Degree is mandatory.</span>");
					}
					
					if($("#profile-branch").val() == ''){
						$("#branch_validation").append("<span id='profile-branch-msg' style=\"color:#fb6464;\">*Branch is mandatory.</span>");
					}																			
					
					if($("#student-semester").prop("checked")){
						if($("#semester").val() == ''){
							$("#student_validation").append("<span id='semester-msg' style=\"color:#fb6464;\">*Current Semester is mandatory.</span>");
						}
					}else if($("#graduated-year").prop("checked")){
						if($("#graduate").val() == ''){
							$("#graduate_validation").append("<span id='graduate-msg' style=\"color:#fb6464;\">*Graduated Year is mandatory.</span>");
						}
					}
					
					if($("#college-address").val() == ''){
						$("#clg_address_validation").append("<span id='college-address-msg' style=\"color:#fb6464;\">*College Address is mandatory.</span>");
					}
					
					if($("#profile-ccity").val() == ''){
						$("#clg_city_validation").append("<span id='profile-ccity-msg' style=\"color:#fb6464;\">*College City is mandatory.</span>");
					}
					
					var clg_zipcode = $("#profile-cpin").val();
					
					if($("#profile-cpin").val() == ''){
						$("span", "#clg_pin_validation").empty().remove();
						$("#clg_pin_validation").append("<span id='profile-cpin-msg' style=\"color:#fb6464;\">*College Zip/Postal code is mandatory.</span>");
					} else if(!clg_zipcode.match(zipcodeValidate)){
						$("span", "#clg_pin_validation").empty().remove();
						$("#clg_pin_validation").append("<span id='profile-cpin-msg' style=\"color:#fb6464;\">*College Zip/Postal should be a 6 digit number and should not have characters.</span>");
					}
					
					if($("#collegestate option:selected").val() == ''){
						$("#clg_state_validation").append("<span id='collegestate-msg' style=\"color:#fb6464;\">*College State is mandatory.</span>");
					}
					
				});
				
				
				
				$("input").keyup(function(e){
					var valone=$(this).attr('id');
					$("#"+valone+"-msg").remove();	
				});
				
				$("#collegestate").change(function() {	
					$("#collegestate-msg").remove();
				});
				
				$("#userstate").change(function() {	
					$("#userstate-msg").remove();
				});
				
				
			});
			
			
			
		
		
		
		
		}
	}
	
});
define('block_profile_page/adminprofile', ['jquery'], function($) {
	
	return {
		
		profile: function() {
			
			//script for navigation panel
			$(document).on("click",".profilenavlink",function(event){
				
				var id=$(this).attr('id');
				//console.log(id);	
				
				for( var i=1; i<=7; i++){
					
					var stringone="profile-tab"+i;
					
					if( stringone === id){
						
					var matchedid=stringone+"content";	
					$('#'+matchedid).addClass(" show active");
					
					}else{
						var unmatchedid=stringone+"content";	
						$('#'+unmatchedid).removeClass(" show active");	
					}	
				}	
			});
			
			//script for accordian in skill set
			$(document).on("click",".accordionskillset",function(event){
				
				var id=$(this).attr('id');
				
				for( var i=1; i<=5; i++){
					
					var stringone="collapse"+i;
					
					if( stringone === id){
						$(".programmingpanel"+i).css("display", "block");
					}else{
						$(".programmingpanel"+i).css("display", "none");
					}
				}
				
			});
			//script for accordian in certifications
			$(document).on("click",".accordioncertification",function(event){
				
				var id=$(this).attr('id');
				
				for( var i=1; i<=2; i++){
					
					var stringone="collapsecerti"+i;
					
					if( stringone === id){
						$(".certificationpanel"+i).css("display", "block");
					}else{
						$(".certificationpanel"+i).css("display", "none");
					}
				}
				
			});
			
			
			
			
			
			
			
		}
	}
});
define('block_profile_page/firstpage', ['jquery'], function($) {
	
	return {
		
		profilepageone: function() {
			
			
			$('document').ready(function(){
				
				console.log("am ready");

				  var currentTab = 0;
                  showTab(currentTab);
				
				function showTab(currentTab) {
						var x = document.getElementsByClassName("fab");
					    $(x[currentTab]).css('display','block');
				}
				
				$(document).on("click","#fsubmit",function() {
					
					var x = document.getElementsByClassName("fab");
					$(x[currentTab]).css('display','none');
					currentTab = currentTab + 1;
					//console.log("first one");
					showTab(currentTab);
				});
	
				$(document).on("click","#fprevious",function() {
					var x = document.getElementsByClassName("fab");
					$(x[currentTab]).css('display','none');
					currentTab = currentTab -1;
					
					showTab(currentTab);
				});
				
				
			});
		
		}
	}
	
});
define('block_randomize/script', ['jquery', 'core/ajax'], function($, ajax) {
    return {
        init: function(args) {

            var courseid = args.courseid;

            $(document).ready(function() {

                function addOption(optionValue) {

                    $('#statusselect').append(`<option value="${optionValue}">  ${optionValue} </option>`);
                }

                $('#changeStatus').click(function() {

                    var currentStatus = $('.collapse.show .tab-pane.fade.show.active').data("status");

                    if (typeof currentStatus === "undefined") {
                        $('#updatestatuscontent').addClass('hidden');
                        $('#messagelabel').html("<h5> Please select any one of the section to perform the action</h5>");
                        $('#messagelabel').removeClass('hidden');

                        $('#modalconfirm').prop('disabled', true);
                        $('#exampleModalCenter').modal('show');

                    } else {
                        $('#modalconfirm').prop('disabled', false);
                        $('#updatestatuscontent').removeClass('hidden');
                        $('#messagelabel').addClass('hidden');

                        var allStatus = ['Draft', 'New', 'Active', 'Retired', 'Suspended'];

                        // switch (currentStatus) {
                        //     case 'Draft':
                        //         allStatus = ['New', 'Suspended', 'Active'];
                        //         break;
                        //     case 'New':
                        //         allStatus = ['Active', 'Suspended'];
                        //         break;
                        //     case 'Active':
                        //         allStatus = ['Retired', 'Suspended'];
                        //         break;
                        //     case 'Retired':
                        //         allStatus = ['New', 'Active', 'Suspended'];
                        //         break;
                        //     case 'Suspended':
                        //         allStatus = ['New', 'Active', 'Retired'];
                        //         break;
                        // }

                        // Set the current status in modal
                        $('#currentstatus').html(currentStatus);

                        // Empty previous select options and add the new options
                        $('#statusselect').empty();
                        for (i = 0; i < allStatus.length; ++i) {
                            if (currentStatus != allStatus[i]) {
                                addOption(allStatus[i]);
                            }
                        }

                        var arr = [];
                        $(".collapse.show .tab-pane.fade.show.active > table input:checkbox[name=check]:checked").each(function() {
                            arr.push($(this).val());
                        });

                        if (arr.length === 0) {
                            $('#updatestatuscontent').addClass('hidden');
                            $('#messagelabel').html("<h5> Please select atleast one activity to update the status</h5>");
                            $('#messagelabel').removeClass('hidden');
                            $('#modalconfirm').prop('disabled', true);
                        } else {
                            $('#updatestatuscontent').removeClass('hidden');
                            $('#messagelabel').addClass('hidden');
                            $('#modalconfirm').prop('disabled', false);
                        }
                        $('#exampleModalCenter').modal('show');
                    }
                });

                $('#modalconfirm').click(function() {

                    // Take all the selected data from that current dropdown
                    var arr = [];
                    $(".collapse.show .tab-pane.fade.show.active > table input:checkbox[name=check]:checked").each(function() {
                        arr.push($(this).val());
                    });

                    var status = $('#statusselect').val();
                    var currentStatus = $('.collapse.show .tab-pane.fade.show.active').data("status");
                    var reason = $("textarea[name=updatestatustext]").val();
                    var activityList = JSON.stringify(arr);

                    // Update status service call
                    var promises = ajax.call([{
                        methodname: 'block_randomize_updatestatus',
                        args: { 'activitylist': activityList, 'status': status, 'currentstatus': currentStatus, 'courseid': courseid, 'reason': reason }
                    }, ]);

                    promises[0].done(function(response) {
                        //console.log("success");
                        location.reload();
                    }).fail(function(ex) {
                        console.log(ex);
                    });
                });

            });

        },
        status: function() {
            $('#learningpathdropdown').change(function() {
                $('#activitytypedropdown').val('');
                $('#coursedropdown').val('');
            });

            $('#activitytypedropdown').change(function() {
                var learningpathid = $('#learningpathdropdown').val();
                var activitydata = $('#activitytypedropdown').val();

                if (learningpathid && activitydata) {
                    $.post(M.cfg.wwwroot + "/blocks/randomize/ajax.php?action=coursestatus&learningpathid=" + learningpathid + "&activitydata=" + activitydata)
                        .done(function(result) {
                            $('#coursedropdown').val('');
                            $('#coursedropdown .courseoption').remove();
                            const parseddata = JSON.parse(result);
                            $.each(parseddata, function(key, value) {
                                $('#coursedropdown')
                                    .append($("<option></option>")
                                        .attr("value", value.courseid)
                                        .text(value.coursename)
                                        .addClass("courseoption"));
                            });
                        });
                } else {
                    alert("Please select learningpath.");
                    $('#activitytypedropdown').val('');
                }
            });

            $('#search').click(function() {
                var activitydata = $('#activitytypedropdown').val();
                var courseid = $('#coursedropdown').val();
                var startdate = 0;
                var enddate = 0;
                if ($('#show_additional').prop('checked')) {
                    var year = $('#year').val().trim();
                    var month = $('#month').val();
                    var phase = $('#phase').val();
                    if (phase == 1) {
                        startdate = year + '-' + month + '-01';
                        enddate = year + '-' + month + '-15';
                    } else if (phase == 2) {
                        startdate = year + '-' + month + '-16';
                        if (month == '01' || month == '03' || month == '05' || month == '07' || month == '08' || month == '10' || month == '12') {
                            enddate = year + '-' + month + '-31';
                        } else if (month == '04' || month == '06' || month == '09' || month == '11') {
                            enddate = year + '-' + month + '-30';
                        } else if (month == '02') {
                            if (year % 4 == 0) {
                                enddate = year + '-' + month + '-29';
                            } else {
                                enddate = year + '-' + month + '-28';
                            }
                        }
                    }
                }
                var learningpathid = $('#learningpathdropdown').val();
                $.post(M.cfg.wwwroot + "/blocks/randomize/ajax.php?action=activitystatus&learningpathid=" + learningpathid + "&courseid=" + courseid + "&activitydata=" + activitydata + "&startdate=" + startdate + "&enddate=" + enddate)
                    .done(function(result) {
                        activitytable.clear();
                        const parseddata = JSON.parse(result);
                        if (parseddata[0]) {
                            $.each(parseddata, function(key, value) {

                                activitytable.row.add([
                                    value.serialno,
                                    value.lpname,
                                    value.aname,
                                    value.lpstatus,
									value.tag,
                                    value.attempt,
                                    value.attended,
                                    value.completed,
                                    value.successrate,
									value.lpattended,
                                    value.lpcompleted,
                                    value.lpsuccessrate,
                                    value.timecreated,
                                    value.timemodified
                                ]).draw(false);
                            });
                        } else {
                            activitytable.context[0].oLanguage.sEmptyTable = parseddata['noresult'];
                            activitytable.clear().draw();
                        }
                    });
            });

            $('#show_additional').change(function() {
                if (this.checked) {
                    $(".additional").show();
                    $("#search").attr("disabled", true);
                } else {
                    $(".additional").hide();
                    $('.date').val('');
                    // $('#month').val('');
                    // $('#phase').val('');
                    if ($('#coursedropdown').val()) {
                        $("#search").removeAttr("disabled");
                    }
                }
            });

			$("#exceldownload").click(function () {	
				var $date = $("#created_date").val();		
				var urltogo = M.cfg.wwwroot+'/blocks/randomize/qbdata.php?date='+$date;
    			window.location.replace(urltogo);	
			});

            $('#coursedropdown, .date').change(function() {
                if ($('#show_additional').prop('checked')) {
                    flag = 0;
                    const ids = document.querySelectorAll('.date');
                    ids.forEach((id) => {
                        if (!($(id).val())) {
                            flag = 1;
                        }
                    });
                    if ($('#coursedropdown').val() && flag != 1) {
                        $("#search").removeAttr("disabled");
                    } else {
                        $("#search").attr("disabled", true);
                    }
                } else {
                    $("#search").removeAttr("disabled");
                }
            });

            $('.custom-select').change(function() {
                $(".resetDate").removeAttr("disabled");
            });

            $('.resetDate').click(function() {
                $("#search").attr("disabled", true);
                $(".resetDate").attr("disabled", true);
                $('.custom-select').val('');
                $(".additional").hide();
                $("#show_additional").prop("checked", false);
                activitytable.clear().draw();
            });
        }
    };
});
define('block_recentlyaccessedcourses/main', ["jquery","core_course/repository","core/templates","core/notification","core/pubsub","core_course/events"],function(a,b,c,d,e,f){var g={COURSES_VIEW:'[data-region="recentlyaccessedcourses-view"]',COURSES_VIEW_CONTENT:'[data-region="recentlyaccessedcourses-view-content"]'},h=10,i=function(a,c){return b.getLastAccessedCourses(a,c)},j=function(a,b){if(b.length>0)return c.render("block_recentlyaccessedcourses/view-cards",{courses:b});var d=a.attr("data-nocoursesimgurl");return c.render("block_recentlyaccessedcourses/no-courses",{nocoursesimgurl:d})},k=function(a,b){var e=b.find(g.COURSES_VIEW),f=b.find(g.COURSES_VIEW_CONTENT),k=i(a,h);return k.then(function(a){var b=j(e,a);return b.then(function(a,b){return c.replaceNodeContents(f,a,b)})["catch"](d.exception),k})["catch"](d.exception)},l=function(a,b){e.subscribe(f.favourited,function(){k(a,b)}),e.subscribe(f.unfavorited,function(){k(a,b)})},m=function(b,c){c=a(c),l(b,c),k(b,c)};return{init:m}});
define('block_recentlyaccesseditems/repository', ["core/ajax"],function(a){var b=function(b){var c={};"undefined"!=typeof b&&(c.limit=b);var d={methodname:"block_recentlyaccesseditems_get_recent_items",args:c};return a.call([d])[0]};return{getRecentItems:b}});
define('block_recentlyaccesseditems/main', ["jquery","block_recentlyaccesseditems/repository","core/templates","core/notification"],function(a,b,c,d){var e=9,f={CARDDECK_CONTAINER:'[data-region="recentlyaccesseditems-view"]',CARDDECK:'[data-region="recentlyaccesseditems-view-content"]'},g=function(a){return b.getRecentItems(a)},h=function(a,b){if(b.length>0)return c.render("block_recentlyaccesseditems/view-cards",{items:b});var d=a.attr("data-noitemsimgurl");return c.render("block_recentlyaccesseditems/no-items",{noitemsimgurl:d})},i=function(b){b=a(b);var i=b.find(f.CARDDECK_CONTAINER),j=b.find(f.CARDDECK),k=g(e);k.then(function(a){var b=h(i,a);return b.then(function(a,b){return c.replaceNodeContents(j,a,b)})["catch"](d.exception),k})["catch"](d.exception)};return{init:i}});
define('block_settings/settingsblock', ["jquery","core/tree"],function(a,b){return{init:function(a,c){var d=new b(".block_settings .block_tree");if(c){var e=d.treeRoot.find("#"+c),f=e.children("a").first();f.replaceWith('<span tabindex="0">'+f.html()+"</span>")}d.finishExpandingGroup=function(c){b.prototype.finishExpandingGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})},d.collapseGroup=function(c){b.prototype.collapseGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})}}}});
define('block_starredcourses/repository', ["jquery","core/ajax","core/notification"],function(a,b,c){var d=function(a){var d={methodname:"block_starredcourses_get_starred_courses",args:a},e=b.call([d])[0];return e.fail(c.exception),e};return{getStarredCourses:d}});
define('block_starredcourses/main', ["jquery","core/notification","block_starredcourses/repository","core/pubsub","core/templates","core_course/events"],function(a,b,c,d,e,f){var g={STARRED_COURSES_REGION_VIEW:'[data-region="starred-courses-view"]',STARRED_COURSES_REGION:'[data-region="starred-courses-view-content"]'},h=function(a,b){if(b.length>0)return e.render("block_starredcourses/view-cards",{courses:b});var c=a.find(g.STARRED_COURSES_REGION_VIEW).attr("data-nocoursesimg");return e.render("block_starredcourses/no-courses",{nocoursesimg:c})},i=function(a){var d=a.find(g.STARRED_COURSES_REGION),f={limit:0,offset:0};return c.getStarredCourses(f).then(function(b){return h(a,b)}).then(function(a,b){return e.replaceNodeContents(d,a,b)})["catch"](b.exception)},j=function(a){d.subscribe(f.favourited,function(){i(a)}),d.subscribe(f.unfavorited,function(){i(a)})},k=function(b){b=a(b),j(b),i(b)};return{init:k}});
define('block_timeline/view_nav', ["jquery","core/custom_interaction_events","block_timeline/view","core/ajax","core/notification"],function(a,b,c,d,e){var f={TIMELINE_DAY_FILTER:'[data-region="day-filter"]',TIMELINE_DAY_FILTER_OPTION:"[data-from]",TIMELINE_VIEW_SELECTOR:'[data-region="view-selector"]',DATA_DAYS_OFFSET:"[data-days-offset]",DATA_DAYS_LIMIT:"[data-days-limit]"},g=function(a,b){var c={methodname:"core_user_update_user_preferences",args:{preferences:[{type:a,value:b}]}};d.call([c])[0].fail(e.exception)},h=function(d,e){var h=d.find(f.TIMELINE_DAY_FILTER);b.define(h,[b.events.activate]),h.on(b.events.activate,f.TIMELINE_DAY_FILTER_OPTION,function(b,h){var i=a(b.currentTarget).data("filtername"),j="block_timeline_user_filter_preference";g(j,i);var k=a(b.target).closest(f.TIMELINE_DAY_FILTER_OPTION);if(!k.hasClass("active")){var l=k.attr("data-from"),m=k.attr("data-to"),n=d.find(f.DATA_DAYS_OFFSET);n.attr("data-days-offset",l),void 0!=m?n.attr("data-days-limit",m):n.removeAttr("data-days-limit"),c.reset(e),h.originalEvent.preventDefault()}})},i=function(d,e){var h=d.find(f.TIMELINE_VIEW_SELECTOR);h.on("shown shown.bs.tab",function(){c.shown(e)}),b.define(h,[b.events.activate]),h.on(b.events.activate,"[data-toggle='tab']",function(b){var c=a(b.currentTarget).data("filtername"),d="block_timeline_user_sort_preference";g(d,c)})},j=function(b,c){b=a(b),h(b,c),i(b,c)};return{init:j}});
define('block_timeline/calendar_events_repository', ["jquery","core/ajax","core/notification"],function(a,b,c){var d=20,e=function(a){a.hasOwnProperty("limit")||(a.limit=d),a.limitnum=a.limit,delete a.limit,a.hasOwnProperty("starttime")&&(a.timesortfrom=a.starttime,delete a.starttime),a.hasOwnProperty("endtime")&&(a.timesortto=a.endtime,delete a.endtime);var e={methodname:"core_calendar_get_action_events_by_course",args:a},f=b.call([e])[0];return f.fail(c.exception),f},f=function(a){a.hasOwnProperty("limit")||(a.limit=10),a.limitnum=a.limit,delete a.limit,a.hasOwnProperty("starttime")&&(a.timesortfrom=a.starttime,delete a.starttime),a.hasOwnProperty("endtime")&&(a.timesortto=a.endtime,delete a.endtime);var d={methodname:"core_calendar_get_action_events_by_courses",args:a},e=b.call([d])[0];return e.fail(c.exception),e},g=function(a){a.hasOwnProperty("limit")||(a.limit=d),a.limitnum=a.limit,delete a.limit,a.hasOwnProperty("starttime")&&(a.timesortfrom=a.starttime,delete a.starttime),a.hasOwnProperty("endtime")&&(a.timesortto=a.endtime,delete a.endtime),a.limittononsuspendedevents=!0;var e={methodname:"core_calendar_get_action_events_by_timesort",args:a},f=b.call([e])[0];return f.fail(c.exception),f};return{queryByTime:g,queryByCourse:e,queryByCourses:f}});
define('block_timeline/view', ["jquery","block_timeline/view_dates","block_timeline/view_courses"],function(a,b,c){var d={TIMELINE_DATES_VIEW:'[data-region="view-dates"]',TIMELINE_COURSES_VIEW:'[data-region="view-courses"]'},e=function(e){e=a(e);var f=e.find(d.TIMELINE_DATES_VIEW),g=e.find(d.TIMELINE_COURSES_VIEW);b.init(f),c.init(g)},f=function(a){var e=a.find(d.TIMELINE_DATES_VIEW),f=a.find(d.TIMELINE_COURSES_VIEW);b.reset(e),c.reset(f)},g=function(a){var e=a.find(d.TIMELINE_DATES_VIEW),f=a.find(d.TIMELINE_COURSES_VIEW);e.hasClass("active")?b.shown(e):c.shown(f)};return{init:e,reset:f,shown:g}});
define('block_timeline/view_courses', ["jquery","core/notification","core/custom_interaction_events","core/str","core/templates","block_timeline/event_list","core_course/repository","block_timeline/calendar_events_repository"],function(a,b,c,d,e,f,g,h){var i={MORE_COURSES_BUTTON:'[data-action="more-courses"]',MORE_COURSES_BUTTON_CONTAINER:'[data-region="more-courses-button-container"]',NO_COURSES_EMPTY_MESSAGE:'[data-region="no-courses-empty-message"]',COURSES_LIST:'[data-region="courses-list"]',COURSE_ITEMS_LOADING_PLACEHOLDER:'[data-region="course-items-loading-placeholder"]',COURSE_EVENTS_CONTAINER:'[data-region="course-events-container"]',COURSE_NAME:'[data-region="course-name"]',LOADING_ICON:".loading-icon"},j={COURSE_ITEMS:"block_timeline/course-items",LOADING_ICON:"core/loading"},k="inprogress",l="fullname asc",m=5,n=2,o=86400,p=function(a){a.find(i.COURSE_ITEMS_LOADING_PLACEHOLDER).addClass("hidden")},q=function(a){a.find(i.MORE_COURSES_BUTTON_CONTAINER).addClass("hidden")},r=function(a){a.find(i.MORE_COURSES_BUTTON_CONTAINER).removeClass("hidden")},s=function(a){var b=a.find(i.MORE_COURSES_BUTTON);b.prop("disabled",!0),e.render(j.LOADING_ICON,{}).then(function(a){return b.append(a),a})["catch"](function(){return!1})},t=function(a){var b=a.find(i.MORE_COURSES_BUTTON);b.prop("disabled",!1),b.find(i.LOADING_ICON).remove()},u=function(a){a.find(i.NO_COURSES_EMPTY_MESSAGE).removeClass("hidden")},v=function(a,b){var c=a.find(i.COURSES_LIST);e.appendNodeContents(c,b,"")},w=function(a){return a.find(i.COURSE_EVENTS_CONTAINER).length>0},x=function(a){return parseInt(a.attr("data-offset"),10)},y=function(a,b){a.attr("data-offset",b)},z=function(a){return parseInt(a.attr("data-limit"),10)},A=function(a){return parseInt(a.attr("data-days-offset"),10)},B=function(a){var b=a.attr("data-days-limit");return void 0!=b?parseInt(b,10):void 0},C=function(a){return parseInt(a.attr("data-midnight"),10)},D=function(a){var b=C(a),c=A(a);return b+c*o},E=function(a){var b=C(a),c=B(a);return void 0!=c&&b+c*o},F=function(a,b,c,d){var e={courseids:a,starttime:b,limit:c};return d&&(e.endtime=d),h.queryByCourses(e)},G=function(a){return a.data("last-event-load-time")},H=function(a,b){a.data("last-event-load-time",b)},I=function(a,b){return G(a)>b},J=function(a,b,c){var d=a.map(function(a){return a.id});return F(d,b,m+1,c)},K=function(a,b,c,d,f,g){return e.render(j.COURSE_ITEMS,{courses:a,midnight:c,hasdaysoffset:!0,hasdayslimit:void 0!=f,daysoffset:d,dayslimit:f,nodayslimit:void 0==f,urls:{noevents:g}}).then(function(a){return p(b),a?v(b,a):w(b)||u(b),a}).then(function(c){return a.length<n?q(b):r(b),c})["catch"](function(){p(b)})},L=function(c){var e=x(c),h=z(c);return g.getEnrolledCoursesByTimelineClassification(k,h,e,l).then(function(b){var e=Date.now(),g=b.courses,h=b.nextoffset,i=A(c),j=B(c),k=C(c),l=D(c),n=E(c),o=c.attr("data-no-events-url");y(c,h);var p=J(g,l,n),q=K(g,c,k,i,j,o);return a.when(p,q).then(function(b){return I(c,e)?b:(g.forEach(function(e){var g=e.id,h=[],i='[data-region="course-events-container"][data-course-id="'+g+'"]',j=c.find(i),k=j.find(f.rootSelector),l=b.groupedbycourse.filter(function(a){return a.courseid==g});l.length&&(h=l[0].events);var n=a.Deferred().resolve({events:h}).promise();d.get_string("ariaeventlistpaginationnavcourses","block_timeline",e.fullnamedisplay).then(function(a){return f.init(k,m,{1:n},a),a})["catch"](function(){f.init(k,m,{1:n})})}),b)})})["catch"](b.exception)},M=function(c){var e=Date.now(),g=D(c),h=E(c),j=c.find(i.COURSE_EVENTS_CONTAINER),k=j.map(function(){return a(this).attr("data-course-id")}).get();return H(c,e),F(k,g,m+1,h).then(function(b){return I(c,e)?b:(j.each(function(c,e){e=a(e);var g=e.attr("data-course-id"),h=e.find(i.COURSE_NAME).text(),j=e.find(f.rootSelector),k=a.Deferred(),l=[],n=b.groupedbycourse.filter(function(a){return a.courseid==g});n.length&&(l=n[0].events),k.resolve({events:l}),d.get_string("ariaeventlistpaginationnavcourses","block_timeline",h).then(function(a){return f.init(j,m,{1:k.promise()},a),a})["catch"](function(){f.init(j,m,{1:k.promise()})})}),b)})["catch"](b.exception)},N=function(a){c.define(a,[c.events.activate]),a.on(c.events.activate,i.MORE_COURSES_BUTTON,function(b,c){s(a),L(a).then(function(){t(a)})["catch"](function(){t(a)}),c&&(c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()),b.stopPropagation()})},O=function(b){b=a(b),H(b,Date.now()),b.hasClass("active")&&(L(b),b.attr("data-seen",!0)),N(b)},P=function(a){a.removeAttr("data-seen"),a.hasClass("active")&&Q(a)},Q=function(a){a.attr("data-seen")||(w(a)?M(a):L(a),a.attr("data-seen",!0))};return{init:O,reset:P,shown:Q}});
define('block_timeline/event_list', ["jquery","core/notification","core/templates","core/paged_content_factory","core/str","core/user_date","block_timeline/calendar_events_repository"],function(a,b,c,d,e,f,g){var h=86400,i={EMPTY_MESSAGE:'[data-region="empty-message"]',ROOT:'[data-region="event-list-container"]',EVENT_LIST_CONTENT:'[data-region="event-list-content"]',EVENT_LIST_LOADING_PLACEHOLDER:'[data-region="event-list-loading-placeholder"]'},j={EVENT_LIST_CONTENT:"block_timeline/event-list-content"},k={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,ariaLabels:{itemsperpagecomponents:"ariaeventlistpagelimit, block_timeline"}},l=function(a){a.find(i.EVENT_LIST_CONTENT).addClass("hidden"),a.find(i.EMPTY_MESSAGE).removeClass("hidden")},m=function(a){a.find(i.EVENT_LIST_CONTENT).removeClass("hidden"),a.find(i.EMPTY_MESSAGE).addClass("hidden")},n=function(a){a.find(i.EVENT_LIST_CONTENT).empty()},o=function(a,b){var c={},d={eventsbyday:[]};return a.forEach(function(a){var d=f.getUserMidnightForTimestamp(a.timesort,b);c[d]?c[d].push(a):c[d]=[a]}),Object.keys(c).forEach(function(a){var e=c[a];d.eventsbyday.push({past:a<b,dayTimestamp:a,events:e})}),d},p=function(a,b){var d=o(a,b),e=j.EVENT_LIST_CONTENT;return c.render(e,d)},q=function(a,b,c,d,e,f){var i=a+c*h,j=void 0!=d&&a+d*h,k={starttime:i,limit:b};return e&&(k.aftereventid=e),j&&(k.endtime=j),f?(k.courseid=f,g.queryByCourse(k)):g.queryByTime(k)},r=function(a,b,c,d,e,f,g,h){for(var i=a.pageNumber,j=a.limit,k=i;!d.hasOwnProperty(k);)k--;var l=d[k],m=null;return m=e&&e.hasOwnProperty(i)?e[i]:q(c,j+1,g,h,l,f),m.then(function(a){if(!a.events.length)return b.allItemsLoaded(i),[];var c=a.events.filter(function(a){return"open"!=a.eventtype&&"opensubmission"!=a.eventtype}),d=c.length<=j;return d?b.allItemsLoaded(i):c.pop(),c})},s=function(c,f,g,h,i,j,l,m,n){var o={1:0},q=!1,s=a.extend({},k,n);return e.get_string("ariaeventlistpagelimit","block_timeline",a.isArray(c)?c[0].value:c).then(function(a){return s.ariaLabels.itemsperpage=a,s.ariaLabels.paginationnav=m,a}).then(function(){return d.createWithLimit(c,function(c,d){var e=[];return c.forEach(function(a){var c=a.pageNumber,h=r(a,d,g,o,f,i,j,l).then(function(a){if(a.length){q=!0;var b=a[a.length-1].id;return o[c+1]=b,p(a,g)}return a})["catch"](b.exception);e.push(h)}),a.when.apply(a,e).then(function(){h.resolve(q)})["catch"](function(){h.resolve(q)}),e},s)})},t=function(d,e,f,g,h){d=a(d);var j=a.Deferred(),k=d.find(i.EVENT_LIST_CONTENT),o=d.find(i.EVENT_LIST_LOADING_PLACEHOLDER),p=d.attr("data-course-id"),q=parseInt(d.attr("data-days-offset"),10),r=d.attr("data-days-limit"),t=parseInt(d.attr("data-midnight"),10);return n(d),m(d),o.removeClass("hidden"),void 0!=r&&(r=parseInt(r,10)),s(e,f,t,j,p,q,r,g,h).then(function(b,e){return b=a(b),b.addClass("hidden"),c.replaceNodeContents(k,b,e),j.then(function(a){return b.removeClass("hidden"),o.addClass("hidden"),a||l(d),a})["catch"](function(){return!1}),b})["catch"](b.exception)};return{init:t,rootSelector:i.ROOT}});
define('block_timeline/view_dates', ["jquery","core/str","block_timeline/event_list","core/pubsub","core/paged_content_events"],function(a,b,c,d,e){var f={EVENT_LIST_CONTAINER:'[data-region="event-list-container"]'},g=[5,10,25],h=function(a){var b=parseInt(a.data("limit"),10),c=!1,d=g.map(function(a){return b==a&&(c=!0),{value:a,active:b==a}});return c||(d[0].active=!0),d},i=function(b,c){var f=c+e.SET_ITEMS_PER_PAGE_LIMIT;d.subscribe(f,function(c){a(b).data("limit",c)})},j=function(d){var e=d.find(f.EVENT_LIST_CONTAINER),g=a(e).attr("id")+"user_block_timeline"+Math.random();i(d,g);var j=h(d),k={persistentLimitKey:"block_timeline_user_limit_preference",eventNamespace:g};b.get_string("ariaeventlistpaginationnavdates","block_timeline").then(function(a){return c.init(e,j,{},a,k),a})["catch"](function(){c.init(e,j,{},"",k)})},k=function(b){b=a(b),b.hasClass("active")&&(j(b),b.data("seen",!0))},l=function(a){a.removeAttr("data-seen"),a.hasClass("active")&&(j(a),a.data("seen",!0))},m=function(a){a.data("seen")||(j(a),a.data("seen",!0))};return{init:k,reset:l,shown:m}});
define('block_timeline/main', ["jquery","block_timeline/view_nav","block_timeline/view"],function(a,b,c){var d={TIMELINE_VIEW:'[data-region="timeline-view"]'},e=function(e){e=a(e);var f=e.find(d.TIMELINE_VIEW);b.init(e,f),c.init(f)};return{init:e}});
define('block_video_interview/support', ['jquery'], function($) {
	
	return {
		init: function(intarg) {

			CONFIG = intarg;
			if(CONFIG){
				var feedbacksubmitted = CONFIG.feedbacksubmitted;
	}
	
			
			var url=  $(location).attr('href');
			var rootPath = M.cfg.wwwroot;

			$( document ).ready(function() {


				if (window.location.href.indexOf("blocks/video_interview/add.php") > -1) {
					var seturl=window.location.href;
					var urlp = new URL(seturl);
var key = urlp.searchParams.get("key");
if(key!=''){
	$.post(M.cfg.wwwroot + "/blocks/video_interview/ajax.php", {
		action: 'editinterview',
		meetingid:key,
	}).done (function(data, textStatus, jqXHR) { 
		if(data['inter'].length > 0){
var interarry=data['inter'];
var arrayLength = interarry.length;
var finalsp='';
for (var i = 0; i < arrayLength; i++) {
	var span_text='';
if(finalsp==''){
				finalsp=finalsp+interarry[i];
			}
			else{
				finalsp=finalsp+','+interarry[i];
			}
}
		$('input[name="intertext"]').val(finalsp);


		}
		if(data['parts']!=''){
			$('input[name="partstext"]').val(data['parts']);
		}

		
	 })
	 .fail (function(jqXHR, textStatus, errorThrown) { 
		 alert('fail');
	 })
}
					
					}
					

				$(function() {
					var lastTab = localStorage.getItem('lastTab');
					$('.container, .tab-content').removeClass('hidden');
					if (lastTab) {
					  $('[data-target="' + lastTab + '"]').tab('show');
					}
					$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
					  localStorage.setItem('lastTab', $(this).data('target'));
					});
				  });
				  
				  $(function(){
					var dtToday = new Date();
					
					var month = dtToday.getMonth() + 1;
					var day = dtToday.getDate();
					var year = dtToday.getFullYear();
					if(month < 10)
						month = '0' + month.toString();
					if(day < 10)
						day = '0' + day.toString();
					
					var maxDate = year + '-' + month + '-' + day;
				
					// or instead:
					// var maxDate = dtToday.toISOString().substr(0, 10);
				
					$('#datereq').attr('min', maxDate);
				});


if(feedbacksubmitted && feedbacksubmitted ==1){
					setTimeout(function(){ $("#nav-profile-tab").click(); }, 10);
			}
				
			setInterval(function(){ 

				$(".fbody tr").each(function() {
					var row = $(this);
					if(row.find("td[id='bdate']")){
					var date =row.find("td[id='bdate']").text();
					var res = date.split("#");
					//alert( from+'---'+to+'----'+ date );
					//show all rows by default
					var start=res[0];
					var end = res[1];
					var show = false;
					var today = new Date();
					dt= today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate()+' '+ today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();
            ''
					
					//if from date is valid and row date is less than from date, hide the row
					if ((start < dt) && (end > dt)){
					  show = true;
					}
					
				
					  
					if(show){
						row.find("#blinksvg").css('display','block');
					}
					
				}
				  
				  });

			 }, 1000);

			

			});
		
			
			$("#advsearch").click(function(){
				var textval= $('input#inputsearch').val();
				var field='';
				if($("input:radio[class='ass']").is(":checked")) {
					field='idnumber';
				 }
				 if($("input:radio[class='ema']").is(":checked")) {
					field='email';
				 }
				 if($("input:radio[class='nam']").is(":checked")) {
					field='name';
				 }
				$.post(M.cfg.wwwroot + "/blocks/video_interview/ajax.php", {
					action: 'advancesearch',
					textsearch:textval,
					textfield:field,
					
	
				}).done (function(data, textStatus, jqXHR) { 
					console.log(data);
					var table_body='';
                    $(".userbody").empty();
					$.each(data, function(i, item) {
						console.log(item);
                        var res = item.email.split("@");
						var resfinal=res[0].replace(/[^0-9a-zA-Z]/g,"");
                        var onclk="'"+resfinal+"'";
                        var oncl2="'"+item.email+"'";
                        
						 table_body+='<tr class="clickrow" onclick="clickr('+onclk+','+oncl2+')" id="'+resfinal+'"'+' value="'+item.email+'"'+'>';
						
							   table_body +='<td>'+item.username+'</td>';
							 table_body +='<td>'+item.firstname+'</td>';
							 table_body +='<td>'+item.lastname+'</td>';
							 table_body +='<td>'+item.email+'</td>';
						table_body+='</tr>';
						
						});
						if(table_body!=''){
							$("#tablesrch tbody").append(table_body);

						}
                        else{
                            table_body +='<tr class="no-records">';
                            table_body +='<td colspan="4" style="color:red;text-align: center; vertical-align: middle;">No records found</td></tr>';
                            $("#tablesrch tbody").append(table_body);

                        }
					
				 })
				 .fail (function(jqXHR, textStatus, errorThrown) { 
					 
				 })
			
				});
				
			$("#advpartsearch").click(function(){
				var textval= $('input#inputpartsearch').val();
				var field='';
				if($("input:radio[class='partsass']").is(":checked")) {
					field='idnumber';
				 }
				 if($("input:radio[class='partsema']").is(":checked")) {
					field='email';
				 }
				 if($("input:radio[class='partsnam']").is(":checked")) {
					field='name';
				 }
				$.post(M.cfg.wwwroot + "/blocks/video_interview/ajax.php", {
					action: 'advancepartssearch',
					textsearch:textval,
					textfield:field,
					
	
				}).done (function(data, textStatus, jqXHR) { 
					console.log(data);
					var table_body='';
                    $(".userpartbody").empty();
					$.each(data, function(i, item) {
						console.log(item);
						var res = item.email.split("@");
						var resfinal=res[0].replace(/[^0-9a-zA-Z]/g,"");
                        var onclk="'"+resfinal+"'";
                        var oncl2="'"+item.email+"'";
                        
						 table_body+='<tr class="clickrow" onclick="clickparts('+onclk+','+oncl2+')" id="'+resfinal+'"'+' value="'+item.email+'"'+'>';
						
						 table_body +='<td>'+item.username+'</td>';
						 table_body +='<td>'+item.firstname+'</td>';
						 table_body +='<td>'+item.lastname+'</td>';
						 table_body +='<td>'+item.email+'</td>';
						table_body+='</tr>';
						
						});
						if(table_body!=''){
							$("#tablesrchpart tbody").append(table_body);

						}
                        else{
                            table_body +='<tr class="no-records">';
                            table_body +='<td colspan="4" style="color:red;text-align: center; vertical-align: middle;">No records found</td></tr>';
                            $("#tablesrchpart tbody").append(table_body);

                        }
					
				 })
				 .fail (function(jqXHR, textStatus, errorThrown) { 
					 
				 })
			});


			$("#confirmdel").click(function(){
				var meetingkey= $('input#key').val();
				var reason= $('input#delmod').val();
				$.post(M.cfg.wwwroot + "/blocks/video_interview/ajax.php", {
					action: 'deleteinterview',
					meetingid:meetingkey,
					reason:reason,
					dataType: "xml",
	
				}).done (function(data, textStatus, jqXHR) { 
					console.log(data);
					console.log(data['data']);
					if(data['data']=='FAILURE'){
						document.getElementById("delerror").innerHTML = data['reason'];
					}
					else{
						$("#deleteModal").modal("hide");
						alert("Interview successfully Cancelled");
						location.reload();
					}
					
				 })
				 .fail (function(jqXHR, textStatus, errorThrown) { 
					 
				 })
				 


				// $.ajax({	
        		// 	method: "POST",
        		// 	url: M.cfg.wwwroot + '/blocks/video_interview/ajax.php',
        		// 	data: { "meetid" : meetingkey, "choice" : "delete_interview"}
    			// })
    			// .done(function( response ) {
    			
    			// });

			});

		
			$("#showvideo").click(function(){	
				$("#videolist").modal("show");
			});	

			$("#modalvi").click(function(){
				$("#videoModal").modal("show");
			  var myvid = document.getElementById('video1');
			   myvid.play();
			  myvid.addEventListener('ended', function(e) {
				// get the active source and the next video source.
				// I set it so if there's no next, it loops to the first one
				var activesource = document.querySelector("#video1 source.active");
				var nextsource = document.querySelector("#video1 source.active + source") || document.querySelector("#video1 source:first-child");
				
				// deactivate current source, and activate next one
				activesource.className = "";
				nextsource.className = "active";
				
				// update the video source and play
				myvid.src = nextsource.src;
				myvid.play();
			  });
							  
						  });
			
			$("#startaccept").click(function(){

				//
		
				var key=$("#meetid").val();
				
				$.post(M.cfg.wwwroot + "/blocks/video_interview/ajax.php", {
					action: 'checkjointime',
					meetingid:key,
					
	
				}).done (function(data, textStatus, jqXHR) { 
					console.log(data);
					window.open($("#startaccept").val(), '_blank', 'toolbar=0,location=0,menubar=0');
				// //success-----------------------------
				$.post(M.cfg.wwwroot + "/blocks/video_interview/ajax.php", {
					action: 'refreshjoin',
					meetingid:key,
					dataType: "xml",
	
				}).done (function(data, textStatus, jqXHR) { 
					console.log(data);
					console.log(data['data']);
					var redirecturl=M.cfg.wwwroot+"/blocks/video_interview/summary.php?eraseCache=true&key="+key;
					window.location.href = redirecturl;

					if(data['data']=='FAILURE'){
						
						document.getElementById("delerror").innerHTML = data['reason'];
					}
					
					
				 })
				 .fail (function(jqXHR, textStatus, errorThrown) { 
					 
				 })
					
					
				 })
				 .fail (function(jqXHR, textStatus, errorThrown) { 
					
					document.getElementById("checkjoinerror").innerHTML = "It's early to join this interview.Please connect 4 minutes before the scheduled start time.";

				 })

			});

			

			$("#feed").click(function(){
	$("#mainfeedback").css("display", "block");
	
			});
			
			$("#closevideo").click(function(){
				if (document.getElementById("video1")){
				document.getElementById("video1").pause();
				document.getElementById("video1").currentTime = 0;
				}
			});
			// $("#cp_btn").click(function(){
			// 	alert('clicked');
			// 	document.getElementById("cp_btn").addEventListener("click", copy_password);

			// });
			$("#newbtn").click(function(){
// 				var modalhtml=
// 				'<div class="row">'+
// 				'<div id="modalinterview"  class="col-sm-12">'+
// 				'<div class="row" style="margin: 13px;"><label class="required" for="name">Meeting Title</label><input type="text" style="height: 30px;margin-left:78px" placeholder="Meeting topic" ></div>'+
// 				'<div class="row" style="margin: 13px;"><label class="required" for="name">Meeting Password</label><input type="text" style="height: 30px;margin-left:44px" placeholder="Meeting password"></div>'+
// 				'<div class="row" style="margin: 13px;"><label for="scheduletime">Shedule Date/Time:</label>'+
//   '<input type="datetime-local" style="height: 30px;margin-left:44px" id="Date/time" name="scheduletime"></input></div>'+
//   '<div class="row" style="margin: 13px;"><label for="hours">Interview Duration:</label>'+
//   '<select style="margin-left: 51px;" id="hours"><option value="1">1 hour</option><option value="2">2 hour</option><option value="3">3 hour</option>'+
// 				'</select><select style="margin-left: 5px;" id="mins"><option value="5">5 minutes</option><option value="10">10 minutes</option><option value="15">15 minutes</option>'+
//   '</select></div>'+
//   '<div  style="margin: 13px;" class="row autocomplete"><label class="required" for="name">Interviewer</label><input id="myIn" style="margin-left: 93px;height: 30px;" type="text" name="attendes" placeholder="Interviewer"></div>'+
//   '<div  style="margin: 13px;" class="row autocomplete"><label class="required" for="name">Attendee</label><input id="myout" style="margin-left: 105px;height: 30px;" type="text" name="attendes" placeholder="Attendee"></div>'+

//   '</div></div>';
// 		$("#saveinterview").empty();        
// 		$("#saveinterview").append(modalhtml); 	
// 		$("#saveModal").modal("show");   
// 		addemail();
// 		loadhours();
var redirecturl=M.cfg.wwwroot+"/blocks/video_interview/add.php";
                  		  	location.replace(redirecturl); 
			});

			
			$("#start").click(function(){
				//var redirecturl=$("#join").val();
				//location.replace(redirecturl); 
			});
			$("#resclose").click(function(){
			
				$("#reason").val("");
				$("#datereq").val(null);
				$("#timereq").val(null);
				document.getElementById("reserror").innerHTML = '';
			});

			$("#noticlose").click(function(){
			
				$("#message").val("");	
				document.getElementById("notierror").innerHTML = '';
			});
$('#checkall').on('change', function() {
      if (this.checked) {
            $(".pubscore").each(function() {
                this.checked=true;
            });
        } else {
            $(".pubscore").each(function() {
                this.checked=false;
            });
        }
});

			$('#inputsearch').keydown(function(event){
				var keyCode = (event.keyCode ? event.keyCode : event.which);
				if (keyCode == 13) {
					$('#advsearch').trigger('click');
				}
			});
			$('#inputpartsearch').keydown(function(event){
				var keyCode = (event.keyCode ? event.keyCode : event.which);
				if (keyCode == 13) {
					$('#advpartsearch').trigger('click');
				}
			});
					
			$("#advreset").click(function(){
			
				$("#inputsearch").val("");	
			});
			$("#advpartsreset").click(function(){
			
				$("#inputpartsearch").val("");	
			});


			$("#advsubmit").click(function(){
			var span_text='';
var finalsp='';
				$("#addspan span").each(function() {
					var spanvalt=$(this).text();
					spanvalt=spanvalt.slice(0, -1); 
					if(finalsp==''){
						finalsp=finalsp+spanvalt;
					}
					else{
						finalsp=finalsp+','+spanvalt;
					}
					
				});
				
				$("#startModal").modal("hide"); 
				$('input[name="intertext"]').val(finalsp);
  
			});

		

				$("#advpartsubmit").click(function(){
					var span_text='';
		var finalsp='';
						$("#partaddspan span").each(function() {
							var spanvalt=$(this).text();
							spanvalt=spanvalt.slice(0, -1); 
							if(finalsp==''){
								finalsp=finalsp+spanvalt;
							}
							else{
								finalsp=finalsp+','+spanvalt;
							}
							
						});
					
						$("#partiModal").modal("hide"); 
						$('input[name="partstext"]').val(finalsp);
		  
					});

			$("#advcancel").click(function(){
				
					$("#startModal").modal("hide");   
				});
				$("#advpartcancel").click(function(){
				
					$("#partiModal").modal("hide");   
				});
			$("#rescheduleModal").on('hidden.bs.modal', function(e) { 
			
				$("#reason").val("");
				$("#datereq").val(null);
				$("#timereq").val(null);
				document.getElementById("reserror").innerHTML = '';
			});
			$("#adv").click(function(){
				var span_text='';
				$('#addspan').find('span').remove();
				var mailval=$('input[name="intertext"]').val();
				if(mailval!=''){
				var interarry=mailval.split(",");
var arrayLength = interarry.length;
var finalsp='';
for (var i = 0; i < arrayLength; i++) {
	var span_text='';

var res = interarry[i].split("@");
			var resfinal=res[0].replace(/[^0-9a-zA-Z]/g,"");
			var spanvalt=interarry[i];
					var spanvalid=resfinal;
					var delval="'"+resfinal+"'";
			span_text += '<span style="margin-right:5px;margin-bottom: 5px;font-size: 12px;" class="tag label label-info" id="'+spanvalid+'">'+spanvalt+'<button type="button" id="rem" class="close" onclick="remspan('+delval+')" aria-label="Close" style="font-size:15px;padding-left:4px">&times;</button></span>';
			$('#addspan').append(span_text);
}
				}

				$("#startModal").modal("show");   

			});

			$("#advparts").click(function(){
				var span_text='';
				$('#partaddspan').find('span').remove();
				var partsmailval=$('input[name="partstext"]').val();
				if(partsmailval!=''){
				var res = partsmailval.split("@");
				var resfinal=res[0].replace(/[^0-9a-zA-Z]/g,"");
				var spanvalt=partsmailval;
						var spanvalid=resfinal;
						var delval="'"+resfinal+"'";
						span_text += '<span style="margin-right:5px;margin-bottom: 5px;font-size: 12px;" class="tag label label-info" id="'+spanvalid+'">'+spanvalt+'<button type="button" id="rem" class="close" onclick="rempartsspan('+delval+')" aria-label="Close" style="font-size:15px;padding-left:4px">&times;</button></span>';
				$('#partaddspan').append(span_text);
				}
				$("#partiModal").modal("show");   

			});
			$("#saveok").click(function(){
							
				$("#saveModal").modal("hide");   
			
			
										});	
										function loadhours() {
											for (var i=0; i<25; i++) {
												var name = i + "hour";
												var sel = document.getElementById("hours");
												sel.options[sel.options.length] = new Option(name,i);
											}
											for (var i=0; i<60; i+5) {
												var name = i + "minutes";
												var sels = document.getElementById("mins");
												sels.options[sels.options.length] = new Option(name,i);
											}
										}


										function autocomplete(inp, arr) {
											/*the autocomplete function takes two arguments,
											the text field element and an array of possible autocompleted values:*/
											var currentFocus;
											/*execute a function when someone writes in the text field:*/
											inp.addEventListener("input", function(e) {
												var a, b, i, val = this.value;
												/*close any already open lists of autocompleted values*/
												closeAllLists();
												if (!val) { return false;}
												currentFocus = -1;
												/*create a DIV element that will contain the items (values):*/
												a = document.createElement("DIV");
												a.setAttribute("id", this.id + "autocomplete-list");
												a.setAttribute("class", "autocomplete-items");
												/*append the DIV element as a child of the autocomplete container:*/
												this.parentNode.appendChild(a);
												/*for each item in the array...*/
												for (i = 0; i < arr.length; i++) {
												  /*check if the item starts with the same letters as the text field value:*/
												  if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
													/*create a DIV element for each matching element:*/
													b = document.createElement("DIV");
													/*make the matching letters bold:*/
													b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
													b.innerHTML += arr[i].substr(val.length);
													/*insert a input field that will hold the current array item's value:*/
													b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
													/*execute a function when someone clicks on the item value (DIV element):*/
														b.addEventListener("click", function(e) {
														/*insert the value for the autocomplete text field:*/
														inp.value = this.getElementsByTagName("input")[0].value;
														/*close the list of autocompleted values,
														(or any other open lists of autocompleted values:*/
														closeAllLists();
													});
													a.appendChild(b);
												  }
												}
											});
											/*execute a function presses a key on the keyboard:*/
											inp.addEventListener("keydown", function(e) {
												var x = document.getElementById(this.id + "autocomplete-list");
												if (x) x = x.getElementsByTagName("div");
												if (e.keyCode == 40) {
												  /*If the arrow DOWN key is pressed,
												  increase the currentFocus variable:*/
												  currentFocus++;
												  /*and and make the current item more visible:*/
												  addActive(x);
												} else if (e.keyCode == 38) { //up
												  /*If the arrow UP key is pressed,
												  decrease the currentFocus variable:*/
												  currentFocus--;
												  /*and and make the current item more visible:*/
												  addActive(x);
												} else if (e.keyCode == 13) {
												  /*If the ENTER key is pressed, prevent the form from being submitted,*/
												  e.preventDefault();
												  if (currentFocus > -1) {
													/*and simulate a click on the "active" item:*/
													if (x) x[currentFocus].click();
												  }
												}
											});
											function addActive(x) {
											  /*a function to classify an item as "active":*/
											  if (!x) return false;
											  /*start by removing the "active" class on all items:*/
											  removeActive(x);
											  if (currentFocus >= x.length) currentFocus = 0;
											  if (currentFocus < 0) currentFocus = (x.length - 1);
											  /*add class "autocomplete-active":*/
											  x[currentFocus].classList.add("autocomplete-active");
											}
											function removeActive(x) {
											  /*a function to remove the "active" class from all autocomplete items:*/
											  for (var i = 0; i < x.length; i++) {
												x[i].classList.remove("autocomplete-active");
											  }
											}
											function closeAllLists(elmnt) {
											  /*close all autocomplete lists in the document,
											  except the one passed as an argument:*/
											  var x = document.getElementsByClassName("autocomplete-items");
											  for (var i = 0; i < x.length; i++) {
												if (elmnt != x[i] && elmnt != inp) {
												x[i].parentNode.removeChild(x[i]);
											  }
											}
										  }
										  /*execute a function when someone clicks in the document:*/
										  document.addEventListener("click", function (e) {
											  closeAllLists(e.target);
										  });
										  }
	function addemail(){
		 $.ajax({	
		method: "POST",
		url: M.cfg.wwwroot + '/block/video_interview/ajax.php',
			data: {"choice" : "get_email"}
			})
			.done(function( response ) {
				console.log(response);
	//var countries = ["Afghanistan","Albania","Algeria","Andorra","Angola","Anguilla","Antigua &amp; Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia &amp; Herzegovina","Botswana","Brazil","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Cayman Islands","Central Arfrican Republic","Chad","Chile","China","Colombia","Congo","Cook Islands","Costa Rica","Cote D Ivoire","Croatia","Cuba","Curacao","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Falkland Islands","Faroe Islands","Fiji","Finland","France","French Polynesia","French West Indies","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guam","Guatemala","Guernsey","Guinea","Guinea Bissau","Guyana","Haiti","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Kosovo","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macau","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauro","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","North Korea","Norway","Oman","Pakistan","Palau","Palestine","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russia","Rwanda","Saint Pierre &amp; Miquelon","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Sudan","Spain","Sri Lanka","St Kitts &amp; Nevis","St Lucia","St Vincent","Sudan","Suriname","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Timor L'Este","Togo","Tonga","Trinidad &amp; Tobago","Tunisia","Turkey","Turkmenistan","Turks &amp; Caicos","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States of America","Uruguay","Uzbekistan","Vanuatu","Vatican City","Venezuela","Vietnam","Virgin Islands (US)","Yemen","Zambia","Zimbabwe"];
				autocomplete(document.getElementById("myIn"), response);
				});	
		}

		
		$("#joinmt").click(function(){
			var redirecturl=$("#joinmt").val();
			location.replace(redirecturl); 
		

		});
		$("#joinbtn").click(function(){
			var redirecturl=$("#joinbtn").val();
			location.replace(redirecturl); 
		

		});
	
		function myFunction() {
			var input = document.getElementById("myInput");
			var filter = input.value.toUpperCase();
			var table = document.getElementById("myTable");
			var tr = table.getElementsByTagName("tr");
			var tds = tr.getElementsByTagName('td');
		
			for (var i = 0; i < tr.length; i++) { 
				if (tr.textContent.toUpperCase().indexOf(filter) > -1) {
					tr[i].style.display = "";
				} else {
					tr[i].style.display = "none";
				}      
			}
		}									
		$("#searchInput").click(function(){
			var from = $("#interviewstart_date").val();
			var to = $("#interviewend_date").val();
			var  filter = $("#interviewer_srch").val().toUpperCase();
			var  parts = $("#parts_srch").val().toUpperCase();
			var  title = $("#title_srch").val().toUpperCase();

			if(from =='' && to =='' && filter =='' && parts =='' && title==''){

			}
			else{
			var isempty=true;
		
			$(".fbody tr").each(function() {
			  var row = $(this);
			  var date = row.find("td").eq(0).text();
			  var inter = row.find("td").eq(3).text();
			  var participant = row.find("td").eq(4).text();
			  var titleint = row.find("td").eq(2).text();

			
			  //show all rows by default
			  var show = true;

			  //if from date is valid and row date is less than from date, hide the row
			  if (from && date < from){
				show = false;
			  }
			  
			  //if to date is valid and row date is greater than to date, hide the row
			  if (to && date > to){
				show = false;
			  }
			  if(inter.toUpperCase().indexOf(filter) < 0){
				show = false;
				}
				if(participant.toUpperCase().indexOf(parts) !=0){
					show = false;
					}
					if(titleint.toUpperCase().indexOf(title) < 0){
						show = false;
						}
			  if (show){
				row.show();
				isempty=false;
			  }
			  else{
				row.hide();
			  }
			});
			if(isempty){
				
				$(".no-records").show();
			}
		}
		  });
		  
		  $("#searchReset").click(function(){
			$(".fbody tr").each(function() {
				var row = $(this);
				  row.show();
			  });
			  $("#interviewend_date").val("");
			  $("#interviewstart_date").val(null);
			  $("#interviewer_srch").val("");
			  $("#parts_srch").val("");
			  $("#title_srch").val("");
			  $(".no-records").hide();
			});		
			
			$(".clickable").click(function(){
				//var $row = $(this).closest("tr");    // Find the row	
				var $text2 = $(this).attr('value');
				var redirecturl=M.cfg.wwwroot+"/blocks/video_interview/summary.php?key="+$text2;
                  		  	location.replace(redirecturl); 
			});	
			$("#back").click(function(){
				
				var redirecturl=M.cfg.wwwroot+"/blocks/video_interview/showmeetings.php";
                  		  	location.replace(redirecturl); 
			});	
			
			$("#searchstudentInput").click(function(){
				var from = $("#studstart_date").val();
				var to = $("#studend_date").val();
				var  filter = $("#interviewtitle").val().toUpperCase();
				if(from =='' && to =='' && filter ==''){

				}
				else{	
								var isempty=true;
			  
				$(".studbody tr").each(function() {
				  var row = $(this);
				  var date =row.find("td[id='date-td']").text();
				  var inter = row.find("td").eq(2).text();
				 // var dateFormat = require('dateformat');
				  //date=dateFormat(date, "yyyy-MM-dd");

				 ///alert( from+'---'+to+'----'+ date );
				
				  //show all rows by default
				  var show = true;
	
				  //if from date is valid and row date is less than from date, hide the row
				  if (from && date < from){
					show = false;
				  }
				  
				  //if to date is valid and row date is greater than to date, hide the row
				  if (to && date > to){
					show = false;
				  }
				  if(inter.toUpperCase().indexOf(filter) !=0){
					show = false;
					}
				
				  if (show){
					row.show();
					isempty=false;
				  }
				  else{
					row.hide();
				  }
				});
				if(isempty){
				
					$(".stud-records").show();
				}
			}
			  });

			  $("#searchgencInput").click(function(){
				var from = $("#studstart_date").val();
				var to = $("#studend_date").val();
				var  filter = $("#interviewtitle").val().toUpperCase();
				if(from =='' && to =='' && filter ==''){

				}
				else{
									var isempty=true;
			  
				$(".studbody tr").each(function() {
				  var row = $(this);
				  var date =row.find("td[id='date-td']").text();
				  var inter = row.find("td").eq(2).text();
	
				  //alert( from+'---'+to+'----'+ date );
				  //show all rows by default
				  var show = true;
	
				  //if from date is valid and row date is less than from date, hide the row
				  if (from && date < from){
					show = false;
				  }
				  
				  //if to date is valid and row date is greater than to date, hide the row
				  if (to && date > to){
					show = false;
				  }
				  if(inter.toUpperCase().indexOf(filter) !=0){
					show = false;
					}
				
				  if (show){
					row.show();
					isempty=false;
				  }
				  else{
					row.hide();
				  }
				});
				if(isempty){
				
					$(".genc-records").show();
				}
			}
			  });

			  $("#studReset").click(function(){
				$(".studbody tr").each(function() {
					var row = $(this);
					  row.show();
				  });
				  $("#studend_date").val("");
				  $("#studstart_date").val(null);
				  $("#interviewtitle").val("");
				  $(".stud-records").hide();
				  $(".genc-records").hide();
				});	
				
		}
	};
});

define('media_videojs/loader', ["jquery","core/event"],function(a,b){var c,d=function(d){c=d,e(null,a("body")),b.getLegacyEvents().done(function(b){a(document).on(b.FILTER_CONTENT_UPDATED,e)})},e=function(b,d){var e=".mediaplugin_videojs";d.find(e).addBack(e).find("audio, video").each(function(){var b=a(this).attr("id"),d=a(this).data("setup-lazy"),e=["media_videojs/video-lazy"];d.techOrder&&d.techOrder.indexOf("youtube")!==-1&&e.push("media_videojs/Youtube-lazy"),d.techOrder&&d.techOrder.indexOf("flash")!==-1&&e.push("media_videojs/videojs-flash-lazy"),require(e,function(a){c&&(c(a),c=null),a(b,d)})})};return{setUp:d}});
define('report_competency/grading_popup', ["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h=function(b,c){this._regionSelector=b,this._userCompetencySelector=c,a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return h.prototype._handleClick=function(c){var f=a(c.target).closest(this._userCompetencySelector),g=a(f).data("competencyid"),h=a(f).data("courseid"),i=a(f).data("userid");e.debug("Clicked on cell: competencyId="+g+", courseId="+h+", userId="+i);var j=d.call([{methodname:"tool_lp_data_for_user_competency_summary_in_course",args:{userid:i,competencyid:g,courseid:h}},{methodname:"core_competency_user_competency_viewed_in_course",args:{userid:i,competencyid:g,courseid:h}}]);a.when.apply(a,j).then(function(a){this._contextLoaded.bind(this)(a)}.bind(this))["catch"](b.exception)},h.prototype._contextLoaded=function(a){var d=this;a.displayuser=!0,f.render("tool_lp/user_competency_summary_in_course",a).done(function(a,e){c.get_string("usercompetencysummary","report_competency").done(function(b){new g(b,a,f.runTemplateJS.bind(f,e),d._refresh.bind(d),(!0))}).fail(b.exception)}).fail(b.exception)},h.prototype._refresh=function(){var c=a(this._regionSelector),e=c.data("courseid"),f=c.data("userid");d.call([{methodname:"report_competency_data_for_report",args:{courseid:e,userid:f},done:this._pageContextLoaded.bind(this),fail:b.exception}])},h.prototype._pageContextLoaded=function(a){var c=this;f.render("report_competency/report",a).done(function(a,b){f.replaceNode(c._regionSelector,a,b)}).fail(b.exception)},h.prototype._regionSelector=null,h.prototype._userCompetencySelector=null,h});
define('report_competency/user_course_navigation', ["jquery"],function(a){var b=function(b,c,d,e){this._baseUrl=c,this._userId=d+"",this._courseId=e,a(b).on("change",this._userChanged.bind(this))};return b.prototype._userChanged=function(b){var c=a(b.target).val(),d="?user="+c+"&id="+this._courseId;document.location=this._baseUrl+d},b.prototype._userId=null,b.prototype._courseId=null,b.prototype._baseUrl=null,b});
define('report_insights/actions', ["jquery","core/ajax","core/notification","core/url"],function(a,b,c,d){return{init:function(e,f,g){a("a[data-prediction-methodname][data-prediction-id="+e+"]").on("click",function(h){h.preventDefault();var i=a(h.currentTarget),j=i.attr("data-prediction-methodname"),k=i.closest("tr");if(k.length>0){var l=b.call([{methodname:j,args:{predictionid:e}}])[0];l.done(function(){if(k[0].remove(),a(".insights-list tr").length<2){var b={contextid:f,modelid:g},c=a.param(b);window.location.assign(d.relativeUrl("report/insights/insights.php?"+c))}}).fail(c.exception)}})}}});
define('report_progress/completion_override', ["jquery","core/ajax","core/str","core/modal_factory","core/modal_events","core/notification","core/custom_interaction_events","core/templates"],function(a,b,c,d,e,f,g,h){var i,j,k=function(a,b){return a>0?"i/completion-"+b+"-y-override":"i/completion-"+b+"-n-override"},l=function(a){h.render("core/loading",{}).then(function(c){return j.append(c),b.call([{methodname:"core_completion_override_activity_completion_status",args:a}])[0]}).then(function(b){var d=b.state>0?1:0,e=d?"completion-y-override":"completion-n-override";c.get_string(e,"completion",i).then(function(a){var b={state:a,date:"",user:j.attr("data-userfullname"),activity:j.attr("data-activityname")};return c.get_string("progress-title","completion",b)}).then(function(a){var b=j.attr("data-completiontracking");return h.renderPix(k(d,b),"core",a)}).then(function(b){var c=d>0?0:1;j.find(".loading-icon").remove(),j.data("changecompl",a.userid+"-"+a.cmid+"-"+c),j.attr("data-changecompl",a.userid+"-"+a.cmid+"-"+c),j.children("img").replaceWith(b)})["catch"](f.exception)})["catch"](f.exception)},m=function(b,g){g.originalEvent.preventDefault(),g.originalEvent.stopPropagation(),b.preventDefault(),b.stopPropagation(),j=a(b.currentTarget);var h=j.data("changecompl").split("-"),i={userid:h[0],cmid:h[1],newstate:h[2]},k=1==i.newstate?"completion-y":"completion-n";c.get_strings([{key:k,component:"completion"}]).then(function(a){return c.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:a[0]}])}).then(function(a){return d.create({type:d.types.CONFIRM,title:a[0],body:a[1]})}).then(function(a){a.getRoot().on(e.yes,function(){l(i)}),a.getRoot().on(e.hidden,function(){j.focus(),a.destroy()}),a.show()})["catch"](f.exception)},n=function(b){i=b,a("#completion-progress a.changecompl").each(function(a,b){g.define(b,[g.events.activate])}),a("#completion-progress").on(g.events.activate,"a.changecompl",function(a,b){m(a,b)})};return{init:n}});
define('gradingform_guide/comment_chooser', ["jquery","core/templates","core/notification","core/yui"],function(a,b,c){return{initialise:function(d,e,f,g){function h(b,c){var e="<label>"+M.util.get_string("insertcomment","gradingform_guide")+"</label>",g="comment-chooser-"+d+"-cancel",h='<button id="'+g+'">'+M.util.get_string("cancel","moodle")+"</button>",i=new M.core.dialogue({modal:!0,headerContent:e,bodyContent:b,footerContent:h,focusAfterHide:"#"+f,id:"comments-chooser-dialog-"+d});a("#"+g).click(function(){i.hide()}),a.each(c,function(b,c){var e="#comment-option-"+d+"-"+c.id;a(e).click(function(){var b=a("#"+f),d=b.val();""!==a.trim(d)&&(d+="\n"),d+=c.description,b.val(d),i.hide()}),a(document).off("keypress",e).on("keypress",e,function(){var b=event.which||event.keyCode;13!=b&&32!=b||a(e).click()})}),i.after("visibleChange",function(a){a.prevVal&&!a.newVal&&this.destroy()},i),i.show()}function i(){var a={criterionId:d,comments:g};b.render("gradingform_guide/comment_chooser",a).done(function(a){h(a,g)}).fail(c.exception)}a("#"+e).click(function(a){a.preventDefault(),i()})}}});
define('tool_analytics/log_info', ["jquery","core/str","core/modal_factory","core/notification"],function(a,b,c,d){return{loadInfo:function(e,f){var g=a('[data-model-log-id="'+e+'"]');b.get_string("loginfo","tool_analytics").then(function(b){var d=a("<ul>");return f.forEach(function(a){d.append("<li>"+a+"</li>")}),d.append("</ul>"),c.create({title:b,body:d.html(),large:!0},g)})["catch"](d.exception)}}});
define('tool_analytics/model', ["jquery","core/str","core/log","core/notification","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g={clear:{title:{key:"clearpredictions",component:"tool_analytics"},body:{key:"clearmodelpredictions",component:"tool_analytics"}}},h=function(b){return a(b.closest("tr")[0]).find("span.target-name").text()};return{confirmAction:function(i,j){a('[data-action-id="'+i+'"]').on("click",function(i){i.preventDefault();var k=a(i.currentTarget);if("undefined"==typeof g[j])return void c.error('Action "'+j+'" is not allowed.');var l=[g[j].title,g[j].body];l[1].param=h(k);var m=b.get_strings(l),n=e.create({type:e.types.SAVE_CANCEL});a.when(m,n).then(function(a,b){return b.setTitle(a[0]),b.setBody(a[1]),b.setSaveButtonText(a[0]),b.getRoot().on(f.save,function(){window.location.href=k.attr("href")}),b.show(),b}).fail(d.exception)})}}});
define('tool_dataprivacy/myrequestactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],function(a,b,c,d,e,f,g){function h(a){var e={methodname:"tool_dataprivacy_contact_dpo",args:{message:a}},f="success";b.call([e])[0].then(function(a){return a.result?d.get_string("requestsubmitted","tool_dataprivacy"):(f="error",a.warnings.join("<br>"))}).done(function(a){c.addNotification({message:a,type:f})}).fail(c.exception)}var i={CANCEL_REQUEST:'[data-action="cancel"]',CONTACT_DPO:'[data-action="contactdpo"]'},j=function(){this.registerEvents()};return j.prototype.registerEvents=function(){a(i.CANCEL_REQUEST).click(function(g){g.preventDefault();var h=a(this).data("requestid"),i=[{key:"cancelrequest",component:"tool_dataprivacy"},{key:"cancelrequestconfirmation",component:"tool_dataprivacy"}];d.get_strings(i).then(function(a){var d=a[0],g=a[1];return e.create({title:d,body:g,type:e.types.SAVE_CANCEL}).then(function(a){return a.setSaveButtonText(d),a.getRoot().on(f.save,function(){var a={requestid:h},d={methodname:"tool_dataprivacy_cancel_data_request",args:a};b.call([d])[0].done(function(a){a.result?window.location.reload():c.addNotification({message:a.warnings[0].message,type:"error"})}).fail(c.exception)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a})}).done(function(a){a.show()}).fail(c.exception)}),a(i.CONTACT_DPO).click(function(b){b.preventDefault();var i=a(this).data("replytoemail"),j=[{key:"contactdataprotectionofficer",component:"tool_dataprivacy"},{key:"send",component:"tool_dataprivacy"}],k="";d.get_strings(j).then(function(a){var b=a[0];k=a[1];var c={replytoemail:i};return e.create({title:b,body:g.render("tool_dataprivacy/contact_dpo",c),type:e.types.SAVE_CANCEL,large:!0})}).done(function(b){b.setSaveButtonText(k),b.getRoot().on(f.save,function(b){var c=a("#message").val().trim();0===c.length?(b.preventDefault(),a('[data-region="messageinput"]').addClass("has-danger notifyproblem"),a("#id_error_message").removeAttr("hidden")):h(c)}),b.getRoot().on(f.hidden,function(){b.destroy()}),b.show()}).fail(c.exception)})},{init:function(){return new j}}});
define('tool_dataprivacy/form-user-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h;h=b.call([{methodname:"tool_dataprivacy_get_users",args:{query:e}}]),h[0].then(function(b){var d=[],e=0;return a.each(b,function(a,b){d.push(c.render("tool_dataprivacy/form-user-selector-suggestion",b))}),a.when.apply(a.when,d).then(function(){var c=arguments;a.each(b,function(a,b){b._label=c[e],e++}),f(b)})}).fail(g)}}});
define('tool_dataprivacy/expand_contract', ["jquery","core/url","core/str"],function(a,b,c){var d=a('<img alt="" src="'+b.imageUrl("t/expanded")+'"/>'),e=a('<img alt="" src="'+b.imageUrl("t/collapsed")+'"/>');return{expandCollapse:function(a,b){a.hasClass("hide")?(a.removeClass("hide"),a.addClass("visible"),a.attr("aria-expanded",!0),b.find(":header i.fa").removeClass("fa-plus-square"),b.find(":header i.fa").addClass("fa-minus-square"),b.find(":header img.icon").attr("src",d.attr("src"))):(a.removeClass("visible"),a.addClass("hide"),a.attr("aria-expanded",!1),b.find(":header i.fa").removeClass("fa-minus-square"),b.find(":header i.fa").addClass("fa-plus-square"),b.find(":header img.icon").attr("src",e.attr("src")))},expandCollapseAll:function(b){var f="visible"==b?"hide":"visible",g="visible"==b,h="visible"==b?"fa-plus-square":"fa-minus-square",i="visible"==b?"fa-minus-square":"fa-plus-square",j="visible"==b?d.attr("src"):e.attr("src");a("."+f).each(function(){a(this).removeClass(f),a(this).addClass(b),a(this).attr("aria-expanded",g)}),a(".tool_dataprivacy-expand-all").data("visibilityState",f),c.get_string(f,"tool_dataprivacy").then(function(b){a(".tool_dataprivacy-expand-all").html(b)})["catch"](Notification.exception),a(":header i.fa").each(function(){a(this).removeClass(h),a(this).addClass(i)}),a(":header img.icon").each(function(){a(this).attr("src",j)})}}});
define('tool_dataprivacy/purposesactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g={DELETE:'[data-action="deletepurpose"]'},h=function(){this.registerEvents()};return h.prototype.registerEvents=function(){a(g.DELETE).click(function(g){g.preventDefault();var h=a(this).data("id"),i=a(this).data("name"),j=[{key:"deletepurpose",component:"tool_dataprivacy"},{key:"deletepurposetext",component:"tool_dataprivacy",param:i},{key:"delete"}];d.get_strings(j).then(function(d){var g=d[0],i=d[1],j=d[2];return e.create({title:g,body:i,type:e.types.SAVE_CANCEL}).then(function(d){return d.setSaveButtonText(j),d.getRoot().on(f.save,function(){var d={methodname:"tool_dataprivacy_delete_purpose",args:{id:h}};b.call([d])[0].done(function(b){b.result?a('tr[data-purposeid="'+h+'"]').remove():c.addNotification({message:b.warnings[0].message,type:"error"})}).fail(c.exception)}),d.getRoot().on(f.hidden,function(){d.destroy()}),d})}).done(function(a){a.show()}).fail(c.exception)})},{init:function(){return new h}}});
define('tool_dataprivacy/defaultsactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],function(a,b,c,d,e,f,g){function h(b,d,h,j,k,l,m,n){null!==h&&l.forEach(function(a){a.id===h&&(a.selected=!0)}),null!==j&&m.forEach(function(a){a.id===j&&(a.selected=!0)});var o={contextlevel:d,categoryoptions:l,purposeoptions:m};null!==n&&n.length&&(null===k?o.newactivitydefaults=!0:n.forEach(function(a){k===a.name&&(a.selected=!0)}),o.modemodule=!0,o.activityoptions=n),e.create({title:b,body:g.render("tool_dataprivacy/category_purpose_form",o),type:e.types.SAVE_CANCEL,large:!0}).then(function(b){return b.getRoot().on(f.save,function(){var b=a("#activity"),c="undefined"!=typeof b?b.val():null,d=a("#override"),e="undefined"!=typeof d&&d.is(":checked");i(a("#contextlevel").val(),a("#category").val(),a("#purpose").val(),c,e)}),b.getRoot().on(f.hidden,function(){b.destroy()}),b.show(),b})["catch"](c.exception)}function i(a,c,d,e,f){var g={methodname:"tool_dataprivacy_set_context_defaults",args:{contextlevel:a,category:c,purpose:d,override:f,activity:e}};b.call([g])[0].done(function(a){a.result&&window.location.reload()})}var j={EDIT_LEVEL_DEFAULTS:'[data-action="edit-level-defaults"]',NEW_ACTIVITY_DEFAULTS:'[data-action="new-activity-defaults"]',EDIT_ACTIVITY_DEFAULTS:'[data-action="edit-activity-defaults"]',DELETE_ACTIVITY_DEFAULTS:'[data-action="delete-activity-defaults"]'},k=-1,l=function(){this.registerEvents()};return l.prototype.registerEvents=function(){a(j.EDIT_LEVEL_DEFAULTS).click(function(e){e.preventDefault();var f=a(this),g=f.data("contextlevel"),i=f.data("category"),j=f.data("purpose"),k=[{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}}],l=b.call(k),m=d.get_string("editdefaults","tool_dataprivacy",a("#defaults-header").text());a.when(l[0],l[1],m).then(function(a,b,c){var d=a.options,e=b.options;return h(c,g,i,j,null,d,e,null),!0})["catch"](c.exception)}),a(j.NEW_ACTIVITY_DEFAULTS).click(function(e){e.preventDefault();var f=a(this),g=f.data("contextlevel"),i=[{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{nodefaults:!0}}],j=b.call(i),k=d.get_string("addnewdefaults","tool_dataprivacy");a.when(j[0],j[1],j[2],k).then(function(a,b,c,d){var e=a.options,f=b.options,i=c.options;return h(d,g,null,null,null,e,f,i),!0})["catch"](c.exception)}),a(j.EDIT_ACTIVITY_DEFAULTS).click(function(e){e.preventDefault();var f=a(this),g=f.data("contextlevel"),i=f.data("category"),j=f.data("purpose"),k=f.data("activityname"),l=[{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{}}],m=b.call(l),n=d.get_string("editmoduledefaults","tool_dataprivacy");a.when(m[0],m[1],m[2],n).then(function(a,b,c,d){var e=a.options,f=b.options,l=c.options;return h(d,g,i,j,k,e,f,l),!0})["catch"](c.exception)}),a(j.DELETE_ACTIVITY_DEFAULTS).click(function(b){b.preventDefault();var h=a(this),j=h.data("contextlevel"),l=h.data("activityname"),m=h.data("activitydisplayname"),n=k,o=k;e.create({title:d.get_string("deletedefaults","tool_dataprivacy",m),body:g.render("tool_dataprivacy/delete_activity_defaults",{activityname:m}),type:e.types.SAVE_CANCEL,large:!0}).then(function(a){return a.setSaveButtonText(d.get_string("delete")),a.getRoot().on(f.save,function(){i(j,n,o,l,!1)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show(),!0})["catch"](c.exception)})},{init:function(){return new l}}});
define('tool_dataprivacy/events', [],function(){return{approve:"tool_dataprivacy-data_request:approve",bulkApprove:"tool_dataprivacy-data_request:bulk_approve",deny:"tool_dataprivacy-data_request:deny",bulkDeny:"tool_dataprivacy-data_request:bulk_deny",complete:"tool_dataprivacy-data_request:complete"}});
define('tool_dataprivacy/data_request_modal', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","tool_dataprivacy/events"],function(a,b,c,d,e,f){var g=!1,h={APPROVE_BUTTON:'[data-action="approve"]',DENY_BUTTON:'[data-action="deny"]',COMPLETE_BUTTON:'[data-action="complete"]'},i=function(a){d.call(this,a)};return i.TYPE="tool_dataprivacy-data_request",i.prototype=Object.create(d.prototype),i.prototype.constructor=i,i.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,h.APPROVE_BUTTON,function(b,c){var d=a.Event(f.approve);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,h.DENY_BUTTON,function(b,c){var d=a.Event(f.deny);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,h.COMPLETE_BUTTON,function(b,c){var d=a.Event(f.complete);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},g||(e.register(i.TYPE,i,"tool_dataprivacy/data_request_modal"),g=!0),i});
define('tool_dataprivacy/data_registry', ["jquery","core/str","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/fragment","tool_dataprivacy/add_purpose","tool_dataprivacy/add_category"],function(a,b,c,d,e,f,g,h,i,j){var k={TREE_NODES:"[data-context-tree-node=1]",FORM_CONTAINER:"#context-form-container"},l=function(a,b,c){this.systemContextId=a,this.currentContextLevel=b,this.currentContextId=c,this.init()};return l.prototype.systemContextId=0,l.prototype.currentContextLevel=0,l.prototype.currentContextId=0,l.prototype.addpurpose=null,l.prototype.addcategory=null,l.prototype.init=function(){this.addpurpose=i.getInstance(this.systemContextId),this.addcategory=j.getInstance(this.systemContextId);var a=[{key:"changessaved",component:"moodle"},{key:"contextpurposecategorysaved",component:"tool_dataprivacy"},{key:"noblockstoload",component:"tool_dataprivacy"},{key:"noactivitiestoload",component:"tool_dataprivacy"},{key:"nocoursestoload",component:"tool_dataprivacy"}];this.strings=b.get_strings(a),this.registerEventListeners(),this.currentContextId?this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this)):this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this))},l.prototype.registerEventListeners=function(){a(k.TREE_NODES).on("click",function(b){b.preventDefault();var c=a(b.currentTarget);a(k.TREE_NODES).removeClass("active"),c.addClass("active");var d=c.data("contextlevel"),e=c.data("contextid");if(d)window.history.pushState({},null,"?contextlevel="+d),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextLevel=d,this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this));else if(e)window.history.pushState({},null,"?contextid="+e),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextId=e,this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this));else{var f=c.data("expandcontextid"),g=c.data("expandelement"),h=c.data("expanded");g&&(h?this.collapse(c):!c.data("loaded")&&f&&g?(c.find("> i").removeClass("fa-plus"),c.find("> i").addClass("fa-circle-o-notch fa-spin"),this.loadExtra(c,f,g)):this.expand(c))}}.bind(this))},l.prototype.removeListeners=function(){a(k.TREE_NODES).off("click")},l.prototype.loadForm=function(b,c,f){this.clearForm();var g=h.loadFragment("tool_dataprivacy",b,this.systemContextId,c);g.done(function(b,c){a(k.FORM_CONTAINER).html(b),e.runTemplateJS(c),this.addpurpose.registerEventListeners(),this.addcategory.registerEventListeners(),a(k.FORM_CONTAINER).on("submit","form",f)}.bind(this)).fail(d.exception)},l.prototype.clearForm=function(){Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),a(k.FORM_CONTAINER).off("submit","form")},l.prototype.submitForm=function(b){b.preventDefault(),a(k.FORM_CONTAINER).find("form").submit()},l.prototype.submitContextLevelFormAjax=function(a){this.submitFormAjax(a,"tool_dataprivacy_set_contextlevel_form")},l.prototype.submitContextFormAjax=function(a){this.submitFormAjax(a,"tool_dataprivacy_set_context_form")},l.prototype.submitFormAjax=function(b,e){b.preventDefault();var f=a(k.FORM_CONTAINER).find("form").serialize();return this.strings.then(function(a){c.call([{methodname:e,args:{jsonformdata:JSON.stringify(f)},done:function(){d.alert(a[0],a[1])},fail:d.exception}])})["catch"](d.exception)},l.prototype.loadExtra=function(a,b,f){c.call([{methodname:"tool_dataprivacy_tree_extra_branches",args:{contextid:b,element:f},done:function(b){return 0==b.branches.length?void this.noElements(a,f):void e.render("tool_dataprivacy/context_tree_branches",b).then(function(b){a.after(b),this.removeListeners(),this.registerEventListeners(),this.expand(a),a.data("loaded",1)}.bind(this)).fail(d.exception)}.bind(this),fail:d.exception}])},l.prototype.noElements=function(a,b){a.data("expandcontextid",""),a.data("expandelement",""),this.strings.then(function(c){var d=2;"module"==b?d=3:"course"==b&&(d=4),a.text(c[d])}).fail(d.exception)},l.prototype.collapse=function(a){a.data("expanded",0),a.siblings("nav").addClass("hidden"),a.find("> i").removeClass("fa-minus"),a.find("> i").addClass("fa-plus")},l.prototype.expand=function(a){a.data("expanded",1),a.siblings("nav").removeClass("hidden"),a.find("> i").removeClass("fa-plus"),a.find("> i").removeClass("fa-circle-o-notch fa-spin"),a.find("> i").addClass("fa-minus")},{init:function(a,b,c){return new l(a,b,c)}}});
define('tool_dataprivacy/add_purpose', ["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],function(a,b,c,d,e,f,g){var h={PURPOSE_LINK:'[data-add-element="purpose"]'},i=function(a){this.contextId=a;var c=[{key:"addpurpose",component:"tool_dataprivacy"},{key:"save",component:"admin"}];this.strings=b.get_strings(c),this.registerEventListeners()};return i.prototype.contextId=0,i.prototype.strings=0,i.prototype.registerEventListeners=function(){var b=a(h.PURPOSE_LINK);b.on("click",function(){return this.strings.then(function(a){e.create({type:e.types.SAVE_CANCEL,title:a[0],body:""},b).done(function(b){this.setupFormModal(b,a[1])}.bind(this))}.bind(this)).fail(d.exception)}.bind(this))},i.prototype.getBody=function(a){var b=null;return"undefined"!=typeof a&&(b={jsonformdata:JSON.stringify(a)}),g.loadFragment("tool_dataprivacy","addpurpose_form",this.contextId,b)},i.prototype.setupFormModal=function(a,b){a.setLarge(),a.setSaveButtonText(b),a.getRoot().on(f.hidden,this.destroy.bind(this)),a.setBody(this.getBody()),a.getRoot().on(f.save,this.submitForm.bind(this)),a.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=a,a.show()},i.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},i.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize();c.call([{methodname:"tool_dataprivacy_create_purpose_form",args:{jsonformdata:JSON.stringify(b)},done:function(a){a.validationerrors?this.modal.setBody(this.getBody(b)):this.close()}.bind(this),fail:d.exception}])},i.prototype.close=function(){this.destroy(),document.location.reload()},i.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),this.modal.destroy()},i.prototype.removeListeners=function(){a(h.PURPOSE_LINK).off("click")},{getInstance:function(a){return new i(a)}}});
define('tool_dataprivacy/request_filter', ["jquery","core/form-autocomplete","core/str","core/notification"],function(a,b,c,d){var e={REQUEST_FILTERS:"#request-filters"},f=function(){var f=[{key:"filter",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}];c.get_strings(f).then(function(a){var c=a[0],d=a[1];return b.enhance(e.REQUEST_FILTERS,!1,"",c,!1,!0,d,!0)}).fail(d.exception);var g=a(e.REQUEST_FILTERS).val();a(e.REQUEST_FILTERS).on("change",function(){var b=a(this).val();g.join(",")!==b.join(",")&&(0===b.length&&a("#filters-cleared").val(1),a(this.form).submit())})};return{init:function(){f()}}});
define('tool_dataprivacy/requestactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","tool_dataprivacy/data_request_modal","tool_dataprivacy/events"],function(a,b,c,d,e,f,g,h,i){function j(a){return{wsfunction:"tool_dataprivacy_approve_data_request",wsparams:{requestid:a}}}function k(a){return{wsfunction:"tool_dataprivacy_bulk_approve_data_requests",wsparams:{requestids:a}}}function l(a){return{wsfunction:"tool_dataprivacy_deny_data_request",wsparams:{requestid:a}}}function m(a){return{wsfunction:"tool_dataprivacy_bulk_deny_data_requests",wsparams:{requestids:a}}}function n(a){return{wsfunction:"tool_dataprivacy_mark_complete",wsparams:{requestid:a}}}function o(a,b){var g=[];switch(a){case i.approve:g=[{key:"approverequest",component:"tool_dataprivacy"},{key:"confirmapproval",component:"tool_dataprivacy"}];break;case i.bulkApprove:g=[{key:"bulkapproverequests",component:"tool_dataprivacy"},{key:"confirmbulkapproval",component:"tool_dataprivacy"}];break;case i.deny:g=[{key:"denyrequest",component:"tool_dataprivacy"},{key:"confirmdenial",component:"tool_dataprivacy"}];break;case i.bulkDeny:g=[{key:"bulkdenyrequests",component:"tool_dataprivacy"},{key:"confirmbulkdenial",component:"tool_dataprivacy"}];break;case i.complete:g=[{key:"markcomplete",component:"tool_dataprivacy"},{key:"confirmcompletion",component:"tool_dataprivacy"}]}var h="";d.get_strings(g).then(function(a){h=a[0];var b=a[1];return e.create({title:h,body:b,type:e.types.SAVE_CANCEL})}).then(function(a){a.setSaveButtonText(h),a.getRoot().on(f.save,function(){p(b.wsfunction,b.wsparams)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show()})["catch"](c.exception)}function p(a,d){var e={methodname:a,args:d};b.call([e])[0].done(function(a){a.result?window.location.reload():c.addNotification({message:a.warnings[0].message,type:"error"})}).fail(c.exception)}var q={APPROVE_REQUEST:'[data-action="approve"]',DENY_REQUEST:'[data-action="deny"]',VIEW_REQUEST:'[data-action="view"]',MARK_COMPLETE:'[data-action="complete"]',CHANGE_BULK_ACTION:'[id="bulk-action"]',CONFIRM_BULK_ACTION:'[id="confirm-bulk-action"]',SELECT_ALL:'[data-action="selectall"]'},r={APPROVE:1,DENY:2},s={SELECT_REQUEST:".selectrequests"},t=function(){this.registerEvents()};return t.prototype.registerEvents=function(){a(q.VIEW_REQUEST).click(function(d){d.preventDefault();var k=a(this).data("requestid"),m={requestid:k},n={methodname:"tool_dataprivacy_get_data_request",args:m},q=b.call([n]);a.when(q[0]).then(function(a){return a.result?a.result:(c.addNotification({message:a.warnings[0].message,type:"error"}),!1)}).then(function(a){var b=g.render("tool_dataprivacy/request_details",a),c={approvedeny:a.approvedeny,canmarkcomplete:a.canmarkcomplete};return e.create({title:a.typename,body:b,type:h.TYPE,large:!0,templateContext:c})}).then(function(a){a.getRoot().on(i.approve,function(){o(i.approve,j(k))}),a.getRoot().on(i.deny,function(){o(i.deny,l(k))}),a.getRoot().on(i.complete,function(){var a={requestid:k};p("tool_dataprivacy_mark_complete",a)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show()})["catch"](c.exception)}),a(q.APPROVE_REQUEST).click(function(b){b.preventDefault();var c=a(this).data("requestid");o(i.approve,j(c))}),a(q.DENY_REQUEST).click(function(b){b.preventDefault();var c=a(this).data("requestid");o(i.deny,l(c))}),a(q.MARK_COMPLETE).click(function(b){b.preventDefault();var c=a(this).data("requestid");o(i.complete,n(c))}),a(q.CONFIRM_BULK_ACTION).click(function(){var b=[],e="",f={},g=[{key:"selectbulkaction",component:"tool_dataprivacy"},{key:"selectdatarequests",component:"tool_dataprivacy"},{key:"ok"}],h=parseInt(a("#bulk-action").val());if(h!=r.APPROVE&&h!=r.DENY)return void d.get_strings(g).done(function(a){c.alert("",a[0],a[2])}).fail(c.exception);if(a(".selectrequests:checked").each(function(){b.push(a(this).val())}),b.length<1)return void d.get_strings(g).done(function(a){c.alert("",a[1],a[2])}).fail(c.exception);switch(h){case r.APPROVE:e=i.bulkApprove,f=k(b);break;case r.DENY:e=i.bulkDeny,f=m(b)}o(e,f)}),a(q.SELECT_ALL).change(function(b){b.preventDefault();var c=a(this).is(":checked");a(s.SELECT_REQUEST).prop("checked",c)})},t});
define('tool_dataprivacy/effective_retention_period', ["jquery"],function(a){var b={PURPOSE_SELECT:"#id_purposeid",RETENTION_FIELD_BOOST:"#id_error_retention_current",RETENTION_FIELD_CLEAN:"#fitem_id_retention_current [data-fieldtype=static]"},c=function(a){this.purposeRetentionPeriods=a,this.registerEventListeners()},d=function(){a(b.PURPOSE_SELECT).off("change")};return c.prototype.purposeRetentionPeriods=[],c.prototype.registerEventListeners=function(){a(b.PURPOSE_SELECT).on("change",function(c){var d=a(c.currentTarget).val(),e=this.purposeRetentionPeriods[d],f=a(b.RETENTION_FIELD_CLEAN);if(f.length>0)f.text(e);else{var g=a(b.RETENTION_FIELD_BOOST),h=g.siblings();h.length>0&&h.text(e)}}.bind(this))},{init:function(a){return d(),new c(a)}}});
define('tool_dataprivacy/data_deletion', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){function g(a){var g=[{key:"confirm",component:"moodle"},{key:"confirmcontextdeletion",component:"tool_dataprivacy"}],h="tool_dataprivacy_confirm_contexts_for_deletion",i="";d.get_strings(g).then(function(a){i=a[0];var b=a[1];return e.create({title:i,body:b,type:e.types.SAVE_CANCEL})}).then(function(d){return d.setSaveButtonText(i),d.getRoot().on(f.save,function(){var d={ids:a},e={methodname:h,args:d};b.call([e])[0].done(function(a){a.result?window.location.reload():c.addNotification({message:a.warnings[0].message,type:"error"})}).fail(c.exception)}),d.getRoot().on(f.hidden,function(){d.destroy()}),d}).done(function(a){a.show()}).fail(c.exception)}var h={MARK_FOR_DELETION:'[data-action="markfordeletion"]',SELECT_ALL:'[data-action="selectall"]'},i={SELECTCONTEXT:".selectcontext"},j=function(){this.registerEvents()};return j.prototype.registerEvents=function(){a(h.MARK_FOR_DELETION).click(function(b){b.preventDefault();var c=[];a(i.SELECTCONTEXT).each(function(){var b=a(this);b.is(":checked")&&c.push(b.val())}),g(c)}),a(h.SELECT_ALL).change(function(b){b.preventDefault();var c=a(this);c.is(":checked")?a(i.SELECTCONTEXT).attr("checked","checked"):a(i.SELECTCONTEXT).removeAttr("checked")})},j});
define('tool_dataprivacy/add_category', ["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],function(a,b,c,d,e,f,g){var h={CATEGORY_LINK:'[data-add-element="category"]'},i=function(a){this.contextId=a;var c=[{key:"addcategory",component:"tool_dataprivacy"},{key:"save",component:"admin"}];this.strings=b.get_strings(c),this.registerEventListeners()};return i.prototype.contextId=0,i.prototype.strings=0,i.prototype.registerEventListeners=function(){var b=a(h.CATEGORY_LINK);b.on("click",function(){return this.strings.then(function(a){e.create({type:e.types.SAVE_CANCEL,title:a[0],body:""},b).done(function(b){this.setupFormModal(b,a[1])}.bind(this))}.bind(this)).fail(d.exception)}.bind(this))},i.prototype.getBody=function(a){var b=null;return"undefined"!=typeof a&&(b={jsonformdata:JSON.stringify(a)}),g.loadFragment("tool_dataprivacy","addcategory_form",this.contextId,b)},i.prototype.setupFormModal=function(a,b){a.setLarge(),a.setSaveButtonText(b),a.getRoot().on(f.hidden,this.destroy.bind(this)),a.setBody(this.getBody()),a.getRoot().on(f.save,this.submitForm.bind(this)),a.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=a,a.show()},i.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},i.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize();c.call([{methodname:"tool_dataprivacy_create_category_form",args:{jsonformdata:JSON.stringify(b)},done:function(a){a.validationerrors?this.modal.setBody(this.getBody(b)):this.close()}.bind(this),fail:d.exception}])},i.prototype.close=function(){this.destroy(),document.location.reload()},i.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),this.modal.destroy()},i.prototype.removeListeners=function(){a(h.CATEGORY_LINK).off("click")},{getInstance:function(a){return new i(a)}}});
define('tool_dataprivacy/categoriesactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g={DELETE:'[data-action="deletecategory"]'},h=function(){this.registerEvents()};return h.prototype.registerEvents=function(){a(g.DELETE).click(function(g){g.preventDefault();var h=a(this).data("id"),i=a(this).data("name"),j=[{key:"deletecategory",component:"tool_dataprivacy"},{key:"deletecategorytext",component:"tool_dataprivacy",param:i},{key:"delete"}];d.get_strings(j).then(function(d){var g=d[0],i=d[1],j=d[2];return e.create({title:g,body:i,type:e.types.SAVE_CANCEL}).then(function(d){return d.setSaveButtonText(j),d.getRoot().on(f.save,function(){var d={methodname:"tool_dataprivacy_delete_category",args:{id:h}};b.call([d])[0].done(function(b){b.result?a('tr[data-categoryid="'+h+'"]').remove():c.addNotification({message:b.warnings[0].message,type:"error"})}).fail(c.exception)}),d.getRoot().on(f.hidden,function(){d.destroy()}),d})}).done(function(a){a.show()}).fail(c.exception)})},{init:function(){return new h}}});
define('tool_lp/menubar', ["jquery"],function(a){var b=!1,c=!1,d=function(){a(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true"),c=!1},e=function(a,b){this.menuRoot=a,this.handlers=b,this.rootMenus=this.menuRoot.children("li"),this.subMenus=this.rootMenus.children("ul"),this.subMenuItems=this.subMenus.children("li"),this.allItems=this.rootMenus.add(this.subMenuItems),this.activeItem=null,this.isChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.addAriaAttributes(),this.addEventListeners()};return e.prototype.openSubMenu=function(a){this.setOpenDirection(),d(),a.attr("aria-hidden","false"),c=!0},e.prototype.addEventListeners=function(){var e=this;b===!1&&(a(document).click(function(){c&&d()}),b=!0),this.subMenuItems.mouseenter(function(){return a(this).addClass("menu-hover"),!0}),this.subMenuItems.mouseout(function(){return a(this).removeClass("menu-hover"),!0}),this.allItems.click(function(b){return e.handleClick(a(this),b)}),this.allItems.keydown(function(b){return e.handleKeyDown(a(this),b)}),this.allItems.focus(function(){return e.handleFocus(a(this))}),this.allItems.blur(function(){return e.handleBlur(a(this))})},e.prototype.handleClick=function(b,c){c.stopPropagation();var d=b.parent();if(d.is(".tool-lp-menu"))"true"==b.children("ul").first().attr("aria-hidden")?this.openSubMenu(b.children("ul").first()):b.children("ul").first().attr("aria-hidden","true");else{this.allItems.removeClass("menu-hover menu-focus"),this.activeItem=null,this.menuRoot.find("ul").not(".root-level").attr("aria-hidden","true");var e=b.find("a").first(),f=new a.Event("click");f.target=e;var g=!1;this.handlers&&a.each(this.handlers,function(c,d){if(!g&&b.find(c).length>0){var h=a.proxy(d,e);g=h(f)===!1||f.isDefaultPrevented()}}),g||"#"===e.attr("href")||(window.location.href=e.attr("href"))}return!1},e.prototype.handleFocus=function(a){if(null===this.activeItem)this.activeItem=a;else if(a[0]!=this.activeItem[0])return!0;var b=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");if(this.allItems.removeClass("menu-focus"),this.activeItem.addClass("menu-focus"),b.addClass("menu-focus"),this.isChildOpen===!0){var c=a.parent();c.is(".tool-lp-menu")&&"true"==a.attr("aria-haspopup")&&this.openSubMenu(a.children("ul").first())}return!0},e.prototype.handleBlur=function(a){return a.removeClass("menu-focus"),!0},e.prototype.setOpenDirection=function(){var b=this.menuRoot.offset(),c=a(document.body).hasClass("dir-rtl"),d=!0,e=this.rootMenus.outerHeight(),f=this.rootMenus.outerWidth(),g=this.rootMenus.find("ul.tool-lp-sub-menu");g.css("margin-right",""),g.css("margin-left",""),g.css("margin-top",""),g.attr("aria-hidden",!1);var h=g.outerWidth(),i=g.outerHeight(),j=null,k=null,l=null,m=b.top-a(window).scrollTop();m+i>a(window).height()&&(j=i+e,g.css("margin-top","-"+j+"px")),c?b.left-h<0&&(k=h-f,g.css("margin-right","-"+k+"px")):b.left+h>a(window).width()&&(l=h-f,g.css("margin-left","-"+l+"px")),d?this.menuRoot.addClass("tool-lp-menu-open-left"):this.menuRoot.removeClass("tool-lp-menu-open-left")},e.prototype.handleKeyDown=function(a,b){if(b.altKey||b.ctrlKey)return!0;switch(b.keyCode){case this.keys.tab:this.menuRoot.find("ul").attr("aria-hidden","true"),this.allItems.removeClass("menu-focus"),this.activeItem=null,this.isChildOpen=!1;break;case this.keys.esc:var c=a.parent();return c.is(".tool-lp-menu")?a.children("ul").first().attr("aria-hidden","true"):(this.activeItem=c.parent(),this.isChildOpen=!1,this.activeItem.focus(),c.attr("aria-hidden","true")),b.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return this.handleClick(a,b);case this.keys.left:return this.activeItem=this.moveToPrevious(a),this.activeItem.focus(),b.stopPropagation(),!1;case this.keys.right:return this.activeItem=this.moveToNext(a),this.activeItem.focus(),b.stopPropagation(),!1;case this.keys.up:return this.activeItem=this.moveUp(a),this.activeItem.focus(),b.stopPropagation(),!1;case this.keys.down:return this.activeItem=this.moveDown(a),this.activeItem.focus(),b.stopPropagation(),!1}return!0},e.prototype.moveToNext=function(a){var b=a.parent(),c=b.children("li"),d=c.length,e=c.index(a),f=null,g=null;if(b.is(".tool-lp-menu"))f=e<d-1?a.next():c.first(),"true"==a.attr("aria-haspopup")&&(g=a.children("ul").first(),"false"==g.attr("aria-hidden")&&(g.attr("aria-hidden","true"),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===f.attr("aria-haspopup")&&this.isChildOpen===!0&&(g=f.children("ul").first(),this.openSubMenu(g));else if("true"==a.attr("aria-haspopup"))g=a.children("ul").first(),f=g.children("li").first(),this.openSubMenu(g);else{var h=null,i=null;h=a.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu"),h.attr("aria-hidden","true"),h.find("li").removeClass("menu-focus"),h.last().parent().removeClass("menu-focus"),i=h.last().parent(),e=this.rootMenus.index(i),f=e<this.rootMenus.length-1?i.next():this.rootMenus.first(),f.addClass("menu-focus"),"true"==f.attr("aria-haspopup")&&(g=f.children("ul").first(),f=g.children("li").first(),this.openSubMenu(g),this.isChildOpen=!0)}return f},e.prototype.moveToPrevious=function(a){var b=a.parent(),c=b.children("li"),d=c.index(a),e=null,f=null;if(b.is(".tool-lp-menu"))e=d>0?a.prev():c.last(),"true"==a.attr("aria-haspopup")&&(f=a.children("ul").first(),"false"==f.attr("aria-hidden")&&(f.attr("aria-hidden","true"),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===e.attr("aria-haspopup")&&this.isChildOpen===!0&&(f=e.children("ul").first(),this.openSubMenu(f));else{var g=b.parent(),h=g.parent();h.is(".tool-lp-menu")?(b.attr("aria-hidden","true"),a.removeClass("menu-focus"),g.removeClass("menu-focus"),d=this.rootMenus.index(g),e=d>0?g.prev():this.rootMenus.last(),e.addClass("menu-focus"),"true"==e.attr("aria-haspopup")&&(f=e.children("ul").first(),this.openSubMenu(f),this.isChildOpen=!0,e=f.children("li").first())):(e=b.parent(),b.attr("aria-hidden","true"),a.removeClass("menu-focus"))}return e},e.prototype.moveDown=function(a,b){var c=a.parent(),d=c.children("li").not(".separator"),e=d.length,f=d.index(a),g=null,h=null;if(c.is(".tool-lp-menu"))return"true"!=a.attr("aria-haspopup")?a:(h=a.children("ul").first(),g=h.children("li").first(),this.openSubMenu(h),g);if(b){var i=!1,j=f+1;for(j==e&&(j=0);j!=f;){var k=d.eq(j).html().charAt(0);if(k.toLowerCase()==b){i=!0;break}j+=1,j==e&&(j=0)}return i===!0?(g=d.eq(j),a.removeClass("menu-focus"),g):a}return g=f<e-1?d.eq(f+1):d.first(),a.removeClass("menu-focus"),g},e.prototype.moveUp=function(a){var b=a.parent(),c=b.children("li").not(".separator"),d=c.index(a),e=null;return b.is(".tool-lp-menu")?a:(e=d>0?c.eq(d-1):c.last(),a.removeClass("menu-focus"),e)},e.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar"),this.rootMenus.attr("role","menuitem"),this.rootMenus.attr("tabindex","0"),this.rootMenus.attr("aria-haspopup","true"),this.subMenus.attr("role","menu"),this.subMenus.attr("aria-hidden","true"),this.subMenuItems.attr("role","menuitem"),this.subMenuItems.attr("tabindex","-1"),this.menuRoot.addClass("tool-lp-menu"),this.allItems.addClass("tool-lp-menu-item"),this.rootMenus.addClass("tool-lp-root-menu"),this.subMenus.addClass("tool-lp-sub-menu"),this.subMenuItems.addClass("dropdown-item")},{enhance:function(b,c){a(b).each(function(b,d){var f=a(d);f.data("menubarEnhanced")!==!0&&(new e(f,c),f.data("menubarEnhanced",!0))})},closeAll:d}});
define('tool_lp/actionselector', ["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","tool_lp/event_base"],function(a,b,c,d,e,f){var g=function(a,b,c,d,e){var g=this;f.prototype.constructor.apply(this,[]),g._title=a,g._message=b,g._actions=c,g._confirm=d,g._cancel=e,g._selectedValue=null,g._reset()};return g.prototype=Object.create(f.prototype),g.prototype._selectedValue=null,g.prototype._popup=null,g.prototype._title=null,g.prototype._message=null,g.prototype._actions=null,g.prototype._confirm=null,g.prototype._cancel=null,g.prototype._afterRender=function(){var b=this;b._find('[data-action="action-selector-confirm"]').attr("disabled","disabled"),b._find('[data-region="action-selector-radio-buttons"]').change(function(){b._selectedValue=a("input[type='radio']:checked").val(),b._find('[data-action="action-selector-confirm"]').removeAttr("disabled"),b._refresh.bind(b)}),b._find('[data-action="action-selector-cancel"]').click(function(a){a.preventDefault(),b.close()}),b._find('[data-action="action-selector-confirm"]').click(function(a){a.preventDefault(),b._selectedValue.length&&(b._trigger("save",{action:b._selectedValue}),b.close())})},g.prototype.close=function(){var a=this;a._popup.close(),a._reset()},g.prototype.display=function(){var a=this;return a._render().then(function(b){a._popup=new e(a._title,b,a._afterRender.bind(a))}).fail(b.exception)},g.prototype._find=function(b){return a(this._popup.getContent()).find(b)},g.prototype._refresh=function(){var a=this;return a._render().then(function(b){a._find('[data-region="action-selector"]').replaceWith(b),a._afterRender()})},g.prototype._render=function(){var a=this,b=[];for(var c in a._actions)b.push(a._actions[c]);var e={message:a._message,choices:b,confirm:a._confirm,cancel:a._cancel};return d.render("tool_lp/action_selector",e)},g.prototype._reset=function(){this._popup=null,this._selectedValue=""},g});
define('tool_lp/dialogue', ["core/yui"],function(a){var b=function(b,c,d,e,f){this.yuiDialogue=null;var g=this;"undefined"==typeof f&&(f=!1),a.use("moodle-core-notification","timers",function(){var h="480px";f&&(h="800px"),g.yuiDialogue=new M.core.dialogue({headerContent:b,bodyContent:c,draggable:!0,visible:!1,center:!0,modal:!0,width:h}),g.yuiDialogue.after("visibleChange",function(b){b.newVal?"undefined"!=typeof d&&a.soon(function(){d(g),g.yuiDialogue.centerDialogue()}):"undefined"!=typeof e&&a.soon(function(){e(g)})}),g.yuiDialogue.show()})};return b.prototype.close=function(){this.yuiDialogue.hide(),this.yuiDialogue.destroy()},b.prototype.getContent=function(){return this.yuiDialogue.bodyNode.getDOMNode()},b});
define('tool_lp/form-user-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h,i=a(d).data("capability");"undefined"==typeof i&&(i=""),h=b.call([{methodname:"tool_lp_search_users",args:{query:e,capability:i}}]),h[0].then(function(b){var d=[],e=0;return a.each(b.users,function(b,e){var f=e,g=[];a.each(["idnumber","email","phone1","phone2","department","institution"],function(a,b){"undefined"!=typeof e[b]&&""!==e[b]&&(f.hasidentity=!0,g.push(e[b]))}),f.identity=g.join(", "),d.push(c.render("tool_lp/form-user-selector-suggestion",f))}),a.when.apply(a.when,d).then(function(){var c=arguments;a.each(b.users,function(a,b){b._label=c[e],e++}),f(b.users)})})["catch"](g)}}});
define('tool_lp/competencydialogue', ["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/dialogue"],function(a,b,c,d,e,f){var g,h=function(){};return h.prototype.triggerCompetencyViewedEvent=function(a){c.call([{methodname:"core_competency_competency_viewed",args:{id:a}}])},h.prototype.showDialogue=function(a,c){var e=this.getCompetencyDataPromise(a,c),g=this;e.done(function(c){d.render("tool_lp/competency_summary",c).done(function(b){g.triggerCompetencyViewedEvent(a),new f(c.competency.shortname,b)}).fail(b.exception)}).fail(b.exception)},h.prototype.showDialogueFromData=function(a){var c=this;d.render("tool_lp/competency_summary",a).done(function(b){c.triggerCompetencyViewedEvent(a.id),new f(a.shortname,b,c.enhanceDialogue)}).fail(b.exception)},h.prototype.clickEventHandler=function(b){var c=b.data.compdialogue,d=a(b.currentTarget),e=d.data("id"),f=!d.data("excluderelated"),g=d.data("includecourses");c.showDialogue(e,{includerelated:f,includecourses:g}),b.preventDefault()},h.prototype.getCompetencyDataPromise=function(a,d){var e=c.call([{methodname:"tool_lp_data_for_competency_summary",args:{competencyid:a,includerelated:d.includerelated||!1,includecourses:d.includecourses||!1}}]);return e[0].then(function(a){return a}).fail(b.exception)},{init:function(){"undefined"==typeof g&&(g=new h,a("body").delegate('[data-action="competency-dialogue"]',"click",{compdialogue:g},g.clickEventHandler.bind(g)))}}});
define('tool_lp/user_competency_course_navigation', ["jquery"],function(a){var b=function(b,c,d,e,f,g){this._baseUrl=d,this._userId=e+"",this._competencyId=f+"",this._courseId=g,a(b).on("change",this._userChanged.bind(this)),a(c).on("change",this._competencyChanged.bind(this))};return b.prototype._userChanged=function(b){var c=a(b.target).val(),d="?userid="+c+"&courseid="+this._courseId+"&competencyid="+this._competencyId;document.location=this._baseUrl+d},b.prototype._competencyChanged=function(b){var c=a(b.target).val(),d="?userid="+this._userId+"&courseid="+this._courseId+"&competencyid="+c;document.location=this._baseUrl+d},b.prototype._competencyId=null,b.prototype._userId=null,b.prototype._courseId=null,b.prototype._baseUrl=null,b.prototype._ignoreFirstCompetency=null,b});
define('tool_lp/competency_rule_points', ["jquery","core/str","core/templates","tool_lp/competency_rule"],function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=Object.create(d.prototype),e.prototype._container=null,e.prototype._templateLoaded=!1,e.prototype.getConfig=function(){return JSON.stringify({base:{points:this._getRequiredPoints()},competencies:this._getCompetenciesConfig()})},e.prototype._getCompetenciesConfig=function(){var b=[];return this._container.find("[data-competency]").each(function(){var c=a(this),d=c.data("competency"),e=parseInt(c.find('[name="points"]').val(),10),f=c.find('[name="required"]').prop("checked");b.push({id:d,points:e,required:f?1:0})}),b},e.prototype._getRequiredPoints=function(){return parseInt(this._container.find('[name="requiredpoints"]').val()||1,10)},e.prototype.getType=function(){return"core_competency\\competency_rule_points"},e.prototype.injectTemplate=function(b){var d,e=this,f=this._tree.getChildren(this._competency.id),g={base:{points:2},competencies:[]};if(this._templateLoaded=!1,e._competency.ruletype==e.getType())try{g=JSON.parse(e._competency.ruleconfig)}catch(h){}return d={requiredpoints:g&&g.base?g.base.points:2,competency:e._competency,children:[]},a.each(f,function(b,c){var e={id:c.id,shortname:c.shortname,required:!1,points:0};g&&a.each(g.competencies,function(a,b){b.id==e.id&&(e.required=!!b.required,e.points=b.points)}),d.children.push(e)}),c.render("tool_lp/competency_rule_points",d).then(function(a){e._container=b,b.html(a),b.find("input").change(function(){e._triggerChange()}),e._templateLoaded=!0,e._triggerChange()})},e.prototype.isValid=function(){if(!this._templateLoaded)return!1;var b=this._getRequiredPoints(),c=0,d=!0;return a.each(this._getCompetenciesConfig(),function(a,b){b.points<0&&(d=!1),c+=b.points}),d=d&&c>=b},e});
define('tool_lp/scalevalues', ["jquery","core/ajax"],function(a,b){var c=[];return{get_values:function(d){var e=a.Deferred();return"undefined"==typeof c[d]?b.call([{methodname:"core_competency_get_scale_values",args:{scaleid:d},done:function(a){c[d]=a,e.resolve(a)},fail:e.reject}]):e.resolve(c[d]),e.promise()}}});
define('tool_lp/competencyactions', ["jquery","core/url","core/templates","core/notification","core/str","core/ajax","tool_lp/dragdrop-reorder","tool_lp/tree","tool_lp/dialogue","tool_lp/menubar","tool_lp/competencypicker","tool_lp/competency_outcomes","tool_lp/competencyruleconfig","core/pending"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o,p,q,r,s,t,u=null,v=null,w=null,x=null,y=function(){var c=a('[data-region="competencyactions"]').data("competency"),f={competencyframeworkid:u.getCompetencyFrameworkId(),pagecontextid:o};null!==c&&(f.parentid=c.id);var g=function(){var c=a.param(f);window.location=b.relativeUrl("/admin/tool/lp/editcompetency.php?"+c)};null!==c&&u.hasRule(c.id)?e.get_strings([{key:"confirm",component:"moodle"},{key:"addingcompetencywillresetparentrule",component:"tool_lp",param:c.shortname},{key:"yes",component:"core"},{key:"no",component:"core"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],g)}).fail(d.exception):g()},z=function(){var b=a('[data-region="filtercompetencies"]').data("frameworkid"),c=f.call([{methodname:"core_competency_set_parent_competency",args:{competencyid:v,parentid:w}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b,search:a('[data-region="filtercompetencies"] input').val()}}]);c[1].done(F).fail(d.exception)},A=function(){if(w="undefined"==typeof w?0:w,w!=v){var a=u.getCompetency(w)||{},b=u.getCompetency(v)||{},c="movecompetencywillresetrules",f=!1;b.parentid!=w&&(a.path&&a.path.indexOf("/"+b.id+"/")>=0&&(c="movecompetencytochildofselfwillresetrules",f=f||u.hasRule(b.id)),f=f||u.hasRule(a.id)||u.hasRule(b.parentid),f?e.get_strings([{key:"confirm",component:"moodle"},{key:c,component:"tool_lp"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],z)}).fail(d.exception):z())}},B=function(b){var c=a(b.getContent()),d=c.find("[data-enhance=movetree]"),e=new h(d,(!1));e.on("selectionchanged",function(b,c){var d=c.selected;w=a(d).data("id")}),d.show(),c.on("click",'[data-action="move"]',function(){b.close(),A()}),c.on("click",'[data-action="cancel"]',function(){b.close()})},C=function(a,b){var c;for(c=0;c<b.length;c++)b[c].parentid==a.id&&(a.haschildren=!0,b[c].children=[],b[c].haschildren=!1,a.children[a.children.length]=b[c],C(b[c],b))},D=function(b){b.preventDefault();var g=a('[data-region="competencyactions"]').data("competency");v=g.id;var h=f.call([{methodname:"core_competency_search_competencies",args:{competencyframeworkid:g.competencyframeworkid,searchtext:""}},{methodname:"core_competency_read_competency_framework",args:{id:g.competencyframeworkid}}]);a.when.apply(null,h).done(function(a,b){var f,h=[];for(f=0;f<a.length;f++){var j=a[f];"0"==j.parentid&&(j.children=[],j.haschildren=0,h[h.length]=j,C(j,a))}e.get_strings([{key:"movecompetency",component:"tool_lp",param:g.shortname},{key:"move",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(a){var e={framework:b,competencies:h};c.render("tool_lp/competencies_move_tree",e).done(function(b){new i(a[0],b,B)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)},E=function(){var c=a('[data-region="competencyactions"]').data("competency"),d={competencyframeworkid:u.getCompetencyFrameworkId(),id:c.id,parentid:c.parentid,pagecontextid:o},e=a.param(d);window.location=b.relativeUrl("/admin/tool/lp/editcompetency.php?"+e)},F=function(b){c.render("tool_lp/manage_competencies_page",b).done(function(b,d){a('[data-region="managecompetencies"]').replaceWith(b),c.runTemplateJS(d)}).fail(d.exception)},G=function(b){b.preventDefault();var c=a('[data-region="filtercompetencies"]').data("frameworkid"),e=f.call([{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:c,search:a('[data-region="filtercompetencies"] input').val()}}]);e[0].done(F).fail(d.exception)},H=function(){var b=a('[data-region="competencyactions"]').data("competency"),c=f.call([{methodname:"core_competency_move_up_competency",args:{id:b.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b.competencyframeworkid,search:a('[data-region="filtercompetencies"] input').val()}}]);c[1].done(F).fail(d.exception)},I=function(){var b=a('[data-region="competencyactions"]').data("competency"),c=f.call([{methodname:"core_competency_move_down_competency",args:{id:b.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b.competencyframeworkid,search:a('[data-region="filtercompetencies"] input').val()}}]);c[1].done(F).fail(d.exception)},J=function(){var b=a('[data-region="competencyactions"]').data("competency"),g=f.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:b.id}}]);g[0].done(function(a){var b={courses:a};c.render("tool_lp/linked_courses_summary",b).done(function(a){e.get_string("linkedcourses","tool_lp").done(function(b){new i(b,a,B)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)},K=function(){r=a('[data-region="competencyactions"]').data("competency"),p||(p=new k(o,r.competencyframeworkid),p.on("save",function(b,e){var g=new n,h=e.competencyIds,i=[];a.each(h,function(a,b){i.push({methodname:"core_competency_add_related_competency",args:{competencyid:b,relatedcompetencyid:r.id}})}),i.push({methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:r.id}});var j=f.call(i);j[i.length-1].then(function(a){return c.render("tool_lp/related_competencies",a)}).then(function(b,d){a('[data-region="relatedcompetencies"]').replaceWith(b),c.runTemplateJS(d),V()}).then(g.resolve)["catch"](d.exception)})),p.setDisallowedCompetencyIDs([r.id]),p.display()},L=function(b){b.preventDefault(),r=a('[data-region="competencyactions"]').data("competency"),q.setTargetCompetencyId(r.id),q.display()},M=function(a,b){var c={id:r.id,shortname:r.shortname,idnumber:r.idnumber,description:r.description,descriptionformat:r.descriptionformat,ruletype:b.ruletype,ruleoutcome:b.ruleoutcome,ruleconfig:b.ruleconfig},e=f.call([{methodname:"core_competency_update_competency",args:{competency:c}}]);e[0].then(function(a){a&&(r.ruletype=b.ruletype,r.ruleoutcome=b.ruleoutcome,r.ruleconfig=b.ruleconfig,Y(r))})["catch"](d.exception)},N=function(){var b=a('[data-region="competencyactions"]').data("competency"),c=f.call([{methodname:"core_competency_delete_competency",args:{id:b.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b.competencyframeworkid,search:a('[data-region="filtercompetencies"] input').val()}}]);c[0].done(function(a){a===!1&&e.get_strings([{key:"competencycannotbedeleted",component:"tool_lp",param:b.shortname},{key:"cancel",component:"moodle"}]).done(function(a){d.alert(null,a[0])}).fail(d.exception)}).fail(d.exception),c[1].done(F).fail(d.exception)},O=function(){var b=a('[data-region="competencyactions"]').data("competency"),c="deletecompetency";u.hasRule(b.parentid)&&(c="deletecompetencyparenthasrule"),e.get_strings([{key:"confirm",component:"moodle"},{key:c,component:"tool_lp",param:b.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],N)}).fail(d.exception)},P=function(b){b.originalEvent.dataTransfer.setData("text",a(b.target).parent().data("id"))},Q=function(a){a.originalEvent.dataTransfer.dropEffect="move",a.preventDefault()},R=function(b){b.preventDefault(),a(this).addClass("currentdragtarget")},S=function(b){b.preventDefault(),a(this).removeClass("currentdragtarget")},T=function(b){b.preventDefault(),v=b.originalEvent.dataTransfer.getData("text"),w=a(b.target).parent().data("id"),a(this).removeClass("currentdragtarget"),A()},U=function(b){b.preventDefault();var e=this.id.substr(11),g=a('[data-region="competencyactions"]').data("competency"),h=f.call([{methodname:"core_competency_remove_related_competency",args:{relatedcompetencyid:e,competencyid:g.id}},{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:g.id}}]);h[1].done(function(b){c.render("tool_lp/related_competencies",b).done(function(b){a('[data-region="relatedcompetencies"]').replaceWith(b),V()}).fail(d.exception)}).fail(d.exception)},V=function(){a('[data-action="deleterelation"]').on("click",U)},W=function(a){a.id!==x&&(x=a.id,f.call([{methodname:"core_competency_competency_viewed",args:{id:a.id}}]))},X=function(a){var b=s[a];return b||(b="competency"),b},Y=function(b){var e=a.Deferred().resolve().promise(),g={};g.competency=b,g.showdeleterelatedaction=!0,g.showrelatedcompetencies=!0,g.showrule=!1,b.ruleoutcome!=l.NONE&&(e=l.getString(b.ruleoutcome).then(function(c){var d;return a.each(t,function(a,c){c.type==b.ruletype&&(d=c.name)}),[c,d]})),e.then(function(a){return"undefined"!=typeof a&&(g.showrule=!0,g.rule={outcome:a[0],type:a[1]}),g}).then(function(a){return c.render("tool_lp/competency_summary",a)}).then(function(b){return a('[data-region="competencyinfo"]').html(b),a('[data-action="deleterelation"]').on("click",U),c.render("tool_lp/loading",{})}).then(function(a,d){return c.replaceNodeContents('[data-region="relatedcompetencies"]',a,d),f.call([{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:b.id}}])[0]}).then(function(a){return c.render("tool_lp/related_competencies",a)}).then(function(b,d){a('[data-region="relatedcompetencies"]').replaceWith(b),c.runTemplateJS(d),V()})["catch"](d.exception)},Z=function(a){return e.get_string("taxonomy_add_"+X(a),"tool_lp")},$=function(a){return e.get_string("taxonomy_selected_"+X(a),"tool_lp")},_=function(b,c){var e=c.selected,f=a(e).data("id"),g=a('[data-region="competencyactions"] [data-action="add"]'),h=a('[data-region="competencyactionsmenu"]'),i=a('[data-region="selected-competency"]'),k=0,l=1;if(j.closeAll(),"undefined"==typeof f)a('[data-region="competencyinfo"]').html(e.clone().children().remove().end().text()),a('[data-region="competencyactions"]').data("competency",null),h.hide();else{var m=u.getCompetency(f);k=u.getCompetencyLevel(f),l=k+1,h.show(),a('[data-region="competencyactions"]').data("competency",m),Y(m),W(m)}return $(k).then(function(a){i.text(a)})["catch"](d.exception),Z(l).then(function(a){g.show().find('[data-region="term"]').text(a)})["catch"](d.exception),b.preventDefault(),!1},aa=function(a){var b=a.split(",");return b.unshift(""),delete b[0],b};return{init:function(b,c,d,e){u=b,o=c,s=aa(d),t=e,a('[data-region="competencyactions"] [data-action="add"]').on("click",y),j.enhance(".competencyactionsmenu",{'[data-action="edit"]':E,'[data-action="delete"]':O,'[data-action="move"]':D,'[data-action="moveup"]':H,'[data-action="movedown"]':I,'[data-action="linkedcourses"]':J,'[data-action="relatedcompetencies"]':K.bind(this),'[data-action="competencyrules"]':L.bind(this)}),a('[data-region="competencyactionsmenu"]').hide(),a('[data-region="competencyactions"] [data-action="add"]').hide(),a('[data-region="filtercompetencies"]').on("submit",G);var f=a('[data-region="managecompetencies"] [data-enhance="tree"]');f.on("dragstart","li>span",P).on("dragover","li>span",Q).on("dragenter","li>span",R).on("dragleave","li>span",S).on("drop","li>span",T),b.on("selectionchanged",_),q=new m(u,t),q.on("save",M.bind(this))}}});
define('tool_lp/competencies', ["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/competencypicker","tool_lp/dragdrop-reorder","core/pending"],function(a,b,c,d,e,f,g,h){var i=function(b,c,d){this.itemid=b,this.itemtype=c,this.pageContextId=d,this.pickerInstance=null,a('[data-region="actions"] button').prop("disabled",!1),this.registerEvents(),this.registerDragDrop()};return i.prototype.registerDragDrop=function(){var a=this;e.get_string("movecompetency","tool_lp").done(function(b){g.dragdrop("movecompetency",b,{identifier:"movecompetency",component:"tool_lp"},{identifier:"movecompetencyafter",component:"tool_lp"},"drag-samenode","drag-parentnode","drag-handlecontainer",function(b,c){a.handleDrop(b,c)})}).fail(b.exception)},i.prototype.handleDrop=function(d,e){var f=a(d).data("id"),g=a(e).data("id"),h=this,i=[];if("course"==h.itemtype)i=c.call([{methodname:"core_competency_reorder_course_competency",args:{courseid:h.itemid,competencyidfrom:f,competencyidto:g}}]);else if("template"==h.itemtype)i=c.call([{methodname:"core_competency_reorder_template_competency",args:{templateid:h.itemid,competencyidfrom:f,competencyidto:g}}]);else{if("plan"!=h.itemtype)return;i=c.call([{methodname:"core_competency_reorder_plan_competency",args:{planid:h.itemid,competencyidfrom:f,competencyidto:g}}])}i[0].fail(b.exception)},i.prototype.pickCompetency=function(){var e,g,i,j,k=this;return k.pickerInstance||("template"!==k.itemtype&&"course"!==k.itemtype||(j="parents"),k.pickerInstance=new f(k.pageContextId,(!1),j),k.pickerInstance.on("save",function(f,j){var l=j.competencyIds,m=new h;"course"===k.itemtype?(e=[],a.each(l,function(a,b){e.push({methodname:"core_competency_add_competency_to_course",args:{courseid:k.itemid,competencyid:b}})}),e.push({methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:k.itemid}}),g="tool_lp/course_competencies_page",i="coursecompetenciespage"):"template"===k.itemtype?(e=[],a.each(l,function(a,b){e.push({methodname:"core_competency_add_competency_to_template",args:{templateid:k.itemid,competencyid:b}})}),e.push({methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:k.itemid,pagecontext:{contextid:k.pageContextId}}}),g="tool_lp/template_competencies_page",i="templatecompetenciespage"):"plan"===k.itemtype&&(e=[],a.each(l,function(a,b){e.push({methodname:"core_competency_add_competency_to_plan",args:{planid:k.itemid,competencyid:b}})}),e.push({methodname:"tool_lp_data_for_plan_page",args:{planid:k.itemid}}),g="tool_lp/plan_page",i="plan-page"),c.call(e)[e.length-1].then(function(a){return d.render(g,a)}).then(function(b,c){d.replaceNode(a('[data-region="'+i+'"]'),b,c)}).then(m.resolve)["catch"](b.exception)})),k.pickerInstance.display()},i.prototype.doDelete=function(e){var f=this,g=[],h="",i="";"course"==f.itemtype?(g=c.call([{methodname:"core_competency_remove_competency_from_course",args:{courseid:f.itemid,competencyid:e}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:f.itemid}}]),h="tool_lp/course_competencies_page",i="coursecompetenciespage"):"template"==f.itemtype?(g=c.call([{methodname:"core_competency_remove_competency_from_template",args:{templateid:f.itemid,competencyid:e}},{methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:f.itemid,pagecontext:{contextid:f.pageContextId}}}]),h="tool_lp/template_competencies_page",i="templatecompetenciespage"):"plan"==f.itemtype&&(g=c.call([{methodname:"core_competency_remove_competency_from_plan",args:{planid:f.itemid,competencyid:e}},{methodname:"tool_lp_data_for_plan_page",args:{planid:f.itemid}}]),h="tool_lp/plan_page",i="plan-page"),g[1].done(function(c){d.render(h,c).done(function(b,c){a('[data-region="'+i+'"]').replaceWith(b),d.runTemplateJS(c)}).fail(b.exception)}).fail(b.exception)},i.prototype.deleteHandler=function(a){var d,f=this,g=[];if("course"==f.itemtype)d="unlinkcompetencycourse";else if("template"==f.itemtype)d="unlinkcompetencytemplate";else{if("plan"!=f.itemtype)return;d="unlinkcompetencyplan"}g=c.call([{methodname:"core_competency_read_competency",args:{id:a}}]),g[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:d,component:"tool_lp",param:c.shortname},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){f.doDelete(a)})}).fail(b.exception)}).fail(b.exception)},i.prototype.registerEvents=function(){var e=this;"course"==e.itemtype&&a('[data-region="coursecompetenciespage"]').on("change",'select[data-field="ruleoutcome"]',function(f){var g=new h,i=[],j="tool_lp/course_competencies_page",k="coursecompetenciespage",l=a(f.target).data("id"),m=a(f.target).val();i=c.call([{methodname:"core_competency_set_course_competency_ruleoutcome",args:{coursecompetencyid:l,ruleoutcome:m}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:e.itemid}}]),i[1].then(function(a){return d.render(j,a)}).then(function(b,c){return d.replaceNode(a('[data-region="'+k+'"]'),b,c)}).then(g.resolve)["catch"](b.exception)}),a('[data-region="actions"] button').click(function(a){var b=new h;a.preventDefault(),e.pickCompetency().then(b.resolve)["catch"]()}),a('[data-action="delete-competency-link"]').click(function(b){b.preventDefault();var c=a(b.target).closest("[data-id]").data("id");e.deleteHandler(c)})},i});
define('tool_lp/competency_outcomes', ["jquery","core/str"],function(a,b){var c=0,d=1,e=2,f=3;return{NONE:c,EVIDENCE:d,COMPLETE:e,RECOMMEND:f,getAll:function(){var a=this;return b.get_strings([{key:"competencyoutcome_none",component:"tool_lp"},{key:"competencyoutcome_evidence",component:"tool_lp"},{key:"competencyoutcome_recommend",component:"tool_lp"},{key:"competencyoutcome_complete",component:"tool_lp"}]).then(function(b){var c={};return c[a.NONE]={code:a.NONE,name:b[0]},c[a.EVIDENCE]={code:a.EVIDENCE,name:b[1]},c[a.RECOMMEND]={code:a.RECOMMEND,name:b[2]},c[a.COMPLETE]={code:a.COMPLETE,name:b[3]},c})},getString:function(b){var c=this,d=c.getAll();return d.then(function(c){return"undefined"==typeof c[b]?a.Deferred().reject().promise():c[b].name})}}});
define('tool_lp/user_competency_workflow', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/event_base"],function(a,b,c,d,e,f,g){var h=function(){g.prototype.constructor.apply(this,[])};return h.prototype=Object.create(g.prototype),h.prototype._nodeSelector='[data-node="user-competency"]',h.prototype._cancelReviewRequest=function(a){var b={methodname:"core_competency_user_competency_cancel_review_request",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-request-cancelled",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.cancelReviewRequest=function(a){this._cancelReviewRequest(a)},h.prototype._cancelReviewRequestHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.cancelReviewRequest(c)},h.prototype._requestReview=function(a){var b={methodname:"core_competency_user_competency_request_review",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-requested",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.requestReview=function(a){this._requestReview(a)},h.prototype._requestReviewHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.requestReview(c)},h.prototype._startReview=function(a){var b={methodname:"core_competency_user_competency_start_review",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-started",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.startReview=function(a){this._startReview(a)},h.prototype._startReviewHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.startReview(c)},h.prototype._stopReview=function(a){var b={methodname:"core_competency_user_competency_stop_review",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-stopped",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.stopReview=function(a){this._stopReview(a)},h.prototype._stopReviewHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.stopReview(c)},h.prototype.enhanceMenubar=function(a){f.enhance(a,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this)})},h.prototype._findUserCompetencyData=function(a){var b,c=a.parents(this._nodeSelector);if(1!=c.length)throw new Error("The evidence node was not located.");if(b=c.data(),"undefined"==typeof b||"undefined"==typeof b.userid||"undefined"==typeof b.competencyid)throw new Error("User competency data could not be found.");return b},h.prototype.enhanceMenubar=function(a){f.enhance(a,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this),'[data-action="start-review"]':this._startReviewHandler.bind(this),'[data-action="stop-review"]':this._stopReviewHandler.bind(this)})},h.prototype.registerEvents=function(b){var c=a(b);c.find('[data-action="request-review"]').click(this._requestReviewHandler.bind(this)),c.find('[data-action="cancel-review-request"]').click(this._cancelReviewRequestHandler.bind(this)),c.find('[data-action="start-review"]').click(this._startReviewHandler.bind(this)),c.find('[data-action="stop-review"]').click(this._stopReviewHandler.bind(this))},h});
define('tool_lp/competency_rule', ["jquery"],function(a){var b=function(b){this._eventNode=a("<div>"),this._ready=a.Deferred(),this._tree=b};return b.prototype._competency=null,b.prototype._eventNode=null,b.prototype._ready=null,b.prototype._tree=null,b.prototype.canConfig=function(){return this._tree.hasChildren(this._competency.id)},b.prototype.getConfig=function(){return null},b.prototype.getType=function(){throw new Error("Not implemented")},b.prototype.init=function(){return this._load()},b.prototype.injectTemplate=function(){return a.Deferred().reject().promise()},b.prototype.isValid=function(){return!1},b.prototype._load=function(){return a.when()},b.prototype.on=function(a,b){this._eventNode.on(a,b)},b.prototype.setTargetCompetency=function(a){this._competency=a},b.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},b.prototype._triggerChange=function(){this._trigger("change",this)},b});
define('tool_lp/form-cohort-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h,i=parseInt(a(d).data("contextid"),10),j=a(d).data("includes");h=b.call([{methodname:"tool_lp_search_cohorts",args:{query:e,context:{contextid:i},includes:j}}]),h[0].then(function(b){var d=[],e=0;return a.each(b.cohorts,function(a,b){d.push(c.render("tool_lp/form-cohort-selector-suggestion",b))}),a.when.apply(a.when,d).then(function(){var c=arguments;a.each(b.cohorts,function(a,b){b._label=c[e],e++}),f(b.cohorts)})})["catch"](g)}}});
define('tool_lp/competency_rule_all', ["jquery","core/str","tool_lp/competency_rule"],function(a,b,c){var d=function(){c.apply(this,arguments)};return d.prototype=Object.create(c.prototype),d.prototype.getType=function(){return"core_competency\\competency_rule_all"},d.prototype.isValid=function(){return!0},d});
define('tool_lp/evidence_delete', ["jquery","core/notification","core/ajax","core/str","core/log"],function(a,b,c,d,e){var f={},g=function(g,h){"undefined"==typeof f[g]&&(f[g]=a("body").delegate(g,"click",function(f){var g=a(f.currentTarget).parents(h);if(!g.length||g.length>1)return void e.error("None or too many evidence container were found.");var i=g.data("id");return i?(f.preventDefault(),f.stopPropagation(),void d.get_strings([{key:"confirm",component:"moodle"},{key:"areyousure",component:"moodle"},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){b.confirm(a[0],a[1],a[2],a[3],function(){var a=c.call([{methodname:"core_competency_delete_evidence",args:{id:i}}]);a[0].then(function(){g.remove()}).fail(b.exception)})}).fail(b.exception)):void e.error("Evidence ID was not found.")}))};return{register:g}});
define('tool_lp/event_base', ["jquery"],function(a){var b=function(){this._eventNode=a("<div></div>")};return b.prototype._eventNode=null,b.prototype.on=function(a,b){this._eventNode.on(a,b)},b.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},b});
define('tool_lp/competencypicker', ["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","core/str","tool_lp/tree","core/pending"],function(a,b,c,d,e,f,g,h){var i=function(b,c,d,e){var f=this;f._eventNode=a("<div></div>"),f._frameworks=[],f._reset(),f._pageContextId=b,f._pageContextIncludes=d||"children",f._multiSelect="undefined"==typeof e||e===!0,c&&(f._frameworkId=c,f._singleFramework=!0)};return i.prototype._competencies=null,i.prototype._disallowedCompetencyIDs=null,i.prototype._eventNode=null,i.prototype._frameworks=null,i.prototype._frameworkId=null,i.prototype._pageContextId=null,i.prototype._pageContextIncludes=null,i.prototype._popup=null,i.prototype._searchText="",i.prototype._selectedCompetencies=null,i.prototype._singleFramework=!1,i.prototype._multiSelect=!0,i.prototype._onlyVisible=!0,i.prototype._afterRender=function(){var c=this,d=new g(c._find("[data-enhance=linktree]"),c._multiSelect);c._find("[data-enhance=linktree]").show(),d.on("selectionchanged",function(b,d){var e=d.selected;b.preventDefault();var f=[];a.each(e,function(b,d){var e=a(d).data("id"),g=!0;"undefined"==typeof e?g=!1:a.each(c._disallowedCompetencyIDs,function(a,b){b==e&&(g=!1)}),g&&f.push(e)}),c._selectedCompetencies=f,c._selectedCompetencies.length?c._find('[data-region="competencylinktree"] [data-action="add"]').removeAttr("disabled"):c._find('[data-region="competencylinktree"] [data-action="add"]').attr("disabled","disabled")}),c._singleFramework||c._find('[data-action="chooseframework"]').change(function(d){c._frameworkId=a(d.target).val(),c._loadCompetencies().then(c._refresh.bind(c))["catch"](b.exception)}),c._find('[data-region="filtercompetencies"] button').click(function(b){return b.preventDefault(),a(b.target).attr("disabled","disabled"),c._searchText=c._find('[data-region="filtercompetencies"] input').val()||"",c._refresh().always(function(){a(b.target).removeAttr("disabled")})}),c._find('[data-region="competencylinktree"] [data-action="cancel"]').click(function(a){a.preventDefault(),c.close()}),c._find('[data-region="competencylinktree"] [data-action="add"]').click(function(a){a.preventDefault();var b=new h;c._selectedCompetencies.length&&(c._multiSelect?c._trigger("save",{competencyIds:c._selectedCompetencies}):c._trigger("save",{competencyId:c._selectedCompetencies[0]}),c.close(),b.resolve())});var e=c._selectedCompetencies.slice(0);a.each(e,function(a,b){var e=c._find("[data-id="+b+"]");e.length&&(d.toggleItem(e),d.updateFocus(e))})},i.prototype.close=function(){var a=this;a._popup.close(),a._reset()},i.prototype.display=function(){var c=this;return a.when(f.get_string("competencypicker","tool_lp"),c._render()).then(function(a,b){c._popup=new e(a,b[0],c._afterRender.bind(c))})["catch"](b.exception)},i.prototype._fetchCompetencies=function(a,d){var e=this;return c.call([{methodname:"core_competency_search_competencies",args:{searchtext:d,competencyframeworkid:a}}])[0].done(function(a){function b(a,c){for(var d=0;d<c.length;d++)c[d].parentid==a.id&&(a.haschildren=!0,c[d].children=[],c[d].haschildren=!1,a.children[a.children.length]=c[d],b(c[d],c))}var c,d,f=[];for(c=0;c<a.length;c++)d=a[c],"0"==d.parentid&&(d.children=[],d.haschildren=0,f[f.length]=d,b(d,a));e._competencies=f}).fail(b.exception)},i.prototype._find=function(b){return a(this._popup.getContent()).find(b)},i.prototype._getFramework=function(b){var c;return a.each(this._frameworks,function(a,d){if(d.id==b)return void(c=d)}),c},i.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._frameworkId,this._searchText)},i.prototype._loadFrameworks=function(){var d,e=this;return e._frameworks.length>0?a.when():(d=e._singleFramework?c.call([{methodname:"core_competency_read_competency_framework",args:{id:this._frameworkId}}])[0].then(function(a){return[a]}):c.call([{methodname:"core_competency_list_competency_frameworks",args:{sort:"shortname",context:{contextid:e._pageContextId},includes:e._pageContextIncludes,onlyvisible:e._onlyVisible}}])[0],d.done(function(a){e._frameworks=a}).fail(b.exception))},i.prototype.on=function(a,b){this._eventNode.on(a,b)},i.prototype._preRender=function(){var b=this;return b._loadFrameworks().then(function(){return!b._frameworkId&&b._frameworks.length>0&&(b._frameworkId=b._frameworks[0].id),b._frameworkId?b._loadCompetencies():(b._frameworks=[],a.when())})},i.prototype._refresh=function(){var a=this;return a._render().then(function(b){a._find('[data-region="competencylinktree"]').replaceWith(b),a._afterRender()})},i.prototype._render=function(){var b=this;return b._preRender().then(function(){b._singleFramework||a.each(b._frameworks,function(a,c){c.id==b._frameworkId?c.selected=!0:c.selected=!1});var c={competencies:b._competencies,framework:b._getFramework(b._frameworkId),frameworks:b._frameworks,search:b._searchText,singleFramework:b._singleFramework};return d.render("tool_lp/competency_picker",c)})},i.prototype._reset=function(){this._competencies=[],this._disallowedCompetencyIDs=[],this._popup=null,this._searchText="",this._selectedCompetencies=[]},i.prototype.setDisallowedCompetencyIDs=function(a){this._disallowedCompetencyIDs=a},i.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},i});
define('tool_lp/competencypicker_user_plans', ["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/tree","tool_lp/competencypicker"],function(a,b,c,d,e,f,g){var h=function(a,b,c){g.prototype.constructor.apply(this,[1,!1,"self",c]),this._userId=a,this._plans=[],b&&(this._planId=b,this._singlePlan=!0)};return h.prototype=Object.create(g.prototype),h.prototype._plans=null,h.prototype._planId=null,h.prototype._singlePlan=!1,h.prototype._userId=null,h.prototype._afterRender=function(){var c=this;g.prototype._afterRender.apply(c,arguments),c._singlePlan||c._find('[data-action="chooseplan"]').change(function(d){c._planId=a(d.target).val(),c._loadCompetencies().then(c._refresh.bind(c))["catch"](b.exception)})},h.prototype._fetchCompetencies=function(a,d){var e=this;return c.call([{methodname:"core_competency_list_plan_competencies",args:{id:a}}])[0].done(function(a){var b,c,f=[];for(b=0;b<a.length;b++)c=a[b].competency,c.shortname.toLowerCase().indexOf(d.toLowerCase())<0||(c.children=[],c.haschildren=0,f.push(c));e._competencies=f}).fail(b.exception)},h.prototype._getPlan=function(b){var c;return a.each(this._plans,function(a,d){if(d.id==b)return void(c=d)}),c},h.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._planId,this._searchText)},h.prototype._loadPlans=function(){var d,e=this;return e._plans.length>0?a.when():(d=e._singlePlan?c.call([{methodname:"core_competency_read_plan",args:{id:this._planId}}])[0].then(function(a){return[a]}):c.call([{methodname:"core_competency_list_user_plans",args:{userid:e._userId}}])[0],d.done(function(a){e._plans=a}).fail(b.exception))},h.prototype._preRender=function(){var b=this;return b._loadPlans().then(function(){return!b._planId&&b._plans.length>0&&(b._planId=b._plans[0].id),b._planId?b._loadCompetencies():(b._plans=[],a.when())})},h.prototype._render=function(){var b=this;return b._preRender().then(function(){b._singlePlan||a.each(b._plans,function(a,c){c.id==b._planId?c.selected=!0:c.selected=!1});var c={competencies:b._competencies,plan:b._getPlan(b._planId),plans:b._plans,search:b._searchText,singlePlan:b._singlePlan};return d.render("tool_lp/competency_picker_user_plans",c)})},h});
define('tool_lp/competency_plan_navigation', ["jquery"],function(a){var b=function(b,c,d,e,f){this._baseUrl=c,this._userId=d+"",this._competencyId=e+"",this._planId=f,this._ignoreFirstCompetency=!0,a(b).on("change",this._competencyChanged.bind(this))};return b.prototype._competencyChanged=function(b){if(this._ignoreFirstCompetency)return void(this._ignoreFirstCompetency=!1);var c=a(b.target).val(),d="?userid="+this._userId+"&planid="+this._planId+"&competencyid="+c;document.location=this._baseUrl+d},b.prototype._competencyId=null,b.prototype._userId=null,b.prototype._planId=null,b.prototype._baseUrl=null,b.prototype._ignoreFirstCompetency=null,b});
define('tool_lp/user_competency_info', ["jquery","core/notification","core/ajax","core/templates"],function(a,b,c,d){var e=function(a,b,c,d,e,f){this._rootElement=a,this._competencyId=b,this._userId=c,this._planId=d,this._courseId=e,this._valid=!0,this._displayuser="undefined"!=typeof f&&f,this._planId?(this._methodName="tool_lp_data_for_user_competency_summary_in_plan",this._args={competencyid:this._competencyId,planid:this._planId},this._templateName="tool_lp/user_competency_summary_in_plan"):this._courseId?(this._methodName="tool_lp_data_for_user_competency_summary_in_course",this._args={userid:this._userId,competencyid:this._competencyId,courseid:this._courseId},this._templateName="tool_lp/user_competency_summary_in_course"):(this._methodName="tool_lp_data_for_user_competency_summary",this._args={userid:this._userId,competencyid:this._competencyId},this._templateName="tool_lp/user_competency_summary")};return e.prototype.reload=function(){var a=this,e=[];this._valid&&(e=c.call([{methodname:this._methodName,args:this._args}]),e[0].done(function(c){a._displayuser&&(c.displayuser=!0),d.render(a._templateName,c).done(function(b,c){d.replaceNode(a._rootElement,b,c)}).fail(b.exception)}).fail(b.exception))},e.prototype._rootElement=null,e.prototype._courseId=null,e.prototype._valid=null,e.prototype._planId=null,e.prototype._competencyId=null,e.prototype._userId=null,e.prototype._methodName=null,e.prototype._args=null,e.prototype._templateName=null,e.prototype._displayuser=!1,e});
define('tool_lp/frameworkactions', ["jquery","core/templates","core/ajax","core/notification","core/str"],function(a,b,c,d,e){var f=0,g=0,h=function(c,d){a('[data-region="managecompetencies"]').replaceWith(c),b.runTemplateJS(d)},i=function(a){b.render("tool_lp/manage_competency_frameworks_page",a).done(h).fail(d.exception)},j=function(b){b.preventDefault(),g=a(this).attr("data-frameworkid");var e=c.call([{methodname:"core_competency_duplicate_competency_framework",args:{id:g}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:f}}}]);e[1].done(i).fail(d.exception)},k=function(){var a=c.call([{methodname:"core_competency_delete_competency_framework",args:{id:g}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:f}}}]);a[0].done(function(a){if(a===!1){var b=c.call([{methodname:"core_competency_read_competency_framework",args:{id:g}}]);b[0].done(function(a){e.get_strings([{key:"frameworkcannotbedeleted",component:"tool_lp",param:a.shortname},{key:"cancel",component:"moodle"}]).done(function(a){d.alert(null,a[0])}).fail(d.exception)})}}).fail(d.exception),a[1].done(i).fail(d.exception)},l=function(b){b.preventDefault();var f=a(this).attr("data-frameworkid");g=f;var h=c.call([{methodname:"core_competency_read_competency_framework",args:{id:g}}]);h[0].done(function(a){e.get_strings([{key:"confirm",component:"moodle"},{key:"deletecompetencyframework",component:"tool_lp",param:a.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],k)}).fail(d.exception)}).fail(d.exception)};return{deleteHandler:l,duplicateHandler:j,init:function(a){f=a}}});
define('tool_lp/scaleconfig', ["jquery","core/notification","core/templates","core/ajax","tool_lp/dialogue","tool_lp/scalevalues"],function(a,b,c,d,e,f){var g=function(b,c,d){this.selectSelector=b,this.inputSelector=c,this.triggerSelector=d,this.originalscaleid=a(b).val(),a(b).on("change",this.scaleChangeHandler.bind(this)).change(),a(d).click(this.showConfig.bind(this))};return g.prototype.selectSelector=null,g.prototype.inputSelector=null,g.prototype.triggerSelector=null,g.prototype.scalevalues=null,g.prototype.originalscaleid=0,g.prototype.scaleid=0,g.prototype.popup=null,g.prototype.showConfig=function(){var d=this;if(this.scaleid=a(this.selectSelector).val(),!(this.scaleid<=0)){var f=a(this.selectSelector).find("option:selected").text();this.getScaleValues(this.scaleid).done(function(){var a={scalename:f,scales:d.scalevalues};c.render("tool_lp/scale_configuration_page",a).done(function(a){new e(f,a,d.initScaleConfig.bind(d))}).fail(b.exception)}).fail(b.exception)}},g.prototype.retrieveOriginalScaleConfig=function(){var b=a(this.inputSelector).val();if(""!==b){var c=a.parseJSON(b),d=c.shift();if(d.scaleid===this.originalscaleid)return c}return""},g.prototype.initScaleConfig=function(b){this.popup=b;var c=a(b.getContent());if(this.originalscaleid===this.scaleid){var d=this.retrieveOriginalScaleConfig();""!==d&&d.forEach(function(a){1===a.scaledefault&&c.find('[data-field="tool_lp_scale_default_'+a.id+'"]').attr("checked",!0),1===a.proficient&&c.find('[data-field="tool_lp_scale_proficient_'+a.id+'"]').attr("checked",!0)})}c.on("click",'[data-action="close"]',function(){this.setScaleConfig(),b.close()}.bind(this)),c.on("click",'[data-action="cancel"]',function(){b.close()})},g.prototype.setScaleConfig=function(){var b=a(this.popup.getContent()),c=[{scaleid:this.scaleid}];this.scalevalues.forEach(function(a){var d=0,e=0;b.find('[data-field="tool_lp_scale_default_'+a.id+'"]').is(":checked")&&(d=1),b.find('[data-field="tool_lp_scale_proficient_'+a.id+'"]').is(":checked")&&(e=1),(d||e)&&c.push({id:a.id,scaledefault:d,proficient:e})});var d=JSON.stringify(c);a(this.inputSelector).val(d),this.originalscaleid=this.scaleid},g.prototype.getScaleValues=function(a){return f.get_values(a).then(function(a){return this.scalevalues=a,a}.bind(this))},g.prototype.scaleChangeHandler=function(b){a(b.target).val()<=0?a(this.triggerSelector).prop("disabled",!0):a(this.triggerSelector).prop("disabled",!1)},{init:function(a,b,c){return new g(a,b,c)}}});
define('tool_lp/course_competency_settings', ["jquery","core/notification","tool_lp/dialogue","core/str","core/ajax","core/templates","core/pending"],function(a,b,c,d,e,f,g){var h=function(b){a(b).on("click",this.configureSettings.bind(this))};return h.prototype._dialogue=null,h.prototype.configureSettings=function(e){var h=new g,i=a(e.target).closest("a").data("courseid"),j=a(e.target).closest("a").data("pushratingstouserplans"),k={courseid:i,settings:{pushratingstouserplans:j}};e.preventDefault(),a.when(d.get_string("configurecoursecompetencysettings","tool_lp"),f.render("tool_lp/course_competency_settings",k)).then(function(a,b){return this._dialogue=new c(a,b[0],this.addListeners.bind(this)),this._dialogue}.bind(this)).then(h.resolve)["catch"](b.exception)},h.prototype.addListeners=function(){var a=this._find('[data-action="save"]');a.on("click",this.saveSettings.bind(this));var b=this._find('[data-action="cancel"]');b.on("click",this.cancelChanges.bind(this))},h.prototype.cancelChanges=function(a){a.preventDefault(),this._dialogue.close()},h.prototype._find=function(b){return a('[data-region="coursecompetencysettings"]').find(b)},h.prototype.saveSettings=function(a){var c=new g;a.preventDefault();var d=this._find('input[name="pushratingstouserplans"]:checked').val(),f=this._find('input[name="courseid"]').val(),h={pushratingstouserplans:d};e.call([{methodname:"core_competency_update_course_competency_settings",args:{courseid:f,settings:h}}])[0].then(function(){return this.refreshCourseCompetenciesPage()}.bind(this)).then(c.resolve)["catch"](b.exception)},h.prototype.refreshCourseCompetenciesPage=function(){var c=this._find('input[name="courseid"]').val(),d=new g;e.call([{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:c}}])[0].then(function(a){return f.render("tool_lp/course_competencies_page",a)}).then(function(b,c){f.replaceNode(a('[data-region="coursecompetenciespage"]'),b,c),this._dialogue.close()}.bind(this)).then(d.resolve)["catch"](b.exception)},h});
define('tool_lp/grade_user_competency_inline', ["jquery","core/notification","core/ajax","core/log","tool_lp/grade_dialogue","tool_lp/event_base","tool_lp/scalevalues"],function(a,b,c,d,e,f,g){var h=function(b,c,d,e,g,h,i){f.prototype.constructor.apply(this,[]);var j=a(b);if(!j.length)throw new Error("Could not find the trigger");this._scaleId=c,this._competencyId=d,this._userId=e,this._planId=g,this._courseId=h,this._chooseStr=i,this._setUp(),j.click(function(a){a.preventDefault(),this._dialogue.display()}.bind(this)),this._planId?(this._methodName="core_competency_grade_competency_in_plan",this._args={competencyid:this._competencyId,planid:this._planId}):this._courseId?(this._methodName="core_competency_grade_competency_in_course",this._args={competencyid:this._competencyId,courseid:this._courseId,userid:this._userId}):(this._methodName="core_competency_grade_competency",this._args={userid:this._userId,competencyid:this._competencyId})};return h.prototype=Object.create(f.prototype),h.prototype._setUp=function(){var a=[],d=this,f=g.get_values(d._scaleId);f.then(function(b){a.push({value:"",name:d._chooseStr});for(var c=0;c<b.length;c++){var e=b[c];a.push({value:e.id,name:e.name})}return a}).then(function(a){return new e(a)}).then(function(a){return a.on("rated",function(a,e){var f=d._args;f.grade=e.rating,f.note=e.note,c.call([{methodname:d._methodName,args:f,done:function(a){d._trigger("competencyupdated",{args:f,evidence:a})},fail:b.exception}])}),a}).then(function(a){d._dialogue=a}).fail(b.exception)},h.prototype._scaleId=null,h.prototype._competencyId=null,h.prototype._userId=null,h.prototype._planId=null,h.prototype._courseId=null,h.prototype._chooseStr=null,h.prototype._dialogue=null,h});
define('tool_lp/planactions', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h=function(a){if(this._type=a,"plan"===a)this._region='[data-region="plan-page"]',this._planNode='[data-region="plan-page"]',this._template="tool_lp/plan_page",this._contextMethod="tool_lp_data_for_plan_page";else{if("plans"!==a)throw new TypeError("Unexpected type.");this._region='[data-region="plans"]',this._planNode='[data-region="plan-node"]',this._template="tool_lp/plans_page",this._contextMethod="tool_lp_data_for_plans_page"}};return h.prototype._contextMethod=null,h.prototype._planNode=null,h.prototype._region=null,h.prototype._template=null,h.prototype._type=null,h.prototype._getContextArgs=function(a){var b=this,c={};return"plan"===b._type?c={planid:a.id}:"plans"===b._type&&(c={userid:a.userid}),c},h.prototype.refresh=function(b){var c=this._findPlanData(a(b));this._callAndRefresh([],c)},h.prototype._renderView=function(c){var d=this;return b.render(d._template,c).then(function(c,e){a(d._region).replaceWith(c),b.runTemplateJS(e)})},h.prototype._callAndRefresh=function(b,e){var f="tool_lp/planactions:_callAndRefresh-"+Math.floor(Math.random()*Math.floor(1e3));M.util.js_pending(f);var g=this;return b.push({methodname:g._contextMethod,args:g._getContextArgs(e)}),a.when.apply(a,c.call(b)).then(function(){return g._renderView(arguments[arguments.length-1])}).fail(d.exception).always(function(){return M.util.js_complete(f)})},h.prototype._doDelete=function(a){var b=this,c=[{methodname:"core_competency_delete_plan",args:{id:a.id}}];b._callAndRefresh(c,a)},h.prototype.deletePlan=function(a){var b,f=this;b=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]),b[0].done(function(b){e.get_strings([{key:"confirm",component:"moodle"},{key:"deleteplan",component:"tool_lp",param:b.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){f._doDelete(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doReopenPlan=function(a){var b=this,c=[{methodname:"core_competency_reopen_plan",args:{planid:a.id}}];b._callAndRefresh(c,a)},h.prototype.reopenPlan=function(a){var b=this,f=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]);f[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:"reopenplanconfirm",component:"tool_lp",param:c.name},{key:"reopenplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){b._doReopenPlan(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doCompletePlan=function(a){var b=this,c=[{methodname:"core_competency_complete_plan",args:{planid:a.id}}];b._callAndRefresh(c,a)},h.prototype.completePlan=function(a){var b=this,f=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]);f[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:"completeplanconfirm",component:"tool_lp",param:c.name},{key:"completeplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){b._doCompletePlan(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doUnlinkPlan=function(a){var b=this,c=[{methodname:"core_competency_unlink_plan_from_template",args:{planid:a.id}}];b._callAndRefresh(c,a)},h.prototype.unlinkPlan=function(a){var b=this,f=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]);f[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:"unlinkplantemplateconfirm",component:"tool_lp",param:c.name},{key:"unlinkplantemplate",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){b._doUnlinkPlan(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doRequestReview=function(a){var b=[{methodname:"core_competency_plan_request_review",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.requestReview=function(a){this._doRequestReview(a)},h.prototype._doCancelReviewRequest=function(a){var b=[{methodname:"core_competency_plan_cancel_review_request",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.cancelReviewRequest=function(a){this._doCancelReviewRequest(a)},h.prototype._doStartReview=function(a){var b=[{methodname:"core_competency_plan_start_review",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.startReview=function(a){this._doStartReview(a)},h.prototype._doStopReview=function(a){var b=[{methodname:"core_competency_plan_stop_review",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.stopReview=function(a){this._doStopReview(a)},h.prototype._doApprove=function(a){var b=[{methodname:"core_competency_approve_plan",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.approve=function(a){this._doApprove(a)},h.prototype._doUnapprove=function(a){var b=[{methodname:"core_competency_unapprove_plan",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.unapprove=function(a){this._doUnapprove(a)},h.prototype._showLinkedCoursesHandler=function(f){f.preventDefault();var h=a(f.target).data("id"),i=c.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:h}}]);i[0].done(function(a){var c={courses:a};b.render("tool_lp/linked_courses_summary",c).done(function(a){e.get_string("linkedcourses","tool_lp").done(function(b){new g(b,a)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)},h.prototype._eventHandler=function(b,c){c.preventDefault();var d=this._findPlanData(a(c.target));this[b](d)},h.prototype._findPlanData=function(b){var c,d=b.parentsUntil(a(this._region).parent(),this._planNode);if(1!=d.length)throw new Error("The plan node was not located.");if(c=d.data(),"undefined"==typeof c||"undefined"==typeof c.id)throw new Error("Plan data could not be found.");return c},h.prototype.enhanceMenubar=function(a){f.enhance(a,{'[data-action="plan-delete"]':this._eventHandler.bind(this,"deletePlan"),'[data-action="plan-complete"]':this._eventHandler.bind(this,"completePlan"),'[data-action="plan-reopen"]':this._eventHandler.bind(this,"reopenPlan"),'[data-action="plan-unlink"]':this._eventHandler.bind(this,"unlinkPlan"),'[data-action="plan-request-review"]':this._eventHandler.bind(this,"requestReview"),'[data-action="plan-cancel-review-request"]':this._eventHandler.bind(this,"cancelReviewRequest"),'[data-action="plan-start-review"]':this._eventHandler.bind(this,"startReview"),'[data-action="plan-stop-review"]':this._eventHandler.bind(this,"stopReview"),'[data-action="plan-approve"]':this._eventHandler.bind(this,"approve"),'[data-action="plan-unapprove"]':this._eventHandler.bind(this,"unapprove")})},h.prototype.registerEvents=function(){var b=a(this._region);b.find('[data-action="plan-delete"]').click(this._eventHandler.bind(this,"deletePlan")),b.find('[data-action="plan-complete"]').click(this._eventHandler.bind(this,"completePlan")),b.find('[data-action="plan-reopen"]').click(this._eventHandler.bind(this,"reopenPlan")),b.find('[data-action="plan-unlink"]').click(this._eventHandler.bind(this,"unlinkPlan")),b.find('[data-action="plan-request-review"]').click(this._eventHandler.bind(this,"requestReview")),b.find('[data-action="plan-cancel-review-request"]').click(this._eventHandler.bind(this,"cancelReviewRequest")),b.find('[data-action="plan-start-review"]').click(this._eventHandler.bind(this,"startReview")),b.find('[data-action="plan-stop-review"]').click(this._eventHandler.bind(this,"stopReview")),b.find('[data-action="plan-approve"]').click(this._eventHandler.bind(this,"approve")),b.find('[data-action="plan-unapprove"]').click(this._eventHandler.bind(this,"unapprove")),b.find('[data-action="find-courses-link"]').click(this._showLinkedCoursesHandler.bind(this))},h});
define('tool_lp/tree', ["jquery","core/url","core/log"],function(a,b,c){var d=a('<img alt="" src="'+b.imageUrl("t/expanded")+'"/>'),e=a('<img alt="" src="'+b.imageUrl("t/collapsed")+'"/>'),f=function(b,c){this.treeRoot=a(b),this.multiSelect="undefined"==typeof c||c===!0,this.items=this.treeRoot.find("li"),this.expandAll=this.items.length<20,this.parents=this.treeRoot.find("li:has(ul)"),c&&this.treeRoot.attr("aria-multiselectable","true"),this.items.attr("aria-selected","false"),this.visibleItems=null,this.activeItem=null,this.lastActiveItem=null,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,eight:56,asterisk:106},this.init(),this.bindEventHandlers()};return f.prototype.init=function(){this.parents.attr("aria-expanded","true"),this.parents.prepend(d.clone()),this.items.attr("role","tree-item"),this.items.attr("tabindex","-1"),this.parents.attr("role","group"),this.treeRoot.attr("role","tree"),this.visibleItems=this.treeRoot.find("li");var b=this;this.expandAll||(this.parents.each(function(){b.collapseGroup(a(this))}),this.expandGroup(this.parents.first()))},f.prototype.expandGroup=function(a){var b=a.children("ul");b.show().attr("aria-hidden","false"),a.attr("aria-expanded","true"),a.children("img").attr("src",d.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},f.prototype.collapseGroup=function(a){var b=a.children("ul");b.hide().attr("aria-hidden","true"),a.attr("aria-expanded","false"),a.children("img").attr("src",e.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},f.prototype.toggleGroup=function(a){"true"==a.attr("aria-expanded")?this.collapseGroup(a):this.expandGroup(a)},f.prototype.triggerChange=function(){var a=this.items.filter("[aria-selected=true]");this.multiSelect||(a=a.first()),this.treeRoot.trigger("selectionchanged",{selected:a})},f.prototype.multiSelectItem=function(b){if(this.multiSelect){if(null!==this.lastActiveItem){for(var c=this.visibleItems.index(this.lastActiveItem),d=this.visibleItems.index(this.activeItem),e=null;c<d;)e=a(this.visibleItems.get(c)),e.attr("aria-selected","true"),c++;for(;c>d;)e=a(this.visibleItems.get(c)),e.attr("aria-selected","true"),c--}}else this.items.attr("aria-selected","false");b.attr("aria-selected","true"),this.triggerChange()},f.prototype.selectItem=function(a){for(var b=a.parent();"tree"!=b.attr("role");)b=b.parent(),"false"==b.attr("aria-expanded")&&this.expandGroup(b),b=b.parent();this.items.attr("aria-selected","false"),a.attr("aria-selected","true"),this.triggerChange()},f.prototype.toggleItem=function(a){if(!this.multiSelect)return void this.selectItem(a);var b=a.attr("aria-selected");b="true"===b?"false":"true",a.attr("aria-selected",b),this.triggerChange()},f.prototype.updateFocus=function(a){this.lastActiveItem=this.activeItem,this.activeItem=a;for(var b=a.parent();"tree"!=b.attr("role");)b=b.parent(),"false"==b.attr("aria-expanded")&&this.expandGroup(b),b=b.parent();this.items.attr("tabindex","-1"),a.attr("tabindex",0)},f.prototype.handleKeyDown=function(b,c){var d=this.visibleItems.index(b),e=null,f=c.shiftKey||c.ctrlKey||c.metaKey||c.altKey,g=this;switch(c.keyCode){case this.keys.home:return e=this.parents.first(),e.focus(),c.shiftKey?this.multiSelectItem(e):f||this.selectItem(e),c.stopPropagation(),!1;case this.keys.end:return e=this.visibleItems.last(),e.focus(),c.shiftKey?this.multiSelectItem(e):f||this.selectItem(e),c.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return c.shiftKey?this.multiSelectItem(b):c.metaKey||c.ctrlKey?this.toggleItem(b):this.selectItem(b),c.stopPropagation(),!1;case this.keys.left:if(b.has("ul")&&"true"==b.attr("aria-expanded"))this.collapseGroup(b);else{var h=b.parent(),i=h.parent();i.is("li")&&(i.focus(),c.shiftKey?this.multiSelectItem(i):f||this.selectItem(i))}return c.stopPropagation(),!1;case this.keys.right:return b.has("ul")&&"false"==b.attr("aria-expanded")?this.expandGroup(b):(e=b.children("ul").children("li").first(),e.length>0&&(e.focus(),c.shiftKey?this.multiSelectItem(e):f||this.selectItem(e))),c.stopPropagation(),!1;case this.keys.up:if(d>0){var j=this.visibleItems.eq(d-1);j.focus(),c.shiftKey?this.multiSelectItem(j):f||this.selectItem(j)}return c.stopPropagation(),!1;case this.keys.down:if(d<this.visibleItems.length-1){var k=this.visibleItems.eq(d+1);k.focus(),c.shiftKey?this.multiSelectItem(k):f||this.selectItem(k)}return c.stopPropagation(),!1;case this.keys.asterisk:return this.parents.each(function(){g.expandGroup(a(this))}),c.stopPropagation(),!1;case this.keys.eight:return c.shiftKey&&(this.parents.each(function(){g.expandGroup(a(this))}),c.stopPropagation()),!1}return!0},f.prototype.handleKeyPress=function(a,b){if(b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)return!0;switch(b.keyCode){case this.keys.tab:return!0;case this.keys.enter:case this.keys.home:case this.keys.end:case this.keys.left:case this.keys.right:case this.keys.up:case this.keys.down:return b.stopPropagation(),!1;default:var c=String.fromCharCode(b.which),d=!1,e=this.visibleItems.index(a),f=this.visibleItems.length,g=e+1;for(g==f&&(g=0);g!=e;){var h=this.visibleItems.eq(g),i=h.text().charAt(0);if(h.has("ul")&&(i=h.find("span").text().charAt(0)),i.toLowerCase()==c){d=!0;break}g+=1,g==f&&(g=0)}return d===!0&&this.updateFocus(this.visibleItems.eq(g)),b.stopPropagation(),!1}return!0},f.prototype.on=function(a,b){"selectionchanged"!==a?c.warning('Invalid custom event name for tree. Only "selectionchanged" is supported.'):this.treeRoot.on(a,b)},f.prototype.handleDblClick=function(a,b){return!!(b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)||(this.updateFocus(a),this.toggleGroup(a),b.stopPropagation(),!1)},f.prototype.handleExpandCollapseClick=function(a,b){return this.toggleGroup(a),b.stopPropagation(),!1},f.prototype.handleClick=function(a,b){return b.shiftKey?this.multiSelectItem(a):b.metaKey||b.ctrlKey?this.toggleItem(a):this.selectItem(a),this.updateFocus(a),b.stopPropagation(),!1},f.prototype.handleBlur=function(){return!0},f.prototype.handleFocus=function(a){return this.updateFocus(a),!0},f.prototype.bindEventHandlers=function(){var b=this;this.parents.dblclick(function(c){return b.handleDblClick(a(this),c)}),this.items.click(function(c){return b.handleClick(a(this),c)}),this.items.children("img").click(function(c){return b.handleExpandCollapseClick(a(this).parent(),c)}),this.items.keydown(function(c){return b.handleKeyDown(a(this),c)}),this.items.keypress(function(c){return b.handleKeyPress(a(this),c)}),this.items.focus(function(c){return b.handleFocus(a(this),c)}),this.items.blur(function(c){return b.handleBlur(a(this),c)})},f});
define('tool_lp/dragdrop-reorder', ["core/str","core/yui"],function(a,b){var c=null,d=function(a){var b=a.drag.get("node"),c=a.drop.get("node");this.callback(b.getDOMNode(),c.getDOMNode())};return{dragdrop:function(e,f,g,h,i,j,k,l){a.get_strings([{key:"emptydragdropregion",component:"moodle"},{key:"movecontent",component:"moodle"},{key:"tocontent",component:"moodle"}]).done(function(){b.use("moodle-tool_lp-dragdrop-reorder",function(){var a={callback:l};c&&c.destroy(),c=M.tool_lp.dragdrop_reorder({group:e,dragHandleText:f,sameNodeText:g,parentNodeText:h,sameNodeClass:i,parentNodeClass:j,dragHandleInsertClass:k,callback:b.bind(d,a)})})})}}});
define('tool_lp/templateactions', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/actionselector"],function(a,b,c,d,e,f){var g=0,h=0,i=!0,j=function(c,d){a('[data-region="managetemplates"]').replaceWith(c),b.runTemplateJS(d)},k=function(a){b.render("tool_lp/manage_templates_page",a).done(j).fail(d.exception)},l=function(){var a=c.call([{methodname:"core_competency_delete_template",args:{id:h,deleteplans:i}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:g}}}]);a[1].done(k).fail(d.exception)},m=function(b){b.preventDefault(),h=a(this).attr("data-templateid");var e=c.call([{methodname:"core_competency_duplicate_template",args:{id:h}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:g}}}]);e[1].done(k).fail(d.exception)},n=function(b){b.preventDefault();var g=a(this).attr("data-templateid");h=g,i=!0;var j=c.call([{methodname:"core_competency_read_template",args:{id:h}},{methodname:"core_competency_template_has_related_data",args:{id:h}}]);j[0].done(function(a){j[1].done(function(b){b?e.get_strings([{key:"deletetemplate",component:"tool_lp",param:a.shortname},{key:"deletetemplatewithplans",component:"tool_lp"},{key:"deleteplans",component:"tool_lp"},{key:"unlinkplanstemplate",component:"tool_lp"},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){var b=[{text:a[2],value:"delete"},{text:a[3],value:"unlink"}],c=new f(a[0],a[1],b,a[4],a[5]);c.display(),c.on("save",function(a,b){"delete"!=b.action&&(i=!1),l()})}).fail(d.exception):e.get_strings([{key:"confirm",component:"moodle"},{key:"deletetemplate",component:"tool_lp",param:a.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],l)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)};return{deleteHandler:n,duplicateHandler:m,init:function(a){g=a}}});
define('tool_lp/competencyruleconfig', ["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/competency_outcomes","core/str"],function(a,b,c,d,e,f){var g=function(b,c){this._eventNode=a("<div></div>"),this._tree=b,this._rulesModules=c,this._setUp()};return g.prototype._competency=null,g.prototype._eventNode=null,g.prototype._outcomesOption=null,g.prototype._popup=null,g.prototype._ready=null,g.prototype._rules=null,g.prototype._rulesModules=null,g.prototype._tree=null,g.prototype._afterChange=function(){this._isValid()?this._find('[data-action="save"]').prop("disabled",!1):this._find('[data-action="save"]').prop("disabled",!0)},g.prototype._afterRuleConfigChange=function(a,b){b==this._getRule()&&this._afterChange()},g.prototype._afterRender=function(){var a=this;a._find('[name="outcome"]').on("change",function(){a._switchedOutcome()}).trigger("change"),a._find('[name="rule"]').on("change",function(){a._switchedRule()}).trigger("change"),a._find('[data-action="save"]').on("click",function(){a._trigger("save",a._getConfig()),a.close()}),a._find('[data-action="cancel"]').on("click",function(){a.close()})},g.prototype.canBeConfigured=function(){var b=!1;return a.each(this._rules,function(a,c){if(c.canConfig())return void(b=!0)}),b},g.prototype.close=function(){this._popup.close(),this._popup=null},g.prototype.display=function(){var c=this;return!!c._competency&&a.when(f.get_string("competencyrule","tool_lp"),c._render()).then(function(a,b){c._popup=new d(a,b[0],c._afterRender.bind(c))}).fail(b.exception)},g.prototype._find=function(b){return a(this._popup.getContent()).find(b)},g.prototype._getApplicableOutcomesOptions=function(){var b=this,c=[];return a.each(b._outcomesOption,function(a,d){c.push({code:d.code,name:d.name,selected:d.code==b._competency.ruleoutcome})}),c},g.prototype._getApplicableRulesOptions=function(){var b=this,c=[];return a.each(b._rules,function(a,d){d.canConfig()&&c.push({name:b._getRuleName(d.getType()),type:d.getType(),selected:d.getType()==b._competency.ruletype})}),c},g.prototype._getConfig=function(){var a=this._getRule();return{ruletype:a?a.getType():null,ruleconfig:a?a.getConfig():null,ruleoutcome:this._getOutcome()}},g.prototype._getOutcome=function(){return this._find('[name="outcome"]').val()},g.prototype._getRule=function(){var b,c=this._find('[name="rule"]').val();return a.each(this._rules,function(a,d){if(d.getType()==c)return void(b=d)}),b},g.prototype._getRuleName=function(b){var c,d=this;return a.each(d._rulesModules,function(a,d){if(d.type==b)return void(c=d.name)}),c},g.prototype._initOutcomes=function(){var a=this;return e.getAll().then(function(b){a._outcomesOption=b})},g.prototype._initRules=function(){var b=this,c=[];return a.each(b._rules,function(d,e){var f=e.init().then(function(){e.setTargetCompetency(b._competency),e.on("change",b._afterRuleConfigChange.bind(b))},function(){return b._rules.splice(d,1),a.when()});c.push(f)}),a.when.apply(a.when,c)},g.prototype._isValid=function(){var a=this._getOutcome(),b=this._getRule();return a==e.NONE||!!b&&b.isValid()},g.prototype.on=function(a,b){this._eventNode.on(a,b)},g.prototype._preRender=function(){return this.ready()},g.prototype.ready=function(){return this._ready.promise()},g.prototype._render=function(){var a=this;return this._preRender().then(function(){var b;a.canBeConfigured()?(b={},b.outcomes=a._getApplicableOutcomesOptions(),b.rules=a._getApplicableRulesOptions()):b=!1;var d={competencyshortname:a._competency.shortname,config:b};return c.render("tool_lp/competency_rule_config",d)})},g.prototype.setTargetCompetencyId=function(b){var c=this;c._competency=c._tree.getCompetency(b),a.each(c._rules,function(a,b){b.setTargetCompetency(c._competency)})},g.prototype._setUp=function(){var b=this,c=[],d=[];b._ready=a.Deferred(),b._rules=[],a.each(b._rulesModules,function(a,b){d.push(b.amd)}),require(d,function(){a.each(arguments,function(a,c){var d=new c(b._tree);b._rules.push(d)}),c.push(b._initRules()),c.push(b._initOutcomes()),a.when.apply(a.when,c).always(function(){b._ready.resolve()})})},g.prototype._switchedOutcome=function(){var a=this,b=a._getOutcome();return b==e.NONE?(a._find('[data-region="rule-type"]').hide().find('[name="rule"]').val(-1),a._find('[data-region="rule-config"]').empty().hide(),void a._afterChange()):(a._find('[data-region="rule-type"]').show(),a._find('[data-region="rule-config"]').show(),void a._afterChange())},g.prototype._switchedRule=function(){var a=this,b=a._find('[data-region="rule-config"]'),c=a._getRule();return c?void c.injectTemplate(b).then(function(){b.show()}).always(function(){a._afterChange()})["catch"](function(){b.empty().hide()}):(b.empty().hide(),void a._afterChange())},g.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},g});
define('tool_lp/user_competency_plan_popup', ["jquery","core/notification","core/str","core/ajax","core/templates","tool_lp/dialogue"],function(a,b,c,d,e,f){var g=function(b,c,d){this._regionSelector=b,this._userCompetencySelector=c,this._planId=d,a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return g.prototype._handleClick=function(c){c.preventDefault();var e=a(c.target).closest("tr"),f=a(e).data("competencyid"),g=a(e).data("userid"),h=this._planId,i=d.call([{methodname:"tool_lp_data_for_user_competency_summary_in_plan",args:{competencyid:f,planid:h},done:this._contextLoaded.bind(this),fail:b.exception}]);i[0].then(function(a){var b="core_competency_user_competency_viewed_in_plan";return a.plan.iscompleted&&(b="core_competency_user_competency_plan_viewed"),d.call([{methodname:b,args:{competencyid:f,userid:g,planid:h}}])[0]})["catch"](b.exception)},g.prototype._contextLoaded=function(a){var d=this;e.render("tool_lp/user_competency_summary_in_plan",a).done(function(a,g){c.get_string("usercompetencysummary","report_competency").done(function(b){new f(b,a,e.runTemplateJS.bind(e,g),d._refresh.bind(d),(!0))}).fail(b.exception)}).fail(b.exception)},g.prototype._refresh=function(){var a=this._planId;d.call([{methodname:"tool_lp_data_for_plan_page",args:{planid:a},done:this._pageContextLoaded.bind(this),fail:b.exception}])},g.prototype._pageContextLoaded=function(a){var c=this;e.render("tool_lp/plan_page",a).done(function(a,b){e.replaceNode(c._regionSelector,a,b)}).fail(b.exception)},g.prototype._regionSelector=null,g.prototype._userCompetencySelector=null,g.prototype._planId=null,g});
define('tool_lp/user_evidence_actions', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/competencypicker_user_plans"],function(a,b,c,d,e,f,g){var h=function(a){if(this._type=a,"evidence"===a)this._region='[data-region="user-evidence-page"]',this._evidenceNode='[data-region="user-evidence-page"]',this._template="tool_lp/user_evidence_page",this._contextMethod="tool_lp_data_for_user_evidence_page";else{if("list"!==a)throw new TypeError("Unexpected type.");this._region='[data-region="user-evidence-list"]',this._evidenceNode='[data-region="user-evidence-node"]',this._template="tool_lp/user_evidence_list_page",this._contextMethod="tool_lp_data_for_user_evidence_list_page"}};return h.prototype._contextMethod=null,h.prototype._evidenceNode=null,h.prototype._region=null,h.prototype._template=null,h.prototype._type=null,h.prototype._getContextArgs=function(a){var b=this,c={};return"evidence"===b._type?c={id:a.id}:"list"===b._type&&(c={userid:a.userid}),c},h.prototype._renderView=function(c){var d=this;return b.render(d._template,c).then(function(c,e){b.replaceNode(a(d._region),c,e)})},h.prototype._callAndRefresh=function(b,e){var f=this;return b.push({methodname:f._contextMethod,args:f._getContextArgs(e)}),a.when.apply(a.when,c.call(b)).then(function(){return f._renderView(arguments[arguments.length-1])}).fail(d.exception)},h.prototype._doDelete=function(a){var b=this,c=[{methodname:"core_competency_delete_user_evidence",args:{id:a.id}}];b._callAndRefresh(c,a)},h.prototype.deleteEvidence=function(a){var b,f=this;b=c.call([{methodname:"core_competency_read_user_evidence",args:{id:a.id}}]),b[0].done(function(b){e.get_strings([{key:"confirm",component:"moodle"},{key:"deleteuserevidence",component:"tool_lp",param:b.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){f._doDelete(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._deleteEvidenceHandler=function(b){b.preventDefault();var c=this._findEvidenceData(a(b.target));this.deleteEvidence(c)},h.prototype._doCreateUserEvidenceCompetency=function(b,c){var d=this,e=[];a.each(c,function(a,c){e.push({methodname:"core_competency_create_user_evidence_competency",args:{userevidenceid:b.id,competencyid:c}})}),d._callAndRefresh(e,b)},h.prototype.createUserEvidenceCompetency=function(a){var b=this,c=new g(a.userid);c.on("save",function(c,d){var e=d.competencyIds;b._doCreateUserEvidenceCompetency(a,e,d.requestReview)}),c.display()},h.prototype._createUserEvidenceCompetencyHandler=function(b){b.preventDefault();var c=this._findEvidenceData(a(b.target));this.createUserEvidenceCompetency(c)},h.prototype._doDeleteUserEvidenceCompetency=function(a,b){var c=this,d=[];d.push({methodname:"core_competency_delete_user_evidence_competency",args:{userevidenceid:a.id,competencyid:b}}),c._callAndRefresh(d,a)},h.prototype.deleteUserEvidenceCompetency=function(a,b){this._doDeleteUserEvidenceCompetency(a,b)},h.prototype._deleteUserEvidenceCompetencyHandler=function(b){var c=this._findEvidenceData(a(b.currentTarget)),d=a(b.currentTarget).data("id");b.preventDefault(),this.deleteUserEvidenceCompetency(c,d)},h.prototype._doReviewUserEvidenceCompetencies=function(a){var b=this,c=[{methodname:"core_competency_request_review_of_user_evidence_linked_competencies",args:{id:a.id}}];b._callAndRefresh(c,a)},h.prototype.reviewUserEvidenceCompetencies=function(a){var b,f=this;b=c.call([{methodname:"core_competency_read_user_evidence",args:{id:a.id}}]),b[0].done(function(b){e.get_strings([{key:"confirm",component:"moodle"},{key:"sendallcompetenciestoreview",component:"tool_lp",param:b.name},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){f._doReviewUserEvidenceCompetencies(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._reviewUserEvidenceCompetenciesHandler=function(b){b.preventDefault();var c=this._findEvidenceData(a(b.target));this.reviewUserEvidenceCompetencies(c)},h.prototype._findEvidenceData=function(b){var c,d=b.parentsUntil(a(this._region).parent(),this._evidenceNode);if(1!=d.length)throw new Error("The evidence node was not located.");if(c=d.data(),"undefined"==typeof c||"undefined"==typeof c.id)throw new Error("Evidence data could not be found.");return c},h.prototype.enhanceMenubar=function(a){var b=this;f.enhance(a,{'[data-action="user-evidence-delete"]':b._deleteEvidenceHandler.bind(b),'[data-action="link-competency"]':b._createUserEvidenceCompetencyHandler.bind(b),'[data-action="send-competencies-review"]':b._reviewUserEvidenceCompetenciesHandler.bind(b)})},h.prototype.registerEvents=function(){var b=a(this._region),c=this;b.find('[data-action="user-evidence-delete"]').click(c._deleteEvidenceHandler.bind(c)),b.find('[data-action="link-competency"]').click(c._createUserEvidenceCompetencyHandler.bind(c)),b.find('[data-action="delete-competency-link"]').click(c._deleteUserEvidenceCompetencyHandler.bind(c)),b.find('[data-action="send-competencies-review"]').click(c._reviewUserEvidenceCompetenciesHandler.bind(c))},h});
define('tool_lp/grade_dialogue', ["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/event_base","core/str"],function(a,b,c,d,e,f){var g=function(a){e.prototype.constructor.apply(this,[]),this._ratingOptions=a};return g.prototype=Object.create(e.prototype),g.prototype._popup=null,g.prototype._ratingOptions=null,g.prototype._afterRender=function(){var b=this._find('[data-action="rate"]'),c=this._find('[name="rating"]'),d=this._find('[name="comment"]');this._find('[data-action="cancel"]').click(function(a){a.preventDefault(),this._trigger("cancelled"),this.close()}.bind(this)),c.change(function(){var c=a(this);c.val()?b.prop("disabled",!1):b.prop("disabled",!0)}).change(),b.click(function(a){a.preventDefault();var b=c.val();b&&(this._trigger("rated",{rating:b,note:d.val()}),this.close())}.bind(this))},g.prototype.close=function(){this._popup.close(),this._popup=null},g.prototype.display=function(){return a.when(f.get_string("rate","tool_lp"),this._render()).then(function(a,b){return this._popup=new d(a,b[0],this._afterRender.bind(this)),this._popup}.bind(this))["catch"](b.exception)},g.prototype._find=function(b){return a(this._popup.getContent()).find(b)},g.prototype._render=function(){var a={cangrade:this._canGrade,ratings:this._ratingOptions};return c.render("tool_lp/competency_grader",a)},g});
define('tool_lp/parentcompetency_form', ["jquery","core/ajax","core/str","tool_lp/competencypicker","core/templates","core/notification"],function(a,b,c,d,e,f){var g=function(a,b,c,d,e){this.buttonSelector=a,this.inputHiddenSelector=b,this.staticElementSelector=c,this.frameworkId=d,this.pageContextId=e,this.registerEvents()};return g.prototype.buttonSelector=null,g.prototype.inputHiddenSelector=null,g.prototype.staticElementSelector=null,g.prototype.frameworkId=null,g.prototype.pageContextId=null,g.prototype.setParent=function(d){var e=this;0!==d.competencyId?b.call([{methodname:"core_competency_read_competency",args:{id:d.competencyId}}])[0].done(function(b){a(e.staticElementSelector).html(b.shortname),a(e.inputHiddenSelector).val(b.id)}).fail(f.exception):c.get_string("competencyframeworkroot","tool_lp").then(function(b){a(e.staticElementSelector).html(b),a(e.inputHiddenSelector).val(d.competencyId)}).fail(f.exception)},g.prototype.registerEvents=function(){var b=this;a(b.buttonSelector).on("click",function(a){a.preventDefault();var c=new d(b.pageContextId,b.frameworkId,"self",(!1));c._render=function(){var a=this;return a._preRender().then(function(){var b={competencies:a._competencies,framework:a._getFramework(a._frameworkId),frameworks:a._frameworks,search:a._searchText,singleFramework:a._singleFramework};return e.render("tool_lp/competency_picker_competencyform",b)})},c.on("save",function(a,c){b.setParent(c)}),c.display()})},{init:function(a,b,c,d,e){new g(a,b,c,d,e)}}});
define('tool_lp/frameworks_datasource', ["jquery","core/ajax","core/notification"],function(a,b,c){return{list:function(c,d){var e={context:{contextid:c}};return a.extend(e,"undefined"==typeof d?{}:d),b.call([{methodname:"core_competency_list_competency_frameworks",args:e}])[0]},processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b.shortname+" "+b.idnumber})}),d},transport:function(b,d,e){var f=a(b),g=f.data("contextid"),h=f.data("onlyvisible");if(!g)throw new Error("The attribute data-contextid is required on "+b);this.list(g,{query:d,onlyvisible:h}).then(e)["catch"](c.exception)}}});
define('tool_lp/competencytree', ["core/ajax","core/notification","core/templates","tool_lp/tree","tool_lp/competency_outcomes","jquery"],function(a,b,c,d,e,f){var g={},h=0,i="",j="",k="",l=!1,m=function(a,b){var c=0,d=!1;for(a.haschildren=!1,a.children=[],c=0;c<b.length;c++)d=b[c],d.parentid==a.id&&(a.haschildren=!0,a.children.push(d),m(d,b))},n=function(b){var e=f.Deferred();return c.render("tool_lp/loading",{}).done(function(n,o){c.replaceNodeContents(f(j),n,o);var p=a.call([{methodname:"core_competency_search_competencies",args:{searchtext:b,competencyframeworkid:h}}]);p[0].done(function(a){g={};var b=0;for(b=0;b<a.length;b++)g[a[b].id]=a[b];var h=[],n=!1;for(b=0;b<a.length;b++)n=a[b],0===parseInt(n.parentid,10)&&(h.push(n),m(n,a));var o={shortname:i,canmanage:l,competencies:h};c.render("tool_lp/competencies_tree_root",o).done(function(a,b){c.replaceNodeContents(f(j),f(a).html(),b);var h=new d(j,(!1));if(k){var i=f(j).find("[data-id="+k+"]");i.length&&(h.selectItem(i),h.updateFocus(i))}e.resolve(g)}).fail(e.reject)}).fail(e.reject)}),e.promise()},o=function(a,b){var c=b.selected;k=c.attr("data-id")};return{init:function(a,c,d,e,f){h=a,i=c,l=f,j=e,n(d).fail(b.exception),this.on("selectionchanged",o)},on:function(a,b){f(j).on(a,b)},getChildren:function(a){var b=[];return f.each(g,function(c,d){d.parentid==a&&b.push(d)}),b},getCompetencyFrameworkId:function(){return h},getCompetency:function(a){return g[a]},getCompetencyLevel:function(a){var b=this.getCompetency(a),c=b.path.replace(/^\/|\/$/g,"").split("/").length;return c},hasChildren:function(a){return this.getChildren(a).length>0},hasRule:function(a){var b=this.getCompetency(a);return!!b&&(b.ruleoutcome!=e.OUTCOME_NONE&&b.ruletype)},reloadCompetencies:function(){return n("").fail(b.exception)},listCompetencies:function(){return g}}});
define('tool_policy/acceptmodal', ["jquery","core/str","core/modal_factory","core/modal_events","core/notification","core/fragment","core/ajax","core/yui"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(a){this.contextid=a,this.init()};return i.prototype.modal=null,i.prototype.contextid=-1,i.prototype.currentTrigger=null,i.prototype.triggers={SINGLE:"a[data-action=acceptmodal]",BULK:"input[data-action=acceptmodal]"},i.prototype.init=function(){a(this.triggers.SINGLE).on("click",function(b){b.preventDefault(),this.currentTrigger=a(b.currentTarget);var c=a(b.currentTarget).attr("href"),d=c.slice(c.indexOf("?")+1);this.showFormModal(d)}.bind(this)),a(this.triggers.BULK).on("click",function(c){c.preventDefault(),this.currentTrigger=a(c.currentTarget);var d=a(c.currentTarget).closest("form");if(d.find('input[type=checkbox][name="userids[]"]:checked').length){var f=d.serialize();this.showFormModal(f)}else b.get_strings([{key:"notice"},{key:"selectusersforconsent",component:"tool_policy"},{key:"ok"}]).then(function(a){e.alert(a[0],a[1],a[2])}).fail(e.exception)}.bind(this))},i.prototype.showFormModal=function(a){for(var d,f=a.split("&"),g=0;g<f.length;g++){var h=f[g].split("=");"action"==h[0]&&(d=h[1])}b.get_strings([{key:"statusformtitleaccept",component:"tool_policy"},{key:"iagreetothepolicy",component:"tool_policy"},{key:"statusformtitlerevoke",component:"tool_policy"},{key:"irevokethepolicy",component:"tool_policy"},{key:"statusformtitledecline",component:"tool_policy"},{key:"declinethepolicy",component:"tool_policy"}]).then(function(b){var e,f;return"accept"==d?(e=b[0],f=b[1]):"revoke"==d?(e=b[2],f=b[3]):"decline"==d&&(e=b[4],f=b[5]),c.create({type:c.types.SAVE_CANCEL,title:e,body:""}).done(function(b){this.modal=b,this.setupFormModal(a,f)}.bind(this))}.bind(this))["catch"](e.exception)},i.prototype.setupFormModal=function(a,b){var c=this.modal;c.setLarge(),c.setSaveButtonText(b),c.getRoot().on(d.hidden,this.destroy.bind(this)),c.setBody(this.getBody(a)),c.getRoot().on(d.save,this.submitForm.bind(this)),c.getRoot().on("submit","form",this.submitFormAjax.bind(this)),c.show()},i.prototype.getBody=function(a){"undefined"==typeof a&&(a={});var b={jsonformdata:JSON.stringify(a)};return f.loadFragment("tool_policy","accept_on_behalf",this.contextid,b)},i.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize(),c=g.call([{methodname:"tool_policy_submit_accept_on_behalf",args:{jsonformdata:JSON.stringify(b)}}]);c[0].done(function(a){a.validationerrors?this.modal.setBody(this.getBody(b)):this.close()}.bind(this)).fail(e.exception)},i.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},i.prototype.close=function(){this.destroy(),document.location.reload()},i.prototype.destroy=function(){h.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),this.modal.destroy(),this.currentTrigger.focus()},{getInstance:function(a){return new i(a)}}});
define('tool_policy/acceptances_filter', ["jquery","core/form-autocomplete","core/str","core/notification"],function(a,b,c,d){var e={UNIFIED_FILTERS:"#unified-filters"},f=function(){var f=[{key:"filterplaceholder",component:"tool_policy"},{key:"nofiltersapplied",component:"tool_policy"}];M.util.js_pending("acceptances_filter_datasource"),c.get_strings(f).done(function(a){var c=a[0],f=a[1];b.enhance(e.UNIFIED_FILTERS,!0,"tool_policy/acceptances_filter_datasource",c,!1,!0,f,!0).then(function(){M.util.js_complete("acceptances_filter_datasource")}).fail(d.exception)}).fail(d.exception);var g=a(e.UNIFIED_FILTERS).val();a(e.UNIFIED_FILTERS).on("change",function(){var b=a(this).val(),c=[],d=[],e=!1;if(a.each(b,function(a,b){var f=b.split(":",2);if(2!==f.length)return d.push(b),!0;var g=f[0],h=f[1];return"undefined"!=typeof c[g]&&(e=!0),c[g]=h,!0}),e){var f=[];for(var h in c)f.push(h+":"+c[h]);f=f.concat(d),a(this).val(f)}g.join(",")!=b.join(",")&&this.form.submit()})},g=function(){return a(e.UNIFIED_FILTERS).closest("form")};return{init:function(){f()},getForm:function(){return g()}}});
define('tool_policy/policyactions', ["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events"],function(a,b,c,d,e){var f=function(a){this.registerEvents(a)};return f.prototype.registerEvents=function(f){f.on("click",function(f){f.preventDefault();var g=a(this).data("versionid"),h=a(this).data("behalfid"),i={versionid:g,behalfid:h},j={methodname:"tool_policy_get_policy_version",args:i},k=a.Deferred(),l=a.Deferred(),m=d.create({title:k,body:l,large:!0}).then(function(a){return a.getRoot().on(e.hidden,function(){a.destroy()}),a}).then(function(a){return a.show(),a})["catch"](c.exception),n=b.call([j]);a.when(n[0]).then(function(a){if(a.result.policy)return k.resolve(a.result.policy.name),l.resolve(a.result.policy.content),a;throw new Error(a.warnings[0].message)})["catch"](function(a){return m.then(function(a){return a.hide(),a.destroy(),a})["catch"](c.exception),c.addNotification({message:a,type:"error"})})})},{init:function(b){return b=a(b),new f(b)}}});
define('tool_policy/acceptances_filter_datasource', ["jquery","core/ajax","core/notification"],function(a,b,c){return{list:function(b,c){var d=[],e=a(b),f=a(b).data("originaloptionsjson"),g=e.val();a.each(f,function(b,e){return""!==a.trim(c)&&e.label.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())===-1||(a.inArray(e.value,g)>-1||(d.push(e),!0))});var h=new a.Deferred;return h.resolve(d),h.promise()},processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.value,label:b.label})}),d},transport:function(a,b,d){this.list(a,b).then(d)["catch"](c.exception)}}});
define('tool_policy/managedocsactions', ["jquery","core/log","core/config","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){"use strict";function g(a){this.base=a,this.initEvents()}var h={LINKS:"[data-action]",MAKE_CURRENT:'[data-action="makecurrent"]',INACTIVATE:'[data-action="inactivate"]',DELETE:'[data-action="delete"]'};return g.prototype.initEvents=function(){var g=this;g.base.on("click",h.LINKS,function(g){g.stopPropagation();var i,j,k=a(g.currentTarget);if(k.is(h.MAKE_CURRENT))i=d.get_strings([{key:"activating",component:"tool_policy"},{key:"activateconfirm",component:"tool_policy",param:{name:k.closest("[data-policy-name]").attr("data-policy-name"),revision:k.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"activateconfirmyes",component:"tool_policy"}]);else if(k.is(h.INACTIVATE))i=d.get_strings([{key:"inactivating",component:"tool_policy"},{key:"inactivatingconfirm",component:"tool_policy",param:{name:k.closest("[data-policy-name]").attr("data-policy-name"),revision:k.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"inactivatingconfirmyes",component:"tool_policy"}]);else{if(!k.is(h.DELETE))return void b.error("unknown action type detected","tool_policy/managedocsactions");i=d.get_strings([{key:"deleting",component:"tool_policy"},{key:"deleteconfirm",component:"tool_policy",param:{name:k.closest("[data-policy-name]").attr("data-policy-name"),revision:k.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"delete",component:"core"}])}g.preventDefault(),i.then(function(a){return j=a,e.create({title:j[0],body:j[1],type:e.types.SAVE_CANCEL})}).then(function(a){return a.setSaveButtonText(j[2]),a.getRoot().on(f.save,function(){window.location.href=k.attr("href")+"&sesskey="+c.sesskey+"&confirm=1"}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show(),!0})["catch"](function(a){return b.error(a),!1})})},{init:function(b){var c=a(document.getElementById(b));if(c.length)return new g(c);throw new Error("managedocsactions: Invalid base element identifier")}}});
define('tool_policy/jquery-eu-cookie-law-popup', ["jquery"],function(a){window.console||(window.console={}),window.console.log||(window.console.log=function(){}),a.fn.euCookieLawPopup=function(){var b=this;b.params={cookiePolicyUrl:"http://www.wimagguc.com/?cookie-policy",popupPosition:"top",colorStyle:"default",compactStyle:!1,popupTitle:"This website is using cookies",popupText:"We use cookies to ensure that we give you the best experience on our website. If you continue without changing your settings, we'll assume that you are happy to receive all cookies on this website.",buttonContinueTitle:"Continue",buttonLearnmoreTitle:"Learn&nbsp;more",buttonLearnmoreOpenInNewWindow:!0,agreementExpiresInDays:30,autoAcceptCookiePolicy:!1,htmlMarkup:null},b.vars={INITIALISED:!1,HTML_MARKUP:null,COOKIE_NAME:"EU_COOKIE_LAW_CONSENT"};var c=function(c,d,e){if(c){var f=a(c).attr("class")?a(c).attr("class"):"";f.indexOf("eupopup-top")>-1?b.params.popupPosition="top":f.indexOf("eupopup-fixedtop")>-1?b.params.popupPosition="fixedtop":f.indexOf("eupopup-bottomright")>-1?b.params.popupPosition="bottomright":f.indexOf("eupopup-bottomleft")>-1?b.params.popupPosition="bottomleft":f.indexOf("eupopup-bottom")>-1?b.params.popupPosition="bottom":f.indexOf("eupopup-block")>-1&&(b.params.popupPosition="block"),f.indexOf("eupopup-color-default")>-1?b.params.colorStyle="default":f.indexOf("eupopup-color-inverse")>-1&&(b.params.colorStyle="inverse"),f.indexOf("eupopup-style-compact")>-1&&(b.params.compactStyle=!0)}d&&(b.params.htmlMarkup=d),e&&("undefined"!=typeof e.cookiePolicyUrl&&(b.params.cookiePolicyUrl=e.cookiePolicyUrl),"undefined"!=typeof e.popupPosition&&(b.params.popupPosition=e.popupPosition),"undefined"!=typeof e.colorStyle&&(b.params.colorStyle=e.colorStyle),"undefined"!=typeof e.popupTitle&&(b.params.popupTitle=e.popupTitle),"undefined"!=typeof e.popupText&&(b.params.popupText=e.popupText),"undefined"!=typeof e.buttonContinueTitle&&(b.params.buttonContinueTitle=e.buttonContinueTitle),"undefined"!=typeof e.buttonLearnmoreTitle&&(b.params.buttonLearnmoreTitle=e.buttonLearnmoreTitle),"undefined"!=typeof e.buttonLearnmoreOpenInNewWindow&&(b.params.buttonLearnmoreOpenInNewWindow=e.buttonLearnmoreOpenInNewWindow),"undefined"!=typeof e.agreementExpiresInDays&&(b.params.agreementExpiresInDays=e.agreementExpiresInDays),"undefined"!=typeof e.autoAcceptCookiePolicy&&(b.params.autoAcceptCookiePolicy=e.autoAcceptCookiePolicy),"undefined"!=typeof e.htmlMarkup&&(b.params.htmlMarkup=e.htmlMarkup))},d=function(){if(b.params.htmlMarkup)return b.params.htmlMarkup;var a='<div class="eupopup-container eupopup-container-'+b.params.popupPosition+(b.params.compactStyle?" eupopup-style-compact":"")+" eupopup-color-"+b.params.colorStyle+'"><div class="eupopup-head">'+b.params.popupTitle+'</div><div class="eupopup-body">'+b.params.popupText+'</div><div class="eupopup-buttons"><a href="#" class="eupopup-button eupopup-button_1">'+b.params.buttonContinueTitle+'</a><a href="'+b.params.cookiePolicyUrl+'"'+(b.params.buttonLearnmoreOpenInNewWindow?" target=_blank ":"")+' class="eupopup-button eupopup-button_2">'+b.params.buttonLearnmoreTitle+'</a><div class="clearfix"></div></div><a href="#" class="eupopup-closebutton">x</a></div>';return a},e=function(c){var d=new Date,e=24*b.params.agreementExpiresInDays*60*60*1e3;d.setTime(d.getTime()+e);var f="expires="+d.toGMTString();document.cookie=b.vars.COOKIE_NAME+"="+c+"; "+f+";path=/",a(document).trigger("user_cookie_consent_changed",{consent:c})},f=function(){for(var a=!1,c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();0==e.indexOf(b.vars.COOKIE_NAME)&&(a=e.substring(b.vars.COOKIE_NAME.length+1,e.length))}return a},g=function(){a(".eupopup-container").animate({opacity:0,height:0},200,function(){a(".eupopup-container").hide(0)})},h={init:function(h){c(a(".eupopup").first(),a(".eupopup-markup").html(),h),f()||b.vars.INITIALISED||(b.vars.INITIALISED=!0,b.vars.HTML_MARKUP=d(),a(".eupopup-block").length>0?a(".eupopup-block").append(b.vars.HTML_MARKUP):a("BODY").append(b.vars.HTML_MARKUP),a(".eupopup-button_1").click(function(){return e(!0),g(),!1}),a(".eupopup-closebutton").click(function(){return e(!0),g(),!1}),a(".eupopup-container").show(),b.params.autoAcceptCookiePolicy&&e(!0))}};return h}});
define('tool_templatelibrary/display', ["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str"],function(a,b,c,d,e,f,g){var h=function(a,b){if(!a)return!1;var c="@template "+b,d=0,e=[];if(e=a.match(/{{!([\s\S]*?)}}/g),null!==e)for(d=0;d<e.length;d++){var f=e[d],g=f.indexOf(c);if(g!==-1){var h=g+c.length+1;return f=f.substr(h,f.length-2-h)}}return!1},i=function(b,f,i){g.get_string("templateselected","tool_templatelibrary",b).done(function(b){a('[data-region="displaytemplateheader"]').text(b)}).fail(d.exception);var j=h(f,b);j===!1&&(j=h(i,b)),j&&(f=j),a('[data-region="displaytemplatesource"]').text(f);var k=f.match(/Example context \(json\):([\s\S]*)/),l=!1;if(k){var m=k[1].trim();try{l=a.parseJSON(m)}catch(n){c.debug("Could not parse json example context for template."),c.debug(n)}}l?e.render(b,l).done(function(b,c){e.replaceNodeContents(a('[data-region="displaytemplateexample"]'),b,c)}).fail(d.exception):g.get_string("templatehasnoexample","tool_templatelibrary").done(function(b){a('[data-region="displaytemplateexample"]').text(b)}).fail(d.exception)},j=function(c){var e=c.split("/"),g=e.shift(),h=e.shift(),j=b.call([{methodname:"core_output_load_template",args:{component:g,template:h,themename:f.theme,includecomments:!0}},{methodname:"tool_templatelibrary_load_canonical_template",args:{component:g,template:h}}],!0,!1);a.when.apply(a,j).done(function(a,b){i(c,a,b)}).fail(d.exception)};return a('[data-region="list-templates"]').on("click","[data-templatename]",function(b){var c=a(this).data("templatename");b.preventDefault(),j(c)}),{}});
define('tool_templatelibrary/search', ["jquery","core/ajax","core/log","core/notification","core/templates","core/config"],function(a,b,c,d,e,f){var g=function(b){e.render("tool_templatelibrary/search_results",{templates:b}).done(function(b,c){e.replaceNode(a('[data-region="searchresults"]'),b,c)}).fail(d.exception)},h=function(c){var e=a('[data-field="component"]').val(),f=a('[data-field="search"]').val();document.location.hash=f,b.call([{methodname:"tool_templatelibrary_list_templates",args:{component:e,search:f,themename:c},done:g,fail:d.exception}],!0,!1)},i=null,j=function(a,b){null!==i&&window.clearTimeout(i),i=window.setTimeout(function(){a(),i=null},b)},k=function(){j(h.bind(this,f.theme),400)};return a('[data-region="list-templates"]').on("change",'[data-field="component"]',k),a('[data-region="list-templates"]').on("input",'[data-field="search"]',k),a('[data-field="search"]').val(document.location.hash.replace("#","")),h(f.theme),{}});
define('tool_usertours/managesteps', ["jquery","core/str","core/notification"],function(a,b,c){var d={removeStep:function(d){d.preventDefault();var e=a(d.currentTarget).attr("href");b.get_strings([{key:"confirmstepremovaltitle",component:"tool_usertours"},{key:"confirmstepremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then(function(a){c.confirm(a[0],a[1],a[2],a[3],function(){window.location=e})})["catch"]()},setup:function(){a("body").delegate('[data-action="delete"]',"click",d.removeStep)}};return{setup:d.setup}});
define('tool_usertours/managetours', ["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){var e={removeTour:function(b){b.preventDefault();var e=a(b.currentTarget).attr("href");c.get_strings([{key:"confirmtourremovaltitle",component:"tool_usertours"},{key:"confirmtourremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location=e})})["catch"]()},setup:function(){a("body").delegate('[data-action="delete"]',"click",e.removeTour)}};return{setup:e.setup}});
define('tool_usertours/usertours', ["core/ajax","tool_usertours/tour","jquery","core/templates","core/str","core/log","core/notification"],function(a,b,c,d,e,f,g){var h={tourId:null,currentTour:null,context:null,init:function(a,b,d){h.tourId=a,h.context=d,"undefined"==typeof b&&(b=!0),b&&h.fetchTour(a),h.addResetLink(),c("body").on("click",'[data-action="tool_usertours/resetpagetour"]',function(a){a.preventDefault(),h.resetTourState(h.tourId)})},fetchTour:function(b){M.util.js_pending("admin_usertour_fetchTour"+b),c.when(a.call([{methodname:"tool_usertours_fetch_and_start_tour",args:{tourid:b,context:h.context,pageurl:window.location.href}}])[0],d.render("tool_usertours/tourstep",{})).then(function(a,c){return h.startBootstrapTour(b,c[0],a.tourconfig)}).always(function(){M.util.js_complete("admin_usertour_fetchTour"+b)}).fail(g.exception)},addResetLink:function(){var a;M.util.js_pending("admin_usertour_addResetLink"),a=c(c(".tool_usertours-resettourcontainer").length?".tool_usertours-resettourcontainer":c(".logininfo").length?".logininfo":c("footer").length?"footer":"body"),d.render("tool_usertours/resettour",{}).then(function(b,c){d.appendNodeContents(a,b,c)}).always(function(){M.util.js_complete("admin_usertour_addResetLink")}).fail()},startBootstrapTour:function(a,c,d){return h.currentTour&&(d.onEnd=null,h.currentTour.endTour(),delete h.currentTour),d.eventHandlers={afterEnd:[h.markTourComplete],afterRender:[h.markStepShown]},d.tourName=d.name,delete d.name,d.template=c,d.steps=d.steps.map(function(a){return"undefined"!=typeof a.element&&(a.target=a.element,delete a.element),"undefined"!=typeof a.reflex&&(a.moveOnClick=!!a.reflex,delete a.reflex),"undefined"!=typeof a.content&&(a.body=a.content,delete a.content),a}),h.currentTour=new b(d),h.currentTour.startTour()},markStepShown:function(){var b=this.getStepConfig(this.getCurrentStepNumber());c.when(a.call([{methodname:"tool_usertours_step_shown",args:{tourid:h.tourId,context:h.context,pageurl:window.location.href,stepid:b.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(f.error)},markTourComplete:function(){var b=this.getStepConfig(this.getCurrentStepNumber());c.when(a.call([{methodname:"tool_usertours_complete_tour",args:{tourid:h.tourId,context:h.context,pageurl:window.location.href,stepid:b.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(f.error)},resetTourState:function(b){c.when(a.call([{methodname:"tool_usertours_reset_tour",args:{tourid:b,context:h.context,pageurl:window.location.href}}])[0]).then(function(a){a.startTour&&h.fetchTour(a.startTour)}).fail(g.exception)}};return{init:h.init,resetTourState:h.resetTourState}});
!function(a,b){"function"==typeof define&&define.amd?define('tool_usertours/tour', ["jquery","core/popper"],function(c,d){return a.Tour=b(c,d)}):"object"==typeof module&&module.exports?module.exports=b(require("jquery"),require("popper.js")):a.Tour=b(a.$,a.Popper)}(this,function(a,b){"use strict";function c(a){this.init(a)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return c.prototype.tourName,c.prototype.storageKey,c.prototype.storage,c.prototype.originalConfiguration,c.prototype.listeners,c.prototype.eventHandlers,c.prototype.steps,c.prototype.currentStepNode,c.prototype.currentStepNumber,c.prototype.currentStepPopper,c.prototype.currentStepConfig,c.prototype.templateContent,c.prototype.init=function(a){this.eventHandlers={},this.reset(),this.originalConfiguration=a||{},this.configure.apply(this,arguments);try{this.storage=window.sessionStorage,this.storageKey="tourstate_"+this.tourName}catch(b){this.storage=!1,this.storageKey=""}return this},c.prototype.reset=function(){return this.hide(),this.eventHandlers=[],this.resetStepListeners(),this.originalConfiguration={},this.steps=[],this.currentStepNumber=0,this},c.prototype.configure=function(a){var b=this;return"object"===("undefined"==typeof a?"undefined":d(a))&&("undefined"!=typeof a.tourName&&(this.tourName=a.tourName),a.eventHandlers&&!function(){var c=void 0;for(c in a.eventHandlers)a.eventHandlers[c].forEach(function(a){this.addEventHandler(c,a)},b)}(),this.resetStepDefaults(!0),"object"===d(a.steps)&&(this.steps=a.steps),"undefined"!=typeof a.template&&(this.templateContent=a.template)),this.checkMinimumRequirements(),this},c.prototype.checkMinimumRequirements=function(){if(!this.tourName)throw new Error("Tour Name required");if(!this.steps||!this.steps.length)throw new Error("Steps must be specified")},c.prototype.resetStepDefaults=function(a){return"undefined"==typeof a&&(a=!0),this.stepDefaults={},a&&"undefined"!=typeof this.originalConfiguration.stepDefaults?this.setStepDefaults(this.originalConfiguration.stepDefaults):this.setStepDefaults({}),this},c.prototype.setStepDefaults=function(b){return this.stepDefaults||(this.stepDefaults={}),a.extend(this.stepDefaults,{element:"",placement:"top",delay:0,moveOnClick:!1,moveAfterTime:0,orphan:!1,direction:1},b),this},c.prototype.getCurrentStepNumber=function(){return parseInt(this.currentStepNumber,10)},c.prototype.setCurrentStepNumber=function(a){if(this.currentStepNumber=a,this.storage)try{this.storage.setItem(this.storageKey,a)}catch(b){b.code===DOMException.QUOTA_EXCEEDED_ERR&&this.storage.removeItem(this.storageKey)}},c.prototype.getNextStepNumber=function(a){"undefined"==typeof a&&(a=this.getCurrentStepNumber());for(var b=a+1;b<=this.steps.length;){if(this.isStepPotentiallyVisible(this.getStepConfig(b)))return b;b++}return null},c.prototype.getPreviousStepNumber=function(a){"undefined"==typeof a&&(a=this.getCurrentStepNumber());for(var b=a-1;b>=0;){if(this.isStepPotentiallyVisible(this.getStepConfig(b)))return b;b--}return null},c.prototype.isLastStep=function(a){var b=this.getNextStepNumber(a);return null===b},c.prototype.isFirstStep=function(a){var b=this.getPreviousStepNumber(a);return null===b},c.prototype.isStepPotentiallyVisible=function(a){return!!a&&(!!this.isStepActuallyVisible(a)||(!("undefined"==typeof a.orphan||!a.orphan)||!("undefined"==typeof a.delay||!a.delay)))},c.prototype.isStepActuallyVisible=function(a){if(!a)return!1;var b=this.getStepTarget(a);return!!(b&&b.length&&b.is(":visible"))&&!!b.length},c.prototype.next=function(){return this.gotoStep(this.getNextStepNumber())},c.prototype.previous=function(){return this.gotoStep(this.getPreviousStepNumber(),-1)},c.prototype.gotoStep=function(a,b){if(a<0)return this.endTour();var c=this.getStepConfig(a);return null===c?this.endTour():this._gotoStep(c,b)},c.prototype._gotoStep=function(a,b){if(!a)return this.endTour();if("undefined"!=typeof a.delay&&a.delay&&!a.delayed)return a.delayed=!0,window.setTimeout(this._gotoStep.bind(this),a.delay,a,b),this;if(!a.orphan&&!this.isStepActuallyVisible(a)){var c=b==-1?"getPreviousStepNumber":"getNextStepNumber";return this.gotoStep(this[c](a.stepNumber),b)}return this.hide(),this.fireEventHandlers("beforeRender",a),this.renderStep(a),this.fireEventHandlers("afterRender",a),this},c.prototype.getStepConfig=function(b){if(null===b||b<0||b>=this.steps.length)return null;var c=this.normalizeStepConfig(this.steps[b]);return c=a.extend(c,{stepNumber:b})},c.prototype.normalizeStepConfig=function(b){return"undefined"!=typeof b.reflex&&"undefined"==typeof b.moveAfterClick&&(b.moveAfterClick=b.reflex),"undefined"!=typeof b.element&&"undefined"==typeof b.target&&(b.target=b.element),"undefined"!=typeof b.content&&"undefined"==typeof b.body&&(b.body=b.content),b=a.extend({},this.stepDefaults,b),b=a.extend({},{attachTo:b.target,attachPoint:"after"},b),b.attachTo&&(b.attachTo=a(b.attachTo).first()),b},c.prototype.getStepTarget=function(b){return b.target?a(b.target):null},c.prototype.fireEventHandlers=function(a,b){return"undefined"==typeof this.eventHandlers[a]?this:(this.eventHandlers[a].forEach(function(a){a.call(this,b)},this),this)},c.prototype.addEventHandler=function(a,b){return"undefined"==typeof this.eventHandlers[a]&&(this.eventHandlers[a]=[]),this.eventHandlers[a].push(b),this},c.prototype.processStepListeners=function(b){if(this.listeners.push({node:this.currentStepNode,args:["click",'[data-role="next"]',a.proxy(this.next,this)]},{node:this.currentStepNode,args:["click",'[data-role="previous"]',a.proxy(this.previous,this)]},{node:this.currentStepNode,args:["click",'[data-role="end"]',a.proxy(this.endTour,this)]},{node:a('[data-flexitour="backdrop"]'),args:["click",a.proxy(this.hide,this)]},{node:a("body"),args:["keydown",a.proxy(this.handleKeyDown,this)]}),b.moveOnClick){var c=this.getStepTarget(b);this.listeners.push({node:c,args:["click",a.proxy(function(b){0===a(b.target).parents('[data-flexitour="container"]').length&&window.setTimeout(a.proxy(this.next,this),500)},this)]})}return this.listeners.forEach(function(a){a.node.on.apply(a.node,a.args)}),this},c.prototype.resetStepListeners=function(){return this.listeners&&this.listeners.forEach(function(a){a.node.off.apply(a.node,a.args)}),this.listeners=[],this},c.prototype.renderStep=function(b){this.currentStepConfig=b,this.setCurrentStepNumber(b.stepNumber);var c=a(this.getTemplateContent());return c.find('[data-placeholder="title"]').html(b.title),c.find('[data-placeholder="body"]').html(b.body),this.isFirstStep(b.stepNumber)?c.find('[data-role="previous"]').prop("disabled",!0):c.find('[data-role="previous"]').prop("disabled",!1),this.isLastStep(b.stepNumber)?c.find('[data-role="next"]').prop("disabled",!0):c.find('[data-role="next"]').prop("disabled",!1),c.find('[data-role="previous"]').attr("role","button"),c.find('[data-role="next"]').attr("role","button"),c.find('[data-role="end"]').attr("role","button"),b.template=c,this.addStepToPage(b),this.processStepListeners(b),this},c.prototype.getTemplateContent=function(){return a(this.templateContent).clone()},c.prototype.addStepToPage=function(c){var d=(c.template,a('<span data-flexitour="container"></span>').html(c.template).hide()),e=a("body, html").stop(!0,!0);if(this.isStepActuallyVisible(c)){var f=this.getStepTarget(c);f.data("flexitour","target");var g=this.calculateZIndex(f);g&&(c.zIndex=g+1),c.zIndex&&d.css("zIndex",c.zIndex+1),this.positionBackdrop(c),a(document.body).append(d),this.currentStepNode=d,this.currentStepNode.css({top:0,left:0}),e.animate({scrollTop:this.calculateScrollTop(c)}).promise().then(function(){this.positionStep(c),this.revealStep(c)}.bind(this))}else c.orphan&&(c.isOrphan=!0,c.attachTo=a("body").first(),c.attachPoint="append",this.positionBackdrop(c),d.addClass("orphan"),a(document.body).append(d),this.currentStepNode=d,this.currentStepNode.offset(this.calculateStepPositionInPage()),this.currentStepNode.css("position","fixed"),this.currentStepPopper=new b(a("body"),this.currentStepNode[0],{removeOnDestroy:!0,placement:c.placement+"-start",arrowElement:'[data-role="arrow"]',modifiers:{hide:{enabled:!1},applyStyle:{onLoad:null,enabled:!1}}}),this.revealStep(c));return this},c.prototype.revealStep=function(b){return this.currentStepNode.fadeIn("",a.proxy(function(){this.announceStep(b),this.currentStepNode.focus(),window.setTimeout(a.proxy(function(){this.currentStepNode&&this.currentStepNode.focus()},this),100)},this)),this},c.prototype.announceStep=function(a){var b="tour-step-"+this.tourName+"-"+a.stepNumber;this.currentStepNode.attr("id",b);var c=this.currentStepNode.find('[data-placeholder="body"]').first();c.attr("id",b+"-body"),c.attr("role","document");var d=this.currentStepNode.find('[data-placeholder="title"]').first();d.attr("id",b+"-title"),d.attr("aria-labelledby",b+"-body"),this.currentStepNode.attr("role","dialog"),this.currentStepNode.attr("tabindex",0),this.currentStepNode.attr("aria-labelledby",b+"-title"),this.currentStepNode.attr("aria-describedby",b+"-body");var e=this.getStepTarget(a);return e&&(e.attr("tabindex")||e.attr("tabindex",0),e.data("original-describedby",e.attr("aria-describedby")).attr("aria-describedby",b+"-body")),this.accessibilityShow(a),this},c.prototype.handleKeyDown=function(b){var c="a[href], link[href], [draggable=true], [contenteditable=true], :input:enabled, [tabindex], button:enabled";switch(b.keyCode){case 27:this.endTour();break;case 9:(function(){if(this.currentStepConfig.hasBackdrop){var d=a(document.activeElement),e=this.getStepTarget(this.currentStepConfig),f=a(c),g=a('span[data-flexitour="container"]'),h=void 0;e&&(f=f.filter(function(a,b){return null!=e&&(e.has(b).length||g.has(b).length||e.is(b)||g.is(b))})),f.each(function(a,b){if(d.is(b))return h=a,!1});var i=void 0,j=void 0,k=void 0;if(void 0!=h){var l=1;b.shiftKey&&(l=-1),i=h;do i+=l,j=a(f[i]);while(j.length&&j.is(":disabled")||j.is(":hidden"));j.length?(k=j.closest(e).length,k=k||j.closest(this.currentStepNode).length):k=!1}k?j.focus():b.shiftKey?this.currentStepNode.find(c).last().focus():this.currentStepConfig.isOrphan?this.currentStepNode.focus():e.focus(),b.preventDefault()}}).call(this)}},c.prototype.startTour=function(a){if(this.storage&&"undefined"==typeof a){var b=this.storage.getItem(this.storageKey);if(b){var c=parseInt(b,10);c<=this.steps.length&&(a=c)}}return"undefined"==typeof a&&(a=this.getCurrentStepNumber()),this.fireEventHandlers("beforeStart",a),this.gotoStep(a),this.fireEventHandlers("afterStart",a),this},c.prototype.restartTour=function(){return this.startTour(0)},c.prototype.endTour=function(){if(this.fireEventHandlers("beforeEnd"),this.currentStepConfig){var a=this.getStepTarget(this.currentStepConfig);a&&(a.attr("tabindex")||a.attr("tabindex","-1"),a.focus())}return this.hide(!0),this.fireEventHandlers("afterEnd"),this},c.prototype.hide=function(b){if(this.fireEventHandlers("beforeHide"),this.currentStepNode&&this.currentStepNode.length&&(this.currentStepNode.hide(),this.currentStepPopper&&this.currentStepPopper.destroy()),this.currentStepConfig){var c=this.getStepTarget(this.currentStepConfig);c&&(c.data("original-labelledby")&&c.attr("aria-labelledby",c.data("original-labelledby")),c.data("original-describedby")&&c.attr("aria-describedby",c.data("original-describedby")),c.data("original-tabindex")&&c.attr("tabindex",c.data("tabindex"))),this.currentStepConfig=null}var d=0;if(b&&(d=400),a('[data-flexitour="step-background"]').remove(),a('[data-flexitour="step-backdrop"]').removeAttr("data-flexitour"),a('[data-flexitour="backdrop"]').fadeOut(d,function(){a(this).remove()}),this.currentStepNode&&this.currentStepNode.length){var e=this.currentStepNode.attr("id");if(e){var f='[aria-describedby="'+e+'-body"]';a(f).removeAttr("tabindex"),a(f).removeAttr("aria-describedby")}}return this.resetStepListeners(),this.accessibilityHide(),this.fireEventHandlers("afterHide"),this.currentStepNode=null,this.currentStepPopper=null,this},c.prototype.show=function(){var a=this.getCurrentStepNumber();return this.gotoStep(a)},c.prototype.getStepContainer=function(){return a(this.currentStepNode)},c.prototype.calculateScrollTop=function(b){var c=a(window).scrollTop(),d=a(window).height(),e=this.getStepTarget(b);return c="top"===b.placement?e.offset().top-d/2:"bottom"===b.placement?e.offset().top+e.height()-d/2:e.height()<=.8*d?e.offset().top-(d-e.height())/2:e.offset().top-.2*d,c=Math.max(0,c),c=Math.min(a(document).height()-d,c),Math.ceil(c)},c.prototype.calculateStepPositionInPage=function(){var b=a(window).height(),c=this.currentStepNode.height(),d=a(window).width(),e=this.currentStepNode.width();return{top:Math.ceil((b-c)/2),left:Math.ceil((d-e)/2)}},c.prototype.positionStep=function(c){var d=this.currentStepNode;if(!d||!d.length)return this;var e=void 0;switch(c.placement){case"left":e=["left","right","top","bottom"];break;case"right":e=["right","left","top","bottom"];break;case"top":e=["top","bottom","right","left"];break;case"bottom":e=["bottom","top","right","left"];break;default:e="flip"}var f=this.getStepTarget(c),g={placement:c.placement+"-start",removeOnDestroy:!0,modifiers:{flip:{behaviour:e},arrow:{element:'[data-role="arrow"]'}},onCreate:function(a){h(a)},onUpdate:function(a){h(a)}},h=function(b){var c=b.placement.split("-")[0],d=["left","right"].indexOf(c)!==-1,e=b.instance.popper.querySelector('[data-role="arrow"]'),f=a(b.instance.popper.querySelector('[data-role="flexitour-step"]'));if(d){var g=parseFloat(window.getComputedStyle(e).height),h=parseFloat(window.getComputedStyle(e).top),i=parseFloat(window.getComputedStyle(b.instance.popper).height),j=parseFloat(window.getComputedStyle(b.instance.popper).top),k=parseFloat(f.css("borderTopWidth")),l=2*parseFloat(f.css("borderTopLeftRadius")),m=h+g/2,n=i+j-k-l,o=j+k+l;if(m>=n||m<=o){var p=0;p=m>i/2?n-g:o+g,a(e).css("top",p)}}else{var q=parseFloat(window.getComputedStyle(e).width),r=parseFloat(window.getComputedStyle(e).left),s=parseFloat(window.getComputedStyle(b.instance.popper).width),t=parseFloat(window.getComputedStyle(b.instance.popper).left),u=parseFloat(f.css("borderTopWidth")),v=2*parseFloat(f.css("borderTopLeftRadius")),w=r+q/2,x=s+t-u-v,y=t+u+v;if(w>=x||w<=y){var z=0;z=w>s/2?x-q:y+q,a(e).css("left",z)}}},i=a('[data-flexitour="step-background"]');return i.length&&(f=i),this.currentStepPopper=new b(f,d[0],g),this},c.prototype.positionBackdrop=function(b){if(b.backdrop){this.currentStepConfig.hasBackdrop=!0;var c=a('<div data-flexitour="backdrop"></div>');if(b.zIndex?"append"===b.attachPoint?b.attachTo.append(c):c.insertAfter(b.attachTo):a("body").append(c),this.isStepActuallyVisible(b)){var d=a('<div data-flexitour="step-background"></div>'),e=this.getStepTarget(b),f=10,g=e;f&&(g=a("body")),d.css({width:e.outerWidth()+f+f,height:e.outerHeight()+f+f,left:e.offset().left-f,top:e.offset().top-f,backgroundColor:this.calculateInherittedBackgroundColor(g)}),e.offset().left<f&&d.css({width:e.outerWidth()+e.offset().left+f,left:e.offset().left}),e.offset().top<f&&d.css({height:e.outerHeight()+e.offset().top+f,top:e.offset().top});var h=e.css("borderRadius");h&&h!==a("body").css("borderRadius")&&d.css("borderRadius",h);var i=this.calculatePosition(e);"fixed"===i?d.css("top",0):"absolute"===i&&d.css("position","fixed");var j=d.clone();j.css({backgroundColor:c.css("backgroundColor"),opacity:c.css("opacity")}),j.attr("data-flexitour","step-background-fader"),b.zIndex?"append"===b.attachPoint?b.attachTo.append(d):(j.insertAfter(b.attachTo),d.insertAfter(b.attachTo)):(a("body").append(j),a("body").append(d)),e.attr("data-flexitour","step-backdrop"),b.zIndex&&(c.css("zIndex",b.zIndex),d.css("zIndex",b.zIndex+1),e.css("zIndex",b.zIndex+2)),j.fadeOut("2000",function(){a(this).remove()})}}return this},c.prototype.calculateZIndex=function(b){for(b=a(b);b.length&&b[0]!==document;){var c=b.css("position");if("absolute"===c||"relative"===c||"fixed"===c){var d=parseInt(b.css("zIndex"),10);if(!isNaN(d)&&0!==d)return d}b=b.parent()}return 0},c.prototype.calculateInherittedBackgroundColor=function(b){var c=a("<div>").hide();a("body").append(c);var d=c.css("backgroundColor");for(c.remove(),b=a(b);b.length&&b[0]!==document;){var e=b.css("backgroundColor");if(e!==d)return e;b=b.parent()}return null},c.prototype.calculatePosition=function(b){for(b=a(b);b.length&&b[0]!==document;){var c=b.css("position");if("static"!==c)return c;b=b.parent()}return null},c.prototype.accessibilityShow=function(){var b="data-has-hidden",c="aria-hidden",d=function(a){var d=a.data("flexitour");if(d)switch(d){case"container":case"target":return}var e=a.attr(c);e||(a.attr(b,!0),a.attr(c,!0))};this.currentStepNode.siblings().each(function(b,c){d(a(c))}),this.currentStepNode.parentsUntil("body").siblings().each(function(b,c){d(a(c))})},c.prototype.accessibilityHide=function(){var b="data-has-hidden",c="aria-hidden",d=function(a){var d=a.attr(b);"undefined"!=typeof d&&(a.removeAttr(b),a.removeAttr(c))};a("["+b+"]").each(function(b,c){d(a(c))})},"object"===("undefined"==typeof exports?"undefined":d(exports))&&(module.exports=c),c});
define('tool_xmldb/move', ["jquery","core/sortable_list","core/ajax","core/notification"],function(a,b,c,d){return{init:function(e,f){var g=new b("#"+e+" tbody");g.getElementName=function(b){return a.Deferred().resolve(b.attr("data-name"))};var h;a("#"+e+" tbody tr").on(b.EVENTS.DRAGSTART,function(b,c){h=c.sourceList.children().index(c.element),setTimeout(function(){a(".sortable-list-is-dragged").width(c.element.width())},501)}).on(b.EVENTS.DROP,function(a,b){var e=b.targetList.children().index(b.element),g=b.element.find("[data-action="+f+"]");if(b.positionChanged&&g.length){var i={methodname:"tool_xmldb_invoke_move_action",args:{action:f,dir:g.attr("data-dir"),table:g.attr("data-table"),field:g.attr("data-field"),key:g.attr("data-key"),index:g.attr("data-index"),position:e-h}};c.call([i])[0].fail(d.exception)}})}}});
define('theme_boost/modal', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="modal",c="4.0.0",d="bs.modal",h=".".concat(d),j=".data-api",l=a.fn[b],m=300,n=150,o=27,p={backdrop:!0,keyboard:!0,focus:!0,show:!0},q={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},r={HIDE:"hide".concat(h),HIDDEN:"hidden".concat(h),SHOW:"show".concat(h),SHOWN:"shown".concat(h),FOCUSIN:"focusin".concat(h),RESIZE:"resize".concat(h),CLICK_DISMISS:"click.dismiss".concat(h),KEYDOWN_DISMISS:"keydown.dismiss".concat(h),MOUSEUP_DISMISS:"mouseup.dismiss".concat(h),MOUSEDOWN_DISMISS:"mousedown.dismiss".concat(h),CLICK_DATA_API:"click".concat(h).concat(j)},s={SCROLLBAR_MEASURER:"modal-scrollbar-measure",BACKDROP:"modal-backdrop",OPEN:"modal-open",FADE:"fade",SHOW:"show"},t={DIALOG:".modal-dialog",DATA_TOGGLE:'[data-toggle="modal"]',DATA_DISMISS:'[data-dismiss="modal"]',FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"},u=function(){function j(b,c){g(this,j),this._config=this._getConfig(c),this._element=b,this._dialog=a(b).find(t.DIALOG)[0],this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._originalBodyPadding=0,this._scrollbarWidth=0}return i(j,[{key:"toggle",value:function(a){return this._isShown?this.hide():this.show(a)}},{key:"show",value:function(b){var c=this;if(!this._isTransitioning&&!this._isShown){k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE)&&(this._isTransitioning=!0);var d=a.Event(r.SHOW,{relatedTarget:b});a(this._element).trigger(d),this._isShown||d.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),a(document.body).addClass(s.OPEN),this._setEscapeEvent(),this._setResizeEvent(),a(this._element).on(r.CLICK_DISMISS,t.DATA_DISMISS,function(a){return c.hide(a)}),a(this._dialog).on(r.MOUSEDOWN_DISMISS,function(){a(c._element).one(r.MOUSEUP_DISMISS,function(b){a(b.target).is(c._element)&&(c._ignoreBackdropClick=!0)})}),this._showBackdrop(function(){return c._showElement(b)}))}}},{key:"hide",value:function(b){var c=this;if(b&&b.preventDefault(),!this._isTransitioning&&this._isShown){var d=a.Event(r.HIDE);if(a(this._element).trigger(d),this._isShown&&!d.isDefaultPrevented()){this._isShown=!1;var e=k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE);e&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),a(document).off(r.FOCUSIN),a(this._element).removeClass(s.SHOW),a(this._element).off(r.CLICK_DISMISS),a(this._dialog).off(r.MOUSEDOWN_DISMISS),e?a(this._element).one(k["default"].TRANSITION_END,function(a){return c._hideModal(a)}).emulateTransitionEnd(m):this._hideModal()}}}},{key:"dispose",value:function(){a.removeData(this._element,d),a(window,document,this._element,this._backdrop).off(h),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._scrollbarWidth=null}},{key:"handleUpdate",value:function(){this._adjustDialog()}},{key:"_getConfig",value:function(a){return a=f({},p,a),k["default"].typeCheckConfig(b,a,q),a}},{key:"_showElement",value:function(b){var c=this,d=k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.scrollTop=0,d&&k["default"].reflow(this._element),a(this._element).addClass(s.SHOW),this._config.focus&&this._enforceFocus();var e=a.Event(r.SHOWN,{relatedTarget:b}),f=function(){c._config.focus&&c._element.focus(),c._isTransitioning=!1,a(c._element).trigger(e)};d?a(this._dialog).one(k["default"].TRANSITION_END,f).emulateTransitionEnd(m):f()}},{key:"_enforceFocus",value:function(){var b=this;a(document).off(r.FOCUSIN).on(r.FOCUSIN,function(c){document!==c.target&&b._element!==c.target&&0===a(b._element).has(c.target).length&&b._element.focus()})}},{key:"_setEscapeEvent",value:function(){var b=this;this._isShown&&this._config.keyboard?a(this._element).on(r.KEYDOWN_DISMISS,function(a){a.which===o&&(a.preventDefault(),b.hide())}):this._isShown||a(this._element).off(r.KEYDOWN_DISMISS)}},{key:"_setResizeEvent",value:function(){var b=this;this._isShown?a(window).on(r.RESIZE,function(a){return b.handleUpdate(a)}):a(window).off(r.RESIZE)}},{key:"_hideModal",value:function(){var b=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._isTransitioning=!1,this._showBackdrop(function(){a(document.body).removeClass(s.OPEN),b._resetAdjustments(),b._resetScrollbar(),a(b._element).trigger(r.HIDDEN)})}},{key:"_removeBackdrop",value:function(){this._backdrop&&(a(this._backdrop).remove(),this._backdrop=null)}},{key:"_showBackdrop",value:function(b){var c=this,d=a(this._element).hasClass(s.FADE)?s.FADE:"";if(this._isShown&&this._config.backdrop){var e=k["default"].supportsTransitionEnd()&&d;if(this._backdrop=document.createElement("div"),this._backdrop.className=s.BACKDROP,d&&a(this._backdrop).addClass(d),a(this._backdrop).appendTo(document.body),a(this._element).on(r.CLICK_DISMISS,function(a){return c._ignoreBackdropClick?void(c._ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"===c._config.backdrop?c._element.focus():c.hide()))}),e&&k["default"].reflow(this._backdrop),a(this._backdrop).addClass(s.SHOW),!b)return;if(!e)return void b();a(this._backdrop).one(k["default"].TRANSITION_END,b).emulateTransitionEnd(n)}else if(!this._isShown&&this._backdrop){a(this._backdrop).removeClass(s.SHOW);var f=function(){c._removeBackdrop(),b&&b()};k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE)?a(this._backdrop).one(k["default"].TRANSITION_END,f).emulateTransitionEnd(n):f()}else b&&b()}},{key:"_adjustDialog",value:function(){var a=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&a&&(this._element.style.paddingLeft="".concat(this._scrollbarWidth,"px")),this._isBodyOverflowing&&!a&&(this._element.style.paddingRight="".concat(this._scrollbarWidth,"px"))}},{key:"_resetAdjustments",value:function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}},{key:"_checkScrollbar",value:function(){var a=document.body.getBoundingClientRect();this._isBodyOverflowing=a.left+a.right<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()}},{key:"_setScrollbar",value:function(){var b=this;if(this._isBodyOverflowing){a(t.FIXED_CONTENT).each(function(c,d){var e=a(d)[0].style.paddingRight,f=a(d).css("padding-right");a(d).data("padding-right",e).css("padding-right","".concat(parseFloat(f)+b._scrollbarWidth,"px"))}),a(t.STICKY_CONTENT).each(function(c,d){var e=a(d)[0].style.marginRight,f=a(d).css("margin-right");a(d).data("margin-right",e).css("margin-right","".concat(parseFloat(f)-b._scrollbarWidth,"px"))}),a(t.NAVBAR_TOGGLER).each(function(c,d){var e=a(d)[0].style.marginRight,f=a(d).css("margin-right");a(d).data("margin-right",e).css("margin-right","".concat(parseFloat(f)+b._scrollbarWidth,"px"))});var c=document.body.style.paddingRight,d=a("body").css("padding-right");a("body").data("padding-right",c).css("padding-right","".concat(parseFloat(d)+this._scrollbarWidth,"px"))}}},{key:"_resetScrollbar",value:function(){a(t.FIXED_CONTENT).each(function(b,c){var d=a(c).data("padding-right");"undefined"!=typeof d&&a(c).css("padding-right",d).removeData("padding-right")}),a("".concat(t.STICKY_CONTENT,", ").concat(t.NAVBAR_TOGGLER)).each(function(b,c){var d=a(c).data("margin-right");"undefined"!=typeof d&&a(c).css("margin-right",d).removeData("margin-right")});var b=a("body").data("padding-right");"undefined"!=typeof b&&a("body").css("padding-right",b).removeData("padding-right")}},{key:"_getScrollbarWidth",value:function(){var a=document.createElement("div");a.className=s.SCROLLBAR_MEASURER,document.body.appendChild(a);var b=a.getBoundingClientRect().width-a.clientWidth;return document.body.removeChild(a),b}}],[{key:"_jQueryInterface",value:function(b,c){return this.each(function(){var g=a(this).data(d),h=f({},j.Default,a(this).data(),"object"===e(b)&&b);if(g||(g=new j(this,h),a(this).data(d,g)),"string"==typeof b){if("undefined"==typeof g[b])throw new TypeError('No method named "'.concat(b,'"'));g[b](c)}else h.show&&g.show(c)})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return p}}]),j}();return a(document).on(r.CLICK_DATA_API,t.DATA_TOGGLE,function(b){var c,e=this,g=k["default"].getSelectorFromElement(this);g&&(c=a(g)[0]);var h=a(c).data(d)?"toggle":f({},a(c).data(),a(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||b.preventDefault();var i=a(c).one(r.SHOW,function(b){b.isDefaultPrevented()||i.one(r.HIDDEN,function(){a(e).is(":visible")&&e.focus()})});u._jQueryInterface.call(a(c),h,this)}),a.fn[b]=u._jQueryInterface,a.fn[b].Constructor=u,a.fn[b].noConflict=function(){return a.fn[b]=l,u._jQueryInterface},u}(j["default"]);a["default"]=l});
define('theme_boost/form-display-errors', ["jquery","core/event"],function(a,b){return{enhance:function(c){var d=document.getElementById(c);a(d).on(b.Events.FORM_FIELD_VALIDATION,function(b,c){b.preventDefault();var e=a(d).closest(".form-group"),f=e.find(".form-control-feedback");"TEXTAREA"==a(d).prop("tagName")&&e.find("[contenteditable]")&&(d=e.find("[contenteditable]")),""!==c?(e.addClass("has-danger"),e.data("client-validation-error",!0),a(d).addClass("is-invalid"),a(d).attr("aria-describedby",f.attr("id")),a(d).attr("aria-invalid",!0),f.attr("tabindex",0),f.html(c),f.is(":visible")||(f.show(),f.focus())):e.data("client-validation-error")===!0&&(e.removeClass("has-danger"),e.data("client-validation-error",!1),a(d).removeClass("is-invalid"),a(d).removeAttr("aria-describedby"),a(d).attr("aria-invalid",!1),f.hide())})}}});
define('theme_boost/drawer', ["jquery","core/custom_interaction_events","core/log"],function(a,b,c){var d={TOGGLE_REGION:'[data-region="drawer-toggle"]',TOGGLE_ACTION:'[data-action="toggle-drawer"]',TOGGLE_TARGET:"aria-controls",TOGGLE_SIDE:"left",BODY:"body",SECTION:'.list-group-item[href*="#section-"]'},e=a(document).width()<768,f=function(){a(d.TOGGLE_REGION).length||c.debug("Page is missing a drawer region"),a(d.TOGGLE_ACTION).length||c.debug("Page is missing a drawer toggle link"),a(d.TOGGLE_REGION).each(function(b,c){var f=a(c).find(d.TOGGLE_ACTION),g=f.attr("aria-controls"),h=a(document.getElementById(g)),i="false"==f.attr("aria-expanded"),j=f.attr("data-side"),k=a(d.BODY),l=f.attr("data-preference");e&&M.util.set_user_preference(l,"false"),h.on("mousewheel DOMMouseScroll",this.preventPageScroll),i?f.attr("aria-expanded","false"):(k.addClass("drawer-open-"+j),f.attr("aria-expanded","true"))}.bind(this)),this.registerEventListeners(),e&&this.closeAll()};return f.prototype.closeAll=function(){a(d.TOGGLE_REGION).each(function(b,c){var f=a(c).find(d.TOGGLE_ACTION),g=f.attr("data-side"),h=a(d.BODY),i=f.attr("aria-controls"),j=a(document.getElementById(i)),k=f.attr("data-preference");f.attr("aria-expanded","false"),h.removeClass("drawer-open-"+g),j.attr("aria-hidden","true"),j.addClass("closed"),e||M.util.set_user_preference(k,"false")})},f.prototype.toggleDrawer=function(b){var c=a(b.target).closest("[data-action=toggle-drawer]"),f=c.attr("aria-controls"),g=a(document.getElementById(f)),h=a(d.BODY),i=c.attr("data-side"),j=c.attr("data-preference");e&&M.util.set_user_preference(j,"false"),h.addClass("drawer-ease");var k="true"==c.attr("aria-expanded");k?(h.removeClass("drawer-open-"+i),c.attr("aria-expanded","false"),g.attr("aria-hidden","true"),g.addClass("closed"),e||M.util.set_user_preference(j,"false")):(c.attr("aria-expanded","true"),g.attr("aria-hidden","false"),g.focus(),h.addClass("drawer-open-"+i),g.removeClass("closed"),e||M.util.set_user_preference(j,"true"))},f.prototype.preventPageScroll=function(b){var c=b.wheelDelta||b.originalEvent&&b.originalEvent.wheelDelta||-b.originalEvent.detail,d=this.scrollTop+a(this).outerHeight()-this.scrollHeight>=0,e=this.scrollTop<=0;(c<0&&d||c>0&&e)&&b.preventDefault()},f.prototype.registerEventListeners=function(){a(d.TOGGLE_ACTION).each(function(c,d){b.define(a(d),[b.events.activate]),a(d).on(b.events.activate,function(a,b){this.toggleDrawer(b.originalEvent),b.originalEvent.preventDefault()}.bind(this))}.bind(this)),a(d.SECTION).click(function(){e&&this.closeAll()}.bind(this))},{init:function(){return new f}}});
define('theme_boost/scrollspy', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="scrollspy",c="4.0.0",d="bs.scrollspy",h=".".concat(d),j=".data-api",l=a.fn[b],m={offset:10,method:"auto",target:""},n={offset:"number",method:"string",target:"(string|element)"},o={ACTIVATE:"activate".concat(h),SCROLL:"scroll".concat(h),LOAD_DATA_API:"load".concat(h).concat(j)},p={DROPDOWN_ITEM:"dropdown-item",DROPDOWN_MENU:"dropdown-menu",ACTIVE:"active"},q={DATA_SPY:'[data-spy="scroll"]',ACTIVE:".active",NAV_LIST_GROUP:".nav, .list-group",NAV_LINKS:".nav-link",NAV_ITEMS:".nav-item",LIST_ITEMS:".list-group-item",DROPDOWN:".dropdown",DROPDOWN_ITEMS:".dropdown-item",DROPDOWN_TOGGLE:".dropdown-toggle"},r={OFFSET:"offset",POSITION:"position"},s=function(){function j(b,c){var d=this;g(this,j),this._element=b,this._scrollElement="BODY"===b.tagName?window:b,this._config=this._getConfig(c),this._selector="".concat(this._config.target," ").concat(q.NAV_LINKS,",")+"".concat(this._config.target," ").concat(q.LIST_ITEMS,",")+"".concat(this._config.target," ").concat(q.DROPDOWN_ITEMS),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,a(this._scrollElement).on(o.SCROLL,function(a){return d._process(a)}),this.refresh(),this._process()}return i(j,[{key:"refresh",value:function(){var b=this,c=this._scrollElement===this._scrollElement.window?r.OFFSET:r.POSITION,d="auto"===this._config.method?c:this._config.method,e=d===r.POSITION?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight();var f=a.makeArray(a(this._selector));f.map(function(b){var c,f=k["default"].getSelectorFromElement(b);if(f&&(c=a(f)[0]),c){var g=c.getBoundingClientRect();if(g.width||g.height)return[a(c)[d]().top+e,f]}return null}).filter(function(a){return a}).sort(function(a,b){return a[0]-b[0]}).forEach(function(a){b._offsets.push(a[0]),b._targets.push(a[1])})}},{key:"dispose",value:function(){a.removeData(this._element,d),a(this._scrollElement).off(h),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null}},{key:"_getConfig",value:function(c){if(c=f({},m,c),"string"!=typeof c.target){var d=a(c.target).attr("id");d||(d=k["default"].getUID(b),a(c.target).attr("id",d)),c.target="#".concat(d)}return k["default"].typeCheckConfig(b,c,n),c}},{key:"_getScrollTop",value:function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}},{key:"_getScrollHeight",value:function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}},{key:"_getOffsetHeight",value:function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}},{key:"_process",value:function(){var a=this._getScrollTop()+this._config.offset,b=this._getScrollHeight(),c=this._config.offset+b-this._getOffsetHeight();if(this._scrollHeight!==b&&this.refresh(),a>=c){var d=this._targets[this._targets.length-1];return void(this._activeTarget!==d&&this._activate(d))}if(this._activeTarget&&a<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(var e=this._offsets.length;e--;){var f=this._activeTarget!==this._targets[e]&&a>=this._offsets[e]&&("undefined"==typeof this._offsets[e+1]||a<this._offsets[e+1]);f&&this._activate(this._targets[e])}}},{key:"_activate",value:function(b){this._activeTarget=b,this._clear();var c=this._selector.split(",");c=c.map(function(a){return"".concat(a,'[data-target="').concat(b,'"],')+"".concat(a,'[href="').concat(b,'"]')});var d=a(c.join(","));d.hasClass(p.DROPDOWN_ITEM)?(d.closest(q.DROPDOWN).find(q.DROPDOWN_TOGGLE).addClass(p.ACTIVE),d.addClass(p.ACTIVE)):(d.addClass(p.ACTIVE),d.parents(q.NAV_LIST_GROUP).prev("".concat(q.NAV_LINKS,", ").concat(q.LIST_ITEMS)).addClass(p.ACTIVE),d.parents(q.NAV_LIST_GROUP).prev(q.NAV_ITEMS).children(q.NAV_LINKS).addClass(p.ACTIVE)),a(this._scrollElement).trigger(o.ACTIVATE,{relatedTarget:b})}},{key:"_clear",value:function(){a(this._selector).filter(q.ACTIVE).removeClass(p.ACTIVE)}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),f="object"===e(b)&&b;if(c||(c=new j(this,f),a(this).data(d,c)),"string"==typeof b){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return m}}]),j}();return a(window).on(o.LOAD_DATA_API,function(){for(var b=a.makeArray(a(q.DATA_SPY)),c=b.length;c--;){var d=a(b[c]);s._jQueryInterface.call(d,d.data())}}),a.fn[b]=s._jQueryInterface,a.fn[b].Constructor=s,a.fn[b].noConflict=function(){return a.fn[b]=l,s._jQueryInterface},s}(j["default"]);a["default"]=l});
define('theme_boost/loader', ["jquery","./tether","core/event"],function(a,b,c){return window.jQuery=a,window.Tether=b,M.util.js_pending("theme_boost/loader:children"),require(["theme_boost/aria","theme_boost/pending","theme_boost/util","theme_boost/alert","theme_boost/button","theme_boost/carousel","theme_boost/collapse","theme_boost/dropdown","theme_boost/modal","theme_boost/scrollspy","theme_boost/tab","theme_boost/tooltip","theme_boost/popover"],function(b){a("body").popover({trigger:"focus",selector:"[data-toggle=popover][data-trigger!=hover]"}),a("html").popover({container:"body",selector:"[data-toggle=popover][data-trigger=hover]",trigger:"hover",delay:{hide:500}}),c.getLegacyEvents().done(function(b){a(document).on(b.FILTER_CONTENT_UPDATED,function(){a("body").popover({selector:'[data-toggle="popover"]',trigger:"focus"})})}),b.init(),M.util.js_complete("theme_boost/loader:children")}),{}});
define('theme_boost/popover', ["exports","jquery","./tooltip"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function h(a,b,c){return b&&g(a.prototype,b),c&&g(a,c),a}function i(a,b){if(b&&("object"===e(b)||"function"==typeof b))return b;if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function j(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function k(){return k=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},k.apply(this,arguments)}Object.defineProperty(a,"__esModule",{value:!0});var l=d(b),m=d(c),n=function(a){var b="popover",c="4.0.0",d="bs.popover",g=".".concat(d),l=a.fn[b],n="bs-popover",o=new RegExp("(^|\\s)".concat(n,"\\S+"),"g"),p=k({},m["default"].Default,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),q=k({},m["default"].DefaultType,{content:"(string|element|function)"}),r={FADE:"fade",SHOW:"show"},s={TITLE:".popover-header",CONTENT:".popover-body"},t={HIDE:"hide".concat(g),HIDDEN:"hidden".concat(g),SHOW:"show".concat(g),SHOWN:"shown".concat(g),INSERTED:"inserted".concat(g),CLICK:"click".concat(g),FOCUSIN:"focusin".concat(g),FOCUSOUT:"focusout".concat(g),MOUSEENTER:"mouseenter".concat(g),MOUSELEAVE:"mouseleave".concat(g)},u=function(k){function l(){return f(this,l),i(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}return j(l,k),h(l,[{key:"isWithContent",value:function(){return this.getTitle()||this._getContent()}},{key:"addAttachmentClass",value:function(b){a(this.getTipElement()).addClass("".concat(n,"-").concat(b))}},{key:"getTipElement",value:function(){return this.tip=this.tip||a(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var b=a(this.getTipElement());this.setElementContent(b.find(s.TITLE),this.getTitle());var c=this._getContent();"function"==typeof c&&(c=c.call(this.element)),this.setElementContent(b.find(s.CONTENT),c),b.removeClass("".concat(r.FADE," ").concat(r.SHOW))}},{key:"_getContent",value:function(){return this.element.getAttribute("data-content")||this.config.content}},{key:"_cleanTipClass",value:function(){var b=a(this.getTipElement()),c=b.attr("class").match(o);null!==c&&c.length>0&&b.removeClass(c.join(""))}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),f="object"===e(b)?b:null;if((c||!/destroy|hide/.test(b))&&(c||(c=new l(this,f),a(this).data(d,c)),"string"==typeof b)){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return p}},{key:"NAME",get:function(){return b}},{key:"DATA_KEY",get:function(){return d}},{key:"Event",get:function(){return t}},{key:"EVENT_KEY",get:function(){return g}},{key:"DefaultType",get:function(){return q}}]),l}(m["default"]);return a.fn[b]=u._jQueryInterface,a.fn[b].Constructor=u,a.fn[b].noConflict=function(){return a.fn[b]=l,u._jQueryInterface},u}(l["default"]);a["default"]=n});
define('theme_boost/aria', ["jquery","core/pending"],function(a,b){return{init:function(){var c=!1,d=function(){c=!0},e=function(){var a=c;return c=!1,a};a('[data-toggle="dropdown"]').keydown(function(b){var c,e=b.which||b.keyCode;38==e&&d(),27==e&&(c=a(b.target).attr("aria-expanded"),b.preventDefault(),"false"==c&&a(b.target).click()),32!=e&&13!=e||(b.preventDefault(),a(b.target).click())});var f=function(c){var d=function(b){a(this).focus(),b.resolve()}.bind(c);setTimeout(d,50,new b("core/aria:delayed-focus"))};a(".dropdown").on("shown.bs.dropdown",function(b){var c=a(b.target).find('[role="menu"]'),d=!1,g=!1;c&&(d=a(c).find('[role="menuitem"]')),d&&d.length>0&&(g=e()?d[d.length-1]:d[0]),g&&f(g)}),a('.dropdown [role="menu"] [role="menuitem"]').keypress(function(b){var c,d,e=String.fromCharCode(b.which||b.keyCode),g=a(b.target).closest('[role="menu"]'),h=0,i=!1;if(g&&(i=a(g).find('[role="menuitem"]')))for(e=e.toLowerCase(),h=0;h<i.length;h++)if(c=a(i[h]),d=c.text().trim().toLowerCase(),0==d.indexOf(e)){f(c);break}}),a('.dropdown [role="menu"] [role="menuitem"]').keydown(function(b){var c=b.which||b.keyCode,d=!1,e=a(b.target).closest('[role="menu"]'),g=0,h=!1;if(e&&(h=a(e).find('[role="menuitem"]'))){if(40==c){for(g=0;g<h.length-1;g++)if(h[g]==b.target){d=h[g+1];break}d||(d=h[0])}else if(38==c){for(g=1;g<h.length;g++)if(h[g]==b.target){d=h[g-1];break}d||(d=h[h.length-1])}else 36==c?d=h[0]:35==c&&(d=h[h.length-1]);d&&(b.preventDefault(),f(d))}}),a(".dropdown").on("hidden.bs.dropdown",function(b){var c=a(b.target).find('[data-toggle="dropdown"]');c&&f(c)});var g=new b("core/aria:delayed-focus");a(function(){window.setTimeout(function(b){var c=a('[role="alert"][data-aria-autofocus="true"]');c.length>0&&(a(c[0]).attr("tabindex","0"),a(c[0]).focus()),b.resolve()},300,g)})}}});
define('theme_boost/dropdown', ["exports","jquery","core/popper","./util"],function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}function f(a){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function g(){return g=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},g.apply(this,arguments)}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function i(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function j(a,b,c){return b&&i(a.prototype,b),c&&i(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var k=e(b),l=e(c),m=e(d),n=function(a){var b="dropdown",c="4.0.0",d="bs.dropdown",e=".".concat(d),i=".data-api",k=a.fn[b],n=27,o=32,p=9,q=38,r=40,s=3,t=new RegExp("".concat(q,"|").concat(r,"|").concat(n)),u={HIDE:"hide".concat(e),HIDDEN:"hidden".concat(e),SHOW:"show".concat(e),SHOWN:"shown".concat(e),CLICK:"click".concat(e),CLICK_DATA_API:"click".concat(e).concat(i),KEYDOWN_DATA_API:"keydown".concat(e).concat(i),KEYUP_DATA_API:"keyup".concat(e).concat(i)},v={DISABLED:"disabled",SHOW:"show",DROPUP:"dropup",DROPRIGHT:"dropright",DROPLEFT:"dropleft",MENURIGHT:"dropdown-menu-right",MENULEFT:"dropdown-menu-left",POSITION_STATIC:"position-static"},w={DATA_TOGGLE:'[data-toggle="dropdown"]',FORM_CHILD:".dropdown form",MENU:".dropdown-menu",NAVBAR_NAV:".navbar-nav",VISIBLE_ITEMS:".dropdown-menu .dropdown-item:not(.disabled)"},x={TOP:"top-start",TOPEND:"top-end",BOTTOM:"bottom-start",BOTTOMEND:"bottom-end",RIGHT:"right-start",RIGHTEND:"right-end",LEFT:"left-start",LEFTEND:"left-end"},y={offset:0,flip:!1,boundary:"scrollParent"},z={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)"},A=function(){function i(a,b){h(this,i),this._element=a,this._popper=null,this._config=this._getConfig(b),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}return j(i,[{key:"toggle",value:function(){if(!this._element.disabled&&!a(this._element).hasClass(v.DISABLED)){var b=i._getParentFromElement(this._element),c=a(this._menu).hasClass(v.SHOW);if(i._clearMenus(),!c){var d={relatedTarget:this._element},e=a.Event(u.SHOW,d);if(a(b).trigger(e),!e.isDefaultPrevented()){if(!this._inNavbar){if("undefined"==typeof l["default"])throw new TypeError("Bootstrap dropdown require Popper.js (https://popper.js.org)");var f=this._element;a(b).hasClass(v.DROPUP)&&(a(this._menu).hasClass(v.MENULEFT)||a(this._menu).hasClass(v.MENURIGHT))&&(f=b),"scrollParent"!==this._config.boundary&&a(b).addClass(v.POSITION_STATIC),this._popper=new l["default"](f,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===a(b).closest(w.NAVBAR_NAV).length&&a("body").children().on("mouseover",null,a.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),a(this._menu).toggleClass(v.SHOW),a(b).toggleClass(v.SHOW).trigger(a.Event(u.SHOWN,d))}}}}},{key:"dispose",value:function(){a.removeData(this._element,d),a(this._element).off(e),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}},{key:"update",value:function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}},{key:"_addEventListeners",value:function(){var b=this;a(this._element).on(u.CLICK,function(a){a.preventDefault(),a.stopPropagation(),b.toggle()})}},{key:"_getConfig",value:function(c){return c=g({},this.constructor.Default,a(this._element).data(),c),m["default"].typeCheckConfig(b,c,this.constructor.DefaultType),c}},{key:"_getMenuElement",value:function(){if(!this._menu){var b=i._getParentFromElement(this._element);this._menu=a(b).find(w.MENU)[0]}return this._menu}},{key:"_getPlacement",value:function(){var b=a(this._element).parent(),c=x.BOTTOM;return b.hasClass(v.DROPUP)?(c=x.TOP,a(this._menu).hasClass(v.MENURIGHT)&&(c=x.TOPEND)):b.hasClass(v.DROPRIGHT)?c=x.RIGHT:b.hasClass(v.DROPLEFT)?c=x.LEFT:a(this._menu).hasClass(v.MENURIGHT)&&(c=x.BOTTOMEND),c}},{key:"_detectNavbar",value:function(){return a(this._element).closest(".navbar").length>0}},{key:"_getPopperConfig",value:function(){var a=this,b={};"function"==typeof this._config.offset?b.fn=function(b){return b.offsets=g({},b.offsets,a._config.offset(b.offsets)||{}),b}:b.offset=this._config.offset;var c={placement:this._getPlacement(),modifiers:{offset:b,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return c}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),e="object"===f(b)?b:null;if(c||(c=new i(this,e),a(this).data(d,c)),"string"==typeof b){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"_clearMenus",value:function(b){if(!b||b.which!==s&&("keyup"!==b.type||b.which===p))for(var c=a.makeArray(a(w.DATA_TOGGLE)),e=0;e<c.length;e++){var f=i._getParentFromElement(c[e]),g=a(c[e]).data(d),h={relatedTarget:c[e]};if(g){var j=g._menu;if(a(f).hasClass(v.SHOW)&&!(b&&("click"===b.type&&/input|textarea/i.test(b.target.tagName)||"keyup"===b.type&&b.which===p)&&a.contains(f,b.target))){var k=a.Event(u.HIDE,h);a(f).trigger(k),k.isDefaultPrevented()||("ontouchstart"in document.documentElement&&a("body").children().off("mouseover",null,a.noop),c[e].setAttribute("aria-expanded","false"),a(j).removeClass(v.SHOW),a(f).removeClass(v.SHOW).trigger(a.Event(u.HIDDEN,h)))}}}}},{key:"_getParentFromElement",value:function(b){var c,d=m["default"].getSelectorFromElement(b);return d&&(c=a(d)[0]),c||b.parentNode}},{key:"_dataApiKeydownHandler",value:function(b){if((/input|textarea/i.test(b.target.tagName)?!(b.which===o||b.which!==n&&(b.which!==r&&b.which!==q||a(b.target).closest(w.MENU).length)):t.test(b.which))&&(b.preventDefault(),b.stopPropagation(),!this.disabled&&!a(this).hasClass(v.DISABLED))){var c=i._getParentFromElement(this),d=a(c).hasClass(v.SHOW);if(!d&&(b.which!==n||b.which!==o)||d&&(b.which===n||b.which===o)){if(b.which===n){var e=a(c).find(w.DATA_TOGGLE)[0];a(e).trigger("focus")}return void a(this).trigger("click")}var f=a(c).find(w.VISIBLE_ITEMS).get();if(0!==f.length){var g=f.indexOf(b.target);b.which===q&&g>0&&g--,b.which===r&&g<f.length-1&&g++,g<0&&(g=0),f[g].focus()}}}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return y}},{key:"DefaultType",get:function(){return z}}]),i}();return a(document).on(u.KEYDOWN_DATA_API,w.DATA_TOGGLE,A._dataApiKeydownHandler).on(u.KEYDOWN_DATA_API,w.MENU,A._dataApiKeydownHandler).on("".concat(u.CLICK_DATA_API," ").concat(u.KEYUP_DATA_API),A._clearMenus).on(u.CLICK_DATA_API,w.DATA_TOGGLE,function(b){b.preventDefault(),b.stopPropagation(),A._jQueryInterface.call(a(this),"toggle")}).on(u.CLICK_DATA_API,w.FORM_CHILD,function(a){a.stopPropagation()}),a.fn[b]=A._jQueryInterface,a.fn[b].Constructor=A,a.fn[b].noConflict=function(){return a.fn[b]=k,A._jQueryInterface},A}(k["default"],l["default"]);a["default"]=n});
define('theme_boost/tab', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var h=d(b),i=d(c),j=function(a){var b="tab",c="4.0.0",d="bs.tab",f=".".concat(d),h=".data-api",j=a.fn[b],k=150,l={HIDE:"hide".concat(f),HIDDEN:"hidden".concat(f),SHOW:"show".concat(f),SHOWN:"shown".concat(f),CLICK_DATA_API:"click".concat(f).concat(h)},m={DROPDOWN_MENU:"dropdown-menu",ACTIVE:"active",DISABLED:"disabled",FADE:"fade",SHOW:"show"},n={DROPDOWN:".dropdown",NAV_LIST_GROUP:".nav, .list-group",ACTIVE:".active",ACTIVE_UL:"> li > .active",DATA_TOGGLE:'[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',DROPDOWN_TOGGLE:".dropdown-toggle",DROPDOWN_ACTIVE_CHILD:"> .dropdown-menu .active"},o=function(){function b(a){e(this,b),this._element=a}return g(b,[{key:"show",value:function(){var b=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&a(this._element).hasClass(m.ACTIVE)||a(this._element).hasClass(m.DISABLED))){var c,d,e=a(this._element).closest(n.NAV_LIST_GROUP)[0],f=i["default"].getSelectorFromElement(this._element);if(e){var g="UL"===e.nodeName?n.ACTIVE_UL:n.ACTIVE;d=a.makeArray(a(e).find(g)),d=d[d.length-1]}var h=a.Event(l.HIDE,{relatedTarget:this._element}),j=a.Event(l.SHOW,{relatedTarget:d});if(d&&a(d).trigger(h),a(this._element).trigger(j),!j.isDefaultPrevented()&&!h.isDefaultPrevented()){f&&(c=a(f)[0]),this._activate(this._element,e);var k=function(){var c=a.Event(l.HIDDEN,{relatedTarget:b._element}),e=a.Event(l.SHOWN,{relatedTarget:d});a(d).trigger(c),a(b._element).trigger(e)};c?this._activate(c,c.parentNode,k):k()}}}},{key:"dispose",value:function(){a.removeData(this._element,d),this._element=null}},{key:"_activate",value:function(b,c,d){var e,f=this;e="UL"===c.nodeName?a(c).find(n.ACTIVE_UL):a(c).children(n.ACTIVE);var g=e[0],h=d&&i["default"].supportsTransitionEnd()&&g&&a(g).hasClass(m.FADE),j=function(){return f._transitionComplete(b,g,d)};g&&h?a(g).one(i["default"].TRANSITION_END,j).emulateTransitionEnd(k):j()}},{key:"_transitionComplete",value:function(b,c,d){if(c){a(c).removeClass("".concat(m.SHOW," ").concat(m.ACTIVE));var e=a(c.parentNode).find(n.DROPDOWN_ACTIVE_CHILD)[0];e&&a(e).removeClass(m.ACTIVE),"tab"===c.getAttribute("role")&&c.setAttribute("aria-selected",!1)}if(a(b).addClass(m.ACTIVE),"tab"===b.getAttribute("role")&&b.setAttribute("aria-selected",!0),i["default"].reflow(b),a(b).addClass(m.SHOW),b.parentNode&&a(b.parentNode).hasClass(m.DROPDOWN_MENU)){var f=a(b).closest(n.DROPDOWN)[0];f&&a(f).find(n.DROPDOWN_TOGGLE).addClass(m.ACTIVE),b.setAttribute("aria-expanded",!0)}d&&d()}}],[{key:"_jQueryInterface",value:function(c){return this.each(function(){var e=a(this),f=e.data(d);if(f||(f=new b(this),e.data(d,f)),"string"==typeof c){if("undefined"==typeof f[c])throw new TypeError('No method named "'.concat(c,'"'));f[c]()}})}},{key:"VERSION",get:function(){return c}}]),b}();return a(document).on(l.CLICK_DATA_API,n.DATA_TOGGLE,function(b){b.preventDefault(),o._jQueryInterface.call(a(this),"show")}),a.fn[b]=o._jQueryInterface,a.fn[b].Constructor=o,a.fn[b].noConflict=function(){return a.fn[b]=j,o._jQueryInterface},o}(h["default"]);a["default"]=j});
define('theme_boost/pending', ["jquery"],function(a){var b={alert:[{start:"close",end:"closed"}],carousel:[{start:"slide",end:"slid"}],collapse:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],dropdown:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],modal:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],popover:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],tab:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],tooltip:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}]};Object.keys(b).forEach(function(c){b[c].forEach(function(b){var d=b.start+".bs."+c,e=b.end+".bs."+c;a(document.body).on(d,function(){M.util.js_pending(e)}),a(document.body).on(e,function(){M.util.js_complete(e)})})})});
define('theme_boost/alert', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var h=d(b),i=d(c),j=function(a){var b="alert",c="4.0.0",d="bs.alert",f=".".concat(d),h=".data-api",j=a.fn[b],k=150,l={DISMISS:'[data-dismiss="alert"]'},m={CLOSE:"close".concat(f),CLOSED:"closed".concat(f),CLICK_DATA_API:"click".concat(f).concat(h)},n={ALERT:"alert",FADE:"fade",SHOW:"show"},o=function(){function b(a){e(this,b),this._element=a}return g(b,[{key:"close",value:function(a){a=a||this._element;var b=this._getRootElement(a),c=this._triggerCloseEvent(b);c.isDefaultPrevented()||this._removeElement(b)}},{key:"dispose",value:function(){a.removeData(this._element,d),this._element=null}},{key:"_getRootElement",value:function(b){var c=i["default"].getSelectorFromElement(b),d=!1;return c&&(d=a(c)[0]),d||(d=a(b).closest(".".concat(n.ALERT))[0]),d}},{key:"_triggerCloseEvent",value:function(b){var c=a.Event(m.CLOSE);return a(b).trigger(c),c}},{key:"_removeElement",value:function(b){var c=this;return a(b).removeClass(n.SHOW),i["default"].supportsTransitionEnd()&&a(b).hasClass(n.FADE)?void a(b).one(i["default"].TRANSITION_END,function(a){return c._destroyElement(b,a)}).emulateTransitionEnd(k):void this._destroyElement(b)}},{key:"_destroyElement",value:function(b){a(b).detach().trigger(m.CLOSED).remove()}}],[{key:"_jQueryInterface",value:function(c){return this.each(function(){var e=a(this),f=e.data(d);f||(f=new b(this),e.data(d,f)),"close"===c&&f[c](this)})}},{key:"_handleDismiss",value:function(a){return function(b){b&&b.preventDefault(),a.close(this)}}},{key:"VERSION",get:function(){return c}}]),b}();return a(document).on(m.CLICK_DATA_API,l.DISMISS,o._handleDismiss(new o)),a.fn[b]=o._jQueryInterface,a.fn[b].Constructor=o,a.fn[b].noConflict=function(){return a.fn[b]=j,o._jQueryInterface},o}(h["default"]);a["default"]=j});
define('theme_boost/collapse', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="collapse",c="4.0.0",d="bs.collapse",h=".".concat(d),j=".data-api",l=a.fn[b],m=600,n={toggle:!0,parent:""},o={toggle:"boolean",parent:"(string|element)"},p={SHOW:"show".concat(h),SHOWN:"shown".concat(h),HIDE:"hide".concat(h),HIDDEN:"hidden".concat(h),CLICK_DATA_API:"click".concat(h).concat(j)},q={SHOW:"show",COLLAPSE:"collapse",COLLAPSING:"collapsing",COLLAPSED:"collapsed"},r={WIDTH:"width",HEIGHT:"height"},s={ACTIVES:".show, .collapsing",DATA_TOGGLE:'[data-toggle="collapse"]'},t=function(){function h(b,c){g(this,h),this._isTransitioning=!1,this._element=b,this._config=this._getConfig(c),this._triggerArray=a.makeArray(a('[data-toggle="collapse"][href="#'.concat(b.id,'"],')+'[data-toggle="collapse"][data-target="#'.concat(b.id,'"]')));for(var d=a(s.DATA_TOGGLE),e=0;e<d.length;e++){var f=d[e],i=k["default"].getSelectorFromElement(f);null!==i&&a(i).filter(b).length>0&&(this._selector=i,this._triggerArray.push(f))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}return i(h,[{key:"toggle",value:function(){a(this._element).hasClass(q.SHOW)?this.hide():this.show()}},{key:"show",value:function(){var b=this;if(!this._isTransitioning&&!a(this._element).hasClass(q.SHOW)){var c,e;if(this._parent&&(c=a.makeArray(a(this._parent).find(s.ACTIVES).filter('[data-parent="'.concat(this._config.parent,'"]'))),0===c.length&&(c=null)),!(c&&(e=a(c).not(this._selector).data(d),e&&e._isTransitioning))){var f=a.Event(p.SHOW);if(a(this._element).trigger(f),!f.isDefaultPrevented()){c&&(h._jQueryInterface.call(a(c).not(this._selector),"hide"),e||a(c).data(d,null));var g=this._getDimension();a(this._element).removeClass(q.COLLAPSE).addClass(q.COLLAPSING),this._element.style[g]=0,this._triggerArray.length>0&&a(this._triggerArray).removeClass(q.COLLAPSED).attr("aria-expanded",!0),this.setTransitioning(!0);var i=function(){a(b._element).removeClass(q.COLLAPSING).addClass(q.COLLAPSE).addClass(q.SHOW),b._element.style[g]="",b.setTransitioning(!1),a(b._element).trigger(p.SHOWN)};if(!k["default"].supportsTransitionEnd())return void i();var j=g[0].toUpperCase()+g.slice(1),l="scroll".concat(j);a(this._element).one(k["default"].TRANSITION_END,i).emulateTransitionEnd(m),this._element.style[g]="".concat(this._element[l],"px")}}}}},{key:"hide",value:function(){var b=this;if(!this._isTransitioning&&a(this._element).hasClass(q.SHOW)){var c=a.Event(p.HIDE);if(a(this._element).trigger(c),!c.isDefaultPrevented()){var d=this._getDimension();if(this._element.style[d]="".concat(this._element.getBoundingClientRect()[d],"px"),k["default"].reflow(this._element),a(this._element).addClass(q.COLLAPSING).removeClass(q.COLLAPSE).removeClass(q.SHOW),this._triggerArray.length>0)for(var e=0;e<this._triggerArray.length;e++){var f=this._triggerArray[e],g=k["default"].getSelectorFromElement(f);if(null!==g){var h=a(g);h.hasClass(q.SHOW)||a(f).addClass(q.COLLAPSED).attr("aria-expanded",!1)}}this.setTransitioning(!0);var i=function(){b.setTransitioning(!1),a(b._element).removeClass(q.COLLAPSING).addClass(q.COLLAPSE).trigger(p.HIDDEN)};return this._element.style[d]="",k["default"].supportsTransitionEnd()?void a(this._element).one(k["default"].TRANSITION_END,i).emulateTransitionEnd(m):void i()}}}},{key:"setTransitioning",value:function(a){this._isTransitioning=a}},{key:"dispose",value:function(){a.removeData(this._element,d),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null}},{key:"_getConfig",value:function(a){return a=f({},n,a),a.toggle=Boolean(a.toggle),k["default"].typeCheckConfig(b,a,o),a}},{key:"_getDimension",value:function(){var b=a(this._element).hasClass(r.WIDTH);return b?r.WIDTH:r.HEIGHT}},{key:"_getParent",value:function(){var b=this,c=null;k["default"].isElement(this._config.parent)?(c=this._config.parent,"undefined"!=typeof this._config.parent.jquery&&(c=this._config.parent[0])):c=a(this._config.parent)[0];var d='[data-toggle="collapse"][data-parent="'.concat(this._config.parent,'"]');return a(c).find(d).each(function(a,c){b._addAriaAndCollapsedClass(h._getTargetFromElement(c),[c])}),c}},{key:"_addAriaAndCollapsedClass",value:function(b,c){if(b){var d=a(b).hasClass(q.SHOW);c.length>0&&a(c).toggleClass(q.COLLAPSED,!d).attr("aria-expanded",d)}}}],[{key:"_getTargetFromElement",value:function(b){var c=k["default"].getSelectorFromElement(b);return c?a(c)[0]:null}},{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this),g=c.data(d),i=f({},n,c.data(),"object"===e(b)&&b);if(!g&&i.toggle&&/show|hide/.test(b)&&(i.toggle=!1),g||(g=new h(this,i),c.data(d,g)),"string"==typeof b){if("undefined"==typeof g[b])throw new TypeError('No method named "'.concat(b,'"'));g[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return n}}]),h}();return a(document).on(p.CLICK_DATA_API,s.DATA_TOGGLE,function(b){"A"===b.currentTarget.tagName&&b.preventDefault();var c=a(this),e=k["default"].getSelectorFromElement(this);a(e).each(function(){var b=a(this),e=b.data(d),f=e?"toggle":c.data();t._jQueryInterface.call(b,f)})}),a.fn[b]=t._jQueryInterface,a.fn[b].Constructor=t,a.fn[b].noConflict=function(){return a.fn[b]=l,t._jQueryInterface},t}(j["default"]);a["default"]=l});
define('theme_boost/carousel', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="carousel",c="4.0.0",d="bs.carousel",h=".".concat(d),j=".data-api",l=a.fn[b],m=600,n=37,o=39,p=500,q={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0},r={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean"},s={NEXT:"next",PREV:"prev",LEFT:"left",RIGHT:"right"},t={SLIDE:"slide".concat(h),SLID:"slid".concat(h),KEYDOWN:"keydown".concat(h),MOUSEENTER:"mouseenter".concat(h),MOUSELEAVE:"mouseleave".concat(h),TOUCHEND:"touchend".concat(h),LOAD_DATA_API:"load".concat(h).concat(j),CLICK_DATA_API:"click".concat(h).concat(j)},u={CAROUSEL:"carousel",ACTIVE:"active",SLIDE:"slide",RIGHT:"carousel-item-right",LEFT:"carousel-item-left",NEXT:"carousel-item-next",PREV:"carousel-item-prev",ITEM:"carousel-item"},v={ACTIVE:".active",ACTIVE_ITEM:".active.carousel-item",ITEM:".carousel-item",NEXT_PREV:".carousel-item-next, .carousel-item-prev",INDICATORS:".carousel-indicators",DATA_SLIDE:"[data-slide], [data-slide-to]",DATA_RIDE:'[data-ride="carousel"]'},w=function(){function j(b,c){g(this,j),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this._config=this._getConfig(c),this._element=a(b)[0],this._indicatorsElement=a(this._element).find(v.INDICATORS)[0],this._addEventListeners()}return i(j,[{key:"next",value:function(){this._isSliding||this._slide(s.NEXT)}},{key:"nextWhenVisible",value:function(){!document.hidden&&a(this._element).is(":visible")&&"hidden"!==a(this._element).css("visibility")&&this.next()}},{key:"prev",value:function(){this._isSliding||this._slide(s.PREV)}},{key:"pause",value:function(b){b||(this._isPaused=!0),a(this._element).find(v.NEXT_PREV)[0]&&k["default"].supportsTransitionEnd()&&(k["default"].triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}},{key:"cycle",value:function(a){a||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}},{key:"to",value:function(b){var c=this;this._activeElement=a(this._element).find(v.ACTIVE_ITEM)[0];var d=this._getItemIndex(this._activeElement);if(!(b>this._items.length-1||b<0)){if(this._isSliding)return void a(this._element).one(t.SLID,function(){return c.to(b)});if(d===b)return this.pause(),void this.cycle();var e=b>d?s.NEXT:s.PREV;this._slide(e,this._items[b])}}},{key:"dispose",value:function(){a(this._element).off(h),a.removeData(this._element,d),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null}},{key:"_getConfig",value:function(a){return a=f({},q,a),k["default"].typeCheckConfig(b,a,r),a}},{key:"_addEventListeners",value:function(){var b=this;this._config.keyboard&&a(this._element).on(t.KEYDOWN,function(a){return b._keydown(a)}),"hover"===this._config.pause&&(a(this._element).on(t.MOUSEENTER,function(a){return b.pause(a)}).on(t.MOUSELEAVE,function(a){return b.cycle(a)}),"ontouchstart"in document.documentElement&&a(this._element).on(t.TOUCHEND,function(){b.pause(),b.touchTimeout&&clearTimeout(b.touchTimeout),b.touchTimeout=setTimeout(function(a){return b.cycle(a)},p+b._config.interval)}))}},{key:"_keydown",value:function(a){if(!/input|textarea/i.test(a.target.tagName))switch(a.which){case n:a.preventDefault(),this.prev();break;case o:a.preventDefault(),this.next()}}},{key:"_getItemIndex",value:function(b){return this._items=a.makeArray(a(b).parent().find(v.ITEM)),this._items.indexOf(b)}},{key:"_getItemByDirection",value:function(a,b){var c=a===s.NEXT,d=a===s.PREV,e=this._getItemIndex(b),f=this._items.length-1,g=d&&0===e||c&&e===f;if(g&&!this._config.wrap)return b;var h=a===s.PREV?-1:1,i=(e+h)%this._items.length;return i===-1?this._items[this._items.length-1]:this._items[i]}},{key:"_triggerSlideEvent",value:function(b,c){var d=this._getItemIndex(b),e=this._getItemIndex(a(this._element).find(v.ACTIVE_ITEM)[0]),f=a.Event(t.SLIDE,{relatedTarget:b,direction:c,from:e,to:d});return a(this._element).trigger(f),f}},{key:"_setActiveIndicatorElement",value:function(b){if(this._indicatorsElement){a(this._indicatorsElement).find(v.ACTIVE).removeClass(u.ACTIVE);var c=this._indicatorsElement.children[this._getItemIndex(b)];c&&a(c).addClass(u.ACTIVE)}}},{key:"_slide",value:function(b,c){var d,e,f,g=this,h=a(this._element).find(v.ACTIVE_ITEM)[0],i=this._getItemIndex(h),j=c||h&&this._getItemByDirection(b,h),l=this._getItemIndex(j),n=Boolean(this._interval);if(b===s.NEXT?(d=u.LEFT,e=u.NEXT,f=s.LEFT):(d=u.RIGHT,e=u.PREV,f=s.RIGHT),j&&a(j).hasClass(u.ACTIVE))return void(this._isSliding=!1);var o=this._triggerSlideEvent(j,f);if(!o.isDefaultPrevented()&&h&&j){this._isSliding=!0,n&&this.pause(),this._setActiveIndicatorElement(j);var p=a.Event(t.SLID,{relatedTarget:j,direction:f,from:i,to:l});k["default"].supportsTransitionEnd()&&a(this._element).hasClass(u.SLIDE)?(a(j).addClass(e),k["default"].reflow(j),a(h).addClass(d),a(j).addClass(d),a(h).one(k["default"].TRANSITION_END,function(){a(j).removeClass("".concat(d," ").concat(e)).addClass(u.ACTIVE),a(h).removeClass("".concat(u.ACTIVE," ").concat(e," ").concat(d)),g._isSliding=!1,setTimeout(function(){return a(g._element).trigger(p)},0)}).emulateTransitionEnd(m)):(a(h).removeClass(u.ACTIVE),a(j).addClass(u.ACTIVE),this._isSliding=!1,a(this._element).trigger(p)),n&&this.cycle()}}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),g=f({},q,a(this).data());"object"===e(b)&&(g=f({},g,b));var h="string"==typeof b?b:g.slide;if(c||(c=new j(this,g),a(this).data(d,c)),"number"==typeof b)c.to(b);else if("string"==typeof h){if("undefined"==typeof c[h])throw new TypeError('No method named "'.concat(h,'"'));c[h]()}else g.interval&&(c.pause(),c.cycle())})}},{key:"_dataApiClickHandler",value:function(b){var c=k["default"].getSelectorFromElement(this);if(c){var e=a(c)[0];if(e&&a(e).hasClass(u.CAROUSEL)){var g=f({},a(e).data(),a(this).data()),h=this.getAttribute("data-slide-to");h&&(g.interval=!1),j._jQueryInterface.call(a(e),g),h&&a(e).data(d).to(h),b.preventDefault()}}}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return q}}]),j}();return a(document).on(t.CLICK_DATA_API,v.DATA_SLIDE,w._dataApiClickHandler),a(window).on(t.LOAD_DATA_API,function(){a(v.DATA_RIDE).each(function(){var b=a(this);w._jQueryInterface.call(b,b.data())})}),a.fn[b]=w._jQueryInterface,a.fn[b].Constructor=w,a.fn[b].noConflict=function(){return a.fn[b]=l,w._jQueryInterface},w}(j["default"]);a["default"]=l});
!function(a,b){"function"==typeof define&&define.amd?define('theme_boost/tether', b):"object"==typeof exports?module.exports=b(require,exports,module):a.Tether=b()}(this,function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a){var b=a.getBoundingClientRect(),c={};for(var d in b)c[d]=b[d];if(a.ownerDocument!==document){var f=a.ownerDocument.defaultView.frameElement;if(f){var g=e(f);c.top+=g.top,c.bottom+=g.top,c.left+=g.left,c.right+=g.left}}return c}function f(a){var b=getComputedStyle(a)||{},c=b.position,d=[];if("fixed"===c)return[a];for(var e=a;(e=e.parentNode)&&e&&1===e.nodeType;){var f=void 0;try{f=getComputedStyle(e)}catch(g){}if("undefined"==typeof f||null===f)return d.push(e),d;var h=f,i=h.overflow,j=h.overflowX,k=h.overflowY;/(auto|scroll)/.test(i+k+j)&&("absolute"!==c||["relative","absolute","fixed"].indexOf(f.position)>=0)&&d.push(e)}return d.push(a.ownerDocument.body),a.ownerDocument!==document&&d.push(a.ownerDocument.defaultView),d}function g(){z&&document.body.removeChild(z),z=null}function h(a){var b=void 0;a===document?(b=document,a=document.documentElement):b=a.ownerDocument;var c=b.documentElement,d=e(a),f=C();return d.top-=f.top,d.left-=f.left,"undefined"==typeof d.width&&(d.width=document.body.scrollWidth-d.left-d.right),"undefined"==typeof d.height&&(d.height=document.body.scrollHeight-d.top-d.bottom),d.top=d.top-c.clientTop,d.left=d.left-c.clientLeft,d.right=b.body.clientWidth-d.width-d.left,d.bottom=b.body.clientHeight-d.height-d.top,d}function i(a){return a.offsetParent||document.documentElement}function j(){var a=document.createElement("div");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");k(b.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;c===d&&(d=b.clientWidth),document.body.removeChild(b);var e=c-d;return{width:e,height:e}}function k(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=[];return Array.prototype.push.apply(b,arguments),b.slice(1).forEach(function(b){if(b)for(var c in b)({}).hasOwnProperty.call(b,c)&&(a[c]=b[c])}),a}function l(a,b){if("undefined"!=typeof a.classList)b.split(" ").forEach(function(b){b.trim()&&a.classList.remove(b)});else{var c=new RegExp("(^| )"+b.split(" ").join("|")+"( |$)","gi"),d=o(a).replace(c," ");p(a,d)}}function m(a,b){if("undefined"!=typeof a.classList)b.split(" ").forEach(function(b){b.trim()&&a.classList.add(b)});else{l(a,b);var c=o(a)+(" "+b);p(a,c)}}function n(a,b){if("undefined"!=typeof a.classList)return a.classList.contains(b);var c=o(a);return new RegExp("(^| )"+b+"( |$)","gi").test(c)}function o(a){return a.className instanceof a.ownerDocument.defaultView.SVGAnimatedString?a.className.baseVal:a.className}function p(a,b){a.setAttribute("class",b)}function q(a,b,c){c.forEach(function(c){b.indexOf(c)===-1&&n(a,c)&&l(a,c)}),b.forEach(function(b){n(a,b)||m(a,b)})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function r(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function s(a,b){var c=arguments.length<=2||void 0===arguments[2]?1:arguments[2];return a+c>=b&&b>=a-c}function t(){return"undefined"!=typeof performance&&"undefined"!=typeof performance.now?performance.now():+new Date}function u(){for(var a={top:0,left:0},b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return c.forEach(function(b){var c=b.top,d=b.left;"string"==typeof c&&(c=parseFloat(c,10)),"string"==typeof d&&(d=parseFloat(d,10)),a.top+=c,a.left+=d}),a}function v(a,b){return"string"==typeof a.left&&a.left.indexOf("%")!==-1&&(a.left=parseFloat(a.left,10)/100*b.width),"string"==typeof a.top&&a.top.indexOf("%")!==-1&&(a.top=parseFloat(a.top,10)/100*b.height),a}function w(a,b){return"scrollParent"===b?b=a.scrollParents[0]:"window"===b&&(b=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),b===document&&(b=b.documentElement),"undefined"!=typeof b.nodeType&&!function(){var a=b,c=h(b),d=c,e=getComputedStyle(b);if(b=[d.left,d.top,c.width+d.left,c.height+d.top],a.ownerDocument!==document){var f=a.ownerDocument.defaultView;b[0]+=f.pageXOffset,b[1]+=f.pageYOffset,b[2]+=f.pageXOffset,b[3]+=f.pageYOffset}W.forEach(function(a,c){a=a[0].toUpperCase()+a.substr(1),"Top"===a||"Left"===a?b[c]+=parseFloat(e["border"+a+"Width"]):b[c]-=parseFloat(e["border"+a+"Width"])})}(),b}var x=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),y=void 0;"undefined"==typeof y&&(y={modules:[]});var z=null,A=function(){var a=0;return function(){return++a}}(),B={},C=function(){var a=z;a||(a=document.createElement("div"),a.setAttribute("data-tether-id",A()),k(a.style,{top:0,left:0,position:"absolute"}),document.body.appendChild(a),z=a);var b=a.getAttribute("data-tether-id");return"undefined"==typeof B[b]&&(B[b]=e(a),E(function(){delete B[b]})),B[b]},D=[],E=function(a){D.push(a)},F=function(){for(var a=void 0;a=D.pop();)a()},G=function(){function a(){d(this,a)}return x(a,[{key:"on",value:function(a,b,c){var d=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];"undefined"==typeof this.bindings&&(this.bindings={}),"undefined"==typeof this.bindings[a]&&(this.bindings[a]=[]),this.bindings[a].push({handler:b,ctx:c,once:d})}},{key:"once",value:function(a,b,c){this.on(a,b,c,!0)}},{key:"off",value:function(a,b){if("undefined"!=typeof this.bindings&&"undefined"!=typeof this.bindings[a])if("undefined"==typeof b)delete this.bindings[a];else for(var c=0;c<this.bindings[a].length;)this.bindings[a][c].handler===b?this.bindings[a].splice(c,1):++c}},{key:"trigger",value:function(a){if("undefined"!=typeof this.bindings&&this.bindings[a]){for(var b=0,c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];for(;b<this.bindings[a].length;){var f=this.bindings[a][b],g=f.handler,h=f.ctx,i=f.once,j=h;"undefined"==typeof j&&(j=this),g.apply(j,d),i?this.bindings[a].splice(b,1):++b}}}}]),a}();y.Utils={getActualBoundingClientRect:e,getScrollParents:f,getBounds:h,getOffsetParent:i,extend:k,addClass:m,removeClass:l,hasClass:n,updateClasses:q,defer:E,flush:F,uniqueId:A,Evented:G,getScrollBarSize:j,removeUtilElements:g};var H=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),x=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),I=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}};if("undefined"==typeof y)throw new Error("You must include the utils.js file before tether.js");var J=y.Utils,f=J.getScrollParents,h=J.getBounds,i=J.getOffsetParent,k=J.extend,m=J.addClass,l=J.removeClass,q=J.updateClasses,E=J.defer,F=J.flush,j=J.getScrollBarSize,g=J.removeUtilElements,K=function(){if("undefined"==typeof document)return"";for(var a=document.createElement("div"),b=["transform","WebkitTransform","OTransform","MozTransform","msTransform"],c=0;c<b.length;++c){var d=b[c];if(void 0!==a.style[d])return d}}(),L=[],M=function(){L.forEach(function(a){a.position(!1)}),F()};!function(){var a=null,b=null,c=null,d=function e(){return"undefined"!=typeof b&&b>16?(b=Math.min(b-16,250),void(c=setTimeout(e,250))):void("undefined"!=typeof a&&t()-a<10||(null!=c&&(clearTimeout(c),c=null),a=t(),M(),b=t()-a))};"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener&&["resize","scroll","touchmove"].forEach(function(a){window.addEventListener(a,d)})}();var N={center:"center",left:"right",right:"left"},O={middle:"middle",top:"bottom",bottom:"top"},P={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},Q=function(a,b){var c=a.left,d=a.top;return"auto"===c&&(c=N[b.left]),"auto"===d&&(d=O[b.top]),{left:c,top:d}},R=function(a){var b=a.left,c=a.top;return"undefined"!=typeof P[a.left]&&(b=P[a.left]),"undefined"!=typeof P[a.top]&&(c=P[a.top]),{left:b,top:c}},S=function(a){var b=a.split(" "),c=H(b,2),d=c[0],e=c[1];return{top:d,left:e}},T=S,U=function(a){function b(a){var c=this;d(this,b),I(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this.position=this.position.bind(this),L.push(this),this.history=[],this.setOptions(a,!1),y.modules.forEach(function(a){"undefined"!=typeof a.initialize&&a.initialize.call(c)}),this.position()}return r(b,a),x(b,[{key:"getClass",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=this.options.classes;return"undefined"!=typeof b&&b[a]?this.options.classes[a]:this.options.classPrefix?this.options.classPrefix+"-"+a:a}},{key:"setOptions",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]||arguments[1],d={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"};this.options=k(d,a);var e=this.options,g=e.element,h=e.target,i=e.targetModifier;if(this.element=g,this.target=h,this.targetModifier=i,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),["element","target"].forEach(function(a){if("undefined"==typeof b[a])throw new Error("Tether Error: Both element and target must be defined");"undefined"!=typeof b[a].jquery?b[a]=b[a][0]:"string"==typeof b[a]&&(b[a]=document.querySelector(b[a]))}),m(this.element,this.getClass("element")),this.options.addTargetClasses!==!1&&m(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");this.targetAttachment=T(this.options.targetAttachment),this.attachment=T(this.options.attachment),this.offset=S(this.options.offset),this.targetOffset=S(this.options.targetOffset),"undefined"!=typeof this.scrollParents&&this.disable(),"scroll-handle"===this.targetModifier?this.scrollParents=[this.target]:this.scrollParents=f(this.target),this.options.enabled!==!1&&this.enable(c)}},{key:"getTargetBounds",value:function(){if("undefined"==typeof this.targetModifier)return h(this.target);if("visible"===this.targetModifier){if(this.target===document.body)return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};var a=h(this.target),b={height:a.height,width:a.width,top:a.top,left:a.left};return b.height=Math.min(b.height,a.height-(pageYOffset-a.top)),b.height=Math.min(b.height,a.height-(a.top+a.height-(pageYOffset+innerHeight))),b.height=Math.min(innerHeight,b.height),b.height-=2,b.width=Math.min(b.width,a.width-(pageXOffset-a.left)),b.width=Math.min(b.width,a.width-(a.left+a.width-(pageXOffset+innerWidth))),b.width=Math.min(innerWidth,b.width),b.width-=2,b.top<pageYOffset&&(b.top=pageYOffset),b.left<pageXOffset&&(b.left=pageXOffset),b}if("scroll-handle"===this.targetModifier){var a=void 0,c=this.target;c===document.body?(c=document.documentElement,a={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):a=h(c);var d=getComputedStyle(c),e=c.scrollWidth>c.clientWidth||[d.overflow,d.overflowX].indexOf("scroll")>=0||this.target!==document.body,f=0;e&&(f=15);var g=a.height-parseFloat(d.borderTopWidth)-parseFloat(d.borderBottomWidth)-f,b={width:15,height:.975*g*(g/c.scrollHeight),left:a.left+a.width-parseFloat(d.borderLeftWidth)-15},i=0;g<408&&this.target===document.body&&(i=-11e-5*Math.pow(g,2)-.00727*g+22.58),this.target!==document.body&&(b.height=Math.max(b.height,24));var j=this.target.scrollTop/(c.scrollHeight-g);return b.top=j*(g-b.height-i)+a.top+parseFloat(d.borderTopWidth),this.target===document.body&&(b.height=Math.max(b.height,24)),b}}},{key:"clearCache",value:function(){this._cache={}}},{key:"cache",value:function(a,b){return"undefined"==typeof this._cache&&(this._cache={}),"undefined"==typeof this._cache[a]&&(this._cache[a]=b.call(this)),this._cache[a]}},{key:"enable",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]||arguments[0];this.options.addTargetClasses!==!1&&m(this.target,this.getClass("enabled")),m(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParents.forEach(function(b){b!==a.target.ownerDocument&&b.addEventListener("scroll",a.position)}),b&&this.position()}},{key:"disable",value:function(){var a=this;l(this.target,this.getClass("enabled")),l(this.element,this.getClass("enabled")),this.enabled=!1,"undefined"!=typeof this.scrollParents&&this.scrollParents.forEach(function(b){b.removeEventListener("scroll",a.position)})}},{key:"destroy",value:function(){var a=this;this.disable(),L.forEach(function(b,c){b===a&&L.splice(c,1)}),0===L.length&&g()}},{key:"updateAttachClasses",value:function(a,b){var c=this;a=a||this.attachment,b=b||this.targetAttachment;var d=["left","top","bottom","right","middle","center"];"undefined"!=typeof this._addAttachClasses&&this._addAttachClasses.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length),"undefined"==typeof this._addAttachClasses&&(this._addAttachClasses=[]);var e=this._addAttachClasses;a.top&&e.push(this.getClass("element-attached")+"-"+a.top),a.left&&e.push(this.getClass("element-attached")+"-"+a.left),b.top&&e.push(this.getClass("target-attached")+"-"+b.top),b.left&&e.push(this.getClass("target-attached")+"-"+b.left);var f=[];d.forEach(function(a){f.push(c.getClass("element-attached")+"-"+a),f.push(c.getClass("target-attached")+"-"+a)}),E(function(){"undefined"!=typeof c._addAttachClasses&&(q(c.element,c._addAttachClasses,f),c.options.addTargetClasses!==!1&&q(c.target,c._addAttachClasses,f),delete c._addAttachClasses)})}},{key:"position",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]||arguments[0];if(this.enabled){this.clearCache();var c=Q(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,c);var d=this.cache("element-bounds",function(){return h(a.element)}),e=d.width,f=d.height;if(0===e&&0===f&&"undefined"!=typeof this.lastSize){var g=this.lastSize;e=g.width,f=g.height}else this.lastSize={width:e,height:f};var k=this.cache("target-bounds",function(){return a.getTargetBounds()}),l=k,m=v(R(this.attachment),{width:e,height:f}),n=v(R(c),l),o=v(this.offset,{width:e,height:f}),p=v(this.targetOffset,l);m=u(m,o),n=u(n,p);for(var q=k.left+n.left-m.left,r=k.top+n.top-m.top,s=0;s<y.modules.length;++s){var t=y.modules[s],w=t.position.call(this,{left:q,top:r,targetAttachment:c,targetPos:k,elementPos:d,offset:m,targetOffset:n,manualOffset:o,manualTargetOffset:p,scrollbarSize:B,attachment:this.attachment});if(w===!1)return!1;"undefined"!=typeof w&&"object"==typeof w&&(r=w.top,q=w.left)}var x={page:{top:r,left:q},viewport:{top:r-pageYOffset,bottom:pageYOffset-r-f+innerHeight,left:q-pageXOffset,right:pageXOffset-q-e+innerWidth}},z=this.target.ownerDocument,A=z.defaultView,B=void 0;return z.body.scrollWidth>A.innerWidth&&(B=this.cache("scrollbar-size",j),x.viewport.bottom-=B.height),z.body.scrollHeight>A.innerHeight&&(B=this.cache("scrollbar-size",j),x.viewport.right-=B.width),["","static"].indexOf(z.body.style.position)!==-1&&["","static"].indexOf(z.body.parentElement.style.position)!==-1||(x.page.bottom=z.body.scrollHeight-r-f,x.page.right=z.body.scrollWidth-q-e),"undefined"!=typeof this.options.optimizations&&this.options.optimizations.moveElement!==!1&&"undefined"==typeof this.targetModifier&&!function(){var b=a.cache("target-offsetparent",function(){return i(a.target)}),c=a.cache("target-offsetparent-bounds",function(){return h(b)}),d=getComputedStyle(b),e=c,f={};if(["Top","Left","Bottom","Right"].forEach(function(a){f[a.toLowerCase()]=parseFloat(d["border"+a+"Width"])}),c.right=z.body.scrollWidth-c.left-e.width+f.right,c.bottom=z.body.scrollHeight-c.top-e.height+f.bottom,x.page.top>=c.top+f.top&&x.page.bottom>=c.bottom&&x.page.left>=c.left+f.left&&x.page.right>=c.right){var g=b.scrollTop,j=b.scrollLeft;x.offset={top:x.page.top-c.top+g-f.top,left:x.page.left-c.left+j-f.left}}}(),this.move(x),this.history.unshift(x),this.history.length>3&&this.history.pop(),b&&F(),!0}}},{key:"move",value:function(a){var b=this;if("undefined"!=typeof this.element.parentNode){var c={};for(var d in a){c[d]={};for(var e in a[d]){for(var f=!1,g=0;g<this.history.length;++g){var h=this.history[g];if("undefined"!=typeof h[d]&&!s(h[d][e],a[d][e])){f=!0;break}}f||(c[d][e]=!0)}}var j={top:"",left:"",right:"",bottom:""},l=function(a,c){var d="undefined"!=typeof b.options.optimizations,e=d?b.options.optimizations.gpu:null;if(e!==!1){var f=void 0,g=void 0;a.top?(j.top=0,f=c.top):(j.bottom=0,f=-c.bottom),a.left?(j.left=0,g=c.left):(j.right=0,g=-c.right),j[K]="translateX("+Math.round(g)+"px) translateY("+Math.round(f)+"px)","msTransform"!==K&&(j[K]+=" translateZ(0)")}else a.top?j.top=c.top+"px":j.bottom=c.bottom+"px",a.left?j.left=c.left+"px":j.right=c.right+"px"},m=!1;if((c.page.top||c.page.bottom)&&(c.page.left||c.page.right)?(j.position="absolute",l(c.page,a.page)):(c.viewport.top||c.viewport.bottom)&&(c.viewport.left||c.viewport.right)?(j.position="fixed",l(c.viewport,a.viewport)):"undefined"!=typeof c.offset&&c.offset.top&&c.offset.left?!function(){j.position="absolute";var d=b.cache("target-offsetparent",function(){return i(b.target)});i(b.element)!==d&&E(function(){b.element.parentNode.removeChild(b.element),d.appendChild(b.element)}),l(c.offset,a.offset),m=!0}():(j.position="absolute",l({top:!0,left:!0},a.page)),!m){for(var n=!0,o=this.element.parentNode;o&&1===o.nodeType&&"BODY"!==o.tagName;){if("static"!==getComputedStyle(o).position){n=!1;break}o=o.parentNode}n||(this.element.parentNode.removeChild(this.element),this.element.ownerDocument.body.appendChild(this.element))}var p={},q=!1;for(var e in j){var r=j[e],t=this.element.style[e];t!==r&&(q=!0,p[e]=r)}q&&E(function(){k(b.element.style,p)})}}}]),b}(G);U.modules=[],y.position=M;var V=k(U,y),H=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),J=y.Utils,h=J.getBounds,k=J.extend,q=J.updateClasses,E=J.defer,W=["left","top","right","bottom"];y.modules.push({position:function(a){var b=this,c=a.top,d=a.left,e=a.targetAttachment;if(!this.options.constraints)return!0;var f=this.cache("element-bounds",function(){return h(b.element)}),g=f.height,i=f.width;if(0===i&&0===g&&"undefined"!=typeof this.lastSize){var j=this.lastSize;i=j.width,g=j.height}var l=this.cache("target-bounds",function(){return b.getTargetBounds()}),m=l.height,n=l.width,o=[this.getClass("pinned"),this.getClass("out-of-bounds")];this.options.constraints.forEach(function(a){var b=a.outOfBoundsClass,c=a.pinnedClass;b&&o.push(b),c&&o.push(c)}),o.forEach(function(a){["left","top","right","bottom"].forEach(function(b){o.push(a+"-"+b)})});var p=[],r=k({},e),s=k({},this.attachment);return this.options.constraints.forEach(function(a){var f=a.to,h=a.attachment,j=a.pin;"undefined"==typeof h&&(h="");var k=void 0,l=void 0;if(h.indexOf(" ")>=0){var o=h.split(" "),q=H(o,2);l=q[0],k=q[1]}else k=l=h;var t=w(b,f);"target"!==l&&"both"!==l||(c<t[1]&&"top"===r.top&&(c+=m,r.top="bottom"),c+g>t[3]&&"bottom"===r.top&&(c-=m,r.top="top")),"together"===l&&("top"===r.top&&("bottom"===s.top&&c<t[1]?(c+=m,r.top="bottom",c+=g,s.top="top"):"top"===s.top&&c+g>t[3]&&c-(g-m)>=t[1]&&(c-=g-m,r.top="bottom",s.top="bottom")),"bottom"===r.top&&("top"===s.top&&c+g>t[3]?(c-=m,r.top="top",c-=g,s.top="bottom"):"bottom"===s.top&&c<t[1]&&c+(2*g-m)<=t[3]&&(c+=g-m,r.top="top",s.top="top")),"middle"===r.top&&(c+g>t[3]&&"top"===s.top?(c-=g,s.top="bottom"):c<t[1]&&"bottom"===s.top&&(c+=g,s.top="top"))),"target"!==k&&"both"!==k||(d<t[0]&&"left"===r.left&&(d+=n,r.left="right"),d+i>t[2]&&"right"===r.left&&(d-=n,r.left="left")),"together"===k&&(d<t[0]&&"left"===r.left?"right"===s.left?(d+=n,r.left="right",d+=i,s.left="left"):"left"===s.left&&(d+=n,r.left="right",d-=i,s.left="right"):d+i>t[2]&&"right"===r.left?"left"===s.left?(d-=n,r.left="left",d-=i,s.left="right"):"right"===s.left&&(d-=n,r.left="left",d+=i,s.left="left"):"center"===r.left&&(d+i>t[2]&&"left"===s.left?(d-=i,s.left="right"):d<t[0]&&"right"===s.left&&(d+=i,s.left="left"))),"element"!==l&&"both"!==l||(c<t[1]&&"bottom"===s.top&&(c+=g,s.top="top"),c+g>t[3]&&"top"===s.top&&(c-=g,s.top="bottom")),"element"!==k&&"both"!==k||(d<t[0]&&("right"===s.left?(d+=i,s.left="left"):"center"===s.left&&(d+=i/2,s.left="left")),d+i>t[2]&&("left"===s.left?(d-=i,s.left="right"):"center"===s.left&&(d-=i/2,s.left="right"))),"string"==typeof j?j=j.split(",").map(function(a){return a.trim()}):j===!0&&(j=["top","left","right","bottom"]),j=j||[];var u=[],v=[];c<t[1]&&(j.indexOf("top")>=0?(c=t[1],u.push("top")):v.push("top")),c+g>t[3]&&(j.indexOf("bottom")>=0?(c=t[3]-g,u.push("bottom")):v.push("bottom")),d<t[0]&&(j.indexOf("left")>=0?(d=t[0],u.push("left")):v.push("left")),d+i>t[2]&&(j.indexOf("right")>=0?(d=t[2]-i,u.push("right")):v.push("right")),u.length&&!function(){var a=void 0;a="undefined"!=typeof b.options.pinnedClass?b.options.pinnedClass:b.getClass("pinned"),p.push(a),u.forEach(function(b){p.push(a+"-"+b)})}(),v.length&&!function(){var a=void 0;a="undefined"!=typeof b.options.outOfBoundsClass?b.options.outOfBoundsClass:b.getClass("out-of-bounds"),p.push(a),v.forEach(function(b){p.push(a+"-"+b)})}(),(u.indexOf("left")>=0||u.indexOf("right")>=0)&&(s.left=r.left=!1),(u.indexOf("top")>=0||u.indexOf("bottom")>=0)&&(s.top=r.top=!1),r.top===e.top&&r.left===e.left&&s.top===b.attachment.top&&s.left===b.attachment.left||(b.updateAttachClasses(s,r),b.trigger("update",{attachment:s,targetAttachment:r}))}),E(function(){b.options.addTargetClasses!==!1&&q(b.target,p,o),q(b.element,p,o)}),{top:c,left:d}}});var J=y.Utils,h=J.getBounds,q=J.updateClasses,E=J.defer;y.modules.push({position:function(a){var b=this,c=a.top,d=a.left,e=this.cache("element-bounds",function(){return h(b.element)}),f=e.height,g=e.width,i=this.getTargetBounds(),j=c+f,k=d+g,l=[];c<=i.bottom&&j>=i.top&&["left","right"].forEach(function(a){var b=i[a];b!==d&&b!==k||l.push(a)}),d<=i.right&&k>=i.left&&["top","bottom"].forEach(function(a){var b=i[a];b!==c&&b!==j||l.push(a)});var m=[],n=[],o=["left","top","right","bottom"];return m.push(this.getClass("abutted")),o.forEach(function(a){m.push(b.getClass("abutted")+"-"+a)}),l.length&&n.push(this.getClass("abutted")),l.forEach(function(a){n.push(b.getClass("abutted")+"-"+a)}),E(function(){b.options.addTargetClasses!==!1&&q(b.target,n,m),q(b.element,n,m)}),!0}});var H=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return y.modules.push({position:function(a){var b=a.top,c=a.left;if(this.options.shift){var d=this.options.shift;"function"==typeof this.options.shift&&(d=this.options.shift.call(this,{top:b,left:c}));var e=void 0,f=void 0;if("string"==typeof d){d=d.split(" "),d[1]=d[1]||d[0];var g=d,h=H(g,2);e=h[0],f=h[1],e=parseFloat(e,10),f=parseFloat(f,10)}else e=d.top,f=d.left;return b+=e,c+=f,{top:b,left:c}}}}),V});
define('theme_boost/button', ["exports","jquery"],function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var g=c(b),h=function(a){var b="button",c="4.0.0",e="bs.button",g=".".concat(e),h=".data-api",i=a.fn[b],j={ACTIVE:"active",BUTTON:"btn",FOCUS:"focus"},k={DATA_TOGGLE_CARROT:'[data-toggle^="button"]',DATA_TOGGLE:'[data-toggle="buttons"]',INPUT:"input",ACTIVE:".active",BUTTON:".btn"},l={CLICK_DATA_API:"click".concat(g).concat(h),FOCUS_BLUR_DATA_API:"focus".concat(g).concat(h," ")+"blur".concat(g).concat(h)},m=function(){function b(a){d(this,b),this._element=a}return f(b,[{key:"toggle",value:function(){var b=!0,c=!0,d=a(this._element).closest(k.DATA_TOGGLE)[0];if(d){var e=a(this._element).find(k.INPUT)[0];if(e){if("radio"===e.type)if(e.checked&&a(this._element).hasClass(j.ACTIVE))b=!1;else{var f=a(d).find(k.ACTIVE)[0];f&&a(f).removeClass(j.ACTIVE)}if(b){if(e.hasAttribute("disabled")||d.hasAttribute("disabled")||e.classList.contains("disabled")||d.classList.contains("disabled"))return;e.checked=!a(this._element).hasClass(j.ACTIVE),a(e).trigger("change")}e.focus(),c=!1}}c&&this._element.setAttribute("aria-pressed",!a(this._element).hasClass(j.ACTIVE)),b&&a(this._element).toggleClass(j.ACTIVE)}},{key:"dispose",value:function(){a.removeData(this._element,e),this._element=null}}],[{key:"_jQueryInterface",value:function(c){return this.each(function(){var d=a(this).data(e);d||(d=new b(this),a(this).data(e,d)),"toggle"===c&&d[c]()})}},{key:"VERSION",get:function(){return c}}]),b}();return a(document).on(l.CLICK_DATA_API,k.DATA_TOGGLE_CARROT,function(b){b.preventDefault();var c=b.target;a(c).hasClass(j.BUTTON)||(c=a(c).closest(k.BUTTON)),m._jQueryInterface.call(a(c),"toggle")}).on(l.FOCUS_BLUR_DATA_API,k.DATA_TOGGLE_CARROT,function(b){var c=a(b.target).closest(k.BUTTON)[0];a(c).toggleClass(j.FOCUS,/^focus(in)?$/.test(b.type))}),a.fn[b]=m._jQueryInterface,a.fn[b].Constructor=m,a.fn[b].noConflict=function(){return a.fn[b]=i,m._jQueryInterface},m}(g["default"]);a["default"]=h});
define('theme_boost/util', ["exports","jquery"],function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0});var d=c(b),e=function(a){function b(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function c(){return{bindType:h.end,delegateType:h.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}}}function d(){return("undefined"==typeof window||!window.QUnit)&&{end:"transitionend"}}function e(b){var c=this,d=!1;return a(this).one(j.TRANSITION_END,function(){d=!0}),setTimeout(function(){d||j.triggerTransitionEnd(c)},b),this}function f(){h=d(),a.fn.emulateTransitionEnd=e,j.supportsTransitionEnd()&&(a.event.special[j.TRANSITION_END]=c())}function g(b){return b="function"==typeof a.escapeSelector?a.escapeSelector(b).substr(1):b.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1")}var h=!1,i=1e6,j={TRANSITION_END:"bsTransitionEnd",getUID:function(a){do a+=~~(Math.random()*i);while(document.getElementById(a));return a},getSelectorFromElement:function(b){var c=b.getAttribute("data-target");c&&"#"!==c||(c=b.getAttribute("href")||""),"#"===c.charAt(0)&&(c=g(c));try{var d=a(document).find(c);return d.length>0?c:null}catch(e){return null}},reflow:function(a){return a.offsetHeight},triggerTransitionEnd:function(b){a(b).trigger(h.end)},supportsTransitionEnd:function(){return Boolean(h)},isElement:function(a){return(a[0]||a).nodeType},typeCheckConfig:function(a,c,d){for(var e in d)if(Object.prototype.hasOwnProperty.call(d,e)){var f=d[e],g=c[e],h=g&&j.isElement(g)?"element":b(g);if(!new RegExp(f).test(h))throw new Error("".concat(a.toUpperCase(),": ")+'Option "'.concat(e,'" provided type "').concat(h,'" ')+'but expected type "'.concat(f,'".'))}}};return f(),j}(d["default"]);a["default"]=e});
define('theme_boost/tooltip', ["exports","jquery","core/popper","./util"],function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function i(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function j(a,b,c){return b&&i(a.prototype,b),c&&i(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var k=e(b),l=e(c),m=e(d),n=function(a){var b="tooltip",c="4.0.0",d="bs.tooltip",e=".".concat(d),i=a.fn[b],k=150,n="bs-tooltip",o=new RegExp("(^|\\s)".concat(n,"\\S+"),"g"),p={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)"},q={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},r={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent"},s={SHOW:"show",OUT:"out"},t={HIDE:"hide".concat(e),HIDDEN:"hidden".concat(e),SHOW:"show".concat(e),SHOWN:"shown".concat(e),INSERTED:"inserted".concat(e),CLICK:"click".concat(e),FOCUSIN:"focusin".concat(e),FOCUSOUT:"focusout".concat(e),MOUSEENTER:"mouseenter".concat(e),MOUSELEAVE:"mouseleave".concat(e)},u={FADE:"fade",SHOW:"show"},v={TOOLTIP:".tooltip",TOOLTIP_INNER:".tooltip-inner",ARROW:".arrow"},w={HOVER:"hover",FOCUS:"focus",CLICK:"click",MANUAL:"manual"},x=function(){function i(a,b){if(h(this,i),"undefined"==typeof l["default"])throw new TypeError("Bootstrap tooltips require Popper.js (https://popper.js.org)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=a,this.config=this._getConfig(b),this.tip=null,this._setListeners()}return j(i,[{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"toggleEnabled",value:function(){this._isEnabled=!this._isEnabled}},{key:"toggle",value:function(b){if(this._isEnabled)if(b){var c=this.constructor.DATA_KEY,d=a(b.currentTarget).data(c);d||(d=new this.constructor(b.currentTarget,this._getDelegateConfig()),a(b.currentTarget).data(c,d)),d._activeTrigger.click=!d._activeTrigger.click,d._isWithActiveTrigger()?d._enter(null,d):d._leave(null,d)}else{if(a(this.getTipElement()).hasClass(u.SHOW))return void this._leave(null,this);this._enter(null,this)}}},{key:"dispose",value:function(){clearTimeout(this._timeout),a.removeData(this.element,this.constructor.DATA_KEY),a(this.element).off(this.constructor.EVENT_KEY),a(this.element).closest(".modal").off("hide.bs.modal"),this.tip&&a(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,this._activeTrigger=null,null!==this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null}},{key:"show",value:function(){var b=this;if("none"===a(this.element).css("display"))throw new Error("Please use show on visible elements");var c=a.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){a(this.element).trigger(c);var d=a.contains(this.element.ownerDocument.documentElement,this.element);if(c.isDefaultPrevented()||!d)return;var e=this.getTipElement(),f=m["default"].getUID(this.constructor.NAME);e.setAttribute("id",f),this.element.setAttribute("aria-describedby",f),this.setContent(),this.config.animation&&a(e).addClass(u.FADE);var g="function"==typeof this.config.placement?this.config.placement.call(this,e,this.element):this.config.placement,h=this._getAttachment(g);this.addAttachmentClass(h);var j=this.config.container===!1?document.body:a(this.config.container);a(e).data(this.constructor.DATA_KEY,this),a.contains(this.element.ownerDocument.documentElement,this.tip)||a(e).appendTo(j),a(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new l["default"](this.element,e,{placement:h,modifiers:{offset:{offset:this.config.offset},flip:{behavior:this.config.fallbackPlacement},arrow:{element:v.ARROW},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(a){a.originalPlacement!==a.placement&&b._handlePopperPlacementChange(a)},onUpdate:function(a){b._handlePopperPlacementChange(a)}}),a(e).addClass(u.SHOW),"ontouchstart"in document.documentElement&&a("body").children().on("mouseover",null,a.noop);var k=function(){b.config.animation&&b._fixTransition();var c=b._hoverState;b._hoverState=null,a(b.element).trigger(b.constructor.Event.SHOWN),c===s.OUT&&b._leave(null,b)};m["default"].supportsTransitionEnd()&&a(this.tip).hasClass(u.FADE)?a(this.tip).one(m["default"].TRANSITION_END,k).emulateTransitionEnd(i._TRANSITION_DURATION):k()}}},{key:"hide",value:function(b){var c=this,d=this.getTipElement(),e=a.Event(this.constructor.Event.HIDE),f=function(){c._hoverState!==s.SHOW&&d.parentNode&&d.parentNode.removeChild(d),c._cleanTipClass(),c.element.removeAttribute("aria-describedby"),a(c.element).trigger(c.constructor.Event.HIDDEN),null!==c._popper&&c._popper.destroy(),b&&b()};a(this.element).trigger(e),e.isDefaultPrevented()||(a(d).removeClass(u.SHOW),"ontouchstart"in document.documentElement&&a("body").children().off("mouseover",null,a.noop),this._activeTrigger[w.CLICK]=!1,this._activeTrigger[w.FOCUS]=!1,this._activeTrigger[w.HOVER]=!1,m["default"].supportsTransitionEnd()&&a(this.tip).hasClass(u.FADE)?a(d).one(m["default"].TRANSITION_END,f).emulateTransitionEnd(k):f(),this._hoverState="")}},{key:"update",value:function(){null!==this._popper&&this._popper.scheduleUpdate()}},{key:"isWithContent",value:function(){return Boolean(this.getTitle())}},{key:"addAttachmentClass",value:function(b){a(this.getTipElement()).addClass("".concat(n,"-").concat(b))}},{key:"getTipElement",value:function(){return this.tip=this.tip||a(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var b=a(this.getTipElement());this.setElementContent(b.find(v.TOOLTIP_INNER),this.getTitle()),b.removeClass("".concat(u.FADE," ").concat(u.SHOW))}},{key:"setElementContent",value:function(b,c){var d=this.config.html;"object"===g(c)&&(c.nodeType||c.jquery)?d?a(c).parent().is(b)||b.empty().append(c):b.text(a(c).text()):b[d?"html":"text"](c)}},{key:"getTitle",value:function(){var a=this.element.getAttribute("data-original-title");return a||(a="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),a}},{key:"_getAttachment",value:function(a){return q[a.toUpperCase()]}},{key:"_setListeners",value:function(){var b=this,c=this.config.trigger.split(" ");c.forEach(function(c){if("click"===c)a(b.element).on(b.constructor.Event.CLICK,b.config.selector,function(a){return b.toggle(a)});else if(c!==w.MANUAL){var d=c===w.HOVER?b.constructor.Event.MOUSEENTER:b.constructor.Event.FOCUSIN,e=c===w.HOVER?b.constructor.Event.MOUSELEAVE:b.constructor.Event.FOCUSOUT;a(b.element).on(d,b.config.selector,function(a){return b._enter(a)}).on(e,b.config.selector,function(a){return b._leave(a)})}a(b.element).closest(".modal").on("hide.bs.modal",function(){return b.hide()})}),this.config.selector?this.config=f({},this.config,{trigger:"manual",selector:""}):this._fixTitle()}},{key:"_fixTitle",value:function(){var a=g(this.element.getAttribute("data-original-title"));(this.element.getAttribute("title")||"string"!==a)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))}},{key:"_enter",value:function(b,c){var d=this.constructor.DATA_KEY;return c=c||a(b.currentTarget).data(d),c||(c=new this.constructor(b.currentTarget,this._getDelegateConfig()),a(b.currentTarget).data(d,c)),b&&(c._activeTrigger["focusin"===b.type?w.FOCUS:w.HOVER]=!0),a(c.getTipElement()).hasClass(u.SHOW)||c._hoverState===s.SHOW?void(c._hoverState=s.SHOW):(clearTimeout(c._timeout),c._hoverState=s.SHOW,c.config.delay&&c.config.delay.show?void(c._timeout=setTimeout(function(){c._hoverState===s.SHOW&&c.show()},c.config.delay.show)):void c.show())}},{key:"_leave",value:function(b,c){var d=this.constructor.DATA_KEY;if(c=c||a(b.currentTarget).data(d),c||(c=new this.constructor(b.currentTarget,this._getDelegateConfig()),a(b.currentTarget).data(d,c)),b&&(c._activeTrigger["focusout"===b.type?w.FOCUS:w.HOVER]=!1),!c._isWithActiveTrigger())return clearTimeout(c._timeout),c._hoverState=s.OUT,c.config.delay&&c.config.delay.hide?void(c._timeout=setTimeout(function(){c._hoverState===s.OUT&&c.hide()},c.config.delay.hide)):void c.hide()}},{key:"_isWithActiveTrigger",value:function(){for(var a in this._activeTrigger)if(this._activeTrigger[a])return!0;return!1}},{key:"_getConfig",value:function(c){return c=f({},this.constructor.Default,a(this.element).data(),c),"number"==typeof c.delay&&(c.delay={show:c.delay,hide:c.delay}),"number"==typeof c.title&&(c.title=c.title.toString()),"number"==typeof c.content&&(c.content=c.content.toString()),m["default"].typeCheckConfig(b,c,this.constructor.DefaultType),c}},{key:"_getDelegateConfig",value:function(){var a={};if(this.config)for(var b in this.config)this.constructor.Default[b]!==this.config[b]&&(a[b]=this.config[b]);return a}},{key:"_cleanTipClass",value:function(){var b=a(this.getTipElement()),c=b.attr("class").match(o);null!==c&&c.length>0&&b.removeClass(c.join(""))}},{key:"_handlePopperPlacementChange",value:function(a){this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(a.placement))}},{key:"_fixTransition",value:function(){var b=this.getTipElement(),c=this.config.animation;null===b.getAttribute("x-placement")&&(a(b).removeClass(u.FADE),this.config.animation=!1,this.hide(),this.show(),this.config.animation=c)}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),e="object"===g(b)&&b;if((c||!/dispose|hide/.test(b))&&(c||(c=new i(this,e),a(this).data(d,c)),"string"==typeof b)){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return r}},{key:"NAME",get:function(){return b}},{key:"DATA_KEY",get:function(){return d}},{key:"Event",get:function(){return t}},{key:"EVENT_KEY",get:function(){return e}},{key:"DefaultType",get:function(){return p}}]),i}();return a.fn[b]=x._jQueryInterface,a.fn[b].Constructor=x,a.fn[b].noConflict=function(){return a.fn[b]=i,x._jQueryInterface},x}(k["default"],l["default"]);a["default"]=n});
define('theme_bootstrapbase/pending', ["jquery","core/pending"],function(a,b){var c={alert:[{classMatch:".alert",start:"close",end:"closed"}],carousel:[{classMatch:".carousel",start:"slide",end:"slid"}],collapse:[{classMatch:".collapse",start:"hide",end:"hidden"},{classMatch:".collapse",start:"show",end:"shown"}],modal:[{classMatch:".modal",start:"hide",end:"hidden"},{classMatch:".modal",start:"show",end:"shown"}],tab:[{classMatch:".tab",start:"hide",end:"hidden"},{classMatch:".tab",start:"show",end:"shown"}],tooltip:[{classMatch:".tooltip",start:"hide",end:"hidden"},{classMatch:".tooltip",start:"show",end:"shown"}]},d=function(b){var c=1e3;if(!b)return 0;var d=a(b).css("transition-duration"),e=a(b).css("transition-delay"),f=parseFloat(d),g=parseFloat(e);return f||g?(d=d.split(",")[0],e=e.split(",")[0],(parseFloat(d)+parseFloat(e))*c):0};Object.keys(c).forEach(function(e){c[e].forEach(function(c){a(document.body).on(c.start,c.classMatch,function(e){var f=a(e.target),g=new b(c.start),h=!1;a(document.body).one(c.end,c.classMatch,function(){h=!0,g.resolve()}),setTimeout(function(){h||f.trigger(c.end)},d(f))})})})});
define('theme_bootstrapbase/bootstrap', ["jquery"],function(a){function b(b){a(".dropdown-backdrop").remove(),a(k).each(function(){var d=c(a(this));void 0!=b&&0!=d.find(b).length||d.removeClass("open")})}function c(b){var c,d=b.attr("data-target");return d||(d=b.attr("href"),d=d&&/#/.test(d)&&d.replace(/.*(?=#[^\s]*$)/,"")),c=d&&a(d),c&&c.length||(c=b.parent()),c}function d(b,c){var d,e=a.proxy(this.process,this),f=a(a(b).is("body")?window:b);this.options=a.extend({},a.fn.scrollspy.defaults,c),this.$scrollElement=f.on("scroll.scroll-spy.data-api",e),this.selector=(this.options.target||(d=a(b).attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=a("body"),this.refresh(),this.process()}a(".h1").hide(),a(function(){a.support.transition=function(){var a=function(){var a,b=document.createElement("bootstrap"),c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(a in c)if(void 0!==b.style[a])return c[a]}();return a&&{end:a}}()});var e='[data-dismiss="alert"]',f=function(b){a(b).on("click",e,this.close)};f.prototype.close=function(b){function c(){d.trigger("closed").remove()}var d,e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,"")),d=a(f),b&&b.preventDefault(),d.length||(d=e.hasClass("alert")?e:e.parent()),d.trigger(b=a.Event("close")),b.isDefaultPrevented()||(d.removeClass("in"),a.support.transition&&d.hasClass("fade")?d.on(a.support.transition.end,c):c())};var g=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var c=a(this),d=c.data("alert");d||c.data("alert",d=new f(this)),"string"==typeof b&&d[b].call(c)})},a.fn.alert.Constructor=f,a.fn.alert.noConflict=function(){return a.fn.alert=g,this},a(document).on("click.alert.data-api",e,f.prototype.close);var h=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.button.defaults,c)};h.prototype.setState=function(a){var b="disabled",c=this.$element,d=c.data(),e=c.is("input")?"val":"html";a+="Text",d.resetText||c.data("resetText",c[e]()),c[e](d[a]||this.options[a]),setTimeout(function(){"loadingText"==a?c.addClass(b).attr(b,b):c.removeClass(b).removeAttr(b)},0)},h.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons-radio"]');a&&a.find(".active").removeClass("active"),this.$element.toggleClass("active")};var g=a.fn.button;a.fn.button=function(b){return this.each(function(){var c=a(this),d=c.data("button"),e="object"==typeof b&&b;d||c.data("button",d=new h(this,e)),"toggle"==b?d.toggle():b&&d.setState(b)})},a.fn.button.defaults={loadingText:"loading..."},a.fn.button.Constructor=h,a.fn.button.noConflict=function(){return a.fn.button=g,this},a(document).on("click.button.data-api","[data-toggle^=button]",function(b){var c=a(b.target);c.hasClass("btn")||(c=c.closest(".btn")),c.button("toggle")});var i=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};i.prototype={cycle:function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(b){var c=this.getActiveIndex(),d=this;if(!(b>this.$items.length-1||b<0))return this.sliding?this.$element.one("slid",function(){d.to(b)}):c==b?this.pause().cycle():this.slide(b>c?"next":"prev",a(this.$items[b]))},pause:function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition.end&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){if(!this.sliding)return this.slide("next")},prev:function(){if(!this.sliding)return this.slide("prev")},slide:function(b,c){var d,e=this.$element.find(".item.active"),f=c||e[b](),g=this.interval,h="next"==b?"left":"right",i="next"==b?"first":"last",j=this;if(this.sliding=!0,g&&this.pause(),f=f.length?f:this.$element.find(".item")[i](),d=a.Event("slide",{relatedTarget:f[0],direction:h}),!f.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var b=a(j.$indicators.children()[j.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(d),d.isDefaultPrevented())return;f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),this.$element.one(a.support.transition.end,function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),j.sliding=!1,setTimeout(function(){j.$element.trigger("slid")},0)})}else{if(this.$element.trigger(d),d.isDefaultPrevented())return;e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return g&&this.cycle(),this}}};var g=a.fn.carousel;a.fn.carousel=function(b){return this.each(function(){var c=a(this),d=c.data("carousel"),e=a.extend({},a.fn.carousel.defaults,"object"==typeof b&&b),f="string"==typeof b?b:e.slide;d||c.data("carousel",d=new i(this,e)),"number"==typeof b?d.to(b):f?d[f]():e.interval&&d.pause().cycle()})},a.fn.carousel.defaults={interval:5e3,pause:"hover"},a.fn.carousel.Constructor=i,a.fn.carousel.noConflict=function(){return a.fn.carousel=g,this},a(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(b){var c,d,e=a(this),f=a(e.attr("data-target")||(c=e.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),g=a.extend({},f.data(),e.data());f.carousel(g),(d=e.attr("data-slide-to"))&&f.data("carousel").pause().to(d).cycle(),b.preventDefault()});var j=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.collapse.defaults,c),this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};j.prototype={constructor:j,dimension:function(){var a=this.$element.hasClass("width");return a?"width":"height"},show:function(){var b,c,d,e;if(!this.transitioning&&!this.$element.hasClass("in")){if(b=this.dimension(),c=a.camelCase(["scroll",b].join("-")),d=this.$parent&&this.$parent.find("> .accordion-group > .in"),d&&d.length){if(e=d.data("collapse"),e&&e.transitioning)return;d.collapse("hide"),e||d.data("collapse",null)}this.$element[b](0),this.transition("addClass",a.Event("show"),"shown"),a.support.transition&&this.$element[b](this.$element[0][c])}},hide:function(){var b;!this.transitioning&&this.$element.hasClass("in")&&(b=this.dimension(),this.reset(this.$element[b]()),this.transition("removeClass",a.Event("hide"),"hidden"),this.$element[b](0))},reset:function(a){var b=this.dimension();return this.$element.removeClass("collapse")[b](a||"auto")[0].offsetWidth,this.$element[null!==a?"addClass":"removeClass"]("collapse"),this},transition:function(b,c,d){var e=this,f=function(){"show"==c.type&&e.reset(),e.transitioning=0,e.$element.trigger(d)};this.$element.trigger(c),c.isDefaultPrevented()||(this.transitioning=1,this.$element[b]("in"),a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,f):f())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var g=a.fn.collapse;a.fn.collapse=function(b){return this.each(function(){var c=a(this),d=c.data("collapse"),e=a.extend({},a.fn.collapse.defaults,c.data(),"object"==typeof b&&b);d||c.data("collapse",d=new j(this,e)),"string"==typeof b&&d[b]()})},a.fn.collapse.defaults={toggle:!0},a.fn.collapse.Constructor=j,a.fn.collapse.noConflict=function(){return a.fn.collapse=g,this},a(document).on("click.collapse.data-api","[data-toggle=collapse]",function(b){var c,d=a(this),e=d.attr("data-target")||b.preventDefault()||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(e).data("collapse")?"toggle":d.data();d[a(e).hasClass("in")?"addClass":"removeClass"]("collapsed"),a(e).collapse(f)});var k="[data-toggle=dropdown]",l=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};l.prototype={constructor:l,toggle:function(d){var e,f,g=a(this);if(!g.is(".disabled, :disabled"))return e=c(g),f=e.hasClass("open"),b(g),f||"ontouchstart"in document.documentElement&&a('<div class="dropdown-backdrop"/>').insertBefore(a(this)).on("click",b),e.toggleClass("open"),g.focus(),!1},keydown:function(b){var d,e,f,g,h;if(/(38|40|27)/.test(b.keyCode)&&(d=a(this),b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled"))){if(f=c(d),g=f.hasClass("open"),!g||g&&27==b.keyCode)return 27==b.which&&f.find(k).focus(),d.click();e=a("[role=menu] li:not(.divider):visible a",f),e.length&&(h=e.index(e.filter(":focus")),38==b.keyCode&&h>0&&h--,40==b.keyCode&&h<e.length-1&&h++,~h||(h=0),e.eq(h).focus())}}};var g=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("dropdown");d||c.data("dropdown",d=new l(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=l,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=g,this},a(document).on("click.dropdown.data-api",b).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown.data-api",k,l.prototype.toggle).on("keydown.dropdown.data-api",k+", [role=menu]",l.prototype.keydown);var m=function(b,c){this.options=c,this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};m.prototype={constructor:m,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this,c=a.Event("show");this.$element.trigger(c),this.isShown||c.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var c=a.support.transition&&b.$element.hasClass("fade");b.$element.parent().length||b.$element.appendTo(document.body),b.$element.show(),c&&b.$element[0].offsetWidth,b.$element.addClass("in").attr("aria-hidden",!1),b.enforceFocus(),c?b.$element.one(a.support.transition.end,function(){b.$element.focus().trigger("shown")}):b.$element.focus().trigger("shown")}))},hide:function(b){b&&b.preventDefault();b=a.Event("hide"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),a.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var b=this;a(document).on("focusin.modal",function(a){b.$element[0]===a.target||b.$element.has(a.target).length||b.$element.focus()})},escape:function(){var a=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(b){27==b.which&&a.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var b=this,c=setTimeout(function(){b.$element.off(a.support.transition.end),b.hideModal()},500);this.$element.one(a.support.transition.end,function(){clearTimeout(c),b.hideModal()})},hideModal:function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;if(this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this)),d&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;d?this.$backdrop.one(a.support.transition.end,b):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,b):b()):b&&b()}};var g=a.fn.modal;a.fn.modal=function(b){return this.each(function(){var c=a(this),d=c.data("modal"),e=a.extend({},a.fn.modal.defaults,c.data(),"object"==typeof b&&b);d||c.data("modal",d=new m(this,e)),"string"==typeof b?d[b]():e.show&&d.show()})},a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},a.fn.modal.Constructor=m,a.fn.modal.noConflict=function(){return a.fn.modal=g,this},a(document).on("click.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());b.preventDefault(),e.modal(f).one("hide",function(){c.focus()})});var n=function(a,b){this.init("tooltip",a,b)};n.prototype={constructor:n,init:function(b,c,d){var e,f,g,h,i;for(this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,g=this.options.trigger.split(" "),i=g.length;i--;)h=g[i],"click"==h?this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this)):"manual"!=h&&(e="hover"==h?"mouseenter":"focus",f="hover"==h?"mouseleave":"blur",this.$element.on(e+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var c,d=a.fn[this.type].defaults,e={};return this._options&&a.each(this._options,function(a,b){d[a]!=b&&(e[a]=b)},this),c=a(b.currentTarget)[this.type](e).data(this.type),c.options.delay&&c.options.delay.show?(clearTimeout(this.timeout),c.hoverState="in",void(this.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show))):c.show()},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),c.options.delay&&c.options.delay.hide?(c.hoverState="out",void(this.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide))):c.hide()},show:function(){var b,c,d,e,f,g,h=a.Event("show");if(this.hasContent()&&this.enabled){if(this.$element.trigger(h),h.isDefaultPrevented())return;switch(b=this.tip(),this.setContent(),this.options.animation&&b.addClass("fade"),f="function"==typeof this.options.placement?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement,b.detach().css({top:0,left:0,display:"block"}),this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element),c=this.getPosition(),d=b[0].offsetWidth,e=b[0].offsetHeight,f){case"bottom":g={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"top":g={top:c.top-e,left:c.left+c.width/2-d/2};break;case"left":g={top:c.top+c.height/2-e/2,left:c.left-d};break;case"right":g={top:c.top+c.height/2-e/2,left:c.left+c.width}}this.applyPlacement(g,f),this.$element.trigger("shown")}},applyPlacement:function(a,b){var c,d,e,f,g=this.tip(),h=g[0].offsetWidth,i=g[0].offsetHeight;g.offset(a).addClass(b).addClass("in"),c=g[0].offsetWidth,d=g[0].offsetHeight,"top"==b&&d!=i&&(a.top=a.top+i-d,f=!0),"bottom"==b||"top"==b?(e=0,a.left<0&&(e=a.left*-2,a.left=0,g.offset(a),c=g[0].offsetWidth,d=g[0].offsetHeight),this.replaceArrow(e-h+c,c,"left")):this.replaceArrow(d-i,d,"top"),f&&g.offset(a)},replaceArrow:function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},hide:function(){function b(){var b=setTimeout(function(){c.off(a.support.transition.end).detach()},500);c.one(a.support.transition.end,function(){clearTimeout(b),c.detach()})}var c=this.tip(),d=a.Event("hide");if(this.$element.trigger(d),!d.isDefaultPrevented())return c.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?b():c.detach(),this.$element.trigger("hidden"),this},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){var c=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;c.tip().hasClass("in")?c.hide():c.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var g=a.fn.tooltip;a.fn.tooltip=function(b){return this.each(function(){var c=a(this),d=c.data("tooltip"),e="object"==typeof b&&b;d||c.data("tooltip",d=new n(this,e)),"string"==typeof b&&d[b]()})},a.fn.tooltip.Constructor=n,a.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},a.fn.tooltip.noConflict=function(){return a.fn.tooltip=g,this};var o=function(a,b){this.init("popover",a,b)};o.prototype=a.extend({},a.fn.tooltip.Constructor.prototype,{constructor:o,setContent:function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"html":"text"](c),a.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var a,b=this.$element,c=this.options;return a=("function"==typeof c.content?c.content.call(b[0]):c.content)||b.attr("data-content")},tip:function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var g=a.fn.popover;a.fn.popover=function(b){return this.each(function(){var c=a(this),d=c.data("popover"),e="object"==typeof b&&b;d||c.data("popover",d=new o(this,e)),"string"==typeof b&&d[b]()})},a.fn.popover.Constructor=o,a.fn.popover.defaults=a.extend({},a.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),a.fn.popover.noConflict=function(){return a.fn.popover=g,this},d.prototype={constructor:d,refresh:function(){var b,c=this;this.offsets=a([]),this.targets=a([]),b=this.$body.find(this.selector).map(function(){var b=a(this),d=b.data("target")||b.attr("href"),e=/^#\w/.test(d)&&a(d);return e&&e.length&&[[e.position().top+(!a.isWindow(c.$scrollElement.get(0))&&c.$scrollElement.scrollTop()),d]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){c.offsets.push(this[0]),c.targets.push(this[1])})},process:function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,d=c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(b>=d)return g!=(a=f.last()[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},activate:function(b){var c,d;this.activeTarget=b,a(this.selector).parent(".active").removeClass("active"),d=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',c=a(d).parent("li").addClass("active"),c.parent(".dropdown-menu").length&&(c=c.closest("li.dropdown").addClass("active")),c.trigger("activate")}};var g=a.fn.scrollspy;a.fn.scrollspy=function(b){return this.each(function(){var c=a(this),e=c.data("scrollspy"),f="object"==typeof b&&b;e||c.data("scrollspy",e=new d(this,f)),"string"==typeof b&&e[b]()})},a.fn.scrollspy.Constructor=d,a.fn.scrollspy.defaults={offset:10},a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=g,this},a(window).on("load",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);b.scrollspy(b.data())})});var p=function(b){this.element=a(b)};p.prototype={constructor:p,show:function(){var b,c,d,e=this.element,f=e.closest("ul:not(.dropdown-menu)"),g=e.attr("data-target");g||(g=e.attr("href"),g=g&&g.replace(/.*(?=#[^\s]*$)/,"")),e.parent("li").hasClass("active")||(b=f.find(".active:last a")[0],d=a.Event("show",{relatedTarget:b}),e.trigger(d),d.isDefaultPrevented()||(c=a(g),this.activate(e.parent("li"),f),this.activate(c,c.parent(),function(){e.trigger({type:"shown",relatedTarget:b})})))},activate:function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one(a.support.transition.end,e):e(),f.removeClass("in")}};var g=a.fn.tab;a.fn.tab=function(b){return this.each(function(){var c=a(this),d=c.data("tab");d||c.data("tab",d=new p(this)),"string"==typeof b&&d[b]()})},a.fn.tab.Constructor=p,a.fn.tab.noConflict=function(){return a.fn.tab=g,this},a(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")});var q=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.typeahead.defaults,c),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=a(this.options.menu),this.shown=!1,this.listen()};q.prototype={constructor:q,select:function(){var a=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(a)).change(),this.hide()},updater:function(a){return a},show:function(){var b=a.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:b.top+b.height,left:b.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(b){var c;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(c=a.isFunction(this.source)?this.source(this.query,a.proxy(this.process,this)):this.source,c?this.process(c):this)},process:function(b){var c=this;return b=a.grep(b,function(a){return c.matcher(a)}),b=this.sorter(b),b.length?this.render(b.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){for(var b,c=[],d=[],e=[];b=a.shift();)b.toLowerCase().indexOf(this.query.toLowerCase())?~b.indexOf(this.query)?d.push(b):e.push(b):c.push(b);return c.concat(d,e)},highlighter:function(a){var b=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+b+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;return b=a(b).map(function(b,d){return b=a(c.options.item).attr("data-value",d),b.find("a").html(c.highlighter(d)),b[0]}),b.first().addClass("active"),this.$menu.html(b),this},next:function(b){var c=this.$menu.find(".active").removeClass("active"),d=c.next();d.length||(d=a(this.$menu.find("li")[0])),d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active"),c=b.prev();c.length||(c=this.$menu.find("li").last()),c.addClass("active")},listen:function(){this.$element.on("focus",a.proxy(this.focus,this)).on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",a.proxy(this.keydown,this)),this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this)).on("mouseleave","li",a.proxy(this.mouseleave,this))},eventSupported:function(a){var b=a in this.$element;return b||(this.$element.setAttribute(a,"return;"),b="function"==typeof this.$element[a]),b},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),this.prev();break;case 40:a.preventDefault(),this.next()}a.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=~a.inArray(b.keyCode,[40,38,9,13,27]),this.move(b)},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}a.stopPropagation(),a.preventDefault()},focus:function(a){this.focused=!0},blur:function(a){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(a){a.stopPropagation(),a.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(b){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),a(b.currentTarget).addClass("active")},mouseleave:function(a){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var g=a.fn.typeahead;a.fn.typeahead=function(b){return this.each(function(){var c=a(this),d=c.data("typeahead"),e="object"==typeof b&&b;d||c.data("typeahead",d=new q(this,e)),"string"==typeof b&&d[b]()})},a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},a.fn.typeahead.Constructor=q,a.fn.typeahead.noConflict=function(){return a.fn.typeahead=g,this},a(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);c.data("typeahead")||c.typeahead(c.data())});var r=function(b,c){this.options=a.extend({},a.fn.affix.defaults,c),this.$window=a(window).on("scroll.affix.data-api",a.proxy(this.checkPosition,this)).on("click.affix.data-api",a.proxy(function(){setTimeout(a.proxy(this.checkPosition,this),1)},this)),this.$element=a(b),this.checkPosition()};r.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b,c=a(document).height(),d=this.$window.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.bottom,h=f.top,i="affix affix-top affix-bottom";"object"!=typeof f&&(g=h=f),"function"==typeof h&&(h=f.top()),"function"==typeof g&&(g=f.bottom()),b=!(null!=this.unpin&&d+this.unpin<=e.top)&&(null!=g&&e.top+this.$element.height()>=c-g?"bottom":null!=h&&d<=h&&"top"),this.affixed!==b&&(this.affixed=b,this.unpin="bottom"==b?e.top-d:null,this.$element.removeClass(i).addClass("affix"+(b?"-"+b:"")))}};var g=a.fn.affix;a.fn.affix=function(b){return this.each(function(){var c=a(this),d=c.data("affix"),e="object"==typeof b&&b;d||c.data("affix",d=new r(this,e)),"string"==typeof b&&d[b]()})},a.fn.affix.Constructor=r,a.fn.affix.defaults={offset:0},a.fn.affix.noConflict=function(){return a.fn.affix=g,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var b=a(this),c=b.data();c.offset=c.offset||{},c.offsetBottom&&(c.offset.bottom=c.offsetBottom),c.offsetTop&&(c.offset.top=c.offsetTop),b.affix(c)})})});
/* @license C3.js v0.7.10 | (c) C3 Team and other contributors | http://c3js.org/ */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define('theme_material_boost/c3', e):(t=t||self).c3=e()}(this,function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(t){var e=this;e.d3=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,e.api=t,e.config=e.getDefaultConfig(),e.data={},e.cache={},e.axes={}}function n(t){this.internal=new l(this),this.internal.loadConfig(t),this.internal.beforeInit(t),this.internal.init(),this.internal.afterInit(t),function e(i,n,r){Object.keys(i).forEach(function(t){n[t]=i[t].bind(r),0<Object.keys(i[t]).length&&e(i[t],n[t],r)})}(n.prototype,this,this)}var o=function(t){return Math.ceil(t)+.5},r=function(t){return 10*Math.ceil(t/10)},R=function(t){return t[1]-t[0]},B=function(t,e,i){return k(t[e])?t[e]:i},y=function(t){var e=c(t),i=[t.pathSegList.getItem(0),t.pathSegList.getItem(1)];return{x:i[0].x,y:Math.min(i[0].y,i[1].y),width:e.width,height:e.height}},c=function(t){try{return t.getBBox()}catch(t){return{x:0,y:0,width:0,height:0}}},h=function(t){return Array.isArray(t)},k=function(t){return void 0!==t},u=function(t){return null==t||p(t)&&0===t.length||"object"===s(t)&&0===Object.keys(t).length},g=function(t){return"function"==typeof t},d=function(t){return"number"==typeof t},p=function(t){return"string"==typeof t},v=function(t){return void 0===t},C=function(t){return t||0===t},L=function(t){return!u(t)},_=function(t){return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t};function i(t,e){var i=this;i.component=t,i.params=e||{},i.d3=t.d3,i.scale=i.d3.scaleLinear(),i.range,i.orient="bottom",i.innerTickSize=6,i.outerTickSize=this.params.withOuterTick?6:0,i.tickPadding=3,i.tickValues=null,i.tickFormat,i.tickArguments,i.tickOffset=0,i.tickCulling=!0,i.tickCentered,i.tickTextCharSize,i.tickTextRotate=i.params.tickTextRotate,i.tickLength,i.axis=i.generateAxis()}i.prototype.axisX=function(t,e,i){t.attr("transform",function(t){return"translate("+Math.ceil(e(t)+i)+", 0)"})},i.prototype.axisY=function(t,e){t.attr("transform",function(t){return"translate(0,"+Math.ceil(e(t))+")"})},i.prototype.scaleExtent=function(t){var e=t[0],i=t[t.length-1];return e<i?[e,i]:[i,e]},i.prototype.generateTicks=function(t){var e,i,n=[];if(t.ticks)return t.ticks.apply(t,this.tickArguments);for(i=t.domain(),e=Math.ceil(i[0]);e<i[1];e++)n.push(e);return 0<n.length&&0<n[0]&&n.unshift(n[0]-(n[1]-n[0])),n},i.prototype.copyScale=function(){var t,e=this.scale.copy();return this.params.isCategory&&(t=this.scale.domain(),e.domain([t[0],t[1]-1])),e},i.prototype.textFormatted=function(t){var e=this.tickFormat?this.tickFormat(t):t;return void 0!==e?e:""},i.prototype.updateRange=function(){var t=this;return t.range=t.scale.rangeExtent?t.scale.rangeExtent():t.scaleExtent(t.scale.range()),t.range},i.prototype.updateTickTextCharSize=function(t){var a=this;if(a.tickTextCharSize)return a.tickTextCharSize;var o={h:11.5,w:5.5};return t.select("text").text(function(t){return a.textFormatted(t)}).each(function(t){var e=c(this),i=a.textFormatted(t),n=e.height,r=i?e.width/i.length:void 0;n&&r&&(o.h=n,o.w=r)}).text(""),a.tickTextCharSize=o},i.prototype.isVertical=function(){return"left"===this.orient||"right"===this.orient},i.prototype.tspanData=function(t,e,i){var n=this,r=n.params.tickMultiline?n.splitTickText(t,i):[].concat(n.textFormatted(t));return n.params.tickMultiline&&0<n.params.tickMultilineMax&&(r=n.ellipsify(r,n.params.tickMultilineMax)),r.map(function(t){return{index:e,splitted:t,length:r.length}})},i.prototype.splitTickText=function(t,e){var r,a,o,s=this,i=s.textFormatted(t),c=s.params.tickWidth;if("[object Array]"===Object.prototype.toString.call(i))return i;return(!c||c<=0)&&(c=s.isVertical()?95:s.params.isCategory?Math.ceil(e(1)-e(0))-12:110),function t(e,i){a=void 0;for(var n=1;n<i.length;n++)if(" "===i.charAt(n)&&(a=n),r=i.substr(0,n+1),o=s.tickTextCharSize.w*r.length,c<o)return t(e.concat(i.substr(0,a||n)),i.slice(a?a+1:n));return e.concat(i)}([],i+"")},i.prototype.ellipsify=function(t,e){if(t.length<=e)return t;for(var i=t.slice(0,e),n=3,r=e-1;0<=r;r--){var a=i[r].length;if(i[r]=i[r].substr(0,a-n).padEnd(a,"."),(n-=a)<=0)break}return i},i.prototype.updateTickLength=function(){this.tickLength=Math.max(this.innerTickSize,0)+this.tickPadding},i.prototype.lineY2=function(t){var e=this,i=e.scale(t)+(e.tickCentered?0:e.tickOffset);return e.range[0]<i&&i<e.range[1]?e.innerTickSize:0},i.prototype.textY=function(){var t=this.tickTextRotate;return t?11.5-t/15*2.5*(0<t?1:-1):this.tickLength},i.prototype.textTransform=function(){var t=this.tickTextRotate;return t?"rotate("+t+")":""},i.prototype.textTextAnchor=function(){var t=this.tickTextRotate;return t?0<t?"start":"end":"middle"},i.prototype.tspanDx=function(){var t=this.tickTextRotate;return t?8*Math.sin(Math.PI*(t/180)):0},i.prototype.tspanDy=function(t,e){var i=this.tickTextCharSize.h;return 0===e&&(i=this.isVertical()?-((t.length-1)*(this.tickTextCharSize.h/2)-3):".71em"),i},i.prototype.generateAxis=function(){var w=this,v=w.d3,b=w.params;function T(t,m){var S;return t.each(function(){var t,e,i,n=T.g=v.select(this),r=this.__chart__||w.scale,a=this.__chart__=w.copyScale(),o=w.tickValues?w.tickValues:w.generateTicks(a),s=n.selectAll(".tick").data(o,a),c=s.enter().insert("g",".domain").attr("class","tick").style("opacity",1e-6),d=s.exit().remove(),l=s.merge(c);b.isCategory?(w.tickOffset=Math.ceil((a(1)-a(0))/2),e=w.tickCentered?0:w.tickOffset,i=w.tickCentered?w.tickOffset:0):w.tickOffset=e=0,w.updateRange(),w.updateTickLength(),w.updateTickTextCharSize(n.select(".tick"));var u=l.select("line").merge(c.append("line")),h=l.select("text").merge(c.append("text")),g=l.selectAll("text").selectAll("tspan").data(function(t,e){return w.tspanData(t,e,a)}),p=g.enter().append("tspan").merge(g).text(function(t){return t.splitted});g.exit().remove();var f=n.selectAll(".domain").data([0]),_=f.enter().append("path").merge(f).attr("class","domain");switch(w.orient){case"bottom":t=w.axisX,u.attr("x1",e).attr("x2",e).attr("y2",function(t,e){return w.lineY2(t,e)}),h.attr("x",0).attr("y",function(t,e){return w.textY(t,e)}).attr("transform",function(t,e){return w.textTransform(t,e)}).style("text-anchor",function(t,e){return w.textTextAnchor(t,e)}),p.attr("x",0).attr("dy",function(t,e){return w.tspanDy(t,e)}).attr("dx",function(t,e){return w.tspanDx(t,e)}),_.attr("d","M"+w.range[0]+","+w.outerTickSize+"V0H"+w.range[1]+"V"+w.outerTickSize);break;case"top":t=w.axisX,u.attr("x1",e).attr("x2",e).attr("y2",function(t,e){return-1*w.lineY2(t,e)}),h.attr("x",0).attr("y",function(t,e){return-1*w.textY(t,e)-(b.isCategory?2:w.tickLength-2)}).attr("transform",function(t,e){return w.textTransform(t,e)}).style("text-anchor",function(t,e){return w.textTextAnchor(t,e)}),p.attr("x",0).attr("dy",function(t,e){return w.tspanDy(t,e)}).attr("dx",function(t,e){return w.tspanDx(t,e)}),_.attr("d","M"+w.range[0]+","+-w.outerTickSize+"V0H"+w.range[1]+"V"+-w.outerTickSize);break;case"left":t=w.axisY,u.attr("x2",-w.innerTickSize).attr("y1",i).attr("y2",i),h.attr("x",-w.tickLength).attr("y",w.tickOffset).style("text-anchor","end"),p.attr("x",-w.tickLength).attr("dy",function(t,e){return w.tspanDy(t,e)}),_.attr("d","M"+-w.outerTickSize+","+w.range[0]+"H0V"+w.range[1]+"H"+-w.outerTickSize);break;case"right":t=w.axisY,u.attr("x2",w.innerTickSize).attr("y1",i).attr("y2",i),h.attr("x",w.tickLength).attr("y",w.tickOffset).style("text-anchor","start"),p.attr("x",w.tickLength).attr("dy",function(t,e){return w.tspanDy(t,e)}),_.attr("d","M"+w.outerTickSize+","+w.range[0]+"H0V"+w.range[1]+"H"+w.outerTickSize)}if(a.rangeBand){var x=a,y=x.rangeBand()/2;r=a=function(t){return x(t)+y}}else r.rangeBand?r=a:d.call(t,a,w.tickOffset);c.call(t,r,w.tickOffset),S=(m?l.transition(m):l).style("opacity",1).call(t,a,w.tickOffset)}),S}return T.scale=function(t){return arguments.length?(w.scale=t,T):w.scale},T.orient=function(t){return arguments.length?(w.orient=t in{top:1,right:1,bottom:1,left:1}?t+"":"bottom",T):w.orient},T.tickFormat=function(t){return arguments.length?(w.tickFormat=t,T):w.tickFormat},T.tickCentered=function(t){return arguments.length?(w.tickCentered=t,T):w.tickCentered},T.tickOffset=function(){return w.tickOffset},T.tickInterval=function(){var t;return(t=b.isCategory?2*w.tickOffset:(T.g.select("path.domain").node().getTotalLength()-2*w.outerTickSize)/T.g.selectAll("line").size())===1/0?0:t},T.ticks=function(){return arguments.length?(w.tickArguments=arguments,T):w.tickArguments},T.tickCulling=function(t){return arguments.length?(w.tickCulling=t,T):w.tickCulling},T.tickValues=function(t){if("function"==typeof t)w.tickValues=function(){return t(w.scale.domain())};else{if(!arguments.length)return w.tickValues;w.tickValues=t}return T},T};var Y={target:"c3-target",chart:"c3-chart",chartLine:"c3-chart-line",chartLines:"c3-chart-lines",chartBar:"c3-chart-bar",chartBars:"c3-chart-bars",chartText:"c3-chart-text",chartTexts:"c3-chart-texts",chartArc:"c3-chart-arc",chartArcs:"c3-chart-arcs",chartArcsTitle:"c3-chart-arcs-title",chartArcsBackground:"c3-chart-arcs-background",chartArcsGaugeUnit:"c3-chart-arcs-gauge-unit",chartArcsGaugeMax:"c3-chart-arcs-gauge-max",chartArcsGaugeMin:"c3-chart-arcs-gauge-min",selectedCircle:"c3-selected-circle",selectedCircles:"c3-selected-circles",eventRect:"c3-event-rect",eventRects:"c3-event-rects",eventRectsSingle:"c3-event-rects-single",eventRectsMultiple:"c3-event-rects-multiple",zoomRect:"c3-zoom-rect",brush:"c3-brush",dragZoom:"c3-drag-zoom",focused:"c3-focused",defocused:"c3-defocused",region:"c3-region",regions:"c3-regions",title:"c3-title",tooltipContainer:"c3-tooltip-container",tooltip:"c3-tooltip",tooltipName:"c3-tooltip-name",shape:"c3-shape",shapes:"c3-shapes",line:"c3-line",lines:"c3-lines",bar:"c3-bar",bars:"c3-bars",circle:"c3-circle",circles:"c3-circles",arc:"c3-arc",arcLabelLine:"c3-arc-label-line",arcs:"c3-arcs",area:"c3-area",areas:"c3-areas",empty:"c3-empty",text:"c3-text",texts:"c3-texts",gaugeValue:"c3-gauge-value",grid:"c3-grid",gridLines:"c3-grid-lines",xgrid:"c3-xgrid",xgrids:"c3-xgrids",xgridLine:"c3-xgrid-line",xgridLines:"c3-xgrid-lines",xgridFocus:"c3-xgrid-focus",ygrid:"c3-ygrid",ygrids:"c3-ygrids",ygridLine:"c3-ygrid-line",ygridLines:"c3-ygrid-lines",colorScale:"c3-colorscale",stanfordElements:"c3-stanford-elements",stanfordLine:"c3-stanford-line",stanfordLines:"c3-stanford-lines",stanfordRegion:"c3-stanford-region",stanfordRegions:"c3-stanford-regions",stanfordText:"c3-stanford-text",stanfordTexts:"c3-stanford-texts",axis:"c3-axis",axisX:"c3-axis-x",axisXLabel:"c3-axis-x-label",axisY:"c3-axis-y",axisYLabel:"c3-axis-y-label",axisY2:"c3-axis-y2",axisY2Label:"c3-axis-y2-label",legendBackground:"c3-legend-background",legendItem:"c3-legend-item",legendItemEvent:"c3-legend-item-event",legendItemTile:"c3-legend-item-tile",legendItemHidden:"c3-legend-item-hidden",legendItemFocused:"c3-legend-item-focused",dragarea:"c3-dragarea",EXPANDED:"_expanded_",SELECTED:"_selected_",INCLUDED:"_included_"},f=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.owner=e,this.d3=e.d3,this.internal=i};f.prototype.init=function(){var t=this.owner,e=t.config,i=t.main;t.axes.x=i.append("g").attr("class",Y.axis+" "+Y.axisX).attr("clip-path",e.axis_x_inner?"":t.clipPathForXAxis).attr("transform",t.getTranslate("x")).style("visibility",e.axis_x_show?"visible":"hidden"),t.axes.x.append("text").attr("class",Y.axisXLabel).attr("transform",e.axis_rotated?"rotate(-90)":"").style("text-anchor",this.textAnchorForXAxisLabel.bind(this)),t.axes.y=i.append("g").attr("class",Y.axis+" "+Y.axisY).attr("clip-path",e.axis_y_inner?"":t.clipPathForYAxis).attr("transform",t.getTranslate("y")).style("visibility",e.axis_y_show?"visible":"hidden"),t.axes.y.append("text").attr("class",Y.axisYLabel).attr("transform",e.axis_rotated?"":"rotate(-90)").style("text-anchor",this.textAnchorForYAxisLabel.bind(this)),t.axes.y2=i.append("g").attr("class",Y.axis+" "+Y.axisY2).attr("transform",t.getTranslate("y2")).style("visibility",e.axis_y2_show?"visible":"hidden"),t.axes.y2.append("text").attr("class",Y.axisY2Label).attr("transform",e.axis_rotated?"":"rotate(-90)").style("text-anchor",this.textAnchorForY2AxisLabel.bind(this))},f.prototype.getXAxis=function(t,e,i,n,r,a,o){var s=this.owner,c=s.config,d={isCategory:s.isCategorized(),withOuterTick:r,tickMultiline:c.axis_x_tick_multiline,tickMultilineMax:c.axis_x_tick_multiline?Number(c.axis_x_tick_multilineMax):0,tickWidth:c.axis_x_tick_width,tickTextRotate:o?0:c.axis_x_tick_rotate,withoutTransition:a},l=new this.internal(this,d).axis.scale(t).orient(e);return s.isTimeSeries()&&n&&"function"!=typeof n&&(n=n.map(function(t){return s.parseDate(t)})),l.tickFormat(i).tickValues(n),s.isCategorized()&&(l.tickCentered(c.axis_x_tick_centered),u(c.axis_x_tick_culling)&&(c.axis_x_tick_culling=!1)),l},f.prototype.updateXAxisTickValues=function(t,e){var i,n=this.owner,r=n.config;return(r.axis_x_tick_fit||r.axis_x_tick_count)&&(i=this.generateTickValues(n.mapTargetsToUniqueXs(t),r.axis_x_tick_count,n.isTimeSeries())),e?e.tickValues(i):(n.xAxis.tickValues(i),n.subXAxis.tickValues(i)),i},f.prototype.getYAxis=function(t,e,i,n,r,a,o){var s=this.owner,c=s.config,d=c["axis_".concat(t,"_tick_format")];!d&&s.isAxisNormalized(t)&&(d=function(t){return"".concat(t,"%")});var l=new this.internal(this,{withOuterTick:r,withoutTransition:a,tickTextRotate:o?0:c.axis_y_tick_rotate}).axis.scale(e).orient(i);return d&&l.tickFormat(d),s.isTimeSeriesY()?l.ticks(c.axis_y_tick_time_type,c.axis_y_tick_time_interval):l.tickValues(n),l},f.prototype.getId=function(t){var e=this.owner.config;return t in e.data_axes?e.data_axes[t]:"y"},f.prototype.getXAxisTickFormat=function(){var e=this.owner,i=e.config,n=e.isTimeSeries()?e.defaultAxisTimeFormat:e.isCategorized()?e.categoryName:function(t){return t};return i.axis_x_tick_format&&(g(i.axis_x_tick_format)?n=i.axis_x_tick_format:e.isTimeSeries()&&(n=function(t){return t?e.axisTimeFormat(i.axis_x_tick_format)(t):""})),g(n)?function(t){return n.call(e,t)}:n},f.prototype.getTickValues=function(t,e){return t||(e?e.tickValues():void 0)},f.prototype.getXAxisTickValues=function(){return this.getTickValues(this.owner.config.axis_x_tick_values,this.owner.xAxis)},f.prototype.getYAxisTickValues=function(){return this.getTickValues(this.owner.config.axis_y_tick_values,this.owner.yAxis)},f.prototype.getY2AxisTickValues=function(){return this.getTickValues(this.owner.config.axis_y2_tick_values,this.owner.y2Axis)},f.prototype.getLabelOptionByAxisId=function(t){var e,i=this.owner.config;return"y"===t?e=i.axis_y_label:"y2"===t?e=i.axis_y2_label:"x"===t&&(e=i.axis_x_label),e},f.prototype.getLabelText=function(t){var e=this.getLabelOptionByAxisId(t);return p(e)?e:e?e.text:null},f.prototype.setLabelText=function(t,e){var i=this.owner.config,n=this.getLabelOptionByAxisId(t);p(n)?"y"===t?i.axis_y_label=e:"y2"===t?i.axis_y2_label=e:"x"===t&&(i.axis_x_label=e):n&&(n.text=e)},f.prototype.getLabelPosition=function(t,e){var i=this.getLabelOptionByAxisId(t),n=i&&"object"===s(i)&&i.position?i.position:e;return{isInner:0<=n.indexOf("inner"),isOuter:0<=n.indexOf("outer"),isLeft:0<=n.indexOf("left"),isCenter:0<=n.indexOf("center"),isRight:0<=n.indexOf("right"),isTop:0<=n.indexOf("top"),isMiddle:0<=n.indexOf("middle"),isBottom:0<=n.indexOf("bottom")}},f.prototype.getXAxisLabelPosition=function(){return this.getLabelPosition("x",this.owner.config.axis_rotated?"inner-top":"inner-right")},f.prototype.getYAxisLabelPosition=function(){return this.getLabelPosition("y",this.owner.config.axis_rotated?"inner-right":"inner-top")},f.prototype.getY2AxisLabelPosition=function(){return this.getLabelPosition("y2",this.owner.config.axis_rotated?"inner-right":"inner-top")},f.prototype.getLabelPositionById=function(t){return"y2"===t?this.getY2AxisLabelPosition():"y"===t?this.getYAxisLabelPosition():this.getXAxisLabelPosition()},f.prototype.textForXAxisLabel=function(){return this.getLabelText("x")},f.prototype.textForYAxisLabel=function(){return this.getLabelText("y")},f.prototype.textForY2AxisLabel=function(){return this.getLabelText("y2")},f.prototype.xForAxisLabel=function(t,e){var i=this.owner;return t?e.isLeft?0:e.isCenter?i.width/2:i.width:e.isBottom?-i.height:e.isMiddle?-i.height/2:0},f.prototype.dxForAxisLabel=function(t,e){return t?e.isLeft?"0.5em":e.isRight?"-0.5em":"0":e.isTop?"-0.5em":e.isBottom?"0.5em":"0"},f.prototype.textAnchorForAxisLabel=function(t,e){return t?e.isLeft?"start":e.isCenter?"middle":"end":e.isBottom?"start":e.isMiddle?"middle":"end"},f.prototype.xForXAxisLabel=function(){return this.xForAxisLabel(!this.owner.config.axis_rotated,this.getXAxisLabelPosition())},f.prototype.xForYAxisLabel=function(){return this.xForAxisLabel(this.owner.config.axis_rotated,this.getYAxisLabelPosition())},f.prototype.xForY2AxisLabel=function(){return this.xForAxisLabel(this.owner.config.axis_rotated,this.getY2AxisLabelPosition())},f.prototype.dxForXAxisLabel=function(){return this.dxForAxisLabel(!this.owner.config.axis_rotated,this.getXAxisLabelPosition())},f.prototype.dxForYAxisLabel=function(){return this.dxForAxisLabel(this.owner.config.axis_rotated,this.getYAxisLabelPosition())},f.prototype.dxForY2AxisLabel=function(){return this.dxForAxisLabel(this.owner.config.axis_rotated,this.getY2AxisLabelPosition())},f.prototype.dyForXAxisLabel=function(){var t=this.owner,e=t.config,i=this.getXAxisLabelPosition();return e.axis_rotated?i.isInner?"1.2em":-25-(t.config.axis_x_inner?0:this.getMaxTickWidth("x")):i.isInner?"-0.5em":t.getHorizontalAxisHeight("x")-10},f.prototype.dyForYAxisLabel=function(){var t=this.owner,e=this.getYAxisLabelPosition();return t.config.axis_rotated?e.isInner?"-0.5em":"3em":e.isInner?"1.2em":-10-(t.config.axis_y_inner?0:this.getMaxTickWidth("y")+10)},f.prototype.dyForY2AxisLabel=function(){var t=this.owner,e=this.getY2AxisLabelPosition();return t.config.axis_rotated?e.isInner?"1.2em":"-2.2em":e.isInner?"-0.5em":15+(t.config.axis_y2_inner?0:this.getMaxTickWidth("y2")+15)},f.prototype.textAnchorForXAxisLabel=function(){var t=this.owner;return this.textAnchorForAxisLabel(!t.config.axis_rotated,this.getXAxisLabelPosition())},f.prototype.textAnchorForYAxisLabel=function(){var t=this.owner;return this.textAnchorForAxisLabel(t.config.axis_rotated,this.getYAxisLabelPosition())},f.prototype.textAnchorForY2AxisLabel=function(){var t=this.owner;return this.textAnchorForAxisLabel(t.config.axis_rotated,this.getY2AxisLabelPosition())},f.prototype.getMaxTickWidth=function(t,e){var i,n,r,a,o=this.owner,s=0;return e&&o.currentMaxTickWidths[t]||(o.svg&&(i=o.filterTargetsToShow(o.data.targets),"y"===t?(n=o.y.copy().domain(o.getYDomain(i,"y")),r=this.getYAxis(t,n,o.yOrient,o.yAxisTickValues,!1,!0,!0)):"y2"===t?(n=o.y2.copy().domain(o.getYDomain(i,"y2")),r=this.getYAxis(t,n,o.y2Orient,o.y2AxisTickValues,!1,!0,!0)):(n=o.x.copy().domain(o.getXDomain(i)),r=this.getXAxis(n,o.xOrient,o.xAxisTickFormat,o.xAxisTickValues,!1,!0,!0),this.updateXAxisTickValues(i,r)),(a=o.d3.select("body").append("div").classed("c3",!0)).append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0).append("g").call(r).each(function(){o.d3.select(this).selectAll("text").each(function(){var t=c(this);s<t.width&&(s=t.width)}),a.remove()})),o.currentMaxTickWidths[t]=s<=0?o.currentMaxTickWidths[t]:s),o.currentMaxTickWidths[t]},f.prototype.updateLabels=function(t){var e=this.owner,i=e.main.select("."+Y.axisX+" ."+Y.axisXLabel),n=e.main.select("."+Y.axisY+" ."+Y.axisYLabel),r=e.main.select("."+Y.axisY2+" ."+Y.axisY2Label);(t?i.transition():i).attr("x",this.xForXAxisLabel.bind(this)).attr("dx",this.dxForXAxisLabel.bind(this)).attr("dy",this.dyForXAxisLabel.bind(this)).text(this.textForXAxisLabel.bind(this)),(t?n.transition():n).attr("x",this.xForYAxisLabel.bind(this)).attr("dx",this.dxForYAxisLabel.bind(this)).attr("dy",this.dyForYAxisLabel.bind(this)).text(this.textForYAxisLabel.bind(this)),(t?r.transition():r).attr("x",this.xForY2AxisLabel.bind(this)).attr("dx",this.dxForY2AxisLabel.bind(this)).attr("dy",this.dyForY2AxisLabel.bind(this)).text(this.textForY2AxisLabel.bind(this))},f.prototype.getPadding=function(t,e,i,n){var r="number"==typeof t?t:t[e];return C(r)?"ratio"===t.unit?t[e]*n:this.convertPixelsToAxisPadding(r,n):i},f.prototype.convertPixelsToAxisPadding=function(t,e){var i=this.owner;return e*(t/(i.config.axis_rotated?i.width:i.height))},f.prototype.generateTickValues=function(t,e,i){var n,r,a,o,s,c,d,l=t;if(e)if(1===(n=g(e)?e():e))l=[t[0]];else if(2===n)l=[t[0],t[t.length-1]];else if(2<n){for(o=n-2,r=t[0],s=((a=t[t.length-1])-r)/(o+1),l=[r],c=0;c<o;c++)d=+r+s*(c+1),l.push(i?new Date(d):d);l.push(a)}return i||(l=l.sort(function(t,e){return t-e})),l},f.prototype.generateTransitions=function(t){var e=this.owner.axes;return{axisX:t?e.x.transition().duration(t):e.x,axisY:t?e.y.transition().duration(t):e.y,axisY2:t?e.y2.transition().duration(t):e.y2,axisSubX:t?e.subx.transition().duration(t):e.subx}},f.prototype.redraw=function(t,e){var i=this.owner,n=t?i.d3.transition().duration(t):null;i.axes.x.style("opacity",e?0:1).call(i.xAxis,n),i.axes.y.style("opacity",e?0:1).call(i.yAxis,n),i.axes.y2.style("opacity",e?0:1).call(i.y2Axis,n),i.axes.subx.style("opacity",e?0:1).call(i.subXAxis,n)};var t={version:"0.7.10",chart:{fn:n.prototype,internal:{fn:l.prototype,axis:{fn:f.prototype,internal:{fn:i.prototype}}}},generate:function(t){return new n(t)}};function x(t,e,i){var n=[.01,10];function r(t){return i(e(t))}return e||(e=t.scaleLinear()).range(n),i||((i=t.scaleLog()).domain(n),i.nice()),r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain()},r.range=function(t){return arguments.length?(i.range(t),r):i.range()},r.ticks=function(t){return function(t,e,i){var n,r,a,o;if(arguments.length<3)i=10;else if(0===i)return[];o=(e-t)/(r=i-1),a=t,(n=new Array(i))[0]=Math.pow(10,a);for(var s=1;s<r;s++)a+=o,n[s]=Math.pow(10,a);return n[r]=Math.pow(10,e),n}(-2,1,t||10).map(function(t){return e.invert(t)})},r.copy=function(){return x(t,e.copy(),i.copy())},r}function m(t){return t/Math.pow(10,Math.ceil(Math.log(t)/Math.LN10-1e-12))==1}l.prototype.beforeInit=function(){},l.prototype.afterInit=function(){},l.prototype.init=function(){var t=this,e=t.config;if(t.initParams(),e.data_url)t.convertUrlToData(e.data_url,e.data_mimeType,e.data_headers,e.data_keys,t.initWithData);else if(e.data_json)t.initWithData(t.convertJsonToData(e.data_json,e.data_keys));else if(e.data_rows)t.initWithData(t.convertRowsToData(e.data_rows));else{if(!e.data_columns)throw Error("url or json or rows or columns is required.");t.initWithData(t.convertColumnsToData(e.data_columns))}},l.prototype.initParams=function(){var t=this,e=t.d3,i=t.config;t.clipId="c3-"+ +new Date+"-clip",t.clipIdForXAxis=t.clipId+"-xaxis",t.clipIdForYAxis=t.clipId+"-yaxis",t.clipIdForGrid=t.clipId+"-grid",t.clipIdForSubchart=t.clipId+"-subchart",t.clipPath=t.getClipPath(t.clipId),t.clipPathForXAxis=t.getClipPath(t.clipIdForXAxis),t.clipPathForYAxis=t.getClipPath(t.clipIdForYAxis),t.clipPathForGrid=t.getClipPath(t.clipIdForGrid),t.clipPathForSubchart=t.getClipPath(t.clipIdForSubchart),t.dragStart=null,t.dragging=!1,t.flowing=!1,t.cancelClick=!1,t.mouseover=void 0,t.transiting=!1,t.color=t.generateColor(),t.levelColor=t.generateLevelColor(),t.dataTimeParse=(i.data_xLocaltime?e.timeParse:e.utcParse)(t.config.data_xFormat),t.axisTimeFormat=i.axis_x_localtime?e.timeFormat:e.utcFormat,t.defaultAxisTimeFormat=function(t){return t.getMilliseconds()?e.timeFormat(".%L")(t):t.getSeconds()?e.timeFormat(":%S")(t):t.getMinutes()?e.timeFormat("%I:%M")(t):t.getHours()?e.timeFormat("%I %p")(t):t.getDay()&&1!==t.getDate()?e.timeFormat("%-m/%-d")(t):1!==t.getDate()?e.timeFormat("%-m/%-d")(t):t.getMonth()?e.timeFormat("%-m/%-d")(t):e.timeFormat("%Y/%-m/%-d")(t)},t.hiddenTargetIds=[],t.hiddenLegendIds=[],t.focusedTargetIds=[],t.defocusedTargetIds=[],t.xOrient=i.axis_rotated?i.axis_x_inner?"right":"left":i.axis_x_inner?"top":"bottom",t.yOrient=i.axis_rotated?i.axis_y_inner?"top":"bottom":i.axis_y_inner?"right":"left",t.y2Orient=i.axis_rotated?i.axis_y2_inner?"bottom":"top":i.axis_y2_inner?"left":"right",t.subXOrient=i.axis_rotated?"left":"bottom",t.isLegendRight="right"===i.legend_position,t.isLegendInset="inset"===i.legend_position,t.isLegendTop="top-left"===i.legend_inset_anchor||"top-right"===i.legend_inset_anchor,t.isLegendLeft="top-left"===i.legend_inset_anchor||"bottom-left"===i.legend_inset_anchor,t.legendStep=0,t.legendItemWidth=0,t.legendItemHeight=0,t.currentMaxTickWidths={x:0,y:0,y2:0},t.rotated_padding_left=30,t.rotated_padding_right=i.axis_rotated&&!i.axis_x_show?0:30,t.rotated_padding_top=5,t.withoutFadeIn={},t.intervalForObserveInserted=void 0,t.axes.subx=e.selectAll([])},l.prototype.initChartElements=function(){this.initBar&&this.initBar(),this.initLine&&this.initLine(),this.initArc&&this.initArc(),this.initGauge&&this.initGauge(),this.initText&&this.initText()},l.prototype.initWithData=function(t){var e,i,n=this,r=n.d3,a=n.config,o=!0;n.axis=new f(n),a.bindto?"function"==typeof a.bindto.node?n.selectChart=a.bindto:n.selectChart=r.select(a.bindto):n.selectChart=r.selectAll([]),n.selectChart.empty()&&(n.selectChart=r.select(document.createElement("div")).style("opacity",0),n.observeInserted(n.selectChart),o=!1),n.selectChart.html("").classed("c3",!0),n.data.xs={},n.data.targets=n.convertDataToTargets(t),a.data_filter&&(n.data.targets=n.data.targets.filter(a.data_filter)),a.data_hide&&n.addHiddenTargetIds(!0===a.data_hide?n.mapToIds(n.data.targets):a.data_hide),a.legend_hide&&n.addHiddenLegendIds(!0===a.legend_hide?n.mapToIds(n.data.targets):a.legend_hide),n.isStanfordGraphType()&&n.initStanfordData(),n.updateSizes(),n.updateScales(),n.x.domain(r.extent(n.getXDomain(n.data.targets))),n.y.domain(n.getYDomain(n.data.targets,"y")),n.y2.domain(n.getYDomain(n.data.targets,"y2")),n.subX.domain(n.x.domain()),n.subY.domain(n.y.domain()),n.subY2.domain(n.y2.domain()),n.orgXDomain=n.x.domain(),n.svg=n.selectChart.append("svg").style("overflow","hidden").on("mouseenter",function(){return a.onmouseover.call(n)}).on("mouseleave",function(){return a.onmouseout.call(n)}),n.config.svg_classname&&n.svg.attr("class",n.config.svg_classname),e=n.svg.append("defs"),n.clipChart=n.appendClip(e,n.clipId),n.clipXAxis=n.appendClip(e,n.clipIdForXAxis),n.clipYAxis=n.appendClip(e,n.clipIdForYAxis),n.clipGrid=n.appendClip(e,n.clipIdForGrid),n.clipSubchart=n.appendClip(e,n.clipIdForSubchart),n.updateSvgSize(),i=n.main=n.svg.append("g").attr("transform",n.getTranslate("main")),n.initPie&&n.initPie(),n.initDragZoom&&n.initDragZoom(),n.initSubchart&&n.initSubchart(),n.initTooltip&&n.initTooltip(),n.initLegend&&n.initLegend(),n.initTitle&&n.initTitle(),n.initZoom&&n.initZoom(),n.isStanfordGraphType()&&n.drawColorScale(),n.initSubchartBrush&&n.initSubchartBrush(),i.append("text").attr("class",Y.text+" "+Y.empty).attr("text-anchor","middle").attr("dominant-baseline","middle"),n.initRegion(),n.initGrid(),i.append("g").attr("clip-path",n.clipPath).attr("class",Y.chart),a.grid_lines_front&&n.initGridLines(),n.initStanfordElements(),n.initEventRect(),n.initChartElements(),n.axis.init(),n.updateTargets(n.data.targets),a.axis_x_selection&&n.brush.selectionAsValue(n.getDefaultSelection()),o&&(n.updateDimension(),n.config.oninit.call(n),n.redraw({withTransition:!1,withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withTransitionForAxis:!1})),n.bindResize(),n.bindWindowFocus(),n.api.element=n.selectChart.node()},l.prototype.smoothLines=function(t,e){var a=this;"grid"===e&&t.each(function(){var t=a.d3.select(this),e=t.attr("x1"),i=t.attr("x2"),n=t.attr("y1"),r=t.attr("y2");t.attr({x1:Math.ceil(e),x2:Math.ceil(i),y1:Math.ceil(n),y2:Math.ceil(r)})})},l.prototype.updateSizes=function(){var t=this,e=t.config,i=t.legend?t.getLegendHeight():0,n=t.legend?t.getLegendWidth():0,r=t.isLegendRight||t.isLegendInset?0:i,a=t.hasArcType(),o=e.axis_rotated||a?0:t.getHorizontalAxisHeight("x"),s=e.subchart_show&&!a?e.subchart_size_height+o:0;t.currentWidth=t.getCurrentWidth(),t.currentHeight=t.getCurrentHeight(),t.margin=e.axis_rotated?{top:t.getHorizontalAxisHeight("y2")+t.getCurrentPaddingTop(),right:a?0:t.getCurrentPaddingRight(),bottom:t.getHorizontalAxisHeight("y")+r+t.getCurrentPaddingBottom(),left:s+(a?0:t.getCurrentPaddingLeft())}:{top:4+t.getCurrentPaddingTop(),right:a?0:t.getCurrentPaddingRight(),bottom:o+s+r+t.getCurrentPaddingBottom(),left:a?0:t.getCurrentPaddingLeft()},t.margin2=e.axis_rotated?{top:t.margin.top,right:NaN,bottom:20+r,left:t.rotated_padding_left}:{top:t.currentHeight-s-r,right:NaN,bottom:o+r,left:t.margin.left},t.margin3={top:0,right:NaN,bottom:0,left:0},t.updateSizeForLegend&&t.updateSizeForLegend(i,n),t.width=t.currentWidth-t.margin.left-t.margin.right,t.height=t.currentHeight-t.margin.top-t.margin.bottom,t.width<0&&(t.width=0),t.height<0&&(t.height=0),t.width2=e.axis_rotated?t.margin.left-t.rotated_padding_left-t.rotated_padding_right:t.width,t.height2=e.axis_rotated?t.height:t.currentHeight-t.margin2.top-t.margin2.bottom,t.width2<0&&(t.width2=0),t.height2<0&&(t.height2=0),t.arcWidth=t.width-(t.isLegendRight?n+10:0),t.arcHeight=t.height-(t.isLegendRight?0:10),t.hasType("gauge")&&!e.gauge_fullCircle&&(t.arcHeight+=t.height-t.getGaugeLabelHeight()),t.updateRadius&&t.updateRadius(),t.isLegendRight&&a&&(t.margin3.left=t.arcWidth/2+1.1*t.radiusExpanded)},l.prototype.updateTargets=function(t){var e=this;e.updateTargetsForText(t),e.updateTargetsForBar(t),e.updateTargetsForLine(t),e.hasArcType()&&e.updateTargetsForArc&&e.updateTargetsForArc(t),e.updateTargetsForSubchart&&e.updateTargetsForSubchart(t),e.showTargets()},l.prototype.showTargets=function(){var e=this;e.svg.selectAll("."+Y.target).filter(function(t){return e.isTargetToShow(t.id)}).transition().duration(e.config.transition_duration).style("opacity",1)},l.prototype.redraw=function(t,e){var i,n,r,a,o,s,c,d,l,u,h,g,p,f,_,x,y,m,S,w,v,b,T,A,P,C,L,V,G,E,O,I=this,R=I.main,k=I.d3,D=I.config,F=I.getShapeIndices(I.isAreaType),X=I.getShapeIndices(I.isBarType),z=I.getShapeIndices(I.isLineType),M=I.hasArcType(),H=I.filterTargetsToShow(I.data.targets),N=I.xv.bind(I);if(i=B(t=t||{},"withY",!0),n=B(t,"withSubchart",!0),r=B(t,"withTransition",!0),s=B(t,"withTransform",!1),c=B(t,"withUpdateXDomain",!1),d=B(t,"withUpdateOrgXDomain",!1),l=B(t,"withTrimXDomain",!0),p=B(t,"withUpdateXAxis",c),u=B(t,"withLegend",!1),h=B(t,"withEventRect",!0),g=B(t,"withDimension",!0),a=B(t,"withTransitionForExit",r),o=B(t,"withTransitionForAxis",r),S=r?D.transition_duration:0,w=a?S:0,v=o?S:0,e=e||I.axis.generateTransitions(v),u&&D.legend_show?I.updateLegend(I.mapToIds(I.data.targets),t,e):g&&I.updateDimension(!0),I.isCategorized()&&0===H.length&&I.x.domain([0,I.axes.x.selectAll(".tick").size()]),H.length?(I.updateXDomain(H,c,d,l),D.axis_x_tick_values||(C=I.axis.updateXAxisTickValues(H))):(I.xAxis.tickValues([]),I.subXAxis.tickValues([])),D.zoom_rescale&&!t.flow&&(G=I.x.orgDomain()),I.y.domain(I.getYDomain(H,"y",G)),I.y2.domain(I.getYDomain(H,"y2",G)),!D.axis_y_tick_values&&D.axis_y_tick_count&&I.yAxis.tickValues(I.axis.generateTickValues(I.y.domain(),D.axis_y_tick_count)),!D.axis_y2_tick_values&&D.axis_y2_tick_count&&I.y2Axis.tickValues(I.axis.generateTickValues(I.y2.domain(),D.axis_y2_tick_count)),I.axis.redraw(v,M),I.axis.updateLabels(r),(c||p)&&H.length)if(D.axis_x_tick_culling&&C){for(L=1;L<C.length;L++)if(C.length/L<D.axis_x_tick_culling_max){V=L;break}I.svg.selectAll("."+Y.axisX+" .tick text").each(function(t){var e=C.indexOf(t);0<=e&&k.select(this).style("display",e%V?"none":"block")})}else I.svg.selectAll("."+Y.axisX+" .tick text").style("display","block");f=I.generateDrawArea?I.generateDrawArea(F,!1):void 0,_=I.generateDrawBar?I.generateDrawBar(X):void 0,x=I.generateDrawLine?I.generateDrawLine(z,!1):void 0,y=I.generateXYForText(F,X,z,!0),m=I.generateXYForText(F,X,z,!1),I.updateCircleY(),E=(I.config.axis_rotated?I.circleY:I.circleX).bind(I),O=(I.config.axis_rotated?I.circleX:I.circleY).bind(I),i&&(I.subY.domain(I.getYDomain(H,"y")),I.subY2.domain(I.getYDomain(H,"y2"))),I.updateXgridFocus(),R.select("text."+Y.text+"."+Y.empty).attr("x",I.width/2).attr("y",I.height/2).text(D.data_empty_label_text).transition().style("opacity",H.length?0:1),h&&I.redrawEventRect(),I.updateGrid(S),I.updateStanfordElements(S),I.updateRegion(S),I.updateBar(w),I.updateLine(w),I.updateArea(w),I.updateCircle(E,O),I.hasDataLabel()&&I.updateText(y,m,w),I.redrawTitle&&I.redrawTitle(),I.redrawArc&&I.redrawArc(S,w,s),I.redrawSubchart&&I.redrawSubchart(n,e,S,w,F,X,z),I.isStanfordGraphType()&&I.drawColorScale(),R.selectAll("."+Y.selectedCircles).filter(I.isBarType.bind(I)).selectAll("circle").remove(),t.flow&&(A=I.generateFlow({targets:H,flow:t.flow,duration:t.flow.duration,drawBar:_,drawLine:x,drawArea:f,cx:E,cy:O,xv:N,xForText:y,yForText:m})),S&&I.isTabVisible()?(P=k.transition().duration(S),b=[],[I.redrawBar(_,!0,P),I.redrawLine(x,!0,P),I.redrawArea(f,!0,P),I.redrawCircle(E,O,!0,P),I.redrawText(y,m,t.flow,!0,P),I.redrawRegion(!0,P),I.redrawGrid(!0,P)].forEach(function(t){t.forEach(function(t){b.push(t)})}),T=I.generateWait(),b.forEach(function(t){T.add(t)}),T(function(){A&&A(),D.onrendered&&D.onrendered.call(I)})):(I.redrawBar(_),I.redrawLine(x),I.redrawArea(f),I.redrawCircle(E,O),I.redrawText(y,m,t.flow),I.redrawRegion(),I.redrawGrid(),A&&A(),D.onrendered&&D.onrendered.call(I)),I.mapToIds(I.data.targets).forEach(function(t){I.withoutFadeIn[t]=!0})},l.prototype.updateAndRedraw=function(t){var e,i=this,n=i.config;(t=t||{}).withTransition=B(t,"withTransition",!0),t.withTransform=B(t,"withTransform",!1),t.withLegend=B(t,"withLegend",!1),t.withUpdateXDomain=B(t,"withUpdateXDomain",!0),t.withUpdateOrgXDomain=B(t,"withUpdateOrgXDomain",!0),t.withTransitionForExit=!1,t.withTransitionForTransform=B(t,"withTransitionForTransform",t.withTransition),i.updateSizes(),t.withLegend&&n.legend_show||(e=i.axis.generateTransitions(t.withTransitionForAxis?n.transition_duration:0),i.updateScales(),i.updateSvgSize(),i.transformAll(t.withTransitionForTransform,e)),i.redraw(t,e)},l.prototype.redrawWithoutRescale=function(){this.redraw({withY:!1,withSubchart:!1,withEventRect:!1,withTransitionForAxis:!1})},l.prototype.isTimeSeries=function(){return"timeseries"===this.config.axis_x_type},l.prototype.isCategorized=function(){return 0<=this.config.axis_x_type.indexOf("categor")},l.prototype.isCustomX=function(){var t=this.config;return!this.isTimeSeries()&&(t.data_x||L(t.data_xs))},l.prototype.isTimeSeriesY=function(){return"timeseries"===this.config.axis_y_type},l.prototype.getTranslate=function(t){var e,i,n=this,r=n.config;return"main"===t?(e=o(n.margin.left),i=o(n.margin.top)):"context"===t?(e=o(n.margin2.left),i=o(n.margin2.top)):"legend"===t?(e=n.margin3.left,i=n.margin3.top):"x"===t?(e=0,i=r.axis_rotated?0:n.height):"y"===t?(e=0,i=r.axis_rotated?n.height:0):"y2"===t?(e=r.axis_rotated?0:n.width,i=r.axis_rotated?1:0):"subx"===t?(e=0,i=r.axis_rotated?0:n.height2):"arc"===t&&(e=n.arcWidth/2,i=n.arcHeight/2-(n.hasType("gauge")?6:0)),"translate("+e+","+i+")"},l.prototype.initialOpacity=function(t){return null!==t.value&&this.withoutFadeIn[t.id]?1:0},l.prototype.initialOpacityForCircle=function(t){return null!==t.value&&this.withoutFadeIn[t.id]?this.opacityForCircle(t):0},l.prototype.opacityForCircle=function(t){var e=(g(this.config.point_show)?this.config.point_show(t):this.config.point_show)||this.isStanfordType(t)?1:0;return C(t.value)?this.isScatterType(t)?.5:e:0},l.prototype.opacityForText=function(){return this.hasDataLabel()?1:0},l.prototype.xx=function(t){return t?this.x(t.x):null},l.prototype.xvCustom=function(t,e){var i=this,n=e?t[e]:t.value;return i.isTimeSeries()?n=i.parseDate(t.value):i.isCategorized()&&"string"==typeof t.value&&(n=i.config.axis_x_categories.indexOf(t.value)),Math.ceil(i.x(n))},l.prototype.yvCustom=function(t,e){var i=t.axis&&"y2"===t.axis?this.y2:this.y,n=e?t[e]:t.value;return Math.ceil(i(n))},l.prototype.xv=function(t){var e=this,i=t.value;return e.isTimeSeries()?i=e.parseDate(t.value):e.isCategorized()&&"string"==typeof t.value&&(i=e.config.axis_x_categories.indexOf(t.value)),Math.ceil(e.x(i))},l.prototype.yv=function(t){var e=t.axis&&"y2"===t.axis?this.y2:this.y;return Math.ceil(e(t.value))},l.prototype.subxx=function(t){return t?this.subX(t.x):null},l.prototype.transformMain=function(t,e){var i,n,r,a=this;e&&e.axisX?i=e.axisX:(i=a.main.select("."+Y.axisX),t&&(i=i.transition())),e&&e.axisY?n=e.axisY:(n=a.main.select("."+Y.axisY),t&&(n=n.transition())),e&&e.axisY2?r=e.axisY2:(r=a.main.select("."+Y.axisY2),t&&(r=r.transition())),(t?a.main.transition():a.main).attr("transform",a.getTranslate("main")),i.attr("transform",a.getTranslate("x")),n.attr("transform",a.getTranslate("y")),r.attr("transform",a.getTranslate("y2")),a.main.select("."+Y.chartArcs).attr("transform",a.getTranslate("arc"))},l.prototype.transformAll=function(t,e){var i=this;i.transformMain(t,e),i.config.subchart_show&&i.transformContext(t,e),i.legend&&i.transformLegend(t)},l.prototype.updateSvgSize=function(){var t=this,e=t.svg.select(".c3-brush .overlay");t.svg.attr("width",t.currentWidth).attr("height",t.currentHeight),t.svg.selectAll(["#"+t.clipId,"#"+t.clipIdForGrid]).select("rect").attr("width",t.width).attr("height",t.height),t.svg.select("#"+t.clipIdForXAxis).select("rect").attr("x",t.getXAxisClipX.bind(t)).attr("y",t.getXAxisClipY.bind(t)).attr("width",t.getXAxisClipWidth.bind(t)).attr("height",t.getXAxisClipHeight.bind(t)),t.svg.select("#"+t.clipIdForYAxis).select("rect").attr("x",t.getYAxisClipX.bind(t)).attr("y",t.getYAxisClipY.bind(t)).attr("width",t.getYAxisClipWidth.bind(t)).attr("height",t.getYAxisClipHeight.bind(t)),t.svg.select("#"+t.clipIdForSubchart).select("rect").attr("width",t.width).attr("height",e.size()?e.attr("height"):0),t.selectChart.style("max-height",t.currentHeight+"px")},l.prototype.updateDimension=function(t){var e=this;t||(e.config.axis_rotated?(e.axes.x.call(e.xAxis),e.axes.subx.call(e.subXAxis)):(e.axes.y.call(e.yAxis),e.axes.y2.call(e.y2Axis))),e.updateSizes(),e.updateScales(),e.updateSvgSize(),e.transformAll(!1)},l.prototype.observeInserted=function(e){var i,n=this;"undefined"!=typeof MutationObserver?(i=new MutationObserver(function(t){t.forEach(function(t){"childList"===t.type&&t.previousSibling&&(i.disconnect(),n.intervalForObserveInserted=window.setInterval(function(){e.node().parentNode&&(window.clearInterval(n.intervalForObserveInserted),n.updateDimension(),n.brush&&n.brush.update(),n.config.oninit.call(n),n.redraw({withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withTransition:!1,withTransitionForTransform:!1,withLegend:!0}),e.transition().style("opacity",1))},10))})})).observe(e.node(),{attributes:!0,childList:!0,characterData:!0}):window.console.error("MutationObserver not defined.")},l.prototype.bindResize=function(){var t=this,e=t.config;if(t.resizeFunction=t.generateResize(),t.resizeFunction.add(function(){e.onresize.call(t)}),e.resize_auto&&t.resizeFunction.add(function(){void 0!==t.resizeTimeout&&window.clearTimeout(t.resizeTimeout),t.resizeTimeout=window.setTimeout(function(){delete t.resizeTimeout,t.updateAndRedraw({withUpdateXDomain:!1,withUpdateOrgXDomain:!1,withTransition:!1,withTransitionForTransform:!1,withLegend:!0}),t.brush&&t.brush.update()},100)}),t.resizeFunction.add(function(){e.onresized.call(t)}),t.resizeIfElementDisplayed=function(){null!=t.api&&t.api.element.offsetParent&&t.resizeFunction()},window.attachEvent)window.attachEvent("onresize",t.resizeIfElementDisplayed);else if(window.addEventListener)window.addEventListener("resize",t.resizeIfElementDisplayed,!1);else{var i=window.onresize;i?i.add&&i.remove||(i=t.generateResize()).add(window.onresize):i=t.generateResize(),i.add(t.resizeFunction),window.onresize=function(){t.api.element.offsetParent&&i()}}},l.prototype.bindWindowFocus=function(){var t=this;this.windowFocusHandler||(this.windowFocusHandler=function(){t.redraw()},window.addEventListener("focus",this.windowFocusHandler))},l.prototype.unbindWindowFocus=function(){window.removeEventListener("focus",this.windowFocusHandler),delete this.windowFocusHandler},l.prototype.generateResize=function(){var i=[];function t(){i.forEach(function(t){t()})}return t.add=function(t){i.push(t)},t.remove=function(t){for(var e=0;e<i.length;e++)if(i[e]===t){i.splice(e,1);break}},t},l.prototype.endall=function(t,e){var i=0;t.each(function(){++i}).on("end",function(){--i||e.apply(this,arguments)})},l.prototype.generateWait=function(){var n=this,r=[],t=function(t){var i=setInterval(function(){if(n.isTabVisible()){var e=0;r.forEach(function(t){if(t.empty())e+=1;else try{t.transition()}catch(t){e+=1}}),e===r.length&&(clearInterval(i),t&&t())}},50)};return t.add=function(t){r.push(t)},t},l.prototype.parseDate=function(t){var e;return t instanceof Date?e=t:"string"==typeof t?e=this.dataTimeParse(t):"object"===s(t)?e=new Date(+t):"number"!=typeof t||isNaN(t)||(e=new Date(+t)),e&&!isNaN(+e)||window.console.error("Failed to parse x '"+t+"' to Date object"),e},l.prototype.isTabVisible=function(){return!document.hidden},l.prototype.getPathBox=y,l.prototype.CLASS=Y,"SVGPathSeg"in window||(window.SVGPathSeg=function(t,e,i){this.pathSegType=t,this.pathSegTypeAsLetter=e,this._owningPathSegList=i},window.SVGPathSeg.prototype.classname="SVGPathSeg",window.SVGPathSeg.PATHSEG_UNKNOWN=0,window.SVGPathSeg.PATHSEG_CLOSEPATH=1,window.SVGPathSeg.PATHSEG_MOVETO_ABS=2,window.SVGPathSeg.PATHSEG_MOVETO_REL=3,window.SVGPathSeg.PATHSEG_LINETO_ABS=4,window.SVGPathSeg.PATHSEG_LINETO_REL=5,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9,window.SVGPathSeg.PATHSEG_ARC_ABS=10,window.SVGPathSeg.PATHSEG_ARC_REL=11,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19,window.SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)},window.SVGPathSegClosePath=function(t){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CLOSEPATH,"z",t)},window.SVGPathSegClosePath.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"},window.SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter},window.SVGPathSegClosePath.prototype.clone=function(){return new window.SVGPathSegClosePath(void 0)},window.SVGPathSegMovetoAbs=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_MOVETO_ABS,"M",t),this._x=e,this._y=i},window.SVGPathSegMovetoAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"},window.SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegMovetoAbs.prototype.clone=function(){return new window.SVGPathSegMovetoAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegMovetoRel=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_MOVETO_REL,"m",t),this._x=e,this._y=i},window.SVGPathSegMovetoRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"},window.SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegMovetoRel.prototype.clone=function(){return new window.SVGPathSegMovetoRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoAbs=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_ABS,"L",t),this._x=e,this._y=i},window.SVGPathSegLinetoAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"},window.SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegLinetoAbs.prototype.clone=function(){return new window.SVGPathSegLinetoAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegLinetoAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoRel=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_REL,"l",t),this._x=e,this._y=i},window.SVGPathSegLinetoRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"},window.SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegLinetoRel.prototype.clone=function(){return new window.SVGPathSegLinetoRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicAbs=function(t,e,i,n,r,a,o){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",t),this._x=e,this._y=i,this._x1=n,this._y1=r,this._x2=a,this._y2=o},window.SVGPathSegCurvetoCubicAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"},window.SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicRel=function(t,e,i,n,r,a,o){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",t),this._x=e,this._y=i,this._x1=n,this._y1=r,this._x2=a,this._y2=o},window.SVGPathSegCurvetoCubicRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"},window.SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticAbs=function(t,e,i,n,r){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",t),this._x=e,this._y=i,this._x1=n,this._y1=r},window.SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"},window.SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticRel=function(t,e,i,n,r){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",t),this._x=e,this._y=i,this._x1=n,this._y1=r},window.SVGPathSegCurvetoQuadraticRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"},window.SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcAbs=function(t,e,i,n,r,a,o,s){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_ARC_ABS,"A",t),this._x=e,this._y=i,this._r1=n,this._r2=r,this._angle=a,this._largeArcFlag=o,this._sweepFlag=s},window.SVGPathSegArcAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"},window.SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},window.SVGPathSegArcAbs.prototype.clone=function(){return new window.SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(window.SVGPathSegArcAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(t){this._r1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(t){this._r2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(t){this._largeArcFlag=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(t){this._sweepFlag=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcRel=function(t,e,i,n,r,a,o,s){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_ARC_REL,"a",t),this._x=e,this._y=i,this._r1=n,this._r2=r,this._angle=a,this._largeArcFlag=o,this._sweepFlag=s},window.SVGPathSegArcRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"},window.SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},window.SVGPathSegArcRel.prototype.clone=function(){return new window.SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(window.SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(t){this._r1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(t){this._r2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(t){this._largeArcFlag=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(t){this._sweepFlag=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalAbs=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",t),this._x=e},window.SVGPathSegLinetoHorizontalAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"},window.SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},window.SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new window.SVGPathSegLinetoHorizontalAbs(void 0,this._x)},Object.defineProperty(window.SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalRel=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",t),this._x=e},window.SVGPathSegLinetoHorizontalRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"},window.SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},window.SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new window.SVGPathSegLinetoHorizontalRel(void 0,this._x)},Object.defineProperty(window.SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalAbs=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",t),this._y=e},window.SVGPathSegLinetoVerticalAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"},window.SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},window.SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new window.SVGPathSegLinetoVerticalAbs(void 0,this._y)},Object.defineProperty(window.SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalRel=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",t),this._y=e},window.SVGPathSegLinetoVerticalRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"},window.SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},window.SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new window.SVGPathSegLinetoVerticalRel(void 0,this._y)},Object.defineProperty(window.SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothAbs=function(t,e,i,n,r){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",t),this._x=e,this._y=i,this._x2=n,this._y2=r},window.SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"},window.SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothRel=function(t,e,i,n,r){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",t),this._x=e,this._y=i,this._x2=n,this._y2=r},window.SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"},window.SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothAbs=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",t),this._x=e,this._y=i},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothRel=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",t),this._x=e,this._y=i},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new window.SVGPathSegClosePath(void 0)},window.SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(t,e){return new window.SVGPathSegMovetoAbs(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegMovetoRel=function(t,e){return new window.SVGPathSegMovetoRel(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(t,e){return new window.SVGPathSegLinetoAbs(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegLinetoRel=function(t,e){return new window.SVGPathSegLinetoRel(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(t,e,i,n,r,a){return new window.SVGPathSegCurvetoCubicAbs(void 0,t,e,i,n,r,a)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(t,e,i,n,r,a){return new window.SVGPathSegCurvetoCubicRel(void 0,t,e,i,n,r,a)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(t,e,i,n){return new window.SVGPathSegCurvetoQuadraticAbs(void 0,t,e,i,n)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(t,e,i,n){return new window.SVGPathSegCurvetoQuadraticRel(void 0,t,e,i,n)},window.SVGPathElement.prototype.createSVGPathSegArcAbs=function(t,e,i,n,r,a,o){return new window.SVGPathSegArcAbs(void 0,t,e,i,n,r,a,o)},window.SVGPathElement.prototype.createSVGPathSegArcRel=function(t,e,i,n,r,a,o){return new window.SVGPathSegArcRel(void 0,t,e,i,n,r,a,o)},window.SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(t){return new window.SVGPathSegLinetoHorizontalAbs(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(t){return new window.SVGPathSegLinetoHorizontalRel(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(t){return new window.SVGPathSegLinetoVerticalAbs(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(t){return new window.SVGPathSegLinetoVerticalRel(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(t,e,i,n){return new window.SVGPathSegCurvetoCubicSmoothAbs(void 0,t,e,i,n)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(t,e,i,n){return new window.SVGPathSegCurvetoCubicSmoothRel(void 0,t,e,i,n)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(t,e){return new window.SVGPathSegCurvetoQuadraticSmoothAbs(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(t,e){return new window.SVGPathSegCurvetoQuadraticSmoothRel(void 0,t,e)},"getPathSegAtLength"in window.SVGPathElement.prototype||(window.SVGPathElement.prototype.getPathSegAtLength=function(t){if(void 0===t||!isFinite(t))throw"Invalid arguments.";var e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d",this.getAttribute("d"));var i=e.pathSegList.numberOfItems-1;if(i<=0)return 0;do{if(e.pathSegList.removeItem(i),t>e.getTotalLength())break;i--}while(0<i);return i})),"SVGPathSegList"in window||(window.SVGPathSegList=function(t){this._pathElement=t,this._list=this._parsePath(this._pathElement.getAttribute("d")),this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]},this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},window.SVGPathSegList.prototype.classname="SVGPathSegList",Object.defineProperty(window.SVGPathSegList.prototype,"numberOfItems",{get:function(){return this._checkPathSynchronizedToList(),this._list.length},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"pathSegList",{get:function(){return this._pathSegList||(this._pathSegList=new window.SVGPathSegList(this)),this._pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),window.SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())},window.SVGPathSegList.prototype._updateListFromPathMutations=function(t){if(this._pathElement){var e=!1;t.forEach(function(t){"d"==t.attributeName&&(e=!0)}),e&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}},window.SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect(),this._pathElement.setAttribute("d",window.SVGPathSegList._pathSegArrayAsString(this._list)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},window.SVGPathSegList.prototype.segmentChanged=function(t){this._writeListToPath()},window.SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList(),this._list.forEach(function(t){t._owningPathSegList=null}),this._list=[],this._writeListToPath()},window.SVGPathSegList.prototype.initialize=function(t){return this._checkPathSynchronizedToList(),this._list=[t],(t._owningPathSegList=this)._writeListToPath(),t},window.SVGPathSegList.prototype._checkValidIndex=function(t){if(isNaN(t)||t<0||t>=this.numberOfItems)throw"INDEX_SIZE_ERR"},window.SVGPathSegList.prototype.getItem=function(t){return this._checkPathSynchronizedToList(),this._checkValidIndex(t),this._list[t]},window.SVGPathSegList.prototype.insertItemBefore=function(t,e){return this._checkPathSynchronizedToList(),e>this.numberOfItems&&(e=this.numberOfItems),t._owningPathSegList&&(t=t.clone()),this._list.splice(e,0,t),(t._owningPathSegList=this)._writeListToPath(),t},window.SVGPathSegList.prototype.replaceItem=function(t,e){return this._checkPathSynchronizedToList(),t._owningPathSegList&&(t=t.clone()),this._checkValidIndex(e),((this._list[e]=t)._owningPathSegList=this)._writeListToPath(),t},window.SVGPathSegList.prototype.removeItem=function(t){this._checkPathSynchronizedToList(),this._checkValidIndex(t);var e=this._list[t];return this._list.splice(t,1),this._writeListToPath(),e},window.SVGPathSegList.prototype.appendItem=function(t){return this._checkPathSynchronizedToList(),t._owningPathSegList&&(t=t.clone()),this._list.push(t),(t._owningPathSegList=this)._writeListToPath(),t},window.SVGPathSegList._pathSegArrayAsString=function(t){var e="",i=!0;return t.forEach(function(t){i?(i=!1,e+=t._asPathString()):e+=" "+t._asPathString()}),e},window.SVGPathSegList.prototype._parsePath=function(t){if(!t||0==t.length)return[];var n=this,e=function(){this.pathSegList=[]};e.prototype.appendSegment=function(t){this.pathSegList.push(t)};var i=function(t){this._string=t,this._currentIndex=0,this._endIndex=this._string.length,this._previousCommand=window.SVGPathSeg.PATHSEG_UNKNOWN,this._skipOptionalSpaces()};i.prototype._isCurrentSpace=function(){var t=this._string[this._currentIndex];return t<=" "&&(" "==t||"\n"==t||"\t"==t||"\r"==t||"\f"==t)},i.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex},i.prototype._skipOptionalSpacesOrDelimiter=function(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)&&(this._currentIndex++,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)},i.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex},i.prototype.peekSegmentType=function(){var t=this._string[this._currentIndex];return this._pathSegTypeFromChar(t)},i.prototype._pathSegTypeFromChar=function(t){switch(t){case"Z":case"z":return window.SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return window.SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return window.SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return window.SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return window.SVGPathSeg.PATHSEG_LINETO_REL;case"C":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return window.SVGPathSeg.PATHSEG_ARC_ABS;case"a":return window.SVGPathSeg.PATHSEG_ARC_REL;case"H":return window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return window.SVGPathSeg.PATHSEG_UNKNOWN}},i.prototype._nextCommandHelper=function(t,e){return("+"==t||"-"==t||"."==t||"0"<=t&&t<="9")&&e!=window.SVGPathSeg.PATHSEG_CLOSEPATH?e==window.SVGPathSeg.PATHSEG_MOVETO_ABS?window.SVGPathSeg.PATHSEG_LINETO_ABS:e==window.SVGPathSeg.PATHSEG_MOVETO_REL?window.SVGPathSeg.PATHSEG_LINETO_REL:e:window.SVGPathSeg.PATHSEG_UNKNOWN},i.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var t=this.peekSegmentType();return t==window.SVGPathSeg.PATHSEG_MOVETO_ABS||t==window.SVGPathSeg.PATHSEG_MOVETO_REL},i.prototype._parseNumber=function(){var t=0,e=0,i=1,n=0,r=1,a=1,o=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,r=-1),!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||"9"<this._string.charAt(this._currentIndex))&&"."!=this._string.charAt(this._currentIndex))){for(var s=this._currentIndex;this._currentIndex<this._endIndex&&"0"<=this._string.charAt(this._currentIndex)&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=s)for(var c=this._currentIndex-1,d=1;s<=c;)e+=d*(this._string.charAt(c--)-"0"),d*=10;if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){if(this._currentIndex++,this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||"9"<this._string.charAt(this._currentIndex))return;for(;this._currentIndex<this._endIndex&&"0"<=this._string.charAt(this._currentIndex)&&this._string.charAt(this._currentIndex)<="9";)i*=10,n+=(this._string.charAt(this._currentIndex)-"0")/i,this._currentIndex+=1}if(this._currentIndex!=o&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){if(this._currentIndex++,"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,a=-1),this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||"9"<this._string.charAt(this._currentIndex))return;for(;this._currentIndex<this._endIndex&&"0"<=this._string.charAt(this._currentIndex)&&this._string.charAt(this._currentIndex)<="9";)t*=10,t+=this._string.charAt(this._currentIndex)-"0",this._currentIndex++}var l=e+n;if(l*=r,t&&(l*=Math.pow(10,a*t)),o!=this._currentIndex)return this._skipOptionalSpacesOrDelimiter(),l}},i.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var t=!1,e=this._string.charAt(this._currentIndex++);if("0"==e)t=!1;else{if("1"!=e)return;t=!0}return this._skipOptionalSpacesOrDelimiter(),t}},i.prototype.parseSegment=function(){var t=this._string[this._currentIndex],e=this._pathSegTypeFromChar(t);if(e==window.SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==window.SVGPathSeg.PATHSEG_UNKNOWN)return null;if((e=this._nextCommandHelper(t,this._previousCommand))==window.SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;switch(this._previousCommand=e){case window.SVGPathSeg.PATHSEG_MOVETO_REL:return new window.SVGPathSegMovetoRel(n,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_MOVETO_ABS:return new window.SVGPathSegMovetoAbs(n,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_REL:return new window.SVGPathSegLinetoRel(n,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_ABS:return new window.SVGPathSegLinetoAbs(n,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new window.SVGPathSegLinetoHorizontalRel(n,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new window.SVGPathSegLinetoHorizontalAbs(n,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new window.SVGPathSegLinetoVerticalRel(n,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new window.SVGPathSegLinetoVerticalAbs(n,this._parseNumber());case window.SVGPathSeg.PATHSEG_CLOSEPATH:return this._skipOptionalSpaces(),new window.SVGPathSegClosePath(n);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var i={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoCubicRel(n,i.x,i.y,i.x1,i.y1,i.x2,i.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:return i={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoCubicAbs(n,i.x,i.y,i.x1,i.y1,i.x2,i.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:return i={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoCubicSmoothRel(n,i.x,i.y,i.x2,i.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:return i={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoCubicSmoothAbs(n,i.x,i.y,i.x2,i.y2);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:return i={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoQuadraticRel(n,i.x,i.y,i.x1,i.y1);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:return i={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoQuadraticAbs(n,i.x,i.y,i.x1,i.y1);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new window.SVGPathSegCurvetoQuadraticSmoothRel(n,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new window.SVGPathSegCurvetoQuadraticSmoothAbs(n,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_ARC_REL:return i={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegArcRel(n,i.x,i.y,i.x1,i.y1,i.arcAngle,i.arcLarge,i.arcSweep);case window.SVGPathSeg.PATHSEG_ARC_ABS:return i={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegArcAbs(n,i.x,i.y,i.x1,i.y1,i.arcAngle,i.arcLarge,i.arcSweep);default:throw"Unknown path seg type."}};var r=new e,a=new i(t);if(!a.initialCommandIsMoveTo())return[];for(;a.hasMoreData();){var o=a.parseSegment();if(!o)return[];r.appendSegment(o)}return r.pathSegList}),String.prototype.padEnd||(String.prototype.padEnd=function(t,e){return t>>=0,e=String(void 0!==e?e:" "),this.length>t?String(this):((t-=this.length)>e.length&&(e+=e.repeat(t/e.length)),String(this)+e.slice(0,t))}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a])}return i},writable:!0,configurable:!0}),(n.prototype.axis=function(){}).labels=function(e){var i=this.internal;arguments.length&&(Object.keys(e).forEach(function(t){i.axis.setLabelText(t,e[t])}),i.axis.updateLabels())},n.prototype.axis.max=function(t){var e=this.internal,i=e.config;if(!arguments.length)return{x:i.axis_x_max,y:i.axis_y_max,y2:i.axis_y2_max};"object"===s(t)?(C(t.x)&&(i.axis_x_max=t.x),C(t.y)&&(i.axis_y_max=t.y),C(t.y2)&&(i.axis_y2_max=t.y2)):i.axis_y_max=i.axis_y2_max=t,e.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})},n.prototype.axis.min=function(t){var e=this.internal,i=e.config;if(!arguments.length)return{x:i.axis_x_min,y:i.axis_y_min,y2:i.axis_y2_min};"object"===s(t)?(C(t.x)&&(i.axis_x_min=t.x),C(t.y)&&(i.axis_y_min=t.y),C(t.y2)&&(i.axis_y2_min=t.y2)):i.axis_y_min=i.axis_y2_min=t,e.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})},n.prototype.axis.range=function(t){if(!arguments.length)return{max:this.axis.max(),min:this.axis.min()};k(t.max)&&this.axis.max(t.max),k(t.min)&&this.axis.min(t.min)},n.prototype.axis.types=function(t){var e=this.internal;if(void 0===t)return{y:e.config.axis_y_type,y2:e.config.axis_y2_type};k(t.y)&&(e.config.axis_y_type=t.y),k(t.y2)&&(e.config.axis_y2_type=t.y2),e.updateScales(),e.redraw()},n.prototype.category=function(t,e){var i=this.internal,n=i.config;return 1<arguments.length&&(n.axis_x_categories[t]=e,i.redraw()),n.axis_x_categories[t]},n.prototype.categories=function(t){var e=this.internal,i=e.config;return arguments.length&&(i.axis_x_categories=t,e.redraw()),i.axis_x_categories},n.prototype.resize=function(t){var e=this.internal.config;e.size_width=t?t.width:null,e.size_height=t?t.height:null,this.flush()},n.prototype.flush=function(){this.internal.updateAndRedraw({withLegend:!0,withTransition:!1,withTransitionForTransform:!1})},n.prototype.destroy=function(){var e=this.internal;if(window.clearInterval(e.intervalForObserveInserted),void 0!==e.resizeTimeout&&window.clearTimeout(e.resizeTimeout),window.detachEvent)window.detachEvent("onresize",e.resizeIfElementDisplayed);else if(window.removeEventListener)window.removeEventListener("resize",e.resizeIfElementDisplayed);else{var t=window.onresize;t&&t.add&&t.remove&&t.remove(e.resizeFunction)}return e.resizeFunction.remove(),e.unbindWindowFocus(),e.selectChart.classed("c3",!1).html(""),Object.keys(e).forEach(function(t){e[t]=null}),null},n.prototype.color=function(t){return this.internal.color(t)},(n.prototype.data=function(e){var t=this.internal.data.targets;return void 0===e?t:t.filter(function(t){return 0<=[].concat(e).indexOf(t.id)})}).shown=function(t){return this.internal.filterTargetsToShow(this.data(t))},n.prototype.data.values=function(t){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],e=null;if(t){var i=this.data(t);i&&h(i)&&(e=i.reduce(function(t,e){var i=e.values.map(function(t){return t.value});return n?t=t.concat(i):t.push(i),t},[]))}return e},n.prototype.data.names=function(t){return this.internal.clearLegendItemTextBoxCache(),this.internal.updateDataAttributes("names",t)},n.prototype.data.colors=function(t){return this.internal.updateDataAttributes("colors",t)},n.prototype.data.axes=function(t){return this.internal.updateDataAttributes("axes",t)},n.prototype.data.stackNormalized=function(t){if(void 0===t)return this.internal.isStackNormalized();this.internal.config.data_stack_normalize=!!t,this.internal.redraw()},(n.prototype.donut=function(){}).padAngle=function(t){if(void 0===t)return this.internal.config.donut_padAngle;this.internal.config.donut_padAngle=t,this.flush()},n.prototype.flow=function(t){var r,e,i,n,a,o,s,c=this.internal,d=[],l=c.getMaxDataCount(),u=0,h=0;if(t.json)e=c.convertJsonToData(t.json,t.keys);else if(t.rows)e=c.convertRowsToData(t.rows);else{if(!t.columns)return;e=c.convertColumnsToData(t.columns)}r=c.convertDataToTargets(e,!0),c.data.targets.forEach(function(t){var e,i,n=!1;for(e=0;e<r.length;e++)if(t.id===r[e].id){for(n=!0,t.values[t.values.length-1]&&(h=t.values[t.values.length-1].index+1),u=r[e].values.length,i=0;i<u;i++)r[e].values[i].index=h+i,c.isTimeSeries()||(r[e].values[i].x=h+i);t.values=t.values.concat(r[e].values),r.splice(e,1);break}n||d.push(t.id)}),c.data.targets.forEach(function(t){var e,i;for(e=0;e<d.length;e++)if(t.id===d[e])for(h=t.values[t.values.length-1].index+1,i=0;i<u;i++)t.values.push({id:t.id,index:h+i,x:c.isTimeSeries()?c.getOtherTargetX(h+i):h+i,value:null})}),c.data.targets.length&&r.forEach(function(t){var e,i=[];for(e=c.data.targets[0].values[0].index;e<h;e++)i.push({id:t.id,index:e,x:c.isTimeSeries()?c.getOtherTargetX(e):e,value:null});t.values.forEach(function(t){t.index+=h,c.isTimeSeries()||(t.x+=h)}),t.values=i.concat(t.values)}),c.data.targets=c.data.targets.concat(r),c.getMaxDataCount(),a=(n=c.data.targets[0]).values[0],k(t.to)?(u=0,s=c.isTimeSeries()?c.parseDate(t.to):t.to,n.values.forEach(function(t){t.x<s&&u++})):k(t.length)&&(u=t.length),l?1===l&&c.isTimeSeries()&&(o=(n.values[n.values.length-1].x-a.x)/2,i=[new Date(+a.x-o),new Date(+a.x+o)],c.updateXDomain(null,!0,!0,!1,i)):(o=c.isTimeSeries()?1<n.values.length?n.values[n.values.length-1].x-a.x:a.x-c.getXDomain(c.data.targets)[0]:1,i=[a.x-o,a.x],c.updateXDomain(null,!0,!0,!1,i)),c.updateTargets(c.data.targets),c.redraw({flow:{index:a.index,length:u,duration:C(t.duration)?t.duration:c.config.transition_duration,done:t.done,orgDataCount:l},withLegend:!0,withTransition:1<l,withTrimXDomain:!1,withUpdateXAxis:!0})},l.prototype.generateFlow=function(G){var E=this,O=E.config,I=E.d3;return function(){var t,e,n,r,a,o,s,c,d,l,i=G.targets,u=G.flow,h=G.drawBar,g=G.drawLine,p=G.drawArea,f=G.cx,_=G.cy,x=G.xv,y=G.xForText,m=G.yForText,S=G.duration,w=u.index,v=u.length,b=E.getValueOnIndex(E.data.targets[0].values,w),T=E.getValueOnIndex(E.data.targets[0].values,w+v),A=E.x.domain(),P=u.duration||S,C=u.done||function(){},L=E.generateWait();E.flowing=!0,E.data.targets.forEach(function(t){t.values.splice(0,v)}),e=E.updateXDomain(i,!0,!0),E.updateXGrid&&E.updateXGrid(!0),n=E.xgrid||I.selectAll([]),r=E.xgridLines||I.selectAll([]),a=E.mainRegion||I.selectAll([]),o=E.mainText||I.selectAll([]),s=E.mainBar||I.selectAll([]),c=E.mainLine||I.selectAll([]),d=E.mainArea||I.selectAll([]),l=E.mainCircle||I.selectAll([]),t="translate("+(u.orgDataCount?1===u.orgDataCount||(b&&b.x)===(T&&T.x)?E.x(A[0])-E.x(e[0]):E.isTimeSeries()?E.x(A[0])-E.x(e[0]):E.x(b.x)-E.x(T.x):1!==E.data.targets[0].values.length?E.x(A[0])-E.x(e[0]):E.isTimeSeries()?(b=E.getValueOnIndex(E.data.targets[0].values,0),T=E.getValueOnIndex(E.data.targets[0].values,E.data.targets[0].values.length-1),E.x(b.x)-E.x(T.x)):R(e)/2)+",0) scale("+R(A)/R(e)+",1)",E.hideXGridFocus();var V=I.transition().ease(I.easeLinear).duration(P);L.add(E.xAxis(E.axes.x,V)),L.add(s.transition(V).attr("transform",t)),L.add(c.transition(V).attr("transform",t)),L.add(d.transition(V).attr("transform",t)),L.add(l.transition(V).attr("transform",t)),L.add(o.transition(V).attr("transform",t)),L.add(a.filter(E.isRegionOnX).transition(V).attr("transform",t)),L.add(n.transition(V).attr("transform",t)),L.add(r.transition(V).attr("transform",t)),L(function(){var t,e=[],i=[];if(v){for(t=0;t<v;t++)e.push("."+Y.shape+"-"+(w+t)),i.push("."+Y.text+"-"+(w+t));E.svg.selectAll("."+Y.shapes).selectAll(e).remove(),E.svg.selectAll("."+Y.texts).selectAll(i).remove(),E.svg.select("."+Y.xgrid).remove()}n.attr("transform",null).attr("x1",E.xgridAttr.x1).attr("x2",E.xgridAttr.x2).attr("y1",E.xgridAttr.y1).attr("y2",E.xgridAttr.y2).style("opacity",E.xgridAttr.opacity),r.attr("transform",null),r.select("line").attr("x1",O.axis_rotated?0:x).attr("x2",O.axis_rotated?E.width:x),r.select("text").attr("x",O.axis_rotated?E.width:0).attr("y",x),s.attr("transform",null).attr("d",h),c.attr("transform",null).attr("d",g),d.attr("transform",null).attr("d",p),l.attr("transform",null).attr("cx",f).attr("cy",_),o.attr("transform",null).attr("x",y).attr("y",m).style("fill-opacity",E.opacityForText.bind(E)),a.attr("transform",null),a.filter(E.isRegionOnX).attr("x",E.regionX.bind(E)).attr("width",E.regionWidth.bind(E)),C(),E.flowing=!1})}},n.prototype.focus=function(e){var t,i=this.internal;e=i.mapToTargetIds(e),t=i.svg.selectAll(i.selectorTargets(e.filter(i.isTargetToShow,i))),this.revert(),this.defocus(),t.classed(Y.focused,!0).classed(Y.defocused,!1),i.hasArcType()&&i.expandArc(e),i.toggleFocusLegend(e,!0),i.focusedTargetIds=e,i.defocusedTargetIds=i.defocusedTargetIds.filter(function(t){return e.indexOf(t)<0})},n.prototype.defocus=function(e){var t=this.internal;e=t.mapToTargetIds(e),t.svg.selectAll(t.selectorTargets(e.filter(t.isTargetToShow,t))).classed(Y.focused,!1).classed(Y.defocused,!0),t.hasArcType()&&t.unexpandArc(e),t.toggleFocusLegend(e,!1),t.focusedTargetIds=t.focusedTargetIds.filter(function(t){return e.indexOf(t)<0}),t.defocusedTargetIds=e},n.prototype.revert=function(t){var e=this.internal;t=e.mapToTargetIds(t),e.svg.selectAll(e.selectorTargets(t)).classed(Y.focused,!1).classed(Y.defocused,!1),e.hasArcType()&&e.unexpandArc(t),e.config.legend_show&&(e.showLegend(t.filter(e.isLegendToShow.bind(e))),e.legend.selectAll(e.selectorLegends(t)).filter(function(){return e.d3.select(this).classed(Y.legendItemFocused)}).classed(Y.legendItemFocused,!1)),e.focusedTargetIds=[],e.defocusedTargetIds=[]},(n.prototype.xgrids=function(t){var e=this.internal,i=e.config;return t&&(i.grid_x_lines=t,e.redrawWithoutRescale()),i.grid_x_lines}).add=function(t){var e=this.internal;return this.xgrids(e.config.grid_x_lines.concat(t||[]))},n.prototype.xgrids.remove=function(t){this.internal.removeGridLines(t,!0)},(n.prototype.ygrids=function(t){var e=this.internal,i=e.config;return t&&(i.grid_y_lines=t,e.redrawWithoutRescale()),i.grid_y_lines}).add=function(t){var e=this.internal;return this.ygrids(e.config.grid_y_lines.concat(t||[]))},n.prototype.ygrids.remove=function(t){this.internal.removeGridLines(t,!1)},n.prototype.groups=function(t){var e=this.internal,i=e.config;return v(t)||(i.data_groups=t,e.redraw()),i.data_groups},(n.prototype.legend=function(){}).show=function(t){var e=this.internal;e.showLegend(e.mapToTargetIds(t)),e.updateAndRedraw({withLegend:!0})},n.prototype.legend.hide=function(t){var e=this.internal;e.hideLegend(e.mapToTargetIds(t)),e.updateAndRedraw({withLegend:!1})},n.prototype.load=function(e){var t=this.internal,i=t.config;e.xs&&t.addXs(e.xs),"names"in e&&n.prototype.data.names.bind(this)(e.names),"classes"in e&&Object.keys(e.classes).forEach(function(t){i.data_classes[t]=e.classes[t]}),"categories"in e&&t.isCategorized()&&(i.axis_x_categories=e.categories),"axes"in e&&Object.keys(e.axes).forEach(function(t){i.data_axes[t]=e.axes[t]}),"colors"in e&&Object.keys(e.colors).forEach(function(t){i.data_colors[t]=e.colors[t]}),"cacheIds"in e&&t.hasCaches(e.cacheIds)?t.load(t.getCaches(e.cacheIds),e.done):e.unload?t.unload(t.mapToTargetIds(!0===e.unload?null:e.unload),function(){t.loadFromArgs(e)}):t.loadFromArgs(e)},n.prototype.unload=function(t){var e=this.internal;(t=t||{})instanceof Array?t={ids:t}:"string"==typeof t&&(t={ids:[t]}),e.unload(e.mapToTargetIds(t.ids),function(){e.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),t.done&&t.done()})},(n.prototype.pie=function(){}).padAngle=function(t){if(void 0===t)return this.internal.config.pie_padAngle;this.internal.config.pie_padAngle=t,this.flush()},(n.prototype.regions=function(t){var e=this.internal,i=e.config;return t&&(i.regions=t,e.redrawWithoutRescale()),i.regions}).add=function(t){var e=this.internal,i=e.config;return t&&(i.regions=i.regions.concat(t),e.redrawWithoutRescale()),i.regions},n.prototype.regions.remove=function(t){var e,i,n,r=this.internal,a=r.config;return e=B(t=t||{},"duration",a.transition_duration),i=B(t,"classes",[Y.region]),n=r.main.select("."+Y.regions).selectAll(i.map(function(t){return"."+t})),(e?n.transition().duration(e):n).style("opacity",0).remove(),a.regions=a.regions.filter(function(t){var e=!1;return!t.class||(t.class.split(" ").forEach(function(t){0<=i.indexOf(t)&&(e=!0)}),!e)}),a.regions},n.prototype.selected=function(t){var e=this.internal,i=e.d3;return e.main.selectAll("."+Y.shapes+e.getTargetSelectorSuffix(t)).selectAll("."+Y.shape).filter(function(){return i.select(this).classed(Y.SELECTED)}).nodes().map(function(t){var e=t.__data__;return e.data?e.data:e})},n.prototype.select=function(c,d,l){var u=this.internal,h=u.d3,g=u.config;g.data_selection_enabled&&u.main.selectAll("."+Y.shapes).selectAll("."+Y.shape).each(function(t,e){var i=h.select(this),n=t.data?t.data.id:t.id,r=u.getToggle(this,t).bind(u),a=g.data_selection_grouped||!c||0<=c.indexOf(n),o=!d||0<=d.indexOf(e),s=i.classed(Y.SELECTED);i.classed(Y.line)||i.classed(Y.area)||(a&&o?g.data_selection_isselectable(t)&&!s&&r(!0,i.classed(Y.SELECTED,!0),t,e):k(l)&&l&&s&&r(!1,i.classed(Y.SELECTED,!1),t,e))})},n.prototype.unselect=function(c,d){var l=this.internal,u=l.d3,h=l.config;h.data_selection_enabled&&l.main.selectAll("."+Y.shapes).selectAll("."+Y.shape).each(function(t,e){var i=u.select(this),n=t.data?t.data.id:t.id,r=l.getToggle(this,t).bind(l),a=h.data_selection_grouped||!c||0<=c.indexOf(n),o=!d||0<=d.indexOf(e),s=i.classed(Y.SELECTED);i.classed(Y.line)||i.classed(Y.area)||a&&o&&h.data_selection_isselectable(t)&&s&&r(!1,i.classed(Y.SELECTED,!1),t,e)})},n.prototype.show=function(t,e){var i,n=this.internal;t=n.mapToTargetIds(t),e=e||{},n.removeHiddenTargetIds(t),(i=n.svg.selectAll(n.selectorTargets(t))).transition().style("display","initial","important").style("opacity",1,"important").call(n.endall,function(){i.style("opacity",null).style("opacity",1)}),e.withLegend&&n.showLegend(t),n.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0})},n.prototype.hide=function(t,e){var i,n=this.internal;t=n.mapToTargetIds(t),e=e||{},n.addHiddenTargetIds(t),(i=n.svg.selectAll(n.selectorTargets(t))).transition().style("opacity",0,"important").call(n.endall,function(){i.style("opacity",null).style("opacity",0),i.style("display","none")}),e.withLegend&&n.hideLegend(t),n.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0})},n.prototype.toggle=function(t,e){var i=this,n=this.internal;n.mapToTargetIds(t).forEach(function(t){n.isTargetToShow(t)?i.hide(t,e):i.show(t,e)})},(n.prototype.tooltip=function(){}).show=function(e){var t,i,n=this.internal,r={};r=e.mouse?e.mouse:(e.data?i=e.data:void 0!==e.x&&(t=e.id?n.data.targets.filter(function(t){return t.id===e.id}):n.data.targets,i=n.filterByX(t,e.x).slice(0,1)[0]),i?n.getMousePosition(i):null),n.dispatchEvent("mousemove",r),n.config.tooltip_onshow.call(n,i)},n.prototype.tooltip.hide=function(){this.internal.dispatchEvent("mouseout",0),this.internal.config.tooltip_onhide.call(this)},n.prototype.transform=function(t,e){var i=this.internal,n=0<=["pie","donut"].indexOf(t)?{withTransform:!0}:null;i.transformTo(e,t,n)},l.prototype.transformTo=function(t,e,i){var n=this,r=!n.hasArcType(),a=i||{withTransitionForAxis:r};a.withTransitionForTransform=!1,n.transiting=!1,n.setTargetType(t,e),n.updateTargets(n.data.targets),n.updateAndRedraw(a)},n.prototype.x=function(t){var e=this.internal;return arguments.length&&(e.updateTargetX(e.data.targets,t),e.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})),e.data.xs},n.prototype.xs=function(t){var e=this.internal;return arguments.length&&(e.updateTargetXs(e.data.targets,t),e.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})),e.data.xs},(n.prototype.zoom=function(t){var e=this.internal;return t?(e.isTimeSeries()&&(t=t.map(function(t){return e.parseDate(t)})),e.config.subchart_show?e.brush.selectionAsValue(t,!0):(e.updateXDomain(null,!0,!1,!1,t),e.redraw({withY:e.config.zoom_rescale,withSubchart:!1})),e.config.zoom_onzoom.call(this,e.x.orgDomain()),t):e.x.domain()}).enable=function(t){var e=this.internal;e.config.zoom_enabled=t,e.updateAndRedraw()},n.prototype.unzoom=function(){var t=this.internal;t.config.subchart_show?t.brush.clear():(t.updateXDomain(null,!0,!1,!1,t.subX.domain()),t.redraw({withY:t.config.zoom_rescale,withSubchart:!1}))},n.prototype.zoom.max=function(t){var e=this.internal,i=e.config,n=e.d3;if(0!==t&&!t)return i.zoom_x_max;i.zoom_x_max=n.max([e.orgXDomain[1],t])},n.prototype.zoom.min=function(t){var e=this.internal,i=e.config,n=e.d3;if(0!==t&&!t)return i.zoom_x_min;i.zoom_x_min=n.min([e.orgXDomain[0],t])},n.prototype.zoom.range=function(t){if(!arguments.length)return{max:this.domain.max(),min:this.domain.min()};k(t.max)&&this.domain.max(t.max),k(t.min)&&this.domain.min(t.min)},l.prototype.initPie=function(){var t=this,e=t.d3;t.pie=e.pie().padAngle(this.getPadAngle.bind(this)).value(function(t){return t.values.reduce(function(t,e){return t+e.value},0)});var i=t.getOrderFunction();if(i&&(t.isOrderAsc()||t.isOrderDesc())){var n=i;i=function(t,e){return-1*n(t,e)}}t.pie.sort(i||null)},l.prototype.updateRadius=function(){var t=this,e=t.config,i=e.gauge_width||e.donut_width,n=t.filterTargetsToShow(t.data.targets).length*t.config.gauge_arcs_minWidth;t.radiusExpanded=Math.min(t.arcWidth,t.arcHeight)/2*(t.hasType("gauge")?.85:1),t.radius=.95*t.radiusExpanded,t.innerRadiusRatio=i?(t.radius-i)/t.radius:.6,t.innerRadius=t.hasType("donut")||t.hasType("gauge")?t.radius*t.innerRadiusRatio:0,t.gaugeArcWidth=i||(n<=t.radius-t.innerRadius?t.radius-t.innerRadius:n<=t.radius?n:t.radius)},l.prototype.getPadAngle=function(){return this.hasType("pie")?this.config.pie_padAngle||0:this.hasType("donut")&&this.config.donut_padAngle||0},l.prototype.updateArc=function(){var t=this;t.svgArc=t.getSvgArc(),t.svgArcExpanded=t.getSvgArcExpanded(),t.svgArcExpandedSub=t.getSvgArcExpanded(.98)},l.prototype.updateAngle=function(e){var t,i,n,r,a=this,o=a.config,s=!1,c=0;return o?(a.pie(a.filterTargetsToShow(a.data.targets)).forEach(function(t){s||t.data.id!==e.data.id||(s=!0,(e=t).index=c),c++}),isNaN(e.startAngle)&&(e.startAngle=0),isNaN(e.endAngle)&&(e.endAngle=e.startAngle),a.isGaugeType(e.data)&&(t=o.gauge_min,i=o.gauge_max,n=Math.PI*(o.gauge_fullCircle?2:1)/(i-t),r=e.value<t?0:e.value<i?e.value-t:i-t,e.startAngle=o.gauge_startingAngle,e.endAngle=e.startAngle+n*r),s?e:null):null},l.prototype.getSvgArc=function(){var n=this,e=n.hasType("gauge"),i=n.gaugeArcWidth/n.filterTargetsToShow(n.data.targets).length,r=n.d3.arc().outerRadius(function(t){return e?n.radius-i*t.index:n.radius}).innerRadius(function(t){return e?n.radius-i*(t.index+1):n.innerRadius}),t=function(t,e){var i;return e?r(t):(i=n.updateAngle(t))?r(i):"M 0 0"};return t.centroid=r.centroid,t},l.prototype.getSvgArcExpanded=function(e){e=e||1;var i=this,n=i.hasType("gauge"),r=i.gaugeArcWidth/i.filterTargetsToShow(i.data.targets).length,a=Math.min(i.radiusExpanded*e-i.radius,.8*r-100*(1-e)),o=i.d3.arc().outerRadius(function(t){return n?i.radius-r*t.index+a:i.radiusExpanded*e}).innerRadius(function(t){return n?i.radius-r*(t.index+1):i.innerRadius});return function(t){var e=i.updateAngle(t);return e?o(e):"M 0 0"}},l.prototype.getArc=function(t,e,i){return i||this.isArcType(t.data)?this.svgArc(t,e):"M 0 0"},l.prototype.transformForArcLabel=function(t){var e,i,n,r,a,o=this,s=o.config,c=o.updateAngle(t),d="",l=o.hasType("gauge");if(c&&!l)e=this.svgArc.centroid(c),i=isNaN(e[0])?0:e[0],n=isNaN(e[1])?0:e[1],r=Math.sqrt(i*i+n*n),d="translate("+i*(a=o.hasType("donut")&&s.donut_label_ratio?g(s.donut_label_ratio)?s.donut_label_ratio(t,o.radius,r):s.donut_label_ratio:o.hasType("pie")&&s.pie_label_ratio?g(s.pie_label_ratio)?s.pie_label_ratio(t,o.radius,r):s.pie_label_ratio:o.radius&&r?(.375<36/o.radius?1.175-36/o.radius:.8)*o.radius/r:0)+","+n*a+")";else if(c&&l&&1<o.filterTargetsToShow(o.data.targets).length){var u=Math.sin(c.endAngle-Math.PI/2);d="translate("+(i=Math.cos(c.endAngle-Math.PI/2)*(o.radiusExpanded+25))+","+(n=u*(o.radiusExpanded+15-Math.abs(10*u))+3)+")"}return d},l.prototype.getArcRatio=function(t){return this.getRatio("arc",t)},l.prototype.convertToArcData=function(t){return this.addName({id:t.data.id,value:t.value,ratio:this.getRatio("arc",t),index:t.index})},l.prototype.textForArcLabel=function(t){var e,i,n,r,a,o=this;return o.shouldShowArcLabel()?(i=(e=o.updateAngle(t))?e.value:null,n=o.getRatio("arc",e),r=t.data.id,o.hasType("gauge")||o.meetsArcLabelThreshold(n)?(a=o.getArcLabelFormat())?a(i,n,r):o.defaultArcValueFormat(i,n):""):""},l.prototype.textForGaugeMinMax=function(t,e){var i=this.getGaugeLabelExtents();return i?i(t,e):t},l.prototype.expandArc=function(t){var e,i=this;i.transiting?e=window.setInterval(function(){i.transiting||(window.clearInterval(e),0<i.legend.selectAll(".c3-legend-item-focused").size()&&i.expandArc(t))},10):(t=i.mapToTargetIds(t),i.svg.selectAll(i.selectorTargets(t,"."+Y.chartArc)).each(function(t){i.shouldExpand(t.data.id)&&i.d3.select(this).selectAll("path").transition().duration(i.expandDuration(t.data.id)).attr("d",i.svgArcExpanded).transition().duration(2*i.expandDuration(t.data.id)).attr("d",i.svgArcExpandedSub).each(function(t){i.isDonutType(t.data)})}))},l.prototype.unexpandArc=function(t){var e=this;e.transiting||(t=e.mapToTargetIds(t),e.svg.selectAll(e.selectorTargets(t,"."+Y.chartArc)).selectAll("path").transition().duration(function(t){return e.expandDuration(t.data.id)}).attr("d",e.svgArc),e.svg.selectAll("."+Y.arc))},l.prototype.expandDuration=function(t){var e=this.config;return this.isDonutType(t)?e.donut_expand_duration:this.isGaugeType(t)?e.gauge_expand_duration:this.isPieType(t)?e.pie_expand_duration:50},l.prototype.shouldExpand=function(t){var e=this.config;return this.isDonutType(t)&&e.donut_expand||this.isGaugeType(t)&&e.gauge_expand||this.isPieType(t)&&e.pie_expand},l.prototype.shouldShowArcLabel=function(){var t=this.config,e=!0;return this.hasType("donut")?e=t.donut_label_show:this.hasType("pie")&&(e=t.pie_label_show),e},l.prototype.meetsArcLabelThreshold=function(t){var e=this.config;return(this.hasType("donut")?e.donut_label_threshold:e.pie_label_threshold)<=t},l.prototype.getArcLabelFormat=function(){var t=this.config,e=t.pie_label_format;return this.hasType("gauge")?e=t.gauge_label_format:this.hasType("donut")&&(e=t.donut_label_format),e},l.prototype.getGaugeLabelExtents=function(){return this.config.gauge_label_extents},l.prototype.getArcTitle=function(){return this.hasType("donut")?this.config.donut_title:""},l.prototype.updateTargetsForArc=function(t){var e,i=this,n=i.main,r=i.classChartArc.bind(i),a=i.classArcs.bind(i),o=i.classFocus.bind(i);(e=n.select("."+Y.chartArcs).selectAll("."+Y.chartArc).data(i.pie(t)).attr("class",function(t){return r(t)+o(t.data)}).enter().append("g").attr("class",r)).append("g").attr("class",a),e.append("text").attr("dy",i.hasType("gauge")?"-.1em":".35em").style("opacity",0).style("text-anchor","middle").style("pointer-events","none")},l.prototype.initArc=function(){var t=this;t.arcs=t.main.select("."+Y.chart).append("g").attr("class",Y.chartArcs).attr("transform",t.getTranslate("arc")),t.arcs.append("text").attr("class",Y.chartArcsTitle).style("text-anchor","middle").text(t.getArcTitle())},l.prototype.redrawArc=function(t,e,i){var n,r,a,o,l=this,u=l.d3,s=l.config,c=l.main,d=l.hasType("gauge");if(r=(n=c.selectAll("."+Y.arcs).selectAll("."+Y.arc).data(l.arcData.bind(l))).enter().append("path").attr("class",l.classArc.bind(l)).style("fill",function(t){return l.color(t.data)}).style("cursor",function(t){return s.interaction_enabled&&s.data_selection_isselectable(t)?"pointer":null}).each(function(t){l.isGaugeType(t.data)&&(t.startAngle=t.endAngle=s.gauge_startingAngle),this._current=t}).merge(n),d&&(o=(a=c.selectAll("."+Y.arcs).selectAll("."+Y.arcLabelLine).data(l.arcData.bind(l))).enter().append("rect").attr("class",function(t){return Y.arcLabelLine+" "+Y.target+" "+Y.target+"-"+t.data.id}).merge(a),1===l.filterTargetsToShow(l.data.targets).length?o.style("display","none"):o.style("fill",function(t){return l.levelColor?l.levelColor(t.data.values[0].value):l.color(t.data)}).style("display",s.gauge_labelLine_show?"":"none").each(function(t){var e=0,i=0,n=0,r="";if(l.hiddenTargetIds.indexOf(t.data.id)<0){var a=l.updateAngle(t),o=l.gaugeArcWidth/l.filterTargetsToShow(l.data.targets).length*(a.index+1),s=a.endAngle-Math.PI/2,c=l.radius-o,d=s-(0===c?0:1/c);e=l.radiusExpanded-l.radius+o,i=Math.cos(d)*c,n=Math.sin(d)*c,r="rotate("+180*s/Math.PI+", "+i+", "+n+")"}u.select(this).attr("x",i).attr("y",n).attr("width",e).attr("height",2).attr("transform",r).style("stroke-dasharray","0, "+(e+2)+", 0")})),r.attr("transform",function(t){return!l.isGaugeType(t.data)&&i?"scale(0)":""}).on("mouseover",s.interaction_enabled?function(t){var e,i;l.transiting||(e=l.updateAngle(t))&&(i=l.convertToArcData(e),l.expandArc(e.data.id),l.api.focus(e.data.id),l.toggleFocusLegend(e.data.id,!0),l.config.data_onmouseover(i,this))}:null).on("mousemove",s.interaction_enabled?function(t){var e,i=l.updateAngle(t);i&&(e=[l.convertToArcData(i)],l.showTooltip(e,this))}:null).on("mouseout",s.interaction_enabled?function(t){var e,i;l.transiting||(e=l.updateAngle(t))&&(i=l.convertToArcData(e),l.unexpandArc(e.data.id),l.api.revert(),l.revertLegend(),l.hideTooltip(),l.config.data_onmouseout(i,this))}:null).on("click",s.interaction_enabled?function(t,e){var i,n=l.updateAngle(t);n&&(i=l.convertToArcData(n),l.toggleShape&&l.toggleShape(this,i,e),l.config.data_onclick.call(l.api,i,this))}:null).each(function(){l.transiting=!0}).transition().duration(t).attrTween("d",function(i){var n,t=l.updateAngle(i);return t?(isNaN(this._current.startAngle)&&(this._current.startAngle=0),isNaN(this._current.endAngle)&&(this._current.endAngle=this._current.startAngle),n=u.interpolate(this._current,t),this._current=n(0),function(t){if(null===l.config)return"M 0 0";var e=n(t);return e.data=i.data,l.getArc(e,!0)}):function(){return"M 0 0"}}).attr("transform",i?"scale(1)":"").style("fill",function(t){return l.levelColor?l.levelColor(t.data.values[0].value):l.color(t.data.id)}).call(l.endall,function(){l.transiting=!1}),n.exit().transition().duration(e).style("opacity",0).remove(),c.selectAll("."+Y.chartArc).select("text").style("opacity",0).attr("class",function(t){return l.isGaugeType(t.data)?Y.gaugeValue:""}).text(l.textForArcLabel.bind(l)).attr("transform",l.transformForArcLabel.bind(l)).style("font-size",function(t){return l.isGaugeType(t.data)&&1===l.filterTargetsToShow(l.data.targets).length?Math.round(l.radius/5)+"px":""}).transition().duration(t).style("opacity",function(t){return l.isTargetToShow(t.data.id)&&l.isArcType(t.data)?1:0}),c.select("."+Y.chartArcsTitle).style("opacity",l.hasType("donut")||d?1:0),d){var h=0,g=l.arcs.select("g."+Y.chartArcsBackground).selectAll("path."+Y.chartArcsBackground).data(l.data.targets);g.enter().append("path").attr("class",function(t,e){return Y.chartArcsBackground+" "+Y.chartArcsBackground+"-"+e}).merge(g).attr("d",function(t){if(0<=l.hiddenTargetIds.indexOf(t.id))return"M 0 0";var e={data:[{value:s.gauge_max}],startAngle:s.gauge_startingAngle,endAngle:-1*s.gauge_startingAngle*(s.gauge_fullCircle?Math.PI:1),index:h++};return l.getArc(e,!0,!0)}),g.exit().remove(),l.arcs.select("."+Y.chartArcsGaugeUnit).attr("dy",".75em").text(s.gauge_label_show?s.gauge_units:""),l.arcs.select("."+Y.chartArcsGaugeMin).attr("dx",-1*(l.innerRadius+(l.radius-l.innerRadius)/(s.gauge_fullCircle?1:2))+"px").attr("dy","1.2em").text(s.gauge_label_show?l.textForGaugeMinMax(s.gauge_min,!1):""),l.arcs.select("."+Y.chartArcsGaugeMax).attr("dx",l.innerRadius+(l.radius-l.innerRadius)/(s.gauge_fullCircle?1:2)+"px").attr("dy","1.2em").text(s.gauge_label_show?l.textForGaugeMinMax(s.gauge_max,!0):"")}},l.prototype.initGauge=function(){var t=this.arcs;this.hasType("gauge")&&(t.append("g").attr("class",Y.chartArcsBackground),t.append("text").attr("class",Y.chartArcsGaugeUnit).style("text-anchor","middle").style("pointer-events","none"),t.append("text").attr("class",Y.chartArcsGaugeMin).style("text-anchor","middle").style("pointer-events","none"),t.append("text").attr("class",Y.chartArcsGaugeMax).style("text-anchor","middle").style("pointer-events","none"))},l.prototype.getGaugeLabelHeight=function(){return this.config.gauge_label_show?20:0},l.prototype.addToCache=function(t,e){this.cache["$".concat(t)]=e},l.prototype.getFromCache=function(t){return this.cache["$".concat(t)]},l.prototype.resetCache=function(){var e=this;Object.keys(this.cache).filter(function(t){return/^\$/.test(t)}).forEach(function(t){delete e.cache[t]})},l.prototype.hasCaches=function(t){for(var e=0;e<t.length;e++)if(!(t[e]in this.cache))return!1;return!0},l.prototype.addCache=function(t,e){this.cache[t]=this.cloneTarget(e)},l.prototype.getCaches=function(t){var e,i=[];for(e=0;e<t.length;e++)t[e]in this.cache&&i.push(this.cloneTarget(this.cache[t[e]]));return i},l.prototype.categoryName=function(t){var e=this.config;return t<e.axis_x_categories.length?e.axis_x_categories[t]:t},l.prototype.generateTargetClass=function(t){return t||0===t?("-"+t).replace(/\s/g,"-"):""},l.prototype.generateClass=function(t,e){return" "+t+" "+t+this.generateTargetClass(e)},l.prototype.classText=function(t){return this.generateClass(Y.text,t.index)},l.prototype.classTexts=function(t){return this.generateClass(Y.texts,t.id)},l.prototype.classShape=function(t){return this.generateClass(Y.shape,t.index)},l.prototype.classShapes=function(t){return this.generateClass(Y.shapes,t.id)},l.prototype.classLine=function(t){return this.classShape(t)+this.generateClass(Y.line,t.id)},l.prototype.classLines=function(t){return this.classShapes(t)+this.generateClass(Y.lines,t.id)},l.prototype.classCircle=function(t){return this.classShape(t)+this.generateClass(Y.circle,t.index)},l.prototype.classCircles=function(t){return this.classShapes(t)+this.generateClass(Y.circles,t.id)},l.prototype.classBar=function(t){return this.classShape(t)+this.generateClass(Y.bar,t.index)},l.prototype.classBars=function(t){return this.classShapes(t)+this.generateClass(Y.bars,t.id)},l.prototype.classArc=function(t){return this.classShape(t.data)+this.generateClass(Y.arc,t.data.id)},l.prototype.classArcs=function(t){return this.classShapes(t.data)+this.generateClass(Y.arcs,t.data.id)},l.prototype.classArea=function(t){return this.classShape(t)+this.generateClass(Y.area,t.id)},l.prototype.classAreas=function(t){return this.classShapes(t)+this.generateClass(Y.areas,t.id)},l.prototype.classRegion=function(t,e){return this.generateClass(Y.region,e)+" "+("class"in t?t.class:"")},l.prototype.classEvent=function(t){return this.generateClass(Y.eventRect,t.index)},l.prototype.classTarget=function(t){var e=this.config.data_classes[t],i="";return e&&(i=" "+Y.target+"-"+e),this.generateClass(Y.target,t)+i},l.prototype.classFocus=function(t){return this.classFocused(t)+this.classDefocused(t)},l.prototype.classFocused=function(t){return" "+(0<=this.focusedTargetIds.indexOf(t.id)?Y.focused:"")},l.prototype.classDefocused=function(t){return" "+(0<=this.defocusedTargetIds.indexOf(t.id)?Y.defocused:"")},l.prototype.classChartText=function(t){return Y.chartText+this.classTarget(t.id)},l.prototype.classChartLine=function(t){return Y.chartLine+this.classTarget(t.id)},l.prototype.classChartBar=function(t){return Y.chartBar+this.classTarget(t.id)},l.prototype.classChartArc=function(t){return Y.chartArc+this.classTarget(t.data.id)},l.prototype.getTargetSelectorSuffix=function(t){var e=this.generateTargetClass(t);return window.CSS&&window.CSS.escape?window.CSS.escape(e):e.replace(/([?!@#$%^&*()=+,.<>'":;\[\]\/|~`{}\\])/g,"\\$1")},l.prototype.selectorTarget=function(t,e){return(e||"")+"."+Y.target+this.getTargetSelectorSuffix(t)},l.prototype.selectorTargets=function(t,e){var i=this;return(t=t||[]).length?t.map(function(t){return i.selectorTarget(t,e)}):null},l.prototype.selectorLegend=function(t){return"."+Y.legendItem+this.getTargetSelectorSuffix(t)},l.prototype.selectorLegends=function(t){var e=this;return t&&t.length?t.map(function(t){return e.selectorLegend(t)}):null},l.prototype.getClipPath=function(t){return"url("+(0<=window.navigator.appVersion.toLowerCase().indexOf("msie 9.")?"":document.URL.split("#")[0])+"#"+t+")"},l.prototype.appendClip=function(t,e){return t.append("clipPath").attr("id",e).append("rect")},l.prototype.getAxisClipX=function(t){var e=Math.max(30,this.margin.left);return t?-(1+e):-(e-1)},l.prototype.getAxisClipY=function(t){return t?-20:-this.margin.top},l.prototype.getXAxisClipX=function(){return this.getAxisClipX(!this.config.axis_rotated)},l.prototype.getXAxisClipY=function(){return this.getAxisClipY(!this.config.axis_rotated)},l.prototype.getYAxisClipX=function(){return this.config.axis_y_inner?-1:this.getAxisClipX(this.config.axis_rotated)},l.prototype.getYAxisClipY=function(){return this.getAxisClipY(this.config.axis_rotated)},l.prototype.getAxisClipWidth=function(t){var e=Math.max(30,this.margin.left),i=Math.max(30,this.margin.right);return t?this.width+2+e+i:this.margin.left+20},l.prototype.getAxisClipHeight=function(t){return(t?this.margin.bottom:this.margin.top+this.height)+20},l.prototype.getXAxisClipWidth=function(){return this.getAxisClipWidth(!this.config.axis_rotated)},l.prototype.getXAxisClipHeight=function(){return this.getAxisClipHeight(!this.config.axis_rotated)},l.prototype.getYAxisClipWidth=function(){return this.getAxisClipWidth(this.config.axis_rotated)+(this.config.axis_y_inner?20:0)},l.prototype.getYAxisClipHeight=function(){return this.getAxisClipHeight(this.config.axis_rotated)},l.prototype.generateColor=function(){var t=this.config,e=this.d3,n=t.data_colors,r=L(t.color_pattern)?t.color_pattern:e.schemeCategory10,a=t.data_color,o=[];return function(t){var e,i=t.id||t.data&&t.data.id||t;return n[i]instanceof Function?e=n[i](t):n[i]?e=n[i]:(o.indexOf(i)<0&&o.push(i),e=r[o.indexOf(i)%r.length],n[i]=e),a instanceof Function?a(e,t):e}},l.prototype.generateLevelColor=function(){var t=this.config,n=t.color_pattern,e=t.color_threshold,r="value"===e.unit,a=e.values&&e.values.length?e.values:[],o=e.max||100;return L(e)&&L(n)?function(t){var e,i=n[n.length-1];for(e=0;e<a.length;e++)if((r?t:100*t/o)<a[e]){i=n[e];break}return i}:null},l.prototype.getDefaultConfig=function(){var e={bindto:"#chart",svg_classname:void 0,size_width:void 0,size_height:void 0,padding_left:void 0,padding_right:void 0,padding_top:void 0,padding_bottom:void 0,resize_auto:!0,zoom_enabled:!1,zoom_initialRange:void 0,zoom_type:"scroll",zoom_disableDefaultBehavior:!1,zoom_privileged:!1,zoom_rescale:!1,zoom_onzoom:function(){},zoom_onzoomstart:function(){},zoom_onzoomend:function(){},zoom_x_min:void 0,zoom_x_max:void 0,interaction_brighten:!0,interaction_enabled:!0,onmouseover:function(){},onmouseout:function(){},onresize:function(){},onresized:function(){},oninit:function(){},onrendered:function(){},transition_duration:350,data_epochs:"epochs",data_x:void 0,data_xs:{},data_xFormat:"%Y-%m-%d",data_xLocaltime:!0,data_xSort:!0,data_idConverter:function(t){return t},data_names:{},data_classes:{},data_groups:[],data_axes:{},data_type:void 0,data_types:{},data_labels:{},data_order:"desc",data_regions:{},data_color:void 0,data_colors:{},data_hide:!1,data_filter:void 0,data_selection_enabled:!1,data_selection_grouped:!1,data_selection_isselectable:function(){return!0},data_selection_multiple:!0,data_selection_draggable:!1,data_stack_normalize:!1,data_onclick:function(){},data_onmouseover:function(){},data_onmouseout:function(){},data_onselected:function(){},data_onunselected:function(){},data_url:void 0,data_headers:void 0,data_json:void 0,data_rows:void 0,data_columns:void 0,data_mimeType:void 0,data_keys:void 0,data_empty_label_text:"",subchart_show:!1,subchart_size_height:60,subchart_axis_x_show:!0,subchart_onbrush:function(){},color_pattern:[],color_threshold:{},legend_show:!0,legend_hide:!1,legend_position:"bottom",legend_inset_anchor:"top-left",legend_inset_x:10,legend_inset_y:0,legend_inset_step:void 0,legend_item_onclick:void 0,legend_item_onmouseover:void 0,legend_item_onmouseout:void 0,legend_equally:!1,legend_padding:0,legend_item_tile_width:10,legend_item_tile_height:10,axis_rotated:!1,axis_x_show:!0,axis_x_type:"indexed",axis_x_localtime:!0,axis_x_categories:[],axis_x_tick_centered:!1,axis_x_tick_format:void 0,axis_x_tick_culling:{},axis_x_tick_culling_max:10,axis_x_tick_count:void 0,axis_x_tick_fit:!0,axis_x_tick_values:null,axis_x_tick_rotate:0,axis_x_tick_outer:!0,axis_x_tick_multiline:!0,axis_x_tick_multilineMax:0,axis_x_tick_width:null,axis_x_max:void 0,axis_x_min:void 0,axis_x_padding:{},axis_x_height:void 0,axis_x_selection:void 0,axis_x_label:{},axis_x_inner:void 0,axis_y_show:!0,axis_y_type:"linear",axis_y_max:void 0,axis_y_min:void 0,axis_y_inverted:!1,axis_y_center:void 0,axis_y_inner:void 0,axis_y_label:{},axis_y_tick_format:void 0,axis_y_tick_outer:!0,axis_y_tick_values:null,axis_y_tick_rotate:0,axis_y_tick_count:void 0,axis_y_tick_time_type:void 0,axis_y_tick_time_interval:void 0,axis_y_padding:{},axis_y_default:void 0,axis_y2_show:!1,axis_y2_type:"linear",axis_y2_max:void 0,axis_y2_min:void 0,axis_y2_inverted:!1,axis_y2_center:void 0,axis_y2_inner:void 0,axis_y2_label:{},axis_y2_tick_format:void 0,axis_y2_tick_outer:!0,axis_y2_tick_values:null,axis_y2_tick_count:void 0,axis_y2_padding:{},axis_y2_default:void 0,grid_x_show:!1,grid_x_type:"tick",grid_x_lines:[],grid_y_show:!1,grid_y_lines:[],grid_y_ticks:10,grid_focus_show:!0,grid_lines_front:!0,point_show:!0,point_r:2.5,point_sensitivity:10,point_focus_expand_enabled:!0,point_focus_expand_r:void 0,point_select_r:void 0,line_connectNull:!1,line_step_type:"step",bar_width:void 0,bar_width_ratio:.6,bar_width_max:void 0,bar_zerobased:!0,bar_space:0,area_zerobased:!0,area_above:!1,pie_label_show:!0,pie_label_format:void 0,pie_label_threshold:.05,pie_label_ratio:void 0,pie_expand:{},pie_expand_duration:50,pie_padAngle:0,gauge_fullCircle:!1,gauge_label_show:!0,gauge_labelLine_show:!0,gauge_label_format:void 0,gauge_min:0,gauge_max:100,gauge_startingAngle:-1*Math.PI/2,gauge_label_extents:void 0,gauge_units:void 0,gauge_width:void 0,gauge_arcs_minWidth:5,gauge_expand:{},gauge_expand_duration:50,donut_label_show:!0,donut_label_format:void 0,donut_label_threshold:.05,donut_label_ratio:void 0,donut_width:void 0,donut_title:"",donut_expand:{},donut_expand_duration:50,donut_padAngle:0,spline_interpolation_type:"cardinal",stanford_lines:[],stanford_regions:[],stanford_texts:[],stanford_scaleMin:void 0,stanford_scaleMax:void 0,stanford_scaleWidth:void 0,stanford_scaleFormat:void 0,stanford_scaleValues:void 0,stanford_colors:void 0,stanford_padding:{top:0,right:0,bottom:0,left:0},regions:[],tooltip_show:!0,tooltip_grouped:!0,tooltip_order:void 0,tooltip_format_title:void 0,tooltip_format_name:void 0,tooltip_format_value:void 0,tooltip_horizontal:void 0,tooltip_position:void 0,tooltip_contents:function(t,e,i,n){return this.getTooltipContent?this.getTooltipContent(t,e,i,n):""},tooltip_init_show:!1,tooltip_init_x:0,tooltip_init_position:{top:"0px",left:"50px"},tooltip_onshow:function(){},tooltip_onhide:function(){},title_text:void 0,title_padding:{top:0,right:0,bottom:0,left:0},title_position:"top-center"};return Object.keys(this.additionalConfig).forEach(function(t){e[t]=this.additionalConfig[t]},this),e},l.prototype.additionalConfig={},l.prototype.loadConfig=function(e){var i,n,r,a=this.config;Object.keys(a).forEach(function(t){i=e,n=t.split("_"),r=function t(){var e=n.shift();return e&&i&&"object"===s(i)&&e in i?(i=i[e],t()):e?void 0:i}(),k(r)&&(a[t]=r)})},l.prototype.convertUrlToData=function(t,e,i,n,r){var a,o,s=this,c=e||"csv";o="json"===c?(a=s.d3.json,s.convertJsonToData):(a="tsv"===c?s.d3.tsv:s.d3.csv,s.convertXsvToData),a(t,i).then(function(t){r.call(s,o.call(s,t,n))}).catch(function(t){throw t})},l.prototype.convertXsvToData=function(t){var e=t.columns;return 0===t.length?{keys:e,rows:[e.reduce(function(t,e){return Object.assign(t,(r=null,(n=e)in(i={})?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,i));var i,n,r},{})]}:{keys:e,rows:[].concat(t)}},l.prototype.convertJsonToData=function(e,t){var r,a=this,o=[];return t?(t.x?(r=t.value.concat(t.x),a.config.data_x=t.x):r=t.value,o.push(r),e.forEach(function(i){var n=[];r.forEach(function(t){var e=a.findValueInJson(i,t);v(e)&&(e=null),n.push(e)}),o.push(n)}),a.convertRowsToData(o)):(Object.keys(e).forEach(function(t){o.push([t].concat(e[t]))}),a.convertColumnsToData(o))},l.prototype.findValueInJson=function(t,e){for(var i=(e=(e=e.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),n=0;n<i.length;++n){var r=i[n];if(!(r in t))return;t=t[r]}return t},l.prototype.convertRowsToData=function(t){for(var e=[],i=t[0],n=1;n<t.length;n++){for(var r={},a=0;a<t[n].length;a++){if(v(t[n][a]))throw new Error("Source data is missing a component at ("+n+","+a+")!");r[i[a]]=t[n][a]}e.push(r)}return{keys:i,rows:e}},l.prototype.convertColumnsToData=function(t){for(var e=[],i=[],n=0;n<t.length;n++){for(var r=t[n][0],a=1;a<t[n].length;a++){if(v(e[a-1])&&(e[a-1]={}),v(t[n][a]))throw new Error("Source data is missing a component at ("+n+","+a+")!");e[a-1][r]=t[n][a]}i.push(r)}return{keys:i,rows:e}},l.prototype.convertDataToTargets=function(t,n){var e,i,r,a,d,l=this,u=l.config;if(h(t)?a=Object.keys(t[0]):(a=t.keys,t=t.rows),r=a.filter(l.isX,l),l.isStanfordGraphType()){if(d=a.filter(l.isEpochs,l),i=a.filter(l.isNotXAndNotEpochs,l),1!==r.length||1!==d.length||1!==i.length)throw new Error("You must define the 'x' key name and the 'epochs' for Stanford Diagrams")}else i=a.filter(l.isNotX,l);return i.forEach(function(i){var e=l.getXKey(i);l.isCustomX()||l.isTimeSeries()?0<=r.indexOf(e)?l.data.xs[i]=(n&&l.data.xs[i]?l.data.xs[i]:[]).concat(t.map(function(t){return t[e]}).filter(C).map(function(t,e){return l.generateTargetX(t,i,e)})):u.data_x?l.data.xs[i]=l.getOtherTargetXs():L(u.data_xs)&&(l.data.xs[i]=l.getXValuesOfXKey(e,l.data.targets)):l.data.xs[i]=t.map(function(t,e){return e})}),i.forEach(function(t){if(!l.data.xs[t])throw new Error('x is not defined for id = "'+t+'".')}),(e=i.map(function(o,s){var c=u.data_idConverter(o);return{id:c,id_org:o,values:t.map(function(t,e){var i,n,r=t[l.getXKey(o)],a=null===t[o]||isNaN(t[o])?null:+t[o];return l.isCustomX()&&l.isCategorized()&&!v(r)?(0===s&&0===e&&(u.axis_x_categories=[]),-1===(i=u.axis_x_categories.indexOf(r))&&(i=u.axis_x_categories.length,u.axis_x_categories.push(r))):i=l.generateTargetX(r,o,e),(v(t[o])||l.data.xs[o].length<=e)&&(i=void 0),n={x:i,value:a,id:c},l.isStanfordGraphType()&&(n.epochs=t[d]),n}).filter(function(t){return k(t.x)})}})).forEach(function(t){var e;u.data_xSort&&(t.values=t.values.sort(function(t,e){return(t.x||0===t.x?t.x:1/0)-(e.x||0===e.x?e.x:1/0)})),e=0,t.values.forEach(function(t){t.index=e++}),l.data.xs[t.id].sort(function(t,e){return t-e})}),l.hasNegativeValue=l.hasNegativeValueInTargets(e),l.hasPositiveValue=l.hasPositiveValueInTargets(e),u.data_type&&l.setTargetType(l.mapToIds(e).filter(function(t){return!(t in u.data_types)}),u.data_type),e.forEach(function(t){l.addCache(t.id_org,t)}),e},l.prototype.isEpochs=function(t){var e=this.config;return e.data_epochs&&t===e.data_epochs},l.prototype.isX=function(t){var e,i,n,r=this.config;return r.data_x&&t===r.data_x||L(r.data_xs)&&(e=r.data_xs,i=t,n=!1,Object.keys(e).forEach(function(t){e[t]===i&&(n=!0)}),n)},l.prototype.isNotX=function(t){return!this.isX(t)},l.prototype.isNotXAndNotEpochs=function(t){return!this.isX(t)&&!this.isEpochs(t)},l.prototype.isStackNormalized=function(){return this.config.data_stack_normalize&&0<this.config.data_groups.length},l.prototype.isAxisNormalized=function(e){var i=this;return!!i.isStackNormalized()&&i.data.targets.filter(function(t){return i.axis.getId(t.id)===e}).some(function(t){return i.isTargetNormalized(t.id)})},l.prototype.isTargetNormalized=function(e){return this.isStackNormalized()&&this.config.data_groups.some(function(t){return t.includes(e)})},l.prototype.getXKey=function(t){var e=this.config;return e.data_x?e.data_x:L(e.data_xs)?e.data_xs[t]:null},l.prototype.getTotalPerIndex=function(t){var e=this;if(!e.isStackNormalized())return null;var i=e.getFromCache("getTotalPerIndex");if(void 0!==i)return i[t];var n={y:[],y2:[]};return e.data.targets.filter(function(t){return e.isTargetNormalized(t.id)}).filter(function(t){return e.isTargetToShow(t.id)}).forEach(function(t){var i=n[e.axis.getId(t.id)];t.values.forEach(function(t,e){i[e]||(i[e]=0),i[e]+=d(t.value)?t.value:0})}),e.addToCache("getTotalPerIndex",n),n[t]},l.prototype.getTotalDataSum=function(){var e=this,t=e.getFromCache("getTotalDataSum");if(void 0!==t)return t;var i,n,r=(i=e.data.targets.filter(function(t){return e.isTargetToShow(t.id)}).map(function(t){return t.values}),Array.isArray(i)?(n=[]).concat.apply(n,a(i)):[]).map(function(t){return t.value}).reduce(function(t,e){return t+e},0);return e.addToCache("getTotalDataSum",r),r},l.prototype.getXValuesOfXKey=function(e,t){var i,n=this;return(t&&L(t)?n.mapToIds(t):[]).forEach(function(t){n.getXKey(t)===e&&(i=n.data.xs[t])}),i},l.prototype.getXValue=function(t,e){return t in this.data.xs&&this.data.xs[t]&&C(this.data.xs[t][e])?this.data.xs[t][e]:e},l.prototype.getOtherTargetXs=function(){var t=Object.keys(this.data.xs);return t.length?this.data.xs[t[0]]:null},l.prototype.getOtherTargetX=function(t){var e=this.getOtherTargetXs();return e&&t<e.length?e[t]:null},l.prototype.addXs=function(e){var i=this;Object.keys(e).forEach(function(t){i.config.data_xs[t]=e[t]})},l.prototype.addName=function(t){var e;return t&&(e=this.config.data_names[t.id],t.name=void 0!==e?e:t.id),t},l.prototype.getValueOnIndex=function(t,e){var i=t.filter(function(t){return t.index===e});return i.length?i[0]:null},l.prototype.updateTargetX=function(t,n){var r=this;t.forEach(function(i){i.values.forEach(function(t,e){t.x=r.generateTargetX(n[e],i.id,e)}),r.data.xs[i.id]=n})},l.prototype.updateTargetXs=function(t,e){var i=this;t.forEach(function(t){e[t.id]&&i.updateTargetX([t],e[t.id])})},l.prototype.generateTargetX=function(t,e,i){var n=this;return n.isTimeSeries()?t?n.parseDate(t):n.parseDate(n.getXValue(e,i)):n.isCustomX()&&!n.isCategorized()?C(t)?+t:n.getXValue(e,i):i},l.prototype.cloneTarget=function(t){return{id:t.id,id_org:t.id_org,values:t.values.map(function(t){return{x:t.x,value:t.value,id:t.id}})}},l.prototype.getMaxDataCount=function(){return this.d3.max(this.data.targets,function(t){return t.values.length})},l.prototype.mapToIds=function(t){return t.map(function(t){return t.id})},l.prototype.mapToTargetIds=function(t){return t?[].concat(t):this.mapToIds(this.data.targets)},l.prototype.hasTarget=function(t,e){var i,n=this.mapToIds(t);for(i=0;i<n.length;i++)if(n[i]===e)return!0;return!1},l.prototype.isTargetToShow=function(t){return this.hiddenTargetIds.indexOf(t)<0},l.prototype.isLegendToShow=function(t){return this.hiddenLegendIds.indexOf(t)<0},l.prototype.getTargetsToShow=function(){return this.filterTargetsToShow(this.data.targets)},l.prototype.filterTargetsToShow=function(t){var e=this;return t.filter(function(t){return e.isTargetToShow(t.id)})},l.prototype.mapTargetsToUniqueXs=function(t){var e=this.d3.set(this.d3.merge(t.map(function(t){return t.values.map(function(t){return+t.x})}))).values();return(e=this.isTimeSeries()?e.map(function(t){return new Date(+t)}):e.map(function(t){return+t})).sort(function(t,e){return t<e?-1:e<t?1:e<=t?0:NaN})},l.prototype.addHiddenTargetIds=function(t){t=t instanceof Array?t:new Array(t);for(var e=0;e<t.length;e++)this.hiddenTargetIds.indexOf(t[e])<0&&(this.hiddenTargetIds=this.hiddenTargetIds.concat(t[e]));this.resetCache()},l.prototype.removeHiddenTargetIds=function(e){this.hiddenTargetIds=this.hiddenTargetIds.filter(function(t){return e.indexOf(t)<0}),this.resetCache()},l.prototype.addHiddenLegendIds=function(t){t=t instanceof Array?t:new Array(t);for(var e=0;e<t.length;e++)this.hiddenLegendIds.indexOf(t[e])<0&&(this.hiddenLegendIds=this.hiddenLegendIds.concat(t[e]))},l.prototype.removeHiddenLegendIds=function(e){this.hiddenLegendIds=this.hiddenLegendIds.filter(function(t){return e.indexOf(t)<0})},l.prototype.getValuesAsIdKeyed=function(t){var i={};return t.forEach(function(e){i[e.id]=[],e.values.forEach(function(t){i[e.id].push(t.value)})}),i},l.prototype.checkValueInTargets=function(t,e){var i,n,r,a=Object.keys(t);for(i=0;i<a.length;i++)for(r=t[a[i]].values,n=0;n<r.length;n++)if(e(r[n].value))return!0;return!1},l.prototype.hasNegativeValueInTargets=function(t){return this.checkValueInTargets(t,function(t){return t<0})},l.prototype.hasPositiveValueInTargets=function(t){return this.checkValueInTargets(t,function(t){return 0<t})},l.prototype.isOrderDesc=function(){var t=this.config;return"string"==typeof t.data_order&&"desc"===t.data_order.toLowerCase()},l.prototype.isOrderAsc=function(){var t=this.config;return"string"==typeof t.data_order&&"asc"===t.data_order.toLowerCase()},l.prototype.getOrderFunction=function(){var t=this.config,r=this.isOrderAsc(),e=this.isOrderDesc();if(r||e){var a=function(t,e){return t+Math.abs(e.value)};return function(t,e){var i=t.values.reduce(a,0),n=e.values.reduce(a,0);return r?n-i:i-n}}if(g(t.data_order))return t.data_order;if(h(t.data_order)){var i=t.data_order;return function(t,e){return i.indexOf(t.id)-i.indexOf(e.id)}}},l.prototype.orderTargets=function(t){var e=this.getOrderFunction();return e&&t.sort(e),t},l.prototype.filterByIndex=function(t,e){return this.d3.merge(t.map(function(t){return t.values.filter(function(t){return t.index===e})}))},l.prototype.filterByX=function(t,e){return this.d3.merge(t.map(function(t){return t.values})).filter(function(t){return t.x-e==0})},l.prototype.filterRemoveNull=function(t){return t.filter(function(t){return C(t.value)})},l.prototype.filterByXDomain=function(t,e){return t.map(function(t){return{id:t.id,id_org:t.id_org,values:t.values.filter(function(t){return e[0]<=t.x&&t.x<=e[1]})}})},l.prototype.hasDataLabel=function(){var t=this.config;return!("boolean"!=typeof t.data_labels||!t.data_labels)||!("object"!==s(t.data_labels)||!L(t.data_labels))},l.prototype.getDataLabelLength=function(t,e,i){var n=this,r=[0,0];return n.selectChart.select("svg").selectAll(".dummy").data([t,e]).enter().append("text").text(function(t){return n.dataLabelFormat(t.id)(t)}).each(function(t,e){r[e]=1.3*c(this)[i]}).remove(),r},l.prototype.isNoneArc=function(t){return this.hasTarget(this.data.targets,t.id)},l.prototype.isArc=function(t){return"data"in t&&this.hasTarget(this.data.targets,t.data.id)},l.prototype.findClosestFromTargets=function(t,e){var i=this,n=t.map(function(t){return i.findClosest(t.values,e,i.config.tooltip_horizontal?i.horizontalDistance.bind(i):i.dist.bind(i),i.config.point_sensitivity)}).filter(function(t){return t});return 0===n.length?void 0:1===n.length?n[0]:i.findClosest(n,e,i.dist.bind(i))},l.prototype.findClosest=function(t,i,n){var r,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1/0,o=this;return t.filter(function(t){return t&&o.isBarType(t.id)}).forEach(function(t){if(!r){var e=o.main.select("."+Y.bars+o.getTargetSelectorSuffix(t.id)+" ."+Y.bar+"-"+t.index).node();o.isWithinBar(i,e)&&(r=t)}}),t.filter(function(t){return t&&!o.isBarType(t.id)}).forEach(function(t){var e=n(t,i);e<a&&(a=e,r=t)}),r},l.prototype.dist=function(t,e){var i=this.config,n=i.axis_rotated?1:0,r=i.axis_rotated?0:1,a=this.circleY(t,t.index),o=this.x(t.x);return Math.sqrt(Math.pow(o-e[n],2)+Math.pow(a-e[r],2))},l.prototype.horizontalDistance=function(t,e){var i=this.config.axis_rotated?1:0,n=this.x(t.x);return Math.abs(n-e[i])},l.prototype.convertValuesToStep=function(t){var e,i=[].concat(t);if(!this.isCategorized())return t;for(e=t.length+1;0<e;e--)i[e]=i[e-1];return i[0]={x:i[0].x-1,value:i[0].value,id:i[0].id},i[t.length+1]={x:i[t.length].x+1,value:i[t.length].value,id:i[t.length].id},i},l.prototype.getRatio=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=this,r=n.api,a=0;if(e&&r.data.shown.call(r).length)if(a=e.ratio||e.value,"arc"===t)if(n.hasType("gauge"))a=(e.endAngle-e.startAngle)/(Math.PI*(n.config.gauge_fullCircle?2:1));else{var o=n.getTotalDataSum();a=e.value/o}else if("index"===t){var s=n.getTotalPerIndex(n.axis.getId(e.id));e.ratio=d(e.value)&&s&&0<s[e.index]?e.value/s[e.index]:0,a=e.ratio}return i&&a?100*a:a},l.prototype.updateDataAttributes=function(t,e){var i=this.config["data_"+t];return void 0===e||(Object.keys(e).forEach(function(t){i[t]=e[t]}),this.redraw({withLegend:!0})),i},l.prototype.load=function(i,n){var r=this;i&&(n.filter&&(i=i.filter(n.filter)),(n.type||n.types)&&i.forEach(function(t){var e=n.types&&n.types[t.id]?n.types[t.id]:n.type;r.setTargetType(t.id,e)}),r.data.targets.forEach(function(t){for(var e=0;e<i.length;e++)if(t.id===i[e].id){t.values=i[e].values,i.splice(e,1);break}}),r.data.targets=r.data.targets.concat(i)),r.updateTargets(r.data.targets),r.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),n.done&&n.done()},l.prototype.loadFromArgs=function(e){var i=this;i.resetCache(),e.data?i.load(i.convertDataToTargets(e.data),e):e.url?i.convertUrlToData(e.url,e.mimeType,e.headers,e.keys,function(t){i.load(i.convertDataToTargets(t),e)}):e.json?i.load(i.convertDataToTargets(i.convertJsonToData(e.json,e.keys)),e):e.rows?i.load(i.convertDataToTargets(i.convertRowsToData(e.rows)),e):e.columns?i.load(i.convertDataToTargets(i.convertColumnsToData(e.columns)),e):i.load(null,e)},l.prototype.unload=function(t,e){var i=this;i.resetCache(),e||(e=function(){}),(t=t.filter(function(t){return i.hasTarget(i.data.targets,t)}))&&0!==t.length?(i.svg.selectAll(t.map(function(t){return i.selectorTarget(t)})).transition().style("opacity",0).remove().call(i.endall,e),t.forEach(function(e){i.withoutFadeIn[e]=!1,i.legend&&i.legend.selectAll("."+Y.legendItem+i.getTargetSelectorSuffix(e)).remove(),i.data.targets=i.data.targets.filter(function(t){return t.id!==e})})):e()},l.prototype.getYDomainMin=function(t){var e,i,n,r,a,o,s=this,c=s.config,d=s.mapToIds(t),l=s.getValuesAsIdKeyed(t);if(0<c.data_groups.length)for(o=s.hasNegativeValueInTargets(t),e=0;e<c.data_groups.length;e++)if(0!==(r=c.data_groups[e].filter(function(t){return 0<=d.indexOf(t)})).length)for(n=r[0],o&&l[n]&&l[n].forEach(function(t,e){l[n][e]=t<0?t:0}),i=1;i<r.length;i++)a=r[i],l[a]&&l[a].forEach(function(t,e){s.axis.getId(a)!==s.axis.getId(n)||!l[n]||o&&0<+t||(l[n][e]+=+t)});return s.d3.min(Object.keys(l).map(function(t){return s.d3.min(l[t])}))},l.prototype.getYDomainMax=function(t){var e,i,n,r,a,o,s=this,c=s.config,d=s.mapToIds(t),l=s.getValuesAsIdKeyed(t);if(0<c.data_groups.length)for(o=s.hasPositiveValueInTargets(t),e=0;e<c.data_groups.length;e++)if(0!==(r=c.data_groups[e].filter(function(t){return 0<=d.indexOf(t)})).length)for(n=r[0],o&&l[n]&&l[n].forEach(function(t,e){l[n][e]=0<t?t:0}),i=1;i<r.length;i++)a=r[i],l[a]&&l[a].forEach(function(t,e){s.axis.getId(a)!==s.axis.getId(n)||!l[n]||o&&+t<0||(l[n][e]+=+t)});return s.d3.max(Object.keys(l).map(function(t){return s.d3.max(l[t])}))},l.prototype.getYDomain=function(t,e,i){var n=this,r=n.config;if(n.isAxisNormalized(e))return[0,100];var a,o,s,c,d,l,u,h,g,p,f=t.filter(function(t){return n.axis.getId(t.id)===e}),_=i?n.filterByXDomain(f,i):f,x="y2"===e?r.axis_y2_min:r.axis_y_min,y="y2"===e?r.axis_y2_max:r.axis_y_max,m=n.getYDomainMin(_),S=n.getYDomainMax(_),w="y2"===e?r.axis_y2_center:r.axis_y_center,v=n.hasType("bar",_)&&r.bar_zerobased||n.hasType("area",_)&&r.area_zerobased,b="y2"===e?r.axis_y2_inverted:r.axis_y_inverted,T=n.hasDataLabel()&&r.axis_rotated,A=n.hasDataLabel()&&!r.axis_rotated;if(m=C(x)?x:C(y)?m<y?m:y-10:m,S=C(y)?y:C(x)?x<S?S:x+10:S,0===_.length)return"y2"===e?n.y2.domain():n.y.domain();if(isNaN(m)&&(m=0),isNaN(S)&&(S=m),m===S&&(m<0?S=0:m=0),g=0<=m&&0<=S,p=m<=0&&S<=0,(C(x)&&g||C(y)&&p)&&(v=!1),v&&(g&&(m=0),p&&(S=0)),s=c=.1*(o=Math.abs(S-m)),void 0!==w&&(S=w+(d=Math.max(Math.abs(m),Math.abs(S))),m=w-d),T)l=n.getDataLabelLength(m,S,"width"),u=R(n.y.range()),s+=o*((h=[l[0]/u,l[1]/u])[1]/(1-h[0]-h[1])),c+=o*(h[0]/(1-h[0]-h[1]));else if(A){l=n.getDataLabelLength(m,S,"height");var P=n.getY(r["axis_".concat(e,"_type")],[0,r.axis_rotated?n.width:n.height],[0,o]);s+=P(l[1]),c+=P(l[0])}return"y"===e&&L(r.axis_y_padding)&&(s=n.axis.getPadding(r.axis_y_padding,"top",s,o),c=n.axis.getPadding(r.axis_y_padding,"bottom",c,o)),"y2"===e&&L(r.axis_y2_padding)&&(s=n.axis.getPadding(r.axis_y2_padding,"top",s,o),c=n.axis.getPadding(r.axis_y2_padding,"bottom",c,o)),v&&(g&&(c=m),p&&(s=-S)),a=[m-c,S+s],b?a.reverse():a},l.prototype.getXDomainMin=function(t){var e=this,i=e.config;return k(i.axis_x_min)?e.isTimeSeries()?this.parseDate(i.axis_x_min):i.axis_x_min:e.d3.min(t,function(t){return e.d3.min(t.values,function(t){return t.x})})},l.prototype.getXDomainMax=function(t){var e=this,i=e.config;return k(i.axis_x_max)?e.isTimeSeries()?this.parseDate(i.axis_x_max):i.axis_x_max:e.d3.max(t,function(t){return e.d3.max(t.values,function(t){return t.x})})},l.prototype.getXDomainPadding=function(t){var e,i,n,r,a=this.config,o=t[1]-t[0];return i=this.isCategorized()?0:this.hasType("bar")?1<(e=this.getMaxDataCount())?o/(e-1)/2:.5:.01*o,"object"===s(a.axis_x_padding)&&L(a.axis_x_padding)?(n=C(a.axis_x_padding.left)?a.axis_x_padding.left:i,r=C(a.axis_x_padding.right)?a.axis_x_padding.right:i):n=r="number"==typeof a.axis_x_padding?a.axis_x_padding:i,{left:n,right:r}},l.prototype.getXDomain=function(t){var e=this,i=[e.getXDomainMin(t),e.getXDomainMax(t)],n=i[0],r=i[1],a=e.getXDomainPadding(i),o=0,s=0;return n-r!=0||e.isCategorized()||(r=e.isTimeSeries()?(n=new Date(.5*n.getTime()),new Date(1.5*r.getTime())):(n=0===n?1:.5*n,0===r?-1:1.5*r)),(n||0===n)&&(o=e.isTimeSeries()?new Date(n.getTime()-a.left):n-a.left),(r||0===r)&&(s=e.isTimeSeries()?new Date(r.getTime()+a.right):r+a.right),[o,s]},l.prototype.updateXDomain=function(t,e,i,n,r){var a=this,o=a.config;return i&&(a.x.domain(r||a.d3.extent(a.getXDomain(t))),a.orgXDomain=a.x.domain(),o.zoom_enabled&&a.zoom.update(),a.subX.domain(a.x.domain()),a.brush&&a.brush.updateScale(a.subX)),e&&a.x.domain(r||(!a.brush||a.brush.empty()?a.orgXDomain:a.brush.selectionAsValue())),n&&a.x.domain(a.trimXDomain(a.x.orgDomain())),a.x.domain()},l.prototype.trimXDomain=function(t){var e=this.getZoomDomain(),i=e[0],n=e[1];return t[0]<=i&&(t[1]=+t[1]+(i-t[0]),t[0]=i),n<=t[1]&&(t[0]=+t[0]-(t[1]-n),t[1]=n),t},l.prototype.drag=function(t){var e,i,n,r,h,g,p,f,_=this,a=_.config,o=_.main,x=_.d3;_.hasArcType()||a.data_selection_enabled&&a.data_selection_multiple&&(e=_.dragStart[0],i=_.dragStart[1],n=t[0],r=t[1],h=Math.min(e,n),g=Math.max(e,n),p=a.data_selection_grouped?_.margin.top:Math.min(i,r),f=a.data_selection_grouped?_.height:Math.max(i,r),o.select("."+Y.dragarea).attr("x",h).attr("y",p).attr("width",g-h).attr("height",f-p),o.selectAll("."+Y.shapes).selectAll("."+Y.shape).filter(function(t){return a.data_selection_isselectable(t)}).each(function(t,e){var i,n,r,a,o,s,c=x.select(this),d=c.classed(Y.SELECTED),l=c.classed(Y.INCLUDED),u=!1;if(c.classed(Y.circle))i=1*c.attr("cx"),n=1*c.attr("cy"),o=_.togglePoint,u=h<i&&i<g&&p<n&&n<f;else{if(!c.classed(Y.bar))return;i=(s=y(this)).x,n=s.y,r=s.width,a=s.height,o=_.togglePath,u=!(g<i||i+r<h||f<n||n+a<p)}u^l&&(c.classed(Y.INCLUDED,!l),c.classed(Y.SELECTED,!d),o.call(_,!d,c,t,e))}))},l.prototype.dragstart=function(t){var e=this,i=e.config;e.hasArcType()||i.data_selection_enabled&&(e.dragStart=t,e.main.select("."+Y.chart).append("rect").attr("class",Y.dragarea).style("opacity",.1),e.dragging=!0)},l.prototype.dragend=function(){var t=this,e=t.config;t.hasArcType()||e.data_selection_enabled&&(t.main.select("."+Y.dragarea).transition().duration(100).style("opacity",0).remove(),t.main.selectAll("."+Y.shape).classed(Y.INCLUDED,!1),t.dragging=!1)},l.prototype.getYFormat=function(t){var n=this,r=t&&!n.hasType("gauge")?n.defaultArcValueFormat:n.yFormat,a=t&&!n.hasType("gauge")?n.defaultArcValueFormat:n.y2Format;return function(t,e,i){return("y2"===n.axis.getId(i)?a:r).call(n,t,e)}},l.prototype.yFormat=function(t){var e=this.config;return(e.axis_y_tick_format?e.axis_y_tick_format:this.defaultValueFormat)(t)},l.prototype.y2Format=function(t){var e=this.config;return(e.axis_y2_tick_format?e.axis_y2_tick_format:this.defaultValueFormat)(t)},l.prototype.defaultValueFormat=function(t){return C(t)?+t:""},l.prototype.defaultArcValueFormat=function(t,e){return(100*e).toFixed(1)+"%"},l.prototype.dataLabelFormat=function(t){var e=this.config.data_labels,i=function(t){return C(t)?+t:""};return"function"==typeof e.format?e.format:"object"===s(e.format)?e.format[t]?!0===e.format[t]?i:e.format[t]:function(){return""}:i},l.prototype.initGrid=function(){var t=this,e=t.config,i=t.d3;t.grid=t.main.append("g").attr("clip-path",t.clipPathForGrid).attr("class",Y.grid),e.grid_x_show&&t.grid.append("g").attr("class",Y.xgrids),e.grid_y_show&&t.grid.append("g").attr("class",Y.ygrids),e.grid_focus_show&&t.grid.append("g").attr("class",Y.xgridFocus).append("line").attr("class",Y.xgridFocus),t.xgrid=i.selectAll([]),e.grid_lines_front||t.initGridLines()},l.prototype.initGridLines=function(){var t=this,e=t.d3;t.gridLines=t.main.append("g").attr("clip-path",t.clipPathForGrid).attr("class",Y.grid+" "+Y.gridLines),t.gridLines.append("g").attr("class",Y.xgridLines),t.gridLines.append("g").attr("class",Y.ygridLines),t.xgridLines=e.selectAll([])},l.prototype.updateXGrid=function(t){var e=this,i=e.config,n=e.d3,r=e.generateGridData(i.grid_x_type,e.x),a=e.isCategorized()?e.xAxis.tickOffset():0;e.xgridAttr=i.axis_rotated?{x1:0,x2:e.width,y1:function(t){return e.x(t)-a},y2:function(t){return e.x(t)-a}}:{x1:function(t){return e.x(t)+a},x2:function(t){return e.x(t)+a},y1:0,y2:e.height},e.xgridAttr.opacity=function(){return+n.select(this).attr(i.axis_rotated?"y1":"x1")===(i.axis_rotated?e.height:0)?0:1};var o=e.main.select("."+Y.xgrids).selectAll("."+Y.xgrid).data(r),s=o.enter().append("line").attr("class",Y.xgrid).attr("x1",e.xgridAttr.x1).attr("x2",e.xgridAttr.x2).attr("y1",e.xgridAttr.y1).attr("y2",e.xgridAttr.y2).style("opacity",0);e.xgrid=s.merge(o),t||e.xgrid.attr("x1",e.xgridAttr.x1).attr("x2",e.xgridAttr.x2).attr("y1",e.xgridAttr.y1).attr("y2",e.xgridAttr.y2).style("opacity",e.xgridAttr.opacity),o.exit().remove()},l.prototype.updateYGrid=function(){var t=this,e=t.config,i=t.yAxis.tickValues()||t.y.ticks(e.grid_y_ticks),n=t.main.select("."+Y.ygrids).selectAll("."+Y.ygrid).data(i),r=n.enter().append("line").attr("class",Y.ygrid);t.ygrid=r.merge(n),t.ygrid.attr("x1",e.axis_rotated?t.y:0).attr("x2",e.axis_rotated?t.y:t.width).attr("y1",e.axis_rotated?0:t.y).attr("y2",e.axis_rotated?t.height:t.y),n.exit().remove(),t.smoothLines(t.ygrid,"grid")},l.prototype.gridTextAnchor=function(t){return t.position?t.position:"end"},l.prototype.gridTextDx=function(t){return"start"===t.position?4:"middle"===t.position?0:-4},l.prototype.xGridTextX=function(t){return"start"===t.position?-this.height:"middle"===t.position?-this.height/2:0},l.prototype.yGridTextX=function(t){return"start"===t.position?0:"middle"===t.position?this.width/2:this.width},l.prototype.updateGrid=function(t){var e,i,n,r,a=this,o=a.main,s=a.config,c=a.xv.bind(a),d=a.yv.bind(a),l=a.xGridTextX.bind(a),u=a.yGridTextX.bind(a);a.grid.style("visibility",a.hasArcType()?"hidden":"visible"),o.select("line."+Y.xgridFocus).style("visibility","hidden"),s.grid_x_show&&a.updateXGrid(),(i=(e=o.select("."+Y.xgridLines).selectAll("."+Y.xgridLine).data(s.grid_x_lines)).enter().append("g").attr("class",function(t){return Y.xgridLine+(t.class?" "+t.class:"")})).append("line").attr("x1",s.axis_rotated?0:c).attr("x2",s.axis_rotated?a.width:c).attr("y1",s.axis_rotated?c:0).attr("y2",s.axis_rotated?c:a.height).style("opacity",0),i.append("text").attr("text-anchor",a.gridTextAnchor).attr("transform",s.axis_rotated?"":"rotate(-90)").attr("x",s.axis_rotated?u:l).attr("y",c).attr("dx",a.gridTextDx).attr("dy",-5).style("opacity",0),a.xgridLines=i.merge(e),e.exit().transition().duration(t).style("opacity",0).remove(),s.grid_y_show&&a.updateYGrid(),(r=(n=o.select("."+Y.ygridLines).selectAll("."+Y.ygridLine).data(s.grid_y_lines)).enter().append("g").attr("class",function(t){return Y.ygridLine+(t.class?" "+t.class:"")})).append("line").attr("x1",s.axis_rotated?d:0).attr("x2",s.axis_rotated?d:a.width).attr("y1",s.axis_rotated?0:d).attr("y2",s.axis_rotated?a.height:d).style("opacity",0),r.append("text").attr("text-anchor",a.gridTextAnchor).attr("transform",s.axis_rotated?"rotate(-90)":"").attr("x",s.axis_rotated?l:u).attr("y",d).attr("dx",a.gridTextDx).attr("dy",-5).style("opacity",0),a.ygridLines=r.merge(n),a.ygridLines.select("line").transition().duration(t).attr("x1",s.axis_rotated?d:0).attr("x2",s.axis_rotated?d:a.width).attr("y1",s.axis_rotated?0:d).attr("y2",s.axis_rotated?a.height:d).style("opacity",1),a.ygridLines.select("text").transition().duration(t).attr("x",s.axis_rotated?a.xGridTextX.bind(a):a.yGridTextX.bind(a)).attr("y",d).text(function(t){return t.text}).style("opacity",1),n.exit().transition().duration(t).style("opacity",0).remove()},l.prototype.redrawGrid=function(t,e){var i=this,n=i.config,r=i.xv.bind(i),a=i.xgridLines.select("line"),o=i.xgridLines.select("text");return[(t?a.transition(e):a).attr("x1",n.axis_rotated?0:r).attr("x2",n.axis_rotated?i.width:r).attr("y1",n.axis_rotated?r:0).attr("y2",n.axis_rotated?r:i.height).style("opacity",1),(t?o.transition(e):o).attr("x",n.axis_rotated?i.yGridTextX.bind(i):i.xGridTextX.bind(i)).attr("y",r).text(function(t){return t.text}).style("opacity",1)]},l.prototype.showXGridFocus=function(t){var e=this,i=e.config,n=t.filter(function(t){return t&&C(t.value)}),r=e.main.selectAll("line."+Y.xgridFocus),a=e.xx.bind(e);i.tooltip_show&&(e.hasType("stanford")||e.hasArcType()||(r.style("visibility","visible").data([n[0]]).attr(i.axis_rotated?"y1":"x1",a).attr(i.axis_rotated?"y2":"x2",a),e.smoothLines(r,"grid")))},l.prototype.hideXGridFocus=function(){this.main.select("line."+Y.xgridFocus).style("visibility","hidden")},l.prototype.updateXgridFocus=function(){var t=this.config;this.main.select("line."+Y.xgridFocus).attr("x1",t.axis_rotated?0:-10).attr("x2",t.axis_rotated?this.width:-10).attr("y1",t.axis_rotated?-10:0).attr("y2",t.axis_rotated?-10:this.height)},l.prototype.generateGridData=function(t,e){var i,n,r,a,o=[],s=this.main.select("."+Y.axisX).selectAll(".tick").size();if("year"===t)for(n=(i=this.getXDomain())[0].getFullYear(),r=i[1].getFullYear(),a=n;a<=r;a++)o.push(new Date(a+"-01-01 00:00:00"));else(o=e.ticks(10)).length>s&&(o=o.filter(function(t){return(""+t).indexOf(".")<0}));return o},l.prototype.getGridFilterToRemove=function(t){return t?function(e){var i=!1;return[].concat(t).forEach(function(t){("value"in t&&e.value===t.value||"class"in t&&e.class===t.class)&&(i=!0)}),i}:function(){return!0}},l.prototype.removeGridLines=function(t,e){var i=this.config,n=this.getGridFilterToRemove(t),r=function(t){return!n(t)},a=e?Y.xgridLines:Y.ygridLines,o=e?Y.xgridLine:Y.ygridLine;this.main.select("."+a).selectAll("."+o).filter(n).transition().duration(i.transition_duration).style("opacity",0).remove(),e?i.grid_x_lines=i.grid_x_lines.filter(r):i.grid_y_lines=i.grid_y_lines.filter(r)},l.prototype.initEventRect=function(){var t=this,e=t.config;t.main.select("."+Y.chart).append("g").attr("class",Y.eventRects).style("fill-opacity",0),t.eventRect=t.main.select("."+Y.eventRects).append("rect").attr("class",Y.eventRect),e.zoom_enabled&&t.zoom&&(t.eventRect.call(t.zoom).on("dblclick.zoom",null),e.zoom_initialRange&&t.eventRect.transition().duration(0).call(t.zoom.transform,t.zoomTransform(e.zoom_initialRange)))},l.prototype.redrawEventRect=function(){var o=this,s=o.d3,c=o.config;function d(){o.svg.select("."+Y.eventRect).style("cursor",null),o.hideXGridFocus(),o.hideTooltip(),o.unexpandCircles(),o.unexpandBars()}var l=function(t,e){return e&&(o.isBarType(e.id)||o.dist(e,t)<c.point_sensitivity)},t=o.getMaxDataCount(),u=s.scaleQuantize().domain([0,c.axis_rotated?o.height:o.width]).range(t?Array.apply(null,{length:t}).map(Function.call,Number):[0]),h=function(t){return t?o.addName(Object.assign({},t)):null};o.main.select("."+Y.eventRects).style("cursor",c.zoom_enabled?c.axis_rotated?"ns-resize":"ew-resize":null),o.eventRect.attr("x",0).attr("y",0).attr("width",o.width).attr("height",o.height).on("mouseout",c.interaction_enabled?function(){c&&(o.hasArcType()||(o.mouseover&&(c.data_onmouseout.call(o.api,o.mouseover),o.mouseover=void 0),d()))}:null).on("mousemove",c.interaction_enabled?function(){if(!o.dragging){var t=o.getTargetsToShow();if(!o.hasArcType(t)){var e,i=s.mouse(this),n=h(o.findClosestFromTargets(t,i)),r=l(i,n);if(!o.mouseover||n&&n.id===o.mouseover.id&&n.index===o.mouseover.index||(c.data_onmouseout.call(o.api,o.mouseover),o.mouseover=void 0),n&&!o.mouseover&&(c.data_onmouseover.call(o.api,n),o.mouseover=n),o.svg.select("."+Y.eventRect).style("cursor",r?"pointer":null),!c.tooltip_grouped||o.hasType("stanford",t)){if(!n)return d();e=[n]}else{var a=c.axis_rotated?i[1]:i[0];e=o.filterByIndex(t,u(a))}e=e.map(h),o.showTooltip(e,this),c.point_focus_expand_enabled&&(o.unexpandCircles(),e.forEach(function(t){o.expandCircles(t.index,t.id,!1)})),o.unexpandBars(),e.forEach(function(t){o.expandBars(t.index,t.id,!1)}),o.showXGridFocus(e)}}}:null).on("click",c.interaction_enabled?function(){var t=o.getTargetsToShow();if(!o.hasArcType(t)){var e=s.mouse(this),i=h(o.findClosestFromTargets(t,e));if(l(e,i))if((!c.data_selection_grouped||o.isStanfordType(i)?[i]:o.filterByX(t,i.x)).forEach(function(t){o.main.selectAll("."+Y.shapes+o.getTargetSelectorSuffix(t.id)).selectAll("."+Y.shape+"-"+t.index).each(function(){(c.data_selection_grouped||o.isWithinShape(this,t))&&o.toggleShape(this,t,t.index)})}),i){var n=o.main.selectAll("."+Y.shapes+o.getTargetSelectorSuffix(i.id)).select("."+Y.shape+"-"+i.index);c.data_onclick.call(o.api,i,n.node())}}}:null).call(c.interaction_enabled&&c.data_selection_draggable&&o.drag?s.drag().on("drag",function(){o.drag(s.mouse(this))}).on("start",function(){o.dragstart(s.mouse(this))}).on("end",function(){o.dragend()}):function(){})},l.prototype.getMousePosition=function(t){return[this.x(t.x),this.getYScale(t.id)(t.value)]},l.prototype.dispatchEvent=function(t,e){var i="."+Y.eventRect,n=this.main.select(i).node(),r=n.getBoundingClientRect(),a=r.left+(e?e[0]:0),o=r.top+(e?e[1]:0),s=document.createEvent("MouseEvents");s.initMouseEvent(t,!0,!0,window,0,a,o,a,o,!1,!1,!1,!1,0,null),n.dispatchEvent(s)},l.prototype.initLegend=function(){var t=this;if(t.legendItemTextBox={},t.legendHasRendered=!1,t.legend=t.svg.append("g").attr("transform",t.getTranslate("legend")),!t.config.legend_show)return t.legend.style("visibility","hidden"),void(t.hiddenLegendIds=t.mapToIds(t.data.targets));t.updateLegendWithDefaults()},l.prototype.updateLegendWithDefaults=function(){this.updateLegend(this.mapToIds(this.data.targets),{withTransform:!1,withTransitionForTransform:!1,withTransition:!1})},l.prototype.updateSizeForLegend=function(t,e){var i=this,n=i.config,r={top:i.isLegendTop?i.getCurrentPaddingTop()+n.legend_inset_y+5.5:i.currentHeight-t-i.getCurrentPaddingBottom()-n.legend_inset_y,left:i.isLegendLeft?i.getCurrentPaddingLeft()+n.legend_inset_x+.5:i.currentWidth-e-i.getCurrentPaddingRight()-n.legend_inset_x+.5};i.margin3={top:i.isLegendRight?0:i.isLegendInset?r.top:i.currentHeight-t,right:NaN,bottom:0,left:i.isLegendRight?i.currentWidth-e:i.isLegendInset?r.left:0}},l.prototype.transformLegend=function(t){(t?this.legend.transition():this.legend).attr("transform",this.getTranslate("legend"))},l.prototype.updateLegendStep=function(t){this.legendStep=t},l.prototype.updateLegendItemWidth=function(t){this.legendItemWidth=t},l.prototype.updateLegendItemHeight=function(t){this.legendItemHeight=t},l.prototype.getLegendWidth=function(){var t=this;return t.config.legend_show?t.isLegendRight||t.isLegendInset?t.legendItemWidth*(t.legendStep+1):t.currentWidth:0},l.prototype.getLegendHeight=function(){var t=this,e=0;return t.config.legend_show&&(e=t.isLegendRight?t.currentHeight:Math.max(20,t.legendItemHeight)*(t.legendStep+1)),e},l.prototype.opacityForLegend=function(t){return t.classed(Y.legendItemHidden)?null:1},l.prototype.opacityForUnfocusedLegend=function(t){return t.classed(Y.legendItemHidden)?null:.3},l.prototype.toggleFocusLegend=function(e,t){var i=this;e=i.mapToTargetIds(e),i.legend.selectAll("."+Y.legendItem).filter(function(t){return 0<=e.indexOf(t)}).classed(Y.legendItemFocused,t).transition().duration(100).style("opacity",function(){return(t?i.opacityForLegend:i.opacityForUnfocusedLegend).call(i,i.d3.select(this))})},l.prototype.revertLegend=function(){var t=this,e=t.d3;t.legend.selectAll("."+Y.legendItem).classed(Y.legendItemFocused,!1).transition().duration(100).style("opacity",function(){return t.opacityForLegend(e.select(this))})},l.prototype.showLegend=function(t){var e=this,i=e.config;i.legend_show||(i.legend_show=!0,e.legend.style("visibility","visible"),e.legendHasRendered||e.updateLegendWithDefaults()),e.removeHiddenLegendIds(t),e.legend.selectAll(e.selectorLegends(t)).style("visibility","visible").transition().style("opacity",function(){return e.opacityForLegend(e.d3.select(this))})},l.prototype.hideLegend=function(t){var e=this,i=e.config;i.legend_show&&u(t)&&(i.legend_show=!1,e.legend.style("visibility","hidden")),e.addHiddenLegendIds(t),e.legend.selectAll(e.selectorLegends(t)).style("opacity",0).style("visibility","hidden")},l.prototype.clearLegendItemTextBoxCache=function(){this.legendItemTextBox={}},l.prototype.updateLegend=function(f,t,e){var i,n,r,a,o,s,c,d,l,u,h,g,p,_,x,y,m=this,S=m.config,w=4,v=10,b=0,T=0,A=10,P=S.legend_item_tile_width+5,C=0,L={},V={},G={},E=[0],O={},I=0;function R(t,e,i){var n,r,a,o,s=0===i,c=i===f.length-1,d=(a=t,o=e,m.legendItemTextBox[o]||(m.legendItemTextBox[o]=m.getTextRect(a.textContent,Y.legendItem,a)),m.legendItemTextBox[o]),l=d.width+P+(!c||m.isLegendRight||m.isLegendInset?v:0)+S.legend_padding,u=d.height+w,h=m.isLegendRight||m.isLegendInset?u:l,g=m.isLegendRight||m.isLegendInset?m.getLegendHeight():m.getLegendWidth();function p(t,e){e||(n=(g-C-h)/2)<A&&(n=(g-h)/2,C=0,I++),O[t]=I,E[I]=m.isLegendInset?10:n,L[t]=C,C+=h}s&&(T=b=I=C=0),!S.legend_show||m.isLegendToShow(e)?(V[e]=l,G[e]=u,(!b||b<=l)&&(b=l),(!T||T<=u)&&(T=u),r=m.isLegendRight||m.isLegendInset?T:b,S.legend_equally?(Object.keys(V).forEach(function(t){V[t]=b}),Object.keys(G).forEach(function(t){G[t]=T}),(n=(g-r*f.length)/2)<A?(I=C=0,f.forEach(function(t){p(t)})):p(e,!0)):p(e)):V[e]=G[e]=O[e]=L[e]=0}f=f.filter(function(t){return!k(S.data_names[t])||null!==S.data_names[t]}),h=B(t=t||{},"withTransition",!0),g=B(t,"withTransitionForTransform",!0),m.isLegendInset&&(I=S.legend_inset_step?S.legend_inset_step:f.length,m.updateLegendStep(I)),a=m.isLegendRight?(i=function(t){return b*O[t]},function(t){return E[O[t]]+L[t]}):m.isLegendInset?(i=function(t){return b*O[t]+10},function(t){return E[O[t]]+L[t]}):(i=function(t){return E[O[t]]+L[t]},function(t){return T*O[t]}),n=function(t,e){return i(t,e)+4+S.legend_item_tile_width},o=function(t,e){return a(t,e)+9},r=function(t,e){return i(t,e)},s=function(t,e){return a(t,e)-5},c=function(t,e){return i(t,e)-2},d=function(t,e){return i(t,e)-2+S.legend_item_tile_width},l=function(t,e){return a(t,e)+4},(u=m.legend.selectAll("."+Y.legendItem).data(f).enter().append("g").attr("class",function(t){return m.generateClass(Y.legendItem,t)}).style("visibility",function(t){return m.isLegendToShow(t)?"visible":"hidden"}).style("cursor","pointer").on("click",function(t){S.legend_item_onclick?S.legend_item_onclick.call(m,t):m.d3.event.altKey?(m.api.hide(),m.api.show(t)):(m.api.toggle(t),m.isTargetToShow(t)?m.api.focus(t):m.api.revert())}).on("mouseover",function(t){S.legend_item_onmouseover?S.legend_item_onmouseover.call(m,t):(m.d3.select(this).classed(Y.legendItemFocused,!0),!m.transiting&&m.isTargetToShow(t)&&m.api.focus(t))}).on("mouseout",function(t){S.legend_item_onmouseout?S.legend_item_onmouseout.call(m,t):(m.d3.select(this).classed(Y.legendItemFocused,!1),m.api.revert())})).append("text").text(function(t){return k(S.data_names[t])?S.data_names[t]:t}).each(function(t,e){R(this,t,e)}).style("pointer-events","none").attr("x",m.isLegendRight||m.isLegendInset?n:-200).attr("y",m.isLegendRight||m.isLegendInset?-200:o),u.append("rect").attr("class",Y.legendItemEvent).style("fill-opacity",0).attr("x",m.isLegendRight||m.isLegendInset?r:-200).attr("y",m.isLegendRight||m.isLegendInset?-200:s),u.append("line").attr("class",Y.legendItemTile).style("stroke",m.color).style("pointer-events","none").attr("x1",m.isLegendRight||m.isLegendInset?c:-200).attr("y1",m.isLegendRight||m.isLegendInset?-200:l).attr("x2",m.isLegendRight||m.isLegendInset?d:-200).attr("y2",m.isLegendRight||m.isLegendInset?-200:l).attr("stroke-width",S.legend_item_tile_height),y=m.legend.select("."+Y.legendBackground+" rect"),m.isLegendInset&&0<b&&0===y.size()&&(y=m.legend.insert("g","."+Y.legendItem).attr("class",Y.legendBackground).append("rect")),p=m.legend.selectAll("text").data(f).text(function(t){return k(S.data_names[t])?S.data_names[t]:t}).each(function(t,e){R(this,t,e)}),(h?p.transition():p).attr("x",n).attr("y",o),_=m.legend.selectAll("rect."+Y.legendItemEvent).data(f),(h?_.transition():_).attr("width",function(t){return V[t]}).attr("height",function(t){return G[t]}).attr("x",r).attr("y",s),x=m.legend.selectAll("line."+Y.legendItemTile).data(f),(h?x.transition():x).style("stroke",m.levelColor?function(t){return m.levelColor(m.cache[t].values[0].value)}:m.color).attr("x1",c).attr("y1",l).attr("x2",d).attr("y2",l),y&&(h?y.transition():y).attr("height",m.getLegendHeight()-12).attr("width",b*(I+1)+10),m.legend.selectAll("."+Y.legendItem).classed(Y.legendItemHidden,function(t){return!m.isTargetToShow(t)}),m.updateLegendItemWidth(b),m.updateLegendItemHeight(T),m.updateLegendStep(I),m.updateSizes(),m.updateScales(),m.updateSvgSize(),m.transformAll(g,e),m.legendHasRendered=!0},l.prototype.initRegion=function(){this.region=this.main.append("g").attr("clip-path",this.clipPath).attr("class",Y.regions)},l.prototype.updateRegion=function(t){var e=this,i=e.config;e.region.style("visibility",e.hasArcType()?"hidden":"visible");var n=e.main.select("."+Y.regions).selectAll("."+Y.region).data(i.regions),r=n.enter().append("g");r.append("rect").attr("x",e.regionX.bind(e)).attr("y",e.regionY.bind(e)).attr("width",e.regionWidth.bind(e)).attr("height",e.regionHeight.bind(e)).style("fill-opacity",function(t){return C(t.opacity)?t.opacity:.1}),r.append("text").text(e.labelRegion.bind(e)),e.mainRegion=r.merge(n).attr("class",e.classRegion.bind(e)),n.exit().transition().duration(t).style("opacity",0).remove()},l.prototype.redrawRegion=function(t,e){var i=this,n=i.mainRegion,r=i.mainRegion.selectAll("text");return[(t?n.transition(e):n).attr("x",i.regionX.bind(i)).attr("y",i.regionY.bind(i)).attr("width",i.regionWidth.bind(i)).attr("height",i.regionHeight.bind(i)).style("fill-opacity",function(t){return C(t.opacity)?t.opacity:.1}),(t?r.transition(e):r).attr("x",i.labelOffsetX.bind(i)).attr("y",i.labelOffsetY.bind(i)).attr("transform",i.labelTransform.bind(i)).attr("style","text-anchor: left;")]},l.prototype.regionX=function(t){var e=this,i=e.config,n="y"===t.axis?e.y:e.y2;return"y"===t.axis||"y2"===t.axis?i.axis_rotated&&"start"in t?n(t.start):0:i.axis_rotated?0:"start"in t?e.x(e.isTimeSeries()?e.parseDate(t.start):t.start):0},l.prototype.regionY=function(t){var e=this,i=e.config,n="y"===t.axis?e.y:e.y2;return"y"===t.axis||"y2"===t.axis?i.axis_rotated?0:"end"in t?n(t.end):0:i.axis_rotated&&"start"in t?e.x(e.isTimeSeries()?e.parseDate(t.start):t.start):0},l.prototype.regionWidth=function(t){var e,i=this,n=i.config,r=i.regionX(t),a="y"===t.axis?i.y:i.y2;return(e="y"===t.axis||"y2"===t.axis?n.axis_rotated&&"end"in t?a(t.end):i.width:n.axis_rotated?i.width:"end"in t?i.x(i.isTimeSeries()?i.parseDate(t.end):t.end):i.width)<r?0:e-r},l.prototype.regionHeight=function(t){var e,i=this,n=i.config,r=this.regionY(t),a="y"===t.axis?i.y:i.y2;return(e="y"===t.axis||"y2"===t.axis?n.axis_rotated?i.height:"start"in t?a(t.start):i.height:n.axis_rotated&&"end"in t?i.x(i.isTimeSeries()?i.parseDate(t.end):t.end):i.height)<r?0:e-r},l.prototype.isRegionOnX=function(t){return!t.axis||"x"===t.axis},l.prototype.labelRegion=function(t){return"label"in t?t.label:""},l.prototype.labelTransform=function(t){return"vertical"in t&&t.vertical?"rotate(90)":""},l.prototype.labelOffsetX=function(t){var e="paddingX"in t?t.paddingX:3,i="paddingY"in t?t.paddingY:3;return"vertical"in t&&t.vertical?this.regionY(t)+i:this.regionX(t)+e},l.prototype.labelOffsetY=function(t){var e="paddingX"in t?t.paddingX:3,i="paddingY"in t?t.paddingY:3;return"vertical"in t&&t.vertical?-(this.regionX(t)+e):this.regionY(t)+10+i},l.prototype.getScale=function(t,e,i){return(i?this.d3.scaleTime():this.d3.scaleLinear()).range([t,e])},l.prototype.getX=function(t,e,i,n){var r,a=this.getScale(t,e,this.isTimeSeries()),o=i?a.domain(i):a;for(r in a=this.isCategorized()?(n=n||function(){return 0},function(t,e){var i=o(t)+n(t);return e?i:Math.ceil(i)}):function(t,e){var i=o(t);return e?i:Math.ceil(i)},o)a[r]=o[r];return a.orgDomain=function(){return o.domain()},this.isCategorized()&&(a.domain=function(t){return arguments.length?(o.domain(t),a):[(t=this.orgDomain())[0],t[1]+1]}),a},l.prototype.getY=function(t,e,i){var n;if("timeseries"===t||"time"===t)n=this.d3.scaleTime();else if("log"===t)n=x(this.d3);else{if("linear"!==t&&void 0!==t)throw new Error('Invalid Y axis type: "'.concat(t,'"'));n=this.d3.scaleLinear()}return e&&n.domain(e),i&&n.range(i),n},l.prototype.getYScale=function(t){return"y2"===this.axis.getId(t)?this.y2:this.y},l.prototype.getSubYScale=function(t){return"y2"===this.axis.getId(t)?this.subY2:this.subY},l.prototype.updateScales=function(){var e=this,t=e.config,i=!e.x;e.xMin=t.axis_rotated?1:0,e.xMax=t.axis_rotated?e.height:e.width,e.yMin=t.axis_rotated?0:e.height,e.yMax=t.axis_rotated?e.width:1,e.subXMin=e.xMin,e.subXMax=e.xMax,e.subYMin=t.axis_rotated?0:e.height2,e.subYMax=t.axis_rotated?e.width2:1,e.x=e.getX(e.xMin,e.xMax,i?void 0:e.x.orgDomain(),function(){return e.xAxis.tickOffset()}),e.y=e.getY(t.axis_y_type,i?t.axis_y_default:e.y.domain(),[e.yMin,e.yMax]),e.y2=e.getY(t.axis_y2_type,i?t.axis_y2_default:e.y2.domain(),[e.yMin,e.yMax]),e.subX=e.getX(e.xMin,e.xMax,e.orgXDomain,function(t){return t%1?0:e.subXAxis.tickOffset()}),e.subY=e.getY(t.axis_y_type,i?t.axis_y_default:e.subY.domain(),[e.subYMin,e.subYMax]),e.subY2=e.getY(t.axis_y2_type,i?t.axis_y2_default:e.subY2.domain(),[e.subYMin,e.subYMax]),e.xAxisTickFormat=e.axis.getXAxisTickFormat(),e.xAxisTickValues=e.axis.getXAxisTickValues(),e.yAxisTickValues=e.axis.getYAxisTickValues(),e.y2AxisTickValues=e.axis.getY2AxisTickValues(),e.xAxis=e.axis.getXAxis(e.x,e.xOrient,e.xAxisTickFormat,e.xAxisTickValues,t.axis_x_tick_outer),e.subXAxis=e.axis.getXAxis(e.subX,e.subXOrient,e.xAxisTickFormat,e.xAxisTickValues,t.axis_x_tick_outer),e.yAxis=e.axis.getYAxis("y",e.y,e.yOrient,e.yAxisTickValues,t.axis_y_tick_outer),e.y2Axis=e.axis.getYAxis("y2",e.y2,e.y2Orient,e.y2AxisTickValues,t.axis_y2_tick_outer),i||e.brush&&e.brush.updateScale(e.subX),e.updateArc&&e.updateArc()},l.prototype.selectPoint=function(t,e,i){var n=this,r=n.config,a=(r.axis_rotated?n.circleY:n.circleX).bind(n),o=(r.axis_rotated?n.circleX:n.circleY).bind(n),s=n.pointSelectR.bind(n);r.data_onselected.call(n.api,e,t.node()),n.main.select("."+Y.selectedCircles+n.getTargetSelectorSuffix(e.id)).selectAll("."+Y.selectedCircle+"-"+i).data([e]).enter().append("circle").attr("class",function(){return n.generateClass(Y.selectedCircle,i)}).attr("cx",a).attr("cy",o).attr("stroke",function(){return n.color(e)}).attr("r",function(t){return 1.4*n.pointSelectR(t)}).transition().duration(100).attr("r",s)},l.prototype.unselectPoint=function(t,e,i){this.config.data_onunselected.call(this.api,e,t.node()),this.main.select("."+Y.selectedCircles+this.getTargetSelectorSuffix(e.id)).selectAll("."+Y.selectedCircle+"-"+i).transition().duration(100).attr("r",0).remove()},l.prototype.togglePoint=function(t,e,i,n){t?this.selectPoint(e,i,n):this.unselectPoint(e,i,n)},l.prototype.selectPath=function(t,e){var i=this;i.config.data_onselected.call(i,e,t.node()),i.config.interaction_brighten&&t.transition().duration(100).style("fill",function(){return i.d3.rgb(i.color(e)).brighter(.75)})},l.prototype.unselectPath=function(t,e){var i=this;i.config.data_onunselected.call(i,e,t.node()),i.config.interaction_brighten&&t.transition().duration(100).style("fill",function(){return i.color(e)})},l.prototype.togglePath=function(t,e,i,n){t?this.selectPath(e,i,n):this.unselectPath(e,i,n)},l.prototype.getToggle=function(t,e){var i;return"circle"===t.nodeName?i=this.isStepType(e)?function(){}:this.togglePoint:"path"===t.nodeName&&(i=this.togglePath),i},l.prototype.toggleShape=function(t,e,i){var n=this,r=n.d3,a=n.config,o=r.select(t),s=o.classed(Y.SELECTED),c=n.getToggle(t,e).bind(n);a.data_selection_enabled&&a.data_selection_isselectable(e)&&(a.data_selection_multiple||n.main.selectAll("."+Y.shapes+(a.data_selection_grouped?n.getTargetSelectorSuffix(e.id):"")).selectAll("."+Y.shape).each(function(t,e){var i=r.select(this);i.classed(Y.SELECTED)&&c(!1,i.classed(Y.SELECTED,!1),t,e)}),o.classed(Y.SELECTED,!s),c(!s,o,e,i))},l.prototype.initBar=function(){this.main.select("."+Y.chart).append("g").attr("class",Y.chartBars)},l.prototype.updateTargetsForBar=function(t){var e=this,i=e.config,n=e.classChartBar.bind(e),r=e.classBars.bind(e),a=e.classFocus.bind(e);e.main.select("."+Y.chartBars).selectAll("."+Y.chartBar).data(t).attr("class",function(t){return n(t)+a(t)}).enter().append("g").attr("class",n).style("pointer-events","none").append("g").attr("class",r).style("cursor",function(t){return i.data_selection_isselectable(t)?"pointer":null})},l.prototype.updateBar=function(t){var e=this,i=e.barData.bind(e),n=e.classBar.bind(e),r=e.initialOpacity.bind(e),a=function(t){return e.color(t.id)},o=e.main.selectAll("."+Y.bars).selectAll("."+Y.bar).data(i),s=o.enter().append("path").attr("class",n).style("stroke",a).style("fill",a);e.mainBar=s.merge(o).style("opacity",r),o.exit().transition().duration(t).style("opacity",0)},l.prototype.redrawBar=function(t,e,i){var n=this;return[(e?this.mainBar.transition(i):this.mainBar).attr("d",t).style("stroke",this.color).style("fill",this.color).style("opacity",function(t){return n.isTargetToShow(t.id)?1:0})]},l.prototype.getBarW=function(t,e){var i=this.config,n="number"==typeof i.bar_width?i.bar_width:e?t.tickInterval()*i.bar_width_ratio/e:0;return i.bar_width_max&&n>i.bar_width_max?i.bar_width_max:n},l.prototype.getBars=function(t,e){return(e?this.main.selectAll("."+Y.bars+this.getTargetSelectorSuffix(e)):this.main).selectAll("."+Y.bar+(C(t)?"-"+t:""))},l.prototype.expandBars=function(t,e,i){i&&this.unexpandBars(),this.getBars(t,e).classed(Y.EXPANDED,!0)},l.prototype.unexpandBars=function(t){this.getBars(t).classed(Y.EXPANDED,!1)},l.prototype.generateDrawBar=function(t,e){var a=this.config,o=this.generateGetBarPoints(t,e);return function(t,e){var i=o(t,e),n=a.axis_rotated?1:0,r=a.axis_rotated?0:1;return"M "+i[0][n]+","+i[0][r]+" L"+i[1][n]+","+i[1][r]+" L"+i[2][n]+","+i[2][r]+" L"+i[3][n]+","+i[3][r]+" z"}},l.prototype.generateGetBarPoints=function(t,e){var o=this,i=e?o.subXAxis:o.xAxis,n=t.__max__+1,s=o.getBarW(i,n),c=o.getShapeX(s,n,t,!!e),d=o.getShapeY(!!e),l=o.getShapeOffset(o.isBarType,t,!!e),u=s*(o.config.bar_space/2),h=e?o.getSubYScale:o.getYScale;return function(t,e){var i=h.call(o,t.id)(0),n=l(t,e)||i,r=c(t),a=d(t);return o.config.axis_rotated&&(0<t.value&&a<i||t.value<0&&i<a)&&(a=i),[[r+u,n],[r+u,a-=i-n],[r+s-u,a],[r+s-u,n]]}},l.prototype.isWithinBar=function(t,e){return function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=e.x-i,r=e.x+e.width+i,a=e.y+e.height+i,o=e.y-i;return n<t[0]&&t[0]<r&&o<t[1]&&t[1]<a}(t,c(e),2)},l.prototype.getShapeIndices=function(t){var e,i,n=this.config,r={},a=0;return this.filterTargetsToShow(this.data.targets.filter(t,this)).forEach(function(t){for(e=0;e<n.data_groups.length;e++)if(!(n.data_groups[e].indexOf(t.id)<0))for(i=0;i<n.data_groups[e].length;i++)if(n.data_groups[e][i]in r){r[t.id]=r[n.data_groups[e][i]];break}v(r[t.id])&&(r[t.id]=a++)}),r.__max__=a-1,r},l.prototype.getShapeX=function(i,n,r,t){var a=t?this.subX:this.x;return function(t){var e=t.id in r?r[t.id]:0;return t.x||0===t.x?a(t.x)-i*(n/2-e):0}},l.prototype.getShapeY=function(e){var i=this;return function(t){return(e?i.getSubYScale(t.id):i.getYScale(t.id))(i.isTargetNormalized(t.id)?i.getRatio("index",t,!0):t.value)}},l.prototype.getShapeOffset=function(t,d,e){var l=this,i=l.orderTargets(l.filterTargetsToShow(l.data.targets.filter(t,l))),u=i.map(function(t){return t.id});return function(r,a){var o=e?l.getSubYScale(r.id):l.getYScale(r.id),s=o(0),c=s;return i.forEach(function(t){var e=l.isStepType(r)?l.convertValuesToStep(t.values):t.values,i=l.isTargetNormalized(r.id),n=e.map(function(t){return i?l.getRatio("index",t,!0):t.value});t.id!==r.id&&d[t.id]===d[r.id]&&u.indexOf(t.id)<u.indexOf(r.id)&&((v(e[a])||+e[a].x!=+r.x)&&(a=-1,e.forEach(function(t,e){(t.x.constructor===Date?+t.x:t.x)===(r.x.constructor===Date?+r.x:r.x)&&(a=e)})),a in e&&0<=e[a].value*r.value&&(c+=o(n[a])-s))}),c}},l.prototype.isWithinShape=function(t,e){var i,n=this,r=n.d3.select(t);return n.isTargetToShow(e.id)?"circle"===t.nodeName?i=n.isStepType(e)?n.isWithinStep(t,n.getYScale(e.id)(e.value)):n.isWithinCircle(t,1.5*n.pointSelectR(e)):"path"===t.nodeName&&(i=!r.classed(Y.bar)||n.isWithinBar(n.d3.mouse(t),t)):i=!1,i},l.prototype.getInterpolate=function(t){var e=this,i=e.d3,n={linear:i.curveLinear,"linear-closed":i.curveLinearClosed,basis:i.curveBasis,"basis-open":i.curveBasisOpen,"basis-closed":i.curveBasisClosed,bundle:i.curveBundle,cardinal:i.curveCardinal,"cardinal-open":i.curveCardinalOpen,"cardinal-closed":i.curveCardinalClosed,monotone:i.curveMonotoneX,step:i.curveStep,"step-before":i.curveStepBefore,"step-after":i.curveStepAfter};return e.isSplineType(t)?n[e.config.spline_interpolation_type]||n.cardinal:e.isStepType(t)?n[e.config.line_step_type]:n.linear},l.prototype.initLine=function(){this.main.select("."+Y.chart).append("g").attr("class",Y.chartLines)},l.prototype.updateTargetsForLine=function(t){var e,i=this,n=i.config,r=i.classChartLine.bind(i),a=i.classLines.bind(i),o=i.classAreas.bind(i),s=i.classCircles.bind(i),c=i.classFocus.bind(i);(e=i.main.select("."+Y.chartLines).selectAll("."+Y.chartLine).data(t).attr("class",function(t){return r(t)+c(t)}).enter().append("g").attr("class",r).style("opacity",0).style("pointer-events","none")).append("g").attr("class",a),e.append("g").attr("class",o),e.append("g").attr("class",function(t){return i.generateClass(Y.selectedCircles,t.id)}),e.append("g").attr("class",s).style("cursor",function(t){return n.data_selection_isselectable(t)?"pointer":null}),t.forEach(function(e){i.main.selectAll("."+Y.selectedCircles+i.getTargetSelectorSuffix(e.id)).selectAll("."+Y.selectedCircle).each(function(t){t.value=e.values[t.index].value})})},l.prototype.updateLine=function(t){var e=this,i=e.main.selectAll("."+Y.lines).selectAll("."+Y.line).data(e.lineData.bind(e)),n=i.enter().append("path").attr("class",e.classLine.bind(e)).style("stroke",e.color);e.mainLine=n.merge(i).style("opacity",e.initialOpacity.bind(e)).style("shape-rendering",function(t){return e.isStepType(t)?"crispEdges":""}).attr("transform",null),i.exit().transition().duration(t).style("opacity",0)},l.prototype.redrawLine=function(t,e,i){return[(e?this.mainLine.transition(i):this.mainLine).attr("d",t).style("stroke",this.color).style("opacity",1)]},l.prototype.generateDrawLine=function(t,o){var s=this,c=s.config,d=s.d3.line(),i=s.generateGetLinePoints(t,o),l=o?s.getSubYScale:s.getYScale,e=function(t){return(o?s.subxx:s.xx).call(s,t)},n=function(t,e){return 0<c.data_groups.length?i(t,e)[0][1]:l.call(s,t.id)(t.value)};return d=c.axis_rotated?d.x(n).y(e):d.x(e).y(n),c.line_connectNull||(d=d.defined(function(t){return null!=t.value})),function(t){var e=c.line_connectNull?s.filterRemoveNull(t.values):t.values,i=o?s.subX:s.x,n=l.call(s,t.id),r=0,a=0;return(s.isLineType(t)?c.data_regions[t.id]?s.lineWithRegions(e,i,n,c.data_regions[t.id]):(s.isStepType(t)&&(e=s.convertValuesToStep(e)),d.curve(s.getInterpolate(t))(e)):(e[0]&&(r=i(e[0].x),a=n(e[0].value)),c.axis_rotated?"M "+a+" "+r:"M "+r+" "+a))||"M 0 0"}},l.prototype.generateGetLinePoints=function(t,e){var o=this,s=o.config,i=t.__max__+1,c=o.getShapeX(0,i,t,!!e),d=o.getShapeY(!!e),l=o.getShapeOffset(o.isLineType,t,!!e),u=e?o.getSubYScale:o.getYScale;return function(t,e){var i=u.call(o,t.id)(0),n=l(t,e)||i,r=c(t),a=d(t);return s.axis_rotated&&(0<t.value&&a<i||t.value<0&&i<a)&&(a=i),[[r,a-(i-n)],[r,a-(i-n)],[r,a-(i-n)],[r,a-(i-n)]]}},l.prototype.lineWithRegions=function(t,c,d,e){var i,n,r,a,l,o,s,u,h,g,p,f=this,_=f.config,x="M",y=f.isCategorized()?.5:0,m=[];function S(t,e){var i;for(i=0;i<e.length;i++)if(e[i].start<t&&t<=e[i].end)return!0;return!1}if(k(e))for(i=0;i<e.length;i++)m[i]={},v(e[i].start)?m[i].start=t[0].x:m[i].start=f.isTimeSeries()?f.parseDate(e[i].start):e[i].start,v(e[i].end)?m[i].end=t[t.length-1].x:m[i].end=f.isTimeSeries()?f.parseDate(e[i].end):e[i].end;function w(t){return"M"+t[0][0]+" "+t[0][1]+" "+t[1][0]+" "+t[1][1]}for(g=_.axis_rotated?function(t){return d(t.value)}:function(t){return c(t.x)},p=_.axis_rotated?function(t){return c(t.x)}:function(t){return d(t.value)},r=f.isTimeSeries()?function(t,e,i,n){var r=t.x.getTime(),a=e.x-t.x,o=new Date(r+a*i),s=new Date(r+a*(i+n));return w(_.axis_rotated?[[d(l(i)),c(o)],[d(l(i+n)),c(s)]]:[[c(o),d(l(i))],[c(s),d(l(i+n))]])}:function(t,e,i,n){return w(_.axis_rotated?[[d(l(i),!0),c(a(i))],[d(l(i+n),!0),c(a(i+n))]]:[[c(a(i),!0),d(l(i))],[c(a(i+n),!0),d(l(i+n))]])},i=0;i<t.length;i++){if(v(m)||!S(t[i].x,m))x+=" "+g(t[i])+" "+p(t[i]);else for(a=f.getScale(t[i-1].x+y,t[i].x+y,f.isTimeSeries()),l=f.getScale(t[i-1].value,t[i].value),o=c(t[i].x)-c(t[i-1].x),s=d(t[i].value)-d(t[i-1].value),h=2*(u=2/Math.sqrt(Math.pow(o,2)+Math.pow(s,2))),n=u;n<=1;n+=h)x+=r(t[i-1],t[i],n,u);t[i].x}return x},l.prototype.updateArea=function(t){var e=this,i=e.d3,n=e.main.selectAll("."+Y.areas).selectAll("."+Y.area).data(e.lineData.bind(e)),r=n.enter().append("path").attr("class",e.classArea.bind(e)).style("fill",e.color).style("opacity",function(){return e.orgAreaOpacity=+i.select(this).style("opacity"),0});e.mainArea=r.merge(n).style("opacity",e.orgAreaOpacity),n.exit().transition().duration(t).style("opacity",0)},l.prototype.redrawArea=function(t,e,i){return[(e?this.mainArea.transition(i):this.mainArea).attr("d",t).style("fill",this.color).style("opacity",this.orgAreaOpacity)]},l.prototype.generateDrawArea=function(t,e){var r=this,a=r.config,o=r.d3.area(),i=r.generateGetAreaPoints(t,e),n=e?r.getSubYScale:r.getYScale,s=function(t){return(e?r.subxx:r.xx).call(r,t)},c=function(t,e){return 0<a.data_groups.length?i(t,e)[0][1]:n.call(r,t.id)(r.getAreaBaseValue(t.id))},d=function(t,e){return 0<a.data_groups.length?i(t,e)[1][1]:n.call(r,t.id)(t.value)};return o=a.axis_rotated?o.x0(c).x1(d).y(s):o.x(s).y0(a.area_above?0:c).y1(d),a.line_connectNull||(o=o.defined(function(t){return null!==t.value})),function(t){var e=a.line_connectNull?r.filterRemoveNull(t.values):t.values,i=0,n=0;return(r.isAreaType(t)?(r.isStepType(t)&&(e=r.convertValuesToStep(e)),o.curve(r.getInterpolate(t))(e)):(e[0]&&(i=r.x(e[0].x),n=r.getYScale(t.id)(e[0].value)),a.axis_rotated?"M "+n+" "+i:"M "+i+" "+n))||"M 0 0"}},l.prototype.getAreaBaseValue=function(){return 0},l.prototype.generateGetAreaPoints=function(t,e){var o=this,s=o.config,i=t.__max__+1,c=o.getShapeX(0,i,t,!!e),d=o.getShapeY(!!e),l=o.getShapeOffset(o.isAreaType,t,!!e),u=e?o.getSubYScale:o.getYScale;return function(t,e){var i=u.call(o,t.id)(0),n=l(t,e)||i,r=c(t),a=d(t);return s.axis_rotated&&(0<t.value&&a<i||t.value<0&&i<a)&&(a=i),[[r,n],[r,a-(i-n)],[r,a-(i-n)],[r,n]]}},l.prototype.updateCircle=function(t,e){var i=this,n=i.main.selectAll("."+Y.circles).selectAll("."+Y.circle).data(i.lineOrScatterOrStanfordData.bind(i)),r=n.enter().append("circle").attr("shape-rendering",i.isStanfordGraphType()?"crispEdges":"").attr("class",i.classCircle.bind(i)).attr("cx",t).attr("cy",e).attr("r",i.pointR.bind(i)).style("color",i.isStanfordGraphType()?i.getStanfordPointColor.bind(i):i.color);i.mainCircle=r.merge(n).style("opacity",i.isStanfordGraphType()?1:i.initialOpacityForCircle.bind(i)),n.exit().style("opacity",0)},l.prototype.redrawCircle=function(t,e,i,n){var r=this,a=r.main.selectAll("."+Y.selectedCircle);return[(i?r.mainCircle.transition(n):r.mainCircle).style("opacity",this.opacityForCircle.bind(r)).style("color",r.isStanfordGraphType()?r.getStanfordPointColor.bind(r):r.color).attr("cx",t).attr("cy",e),(i?a.transition(n):a).attr("cx",t).attr("cy",e)]},l.prototype.circleX=function(t){return t.x||0===t.x?this.x(t.x):null},l.prototype.updateCircleY=function(){var t,i,e=this;0<e.config.data_groups.length?(t=e.getShapeIndices(e.isLineType),i=e.generateGetLinePoints(t),e.circleY=function(t,e){return i(t,e)[0][1]}):e.circleY=function(t){return e.getYScale(t.id)(t.value)}},l.prototype.getCircles=function(t,e){return(e?this.main.selectAll("."+Y.circles+this.getTargetSelectorSuffix(e)):this.main).selectAll("."+Y.circle+(C(t)?"-"+t:""))},l.prototype.expandCircles=function(t,e,i){var n=this.pointExpandedR.bind(this);i&&this.unexpandCircles(),this.getCircles(t,e).classed(Y.EXPANDED,!0).attr("r",n)},l.prototype.unexpandCircles=function(t){var e=this,i=e.pointR.bind(e);e.getCircles(t).filter(function(){return e.d3.select(this).classed(Y.EXPANDED)}).classed(Y.EXPANDED,!1).attr("r",i)},l.prototype.pointR=function(t){var e=this.config;return this.isStepType(t)?0:g(e.point_r)?e.point_r(t):e.point_r},l.prototype.pointExpandedR=function(t){var e=this.config;return e.point_focus_expand_enabled?g(e.point_focus_expand_r)?e.point_focus_expand_r(t):e.point_focus_expand_r?e.point_focus_expand_r:1.75*this.pointR(t):this.pointR(t)},l.prototype.pointSelectR=function(t){var e=this.config;return g(e.point_select_r)?e.point_select_r(t):e.point_select_r?e.point_select_r:4*this.pointR(t)},l.prototype.isWithinCircle=function(t,e){var i=this.d3,n=i.mouse(t),r=i.select(t),a=+r.attr("cx"),o=+r.attr("cy");return Math.sqrt(Math.pow(a-n[0],2)+Math.pow(o-n[1],2))<e},l.prototype.isWithinStep=function(t,e){return Math.abs(e-this.d3.mouse(t)[1])<30},l.prototype.getCurrentWidth=function(){var t=this.config;return t.size_width?t.size_width:this.getParentWidth()},l.prototype.getCurrentHeight=function(){var t=this.config,e=t.size_height?t.size_height:this.getParentHeight();return 0<e?e:320/(this.hasType("gauge")&&!t.gauge_fullCircle?2:1)},l.prototype.getCurrentPaddingTop=function(){var t=this.config,e=C(t.padding_top)?t.padding_top:0;return this.title&&this.title.node()&&(e+=this.getTitlePadding()),e},l.prototype.getCurrentPaddingBottom=function(){var t=this.config;return C(t.padding_bottom)?t.padding_bottom:0},l.prototype.getCurrentPaddingLeft=function(t){var e=this.config;return C(e.padding_left)?e.padding_left:e.axis_rotated?!e.axis_x_show||e.axis_x_inner?1:Math.max(r(this.getAxisWidthByAxisId("x",t)),40):!e.axis_y_show||e.axis_y_inner?this.axis.getYAxisLabelPosition().isOuter?30:1:r(this.getAxisWidthByAxisId("y",t))},l.prototype.getCurrentPaddingRight=function(){var t=this,e=t.config,i=0,n=t.isLegendRight?t.getLegendWidth()+20:0;return i=C(e.padding_right)?e.padding_right+1:e.axis_rotated?10+n:!e.axis_y2_show||e.axis_y2_inner?2+n+(t.axis.getY2AxisLabelPosition().isOuter?20:0):r(t.getAxisWidthByAxisId("y2"))+n,t.colorScale&&t.colorScale.node()&&(i+=t.getColorScalePadding()),i},l.prototype.getParentRectValue=function(e){for(var i,n=this.selectChart.node();n&&"BODY"!==n.tagName;){try{i=n.getBoundingClientRect()[e]}catch(t){"width"===e&&(i=n.offsetWidth)}if(i)break;n=n.parentNode}return i},l.prototype.getParentWidth=function(){return this.getParentRectValue("width")},l.prototype.getParentHeight=function(){var t=this.selectChart.style("height");return 0<t.indexOf("px")?+t.replace("px",""):0},l.prototype.getSvgLeft=function(t){var e=this,i=e.config,n=i.axis_rotated||!i.axis_rotated&&!i.axis_y_inner,r=i.axis_rotated?Y.axisX:Y.axisY,a=e.main.select("."+r).node(),o=a&&n?a.getBoundingClientRect():{right:0},s=e.selectChart.node().getBoundingClientRect(),c=e.hasArcType(),d=o.right-s.left-(c?0:e.getCurrentPaddingLeft(t));return 0<d?d:0},l.prototype.getAxisWidthByAxisId=function(t,e){var i=this.axis.getLabelPositionById(t);return this.axis.getMaxTickWidth(t,e)+(i.isInner?20:40)},l.prototype.getHorizontalAxisHeight=function(t){var e=this,i=e.config,n=30;return"x"!==t||i.axis_x_show?"x"===t&&i.axis_x_height?i.axis_x_height:"y"!==t||i.axis_y_show?"y2"!==t||i.axis_y2_show?("x"===t&&!i.axis_rotated&&i.axis_x_tick_rotate&&(n=30+e.axis.getMaxTickWidth(t)*Math.cos(Math.PI*(90-Math.abs(i.axis_x_tick_rotate))/180)),"y"===t&&i.axis_rotated&&i.axis_y_tick_rotate&&(n=30+e.axis.getMaxTickWidth(t)*Math.cos(Math.PI*(90-Math.abs(i.axis_y_tick_rotate))/180)),n+(e.axis.getLabelPositionById(t).isInner?0:10)+("y2"===t?-10:0)):e.rotated_padding_top:!i.legend_show||e.isLegendRight||e.isLegendInset?1:10:8},l.prototype.initBrush=function(t){var r=this,e=r.d3;return r.brush=(r.config.axis_rotated?e.brushY():e.brushX()).on("brush",function(){var t=e.event.sourceEvent;t&&"zoom"===t.type||r.redrawForBrush()}).on("end",function(){var t=e.event.sourceEvent;t&&"zoom"===t.type||r.brush.empty()&&t&&"end"!==t.type&&r.brush.clear()}),r.brush.updateExtent=function(){var t,e=this.scale.range();return t=r.config.axis_rotated?[[0,e[0]],[r.width2,e[1]]]:[[e[0],0],[e[1],r.height2]],this.extent(t),this},r.brush.updateScale=function(t){return this.scale=t,this},r.brush.update=function(t){this.updateScale(t||r.subX).updateExtent(),r.context.select("."+Y.brush).call(this)},r.brush.clear=function(){r.context.select("."+Y.brush).call(r.brush.move,null)},r.brush.selection=function(){return e.brushSelection(r.context.select("."+Y.brush).node())},r.brush.selectionAsValue=function(t,e){var i,n;return t?(r.context&&(i=[this.scale(t[0]),this.scale(t[1])],n=r.context.select("."+Y.brush),e&&(n=n.transition()),r.brush.move(n,i)),[]):(i=r.brush.selection()||[0,0],[this.scale.invert(i[0]),this.scale.invert(i[1])])},r.brush.empty=function(){var t=r.brush.selection();return!t||t[0]===t[1]},r.brush.updateScale(t)},l.prototype.initSubchart=function(){var t=this,e=t.config,i=t.context=t.svg.append("g").attr("transform",t.getTranslate("context")),n=e.subchart_show?"visible":"hidden";i.style("visibility",n),i.append("g").attr("clip-path",t.clipPathForSubchart).attr("class",Y.chart),i.select("."+Y.chart).append("g").attr("class",Y.chartBars),i.select("."+Y.chart).append("g").attr("class",Y.chartLines),i.append("g").attr("clip-path",t.clipPath).attr("class",Y.brush),t.axes.subx=i.append("g").attr("class",Y.axisX).attr("transform",t.getTranslate("subx")).attr("clip-path",e.axis_rotated?"":t.clipPathForXAxis)},l.prototype.initSubchartBrush=function(){this.initBrush(this.subX).updateExtent(),this.context.select("."+Y.brush).call(this.brush)},l.prototype.updateTargetsForSubchart=function(t){var e,i,n,r,a=this,o=a.context,s=a.config,c=a.classChartBar.bind(a),d=a.classBars.bind(a),l=a.classChartLine.bind(a),u=a.classLines.bind(a),h=a.classAreas.bind(a);s.subchart_show&&((n=(r=o.select("."+Y.chartBars).selectAll("."+Y.chartBar).data(t)).enter().append("g").style("opacity",0)).merge(r).attr("class",c),n.append("g").attr("class",d),(e=(i=o.select("."+Y.chartLines).selectAll("."+Y.chartLine).data(t)).enter().append("g").style("opacity",0)).merge(i).attr("class",l),e.append("g").attr("class",u),e.append("g").attr("class",h),o.selectAll("."+Y.brush+" rect").attr(s.axis_rotated?"width":"height",s.axis_rotated?a.width2:a.height2))},l.prototype.updateBarForSubchart=function(t){var e=this,i=e.context.selectAll("."+Y.bars).selectAll("."+Y.bar).data(e.barData.bind(e)),n=i.enter().append("path").attr("class",e.classBar.bind(e)).style("stroke","none").style("fill",e.color);i.exit().transition().duration(t).style("opacity",0).remove(),e.contextBar=n.merge(i).style("opacity",e.initialOpacity.bind(e))},l.prototype.redrawBarForSubchart=function(t,e,i){(e?this.contextBar.transition(Math.random().toString()).duration(i):this.contextBar).attr("d",t).style("opacity",1)},l.prototype.updateLineForSubchart=function(t){var e=this,i=e.context.selectAll("."+Y.lines).selectAll("."+Y.line).data(e.lineData.bind(e)),n=i.enter().append("path").attr("class",e.classLine.bind(e)).style("stroke",e.color);i.exit().transition().duration(t).style("opacity",0).remove(),e.contextLine=n.merge(i).style("opacity",e.initialOpacity.bind(e))},l.prototype.redrawLineForSubchart=function(t,e,i){(e?this.contextLine.transition(Math.random().toString()).duration(i):this.contextLine).attr("d",t).style("opacity",1)},l.prototype.updateAreaForSubchart=function(t){var e=this,i=e.d3,n=e.context.selectAll("."+Y.areas).selectAll("."+Y.area).data(e.lineData.bind(e)),r=n.enter().append("path").attr("class",e.classArea.bind(e)).style("fill",e.color).style("opacity",function(){return e.orgAreaOpacity=+i.select(this).style("opacity"),0});n.exit().transition().duration(t).style("opacity",0).remove(),e.contextArea=r.merge(n).style("opacity",0)},l.prototype.redrawAreaForSubchart=function(t,e,i){(e?this.contextArea.transition(Math.random().toString()).duration(i):this.contextArea).attr("d",t).style("fill",this.color).style("opacity",this.orgAreaOpacity)},l.prototype.redrawSubchart=function(t,e,i,n,r,a,o){var s,c,d,l=this,u=l.d3,h=l.config;l.context.style("visibility",h.subchart_show?"visible":"hidden"),h.subchart_show&&(u.event&&"zoom"===u.event.type&&l.brush.selectionAsValue(l.x.orgDomain()),t&&(l.brush.empty()||l.brush.selectionAsValue(l.x.orgDomain()),s=l.generateDrawArea(r,!0),c=l.generateDrawBar(a,!0),d=l.generateDrawLine(o,!0),l.updateBarForSubchart(i),l.updateLineForSubchart(i),l.updateAreaForSubchart(i),l.redrawBarForSubchart(c,i,i),l.redrawLineForSubchart(d,i,i),l.redrawAreaForSubchart(s,i,i)))},l.prototype.redrawForBrush=function(){var t,e=this,i=e.x,n=e.d3;e.redraw({withTransition:!1,withY:e.config.zoom_rescale,withSubchart:!1,withUpdateXDomain:!0,withEventRect:!1,withDimension:!1}),t=n.event.selection||e.brush.scale.range(),e.main.select("."+Y.eventRect).call(e.zoom.transform,n.zoomIdentity.scale(e.width/(t[1]-t[0])).translate(-t[0],0)),e.config.subchart_onbrush.call(e.api,i.orgDomain())},l.prototype.transformContext=function(t,e){var i;e&&e.axisSubX?i=e.axisSubX:(i=this.context.select("."+Y.axisX),t&&(i=i.transition())),this.context.attr("transform",this.getTranslate("context")),i.attr("transform",this.getTranslate("subx"))},l.prototype.getDefaultSelection=function(){var t=this,e=t.config,i=g(e.axis_x_selection)?e.axis_x_selection(t.getXDomain(t.data.targets)):e.axis_x_selection;return t.isTimeSeries()&&(i=[t.parseDate(i[0]),t.parseDate(i[1])]),i},l.prototype.initText=function(){this.main.select("."+Y.chart).append("g").attr("class",Y.chartTexts),this.mainText=this.d3.selectAll([])},l.prototype.updateTargetsForText=function(t){var e=this,i=e.classChartText.bind(e),n=e.classTexts.bind(e),r=e.classFocus.bind(e),a=e.main.select("."+Y.chartTexts).selectAll("."+Y.chartText).data(t),o=a.enter().append("g").attr("class",i).style("opacity",0).style("pointer-events","none");o.append("g").attr("class",n),o.merge(a).attr("class",function(t){return i(t)+r(t)})},l.prototype.updateText=function(t,e,i){var n=this,r=n.config,a=n.barOrLineData.bind(n),o=n.classText.bind(n),s=n.main.selectAll("."+Y.texts).selectAll("."+Y.text).data(a),c=s.enter().append("text").attr("class",o).attr("text-anchor",function(t){return r.axis_rotated?t.value<0?"end":"start":"middle"}).style("stroke","none").attr("x",t).attr("y",e).style("fill",function(t){return n.color(t)}).style("fill-opacity",0);n.mainText=c.merge(s).text(function(t,e,i){return n.dataLabelFormat(t.id)(t.value,t.id,e,i)}),s.exit().transition().duration(i).style("fill-opacity",0).remove()},l.prototype.redrawText=function(t,e,i,n,r){return[(n?this.mainText.transition(r):this.mainText).attr("x",t).attr("y",e).style("fill",this.color).style("fill-opacity",i?0:this.opacityForText.bind(this))]},l.prototype.getTextRect=function(t,e,i){var n,r=this.d3.select("body").append("div").classed("c3",!0),a=r.append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0),o=this.d3.select(i).style("font");return a.selectAll(".dummy").data([t]).enter().append("text").classed(e||"",!0).style("font",o).text(t).each(function(){n=c(this)}),r.remove(),n},l.prototype.generateXYForText=function(t,e,i,n){var r=this,a=r.generateGetAreaPoints(t,!1),o=r.generateGetBarPoints(e,!1),s=r.generateGetLinePoints(i,!1),c=n?r.getXForText:r.getYForText;return function(t,e){var i=r.isAreaType(t)?a:r.isBarType(t)?o:s;return c.call(r,i(t,e),t,this)}},l.prototype.getXForText=function(t,e,i){var n,r,a=this,o=c(i);return n=a.config.axis_rotated?(r=a.isBarType(e)?4:6,t[2][1]+r*(e.value<0?-1:1)):a.hasType("bar")?(t[2][0]+t[0][0])/2:t[0][0],null===e.value&&(n>a.width?n=a.width-o.width:n<0&&(n=4)),n},l.prototype.getYForText=function(t,e,i){var n,r=this,a=c(i);return r.config.axis_rotated?n=(t[0][0]+t[2][0]+.6*a.height)/2:(n=t[2][1],e.value<0||0===e.value&&!r.hasPositiveValue?(n+=a.height,r.isBarType(e)&&r.isSafari()?n-=3:!r.isBarType(e)&&r.isChrome()&&(n+=3)):n+=r.isBarType(e)?-3:-6),null!==e.value||r.config.axis_rotated||(n<a.height?n=a.height:n>this.height&&(n=this.height-4)),n},l.prototype.initTitle=function(){this.title=this.svg.append("text").text(this.config.title_text).attr("class",this.CLASS.title)},l.prototype.redrawTitle=function(){var t=this;t.title.attr("x",t.xForTitle.bind(t)).attr("y",t.yForTitle.bind(t))},l.prototype.xForTitle=function(){var t=this,e=t.config,i=e.title_position||"left";return 0<=i.indexOf("right")?t.currentWidth-t.getTextRect(t.title.node().textContent,t.CLASS.title,t.title.node()).width-e.title_padding.right:0<=i.indexOf("center")?Math.max((t.currentWidth-t.getTextRect(t.title.node().textContent,t.CLASS.title,t.title.node()).width)/2,0):e.title_padding.left},l.prototype.yForTitle=function(){var t=this;return t.config.title_padding.top+t.getTextRect(t.title.node().textContent,t.CLASS.title,t.title.node()).height},l.prototype.getTitlePadding=function(){return this.yForTitle()+this.config.title_padding.bottom},l.prototype.drawColorScale=function(){var t,e,i,n,r,a,o,s=this,c=s.d3,d=s.config,l=s.data.targets[0];if(t=isNaN(d.stanford_scaleWidth)?20:d.stanford_scaleWidth,5,t<0)throw Error("Colorscale's barheight and barwidth must be greater than 0.");o=s.height-d.stanford_padding.bottom-d.stanford_padding.top,i=c.range(d.stanford_padding.bottom,o,5),a=c.scaleSequential(l.colors).domain([i[i.length-1],i[0]]),s.colorScale&&s.colorScale.remove(),s.colorScale=s.svg.append("g").attr("width",50).attr("height",o).attr("class",Y.colorScale),s.colorScale.append("g").attr("transform","translate(0, ".concat(d.stanford_padding.top,")")).selectAll("bars").data(i).enter().append("rect").attr("y",function(t,e){return 5*e}).attr("x",0).attr("width",t).attr("height",5).attr("fill",function(t){return a(t)}),r=c.scaleLog().domain([l.minEpochs,l.maxEpochs]).range([i[0]+d.stanford_padding.top+i[i.length-1]+5-1,i[0]+d.stanford_padding.top]),n=c.axisRight(r),"pow10"===d.stanford_scaleFormat?n.tickValues([1,10,100,1e3,1e4,1e5,1e6,1e7]):g(d.stanford_scaleFormat)?n.tickFormat(d.stanford_scaleFormat):n.tickFormat(c.format("d")),g(d.stanford_scaleValues)&&n.tickValues(d.stanford_scaleValues(l.minEpochs,l.maxEpochs)),e=s.colorScale.append("g").attr("class","legend axis").attr("transform","translate(".concat(t,",0)")).call(n),"pow10"===d.stanford_scaleFormat&&e.selectAll(".tick text").text(null).filter(m).text(10).append("tspan").attr("dy","-.7em").text(function(t){return Math.round(Math.log(t)/Math.LN10)}),s.colorScale.attr("transform","translate(".concat(s.currentWidth-s.xForColorScale(),", 0)"))},l.prototype.xForColorScale=function(){return this.config.stanford_padding.right+c(this.colorScale.node()).width},l.prototype.getColorScalePadding=function(){return this.xForColorScale()+this.config.stanford_padding.left+20},l.prototype.isStanfordGraphType=function(){return"stanford"===this.config.data_type},l.prototype.initStanfordData=function(){var t,e,i,n=this.d3,r=this.config,a=this.data.targets[0];if(a.values.sort(b),t=a.values.map(function(t){return t.epochs}),i=isNaN(r.stanford_scaleMin)?n.min(t):r.stanford_scaleMin,(e=isNaN(r.stanford_scaleMax)?n.max(t):r.stanford_scaleMax)<i)throw Error("Number of minEpochs has to be smaller than maxEpochs");a.colors=g(r.stanford_colors)?r.stanford_colors:n.interpolateHslLong(n.hsl(250,1,.5),n.hsl(0,1,.5)),a.colorscale=n.scaleSequentialLog(a.colors).domain([i,e]),a.minEpochs=i,a.maxEpochs=e},l.prototype.getStanfordPointColor=function(t){return this.data.targets[0].colorscale(t.epochs)},l.prototype.getCentroid=function(t){var e,i,n,r,a,o=S(t),s=0,c=0;for(e=0,i=t.length-1;e<t.length;i=e,e+=1)r=t[e],a=t[i],n=r.x*a.y-a.x*r.y,s+=(r.x+a.x)*n,c+=(r.y+a.y)*n;return{x:s/(n=6*o),y:c/n}},l.prototype.getStanfordTooltipTitle=function(t){var e=this.axis.getLabelText("x"),i=this.axis.getLabelText("y");return"\n      <tr><th>".concat(e?_(e):"x","</th><th class='value'>").concat(t.x,"</th></tr>\n      <tr><th>").concat(i?_(i):"y","</th><th class='value'>").concat(t.value,"</th></tr>\n    ")},l.prototype.countEpochsInRegion=function(i){var t,e,n=this.data.targets[0];return t=n.values.reduce(function(t,e){return t+Number(e.epochs)},0),{value:e=n.values.reduce(function(t,e){return w(e,i)?t+Number(e.epochs):t},0),percentage:0!==e?(e/t*100).toFixed(1):0}};var S=function(t){var e,i,n,r,a=0;for(e=0,i=t.length-1;e<t.length;i=e,e+=1)n=t[e],r=t[i],a+=n.x*r.y,a-=n.y*r.x;return a/=2},w=function(t,e){for(var i,n,r,a,o=t.x,s=t.value,c=!1,d=0,l=e.length-1;d<e.length;l=d++)i=e[d].x,n=e[d].y,a=e[l].x,s<n!=s<(r=e[l].y)&&o<(a-i)*(s-n)/(r-n)+i&&(c=!c);return c},b=function(t,e){return t.epochs<e.epochs?-1:t.epochs>e.epochs?1:0};return l.prototype.initStanfordElements=function(){var t=this;t.stanfordElements=t.main.select("."+Y.chart).append("g").attr("class",Y.stanfordElements),t.stanfordElements.append("g").attr("class",Y.stanfordLines),t.stanfordElements.append("g").attr("class",Y.stanfordTexts),t.stanfordElements.append("g").attr("class",Y.stanfordRegions)},l.prototype.updateStanfordElements=function(t){var e,i,n,r,a,o,s=this,c=s.main,d=s.config,l=s.xvCustom.bind(s),u=s.yvCustom.bind(s),h=s.countEpochsInRegion.bind(s);(i=(e=c.select("."+Y.stanfordLines).style("shape-rendering","geometricprecision").selectAll("."+Y.stanfordLine).data(d.stanford_lines)).enter().append("g").attr("class",function(t){return Y.stanfordLine+(t.class?" "+t.class:"")})).append("line").attr("x1",function(t){return d.axis_rotated?u(t,"value_y1"):l(t,"value_x1")}).attr("x2",function(t){return d.axis_rotated?u(t,"value_y2"):l(t,"value_x2")}).attr("y1",function(t){return d.axis_rotated?l(t,"value_x1"):u(t,"value_y1")}).attr("y2",function(t){return d.axis_rotated?l(t,"value_x2"):u(t,"value_y2")}).style("opacity",0),s.stanfordLines=i.merge(e),s.stanfordLines.select("line").transition().duration(t).attr("x1",function(t){return d.axis_rotated?u(t,"value_y1"):l(t,"value_x1")}).attr("x2",function(t){return d.axis_rotated?u(t,"value_y2"):l(t,"value_x2")}).attr("y1",function(t){return d.axis_rotated?l(t,"value_x1"):u(t,"value_y1")}).attr("y2",function(t){return d.axis_rotated?l(t,"value_x2"):u(t,"value_y2")}).style("opacity",1),e.exit().transition().duration(t).style("opacity",0).remove(),(o=(a=c.select("."+Y.stanfordTexts).selectAll("."+Y.stanfordText).data(d.stanford_texts)).enter().append("g").attr("class",function(t){return Y.stanfordText+(t.class?" "+t.class:"")})).append("text").attr("x",function(t){return d.axis_rotated?u(t,"y"):l(t,"x")}).attr("y",function(t){return d.axis_rotated?l(t,"x"):u(t,"y")}).style("opacity",0),s.stanfordTexts=o.merge(a),s.stanfordTexts.select("text").transition().duration(t).attr("x",function(t){return d.axis_rotated?u(t,"y"):l(t,"x")}).attr("y",function(t){return d.axis_rotated?l(t,"x"):u(t,"y")}).text(function(t){return t.content}).style("opacity",1),a.exit().transition().duration(t).style("opacity",0).remove(),(r=(n=c.select("."+Y.stanfordRegions).selectAll("."+Y.stanfordRegion).data(d.stanford_regions)).enter().append("g").attr("class",function(t){return Y.stanfordRegion+(t.class?" "+t.class:"")})).append("polygon").attr("points",function(t){return t.points.map(function(t){return[d.axis_rotated?u(t,"y"):l(t,"x"),d.axis_rotated?l(t,"x"):u(t,"y")].join(",")}).join(" ")}).style("opacity",0),r.append("text").attr("x",function(t){return s.getCentroid(t.points).x}).attr("y",function(t){return s.getCentroid(t.points).y}).style("opacity",0),s.stanfordRegions=r.merge(n),s.stanfordRegions.select("polygon").transition().duration(t).attr("points",function(t){return t.points.map(function(t){return[d.axis_rotated?u(t,"y"):l(t,"x"),d.axis_rotated?l(t,"x"):u(t,"y")].join(",")}).join(" ")}).style("opacity",function(t){return t.opacity?t.opacity:.2}),s.stanfordRegions.select("text").transition().duration(t).attr("x",function(t){return d.axis_rotated?u(s.getCentroid(t.points),"y"):l(s.getCentroid(t.points),"x")}).attr("y",function(t){return d.axis_rotated?l(s.getCentroid(t.points),"x"):u(s.getCentroid(t.points),"y")}).text(function(t){var e,i,n;return t.text?(s.isStanfordGraphType()&&(e=(n=h(t.points)).value,i=n.percentage),t.text(e,i)):""}).attr("text-anchor","middle").attr("dominant-baseline","middle").style("opacity",1),n.exit().transition().duration(t).style("opacity",0).remove()},l.prototype.initTooltip=function(){var t,e=this,i=e.config;if(e.tooltip=e.selectChart.style("position","relative").append("div").attr("class",Y.tooltipContainer).style("position","absolute").style("pointer-events","none").style("display","none"),i.tooltip_init_show){if(e.isTimeSeries()&&p(i.tooltip_init_x)){for(i.tooltip_init_x=e.parseDate(i.tooltip_init_x),t=0;t<e.data.targets[0].values.length&&e.data.targets[0].values[t].x-i.tooltip_init_x!=0;t++);i.tooltip_init_x=t}e.tooltip.html(i.tooltip_contents.call(e,e.data.targets.map(function(t){return e.addName(t.values[i.tooltip_init_x])}),e.axis.getXAxisTickFormat(),e.getYFormat(e.hasArcType()),e.color)),e.tooltip.style("top",i.tooltip_init_position.top).style("left",i.tooltip_init_position.left).style("display","block")}},l.prototype.getTooltipSortFunction=function(){var t=this,e=t.config;if(0!==e.data_groups.length&&void 0===e.tooltip_order){var i=t.orderTargets(t.data.targets).map(function(t){return t.id});return(t.isOrderAsc()||t.isOrderDesc())&&(i=i.reverse()),function(t,e){return i.indexOf(t.id)-i.indexOf(e.id)}}var n=e.tooltip_order;void 0===n&&(n=e.data_order);var r=function(t){return t?t.value:null};if(p(n)&&"asc"===n.toLowerCase())return function(t,e){return r(t)-r(e)};if(p(n)&&"desc"===n.toLowerCase())return function(t,e){return r(e)-r(t)};if(g(n)){var a=n;return void 0===e.tooltip_order&&(a=function(t,e){return n(t?{id:t.id,values:[t]}:null,e?{id:e.id,values:[e]}:null)}),a}return h(n)?function(t,e){return n.indexOf(t.id)-n.indexOf(e.id)}:void 0},l.prototype.getTooltipContent=function(t,e,i,n){var r,a,o,s,c,d,l=this,u=l.config,h=u.tooltip_format_title||e,g=u.tooltip_format_name||function(t){return t},p=u.tooltip_format_value;p||(p=l.isTargetNormalized(t.id)?function(t,e){return"".concat((100*e).toFixed(2),"%")}:i);var f=this.getTooltipSortFunction();for(f&&t.sort(f),a=0;a<t.length;a++)if(t[a]&&(t[a].value||0===t[a].value)){if(l.isStanfordGraphType())r||(o=l.getStanfordTooltipTitle(t[a]),r="<table class='"+l.CLASS.tooltip+"'>"+o),d=l.getStanfordPointColor(t[a]),c=_(u.data_epochs),s=t[a].epochs;else if(r||(o=_(h?h(t[a].x,t[a].index):t[a].x),r="<table class='"+l.CLASS.tooltip+"'>"+(o||0===o?"<tr><th colspan='2'>"+o+"</th></tr>":"")),void 0!==(s=_(p(t[a].value,t[a].ratio,t[a].id,t[a].index,t)))){if(null===t[a].name)continue;c=_(g(t[a].name,t[a].ratio,t[a].id,t[a].index)),d=l.levelColor?l.levelColor(t[a].value):n(t[a].id)}void 0!==s&&(r+="<tr class='"+l.CLASS.tooltipName+"-"+l.getTargetSelectorSuffix(t[a].id)+"'>",r+="<td class='name'><span style='background-color:"+d+"'></span>"+c+"</td>",r+="<td class='value'>"+s+"</td>",r+="</tr>")}return r+"</table>"},l.prototype.tooltipPosition=function(t,e,i,n){var r,a,o,s,c,d=this,l=d.config,u=d.d3,h=d.hasArcType(),g=u.mouse(n);return h?(a=(d.width-(d.isLegendRight?d.getLegendWidth():0))/2+g[0],s=(d.hasType("gauge")?d.height:d.height/2)+g[1]+20):(r=d.getSvgLeft(!0),s=l.axis_rotated?(o=(a=r+g[0]+100)+e,c=d.currentWidth-d.getCurrentPaddingRight(),d.x(t[0].x)+20):(o=(a=r+d.getCurrentPaddingLeft(!0)+d.x(t[0].x)+20)+e,c=r+d.currentWidth-d.getCurrentPaddingRight(),g[1]+15),c<o&&(a-=o-c+20),s+i>d.currentHeight&&(s-=i+30)),s<0&&(s=0),{top:s,left:a}},l.prototype.showTooltip=function(t,e){var i,n,r,a=this,o=a.config,s=a.hasArcType(),c=t.filter(function(t){return t&&C(t.value)}),d=o.tooltip_position||l.prototype.tooltipPosition;0!==c.length&&o.tooltip_show&&(a.tooltip.html(o.tooltip_contents.call(a,t,a.axis.getXAxisTickFormat(),a.getYFormat(s),a.color)).style("display","block"),i=a.tooltip.property("offsetWidth"),n=a.tooltip.property("offsetHeight"),r=d.call(this,c,i,n,e),a.tooltip.style("top",r.top+"px").style("left",r.left+"px"))},l.prototype.hideTooltip=function(){this.tooltip.style("display","none")},l.prototype.setTargetType=function(t,e){var i=this,n=i.config;i.mapToTargetIds(t).forEach(function(t){i.withoutFadeIn[t]=e===n.data_types[t],n.data_types[t]=e}),t||(n.data_type=e)},l.prototype.hasType=function(i,t){var n=this.config.data_types,r=!1;return(t=t||this.data.targets)&&t.length?t.forEach(function(t){var e=n[t.id];(e&&0<=e.indexOf(i)||!e&&"line"===i)&&(r=!0)}):Object.keys(n).length?Object.keys(n).forEach(function(t){n[t]===i&&(r=!0)}):r=this.config.data_type===i,r},l.prototype.hasArcType=function(t){return this.hasType("pie",t)||this.hasType("donut",t)||this.hasType("gauge",t)},l.prototype.isLineType=function(t){var e=this.config,i=p(t)?t:t.id;return!e.data_types[i]||0<=["line","spline","area","area-spline","step","area-step"].indexOf(e.data_types[i])},l.prototype.isStepType=function(t){var e=p(t)?t:t.id;return 0<=["step","area-step"].indexOf(this.config.data_types[e])},l.prototype.isSplineType=function(t){var e=p(t)?t:t.id;return 0<=["spline","area-spline"].indexOf(this.config.data_types[e])},l.prototype.isAreaType=function(t){var e=p(t)?t:t.id;return 0<=["area","area-spline","area-step"].indexOf(this.config.data_types[e])},l.prototype.isBarType=function(t){var e=p(t)?t:t.id;return"bar"===this.config.data_types[e]},l.prototype.isScatterType=function(t){var e=p(t)?t:t.id;return"scatter"===this.config.data_types[e]},l.prototype.isStanfordType=function(t){var e=p(t)?t:t.id;return"stanford"===this.config.data_types[e]},l.prototype.isPieType=function(t){var e=p(t)?t:t.id;return"pie"===this.config.data_types[e]},l.prototype.isGaugeType=function(t){var e=p(t)?t:t.id;return"gauge"===this.config.data_types[e]},l.prototype.isDonutType=function(t){var e=p(t)?t:t.id;return"donut"===this.config.data_types[e]},l.prototype.isArcType=function(t){return this.isPieType(t)||this.isDonutType(t)||this.isGaugeType(t)},l.prototype.lineData=function(t){return this.isLineType(t)?[t]:[]},l.prototype.arcData=function(t){return this.isArcType(t.data)?[t]:[]},l.prototype.barData=function(t){return this.isBarType(t)?t.values:[]},l.prototype.lineOrScatterOrStanfordData=function(t){return this.isLineType(t)||this.isScatterType(t)||this.isStanfordType(t)?t.values:[]},l.prototype.barOrLineData=function(t){return this.isBarType(t)||this.isLineType(t)?t.values:[]},l.prototype.isSafari=function(){var t=window.navigator.userAgent;return 0<=t.indexOf("Safari")&&t.indexOf("Chrome")<0},l.prototype.isChrome=function(){return 0<=window.navigator.userAgent.indexOf("Chrome")},l.prototype.initZoom=function(){var e,i=this,n=i.d3,r=i.config;return i.zoom=n.zoom().on("start",function(){if("scroll"===r.zoom_type){var t=n.event.sourceEvent;t&&"brush"===t.type||(e=t,r.zoom_onzoomstart.call(i.api,t))}}).on("zoom",function(){if("scroll"===r.zoom_type){var t=n.event.sourceEvent;t&&"brush"===t.type||(i.redrawForZoom(),r.zoom_onzoom.call(i.api,i.x.orgDomain()))}}).on("end",function(){if("scroll"===r.zoom_type){var t=n.event.sourceEvent;t&&"brush"===t.type||t&&e.clientX===t.clientX&&e.clientY===t.clientY||r.zoom_onzoomend.call(i.api,i.x.orgDomain())}}),i.zoom.updateDomain=function(){return n.event&&n.event.transform&&i.x.domain(n.event.transform.rescaleX(i.subX).domain()),this},i.zoom.updateExtent=function(){return this.scaleExtent([1,1/0]).translateExtent([[0,0],[i.width,i.height]]).extent([[0,0],[i.width,i.height]]),this},i.zoom.update=function(){return this.updateExtent().updateDomain()},i.zoom.updateExtent()},l.prototype.zoomTransform=function(t){var e=[this.x(t[0]),this.x(t[1])];return this.d3.zoomIdentity.scale(this.width/(e[1]-e[0])).translate(-e[0],0)},l.prototype.initDragZoom=function(){var e=this,i=e.d3,n=e.config,t=e.context=e.svg,r=e.margin.left+20.5,a=e.margin.top+.5;if("drag"===n.zoom_type&&n.zoom_enabled){var o=function(t){return t&&t.map(function(t){return e.x.invert(t)})},s=e.dragZoomBrush=i.brushX().on("start",function(){e.api.unzoom(),e.svg.select("."+Y.dragZoom).classed("disabled",!1),n.zoom_onzoomstart.call(e.api,i.event.sourceEvent)}).on("brush",function(){n.zoom_onzoom.call(e.api,o(i.event.selection))}).on("end",function(){if(null!=i.event.selection){var t=o(i.event.selection);n.zoom_disableDefaultBehavior||e.api.zoom(t),e.svg.select("."+Y.dragZoom).classed("disabled",!0),n.zoom_onzoomend.call(e.api,t)}});t.append("g").classed(Y.dragZoom,!0).attr("clip-path",e.clipPath).attr("transform","translate("+r+","+a+")").call(s)}},l.prototype.getZoomDomain=function(){var t=this.config,e=this.d3;return[e.min([this.orgXDomain[0],t.zoom_x_min]),e.max([this.orgXDomain[1],t.zoom_x_max])]},l.prototype.redrawForZoom=function(){var t=this,e=t.d3,i=t.config,n=t.zoom,r=t.x;i.zoom_enabled&&0!==t.filterTargetsToShow(t.data.targets).length&&(n.update(),i.zoom_disableDefaultBehavior||(t.isCategorized()&&r.orgDomain()[0]===t.orgXDomain[0]&&r.domain([t.orgXDomain[0]-1e-10,r.orgDomain()[1]]),t.redraw({withTransition:!1,withY:i.zoom_rescale,withSubchart:!1,withEventRect:!1,withDimension:!1}),e.event.sourceEvent&&"mousemove"===e.event.sourceEvent.type&&(t.cancelClick=!0)))},t});
define('theme_material_boost/navigation_restriction', ['jquery'], function($) {
    return {
        init: function(args) {

            //console.log(args);
            var rightclickmsg = args.rightclickmsg;

            //Disable RIght click
            // This modal should be included by default at all places, irrespective of any user bcz we use the same modal for vpl
            var rightclickmodal = '<div class="modal fade" id="user-notify-modal" role="dialog">' +
                '<div class="modal-dialog">' +
                '<div class="modal-content">' +
                '<div class="modal-header"> ' +
                '<div align="center" class="modal-title">  ' + rightclickmsg + ' </div> </div>' +
                '</div></div></div>';

            $("#page-header").append(rightclickmodal);

            $('#usernotify_close').click(function() {
                $("#user-notify-modal").modal('hide');
            });

            function logMouseEvent(event) {
                // Its right click
                if (event.button == 2) {
                    $("#user-notify-modal").modal("show");
                }
            }

            var url = $(location).attr('href');
            var sysrole = args.sysrole;


            // Right clicking anywhere will trigger the modal
            if ($('body.sysrole-' + sysrole).length === 1) {
                document.onmousedown = logMouseEvent
            }

            //Closing old tabs when user opens new tab in same browser
            if (!url.includes("navigation_warning.php") && $('body.sysrole-' + sysrole).length === 1) {
                localStorage.setItem("current_url", url);
            }

            function redirectonnavigation() {

                if (!url.includes("navigation_warning.php") &&
                    $('body.sysrole-' + sysrole).length === 1 &&
                    !url.includes("coursetimer/verify.php") &&
                    !url.includes("coursetimer/verify.php") &&
                    localStorage.getItem("current_url") !== url
                ) {

                    // Unsaved changes handle
                    if (url.includes("mod/vpl/forms/edit.php")) {
                        // VPL
                        $('#vpl_ide_save')[0].click();
                        setTimeout(function() {
                            window.location.replace(M.cfg.wwwroot + "/navigation_warning.php");
                        }, 5000);

                    } else if (url.includes("/mod/quiz/attempt.php")) {
                        // QUIZ
                        $('.submitbtns .mod_quiz-next-nav').click();

                    } else if (url.includes("mod/assign/view.php") && url.includes("action=editsubmission")) {
                        // ASSIGNMENT
                        $('#id_submitbutton').click();
                    } else {
                        window.location.replace(M.cfg.wwwroot + "/navigation_warning.php");
                    }
                } else {
                    setTimeout(function() { redirectonnavigation(); }, 3000);
                }
            }

            redirectonnavigation();
            // setInterval(function() {}, 3000);
        }
    };
});
// https://d3js.org v5.12.0 Copyright 2019 Mike Bostock
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define('theme_material_boost/d3', ["exports"],n):n((t=t||self).d3=t.d3||{})}(this,function(t){"use strict";function n(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function e(t){var e;return 1===t.length&&(e=t,t=function(t,r){return n(e(t),r)}),{left:function(n,e,r,i){for(null==r&&(r=0),null==i&&(i=n.length);r<i;){var o=r+i>>>1;t(n[o],e)<0?r=o+1:i=o}return r},right:function(n,e,r,i){for(null==r&&(r=0),null==i&&(i=n.length);r<i;){var o=r+i>>>1;t(n[o],e)>0?i=o:r=o+1}return r}}}var r=e(n),i=r.right,o=r.left;function a(t,n){return[t,n]}function u(t){return null===t?NaN:+t}function c(t,n){var e,r,i=t.length,o=0,a=-1,c=0,f=0;if(null==n)for(;++a<i;)isNaN(e=u(t[a]))||(f+=(r=e-c)*(e-(c+=r/++o)));else for(;++a<i;)isNaN(e=u(n(t[a],a,t)))||(f+=(r=e-c)*(e-(c+=r/++o)));if(o>1)return f/(o-1)}function f(t,n){var e=c(t,n);return e?Math.sqrt(e):e}function s(t,n){var e,r,i,o=t.length,a=-1;if(null==n){for(;++a<o;)if(null!=(e=t[a])&&e>=e)for(r=i=e;++a<o;)null!=(e=t[a])&&(r>e&&(r=e),i<e&&(i=e))}else for(;++a<o;)if(null!=(e=n(t[a],a,t))&&e>=e)for(r=i=e;++a<o;)null!=(e=n(t[a],a,t))&&(r>e&&(r=e),i<e&&(i=e));return[r,i]}var l=Array.prototype,h=l.slice,d=l.map;function p(t){return function(){return t}}function v(t){return t}function g(t,n,e){t=+t,n=+n,e=(i=arguments.length)<2?(n=t,t=0,1):i<3?1:+e;for(var r=-1,i=0|Math.max(0,Math.ceil((n-t)/e)),o=new Array(i);++r<i;)o[r]=t+r*e;return o}var y=Math.sqrt(50),_=Math.sqrt(10),b=Math.sqrt(2);function m(t,n,e){var r,i,o,a,u=-1;if(e=+e,(t=+t)===(n=+n)&&e>0)return[t];if((r=n<t)&&(i=t,t=n,n=i),0===(a=x(t,n,e))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),n=Math.floor(n/a),o=new Array(i=Math.ceil(n-t+1));++u<i;)o[u]=(t+u)*a;else for(t=Math.floor(t*a),n=Math.ceil(n*a),o=new Array(i=Math.ceil(t-n+1));++u<i;)o[u]=(t-u)/a;return r&&o.reverse(),o}function x(t,n,e){var r=(n-t)/Math.max(0,e),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=y?10:o>=_?5:o>=b?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=y?10:o>=_?5:o>=b?2:1)}function w(t,n,e){var r=Math.abs(n-t)/Math.max(0,e),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=y?i*=10:o>=_?i*=5:o>=b&&(i*=2),n<t?-i:i}function M(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1}function N(t,n,e){if(null==e&&(e=u),r=t.length){if((n=+n)<=0||r<2)return+e(t[0],0,t);if(n>=1)return+e(t[r-1],r-1,t);var r,i=(r-1)*n,o=Math.floor(i),a=+e(t[o],o,t);return a+(+e(t[o+1],o+1,t)-a)*(i-o)}}function A(t,n){var e,r,i=t.length,o=-1;if(null==n){for(;++o<i;)if(null!=(e=t[o])&&e>=e)for(r=e;++o<i;)null!=(e=t[o])&&e>r&&(r=e)}else for(;++o<i;)if(null!=(e=n(t[o],o,t))&&e>=e)for(r=e;++o<i;)null!=(e=n(t[o],o,t))&&e>r&&(r=e);return r}function T(t){for(var n,e,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(e=new Array(a);--i>=0;)for(n=(r=t[i]).length;--n>=0;)e[--a]=r[n];return e}function S(t,n){var e,r,i=t.length,o=-1;if(null==n){for(;++o<i;)if(null!=(e=t[o])&&e>=e)for(r=e;++o<i;)null!=(e=t[o])&&r>e&&(r=e)}else for(;++o<i;)if(null!=(e=n(t[o],o,t))&&e>=e)for(r=e;++o<i;)null!=(e=n(t[o],o,t))&&r>e&&(r=e);return r}function k(t){if(!(i=t.length))return[];for(var n=-1,e=S(t,E),r=new Array(e);++n<e;)for(var i,o=-1,a=r[n]=new Array(i);++o<i;)a[o]=t[o][n];return r}function E(t){return t.length}var C=Array.prototype.slice;function P(t){return t}var z=1,R=2,D=3,q=4,L=1e-6;function U(t){return"translate("+(t+.5)+",0)"}function O(t){return"translate(0,"+(t+.5)+")"}function B(){return!this.__axis}function Y(t,n){var e=[],r=null,i=null,o=6,a=6,u=3,c=t===z||t===q?-1:1,f=t===q||t===R?"x":"y",s=t===z||t===D?U:O;function l(l){var h=null==r?n.ticks?n.ticks.apply(n,e):n.domain():r,d=null==i?n.tickFormat?n.tickFormat.apply(n,e):P:i,p=Math.max(o,0)+u,v=n.range(),g=+v[0]+.5,y=+v[v.length-1]+.5,_=(n.bandwidth?function(t){var n=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(n=Math.round(n)),function(e){return+t(e)+n}}:function(t){return function(n){return+t(n)}})(n.copy()),b=l.selection?l.selection():l,m=b.selectAll(".domain").data([null]),x=b.selectAll(".tick").data(h,n).order(),w=x.exit(),M=x.enter().append("g").attr("class","tick"),N=x.select("line"),A=x.select("text");m=m.merge(m.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(M),N=N.merge(M.append("line").attr("stroke","currentColor").attr(f+"2",c*o)),A=A.merge(M.append("text").attr("fill","currentColor").attr(f,c*p).attr("dy",t===z?"0em":t===D?"0.71em":"0.32em")),l!==b&&(m=m.transition(l),x=x.transition(l),N=N.transition(l),A=A.transition(l),w=w.transition(l).attr("opacity",L).attr("transform",function(t){return isFinite(t=_(t))?s(t):this.getAttribute("transform")}),M.attr("opacity",L).attr("transform",function(t){var n=this.parentNode.__axis;return s(n&&isFinite(n=n(t))?n:_(t))})),w.remove(),m.attr("d",t===q||t==R?a?"M"+c*a+","+g+"H0.5V"+y+"H"+c*a:"M0.5,"+g+"V"+y:a?"M"+g+","+c*a+"V0.5H"+y+"V"+c*a:"M"+g+",0.5H"+y),x.attr("opacity",1).attr("transform",function(t){return s(_(t))}),N.attr(f+"2",c*o),A.attr(f,c*p).text(d),b.filter(B).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===R?"start":t===q?"end":"middle"),b.each(function(){this.__axis=_})}return l.scale=function(t){return arguments.length?(n=t,l):n},l.ticks=function(){return e=C.call(arguments),l},l.tickArguments=function(t){return arguments.length?(e=null==t?[]:C.call(t),l):e.slice()},l.tickValues=function(t){return arguments.length?(r=null==t?null:C.call(t),l):r&&r.slice()},l.tickFormat=function(t){return arguments.length?(i=t,l):i},l.tickSize=function(t){return arguments.length?(o=a=+t,l):o},l.tickSizeInner=function(t){return arguments.length?(o=+t,l):o},l.tickSizeOuter=function(t){return arguments.length?(a=+t,l):a},l.tickPadding=function(t){return arguments.length?(u=+t,l):u},l}var F={value:function(){}};function I(){for(var t,n=0,e=arguments.length,r={};n<e;++n){if(!(t=arguments[n]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new H(r)}function H(t){this._=t}function j(t,n){return t.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");if(r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})}function X(t,n){for(var e,r=0,i=t.length;r<i;++r)if((e=t[r]).name===n)return e.value}function G(t,n,e){for(var r=0,i=t.length;r<i;++r)if(t[r].name===n){t[r]=F,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=e&&t.push({name:n,value:e}),t}H.prototype=I.prototype={constructor:H,on:function(t,n){var e,r=this._,i=j(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++o<a;)if(e=(t=i[o]).type)r[e]=G(r[e],t.name,n);else if(null==n)for(e in r)r[e]=G(r[e],t.name,null);return this}for(;++o<a;)if((e=(t=i[o]).type)&&(e=X(r[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new H(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,r,i=new Array(e),o=0;o<e;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,e=(r=this._[t]).length;o<e;++o)r[o].value.apply(n,i)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};var V="http://www.w3.org/1999/xhtml",$={svg:"http://www.w3.org/2000/svg",xhtml:V,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function W(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),$.hasOwnProperty(n)?{space:$[n],local:t}:t}function Z(t){var n=W(t);return(n.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===V&&n.documentElement.namespaceURI===V?n.createElement(t):n.createElementNS(e,t)}})(n)}function Q(){}function K(t){return null==t?Q:function(){return this.querySelector(t)}}function J(){return[]}function tt(t){return null==t?J:function(){return this.querySelectorAll(t)}}function nt(t){return function(){return this.matches(t)}}function et(t){return new Array(t.length)}function rt(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}rt.prototype={constructor:rt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var it="$";function ot(t,n,e,r,i,o){for(var a,u=0,c=n.length,f=o.length;u<f;++u)(a=n[u])?(a.__data__=o[u],r[u]=a):e[u]=new rt(t,o[u]);for(;u<c;++u)(a=n[u])&&(i[u]=a)}function at(t,n,e,r,i,o,a){var u,c,f,s={},l=n.length,h=o.length,d=new Array(l);for(u=0;u<l;++u)(c=n[u])&&(d[u]=f=it+a.call(c,c.__data__,u,n),f in s?i[u]=c:s[f]=c);for(u=0;u<h;++u)(c=s[f=it+a.call(t,o[u],u,o)])?(r[u]=c,c.__data__=o[u],s[f]=null):e[u]=new rt(t,o[u]);for(u=0;u<l;++u)(c=n[u])&&s[d[u]]===c&&(i[u]=c)}function ut(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function ct(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ft(t,n){return t.style.getPropertyValue(n)||ct(t).getComputedStyle(t,null).getPropertyValue(n)}function st(t){return t.trim().split(/^|\s+/)}function lt(t){return t.classList||new ht(t)}function ht(t){this._node=t,this._names=st(t.getAttribute("class")||"")}function dt(t,n){for(var e=lt(t),r=-1,i=n.length;++r<i;)e.add(n[r])}function pt(t,n){for(var e=lt(t),r=-1,i=n.length;++r<i;)e.remove(n[r])}function vt(){this.textContent=""}function gt(){this.innerHTML=""}function yt(){this.nextSibling&&this.parentNode.appendChild(this)}function _t(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function bt(){return null}function mt(){var t=this.parentNode;t&&t.removeChild(this)}function xt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function wt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}ht.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Mt={};(t.event=null,"undefined"!=typeof document)&&("onmouseenter"in document.documentElement||(Mt={mouseenter:"mouseover",mouseleave:"mouseout"}));function Nt(t,n,e){return t=At(t,n,e),function(n){var e=n.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||t.call(this,n)}}function At(n,e,r){return function(i){var o=t.event;t.event=i;try{n.call(this,this.__data__,e,r)}finally{t.event=o}}}function Tt(t){return function(){var n=this.__on;if(n){for(var e,r=0,i=-1,o=n.length;r<o;++r)e=n[r],t.type&&e.type!==t.type||e.name!==t.name?n[++i]=e:this.removeEventListener(e.type,e.listener,e.capture);++i?n.length=i:delete this.__on}}}function St(t,n,e){var r=Mt.hasOwnProperty(t.type)?Nt:At;return function(i,o,a){var u,c=this.__on,f=r(n,o,a);if(c)for(var s=0,l=c.length;s<l;++s)if((u=c[s]).type===t.type&&u.name===t.name)return this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=f,u.capture=e),void(u.value=n);this.addEventListener(t.type,f,e),u={type:t.type,name:t.name,value:n,listener:f,capture:e},c?c.push(u):this.__on=[u]}}function kt(n,e,r,i){var o=t.event;n.sourceEvent=t.event,t.event=n;try{return e.apply(r,i)}finally{t.event=o}}function Et(t,n,e){var r=ct(t),i=r.CustomEvent;"function"==typeof i?i=new i(n,e):(i=r.document.createEvent("Event"),e?(i.initEvent(n,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(n,!1,!1)),t.dispatchEvent(i)}var Ct=[null];function Pt(t,n){this._groups=t,this._parents=n}function zt(){return new Pt([[document.documentElement]],Ct)}function Rt(t){return"string"==typeof t?new Pt([[document.querySelector(t)]],[document.documentElement]):new Pt([[t]],Ct)}Pt.prototype=zt.prototype={constructor:Pt,select:function(t){"function"!=typeof t&&(t=K(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,a,u=n[i],c=u.length,f=r[i]=new Array(c),s=0;s<c;++s)(o=u[s])&&(a=t.call(o,o.__data__,s,u))&&("__data__"in o&&(a.__data__=o.__data__),f[s]=a);return new Pt(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=tt(t));for(var n=this._groups,e=n.length,r=[],i=[],o=0;o<e;++o)for(var a,u=n[o],c=u.length,f=0;f<c;++f)(a=u[f])&&(r.push(t.call(a,a.__data__,f,u)),i.push(a));return new Pt(r,i)},filter:function(t){"function"!=typeof t&&(t=nt(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,a=n[i],u=a.length,c=r[i]=[],f=0;f<u;++f)(o=a[f])&&t.call(o,o.__data__,f,a)&&c.push(o);return new Pt(r,this._parents)},data:function(t,n){if(!t)return d=new Array(this.size()),f=-1,this.each(function(t){d[++f]=t}),d;var e=n?at:ot,r=this._parents,i=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var o=i.length,a=new Array(o),u=new Array(o),c=new Array(o),f=0;f<o;++f){var s=r[f],l=i[f],h=l.length,d=t.call(s,s&&s.__data__,f,r),p=d.length,v=u[f]=new Array(p),g=a[f]=new Array(p);e(s,l,v,g,c[f]=new Array(h),d,n);for(var y,_,b=0,m=0;b<p;++b)if(y=v[b]){for(b>=m&&(m=b+1);!(_=g[m])&&++m<p;);y._next=_||null}}return(a=new Pt(a,r))._enter=u,a._exit=c,a},enter:function(){return new Pt(this._enter||this._groups.map(et),this._parents)},exit:function(){return new Pt(this._exit||this._groups.map(et),this._parents)},join:function(t,n,e){var r=this.enter(),i=this,o=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=n&&(i=n(i)),null==e?o.remove():e(o),r&&i?r.merge(i).order():i},merge:function(t){for(var n=this._groups,e=t._groups,r=n.length,i=e.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var c,f=n[u],s=e[u],l=f.length,h=a[u]=new Array(l),d=0;d<l;++d)(c=f[d]||s[d])&&(h[d]=c);for(;u<r;++u)a[u]=n[u];return new Pt(a,this._parents)},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r,i=t[n],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=ut);for(var e=this._groups,r=e.length,i=new Array(r),o=0;o<r;++o){for(var a,u=e[o],c=u.length,f=i[o]=new Array(c),s=0;s<c;++s)(a=u[s])&&(f[s]=a);f.sort(n)}return new Pt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),n=-1;return this.each(function(){t[++n]=this}),t},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var i,o=n[e],a=0,u=o.length;a<u;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,n){var e=W(t);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((null==n?e.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof n?e.local?function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}:function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}:e.local?function(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}:function(t,n){return function(){this.setAttribute(t,n)}})(e,n))},style:function(t,n,e){return arguments.length>1?this.each((null==n?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof n?function(t,n,e){return function(){var r=n.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,e)}}:function(t,n,e){return function(){this.style.setProperty(t,n,e)}})(t,n,null==e?"":e)):ft(this.node(),t)},property:function(t,n){return arguments.length>1?this.each((null==n?function(t){return function(){delete this[t]}}:"function"==typeof n?function(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}:function(t,n){return function(){this[t]=n}})(t,n)):this.node()[t]},classed:function(t,n){var e=st(t+"");if(arguments.length<2){for(var r=lt(this.node()),i=-1,o=e.length;++i<o;)if(!r.contains(e[i]))return!1;return!0}return this.each(("function"==typeof n?function(t,n){return function(){(n.apply(this,arguments)?dt:pt)(this,t)}}:n?function(t){return function(){dt(this,t)}}:function(t){return function(){pt(this,t)}})(e,n))},text:function(t){return arguments.length?this.each(null==t?vt:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?gt:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(yt)},lower:function(){return this.each(_t)},append:function(t){var n="function"==typeof t?t:Z(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})},insert:function(t,n){var e="function"==typeof t?t:Z(t),r=null==n?bt:"function"==typeof n?n:K(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(mt)},clone:function(t){return this.select(t?wt:xt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var r,i,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}})}(t+""),a=o.length;if(!(arguments.length<2)){for(u=n?St:Tt,null==e&&(e=!1),r=0;r<a;++r)this.each(u(o[r],n,e));return this}var u=this.node().__on;if(u)for(var c,f=0,s=u.length;f<s;++f)for(r=0,c=u[f];r<a;++r)if((i=o[r]).type===c.type&&i.name===c.name)return c.value},dispatch:function(t,n){return this.each(("function"==typeof n?function(t,n){return function(){return Et(this,t,n.apply(this,arguments))}}:function(t,n){return function(){return Et(this,t,n)}})(t,n))}};var Dt=0;function qt(){return new Lt}function Lt(){this._="@"+(++Dt).toString(36)}function Ut(){for(var n,e=t.event;n=e.sourceEvent;)e=n;return e}function Ot(t,n){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var r=e.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[n.clientX-i.left-t.clientLeft,n.clientY-i.top-t.clientTop]}function Bt(t){var n=Ut();return n.changedTouches&&(n=n.changedTouches[0]),Ot(t,n)}function Yt(t,n,e){arguments.length<3&&(e=n,n=Ut().changedTouches);for(var r,i=0,o=n?n.length:0;i<o;++i)if((r=n[i]).identifier===e)return Ot(t,r);return null}function Ft(){t.event.stopImmediatePropagation()}function It(){t.event.preventDefault(),t.event.stopImmediatePropagation()}function Ht(t){var n=t.document.documentElement,e=Rt(t).on("dragstart.drag",It,!0);"onselectstart"in n?e.on("selectstart.drag",It,!0):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function jt(t,n){var e=t.document.documentElement,r=Rt(t).on("dragstart.drag",null);n&&(r.on("click.drag",It,!0),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in e?r.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}function Xt(t){return function(){return t}}function Gt(t,n,e,r,i,o,a,u,c,f){this.target=t,this.type=n,this.subject=e,this.identifier=r,this.active=i,this.x=o,this.y=a,this.dx=u,this.dy=c,this._=f}function Vt(){return!t.event.ctrlKey&&!t.event.button}function $t(){return this.parentNode}function Wt(n){return null==n?{x:t.event.x,y:t.event.y}:n}function Zt(){return navigator.maxTouchPoints||"ontouchstart"in this}function Qt(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function Kt(t,n){var e=Object.create(t.prototype);for(var r in n)e[r]=n[r];return e}function Jt(){}Lt.prototype=qt.prototype={constructor:Lt,get:function(t){for(var n=this._;!(n in t);)if(!(t=t.parentNode))return;return t[n]},set:function(t,n){return t[this._]=n},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}},Gt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var tn="\\s*([+-]?\\d+)\\s*",nn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",en="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",rn=/^#([0-9a-f]{3})$/,on=/^#([0-9a-f]{6})$/,an=new RegExp("^rgb\\("+[tn,tn,tn]+"\\)$"),un=new RegExp("^rgb\\("+[en,en,en]+"\\)$"),cn=new RegExp("^rgba\\("+[tn,tn,tn,nn]+"\\)$"),fn=new RegExp("^rgba\\("+[en,en,en,nn]+"\\)$"),sn=new RegExp("^hsl\\("+[nn,en,en]+"\\)$"),ln=new RegExp("^hsla\\("+[nn,en,en,nn]+"\\)$"),hn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function dn(){return this.rgb().formatHex()}function pn(){return this.rgb().formatRgb()}function vn(t){var n;return t=(t+"").trim().toLowerCase(),(n=rn.exec(t))?new mn((n=parseInt(n[1],16))>>8&15|n>>4&240,n>>4&15|240&n,(15&n)<<4|15&n,1):(n=on.exec(t))?gn(parseInt(n[1],16)):(n=an.exec(t))?new mn(n[1],n[2],n[3],1):(n=un.exec(t))?new mn(255*n[1]/100,255*n[2]/100,255*n[3]/100,1):(n=cn.exec(t))?yn(n[1],n[2],n[3],n[4]):(n=fn.exec(t))?yn(255*n[1]/100,255*n[2]/100,255*n[3]/100,n[4]):(n=sn.exec(t))?Nn(n[1],n[2]/100,n[3]/100,1):(n=ln.exec(t))?Nn(n[1],n[2]/100,n[3]/100,n[4]):hn.hasOwnProperty(t)?gn(hn[t]):"transparent"===t?new mn(NaN,NaN,NaN,0):null}function gn(t){return new mn(t>>16&255,t>>8&255,255&t,1)}function yn(t,n,e,r){return r<=0&&(t=n=e=NaN),new mn(t,n,e,r)}function _n(t){return t instanceof Jt||(t=vn(t)),t?new mn((t=t.rgb()).r,t.g,t.b,t.opacity):new mn}function bn(t,n,e,r){return 1===arguments.length?_n(t):new mn(t,n,e,null==r?1:r)}function mn(t,n,e,r){this.r=+t,this.g=+n,this.b=+e,this.opacity=+r}function xn(){return"#"+Mn(this.r)+Mn(this.g)+Mn(this.b)}function wn(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Mn(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Nn(t,n,e,r){return r<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new Sn(t,n,e,r)}function An(t){if(t instanceof Sn)return new Sn(t.h,t.s,t.l,t.opacity);if(t instanceof Jt||(t=vn(t)),!t)return new Sn;if(t instanceof Sn)return t;var n=(t=t.rgb()).r/255,e=t.g/255,r=t.b/255,i=Math.min(n,e,r),o=Math.max(n,e,r),a=NaN,u=o-i,c=(o+i)/2;return u?(a=n===o?(e-r)/u+6*(e<r):e===o?(r-n)/u+2:(n-e)/u+4,u/=c<.5?o+i:2-o-i,a*=60):u=c>0&&c<1?0:a,new Sn(a,u,c,t.opacity)}function Tn(t,n,e,r){return 1===arguments.length?An(t):new Sn(t,n,e,null==r?1:r)}function Sn(t,n,e,r){this.h=+t,this.s=+n,this.l=+e,this.opacity=+r}function kn(t,n,e){return 255*(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)}Qt(Jt,vn,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:dn,formatHex:dn,formatHsl:function(){return An(this).formatHsl()},formatRgb:pn,toString:pn}),Qt(mn,bn,Kt(Jt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new mn(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new mn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:xn,formatHex:xn,formatRgb:wn,toString:wn})),Qt(Sn,Tn,Kt(Jt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Sn(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Sn(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*n,i=2*e-r;return new mn(kn(t>=240?t-240:t+120,i,r),kn(t,i,r),kn(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var En=Math.PI/180,Cn=180/Math.PI,Pn=.96422,zn=1,Rn=.82521,Dn=4/29,qn=6/29,Ln=3*qn*qn,Un=qn*qn*qn;function On(t){if(t instanceof Yn)return new Yn(t.l,t.a,t.b,t.opacity);if(t instanceof Vn)return $n(t);t instanceof mn||(t=_n(t));var n,e,r=jn(t.r),i=jn(t.g),o=jn(t.b),a=Fn((.2225045*r+.7168786*i+.0606169*o)/zn);return r===i&&i===o?n=e=a:(n=Fn((.4360747*r+.3850649*i+.1430804*o)/Pn),e=Fn((.0139322*r+.0971045*i+.7141733*o)/Rn)),new Yn(116*a-16,500*(n-a),200*(a-e),t.opacity)}function Bn(t,n,e,r){return 1===arguments.length?On(t):new Yn(t,n,e,null==r?1:r)}function Yn(t,n,e,r){this.l=+t,this.a=+n,this.b=+e,this.opacity=+r}function Fn(t){return t>Un?Math.pow(t,1/3):t/Ln+Dn}function In(t){return t>qn?t*t*t:Ln*(t-Dn)}function Hn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function jn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Xn(t){if(t instanceof Vn)return new Vn(t.h,t.c,t.l,t.opacity);if(t instanceof Yn||(t=On(t)),0===t.a&&0===t.b)return new Vn(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var n=Math.atan2(t.b,t.a)*Cn;return new Vn(n<0?n+360:n,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Gn(t,n,e,r){return 1===arguments.length?Xn(t):new Vn(t,n,e,null==r?1:r)}function Vn(t,n,e,r){this.h=+t,this.c=+n,this.l=+e,this.opacity=+r}function $n(t){if(isNaN(t.h))return new Yn(t.l,0,0,t.opacity);var n=t.h*En;return new Yn(t.l,Math.cos(n)*t.c,Math.sin(n)*t.c,t.opacity)}Qt(Yn,Bn,Kt(Jt,{brighter:function(t){return new Yn(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Yn(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,n=isNaN(this.a)?t:t+this.a/500,e=isNaN(this.b)?t:t-this.b/200;return new mn(Hn(3.1338561*(n=Pn*In(n))-1.6168667*(t=zn*In(t))-.4906146*(e=Rn*In(e))),Hn(-.9787684*n+1.9161415*t+.033454*e),Hn(.0719453*n-.2289914*t+1.4052427*e),this.opacity)}})),Qt(Vn,Gn,Kt(Jt,{brighter:function(t){return new Vn(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Vn(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return $n(this).rgb()}}));var Wn=-.14861,Zn=1.78277,Qn=-.29227,Kn=-.90649,Jn=1.97294,te=Jn*Kn,ne=Jn*Zn,ee=Zn*Qn-Kn*Wn;function re(t,n,e,r){return 1===arguments.length?function(t){if(t instanceof ie)return new ie(t.h,t.s,t.l,t.opacity);t instanceof mn||(t=_n(t));var n=t.r/255,e=t.g/255,r=t.b/255,i=(ee*r+te*n-ne*e)/(ee+te-ne),o=r-i,a=(Jn*(e-i)-Qn*o)/Kn,u=Math.sqrt(a*a+o*o)/(Jn*i*(1-i)),c=u?Math.atan2(a,o)*Cn-120:NaN;return new ie(c<0?c+360:c,u,i,t.opacity)}(t):new ie(t,n,e,null==r?1:r)}function ie(t,n,e,r){this.h=+t,this.s=+n,this.l=+e,this.opacity=+r}function oe(t,n,e,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*n+(4-6*o+3*a)*e+(1+3*t+3*o-3*a)*r+a*i)/6}function ae(t){var n=t.length-1;return function(e){var r=e<=0?e=0:e>=1?(e=1,n-1):Math.floor(e*n),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,u=r<n-1?t[r+2]:2*o-i;return oe((e-r/n)*n,a,i,o,u)}}function ue(t){var n=t.length;return function(e){var r=Math.floor(((e%=1)<0?++e:e)*n),i=t[(r+n-1)%n],o=t[r%n],a=t[(r+1)%n],u=t[(r+2)%n];return oe((e-r/n)*n,i,o,a,u)}}function ce(t){return function(){return t}}function fe(t,n){return function(e){return t+e*n}}function se(t,n){var e=n-t;return e?fe(t,e>180||e<-180?e-360*Math.round(e/360):e):ce(isNaN(t)?n:t)}function le(t){return 1==(t=+t)?he:function(n,e){return e-n?function(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(r){return Math.pow(t+r*n,e)}}(n,e,t):ce(isNaN(n)?e:n)}}function he(t,n){var e=n-t;return e?fe(t,e):ce(isNaN(t)?n:t)}Qt(ie,re,Kt(Jt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new ie(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new ie(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*En,n=+this.l,e=isNaN(this.s)?0:this.s*n*(1-n),r=Math.cos(t),i=Math.sin(t);return new mn(255*(n+e*(Wn*r+Zn*i)),255*(n+e*(Qn*r+Kn*i)),255*(n+e*(Jn*r)),this.opacity)}}));var de=function t(n){var e=le(n);function r(t,n){var r=e((t=bn(t)).r,(n=bn(n)).r),i=e(t.g,n.g),o=e(t.b,n.b),a=he(t.opacity,n.opacity);return function(n){return t.r=r(n),t.g=i(n),t.b=o(n),t.opacity=a(n),t+""}}return r.gamma=t,r}(1);function pe(t){return function(n){var e,r,i=n.length,o=new Array(i),a=new Array(i),u=new Array(i);for(e=0;e<i;++e)r=bn(n[e]),o[e]=r.r||0,a[e]=r.g||0,u[e]=r.b||0;return o=t(o),a=t(a),u=t(u),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=u(t),r+""}}}var ve=pe(ae),ge=pe(ue);function ye(t,n){var e,r=n?n.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(e=0;e<i;++e)o[e]=Ne(t[e],n[e]);for(;e<r;++e)a[e]=n[e];return function(t){for(e=0;e<i;++e)a[e]=o[e](t);return a}}function _e(t,n){var e=new Date;return n-=t=+t,function(r){return e.setTime(t+n*r),e}}function be(t,n){return n-=t=+t,function(e){return t+n*e}}function me(t,n){var e,r={},i={};for(e in null!==t&&"object"==typeof t||(t={}),null!==n&&"object"==typeof n||(n={}),n)e in t?r[e]=Ne(t[e],n[e]):i[e]=n[e];return function(t){for(e in r)i[e]=r[e](t);return i}}var xe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,we=new RegExp(xe.source,"g");function Me(t,n){var e,r,i,o=xe.lastIndex=we.lastIndex=0,a=-1,u=[],c=[];for(t+="",n+="";(e=xe.exec(t))&&(r=we.exec(n));)(i=r.index)>o&&(i=n.slice(o,i),u[a]?u[a]+=i:u[++a]=i),(e=e[0])===(r=r[0])?u[a]?u[a]+=r:u[++a]=r:(u[++a]=null,c.push({i:a,x:be(e,r)})),o=we.lastIndex;return o<n.length&&(i=n.slice(o),u[a]?u[a]+=i:u[++a]=i),u.length<2?c[0]?function(t){return function(n){return t(n)+""}}(c[0].x):function(t){return function(){return t}}(n):(n=c.length,function(t){for(var e,r=0;r<n;++r)u[(e=c[r]).i]=e.x(t);return u.join("")})}function Ne(t,n){var e,r=typeof n;return null==n||"boolean"===r?ce(n):("number"===r?be:"string"===r?(e=vn(n))?(n=e,de):Me:n instanceof vn?de:n instanceof Date?_e:Array.isArray(n)?ye:"function"!=typeof n.valueOf&&"function"!=typeof n.toString||isNaN(n)?me:be)(t,n)}function Ae(t,n){return n-=t=+t,function(e){return Math.round(t+n*e)}}var Te,Se,ke,Ee,Ce=180/Math.PI,Pe={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ze(t,n,e,r,i,o){var a,u,c;return(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a),(c=t*e+n*r)&&(e-=t*c,r-=n*c),(u=Math.sqrt(e*e+r*r))&&(e/=u,r/=u,c/=u),t*r<n*e&&(t=-t,n=-n,c=-c,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(n,t)*Ce,skewX:Math.atan(c)*Ce,scaleX:a,scaleY:u}}function Re(t,n,e,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var u=[],c=[];return o=t(o),a=t(a),function(t,r,i,o,a,u){if(t!==i||r!==o){var c=a.push("translate(",null,n,null,e);u.push({i:c-4,x:be(t,i)},{i:c-2,x:be(r,o)})}else(i||o)&&a.push("translate("+i+n+o+e)}(o.translateX,o.translateY,a.translateX,a.translateY,u,c),function(t,n,e,o){t!==n?(t-n>180?n+=360:n-t>180&&(t+=360),o.push({i:e.push(i(e)+"rotate(",null,r)-2,x:be(t,n)})):n&&e.push(i(e)+"rotate("+n+r)}(o.rotate,a.rotate,u,c),function(t,n,e,o){t!==n?o.push({i:e.push(i(e)+"skewX(",null,r)-2,x:be(t,n)}):n&&e.push(i(e)+"skewX("+n+r)}(o.skewX,a.skewX,u,c),function(t,n,e,r,o,a){if(t!==e||n!==r){var u=o.push(i(o)+"scale(",null,",",null,")");a.push({i:u-4,x:be(t,e)},{i:u-2,x:be(n,r)})}else 1===e&&1===r||o.push(i(o)+"scale("+e+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,u,c),o=a=null,function(t){for(var n,e=-1,r=c.length;++e<r;)u[(n=c[e]).i]=n.x(t);return u.join("")}}}var De=Re(function(t){return"none"===t?Pe:(Te||(Te=document.createElement("DIV"),Se=document.documentElement,ke=document.defaultView),Te.style.transform=t,t=ke.getComputedStyle(Se.appendChild(Te),null).getPropertyValue("transform"),Se.removeChild(Te),ze(+(t=t.slice(7,-1).split(","))[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),qe=Re(function(t){return null==t?Pe:(Ee||(Ee=document.createElementNS("http://www.w3.org/2000/svg","g")),Ee.setAttribute("transform",t),(t=Ee.transform.baseVal.consolidate())?ze((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Pe)},", ",")",")"),Le=Math.SQRT2,Ue=2,Oe=4,Be=1e-12;function Ye(t){return((t=Math.exp(t))+1/t)/2}function Fe(t,n){var e,r,i=t[0],o=t[1],a=t[2],u=n[0],c=n[1],f=n[2],s=u-i,l=c-o,h=s*s+l*l;if(h<Be)r=Math.log(f/a)/Le,e=function(t){return[i+t*s,o+t*l,a*Math.exp(Le*t*r)]};else{var d=Math.sqrt(h),p=(f*f-a*a+Oe*h)/(2*a*Ue*d),v=(f*f-a*a-Oe*h)/(2*f*Ue*d),g=Math.log(Math.sqrt(p*p+1)-p),y=Math.log(Math.sqrt(v*v+1)-v);r=(y-g)/Le,e=function(t){var n=t*r,e=Ye(g),u=a/(Ue*d)*(e*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(Le*n+g)-function(t){return((t=Math.exp(t))-1/t)/2}(g));return[i+u*s,o+u*l,a*e/Ye(Le*n+g)]}}return e.duration=1e3*r,e}function Ie(t){return function(n,e){var r=t((n=Tn(n)).h,(e=Tn(e)).h),i=he(n.s,e.s),o=he(n.l,e.l),a=he(n.opacity,e.opacity);return function(t){return n.h=r(t),n.s=i(t),n.l=o(t),n.opacity=a(t),n+""}}}var He=Ie(se),je=Ie(he);function Xe(t){return function(n,e){var r=t((n=Gn(n)).h,(e=Gn(e)).h),i=he(n.c,e.c),o=he(n.l,e.l),a=he(n.opacity,e.opacity);return function(t){return n.h=r(t),n.c=i(t),n.l=o(t),n.opacity=a(t),n+""}}}var Ge=Xe(se),Ve=Xe(he);function $e(t){return function n(e){function r(n,r){var i=t((n=re(n)).h,(r=re(r)).h),o=he(n.s,r.s),a=he(n.l,r.l),u=he(n.opacity,r.opacity);return function(t){return n.h=i(t),n.s=o(t),n.l=a(Math.pow(t,e)),n.opacity=u(t),n+""}}return e=+e,r.gamma=n,r}(1)}var We=$e(se),Ze=$e(he);var Qe,Ke,Je=0,tr=0,nr=0,er=1e3,rr=0,ir=0,or=0,ar="object"==typeof performance&&performance.now?performance:Date,ur="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function cr(){return ir||(ur(fr),ir=ar.now()+or)}function fr(){ir=0}function sr(){this._call=this._time=this._next=null}function lr(t,n,e){var r=new sr;return r.restart(t,n,e),r}function hr(){cr(),++Je;for(var t,n=Qe;n;)(t=ir-n._time)>=0&&n._call.call(null,t),n=n._next;--Je}function dr(){ir=(rr=ar.now())+or,Je=tr=0;try{hr()}finally{Je=0,function(){var t,n,e=Qe,r=1/0;for(;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Qe=n);Ke=t,vr(r)}(),ir=0}}function pr(){var t=ar.now(),n=t-rr;n>er&&(or-=n,rr=t)}function vr(t){Je||(tr&&(tr=clearTimeout(tr)),t-ir>24?(t<1/0&&(tr=setTimeout(dr,t-ar.now()-or)),nr&&(nr=clearInterval(nr))):(nr||(rr=ar.now(),nr=setInterval(pr,er)),Je=1,ur(dr)))}function gr(t,n,e){var r=new sr;return n=null==n?0:+n,r.restart(function(e){r.stop(),t(e+n)},n,e),r}sr.prototype=lr.prototype={constructor:sr,restart:function(t,n,e){if("function"!=typeof t)throw new TypeError("callback is not a function");e=(null==e?cr():+e)+(null==n?0:+n),this._next||Ke===this||(Ke?Ke._next=this:Qe=this,Ke=this),this._call=t,this._time=e,vr()},stop:function(){this._call&&(this._call=null,this._time=1/0,vr())}};var yr=I("start","end","cancel","interrupt"),_r=[],br=0,mr=1,xr=2,wr=3,Mr=4,Nr=5,Ar=6;function Tr(t,n,e,r,i,o){var a=t.__transition;if(a){if(e in a)return}else t.__transition={};!function(t,n,e){var r,i=t.__transition;function o(c){var f,s,l,h;if(e.state!==mr)return u();for(f in i)if((h=i[f]).name===e.name){if(h.state===wr)return gr(o);h.state===Mr?(h.state=Ar,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[f]):+f<n&&(h.state=Ar,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[f])}if(gr(function(){e.state===wr&&(e.state=Mr,e.timer.restart(a,e.delay,e.time),a(c))}),e.state=xr,e.on.call("start",t,t.__data__,e.index,e.group),e.state===xr){for(e.state=wr,r=new Array(l=e.tween.length),f=0,s=-1;f<l;++f)(h=e.tween[f].value.call(t,t.__data__,e.index,e.group))&&(r[++s]=h);r.length=s+1}}function a(n){for(var i=n<e.duration?e.ease.call(null,n/e.duration):(e.timer.restart(u),e.state=Nr,1),o=-1,a=r.length;++o<a;)r[o].call(t,i);e.state===Nr&&(e.on.call("end",t,t.__data__,e.index,e.group),u())}function u(){for(var r in e.state=Ar,e.timer.stop(),delete i[n],i)return;delete t.__transition}i[n]=e,e.timer=lr(function(t){e.state=mr,e.timer.restart(o,e.delay,e.time),e.delay<=t&&o(t-e.delay)},0,e.time)}(t,e,{name:n,index:r,group:i,on:yr,tween:_r,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:br})}function Sr(t,n){var e=Er(t,n);if(e.state>br)throw new Error("too late; already scheduled");return e}function kr(t,n){var e=Er(t,n);if(e.state>wr)throw new Error("too late; already running");return e}function Er(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function Cr(t,n){var e,r,i,o=t.__transition,a=!0;if(o){for(i in n=null==n?null:n+"",o)(e=o[i]).name===n?(r=e.state>xr&&e.state<Nr,e.state=Ar,e.timer.stop(),e.on.call(r?"interrupt":"cancel",t,t.__data__,e.index,e.group),delete o[i]):a=!1;a&&delete t.__transition}}function Pr(t,n,e){var r=t._id;return t.each(function(){var t=kr(this,r);(t.value||(t.value={}))[n]=e.apply(this,arguments)}),function(t){return Er(t,r).value[n]}}function zr(t,n){var e;return("number"==typeof n?be:n instanceof vn?de:(e=vn(n))?(n=e,de):Me)(t,n)}var Rr=zt.prototype.constructor;function Dr(t){return function(){this.style.removeProperty(t)}}var qr=0;function Lr(t,n,e,r){this._groups=t,this._parents=n,this._name=e,this._id=r}function Ur(t){return zt().transition(t)}function Or(){return++qr}var Br=zt.prototype;function Yr(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function Fr(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}Lr.prototype=Ur.prototype={constructor:Lr,select:function(t){var n=this._name,e=this._id;"function"!=typeof t&&(t=K(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var u,c,f=r[a],s=f.length,l=o[a]=new Array(s),h=0;h<s;++h)(u=f[h])&&(c=t.call(u,u.__data__,h,f))&&("__data__"in u&&(c.__data__=u.__data__),l[h]=c,Tr(l[h],n,e,h,l,Er(u,e)));return new Lr(o,this._parents,n,e)},selectAll:function(t){var n=this._name,e=this._id;"function"!=typeof t&&(t=tt(t));for(var r=this._groups,i=r.length,o=[],a=[],u=0;u<i;++u)for(var c,f=r[u],s=f.length,l=0;l<s;++l)if(c=f[l]){for(var h,d=t.call(c,c.__data__,l,f),p=Er(c,e),v=0,g=d.length;v<g;++v)(h=d[v])&&Tr(h,n,e,v,d,p);o.push(d),a.push(c)}return new Lr(o,a,n,e)},filter:function(t){"function"!=typeof t&&(t=nt(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,a=n[i],u=a.length,c=r[i]=[],f=0;f<u;++f)(o=a[f])&&t.call(o,o.__data__,f,a)&&c.push(o);return new Lr(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,r=n.length,i=e.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var c,f=n[u],s=e[u],l=f.length,h=a[u]=new Array(l),d=0;d<l;++d)(c=f[d]||s[d])&&(h[d]=c);for(;u<r;++u)a[u]=n[u];return new Lr(a,this._parents,this._name,this._id)},selection:function(){return new Rr(this._groups,this._parents)},transition:function(){for(var t=this._name,n=this._id,e=Or(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,u=r[o],c=u.length,f=0;f<c;++f)if(a=u[f]){var s=Er(a,n);Tr(a,t,e,f,u,{time:s.time+s.delay+s.duration,delay:0,duration:s.duration,ease:s.ease})}return new Lr(r,this._parents,t,e)},call:Br.call,nodes:Br.nodes,node:Br.node,size:Br.size,empty:Br.empty,each:Br.each,on:function(t,n){var e=this._id;return arguments.length<2?Er(this.node(),e).on.on(t):this.each(function(t,n,e){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t})}(n)?Sr:kr;return function(){var a=o(this,t),u=a.on;u!==r&&(i=(r=u).copy()).on(n,e),a.on=i}}(e,t,n))},attr:function(t,n){var e=W(t),r="transform"===e?qe:zr;return this.attrTween(t,"function"==typeof n?(e.local?function(t,n,e){var r,i,o;return function(){var a,u,c=e(this);if(null!=c)return(a=this.getAttributeNS(t.space,t.local))===(u=c+"")?null:a===r&&u===i?o:(i=u,o=n(r=a,c));this.removeAttributeNS(t.space,t.local)}}:function(t,n,e){var r,i,o;return function(){var a,u,c=e(this);if(null!=c)return(a=this.getAttribute(t))===(u=c+"")?null:a===r&&u===i?o:(i=u,o=n(r=a,c));this.removeAttribute(t)}})(e,r,Pr(this,"attr."+t,n)):null==n?(e.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}})(e):(e.local?function(t,n,e){var r,i,o=e+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===r?i:i=n(r=a,e)}}:function(t,n,e){var r,i,o=e+"";return function(){var a=this.getAttribute(t);return a===o?null:a===r?i:i=n(r=a,e)}})(e,r,n))},attrTween:function(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(null==n)return this.tween(e,null);if("function"!=typeof n)throw new Error;var r=W(t);return this.tween(e,(r.local?function(t,n){var e,r;function i(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&function(t,n){return function(e){this.setAttributeNS(t.space,t.local,n(e))}}(t,i)),e}return i._value=n,i}:function(t,n){var e,r;function i(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&function(t,n){return function(e){this.setAttribute(t,n(e))}}(t,i)),e}return i._value=n,i})(r,n))},style:function(t,n,e){var r="transform"==(t+="")?De:zr;return null==n?this.styleTween(t,function(t,n){var e,r,i;return function(){var o=ft(this,t),a=(this.style.removeProperty(t),ft(this,t));return o===a?null:o===e&&a===r?i:i=n(e=o,r=a)}}(t,r)).on("end.style."+t,Dr(t)):"function"==typeof n?this.styleTween(t,function(t,n,e){var r,i,o;return function(){var a=ft(this,t),u=e(this),c=u+"";return null==u&&(this.style.removeProperty(t),c=u=ft(this,t)),a===c?null:a===r&&c===i?o:(i=c,o=n(r=a,u))}}(t,r,Pr(this,"style."+t,n))).each(function(t,n){var e,r,i,o,a="style."+n,u="end."+a;return function(){var c=kr(this,t),f=c.on,s=null==c.value[a]?o||(o=Dr(n)):void 0;f===e&&i===s||(r=(e=f).copy()).on(u,i=s),c.on=r}}(this._id,t)):this.styleTween(t,function(t,n,e){var r,i,o=e+"";return function(){var a=ft(this,t);return a===o?null:a===r?i:i=n(r=a,e)}}(t,r,n),e).on("end.style."+t,null)},styleTween:function(t,n,e){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==n)return this.tween(r,null);if("function"!=typeof n)throw new Error;return this.tween(r,function(t,n,e){var r,i;function o(){var o=n.apply(this,arguments);return o!==i&&(r=(i=o)&&function(t,n,e){return function(r){this.style.setProperty(t,n(r),e)}}(t,o,e)),r}return o._value=n,o}(t,n,null==e?"":e))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var n=t(this);this.textContent=null==n?"":n}}(Pr(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},remove:function(){return this.on("end.remove",function(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}(this._id))},tween:function(t,n){var e=this._id;if(t+="",arguments.length<2){for(var r,i=Er(this.node(),e).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==n?function(t,n){var e,r;return function(){var i=kr(this,t),o=i.tween;if(o!==e)for(var a=0,u=(r=e=o).length;a<u;++a)if(r[a].name===n){(r=r.slice()).splice(a,1);break}i.tween=r}}:function(t,n,e){var r,i;if("function"!=typeof e)throw new Error;return function(){var o=kr(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var u={name:n,value:e},c=0,f=i.length;c<f;++c)if(i[c].name===n){i[c]=u;break}c===f&&i.push(u)}o.tween=i}})(e,t,n))},delay:function(t){var n=this._id;return arguments.length?this.each(("function"==typeof t?function(t,n){return function(){Sr(this,t).delay=+n.apply(this,arguments)}}:function(t,n){return n=+n,function(){Sr(this,t).delay=n}})(n,t)):Er(this.node(),n).delay},duration:function(t){var n=this._id;return arguments.length?this.each(("function"==typeof t?function(t,n){return function(){kr(this,t).duration=+n.apply(this,arguments)}}:function(t,n){return n=+n,function(){kr(this,t).duration=n}})(n,t)):Er(this.node(),n).duration},ease:function(t){var n=this._id;return arguments.length?this.each(function(t,n){if("function"!=typeof n)throw new Error;return function(){kr(this,t).ease=n}}(n,t)):Er(this.node(),n).ease},end:function(){var t,n,e=this,r=e._id,i=e.size();return new Promise(function(o,a){var u={value:a},c={value:function(){0==--i&&o()}};e.each(function(){var e=kr(this,r),i=e.on;i!==t&&((n=(t=i).copy())._.cancel.push(u),n._.interrupt.push(u),n._.end.push(c)),e.on=n})})}};var Ir=function t(n){function e(t){return Math.pow(t,n)}return n=+n,e.exponent=t,e}(3),Hr=function t(n){function e(t){return 1-Math.pow(1-t,n)}return n=+n,e.exponent=t,e}(3),jr=function t(n){function e(t){return((t*=2)<=1?Math.pow(t,n):2-Math.pow(2-t,n))/2}return n=+n,e.exponent=t,e}(3),Xr=Math.PI,Gr=Xr/2;function Vr(t){return(1-Math.cos(Xr*t))/2}function $r(t){return((t*=2)<=1?Math.pow(2,10*t-10):2-Math.pow(2,10-10*t))/2}function Wr(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}var Zr=4/11,Qr=6/11,Kr=8/11,Jr=.75,ti=9/11,ni=10/11,ei=.9375,ri=21/22,ii=63/64,oi=1/Zr/Zr;function ai(t){return(t=+t)<Zr?oi*t*t:t<Kr?oi*(t-=Qr)*t+Jr:t<ni?oi*(t-=ti)*t+ei:oi*(t-=ri)*t+ii}var ui=function t(n){function e(t){return t*t*((n+1)*t-n)}return n=+n,e.overshoot=t,e}(1.70158),ci=function t(n){function e(t){return--t*t*((n+1)*t+n)+1}return n=+n,e.overshoot=t,e}(1.70158),fi=function t(n){function e(t){return((t*=2)<1?t*t*((n+1)*t-n):(t-=2)*t*((n+1)*t+n)+2)/2}return n=+n,e.overshoot=t,e}(1.70158),si=2*Math.PI,li=function t(n,e){var r=Math.asin(1/(n=Math.max(1,n)))*(e/=si);function i(t){return n*Math.pow(2,10*--t)*Math.sin((r-t)/e)}return i.amplitude=function(n){return t(n,e*si)},i.period=function(e){return t(n,e)},i}(1,.3),hi=function t(n,e){var r=Math.asin(1/(n=Math.max(1,n)))*(e/=si);function i(t){return 1-n*Math.pow(2,-10*(t=+t))*Math.sin((t+r)/e)}return i.amplitude=function(n){return t(n,e*si)},i.period=function(e){return t(n,e)},i}(1,.3),di=function t(n,e){var r=Math.asin(1/(n=Math.max(1,n)))*(e/=si);function i(t){return((t=2*t-1)<0?n*Math.pow(2,10*t)*Math.sin((r-t)/e):2-n*Math.pow(2,-10*t)*Math.sin((r+t)/e))/2}return i.amplitude=function(n){return t(n,e*si)},i.period=function(e){return t(n,e)},i}(1,.3),pi={time:null,delay:0,duration:250,ease:Fr};function vi(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))return pi.time=cr(),pi;return e}zt.prototype.interrupt=function(t){return this.each(function(){Cr(this,t)})},zt.prototype.transition=function(t){var n,e;t instanceof Lr?(n=t._id,t=t._name):(n=Or(),(e=pi).time=cr(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,u=r[o],c=u.length,f=0;f<c;++f)(a=u[f])&&Tr(a,t,n,f,u,e||vi(a,n));return new Lr(r,this._parents,t,n)};var gi=[null];function yi(t){return function(){return t}}function _i(t,n,e){this.target=t,this.type=n,this.selection=e}function bi(){t.event.stopImmediatePropagation()}function mi(){t.event.preventDefault(),t.event.stopImmediatePropagation()}var xi={name:"drag"},wi={name:"space"},Mi={name:"handle"},Ni={name:"center"};function Ai(t){return[+t[0],+t[1]]}function Ti(t){return[Ai(t[0]),Ai(t[1])]}var Si={name:"x",handles:["w","e"].map(qi),input:function(t,n){return null==t?null:[[+t[0],n[0][1]],[+t[1],n[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},ki={name:"y",handles:["n","s"].map(qi),input:function(t,n){return null==t?null:[[n[0][0],+t[0]],[n[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Ei={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(qi),input:function(t){return null==t?null:Ti(t)},output:function(t){return t}},Ci={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Pi={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},zi={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Ri={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Di={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function qi(t){return{type:t}}function Li(){return!t.event.ctrlKey&&!t.event.button}function Ui(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Oi(){return navigator.maxTouchPoints||"ontouchstart"in this}function Bi(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function Yi(n){var e,r=Ui,i=Li,o=Oi,a=!0,u=I(f,"start","brush","end"),c=6;function f(t){var e=t.property("__brush",g).selectAll(".overlay").data([qi("overlay")]);e.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Ci.overlay).merge(e).each(function(){var t=Bi(this).extent;Rt(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])}),t.selectAll(".selection").data([qi("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Ci.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=t.selectAll(".handle").data(n.handles,function(t){return t.type});r.exit().remove(),r.enter().append("rect").attr("class",function(t){return"handle handle--"+t.type}).attr("cursor",function(t){return Ci[t.type]}),t.each(s).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(o).on("touchstart.brush",d).on("touchmove.brush",p).on("touchend.brush touchcancel.brush",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function s(){var t=Rt(this),n=Bi(this).selection;n?(t.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(t){return"e"===t.type[t.type.length-1]?n[1][0]-c/2:n[0][0]-c/2}).attr("y",function(t){return"s"===t.type[0]?n[1][1]-c/2:n[0][1]-c/2}).attr("width",function(t){return"n"===t.type||"s"===t.type?n[1][0]-n[0][0]+c:c}).attr("height",function(t){return"e"===t.type||"w"===t.type?n[1][1]-n[0][1]+c:c})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function l(t,n,e){return!e&&t.__brush.emitter||new h(t,n)}function h(t,n){this.that=t,this.args=n,this.state=t.__brush,this.active=0}function d(){if((!e||t.event.touches)&&i.apply(this,arguments)){var r,o,u,c,f,h,d,p,v,g,y,_,b=this,m=t.event.target.__data__.type,x="selection"===(a&&t.event.metaKey?m="overlay":m)?xi:a&&t.event.altKey?Ni:Mi,w=n===ki?null:Ri[m],M=n===Si?null:Di[m],N=Bi(b),A=N.extent,T=N.selection,S=A[0][0],k=A[0][1],E=A[1][0],C=A[1][1],P=0,z=0,R=w&&M&&a&&t.event.shiftKey,D=t.event.touches?(_=t.event.changedTouches[0].identifier,function(n){return Yt(n,t.event.touches,_)}):Bt,q=D(b),L=q,U=l(b,arguments,!0).beforestart();"overlay"===m?(T&&(v=!0),N.selection=T=[[r=n===ki?S:q[0],u=n===Si?k:q[1]],[f=n===ki?E:r,d=n===Si?C:u]]):(r=T[0][0],u=T[0][1],f=T[1][0],d=T[1][1]),o=r,c=u,h=f,p=d;var O=Rt(b).attr("pointer-events","none"),B=O.selectAll(".overlay").attr("cursor",Ci[m]);if(t.event.touches)U.moved=F,U.ended=H;else{var Y=Rt(t.event.view).on("mousemove.brush",F,!0).on("mouseup.brush",H,!0);a&&Y.on("keydown.brush",function(){switch(t.event.keyCode){case 16:R=w&&M;break;case 18:x===Mi&&(w&&(f=h-P*w,r=o+P*w),M&&(d=p-z*M,u=c+z*M),x=Ni,I());break;case 32:x!==Mi&&x!==Ni||(w<0?f=h-P:w>0&&(r=o-P),M<0?d=p-z:M>0&&(u=c-z),x=wi,B.attr("cursor",Ci.selection),I());break;default:return}mi()},!0).on("keyup.brush",function(){switch(t.event.keyCode){case 16:R&&(g=y=R=!1,I());break;case 18:x===Ni&&(w<0?f=h:w>0&&(r=o),M<0?d=p:M>0&&(u=c),x=Mi,I());break;case 32:x===wi&&(t.event.altKey?(w&&(f=h-P*w,r=o+P*w),M&&(d=p-z*M,u=c+z*M),x=Ni):(w<0?f=h:w>0&&(r=o),M<0?d=p:M>0&&(u=c),x=Mi),B.attr("cursor",Ci[m]),I());break;default:return}mi()},!0),Ht(t.event.view)}bi(),Cr(b),s.call(b),U.start()}function F(){var t=D(b);!R||g||y||(Math.abs(t[0]-L[0])>Math.abs(t[1]-L[1])?y=!0:g=!0),L=t,v=!0,mi(),I()}function I(){var t;switch(P=L[0]-q[0],z=L[1]-q[1],x){case wi:case xi:w&&(P=Math.max(S-r,Math.min(E-f,P)),o=r+P,h=f+P),M&&(z=Math.max(k-u,Math.min(C-d,z)),c=u+z,p=d+z);break;case Mi:w<0?(P=Math.max(S-r,Math.min(E-r,P)),o=r+P,h=f):w>0&&(P=Math.max(S-f,Math.min(E-f,P)),o=r,h=f+P),M<0?(z=Math.max(k-u,Math.min(C-u,z)),c=u+z,p=d):M>0&&(z=Math.max(k-d,Math.min(C-d,z)),c=u,p=d+z);break;case Ni:w&&(o=Math.max(S,Math.min(E,r-P*w)),h=Math.max(S,Math.min(E,f+P*w))),M&&(c=Math.max(k,Math.min(C,u-z*M)),p=Math.max(k,Math.min(C,d+z*M)))}h<o&&(w*=-1,t=r,r=f,f=t,t=o,o=h,h=t,m in Pi&&B.attr("cursor",Ci[m=Pi[m]])),p<c&&(M*=-1,t=u,u=d,d=t,t=c,c=p,p=t,m in zi&&B.attr("cursor",Ci[m=zi[m]])),N.selection&&(T=N.selection),g&&(o=T[0][0],h=T[1][0]),y&&(c=T[0][1],p=T[1][1]),T[0][0]===o&&T[0][1]===c&&T[1][0]===h&&T[1][1]===p||(N.selection=[[o,c],[h,p]],s.call(b),U.brush())}function H(){if(bi(),t.event.touches){if(t.event.touches.length)return;e&&clearTimeout(e),e=setTimeout(function(){e=null},500)}else jt(t.event.view,v),Y.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);O.attr("pointer-events","all"),B.attr("cursor",Ci.overlay),N.selection&&(T=N.selection),function(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}(T)&&(N.selection=null,s.call(b)),U.end()}}function p(){l(this,arguments).moved()}function v(){l(this,arguments).ended()}function g(){var t=this.__brush||{selection:null};return t.extent=Ti(r.apply(this,arguments)),t.dim=n,t}return f.move=function(t,e){t.selection?t.on("start.brush",function(){l(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){l(this,arguments).end()}).tween("brush",function(){var t=this,r=t.__brush,i=l(t,arguments),o=r.selection,a=n.input("function"==typeof e?e.apply(this,arguments):e,r.extent),u=Ne(o,a);function c(n){r.selection=1===n&&null===a?null:u(n),s.call(t),i.brush()}return null!==o&&null!==a?c:c(1)}):t.each(function(){var t=this,r=arguments,i=t.__brush,o=n.input("function"==typeof e?e.apply(t,r):e,i.extent),a=l(t,r).beforestart();Cr(t),i.selection=null===o?null:o,s.call(t),a.start().brush().end()})},f.clear=function(t){f.move(t,null)},h.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){kt(new _i(f,t,n.output(this.state.selection)),u.apply,u,[t,this.that,this.args])}},f.extent=function(t){return arguments.length?(r="function"==typeof t?t:yi(Ti(t)),f):r},f.filter=function(t){return arguments.length?(i="function"==typeof t?t:yi(!!t),f):i},f.handleSize=function(t){return arguments.length?(c=+t,f):c},f.keyModifiers=function(t){return arguments.length?(a=!!t,f):a},f.on=function(){var t=u.on.apply(u,arguments);return t===u?f:t},f}var Fi=Math.cos,Ii=Math.sin,Hi=Math.PI,ji=Hi/2,Xi=2*Hi,Gi=Math.max;function Vi(t){return function(n,e){return t(n.source.value+n.target.value,e.source.value+e.target.value)}}var $i=Array.prototype.slice;function Wi(t){return function(){return t}}var Zi=Math.PI,Qi=2*Zi,Ki=Qi-1e-6;function Ji(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function to(){return new Ji}function no(t){return t.source}function eo(t){return t.target}function ro(t){return t.radius}function io(t){return t.startAngle}function oo(t){return t.endAngle}Ji.prototype=to.prototype={constructor:Ji,moveTo:function(t,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,n){this._+="L"+(this._x1=+t)+","+(this._y1=+n)},quadraticCurveTo:function(t,n,e,r){this._+="Q"+ +t+","+ +n+","+(this._x1=+e)+","+(this._y1=+r)},bezierCurveTo:function(t,n,e,r,i,o){this._+="C"+ +t+","+ +n+","+ +e+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(t,n,e,r,i){t=+t,n=+n,e=+e,r=+r,i=+i;var o=this._x1,a=this._y1,u=e-t,c=r-n,f=o-t,s=a-n,l=f*f+s*s;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=n);else if(l>1e-6)if(Math.abs(s*u-c*f)>1e-6&&i){var h=e-o,d=r-a,p=u*u+c*c,v=h*h+d*d,g=Math.sqrt(p),y=Math.sqrt(l),_=i*Math.tan((Zi-Math.acos((p+l-v)/(2*g*y)))/2),b=_/y,m=_/g;Math.abs(b-1)>1e-6&&(this._+="L"+(t+b*f)+","+(n+b*s)),this._+="A"+i+","+i+",0,0,"+ +(s*h>f*d)+","+(this._x1=t+m*u)+","+(this._y1=n+m*c)}else this._+="L"+(this._x1=t)+","+(this._y1=n);else;},arc:function(t,n,e,r,i,o){t=+t,n=+n,o=!!o;var a=(e=+e)*Math.cos(r),u=e*Math.sin(r),c=t+a,f=n+u,s=1^o,l=o?r-i:i-r;if(e<0)throw new Error("negative radius: "+e);null===this._x1?this._+="M"+c+","+f:(Math.abs(this._x1-c)>1e-6||Math.abs(this._y1-f)>1e-6)&&(this._+="L"+c+","+f),e&&(l<0&&(l=l%Qi+Qi),l>Ki?this._+="A"+e+","+e+",0,1,"+s+","+(t-a)+","+(n-u)+"A"+e+","+e+",0,1,"+s+","+(this._x1=c)+","+(this._y1=f):l>1e-6&&(this._+="A"+e+","+e+",0,"+ +(l>=Zi)+","+s+","+(this._x1=t+e*Math.cos(i))+","+(this._y1=n+e*Math.sin(i))))},rect:function(t,n,e,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)+"h"+ +e+"v"+ +r+"h"+-e+"Z"},toString:function(){return this._}};function ao(){}function uo(t,n){var e=new ao;if(t instanceof ao)t.each(function(t,n){e.set(n,t)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==n)for(;++i<o;)e.set(i,t[i]);else for(;++i<o;)e.set(n(r=t[i],i,t),r)}else if(t)for(var a in t)e.set(a,t[a]);return e}function co(){return{}}function fo(t,n,e){t[n]=e}function so(){return uo()}function lo(t,n,e){t.set(n,e)}function ho(){}ao.prototype=uo.prototype={constructor:ao,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,n){return this["$"+t]=n,this},remove:function(t){var n="$"+t;return n in this&&delete this[n]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var n in this)"$"===n[0]&&t.push(n.slice(1));return t},values:function(){var t=[];for(var n in this)"$"===n[0]&&t.push(this[n]);return t},entries:function(){var t=[];for(var n in this)"$"===n[0]&&t.push({key:n.slice(1),value:this[n]});return t},size:function(){var t=0;for(var n in this)"$"===n[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var n in this)"$"===n[0]&&t(this[n],n.slice(1),this)}};var po=uo.prototype;function vo(t,n){var e=new ho;if(t instanceof ho)t.each(function(t){e.add(t)});else if(t){var r=-1,i=t.length;if(null==n)for(;++r<i;)e.add(t[r]);else for(;++r<i;)e.add(n(t[r],r,t))}return e}ho.prototype=vo.prototype={constructor:ho,has:po.has,add:function(t){return this["$"+(t+="")]=t,this},remove:po.remove,clear:po.clear,values:po.keys,size:po.size,empty:po.empty,each:po.each};var go=Array.prototype.slice;function yo(t,n){return t-n}function _o(t){return function(){return t}}function bo(t,n){for(var e,r=-1,i=n.length;++r<i;)if(e=mo(t,n[r]))return e;return 0}function mo(t,n){for(var e=n[0],r=n[1],i=-1,o=0,a=t.length,u=a-1;o<a;u=o++){var c=t[o],f=c[0],s=c[1],l=t[u],h=l[0],d=l[1];if(xo(c,l,n))return 0;s>r!=d>r&&e<(h-f)*(r-s)/(d-s)+f&&(i=-i)}return i}function xo(t,n,e){var r,i,o,a;return function(t,n,e){return(n[0]-t[0])*(e[1]-t[1])==(e[0]-t[0])*(n[1]-t[1])}(t,n,e)&&(i=t[r=+(t[0]===n[0])],o=e[r],a=n[r],i<=o&&o<=a||a<=o&&o<=i)}function wo(){}var Mo=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function No(){var t=1,n=1,e=M,r=u;function i(t){var n=e(t);if(Array.isArray(n))n=n.slice().sort(yo);else{var r=s(t),i=r[0],a=r[1];n=w(i,a,n),n=g(Math.floor(i/n)*n,Math.floor(a/n)*n,n)}return n.map(function(n){return o(t,n)})}function o(e,i){var o=[],u=[];return function(e,r,i){var o,u,c,f,s,l,h=new Array,d=new Array;o=u=-1,f=e[0]>=r,Mo[f<<1].forEach(p);for(;++o<t-1;)c=f,f=e[o+1]>=r,Mo[c|f<<1].forEach(p);Mo[f<<0].forEach(p);for(;++u<n-1;){for(o=-1,f=e[u*t+t]>=r,s=e[u*t]>=r,Mo[f<<1|s<<2].forEach(p);++o<t-1;)c=f,f=e[u*t+t+o+1]>=r,l=s,s=e[u*t+o+1]>=r,Mo[c|f<<1|s<<2|l<<3].forEach(p);Mo[f|s<<3].forEach(p)}o=-1,s=e[u*t]>=r,Mo[s<<2].forEach(p);for(;++o<t-1;)l=s,s=e[u*t+o+1]>=r,Mo[s<<2|l<<3].forEach(p);function p(t){var n,e,r=[t[0][0]+o,t[0][1]+u],c=[t[1][0]+o,t[1][1]+u],f=a(r),s=a(c);(n=d[f])?(e=h[s])?(delete d[n.end],delete h[e.start],n===e?(n.ring.push(c),i(n.ring)):h[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete d[n.end],n.ring.push(c),d[n.end=s]=n):(n=h[s])?(e=d[f])?(delete h[n.start],delete d[e.end],n===e?(n.ring.push(c),i(n.ring)):h[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete h[n.start],n.ring.unshift(r),h[n.start=f]=n):h[f]=d[s]={start:f,end:s,ring:[r,c]}}Mo[s<<3].forEach(p)}(e,i,function(t){r(t,e,i),function(t){for(var n=0,e=t.length,r=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];++n<e;)r+=t[n-1][1]*t[n][0]-t[n-1][0]*t[n][1];return r}(t)>0?o.push([t]):u.push(t)}),u.forEach(function(t){for(var n,e=0,r=o.length;e<r;++e)if(-1!==bo((n=o[e])[0],t))return void n.push(t)}),{type:"MultiPolygon",value:i,coordinates:o}}function a(n){return 2*n[0]+n[1]*(t+1)*4}function u(e,r,i){e.forEach(function(e){var o,a=e[0],u=e[1],c=0|a,f=0|u,s=r[f*t+c];a>0&&a<t&&c===a&&(o=r[f*t+c-1],e[0]=a+(i-o)/(s-o)-.5),u>0&&u<n&&f===u&&(o=r[(f-1)*t+c],e[1]=u+(i-o)/(s-o)-.5)})}return i.contour=o,i.size=function(e){if(!arguments.length)return[t,n];var r=Math.ceil(e[0]),o=Math.ceil(e[1]);if(!(r>0&&o>0))throw new Error("invalid size");return t=r,n=o,i},i.thresholds=function(t){return arguments.length?(e="function"==typeof t?t:Array.isArray(t)?_o(go.call(t)):_o(t),i):e},i.smooth=function(t){return arguments.length?(r=t?u:wo,i):r===u},i}function Ao(t,n,e){for(var r=t.width,i=t.height,o=1+(e<<1),a=0;a<i;++a)for(var u=0,c=0;u<r+e;++u)u<r&&(c+=t.data[u+a*r]),u>=e&&(u>=o&&(c-=t.data[u-o+a*r]),n.data[u-e+a*r]=c/Math.min(u+1,r-1+o-u,o))}function To(t,n,e){for(var r=t.width,i=t.height,o=1+(e<<1),a=0;a<r;++a)for(var u=0,c=0;u<i+e;++u)u<i&&(c+=t.data[a+u*r]),u>=e&&(u>=o&&(c-=t.data[a+(u-o)*r]),n.data[a+(u-e)*r]=c/Math.min(u+1,i-1+o-u,o))}function So(t){return t[0]}function ko(t){return t[1]}function Eo(){return 1}var Co={},Po={},zo=34,Ro=10,Do=13;function qo(t){return new Function("d","return {"+t.map(function(t,n){return JSON.stringify(t)+": d["+n+"]"}).join(",")+"}")}function Lo(t){var n=Object.create(null),e=[];return t.forEach(function(t){for(var r in t)r in n||e.push(n[r]=r)}),e}function Uo(t,n){var e=t+"",r=e.length;return r<n?new Array(n-r+1).join(0)+e:e}function Oo(t){var n=t.getUTCHours(),e=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+Uo(-t,6):t>9999?"+"+Uo(t,6):Uo(t,4)}(t.getUTCFullYear())+"-"+Uo(t.getUTCMonth()+1,2)+"-"+Uo(t.getUTCDate(),2)+(i?"T"+Uo(n,2)+":"+Uo(e,2)+":"+Uo(r,2)+"."+Uo(i,3)+"Z":r?"T"+Uo(n,2)+":"+Uo(e,2)+":"+Uo(r,2)+"Z":e||n?"T"+Uo(n,2)+":"+Uo(e,2)+"Z":"")}function Bo(t){var n=new RegExp('["'+t+"\n\r]"),e=t.charCodeAt(0);function r(t,n){var r,i=[],o=t.length,a=0,u=0,c=o<=0,f=!1;function s(){if(c)return Po;if(f)return f=!1,Co;var n,r,i=a;if(t.charCodeAt(i)===zo){for(;a++<o&&t.charCodeAt(a)!==zo||t.charCodeAt(++a)===zo;);return(n=a)>=o?c=!0:(r=t.charCodeAt(a++))===Ro?f=!0:r===Do&&(f=!0,t.charCodeAt(a)===Ro&&++a),t.slice(i+1,n-1).replace(/""/g,'"')}for(;a<o;){if((r=t.charCodeAt(n=a++))===Ro)f=!0;else if(r===Do)f=!0,t.charCodeAt(a)===Ro&&++a;else if(r!==e)continue;return t.slice(i,n)}return c=!0,t.slice(i,o)}for(t.charCodeAt(o-1)===Ro&&--o,t.charCodeAt(o-1)===Do&&--o;(r=s())!==Po;){for(var l=[];r!==Co&&r!==Po;)l.push(r),r=s();n&&null==(l=n(l,u++))||i.push(l)}return i}function i(n,e){return n.map(function(n){return e.map(function(t){return a(n[t])}).join(t)})}function o(n){return n.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?Oo(t):n.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,n){var e,i,o=r(t,function(t,r){if(e)return e(t,r-1);i=t,e=n?function(t,n){var e=qo(t);return function(r,i){return n(e(r),i,t)}}(t,n):qo(t)});return o.columns=i||[],o},parseRows:r,format:function(n,e){return null==e&&(e=Lo(n)),[e.map(a).join(t)].concat(i(n,e)).join("\n")},formatBody:function(t,n){return null==n&&(n=Lo(t)),i(t,n).join("\n")},formatRows:function(t){return t.map(o).join("\n")}}}var Yo=Bo(","),Fo=Yo.parse,Io=Yo.parseRows,Ho=Yo.format,jo=Yo.formatBody,Xo=Yo.formatRows,Go=Bo("\t"),Vo=Go.parse,$o=Go.parseRows,Wo=Go.format,Zo=Go.formatBody,Qo=Go.formatRows;function Ko(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.blob()}function Jo(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.arrayBuffer()}function ta(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function na(t,n){return fetch(t,n).then(ta)}function ea(t){return function(n,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=void 0),na(n,e).then(function(n){return t(n,r)})}}var ra=ea(Fo),ia=ea(Vo);function oa(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.json()}function aa(t){return function(n,e){return na(n,e).then(function(n){return(new DOMParser).parseFromString(n,t)})}}var ua=aa("application/xml"),ca=aa("text/html"),fa=aa("image/svg+xml");function sa(t){return function(){return t}}function la(){return 1e-6*(Math.random()-.5)}function ha(t,n,e,r){if(isNaN(n)||isNaN(e))return t;var i,o,a,u,c,f,s,l,h,d=t._root,p={data:r},v=t._x0,g=t._y0,y=t._x1,_=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((f=n>=(o=(v+y)/2))?v=o:y=o,(s=e>=(a=(g+_)/2))?g=a:_=a,i=d,!(d=d[l=s<<1|f]))return i[l]=p,t;if(u=+t._x.call(null,d.data),c=+t._y.call(null,d.data),n===u&&e===c)return p.next=d,i?i[l]=p:t._root=p,t;do{i=i?i[l]=new Array(4):t._root=new Array(4),(f=n>=(o=(v+y)/2))?v=o:y=o,(s=e>=(a=(g+_)/2))?g=a:_=a}while((l=s<<1|f)==(h=(c>=a)<<1|u>=o));return i[h]=d,i[l]=p,t}function da(t,n,e,r,i){this.node=t,this.x0=n,this.y0=e,this.x1=r,this.y1=i}function pa(t){return t[0]}function va(t){return t[1]}function ga(t,n,e){var r=new ya(null==n?pa:n,null==e?va:e,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function ya(t,n,e,r,i,o){this._x=t,this._y=n,this._x0=e,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function _a(t){for(var n={data:t.data},e=n;t=t.next;)e=e.next={data:t.data};return n}var ba=ga.prototype=ya.prototype;function ma(t){return t.x+t.vx}function xa(t){return t.y+t.vy}function wa(t){return t.index}function Ma(t,n){var e=t.get(n);if(!e)throw new Error("missing: "+n);return e}function Na(t){return t.x}function Aa(t){return t.y}ba.copy=function(){var t,n,e=new ya(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return e;if(!r.length)return e._root=_a(r),e;for(t=[{source:r,target:e._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(n=r.source[i])&&(n.length?t.push({source:n,target:r.target[i]=new Array(4)}):r.target[i]=_a(n));return e},ba.add=function(t){var n=+this._x.call(null,t),e=+this._y.call(null,t);return ha(this.cover(n,e),n,e,t)},ba.addAll=function(t){var n,e,r,i,o=t.length,a=new Array(o),u=new Array(o),c=1/0,f=1/0,s=-1/0,l=-1/0;for(e=0;e<o;++e)isNaN(r=+this._x.call(null,n=t[e]))||isNaN(i=+this._y.call(null,n))||(a[e]=r,u[e]=i,r<c&&(c=r),r>s&&(s=r),i<f&&(f=i),i>l&&(l=i));if(c>s||f>l)return this;for(this.cover(c,f).cover(s,l),e=0;e<o;++e)ha(this,a[e],u[e],t[e]);return this},ba.cover=function(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(e))i=(e=Math.floor(t))+1,o=(r=Math.floor(n))+1;else{for(var a,u,c=i-e,f=this._root;e>t||t>=i||r>n||n>=o;)switch(u=(n<r)<<1|t<e,(a=new Array(4))[u]=f,f=a,c*=2,u){case 0:i=e+c,o=r+c;break;case 1:e=i-c,o=r+c;break;case 2:i=e+c,r=o-c;break;case 3:e=i-c,r=o-c}this._root&&this._root.length&&(this._root=f)}return this._x0=e,this._y0=r,this._x1=i,this._y1=o,this},ba.data=function(){var t=[];return this.visit(function(n){if(!n.length)do{t.push(n.data)}while(n=n.next)}),t},ba.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},ba.find=function(t,n,e){var r,i,o,a,u,c,f,s=this._x0,l=this._y0,h=this._x1,d=this._y1,p=[],v=this._root;for(v&&p.push(new da(v,s,l,h,d)),null==e?e=1/0:(s=t-e,l=n-e,h=t+e,d=n+e,e*=e);c=p.pop();)if(!(!(v=c.node)||(i=c.x0)>h||(o=c.y0)>d||(a=c.x1)<s||(u=c.y1)<l))if(v.length){var g=(i+a)/2,y=(o+u)/2;p.push(new da(v[3],g,y,a,u),new da(v[2],i,y,g,u),new da(v[1],g,o,a,y),new da(v[0],i,o,g,y)),(f=(n>=y)<<1|t>=g)&&(c=p[p.length-1],p[p.length-1]=p[p.length-1-f],p[p.length-1-f]=c)}else{var _=t-+this._x.call(null,v.data),b=n-+this._y.call(null,v.data),m=_*_+b*b;if(m<e){var x=Math.sqrt(e=m);s=t-x,l=n-x,h=t+x,d=n+x,r=v.data}}return r},ba.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var n,e,r,i,o,a,u,c,f,s,l,h,d=this._root,p=this._x0,v=this._y0,g=this._x1,y=this._y1;if(!d)return this;if(d.length)for(;;){if((f=o>=(u=(p+g)/2))?p=u:g=u,(s=a>=(c=(v+y)/2))?v=c:y=c,n=d,!(d=d[l=s<<1|f]))return this;if(!d.length)break;(n[l+1&3]||n[l+2&3]||n[l+3&3])&&(e=n,h=l)}for(;d.data!==t;)if(r=d,!(d=d.next))return this;return(i=d.next)&&delete d.next,r?(i?r.next=i:delete r.next,this):n?(i?n[l]=i:delete n[l],(d=n[0]||n[1]||n[2]||n[3])&&d===(n[3]||n[2]||n[1]||n[0])&&!d.length&&(e?e[h]=d:this._root=d),this):(this._root=i,this)},ba.removeAll=function(t){for(var n=0,e=t.length;n<e;++n)this.remove(t[n]);return this},ba.root=function(){return this._root},ba.size=function(){var t=0;return this.visit(function(n){if(!n.length)do{++t}while(n=n.next)}),t},ba.visit=function(t){var n,e,r,i,o,a,u=[],c=this._root;for(c&&u.push(new da(c,this._x0,this._y0,this._x1,this._y1));n=u.pop();)if(!t(c=n.node,r=n.x0,i=n.y0,o=n.x1,a=n.y1)&&c.length){var f=(r+o)/2,s=(i+a)/2;(e=c[3])&&u.push(new da(e,f,s,o,a)),(e=c[2])&&u.push(new da(e,r,s,f,a)),(e=c[1])&&u.push(new da(e,f,i,o,s)),(e=c[0])&&u.push(new da(e,r,i,f,s))}return this},ba.visitAfter=function(t){var n,e=[],r=[];for(this._root&&e.push(new da(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var i=n.node;if(i.length){var o,a=n.x0,u=n.y0,c=n.x1,f=n.y1,s=(a+c)/2,l=(u+f)/2;(o=i[0])&&e.push(new da(o,a,u,s,l)),(o=i[1])&&e.push(new da(o,s,u,c,l)),(o=i[2])&&e.push(new da(o,a,l,s,f)),(o=i[3])&&e.push(new da(o,s,l,c,f))}r.push(n)}for(;n=r.pop();)t(n.node,n.x0,n.y0,n.x1,n.y1);return this},ba.x=function(t){return arguments.length?(this._x=t,this):this._x},ba.y=function(t){return arguments.length?(this._y=t,this):this._y};var Ta=10,Sa=Math.PI*(3-Math.sqrt(5));function ka(t,n){if((e=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var e,r=t.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+t.slice(e+1)]}function Ea(t){return(t=ka(Math.abs(t)))?t[1]:NaN}var Ca,Pa=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function za(t){if(!(n=Pa.exec(t)))throw new Error("invalid format: "+t);var n;return new Ra({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}function Ra(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Da(t,n){var e=ka(t,n);if(!e)return t+"";var r=e[0],i=e[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}za.prototype=Ra.prototype,Ra.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var qa={"%":function(t,n){return(100*t).toFixed(n)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,n){return t.toExponential(n)},f:function(t,n){return t.toFixed(n)},g:function(t,n){return t.toPrecision(n)},o:function(t){return Math.round(t).toString(8)},p:function(t,n){return Da(100*t,n)},r:Da,s:function(t,n){var e=ka(t,n);if(!e)return t+"";var r=e[0],i=e[1],o=i-(Ca=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+ka(t,Math.max(0,n+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function La(t){return t}var Ua,Oa=Array.prototype.map,Ba=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ya(t){var n,e,r=void 0===t.grouping||void 0===t.thousands?La:(n=Oa.call(t.grouping,Number),e=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,u=n[0],c=0;i>0&&u>0&&(c+u+1>r&&(u=Math.max(1,r-c)),o.push(t.substring(i-=u,i+u)),!((c+=u+1)>r));)u=n[a=(a+1)%n.length];return o.reverse().join(e)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",u=void 0===t.numerals?La:function(t){return function(n){return n.replace(/[0-9]/g,function(n){return t[+n]})}}(Oa.call(t.numerals,String)),c=void 0===t.percent?"%":t.percent+"",f=void 0===t.minus?"-":t.minus+"",s=void 0===t.nan?"NaN":t.nan+"";function l(t){var n=(t=za(t)).fill,e=t.align,l=t.sign,h=t.symbol,d=t.zero,p=t.width,v=t.comma,g=t.precision,y=t.trim,_=t.type;"n"===_?(v=!0,_="g"):qa[_]||(void 0===g&&(g=12),y=!0,_="g"),(d||"0"===n&&"="===e)&&(d=!0,n="0",e="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",m="$"===h?o:/[%p]/.test(_)?c:"",x=qa[_],w=/[defgprs%]/.test(_);function M(t){var i,o,c,h=b,M=m;if("c"===_)M=x(t)+M,t="";else{var N=(t=+t)<0;if(t=isNaN(t)?s:x(Math.abs(t),g),y&&(t=function(t){t:for(var n,e=t.length,r=1,i=-1;r<e;++r)switch(t[r]){case".":i=n=r;break;case"0":0===i&&(i=r),n=r;break;default:if(i>0){if(!+t[r])break t;i=0}}return i>0?t.slice(0,i)+t.slice(n+1):t}(t)),N&&0==+t&&(N=!1),h=(N?"("===l?l:f:"-"===l||"("===l?"":l)+h,M=("s"===_?Ba[8+Ca/3]:"")+M+(N&&"("===l?")":""),w)for(i=-1,o=t.length;++i<o;)if(48>(c=t.charCodeAt(i))||c>57){M=(46===c?a+t.slice(i+1):t.slice(i))+M,t=t.slice(0,i);break}}v&&!d&&(t=r(t,1/0));var A=h.length+t.length+M.length,T=A<p?new Array(p-A+1).join(n):"";switch(v&&d&&(t=r(T+t,T.length?p-M.length:1/0),T=""),e){case"<":t=h+t+M+T;break;case"=":t=h+T+t+M;break;case"^":t=T.slice(0,A=T.length>>1)+h+t+M+T.slice(A);break;default:t=T+h+t+M}return u(t)}return g=void 0===g?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),M.toString=function(){return t+""},M}return{format:l,formatPrefix:function(t,n){var e=l(((t=za(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Ea(n)/3))),i=Math.pow(10,-r),o=Ba[8+r/3];return function(t){return e(i*t)+o}}}}function Fa(n){return Ua=Ya(n),t.format=Ua.format,t.formatPrefix=Ua.formatPrefix,Ua}function Ia(t){return Math.max(0,-Ea(Math.abs(t)))}function Ha(t,n){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ea(n)/3)))-Ea(Math.abs(t)))}function ja(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,Ea(n)-Ea(t))+1}function Xa(){return new Ga}function Ga(){this.reset()}Fa({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Ga.prototype={constructor:Ga,reset:function(){this.s=this.t=0},add:function(t){$a(Va,t,this.t),$a(this,Va.s,this.s),this.s?this.t+=Va.t:this.s=Va.t},valueOf:function(){return this.s}};var Va=new Ga;function $a(t,n,e){var r=t.s=n+e,i=r-n,o=r-i;t.t=n-o+(e-i)}var Wa=1e-6,Za=1e-12,Qa=Math.PI,Ka=Qa/2,Ja=Qa/4,tu=2*Qa,nu=180/Qa,eu=Qa/180,ru=Math.abs,iu=Math.atan,ou=Math.atan2,au=Math.cos,uu=Math.ceil,cu=Math.exp,fu=Math.log,su=Math.pow,lu=Math.sin,hu=Math.sign||function(t){return t>0?1:t<0?-1:0},du=Math.sqrt,pu=Math.tan;function vu(t){return t>1?0:t<-1?Qa:Math.acos(t)}function gu(t){return t>1?Ka:t<-1?-Ka:Math.asin(t)}function yu(t){return(t=lu(t/2))*t}function _u(){}function bu(t,n){t&&xu.hasOwnProperty(t.type)&&xu[t.type](t,n)}var mu={Feature:function(t,n){bu(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,i=e.length;++r<i;)bu(e[r].geometry,n)}},xu={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){wu(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)wu(e[r],n,0)},Polygon:function(t,n){Mu(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)Mu(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,i=e.length;++r<i;)bu(e[r],n)}};function wu(t,n,e){var r,i=-1,o=t.length-e;for(n.lineStart();++i<o;)r=t[i],n.point(r[0],r[1],r[2]);n.lineEnd()}function Mu(t,n){var e=-1,r=t.length;for(n.polygonStart();++e<r;)wu(t[e],n,1);n.polygonEnd()}function Nu(t,n){t&&mu.hasOwnProperty(t.type)?mu[t.type](t,n):bu(t,n)}var Au,Tu,Su,ku,Eu,Cu=Xa(),Pu=Xa(),zu={point:_u,lineStart:_u,lineEnd:_u,polygonStart:function(){Cu.reset(),zu.lineStart=Ru,zu.lineEnd=Du},polygonEnd:function(){var t=+Cu;Pu.add(t<0?tu+t:t),this.lineStart=this.lineEnd=this.point=_u},sphere:function(){Pu.add(tu)}};function Ru(){zu.point=qu}function Du(){Lu(Au,Tu)}function qu(t,n){zu.point=Lu,Au=t,Tu=n,Su=t*=eu,ku=au(n=(n*=eu)/2+Ja),Eu=lu(n)}function Lu(t,n){var e=(t*=eu)-Su,r=e>=0?1:-1,i=r*e,o=au(n=(n*=eu)/2+Ja),a=lu(n),u=Eu*a,c=ku*o+u*au(i),f=u*r*lu(i);Cu.add(ou(f,c)),Su=t,ku=o,Eu=a}function Uu(t){return[ou(t[1],t[0]),gu(t[2])]}function Ou(t){var n=t[0],e=t[1],r=au(e);return[r*au(n),r*lu(n),lu(e)]}function Bu(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Yu(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function Fu(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function Iu(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function Hu(t){var n=du(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}var ju,Xu,Gu,Vu,$u,Wu,Zu,Qu,Ku,Ju,tc,nc,ec,rc,ic,oc,ac,uc,cc,fc,sc,lc,hc,dc,pc,vc,gc=Xa(),yc={point:_c,lineStart:mc,lineEnd:xc,polygonStart:function(){yc.point=wc,yc.lineStart=Mc,yc.lineEnd=Nc,gc.reset(),zu.polygonStart()},polygonEnd:function(){zu.polygonEnd(),yc.point=_c,yc.lineStart=mc,yc.lineEnd=xc,Cu<0?(ju=-(Gu=180),Xu=-(Vu=90)):gc>Wa?Vu=90:gc<-Wa&&(Xu=-90),Ju[0]=ju,Ju[1]=Gu},sphere:function(){ju=-(Gu=180),Xu=-(Vu=90)}};function _c(t,n){Ku.push(Ju=[ju=t,Gu=t]),n<Xu&&(Xu=n),n>Vu&&(Vu=n)}function bc(t,n){var e=Ou([t*eu,n*eu]);if(Qu){var r=Yu(Qu,e),i=Yu([r[1],-r[0],0],r);Hu(i),i=Uu(i);var o,a=t-$u,u=a>0?1:-1,c=i[0]*nu*u,f=ru(a)>180;f^(u*$u<c&&c<u*t)?(o=i[1]*nu)>Vu&&(Vu=o):f^(u*$u<(c=(c+360)%360-180)&&c<u*t)?(o=-i[1]*nu)<Xu&&(Xu=o):(n<Xu&&(Xu=n),n>Vu&&(Vu=n)),f?t<$u?Ac(ju,t)>Ac(ju,Gu)&&(Gu=t):Ac(t,Gu)>Ac(ju,Gu)&&(ju=t):Gu>=ju?(t<ju&&(ju=t),t>Gu&&(Gu=t)):t>$u?Ac(ju,t)>Ac(ju,Gu)&&(Gu=t):Ac(t,Gu)>Ac(ju,Gu)&&(ju=t)}else Ku.push(Ju=[ju=t,Gu=t]);n<Xu&&(Xu=n),n>Vu&&(Vu=n),Qu=e,$u=t}function mc(){yc.point=bc}function xc(){Ju[0]=ju,Ju[1]=Gu,yc.point=_c,Qu=null}function wc(t,n){if(Qu){var e=t-$u;gc.add(ru(e)>180?e+(e>0?360:-360):e)}else Wu=t,Zu=n;zu.point(t,n),bc(t,n)}function Mc(){zu.lineStart()}function Nc(){wc(Wu,Zu),zu.lineEnd(),ru(gc)>Wa&&(ju=-(Gu=180)),Ju[0]=ju,Ju[1]=Gu,Qu=null}function Ac(t,n){return(n-=t)<0?n+360:n}function Tc(t,n){return t[0]-n[0]}function Sc(t,n){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var kc={sphere:_u,point:Ec,lineStart:Pc,lineEnd:Dc,polygonStart:function(){kc.lineStart=qc,kc.lineEnd=Lc},polygonEnd:function(){kc.lineStart=Pc,kc.lineEnd=Dc}};function Ec(t,n){t*=eu;var e=au(n*=eu);Cc(e*au(t),e*lu(t),lu(n))}function Cc(t,n,e){ec+=(t-ec)/++tc,rc+=(n-rc)/tc,ic+=(e-ic)/tc}function Pc(){kc.point=zc}function zc(t,n){t*=eu;var e=au(n*=eu);dc=e*au(t),pc=e*lu(t),vc=lu(n),kc.point=Rc,Cc(dc,pc,vc)}function Rc(t,n){t*=eu;var e=au(n*=eu),r=e*au(t),i=e*lu(t),o=lu(n),a=ou(du((a=pc*o-vc*i)*a+(a=vc*r-dc*o)*a+(a=dc*i-pc*r)*a),dc*r+pc*i+vc*o);nc+=a,oc+=a*(dc+(dc=r)),ac+=a*(pc+(pc=i)),uc+=a*(vc+(vc=o)),Cc(dc,pc,vc)}function Dc(){kc.point=Ec}function qc(){kc.point=Uc}function Lc(){Oc(lc,hc),kc.point=Ec}function Uc(t,n){lc=t,hc=n,t*=eu,n*=eu,kc.point=Oc;var e=au(n);dc=e*au(t),pc=e*lu(t),vc=lu(n),Cc(dc,pc,vc)}function Oc(t,n){t*=eu;var e=au(n*=eu),r=e*au(t),i=e*lu(t),o=lu(n),a=pc*o-vc*i,u=vc*r-dc*o,c=dc*i-pc*r,f=du(a*a+u*u+c*c),s=gu(f),l=f&&-s/f;cc+=l*a,fc+=l*u,sc+=l*c,nc+=s,oc+=s*(dc+(dc=r)),ac+=s*(pc+(pc=i)),uc+=s*(vc+(vc=o)),Cc(dc,pc,vc)}function Bc(t){return function(){return t}}function Yc(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return(e=n.invert(e,r))&&t.invert(e[0],e[1])}),e}function Fc(t,n){return[ru(t)>Qa?t+Math.round(-t/tu)*tu:t,n]}function Ic(t,n,e){return(t%=tu)?n||e?Yc(jc(t),Xc(n,e)):jc(t):n||e?Xc(n,e):Fc}function Hc(t){return function(n,e){return[(n+=t)>Qa?n-tu:n<-Qa?n+tu:n,e]}}function jc(t){var n=Hc(t);return n.invert=Hc(-t),n}function Xc(t,n){var e=au(t),r=lu(t),i=au(n),o=lu(n);function a(t,n){var a=au(n),u=au(t)*a,c=lu(t)*a,f=lu(n),s=f*e+u*r;return[ou(c*i-s*o,u*e-f*r),gu(s*i+c*o)]}return a.invert=function(t,n){var a=au(n),u=au(t)*a,c=lu(t)*a,f=lu(n),s=f*i-c*o;return[ou(c*i+f*o,u*e+s*r),gu(s*e-u*r)]},a}function Gc(t){function n(n){return(n=t(n[0]*eu,n[1]*eu))[0]*=nu,n[1]*=nu,n}return t=Ic(t[0]*eu,t[1]*eu,t.length>2?t[2]*eu:0),n.invert=function(n){return(n=t.invert(n[0]*eu,n[1]*eu))[0]*=nu,n[1]*=nu,n},n}function Vc(t,n,e,r,i,o){if(e){var a=au(n),u=lu(n),c=r*e;null==i?(i=n+r*tu,o=n-c/2):(i=$c(a,i),o=$c(a,o),(r>0?i<o:i>o)&&(i+=r*tu));for(var f,s=i;r>0?s>o:s<o;s-=c)f=Uu([a,-u*au(s),-u*lu(s)]),t.point(f[0],f[1])}}function $c(t,n){(n=Ou(n))[0]-=t,Hu(n);var e=vu(-n[1]);return((-n[2]<0?-e:e)+tu-Wa)%tu}function Wc(){var t,n=[];return{point:function(n,e){t.push([n,e])},lineStart:function(){n.push(t=[])},lineEnd:_u,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function Zc(t,n){return ru(t[0]-n[0])<Wa&&ru(t[1]-n[1])<Wa}function Qc(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Kc(t,n,e,r,i){var o,a,u=[],c=[];if(t.forEach(function(t){if(!((n=t.length-1)<=0)){var n,e,r=t[0],a=t[n];if(Zc(r,a)){for(i.lineStart(),o=0;o<n;++o)i.point((r=t[o])[0],r[1]);i.lineEnd()}else u.push(e=new Qc(r,t,null,!0)),c.push(e.o=new Qc(r,null,e,!1)),u.push(e=new Qc(a,t,null,!1)),c.push(e.o=new Qc(a,null,e,!0))}}),u.length){for(c.sort(n),Jc(u),Jc(c),o=0,a=c.length;o<a;++o)c[o].e=e=!e;for(var f,s,l=u[0];;){for(var h=l,d=!0;h.v;)if((h=h.n)===l)return;f=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(o=0,a=f.length;o<a;++o)i.point((s=f[o])[0],s[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(f=h.p.z,o=f.length-1;o>=0;--o)i.point((s=f[o])[0],s[1]);else r(h.x,h.p.x,-1,i);h=h.p}f=(h=h.o).z,d=!d}while(!h.v);i.lineEnd()}}}function Jc(t){if(n=t.length){for(var n,e,r=0,i=t[0];++r<n;)i.n=e=t[r],e.p=i,i=e;i.n=e=t[0],e.p=i}}Fc.invert=Fc;var tf=Xa();function nf(t){return ru(t[0])<=Qa?t[0]:hu(t[0])*((ru(t[0])+Qa)%tu-Qa)}function ef(t,n){var e=nf(n),r=n[1],i=lu(r),o=[lu(e),-au(e),0],a=0,u=0;tf.reset(),1===i?r=Ka+Wa:-1===i&&(r=-Ka-Wa);for(var c=0,f=t.length;c<f;++c)if(l=(s=t[c]).length)for(var s,l,h=s[l-1],d=nf(h),p=h[1]/2+Ja,v=lu(p),g=au(p),y=0;y<l;++y,d=b,v=x,g=w,h=_){var _=s[y],b=nf(_),m=_[1]/2+Ja,x=lu(m),w=au(m),M=b-d,N=M>=0?1:-1,A=N*M,T=A>Qa,S=v*x;if(tf.add(ou(S*N*lu(A),g*w+S*au(A))),a+=T?M+N*tu:M,T^d>=e^b>=e){var k=Yu(Ou(h),Ou(_));Hu(k);var E=Yu(o,k);Hu(E);var C=(T^M>=0?-1:1)*gu(E[2]);(r>C||r===C&&(k[0]||k[1]))&&(u+=T^M>=0?1:-1)}}return(a<-Wa||a<Wa&&tf<-Wa)^1&u}function rf(t,n,e,r){return function(i){var o,a,u,c=n(i),f=Wc(),s=n(f),l=!1,h={point:d,lineStart:v,lineEnd:g,polygonStart:function(){h.point=y,h.lineStart=_,h.lineEnd=b,a=[],o=[]},polygonEnd:function(){h.point=d,h.lineStart=v,h.lineEnd=g,a=T(a);var t=ef(o,r);a.length?(l||(i.polygonStart(),l=!0),Kc(a,af,t,e,i)):t&&(l||(i.polygonStart(),l=!0),i.lineStart(),e(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),a=o=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(n,e){t(n,e)&&i.point(n,e)}function p(t,n){c.point(t,n)}function v(){h.point=p,c.lineStart()}function g(){h.point=d,c.lineEnd()}function y(t,n){u.push([t,n]),s.point(t,n)}function _(){s.lineStart(),u=[]}function b(){y(u[0][0],u[0][1]),s.lineEnd();var t,n,e,r,c=s.clean(),h=f.result(),d=h.length;if(u.pop(),o.push(u),u=null,d)if(1&c){if((n=(e=h[0]).length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),t=0;t<n;++t)i.point((r=e[t])[0],r[1]);i.lineEnd()}}else d>1&&2&c&&h.push(h.pop().concat(h.shift())),a.push(h.filter(of))}return h}}function of(t){return t.length>1}function af(t,n){return((t=t.x)[0]<0?t[1]-Ka-Wa:Ka-t[1])-((n=n.x)[0]<0?n[1]-Ka-Wa:Ka-n[1])}var uf=rf(function(){return!0},function(t){var n,e=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),n=1},point:function(o,a){var u=o>0?Qa:-Qa,c=ru(o-e);ru(c-Qa)<Wa?(t.point(e,r=(r+a)/2>0?Ka:-Ka),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(u,r),t.point(o,r),n=0):i!==u&&c>=Qa&&(ru(e-i)<Wa&&(e-=i*Wa),ru(o-u)<Wa&&(o-=u*Wa),r=function(t,n,e,r){var i,o,a=lu(t-e);return ru(a)>Wa?iu((lu(n)*(o=au(r))*lu(e)-lu(r)*(i=au(n))*lu(t))/(i*o*a)):(n+r)/2}(e,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(u,r),n=0),t.point(e=o,r=a),i=u},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-n}}},function(t,n,e,r){var i;if(null==t)i=e*Ka,r.point(-Qa,i),r.point(0,i),r.point(Qa,i),r.point(Qa,0),r.point(Qa,-i),r.point(0,-i),r.point(-Qa,-i),r.point(-Qa,0),r.point(-Qa,i);else if(ru(t[0]-n[0])>Wa){var o=t[0]<n[0]?Qa:-Qa;i=e*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(n[0],n[1])},[-Qa,-Ka]);function cf(t){var n=au(t),e=6*eu,r=n>0,i=ru(n)>Wa;function o(t,e){return au(t)*au(e)>n}function a(t,e,r){var i=[1,0,0],o=Yu(Ou(t),Ou(e)),a=Bu(o,o),u=o[0],c=a-u*u;if(!c)return!r&&t;var f=n*a/c,s=-n*u/c,l=Yu(i,o),h=Iu(i,f);Fu(h,Iu(o,s));var d=l,p=Bu(h,d),v=Bu(d,d),g=p*p-v*(Bu(h,h)-1);if(!(g<0)){var y=du(g),_=Iu(d,(-p-y)/v);if(Fu(_,h),_=Uu(_),!r)return _;var b,m=t[0],x=e[0],w=t[1],M=e[1];x<m&&(b=m,m=x,x=b);var N=x-m,A=ru(N-Qa)<Wa;if(!A&&M<w&&(b=w,w=M,M=b),A||N<Wa?A?w+M>0^_[1]<(ru(_[0]-m)<Wa?w:M):w<=_[1]&&_[1]<=M:N>Qa^(m<=_[0]&&_[0]<=x)){var T=Iu(d,(-p+y)/v);return Fu(T,h),[_,Uu(T)]}}}function u(n,e){var i=r?t:Qa-t,o=0;return n<-i?o|=1:n>i&&(o|=2),e<-i?o|=4:e>i&&(o|=8),o}return rf(o,function(t){var n,e,c,f,s;return{lineStart:function(){f=c=!1,s=1},point:function(l,h){var d,p=[l,h],v=o(l,h),g=r?v?0:u(l,h):v?u(l+(l<0?Qa:-Qa),h):0;if(!n&&(f=c=v)&&t.lineStart(),v!==c&&(!(d=a(n,p))||Zc(n,d)||Zc(p,d))&&(p[0]+=Wa,p[1]+=Wa,v=o(p[0],p[1])),v!==c)s=0,v?(t.lineStart(),d=a(p,n),t.point(d[0],d[1])):(d=a(n,p),t.point(d[0],d[1]),t.lineEnd()),n=d;else if(i&&n&&r^v){var y;g&e||!(y=a(p,n,!0))||(s=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1])))}!v||n&&Zc(n,p)||t.point(p[0],p[1]),n=p,c=v,e=g},lineEnd:function(){c&&t.lineEnd(),n=null},clean:function(){return s|(f&&c)<<1}}},function(n,r,i,o){Vc(o,t,e,i,n,r)},r?[0,-t]:[-Qa,t-Qa])}var ff=1e9,sf=-ff;function lf(t,n,e,r){function i(i,o){return t<=i&&i<=e&&n<=o&&o<=r}function o(i,o,u,f){var s=0,l=0;if(null==i||(s=a(i,u))!==(l=a(o,u))||c(i,o)<0^u>0)do{f.point(0===s||3===s?t:e,s>1?r:n)}while((s=(s+u+4)%4)!==l);else f.point(o[0],o[1])}function a(r,i){return ru(r[0]-t)<Wa?i>0?0:3:ru(r[0]-e)<Wa?i>0?2:1:ru(r[1]-n)<Wa?i>0?1:0:i>0?3:2}function u(t,n){return c(t.x,n.x)}function c(t,n){var e=a(t,1),r=a(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}return function(a){var c,f,s,l,h,d,p,v,g,y,_,b=a,m=Wc(),x={point:w,lineStart:function(){x.point=M,f&&f.push(s=[]);y=!0,g=!1,p=v=NaN},lineEnd:function(){c&&(M(l,h),d&&g&&m.rejoin(),c.push(m.result()));x.point=w,g&&b.lineEnd()},polygonStart:function(){b=m,c=[],f=[],_=!0},polygonEnd:function(){var n=function(){for(var n=0,e=0,i=f.length;e<i;++e)for(var o,a,u=f[e],c=1,s=u.length,l=u[0],h=l[0],d=l[1];c<s;++c)o=h,a=d,l=u[c],h=l[0],d=l[1],a<=r?d>r&&(h-o)*(r-a)>(d-a)*(t-o)&&++n:d<=r&&(h-o)*(r-a)<(d-a)*(t-o)&&--n;return n}(),e=_&&n,i=(c=T(c)).length;(e||i)&&(a.polygonStart(),e&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),i&&Kc(c,u,n,o,a),a.polygonEnd());b=a,c=f=s=null}};function w(t,n){i(t,n)&&b.point(t,n)}function M(o,a){var u=i(o,a);if(f&&s.push([o,a]),y)l=o,h=a,d=u,y=!1,u&&(b.lineStart(),b.point(o,a));else if(u&&g)b.point(o,a);else{var c=[p=Math.max(sf,Math.min(ff,p)),v=Math.max(sf,Math.min(ff,v))],m=[o=Math.max(sf,Math.min(ff,o)),a=Math.max(sf,Math.min(ff,a))];!function(t,n,e,r,i,o){var a,u=t[0],c=t[1],f=0,s=1,l=n[0]-u,h=n[1]-c;if(a=e-u,l||!(a>0)){if(a/=l,l<0){if(a<f)return;a<s&&(s=a)}else if(l>0){if(a>s)return;a>f&&(f=a)}if(a=i-u,l||!(a<0)){if(a/=l,l<0){if(a>s)return;a>f&&(f=a)}else if(l>0){if(a<f)return;a<s&&(s=a)}if(a=r-c,h||!(a>0)){if(a/=h,h<0){if(a<f)return;a<s&&(s=a)}else if(h>0){if(a>s)return;a>f&&(f=a)}if(a=o-c,h||!(a<0)){if(a/=h,h<0){if(a>s)return;a>f&&(f=a)}else if(h>0){if(a<f)return;a<s&&(s=a)}return f>0&&(t[0]=u+f*l,t[1]=c+f*h),s<1&&(n[0]=u+s*l,n[1]=c+s*h),!0}}}}}(c,m,t,n,e,r)?u&&(b.lineStart(),b.point(o,a),_=!1):(g||(b.lineStart(),b.point(c[0],c[1])),b.point(m[0],m[1]),u||b.lineEnd(),_=!1)}p=o,v=a,g=u}return x}}var hf,df,pf,vf=Xa(),gf={sphere:_u,point:_u,lineStart:function(){gf.point=_f,gf.lineEnd=yf},lineEnd:_u,polygonStart:_u,polygonEnd:_u};function yf(){gf.point=gf.lineEnd=_u}function _f(t,n){hf=t*=eu,df=lu(n*=eu),pf=au(n),gf.point=bf}function bf(t,n){t*=eu;var e=lu(n*=eu),r=au(n),i=ru(t-hf),o=au(i),a=r*lu(i),u=pf*e-df*r*o,c=df*e+pf*r*o;vf.add(ou(du(a*a+u*u),c)),hf=t,df=e,pf=r}function mf(t){return vf.reset(),Nu(t,gf),+vf}var xf=[null,null],wf={type:"LineString",coordinates:xf};function Mf(t,n){return xf[0]=t,xf[1]=n,mf(wf)}var Nf={Feature:function(t,n){return Tf(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,i=e.length;++r<i;)if(Tf(e[r].geometry,n))return!0;return!1}},Af={Sphere:function(){return!0},Point:function(t,n){return Sf(t.coordinates,n)},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)if(Sf(e[r],n))return!0;return!1},LineString:function(t,n){return kf(t.coordinates,n)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)if(kf(e[r],n))return!0;return!1},Polygon:function(t,n){return Ef(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)if(Ef(e[r],n))return!0;return!1},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,i=e.length;++r<i;)if(Tf(e[r],n))return!0;return!1}};function Tf(t,n){return!(!t||!Af.hasOwnProperty(t.type))&&Af[t.type](t,n)}function Sf(t,n){return 0===Mf(t,n)}function kf(t,n){for(var e,r,i,o=0,a=t.length;o<a;o++){if(0===(r=Mf(t[o],n)))return!0;if(o>0&&(i=Mf(t[o],t[o-1]))>0&&e<=i&&r<=i&&(e+r-i)*(1-Math.pow((e-r)/i,2))<Za*i)return!0;e=r}return!1}function Ef(t,n){return!!ef(t.map(Cf),Pf(n))}function Cf(t){return(t=t.map(Pf)).pop(),t}function Pf(t){return[t[0]*eu,t[1]*eu]}function zf(t,n,e){var r=g(t,n-Wa,e).concat(n);return function(t){return r.map(function(n){return[t,n]})}}function Rf(t,n,e){var r=g(t,n-Wa,e).concat(n);return function(t){return r.map(function(n){return[n,t]})}}function Df(){var t,n,e,r,i,o,a,u,c,f,s,l,h=10,d=h,p=90,v=360,y=2.5;function _(){return{type:"MultiLineString",coordinates:b()}}function b(){return g(uu(r/p)*p,e,p).map(s).concat(g(uu(u/v)*v,a,v).map(l)).concat(g(uu(n/h)*h,t,h).filter(function(t){return ru(t%p)>Wa}).map(c)).concat(g(uu(o/d)*d,i,d).filter(function(t){return ru(t%v)>Wa}).map(f))}return _.lines=function(){return b().map(function(t){return{type:"LineString",coordinates:t}})},_.outline=function(){return{type:"Polygon",coordinates:[s(r).concat(l(a).slice(1),s(e).reverse().slice(1),l(u).reverse().slice(1))]}},_.extent=function(t){return arguments.length?_.extentMajor(t).extentMinor(t):_.extentMinor()},_.extentMajor=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],u=+t[0][1],a=+t[1][1],r>e&&(t=r,r=e,e=t),u>a&&(t=u,u=a,a=t),_.precision(y)):[[r,u],[e,a]]},_.extentMinor=function(e){return arguments.length?(n=+e[0][0],t=+e[1][0],o=+e[0][1],i=+e[1][1],n>t&&(e=n,n=t,t=e),o>i&&(e=o,o=i,i=e),_.precision(y)):[[n,o],[t,i]]},_.step=function(t){return arguments.length?_.stepMajor(t).stepMinor(t):_.stepMinor()},_.stepMajor=function(t){return arguments.length?(p=+t[0],v=+t[1],_):[p,v]},_.stepMinor=function(t){return arguments.length?(h=+t[0],d=+t[1],_):[h,d]},_.precision=function(h){return arguments.length?(y=+h,c=zf(o,i,90),f=Rf(n,t,y),s=zf(u,a,90),l=Rf(r,e,y),_):y},_.extentMajor([[-180,-90+Wa],[180,90-Wa]]).extentMinor([[-180,-80-Wa],[180,80+Wa]])}function qf(t){return t}var Lf,Uf,Of,Bf,Yf=Xa(),Ff=Xa(),If={point:_u,lineStart:_u,lineEnd:_u,polygonStart:function(){If.lineStart=Hf,If.lineEnd=Gf},polygonEnd:function(){If.lineStart=If.lineEnd=If.point=_u,Yf.add(ru(Ff)),Ff.reset()},result:function(){var t=Yf/2;return Yf.reset(),t}};function Hf(){If.point=jf}function jf(t,n){If.point=Xf,Lf=Of=t,Uf=Bf=n}function Xf(t,n){Ff.add(Bf*t-Of*n),Of=t,Bf=n}function Gf(){Xf(Lf,Uf)}var Vf=1/0,$f=Vf,Wf=-Vf,Zf=Wf,Qf={point:function(t,n){t<Vf&&(Vf=t);t>Wf&&(Wf=t);n<$f&&($f=n);n>Zf&&(Zf=n)},lineStart:_u,lineEnd:_u,polygonStart:_u,polygonEnd:_u,result:function(){var t=[[Vf,$f],[Wf,Zf]];return Wf=Zf=-($f=Vf=1/0),t}};var Kf,Jf,ts,ns,es=0,rs=0,is=0,os=0,as=0,us=0,cs=0,fs=0,ss=0,ls={point:hs,lineStart:ds,lineEnd:gs,polygonStart:function(){ls.lineStart=ys,ls.lineEnd=_s},polygonEnd:function(){ls.point=hs,ls.lineStart=ds,ls.lineEnd=gs},result:function(){var t=ss?[cs/ss,fs/ss]:us?[os/us,as/us]:is?[es/is,rs/is]:[NaN,NaN];return es=rs=is=os=as=us=cs=fs=ss=0,t}};function hs(t,n){es+=t,rs+=n,++is}function ds(){ls.point=ps}function ps(t,n){ls.point=vs,hs(ts=t,ns=n)}function vs(t,n){var e=t-ts,r=n-ns,i=du(e*e+r*r);os+=i*(ts+t)/2,as+=i*(ns+n)/2,us+=i,hs(ts=t,ns=n)}function gs(){ls.point=hs}function ys(){ls.point=bs}function _s(){ms(Kf,Jf)}function bs(t,n){ls.point=ms,hs(Kf=ts=t,Jf=ns=n)}function ms(t,n){var e=t-ts,r=n-ns,i=du(e*e+r*r);os+=i*(ts+t)/2,as+=i*(ns+n)/2,us+=i,cs+=(i=ns*t-ts*n)*(ts+t),fs+=i*(ns+n),ss+=3*i,hs(ts=t,ns=n)}function xs(t){this._context=t}xs.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._context.moveTo(t,n),this._point=1;break;case 1:this._context.lineTo(t,n);break;default:this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,tu)}},result:_u};var ws,Ms,Ns,As,Ts,Ss=Xa(),ks={point:_u,lineStart:function(){ks.point=Es},lineEnd:function(){ws&&Cs(Ms,Ns),ks.point=_u},polygonStart:function(){ws=!0},polygonEnd:function(){ws=null},result:function(){var t=+Ss;return Ss.reset(),t}};function Es(t,n){ks.point=Cs,Ms=As=t,Ns=Ts=n}function Cs(t,n){As-=t,Ts-=n,Ss.add(du(As*As+Ts*Ts)),As=t,Ts=n}function Ps(){this._string=[]}function zs(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Rs(t){return function(n){var e=new Ds;for(var r in t)e[r]=t[r];return e.stream=n,e}}function Ds(){}function qs(t,n,e){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),Nu(e,t.stream(Qf)),n(Qf.result()),null!=r&&t.clipExtent(r),t}function Ls(t,n,e){return qs(t,function(e){var r=n[1][0]-n[0][0],i=n[1][1]-n[0][1],o=Math.min(r/(e[1][0]-e[0][0]),i/(e[1][1]-e[0][1])),a=+n[0][0]+(r-o*(e[1][0]+e[0][0]))/2,u=+n[0][1]+(i-o*(e[1][1]+e[0][1]))/2;t.scale(150*o).translate([a,u])},e)}function Us(t,n,e){return Ls(t,[[0,0],n],e)}function Os(t,n,e){return qs(t,function(e){var r=+n,i=r/(e[1][0]-e[0][0]),o=(r-i*(e[1][0]+e[0][0]))/2,a=-i*e[0][1];t.scale(150*i).translate([o,a])},e)}function Bs(t,n,e){return qs(t,function(e){var r=+n,i=r/(e[1][1]-e[0][1]),o=-i*e[0][0],a=(r-i*(e[1][1]+e[0][1]))/2;t.scale(150*i).translate([o,a])},e)}Ps.prototype={_radius:4.5,_circle:zs(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._string.push("M",t,",",n),this._point=1;break;case 1:this._string.push("L",t,",",n);break;default:null==this._circle&&(this._circle=zs(this._radius)),this._string.push("M",t,",",n,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},Ds.prototype={constructor:Ds,point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Ys=16,Fs=au(30*eu);function Is(t,n){return+n?function(t,n){function e(r,i,o,a,u,c,f,s,l,h,d,p,v,g){var y=f-r,_=s-i,b=y*y+_*_;if(b>4*n&&v--){var m=a+h,x=u+d,w=c+p,M=du(m*m+x*x+w*w),N=gu(w/=M),A=ru(ru(w)-1)<Wa||ru(o-l)<Wa?(o+l)/2:ou(x,m),T=t(A,N),S=T[0],k=T[1],E=S-r,C=k-i,P=_*E-y*C;(P*P/b>n||ru((y*E+_*C)/b-.5)>.3||a*h+u*d+c*p<Fs)&&(e(r,i,o,a,u,c,S,k,A,m/=M,x/=M,w,v,g),g.point(S,k),e(S,k,A,m,x,w,f,s,l,h,d,p,v,g))}}return function(n){var r,i,o,a,u,c,f,s,l,h,d,p,v={point:g,lineStart:y,lineEnd:b,polygonStart:function(){n.polygonStart(),v.lineStart=m},polygonEnd:function(){n.polygonEnd(),v.lineStart=y}};function g(e,r){e=t(e,r),n.point(e[0],e[1])}function y(){s=NaN,v.point=_,n.lineStart()}function _(r,i){var o=Ou([r,i]),a=t(r,i);e(s,l,f,h,d,p,s=a[0],l=a[1],f=r,h=o[0],d=o[1],p=o[2],Ys,n),n.point(s,l)}function b(){v.point=g,n.lineEnd()}function m(){y(),v.point=x,v.lineEnd=w}function x(t,n){_(r=t,n),i=s,o=l,a=h,u=d,c=p,v.point=_}function w(){e(s,l,f,h,d,p,i,o,r,a,u,c,Ys,n),v.lineEnd=b,b()}return v}}(t,n):function(t){return Rs({point:function(n,e){n=t(n,e),this.stream.point(n[0],n[1])}})}(t)}var Hs=Rs({point:function(t,n){this.stream.point(t*eu,n*eu)}});function js(t,n,e,r){var i=au(r),o=lu(r),a=i*t,u=o*t,c=i/t,f=o/t,s=(o*e-i*n)/t,l=(o*n+i*e)/t;function h(t,r){return[a*t-u*r+n,e-u*t-a*r]}return h.invert=function(t,n){return[c*t-f*n+s,l-f*t-c*n]},h}function Xs(t){return Gs(function(){return t})()}function Gs(t){var n,e,r,i,o,a,u,c,f,s,l=150,h=480,d=250,p=0,v=0,g=0,y=0,_=0,b=0,m=null,x=uf,w=null,M=qf,N=.5;function A(t){return c(t[0]*eu,t[1]*eu)}function T(t){return(t=c.invert(t[0],t[1]))&&[t[0]*nu,t[1]*nu]}function S(){var t=js(l,0,0,b).apply(null,n(p,v)),r=(b?js:function(t,n,e){function r(r,i){return[n+t*r,e-t*i]}return r.invert=function(r,i){return[(r-n)/t,(e-i)/t]},r})(l,h-t[0],d-t[1],b);return e=Ic(g,y,_),u=Yc(n,r),c=Yc(e,u),a=Is(u,N),k()}function k(){return f=s=null,A}return A.stream=function(t){return f&&s===t?f:f=Hs(function(t){return Rs({point:function(n,e){var r=t(n,e);return this.stream.point(r[0],r[1])}})}(e)(x(a(M(s=t)))))},A.preclip=function(t){return arguments.length?(x=t,m=void 0,k()):x},A.postclip=function(t){return arguments.length?(M=t,w=r=i=o=null,k()):M},A.clipAngle=function(t){return arguments.length?(x=+t?cf(m=t*eu):(m=null,uf),k()):m*nu},A.clipExtent=function(t){return arguments.length?(M=null==t?(w=r=i=o=null,qf):lf(w=+t[0][0],r=+t[0][1],i=+t[1][0],o=+t[1][1]),k()):null==w?null:[[w,r],[i,o]]},A.scale=function(t){return arguments.length?(l=+t,S()):l},A.translate=function(t){return arguments.length?(h=+t[0],d=+t[1],S()):[h,d]},A.center=function(t){return arguments.length?(p=t[0]%360*eu,v=t[1]%360*eu,S()):[p*nu,v*nu]},A.rotate=function(t){return arguments.length?(g=t[0]%360*eu,y=t[1]%360*eu,_=t.length>2?t[2]%360*eu:0,S()):[g*nu,y*nu,_*nu]},A.angle=function(t){return arguments.length?(b=t%360*eu,S()):b*nu},A.precision=function(t){return arguments.length?(a=Is(u,N=t*t),k()):du(N)},A.fitExtent=function(t,n){return Ls(A,t,n)},A.fitSize=function(t,n){return Us(A,t,n)},A.fitWidth=function(t,n){return Os(A,t,n)},A.fitHeight=function(t,n){return Bs(A,t,n)},function(){return n=t.apply(this,arguments),A.invert=n.invert&&T,S()}}function Vs(t){var n=0,e=Qa/3,r=Gs(t),i=r(n,e);return i.parallels=function(t){return arguments.length?r(n=t[0]*eu,e=t[1]*eu):[n*nu,e*nu]},i}function $s(t,n){var e=lu(t),r=(e+lu(n))/2;if(ru(r)<Wa)return function(t){var n=au(t);function e(t,e){return[t*n,lu(e)/n]}return e.invert=function(t,e){return[t/n,gu(e*n)]},e}(t);var i=1+e*(2*r-e),o=du(i)/r;function a(t,n){var e=du(i-2*r*lu(n))/r;return[e*lu(t*=r),o-e*au(t)]}return a.invert=function(t,n){var e=o-n;return[ou(t,ru(e))/r*hu(e),gu((i-(t*t+e*e)*r*r)/(2*r))]},a}function Ws(){return Vs($s).scale(155.424).center([0,33.6442])}function Zs(){return Ws().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Qs(t){return function(n,e){var r=au(n),i=au(e),o=t(r*i);return[o*i*lu(n),o*lu(e)]}}function Ks(t){return function(n,e){var r=du(n*n+e*e),i=t(r),o=lu(i),a=au(i);return[ou(n*o,r*a),gu(r&&e*o/r)]}}var Js=Qs(function(t){return du(2/(1+t))});Js.invert=Ks(function(t){return 2*gu(t/2)});var tl=Qs(function(t){return(t=vu(t))&&t/lu(t)});function nl(t,n){return[t,fu(pu((Ka+n)/2))]}function el(t){var n,e,r,i=Xs(t),o=i.center,a=i.scale,u=i.translate,c=i.clipExtent,f=null;function s(){var o=Qa*a(),u=i(Gc(i.rotate()).invert([0,0]));return c(null==f?[[u[0]-o,u[1]-o],[u[0]+o,u[1]+o]]:t===nl?[[Math.max(u[0]-o,f),n],[Math.min(u[0]+o,e),r]]:[[f,Math.max(u[1]-o,n)],[e,Math.min(u[1]+o,r)]])}return i.scale=function(t){return arguments.length?(a(t),s()):a()},i.translate=function(t){return arguments.length?(u(t),s()):u()},i.center=function(t){return arguments.length?(o(t),s()):o()},i.clipExtent=function(t){return arguments.length?(null==t?f=n=e=r=null:(f=+t[0][0],n=+t[0][1],e=+t[1][0],r=+t[1][1]),s()):null==f?null:[[f,n],[e,r]]},s()}function rl(t){return pu((Ka+t)/2)}function il(t,n){var e=au(t),r=t===n?lu(t):fu(e/au(n))/fu(rl(n)/rl(t)),i=e*su(rl(t),r)/r;if(!r)return nl;function o(t,n){i>0?n<-Ka+Wa&&(n=-Ka+Wa):n>Ka-Wa&&(n=Ka-Wa);var e=i/su(rl(n),r);return[e*lu(r*t),i-e*au(r*t)]}return o.invert=function(t,n){var e=i-n,o=hu(r)*du(t*t+e*e);return[ou(t,ru(e))/r*hu(e),2*iu(su(i/o,1/r))-Ka]},o}function ol(t,n){return[t,n]}function al(t,n){var e=au(t),r=t===n?lu(t):(e-au(n))/(n-t),i=e/r+t;if(ru(r)<Wa)return ol;function o(t,n){var e=i-n,o=r*t;return[e*lu(o),i-e*au(o)]}return o.invert=function(t,n){var e=i-n;return[ou(t,ru(e))/r*hu(e),i-hu(r)*du(t*t+e*e)]},o}tl.invert=Ks(function(t){return t}),nl.invert=function(t,n){return[t,2*iu(cu(n))-Ka]},ol.invert=ol;var ul=1.340264,cl=-.081106,fl=893e-6,sl=.003796,ll=du(3)/2;function hl(t,n){var e=gu(ll*lu(n)),r=e*e,i=r*r*r;return[t*au(e)/(ll*(ul+3*cl*r+i*(7*fl+9*sl*r))),e*(ul+cl*r+i*(fl+sl*r))]}function dl(t,n){var e=au(n),r=au(t)*e;return[e*lu(t)/r,lu(n)/r]}function pl(t,n,e,r){return 1===t&&1===n&&0===e&&0===r?qf:Rs({point:function(i,o){this.stream.point(i*t+e,o*n+r)}})}function vl(t,n){var e=n*n,r=e*e;return[t*(.8707-.131979*e+r*(r*(.003971*e-.001529*r)-.013791)),n*(1.007226+e*(.015085+r*(.028874*e-.044475-.005916*r)))]}function gl(t,n){return[au(n)*lu(t),lu(n)]}function yl(t,n){var e=au(n),r=1+au(t)*e;return[e*lu(t)/r,lu(n)/r]}function _l(t,n){return[fu(pu((Ka+n)/2)),-t]}function bl(t,n){return t.parent===n.parent?1:2}function ml(t,n){return t+n.x}function xl(t,n){return Math.max(t,n.y)}function wl(t){var n=0,e=t.children,r=e&&e.length;if(r)for(;--r>=0;)n+=e[r].value;else n=1;t.value=n}function Ml(t,n){var e,r,i,o,a,u=new Sl(t),c=+t.value&&(u.value=t.value),f=[u];for(null==n&&(n=Nl);e=f.pop();)if(c&&(e.value=+e.data.value),(i=n(e.data))&&(a=i.length))for(e.children=new Array(a),o=a-1;o>=0;--o)f.push(r=e.children[o]=new Sl(i[o])),r.parent=e,r.depth=e.depth+1;return u.eachBefore(Tl)}function Nl(t){return t.children}function Al(t){t.data=t.data.data}function Tl(t){var n=0;do{t.height=n}while((t=t.parent)&&t.height<++n)}function Sl(t){this.data=t,this.depth=this.height=0,this.parent=null}hl.invert=function(t,n){for(var e,r=n,i=r*r,o=i*i*i,a=0;a<12&&(o=(i=(r-=e=(r*(ul+cl*i+o*(fl+sl*i))-n)/(ul+3*cl*i+o*(7*fl+9*sl*i)))*r)*i*i,!(ru(e)<Za));++a);return[ll*t*(ul+3*cl*i+o*(7*fl+9*sl*i))/au(r),gu(lu(r)/ll)]},dl.invert=Ks(iu),vl.invert=function(t,n){var e,r=n,i=25;do{var o=r*r,a=o*o;r-=e=(r*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-n)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while(ru(e)>Wa&&--i>0);return[t/(.8707+(o=r*r)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),r]},gl.invert=Ks(gu),yl.invert=Ks(function(t){return 2*iu(t)}),_l.invert=function(t,n){return[-n,2*iu(cu(t))-Ka]},Sl.prototype=Ml.prototype={constructor:Sl,count:function(){return this.eachAfter(wl)},each:function(t){var n,e,r,i,o=this,a=[o];do{for(n=a.reverse(),a=[];o=n.pop();)if(t(o),e=o.children)for(r=0,i=e.length;r<i;++r)a.push(e[r])}while(a.length);return this},eachAfter:function(t){for(var n,e,r,i=this,o=[i],a=[];i=o.pop();)if(a.push(i),n=i.children)for(e=0,r=n.length;e<r;++e)o.push(n[e]);for(;i=a.pop();)t(i);return this},eachBefore:function(t){for(var n,e,r=this,i=[r];r=i.pop();)if(t(r),n=r.children)for(e=n.length-1;e>=0;--e)i.push(n[e]);return this},sum:function(t){return this.eachAfter(function(n){for(var e=+t(n.data)||0,r=n.children,i=r&&r.length;--i>=0;)e+=r[i].value;n.value=e})},sort:function(t){return this.eachBefore(function(n){n.children&&n.children.sort(t)})},path:function(t){for(var n=this,e=function(t,n){if(t===n)return t;var e=t.ancestors(),r=n.ancestors(),i=null;for(t=e.pop(),n=r.pop();t===n;)i=t,t=e.pop(),n=r.pop();return i}(n,t),r=[n];n!==e;)n=n.parent,r.push(n);for(var i=r.length;t!==e;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,n=[t];t=t.parent;)n.push(t);return n},descendants:function(){var t=[];return this.each(function(n){t.push(n)}),t},leaves:function(){var t=[];return this.eachBefore(function(n){n.children||t.push(n)}),t},links:function(){var t=this,n=[];return t.each(function(e){e!==t&&n.push({source:e.parent,target:e})}),n},copy:function(){return Ml(this).eachBefore(Al)}};var kl=Array.prototype.slice;function El(t){for(var n,e,r=0,i=(t=function(t){for(var n,e,r=t.length;r;)e=Math.random()*r--|0,n=t[r],t[r]=t[e],t[e]=n;return t}(kl.call(t))).length,o=[];r<i;)n=t[r],e&&zl(e,n)?++r:(e=Dl(o=Cl(o,n)),r=0);return e}function Cl(t,n){var e,r;if(Rl(n,t))return[n];for(e=0;e<t.length;++e)if(Pl(n,t[e])&&Rl(ql(t[e],n),t))return[t[e],n];for(e=0;e<t.length-1;++e)for(r=e+1;r<t.length;++r)if(Pl(ql(t[e],t[r]),n)&&Pl(ql(t[e],n),t[r])&&Pl(ql(t[r],n),t[e])&&Rl(Ll(t[e],t[r],n),t))return[t[e],t[r],n];throw new Error}function Pl(t,n){var e=t.r-n.r,r=n.x-t.x,i=n.y-t.y;return e<0||e*e<r*r+i*i}function zl(t,n){var e=t.r-n.r+1e-6,r=n.x-t.x,i=n.y-t.y;return e>0&&e*e>r*r+i*i}function Rl(t,n){for(var e=0;e<n.length;++e)if(!zl(t,n[e]))return!1;return!0}function Dl(t){switch(t.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(t[0]);case 2:return ql(t[0],t[1]);case 3:return Ll(t[0],t[1],t[2])}}function ql(t,n){var e=t.x,r=t.y,i=t.r,o=n.x,a=n.y,u=n.r,c=o-e,f=a-r,s=u-i,l=Math.sqrt(c*c+f*f);return{x:(e+o+c/l*s)/2,y:(r+a+f/l*s)/2,r:(l+i+u)/2}}function Ll(t,n,e){var r=t.x,i=t.y,o=t.r,a=n.x,u=n.y,c=n.r,f=e.x,s=e.y,l=e.r,h=r-a,d=r-f,p=i-u,v=i-s,g=c-o,y=l-o,_=r*r+i*i-o*o,b=_-a*a-u*u+c*c,m=_-f*f-s*s+l*l,x=d*p-h*v,w=(p*m-v*b)/(2*x)-r,M=(v*g-p*y)/x,N=(d*b-h*m)/(2*x)-i,A=(h*y-d*g)/x,T=M*M+A*A-1,S=2*(o+w*M+N*A),k=w*w+N*N-o*o,E=-(T?(S+Math.sqrt(S*S-4*T*k))/(2*T):k/S);return{x:r+w+M*E,y:i+N+A*E,r:E}}function Ul(t,n,e){var r,i,o,a,u=t.x-n.x,c=t.y-n.y,f=u*u+c*c;f?(i=n.r+e.r,i*=i,a=t.r+e.r,i>(a*=a)?(r=(f+a-i)/(2*f),o=Math.sqrt(Math.max(0,a/f-r*r)),e.x=t.x-r*u-o*c,e.y=t.y-r*c+o*u):(r=(f+i-a)/(2*f),o=Math.sqrt(Math.max(0,i/f-r*r)),e.x=n.x+r*u-o*c,e.y=n.y+r*c+o*u)):(e.x=n.x+e.r,e.y=n.y)}function Ol(t,n){var e=t.r+n.r-1e-6,r=n.x-t.x,i=n.y-t.y;return e>0&&e*e>r*r+i*i}function Bl(t){var n=t._,e=t.next._,r=n.r+e.r,i=(n.x*e.r+e.x*n.r)/r,o=(n.y*e.r+e.y*n.r)/r;return i*i+o*o}function Yl(t){this._=t,this.next=null,this.previous=null}function Fl(t){if(!(i=t.length))return 0;var n,e,r,i,o,a,u,c,f,s,l;if((n=t[0]).x=0,n.y=0,!(i>1))return n.r;if(e=t[1],n.x=-e.r,e.x=n.r,e.y=0,!(i>2))return n.r+e.r;Ul(e,n,r=t[2]),n=new Yl(n),e=new Yl(e),r=new Yl(r),n.next=r.previous=e,e.next=n.previous=r,r.next=e.previous=n;t:for(u=3;u<i;++u){Ul(n._,e._,r=t[u]),r=new Yl(r),c=e.next,f=n.previous,s=e._.r,l=n._.r;do{if(s<=l){if(Ol(c._,r._)){e=c,n.next=e,e.previous=n,--u;continue t}s+=c._.r,c=c.next}else{if(Ol(f._,r._)){(n=f).next=e,e.previous=n,--u;continue t}l+=f._.r,f=f.previous}}while(c!==f.next);for(r.previous=n,r.next=e,n.next=e.previous=e=r,o=Bl(n);(r=r.next)!==e;)(a=Bl(r))<o&&(n=r,o=a);e=n.next}for(n=[e._],r=e;(r=r.next)!==e;)n.push(r._);for(r=El(n),u=0;u<i;++u)(n=t[u]).x-=r.x,n.y-=r.y;return r.r}function Il(t){return null==t?null:Hl(t)}function Hl(t){if("function"!=typeof t)throw new Error;return t}function jl(){return 0}function Xl(t){return function(){return t}}function Gl(t){return Math.sqrt(t.value)}function Vl(t){return function(n){n.children||(n.r=Math.max(0,+t(n)||0))}}function $l(t,n){return function(e){if(r=e.children){var r,i,o,a=r.length,u=t(e)*n||0;if(u)for(i=0;i<a;++i)r[i].r+=u;if(o=Fl(r),u)for(i=0;i<a;++i)r[i].r-=u;e.r=o+u}}}function Wl(t){return function(n){var e=n.parent;n.r*=t,e&&(n.x=e.x+t*n.x,n.y=e.y+t*n.y)}}function Zl(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function Ql(t,n,e,r,i){for(var o,a=t.children,u=-1,c=a.length,f=t.value&&(r-n)/t.value;++u<c;)(o=a[u]).y0=e,o.y1=i,o.x0=n,o.x1=n+=o.value*f}var Kl="$",Jl={depth:-1},th={};function nh(t){return t.id}function eh(t){return t.parentId}function rh(t,n){return t.parent===n.parent?1:2}function ih(t){var n=t.children;return n?n[0]:t.t}function oh(t){var n=t.children;return n?n[n.length-1]:t.t}function ah(t,n,e){var r=e/(n.i-t.i);n.c-=r,n.s+=e,t.c+=r,n.z+=e,n.m+=e}function uh(t,n,e){return t.a.parent===n.parent?t.a:e}function ch(t,n){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=n}function fh(t,n,e,r,i){for(var o,a=t.children,u=-1,c=a.length,f=t.value&&(i-e)/t.value;++u<c;)(o=a[u]).x0=n,o.x1=r,o.y0=e,o.y1=e+=o.value*f}ch.prototype=Object.create(Sl.prototype);var sh=(1+Math.sqrt(5))/2;function lh(t,n,e,r,i,o){for(var a,u,c,f,s,l,h,d,p,v,g,y=[],_=n.children,b=0,m=0,x=_.length,w=n.value;b<x;){c=i-e,f=o-r;do{s=_[m++].value}while(!s&&m<x);for(l=h=s,g=s*s*(v=Math.max(f/c,c/f)/(w*t)),p=Math.max(h/g,g/l);m<x;++m){if(s+=u=_[m].value,u<l&&(l=u),u>h&&(h=u),g=s*s*v,(d=Math.max(h/g,g/l))>p){s-=u;break}p=d}y.push(a={value:s,dice:c<f,children:_.slice(b,m)}),a.dice?Ql(a,e,r,i,w?r+=f*s/w:o):fh(a,e,r,w?e+=c*s/w:i,o),w-=s,b=m}return y}var hh=function t(n){function e(t,e,r,i,o){lh(n,t,e,r,i,o)}return e.ratio=function(n){return t((n=+n)>1?n:1)},e}(sh);var dh=function t(n){function e(t,e,r,i,o){if((a=t._squarify)&&a.ratio===n)for(var a,u,c,f,s,l=-1,h=a.length,d=t.value;++l<h;){for(c=(u=a[l]).children,f=u.value=0,s=c.length;f<s;++f)u.value+=c[f].value;u.dice?Ql(u,e,r,i,r+=(o-r)*u.value/d):fh(u,e,r,e+=(i-e)*u.value/d,o),d-=u.value}else t._squarify=a=lh(n,t,e,r,i,o),a.ratio=n}return e.ratio=function(n){return t((n=+n)>1?n:1)},e}(sh);function ph(t,n,e){return(n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0])}function vh(t,n){return t[0]-n[0]||t[1]-n[1]}function gh(t){for(var n=t.length,e=[0,1],r=2,i=2;i<n;++i){for(;r>1&&ph(t[e[r-2]],t[e[r-1]],t[i])<=0;)--r;e[r++]=i}return e.slice(0,r)}function yh(){return Math.random()}var _h=function t(n){function e(t,e){return t=null==t?0:+t,e=null==e?1:+e,1===arguments.length?(e=t,t=0):e-=t,function(){return n()*e+t}}return e.source=t,e}(yh),bh=function t(n){function e(t,e){var r,i;return t=null==t?0:+t,e=null==e?1:+e,function(){var o;if(null!=r)o=r,r=null;else do{r=2*n()-1,o=2*n()-1,i=r*r+o*o}while(!i||i>1);return t+e*o*Math.sqrt(-2*Math.log(i)/i)}}return e.source=t,e}(yh),mh=function t(n){function e(){var t=bh.source(n).apply(this,arguments);return function(){return Math.exp(t())}}return e.source=t,e}(yh),xh=function t(n){function e(t){return function(){for(var e=0,r=0;r<t;++r)e+=n();return e}}return e.source=t,e}(yh),wh=function t(n){function e(t){var e=xh.source(n)(t);return function(){return e()/t}}return e.source=t,e}(yh),Mh=function t(n){function e(t){return function(){return-Math.log(1-n())/t}}return e.source=t,e}(yh);function Nh(t,n){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(n).domain(t)}return this}function Ah(t,n){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(n).domain(t)}return this}var Th=Array.prototype,Sh=Th.map,kh=Th.slice,Eh={name:"implicit"};function Ch(){var t=uo(),n=[],e=[],r=Eh;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==Eh)return r;t.set(o,a=n.push(i))}return e[(a-1)%e.length]}return i.domain=function(e){if(!arguments.length)return n.slice();n=[],t=uo();for(var r,o,a=-1,u=e.length;++a<u;)t.has(o=(r=e[a])+"")||t.set(o,n.push(r));return i},i.range=function(t){return arguments.length?(e=kh.call(t),i):e.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return Ch(n,e).unknown(r)},Nh.apply(i,arguments),i}function Ph(){var t,n,e=Ch().unknown(void 0),r=e.domain,i=e.range,o=[0,1],a=!1,u=0,c=0,f=.5;function s(){var e=r().length,s=o[1]<o[0],l=o[s-0],h=o[1-s];t=(h-l)/Math.max(1,e-u+2*c),a&&(t=Math.floor(t)),l+=(h-l-t*(e-u))*f,n=t*(1-u),a&&(l=Math.round(l),n=Math.round(n));var d=g(e).map(function(n){return l+t*n});return i(s?d.reverse():d)}return delete e.unknown,e.domain=function(t){return arguments.length?(r(t),s()):r()},e.range=function(t){return arguments.length?(o=[+t[0],+t[1]],s()):o.slice()},e.rangeRound=function(t){return o=[+t[0],+t[1]],a=!0,s()},e.bandwidth=function(){return n},e.step=function(){return t},e.round=function(t){return arguments.length?(a=!!t,s()):a},e.padding=function(t){return arguments.length?(u=Math.min(1,c=+t),s()):u},e.paddingInner=function(t){return arguments.length?(u=Math.min(1,t),s()):u},e.paddingOuter=function(t){return arguments.length?(c=+t,s()):c},e.align=function(t){return arguments.length?(f=Math.max(0,Math.min(1,t)),s()):f},e.copy=function(){return Ph(r(),o).round(a).paddingInner(u).paddingOuter(c).align(f)},Nh.apply(s(),arguments)}function zh(t){return+t}var Rh=[0,1];function Dh(t){return t}function qh(t,n){return(n-=t=+t)?function(e){return(e-t)/n}:function(t){return function(){return t}}(isNaN(n)?NaN:.5)}function Lh(t){var n,e=t[0],r=t[t.length-1];return e>r&&(n=e,e=r,r=n),function(t){return Math.max(e,Math.min(r,t))}}function Uh(t,n,e){var r=t[0],i=t[1],o=n[0],a=n[1];return i<r?(r=qh(i,r),o=e(a,o)):(r=qh(r,i),o=e(o,a)),function(t){return o(r(t))}}function Oh(t,n,e){var r=Math.min(t.length,n.length)-1,o=new Array(r),a=new Array(r),u=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());++u<r;)o[u]=qh(t[u],t[u+1]),a[u]=e(n[u],n[u+1]);return function(n){var e=i(t,n,1,r)-1;return a[e](o[e](n))}}function Bh(t,n){return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Yh(){var t,n,e,r,i,o,a=Rh,u=Rh,c=Ne,f=Dh;function s(){return r=Math.min(a.length,u.length)>2?Oh:Uh,i=o=null,l}function l(n){return isNaN(n=+n)?e:(i||(i=r(a.map(t),u,c)))(t(f(n)))}return l.invert=function(e){return f(n((o||(o=r(u,a.map(t),be)))(e)))},l.domain=function(t){return arguments.length?(a=Sh.call(t,zh),f===Dh||(f=Lh(a)),s()):a.slice()},l.range=function(t){return arguments.length?(u=kh.call(t),s()):u.slice()},l.rangeRound=function(t){return u=kh.call(t),c=Ae,s()},l.clamp=function(t){return arguments.length?(f=t?Lh(a):Dh,l):f!==Dh},l.interpolate=function(t){return arguments.length?(c=t,s()):c},l.unknown=function(t){return arguments.length?(e=t,l):e},function(e,r){return t=e,n=r,s()}}function Fh(t,n){return Yh()(t,n)}function Ih(n,e,r,i){var o,a=w(n,e,r);switch((i=za(null==i?",f":i)).type){case"s":var u=Math.max(Math.abs(n),Math.abs(e));return null!=i.precision||isNaN(o=Ha(a,u))||(i.precision=o),t.formatPrefix(i,u);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(o=ja(a,Math.max(Math.abs(n),Math.abs(e))))||(i.precision=o-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(o=Ia(a))||(i.precision=o-2*("%"===i.type))}return t.format(i)}function Hh(t){var n=t.domain;return t.ticks=function(t){var e=n();return m(e[0],e[e.length-1],null==t?10:t)},t.tickFormat=function(t,e){var r=n();return Ih(r[0],r[r.length-1],null==t?10:t,e)},t.nice=function(e){null==e&&(e=10);var r,i=n(),o=0,a=i.length-1,u=i[o],c=i[a];return c<u&&(r=u,u=c,c=r,r=o,o=a,a=r),(r=x(u,c,e))>0?r=x(u=Math.floor(u/r)*r,c=Math.ceil(c/r)*r,e):r<0&&(r=x(u=Math.ceil(u*r)/r,c=Math.floor(c*r)/r,e)),r>0?(i[o]=Math.floor(u/r)*r,i[a]=Math.ceil(c/r)*r,n(i)):r<0&&(i[o]=Math.ceil(u*r)/r,i[a]=Math.floor(c*r)/r,n(i)),t},t}function jh(t,n){var e,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(e=r,r=i,i=e,e=o,o=a,a=e),t[r]=n.floor(o),t[i]=n.ceil(a),t}function Xh(t){return Math.log(t)}function Gh(t){return Math.exp(t)}function Vh(t){return-Math.log(-t)}function $h(t){return-Math.exp(-t)}function Wh(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Zh(t){return function(n){return-t(-n)}}function Qh(n){var e,r,i=n(Xh,Gh),o=i.domain,a=10;function u(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(n){return Math.log(n)/t})}(a),r=function(t){return 10===t?Wh:t===Math.E?Math.exp:function(n){return Math.pow(t,n)}}(a),o()[0]<0?(e=Zh(e),r=Zh(r),n(Vh,$h)):n(Xh,Gh),i}return i.base=function(t){return arguments.length?(a=+t,u()):a},i.domain=function(t){return arguments.length?(o(t),u()):o()},i.ticks=function(t){var n,i=o(),u=i[0],c=i[i.length-1];(n=c<u)&&(h=u,u=c,c=h);var f,s,l,h=e(u),d=e(c),p=null==t?10:+t,v=[];if(!(a%1)&&d-h<p){if(h=Math.round(h)-1,d=Math.round(d)+1,u>0){for(;h<d;++h)for(s=1,f=r(h);s<a;++s)if(!((l=f*s)<u)){if(l>c)break;v.push(l)}}else for(;h<d;++h)for(s=a-1,f=r(h);s>=1;--s)if(!((l=f*s)<u)){if(l>c)break;v.push(l)}}else v=m(h,d,Math.min(d-h,p)).map(r);return n?v.reverse():v},i.tickFormat=function(n,o){if(null==o&&(o=10===a?".0e":","),"function"!=typeof o&&(o=t.format(o)),n===1/0)return o;null==n&&(n=10);var u=Math.max(1,a*n/i.ticks().length);return function(t){var n=t/r(Math.round(e(t)));return n*a<a-.5&&(n*=a),n<=u?o(t):""}},i.nice=function(){return o(jh(o(),{floor:function(t){return r(Math.floor(e(t)))},ceil:function(t){return r(Math.ceil(e(t)))}}))},i}function Kh(t){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/t))}}function Jh(t){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*t}}function td(t){var n=1,e=t(Kh(n),Jh(n));return e.constant=function(e){return arguments.length?t(Kh(n=+e),Jh(n)):n},Hh(e)}function nd(t){return function(n){return n<0?-Math.pow(-n,t):Math.pow(n,t)}}function ed(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function rd(t){return t<0?-t*t:t*t}function id(t){var n=t(Dh,Dh),e=1;function r(){return 1===e?t(Dh,Dh):.5===e?t(ed,rd):t(nd(e),nd(1/e))}return n.exponent=function(t){return arguments.length?(e=+t,r()):e},Hh(n)}function od(){var t=id(Yh());return t.copy=function(){return Bh(t,od()).exponent(t.exponent())},Nh.apply(t,arguments),t}var ad=new Date,ud=new Date;function cd(t,n,e,r){function i(n){return t(n=new Date(+n)),n}return i.floor=i,i.ceil=function(e){return t(e=new Date(e-1)),n(e,1),t(e),e},i.round=function(t){var n=i(t),e=i.ceil(t);return t-n<e-t?n:e},i.offset=function(t,e){return n(t=new Date(+t),null==e?1:Math.floor(e)),t},i.range=function(e,r,o){var a,u=[];if(e=i.ceil(e),o=null==o?1:Math.floor(o),!(e<r&&o>0))return u;do{u.push(a=new Date(+e)),n(e,o),t(e)}while(a<e&&e<r);return u},i.filter=function(e){return cd(function(n){if(n>=n)for(;t(n),!e(n);)n.setTime(n-1)},function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;n(t,-1),!e(t););else for(;--r>=0;)for(;n(t,1),!e(t););})},e&&(i.count=function(n,r){return ad.setTime(+n),ud.setTime(+r),t(ad),t(ud),Math.floor(e(ad,ud))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(n){return r(n)%t==0}:function(n){return i.count(0,n)%t==0}):i:null}),i}var fd=cd(function(){},function(t,n){t.setTime(+t+n)},function(t,n){return n-t});fd.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?cd(function(n){n.setTime(Math.floor(n/t)*t)},function(n,e){n.setTime(+n+e*t)},function(n,e){return(e-n)/t}):fd:null};var sd=fd.range,ld=6e4,hd=6048e5,dd=cd(function(t){t.setTime(t-t.getMilliseconds())},function(t,n){t.setTime(+t+1e3*n)},function(t,n){return(n-t)/1e3},function(t){return t.getUTCSeconds()}),pd=dd.range,vd=cd(function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())},function(t,n){t.setTime(+t+n*ld)},function(t,n){return(n-t)/ld},function(t){return t.getMinutes()}),gd=vd.range,yd=cd(function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-t.getMinutes()*ld)},function(t,n){t.setTime(+t+36e5*n)},function(t,n){return(n-t)/36e5},function(t){return t.getHours()}),_d=yd.range,bd=cd(function(t){t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*ld)/864e5},function(t){return t.getDate()-1}),md=bd.range;function xd(t){return cd(function(n){n.setDate(n.getDate()-(n.getDay()+7-t)%7),n.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+7*n)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*ld)/hd})}var wd=xd(0),Md=xd(1),Nd=xd(2),Ad=xd(3),Td=xd(4),Sd=xd(5),kd=xd(6),Ed=wd.range,Cd=Md.range,Pd=Nd.range,zd=Ad.range,Rd=Td.range,Dd=Sd.range,qd=kd.range,Ld=cd(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,n){t.setMonth(t.getMonth()+n)},function(t,n){return n.getMonth()-t.getMonth()+12*(n.getFullYear()-t.getFullYear())},function(t){return t.getMonth()}),Ud=Ld.range,Od=cd(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n)},function(t,n){return n.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});Od.every=function(t){return isFinite(t=Math.floor(t))&&t>0?cd(function(n){n.setFullYear(Math.floor(n.getFullYear()/t)*t),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,e){n.setFullYear(n.getFullYear()+e*t)}):null};var Bd=Od.range,Yd=cd(function(t){t.setUTCSeconds(0,0)},function(t,n){t.setTime(+t+n*ld)},function(t,n){return(n-t)/ld},function(t){return t.getUTCMinutes()}),Fd=Yd.range,Id=cd(function(t){t.setUTCMinutes(0,0,0)},function(t,n){t.setTime(+t+36e5*n)},function(t,n){return(n-t)/36e5},function(t){return t.getUTCHours()}),Hd=Id.range,jd=cd(function(t){t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n)},function(t,n){return(n-t)/864e5},function(t){return t.getUTCDate()-1}),Xd=jd.range;function Gd(t){return cd(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-t)%7),n.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+7*n)},function(t,n){return(n-t)/hd})}var Vd=Gd(0),$d=Gd(1),Wd=Gd(2),Zd=Gd(3),Qd=Gd(4),Kd=Gd(5),Jd=Gd(6),tp=Vd.range,np=$d.range,ep=Wd.range,rp=Zd.range,ip=Qd.range,op=Kd.range,ap=Jd.range,up=cd(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCMonth(t.getUTCMonth()+n)},function(t,n){return n.getUTCMonth()-t.getUTCMonth()+12*(n.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()}),cp=up.range,fp=cd(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n)},function(t,n){return n.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});fp.every=function(t){return isFinite(t=Math.floor(t))&&t>0?cd(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/t)*t),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,e){n.setUTCFullYear(n.getUTCFullYear()+e*t)}):null};var sp=fp.range;function lp(t){if(0<=t.y&&t.y<100){var n=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return n.setFullYear(t.y),n}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function hp(t){if(0<=t.y&&t.y<100){var n=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return n.setUTCFullYear(t.y),n}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function dp(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}function pp(t){var n=t.dateTime,e=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,u=t.months,c=t.shortMonths,f=wp(i),s=Mp(i),l=wp(o),h=Mp(o),d=wp(a),p=Mp(a),v=wp(u),g=Mp(u),y=wp(c),_=Mp(c),b={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return c[t.getMonth()]},B:function(t){return u[t.getMonth()]},c:null,d:Hp,e:Hp,f:$p,H:jp,I:Xp,j:Gp,L:Vp,m:Wp,M:Zp,p:function(t){return i[+(t.getHours()>=12)]},Q:Nv,s:Av,S:Qp,u:Kp,U:Jp,V:tv,w:nv,W:ev,x:null,X:null,y:rv,Y:iv,Z:ov,"%":Mv},m={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return c[t.getUTCMonth()]},B:function(t){return u[t.getUTCMonth()]},c:null,d:av,e:av,f:lv,H:uv,I:cv,j:fv,L:sv,m:hv,M:dv,p:function(t){return i[+(t.getUTCHours()>=12)]},Q:Nv,s:Av,S:pv,u:vv,U:gv,V:yv,w:_v,W:bv,x:null,X:null,y:mv,Y:xv,Z:wv,"%":Mv},x={a:function(t,n,e){var r=d.exec(n.slice(e));return r?(t.w=p[r[0].toLowerCase()],e+r[0].length):-1},A:function(t,n,e){var r=l.exec(n.slice(e));return r?(t.w=h[r[0].toLowerCase()],e+r[0].length):-1},b:function(t,n,e){var r=y.exec(n.slice(e));return r?(t.m=_[r[0].toLowerCase()],e+r[0].length):-1},B:function(t,n,e){var r=v.exec(n.slice(e));return r?(t.m=g[r[0].toLowerCase()],e+r[0].length):-1},c:function(t,e,r){return N(t,n,e,r)},d:Rp,e:Rp,f:Bp,H:qp,I:qp,j:Dp,L:Op,m:zp,M:Lp,p:function(t,n,e){var r=f.exec(n.slice(e));return r?(t.p=s[r[0].toLowerCase()],e+r[0].length):-1},Q:Fp,s:Ip,S:Up,u:Ap,U:Tp,V:Sp,w:Np,W:kp,x:function(t,n,r){return N(t,e,n,r)},X:function(t,n,e){return N(t,r,n,e)},y:Cp,Y:Ep,Z:Pp,"%":Yp};function w(t,n){return function(e){var r,i,o,a=[],u=-1,c=0,f=t.length;for(e instanceof Date||(e=new Date(+e));++u<f;)37===t.charCodeAt(u)&&(a.push(t.slice(c,u)),null!=(i=gp[r=t.charAt(++u)])?r=t.charAt(++u):i="e"===r?" ":"0",(o=n[r])&&(r=o(e,i)),a.push(r),c=u+1);return a.push(t.slice(c,u)),a.join("")}}function M(t,n){return function(e){var r,i,o=dp(1900);if(N(o,t,e+="",0)!=e.length)return null;if("Q"in o)return new Date(o.Q);if("p"in o&&(o.H=o.H%12+12*o.p),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=hp(dp(o.y))).getUTCDay(),r=i>4||0===i?$d.ceil(r):$d(r),r=jd.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=n(dp(o.y))).getDay(),r=i>4||0===i?Md.ceil(r):Md(r),r=bd.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?hp(dp(o.y)).getUTCDay():n(dp(o.y)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,hp(o)):n(o)}}function N(t,n,e,r){for(var i,o,a=0,u=n.length,c=e.length;a<u;){if(r>=c)return-1;if(37===(i=n.charCodeAt(a++))){if(i=n.charAt(a++),!(o=x[i in gp?n.charAt(a++):i])||(r=o(t,e,r))<0)return-1}else if(i!=e.charCodeAt(r++))return-1}return r}return b.x=w(e,b),b.X=w(r,b),b.c=w(n,b),m.x=w(e,m),m.X=w(r,m),m.c=w(n,m),{format:function(t){var n=w(t+="",b);return n.toString=function(){return t},n},parse:function(t){var n=M(t+="",lp);return n.toString=function(){return t},n},utcFormat:function(t){var n=w(t+="",m);return n.toString=function(){return t},n},utcParse:function(t){var n=M(t,hp);return n.toString=function(){return t},n}}}var vp,gp={"-":"",_:" ",0:"0"},yp=/^\s*\d+/,_p=/^%/,bp=/[\\^$*+?|[\]().{}]/g;function mp(t,n,e){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<e?new Array(e-o+1).join(n)+i:i)}function xp(t){return t.replace(bp,"\\$&")}function wp(t){return new RegExp("^(?:"+t.map(xp).join("|")+")","i")}function Mp(t){for(var n={},e=-1,r=t.length;++e<r;)n[t[e].toLowerCase()]=e;return n}function Np(t,n,e){var r=yp.exec(n.slice(e,e+1));return r?(t.w=+r[0],e+r[0].length):-1}function Ap(t,n,e){var r=yp.exec(n.slice(e,e+1));return r?(t.u=+r[0],e+r[0].length):-1}function Tp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.U=+r[0],e+r[0].length):-1}function Sp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.V=+r[0],e+r[0].length):-1}function kp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.W=+r[0],e+r[0].length):-1}function Ep(t,n,e){var r=yp.exec(n.slice(e,e+4));return r?(t.y=+r[0],e+r[0].length):-1}function Cp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),e+r[0].length):-1}function Pp(t,n,e){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(e,e+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),e+r[0].length):-1}function zp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.m=r[0]-1,e+r[0].length):-1}function Rp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.d=+r[0],e+r[0].length):-1}function Dp(t,n,e){var r=yp.exec(n.slice(e,e+3));return r?(t.m=0,t.d=+r[0],e+r[0].length):-1}function qp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.H=+r[0],e+r[0].length):-1}function Lp(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.M=+r[0],e+r[0].length):-1}function Up(t,n,e){var r=yp.exec(n.slice(e,e+2));return r?(t.S=+r[0],e+r[0].length):-1}function Op(t,n,e){var r=yp.exec(n.slice(e,e+3));return r?(t.L=+r[0],e+r[0].length):-1}function Bp(t,n,e){var r=yp.exec(n.slice(e,e+6));return r?(t.L=Math.floor(r[0]/1e3),e+r[0].length):-1}function Yp(t,n,e){var r=_p.exec(n.slice(e,e+1));return r?e+r[0].length:-1}function Fp(t,n,e){var r=yp.exec(n.slice(e));return r?(t.Q=+r[0],e+r[0].length):-1}function Ip(t,n,e){var r=yp.exec(n.slice(e));return r?(t.Q=1e3*+r[0],e+r[0].length):-1}function Hp(t,n){return mp(t.getDate(),n,2)}function jp(t,n){return mp(t.getHours(),n,2)}function Xp(t,n){return mp(t.getHours()%12||12,n,2)}function Gp(t,n){return mp(1+bd.count(Od(t),t),n,3)}function Vp(t,n){return mp(t.getMilliseconds(),n,3)}function $p(t,n){return Vp(t,n)+"000"}function Wp(t,n){return mp(t.getMonth()+1,n,2)}function Zp(t,n){return mp(t.getMinutes(),n,2)}function Qp(t,n){return mp(t.getSeconds(),n,2)}function Kp(t){var n=t.getDay();return 0===n?7:n}function Jp(t,n){return mp(wd.count(Od(t),t),n,2)}function tv(t,n){var e=t.getDay();return t=e>=4||0===e?Td(t):Td.ceil(t),mp(Td.count(Od(t),t)+(4===Od(t).getDay()),n,2)}function nv(t){return t.getDay()}function ev(t,n){return mp(Md.count(Od(t),t),n,2)}function rv(t,n){return mp(t.getFullYear()%100,n,2)}function iv(t,n){return mp(t.getFullYear()%1e4,n,4)}function ov(t){var n=t.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+mp(n/60|0,"0",2)+mp(n%60,"0",2)}function av(t,n){return mp(t.getUTCDate(),n,2)}function uv(t,n){return mp(t.getUTCHours(),n,2)}function cv(t,n){return mp(t.getUTCHours()%12||12,n,2)}function fv(t,n){return mp(1+jd.count(fp(t),t),n,3)}function sv(t,n){return mp(t.getUTCMilliseconds(),n,3)}function lv(t,n){return sv(t,n)+"000"}function hv(t,n){return mp(t.getUTCMonth()+1,n,2)}function dv(t,n){return mp(t.getUTCMinutes(),n,2)}function pv(t,n){return mp(t.getUTCSeconds(),n,2)}function vv(t){var n=t.getUTCDay();return 0===n?7:n}function gv(t,n){return mp(Vd.count(fp(t),t),n,2)}function yv(t,n){var e=t.getUTCDay();return t=e>=4||0===e?Qd(t):Qd.ceil(t),mp(Qd.count(fp(t),t)+(4===fp(t).getUTCDay()),n,2)}function _v(t){return t.getUTCDay()}function bv(t,n){return mp($d.count(fp(t),t),n,2)}function mv(t,n){return mp(t.getUTCFullYear()%100,n,2)}function xv(t,n){return mp(t.getUTCFullYear()%1e4,n,4)}function wv(){return"+0000"}function Mv(){return"%"}function Nv(t){return+t}function Av(t){return Math.floor(+t/1e3)}function Tv(n){return vp=pp(n),t.timeFormat=vp.format,t.timeParse=vp.parse,t.utcFormat=vp.utcFormat,t.utcParse=vp.utcParse,vp}Tv({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Sv=Date.prototype.toISOString?function(t){return t.toISOString()}:t.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ");var kv=+new Date("2000-01-01T00:00:00.000Z")?function(t){var n=new Date(t);return isNaN(n)?null:n}:t.utcParse("%Y-%m-%dT%H:%M:%S.%LZ"),Ev=1e3,Cv=60*Ev,Pv=60*Cv,zv=24*Pv,Rv=7*zv,Dv=30*zv,qv=365*zv;function Lv(t){return new Date(t)}function Uv(t){return t instanceof Date?+t:+new Date(+t)}function Ov(t,n,r,i,o,a,u,c,f){var s=Fh(Dh,Dh),l=s.invert,h=s.domain,d=f(".%L"),p=f(":%S"),v=f("%I:%M"),g=f("%I %p"),y=f("%a %d"),_=f("%b %d"),b=f("%B"),m=f("%Y"),x=[[u,1,Ev],[u,5,5*Ev],[u,15,15*Ev],[u,30,30*Ev],[a,1,Cv],[a,5,5*Cv],[a,15,15*Cv],[a,30,30*Cv],[o,1,Pv],[o,3,3*Pv],[o,6,6*Pv],[o,12,12*Pv],[i,1,zv],[i,2,2*zv],[r,1,Rv],[n,1,Dv],[n,3,3*Dv],[t,1,qv]];function M(e){return(u(e)<e?d:a(e)<e?p:o(e)<e?v:i(e)<e?g:n(e)<e?r(e)<e?y:_:t(e)<e?b:m)(e)}function N(n,r,i,o){if(null==n&&(n=10),"number"==typeof n){var a=Math.abs(i-r)/n,u=e(function(t){return t[2]}).right(x,a);u===x.length?(o=w(r/qv,i/qv,n),n=t):u?(o=(u=x[a/x[u-1][2]<x[u][2]/a?u-1:u])[1],n=u[0]):(o=Math.max(w(r,i,n),1),n=c)}return null==o?n:n.every(o)}return s.invert=function(t){return new Date(l(t))},s.domain=function(t){return arguments.length?h(Sh.call(t,Uv)):h().map(Lv)},s.ticks=function(t,n){var e,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(e=i,i=o,o=e),e=(e=N(t,i,o,n))?e.range(i,o+1):[],a?e.reverse():e},s.tickFormat=function(t,n){return null==n?M:f(n)},s.nice=function(t,n){var e=h();return(t=N(t,e[0],e[e.length-1],n))?h(jh(e,t)):s},s.copy=function(){return Bh(s,Ov(t,n,r,i,o,a,u,c,f))},s}function Bv(){var t,n,e,r,i,o=0,a=1,u=Dh,c=!1;function f(n){return isNaN(n=+n)?i:u(0===e?.5:(n=(r(n)-t)*e,c?Math.max(0,Math.min(1,n)):n))}return f.domain=function(i){return arguments.length?(t=r(o=+i[0]),n=r(a=+i[1]),e=t===n?0:1/(n-t),f):[o,a]},f.clamp=function(t){return arguments.length?(c=!!t,f):c},f.interpolator=function(t){return arguments.length?(u=t,f):u},f.unknown=function(t){return arguments.length?(i=t,f):i},function(i){return r=i,t=i(o),n=i(a),e=t===n?0:1/(n-t),f}}function Yv(t,n){return n.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Fv(){var t=id(Bv());return t.copy=function(){return Yv(t,Fv()).exponent(t.exponent())},Ah.apply(t,arguments)}function Iv(){var t,n,e,r,i,o,a,u=0,c=.5,f=1,s=Dh,l=!1;function h(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-n)*(t<n?r:i),s(l?Math.max(0,Math.min(1,t)):t))}return h.domain=function(a){return arguments.length?(t=o(u=+a[0]),n=o(c=+a[1]),e=o(f=+a[2]),r=t===n?0:.5/(n-t),i=n===e?0:.5/(e-n),h):[u,c,f]},h.clamp=function(t){return arguments.length?(l=!!t,h):l},h.interpolator=function(t){return arguments.length?(s=t,h):s},h.unknown=function(t){return arguments.length?(a=t,h):a},function(a){return o=a,t=a(u),n=a(c),e=a(f),r=t===n?0:.5/(n-t),i=n===e?0:.5/(e-n),h}}function Hv(){var t=id(Iv());return t.copy=function(){return Yv(t,Hv()).exponent(t.exponent())},Ah.apply(t,arguments)}function jv(t){for(var n=t.length/6|0,e=new Array(n),r=0;r<n;)e[r]="#"+t.slice(6*r,6*++r);return e}var Xv=jv("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Gv=jv("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Vv=jv("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),$v=jv("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Wv=jv("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Zv=jv("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Qv=jv("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Kv=jv("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Jv=jv("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),tg=jv("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function ng(t){return ve(t[t.length-1])}var eg=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(jv),rg=ng(eg),ig=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(jv),og=ng(ig),ag=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(jv),ug=ng(ag),cg=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(jv),fg=ng(cg),sg=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(jv),lg=ng(sg),hg=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(jv),dg=ng(hg),pg=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(jv),vg=ng(pg),gg=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(jv),yg=ng(gg),_g=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(jv),bg=ng(_g),mg=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(jv),xg=ng(mg),wg=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(jv),Mg=ng(wg),Ng=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(jv),Ag=ng(Ng),Tg=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(jv),Sg=ng(Tg),kg=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(jv),Eg=ng(kg),Cg=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(jv),Pg=ng(Cg),zg=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(jv),Rg=ng(zg),Dg=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(jv),qg=ng(Dg),Lg=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(jv),Ug=ng(Lg),Og=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(jv),Bg=ng(Og),Yg=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(jv),Fg=ng(Yg),Ig=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(jv),Hg=ng(Ig),jg=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(jv),Xg=ng(jg),Gg=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(jv),Vg=ng(Gg),$g=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(jv),Wg=ng($g),Zg=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(jv),Qg=ng(Zg),Kg=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(jv),Jg=ng(Kg),ty=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(jv),ny=ng(ty);var ey=Ze(re(300,.5,0),re(-240,.5,1)),ry=Ze(re(-100,.75,.35),re(80,1.5,.8)),iy=Ze(re(260,.75,.35),re(80,1.5,.8)),oy=re();var ay=bn(),uy=Math.PI/3,cy=2*Math.PI/3;function fy(t){var n=t.length;return function(e){return t[Math.max(0,Math.min(n-1,Math.floor(e*n)))]}}var sy=fy(jv("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),ly=fy(jv("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),hy=fy(jv("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),dy=fy(jv("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function py(t){return function(){return t}}var vy=Math.abs,gy=Math.atan2,yy=Math.cos,_y=Math.max,by=Math.min,my=Math.sin,xy=Math.sqrt,wy=1e-12,My=Math.PI,Ny=My/2,Ay=2*My;function Ty(t){return t>=1?Ny:t<=-1?-Ny:Math.asin(t)}function Sy(t){return t.innerRadius}function ky(t){return t.outerRadius}function Ey(t){return t.startAngle}function Cy(t){return t.endAngle}function Py(t){return t&&t.padAngle}function zy(t,n,e,r,i,o,a){var u=t-e,c=n-r,f=(a?o:-o)/xy(u*u+c*c),s=f*c,l=-f*u,h=t+s,d=n+l,p=e+s,v=r+l,g=(h+p)/2,y=(d+v)/2,_=p-h,b=v-d,m=_*_+b*b,x=i-o,w=h*v-p*d,M=(b<0?-1:1)*xy(_y(0,x*x*m-w*w)),N=(w*b-_*M)/m,A=(-w*_-b*M)/m,T=(w*b+_*M)/m,S=(-w*_+b*M)/m,k=N-g,E=A-y,C=T-g,P=S-y;return k*k+E*E>C*C+P*P&&(N=T,A=S),{cx:N,cy:A,x01:-s,y01:-l,x11:N*(i/x-1),y11:A*(i/x-1)}}function Ry(t){this._context=t}function Dy(t){return new Ry(t)}function qy(t){return t[0]}function Ly(t){return t[1]}function Uy(){var t=qy,n=Ly,e=py(!0),r=null,i=Dy,o=null;function a(a){var u,c,f,s=a.length,l=!1;for(null==r&&(o=i(f=to())),u=0;u<=s;++u)!(u<s&&e(c=a[u],u,a))===l&&((l=!l)?o.lineStart():o.lineEnd()),l&&o.point(+t(c,u,a),+n(c,u,a));if(f)return o=null,f+""||null}return a.x=function(n){return arguments.length?(t="function"==typeof n?n:py(+n),a):t},a.y=function(t){return arguments.length?(n="function"==typeof t?t:py(+t),a):n},a.defined=function(t){return arguments.length?(e="function"==typeof t?t:py(!!t),a):e},a.curve=function(t){return arguments.length?(i=t,null!=r&&(o=i(r)),a):i},a.context=function(t){return arguments.length?(null==t?r=o=null:o=i(r=t),a):r},a}function Oy(){var t=qy,n=null,e=py(0),r=Ly,i=py(!0),o=null,a=Dy,u=null;function c(c){var f,s,l,h,d,p=c.length,v=!1,g=new Array(p),y=new Array(p);for(null==o&&(u=a(d=to())),f=0;f<=p;++f){if(!(f<p&&i(h=c[f],f,c))===v)if(v=!v)s=f,u.areaStart(),u.lineStart();else{for(u.lineEnd(),u.lineStart(),l=f-1;l>=s;--l)u.point(g[l],y[l]);u.lineEnd(),u.areaEnd()}v&&(g[f]=+t(h,f,c),y[f]=+e(h,f,c),u.point(n?+n(h,f,c):g[f],r?+r(h,f,c):y[f]))}if(d)return u=null,d+""||null}function f(){return Uy().defined(i).curve(a).context(o)}return c.x=function(e){return arguments.length?(t="function"==typeof e?e:py(+e),n=null,c):t},c.x0=function(n){return arguments.length?(t="function"==typeof n?n:py(+n),c):t},c.x1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:py(+t),c):n},c.y=function(t){return arguments.length?(e="function"==typeof t?t:py(+t),r=null,c):e},c.y0=function(t){return arguments.length?(e="function"==typeof t?t:py(+t),c):e},c.y1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:py(+t),c):r},c.lineX0=c.lineY0=function(){return f().x(t).y(e)},c.lineY1=function(){return f().x(t).y(r)},c.lineX1=function(){return f().x(n).y(e)},c.defined=function(t){return arguments.length?(i="function"==typeof t?t:py(!!t),c):i},c.curve=function(t){return arguments.length?(a=t,null!=o&&(u=a(o)),c):a},c.context=function(t){return arguments.length?(null==t?o=u=null:u=a(o=t),c):o},c}function By(t,n){return n<t?-1:n>t?1:n>=t?0:NaN}function Yy(t){return t}Ry.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n)}}};var Fy=Hy(Dy);function Iy(t){this._curve=t}function Hy(t){function n(n){return new Iy(t(n))}return n._curve=t,n}function jy(t){var n=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(t){return arguments.length?n(Hy(t)):n()._curve},t}function Xy(){return jy(Uy().curve(Fy))}function Gy(){var t=Oy().curve(Fy),n=t.curve,e=t.lineX0,r=t.lineX1,i=t.lineY0,o=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return jy(e())},delete t.lineX0,t.lineEndAngle=function(){return jy(r())},delete t.lineX1,t.lineInnerRadius=function(){return jy(i())},delete t.lineY0,t.lineOuterRadius=function(){return jy(o())},delete t.lineY1,t.curve=function(t){return arguments.length?n(Hy(t)):n()._curve},t}function Vy(t,n){return[(n=+n)*Math.cos(t-=Math.PI/2),n*Math.sin(t)]}Iy.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,n){this._curve.point(n*Math.sin(t),n*-Math.cos(t))}};var $y=Array.prototype.slice;function Wy(t){return t.source}function Zy(t){return t.target}function Qy(t){var n=Wy,e=Zy,r=qy,i=Ly,o=null;function a(){var a,u=$y.call(arguments),c=n.apply(this,u),f=e.apply(this,u);if(o||(o=a=to()),t(o,+r.apply(this,(u[0]=c,u)),+i.apply(this,u),+r.apply(this,(u[0]=f,u)),+i.apply(this,u)),a)return o=null,a+""||null}return a.source=function(t){return arguments.length?(n=t,a):n},a.target=function(t){return arguments.length?(e=t,a):e},a.x=function(t){return arguments.length?(r="function"==typeof t?t:py(+t),a):r},a.y=function(t){return arguments.length?(i="function"==typeof t?t:py(+t),a):i},a.context=function(t){return arguments.length?(o=null==t?null:t,a):o},a}function Ky(t,n,e,r,i){t.moveTo(n,e),t.bezierCurveTo(n=(n+r)/2,e,n,i,r,i)}function Jy(t,n,e,r,i){t.moveTo(n,e),t.bezierCurveTo(n,e=(e+i)/2,r,e,r,i)}function t_(t,n,e,r,i){var o=Vy(n,e),a=Vy(n,e=(e+i)/2),u=Vy(r,e),c=Vy(r,i);t.moveTo(o[0],o[1]),t.bezierCurveTo(a[0],a[1],u[0],u[1],c[0],c[1])}var n_={draw:function(t,n){var e=Math.sqrt(n/My);t.moveTo(e,0),t.arc(0,0,e,0,Ay)}},e_={draw:function(t,n){var e=Math.sqrt(n/5)/2;t.moveTo(-3*e,-e),t.lineTo(-e,-e),t.lineTo(-e,-3*e),t.lineTo(e,-3*e),t.lineTo(e,-e),t.lineTo(3*e,-e),t.lineTo(3*e,e),t.lineTo(e,e),t.lineTo(e,3*e),t.lineTo(-e,3*e),t.lineTo(-e,e),t.lineTo(-3*e,e),t.closePath()}},r_=Math.sqrt(1/3),i_=2*r_,o_={draw:function(t,n){var e=Math.sqrt(n/i_),r=e*r_;t.moveTo(0,-e),t.lineTo(r,0),t.lineTo(0,e),t.lineTo(-r,0),t.closePath()}},a_=Math.sin(My/10)/Math.sin(7*My/10),u_=Math.sin(Ay/10)*a_,c_=-Math.cos(Ay/10)*a_,f_={draw:function(t,n){var e=Math.sqrt(.8908130915292852*n),r=u_*e,i=c_*e;t.moveTo(0,-e),t.lineTo(r,i);for(var o=1;o<5;++o){var a=Ay*o/5,u=Math.cos(a),c=Math.sin(a);t.lineTo(c*e,-u*e),t.lineTo(u*r-c*i,c*r+u*i)}t.closePath()}},s_={draw:function(t,n){var e=Math.sqrt(n),r=-e/2;t.rect(r,r,e,e)}},l_=Math.sqrt(3),h_={draw:function(t,n){var e=-Math.sqrt(n/(3*l_));t.moveTo(0,2*e),t.lineTo(-l_*e,-e),t.lineTo(l_*e,-e),t.closePath()}},d_=Math.sqrt(3)/2,p_=1/Math.sqrt(12),v_=3*(p_/2+1),g_={draw:function(t,n){var e=Math.sqrt(n/v_),r=e/2,i=e*p_,o=r,a=e*p_+e,u=-o,c=a;t.moveTo(r,i),t.lineTo(o,a),t.lineTo(u,c),t.lineTo(-.5*r-d_*i,d_*r+-.5*i),t.lineTo(-.5*o-d_*a,d_*o+-.5*a),t.lineTo(-.5*u-d_*c,d_*u+-.5*c),t.lineTo(-.5*r+d_*i,-.5*i-d_*r),t.lineTo(-.5*o+d_*a,-.5*a-d_*o),t.lineTo(-.5*u+d_*c,-.5*c-d_*u),t.closePath()}},y_=[n_,e_,o_,s_,f_,h_,g_];function __(){}function b_(t,n,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+n)/6,(t._y0+4*t._y1+e)/6)}function m_(t){this._context=t}function x_(t){this._context=t}function w_(t){this._context=t}function M_(t,n){this._basis=new m_(t),this._beta=n}m_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:b_(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:b_(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},x_.prototype={areaStart:__,areaEnd:__,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x2=t,this._y2=n;break;case 1:this._point=2,this._x3=t,this._y3=n;break;case 2:this._point=3,this._x4=t,this._y4=n,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+n)/6);break;default:b_(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},w_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var e=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(e,r):this._context.moveTo(e,r);break;case 3:this._point=4;default:b_(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},M_.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,n=this._y,e=t.length-1;if(e>0)for(var r,i=t[0],o=n[0],a=t[e]-i,u=n[e]-o,c=-1;++c<=e;)r=c/e,this._basis.point(this._beta*t[c]+(1-this._beta)*(i+r*a),this._beta*n[c]+(1-this._beta)*(o+r*u));this._x=this._y=null,this._basis.lineEnd()},point:function(t,n){this._x.push(+t),this._y.push(+n)}};var N_=function t(n){function e(t){return 1===n?new m_(t):new M_(t,n)}return e.beta=function(n){return t(+n)},e}(.85);function A_(t,n,e){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-n),t._y2+t._k*(t._y1-e),t._x2,t._y2)}function T_(t,n){this._context=t,this._k=(1-n)/6}T_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:A_(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2,this._x1=t,this._y1=n;break;case 2:this._point=3;default:A_(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var S_=function t(n){function e(t){return new T_(t,n)}return e.tension=function(n){return t(+n)},e}(0);function k_(t,n){this._context=t,this._k=(1-n)/6}k_.prototype={areaStart:__,areaEnd:__,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:A_(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var E_=function t(n){function e(t){return new k_(t,n)}return e.tension=function(n){return t(+n)},e}(0);function C_(t,n){this._context=t,this._k=(1-n)/6}C_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:A_(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var P_=function t(n){function e(t){return new C_(t,n)}return e.tension=function(n){return t(+n)},e}(0);function z_(t,n,e){var r=t._x1,i=t._y1,o=t._x2,a=t._y2;if(t._l01_a>wy){var u=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*u-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,i=(i*u-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>wy){var f=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,s=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*f+t._x1*t._l23_2a-n*t._l12_2a)/s,a=(a*f+t._y1*t._l23_2a-e*t._l12_2a)/s}t._context.bezierCurveTo(r,i,o,a,t._x2,t._y2)}function R_(t,n){this._context=t,this._alpha=n}R_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,r=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3;default:z_(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var D_=function t(n){function e(t){return n?new R_(t,n):new T_(t,0)}return e.alpha=function(n){return t(+n)},e}(.5);function q_(t,n){this._context=t,this._alpha=n}q_.prototype={areaStart:__,areaEnd:__,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,r=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:z_(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var L_=function t(n){function e(t){return n?new q_(t,n):new k_(t,0)}return e.alpha=function(n){return t(+n)},e}(.5);function U_(t,n){this._context=t,this._alpha=n}U_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,r=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:z_(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var O_=function t(n){function e(t){return n?new U_(t,n):new C_(t,0)}return e.alpha=function(n){return t(+n)},e}(.5);function B_(t){this._context=t}function Y_(t){return t<0?-1:1}function F_(t,n,e){var r=t._x1-t._x0,i=n-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(e-t._y1)/(i||r<0&&-0),u=(o*i+a*r)/(r+i);return(Y_(o)+Y_(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(u))||0}function I_(t,n){var e=t._x1-t._x0;return e?(3*(t._y1-t._y0)/e-n)/2:n}function H_(t,n,e){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,u=(o-r)/3;t._context.bezierCurveTo(r+u,i+u*n,o-u,a-u*e,o,a)}function j_(t){this._context=t}function X_(t){this._context=new G_(t)}function G_(t){this._context=t}function V_(t){this._context=t}function $_(t){var n,e,r=t.length-1,i=new Array(r),o=new Array(r),a=new Array(r);for(i[0]=0,o[0]=2,a[0]=t[0]+2*t[1],n=1;n<r-1;++n)i[n]=1,o[n]=4,a[n]=4*t[n]+2*t[n+1];for(i[r-1]=2,o[r-1]=7,a[r-1]=8*t[r-1]+t[r],n=1;n<r;++n)e=i[n]/o[n-1],o[n]-=e,a[n]-=e*a[n-1];for(i[r-1]=a[r-1]/o[r-1],n=r-2;n>=0;--n)i[n]=(a[n]-i[n+1])/o[n];for(o[r-1]=(t[r]+i[r-1])/2,n=0;n<r-1;++n)o[n]=2*t[n+1]-i[n+1];return[i,o]}function W_(t,n){this._context=t,this._t=n}function Z_(t,n){if((i=t.length)>1)for(var e,r,i,o=1,a=t[n[0]],u=a.length;o<i;++o)for(r=a,a=t[n[o]],e=0;e<u;++e)a[e][1]+=a[e][0]=isNaN(r[e][1])?r[e][0]:r[e][1]}function Q_(t){for(var n=t.length,e=new Array(n);--n>=0;)e[n]=n;return e}function K_(t,n){return t[n]}function J_(t){var n=t.map(tb);return Q_(t).sort(function(t,e){return n[t]-n[e]})}function tb(t){for(var n,e=-1,r=0,i=t.length,o=-1/0;++e<i;)(n=+t[e][1])>o&&(o=n,r=e);return r}function nb(t){var n=t.map(eb);return Q_(t).sort(function(t,e){return n[t]-n[e]})}function eb(t){for(var n,e=0,r=-1,i=t.length;++r<i;)(n=+t[r][1])&&(e+=n);return e}function rb(t){return function(){return t}}function ib(t){return t[0]}function ob(t){return t[1]}function ab(){this._=null}function ub(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function cb(t,n){var e=n,r=n.R,i=e.U;i?i.L===e?i.L=r:i.R=r:t._=r,r.U=i,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function fb(t,n){var e=n,r=n.L,i=e.U;i?i.L===e?i.L=r:i.R=r:t._=r,r.U=i,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function sb(t){for(;t.L;)t=t.L;return t}function lb(t,n,e,r){var i=[null,null],o=qb.push(i)-1;return i.left=t,i.right=n,e&&db(i,t,n,e),r&&db(i,n,t,r),Rb[t.index].halfedges.push(o),Rb[n.index].halfedges.push(o),i}function hb(t,n,e){var r=[n,e];return r.left=t,r}function db(t,n,e,r){t[0]||t[1]?t.left===e?t[1]=r:t[0]=r:(t[0]=r,t.left=n,t.right=e)}function pb(t,n,e,r,i){var o,a=t[0],u=t[1],c=a[0],f=a[1],s=0,l=1,h=u[0]-c,d=u[1]-f;if(o=n-c,h||!(o>0)){if(o/=h,h<0){if(o<s)return;o<l&&(l=o)}else if(h>0){if(o>l)return;o>s&&(s=o)}if(o=r-c,h||!(o<0)){if(o/=h,h<0){if(o>l)return;o>s&&(s=o)}else if(h>0){if(o<s)return;o<l&&(l=o)}if(o=e-f,d||!(o>0)){if(o/=d,d<0){if(o<s)return;o<l&&(l=o)}else if(d>0){if(o>l)return;o>s&&(s=o)}if(o=i-f,d||!(o<0)){if(o/=d,d<0){if(o>l)return;o>s&&(s=o)}else if(d>0){if(o<s)return;o<l&&(l=o)}return!(s>0||l<1)||(s>0&&(t[0]=[c+s*h,f+s*d]),l<1&&(t[1]=[c+l*h,f+l*d]),!0)}}}}}function vb(t,n,e,r,i){var o=t[1];if(o)return!0;var a,u,c=t[0],f=t.left,s=t.right,l=f[0],h=f[1],d=s[0],p=s[1],v=(l+d)/2,g=(h+p)/2;if(p===h){if(v<n||v>=r)return;if(l>d){if(c){if(c[1]>=i)return}else c=[v,e];o=[v,i]}else{if(c){if(c[1]<e)return}else c=[v,i];o=[v,e]}}else if(u=g-(a=(l-d)/(p-h))*v,a<-1||a>1)if(l>d){if(c){if(c[1]>=i)return}else c=[(e-u)/a,e];o=[(i-u)/a,i]}else{if(c){if(c[1]<e)return}else c=[(i-u)/a,i];o=[(e-u)/a,e]}else if(h<p){if(c){if(c[0]>=r)return}else c=[n,a*n+u];o=[r,a*r+u]}else{if(c){if(c[0]<n)return}else c=[r,a*r+u];o=[n,a*n+u]}return t[0]=c,t[1]=o,!0}function gb(t,n){var e=t.site,r=n.left,i=n.right;return e===i&&(i=r,r=e),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(e===r?(r=n[1],i=n[0]):(r=n[0],i=n[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function yb(t,n){return n[+(n.left!==t.site)]}function _b(t,n){return n[+(n.left===t.site)]}B_.prototype={areaStart:__,areaEnd:__,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,n){t=+t,n=+n,this._point?this._context.lineTo(t,n):(this._point=1,this._context.moveTo(t,n))}},j_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:H_(this,this._t0,I_(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){var e=NaN;if(n=+n,(t=+t)!==this._x1||n!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,H_(this,I_(this,e=F_(this,t,n)),e);break;default:H_(this,this._t0,e=F_(this,t,n))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n,this._t0=e}}},(X_.prototype=Object.create(j_.prototype)).point=function(t,n){j_.prototype.point.call(this,n,t)},G_.prototype={moveTo:function(t,n){this._context.moveTo(n,t)},closePath:function(){this._context.closePath()},lineTo:function(t,n){this._context.lineTo(n,t)},bezierCurveTo:function(t,n,e,r,i,o){this._context.bezierCurveTo(n,t,r,e,o,i)}},V_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,n=this._y,e=t.length;if(e)if(this._line?this._context.lineTo(t[0],n[0]):this._context.moveTo(t[0],n[0]),2===e)this._context.lineTo(t[1],n[1]);else for(var r=$_(t),i=$_(n),o=0,a=1;a<e;++o,++a)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],t[a],n[a]);(this._line||0!==this._line&&1===e)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,n){this._x.push(+t),this._y.push(+n)}},W_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(t,n);else{var e=this._x*(1-this._t)+t*this._t;this._context.lineTo(e,this._y),this._context.lineTo(e,n)}}this._x=t,this._y=n}},ab.prototype={constructor:ab,insert:function(t,n){var e,r,i;if(t){if(n.P=t,n.N=t.N,t.N&&(t.N.P=n),t.N=n,t.R){for(t=t.R;t.L;)t=t.L;t.L=n}else t.R=n;e=t}else this._?(t=sb(this._),n.P=null,n.N=t,t.P=t.L=n,e=t):(n.P=n.N=null,this._=n,e=null);for(n.L=n.R=null,n.U=e,n.C=!0,t=n;e&&e.C;)e===(r=e.U).L?(i=r.R)&&i.C?(e.C=i.C=!1,r.C=!0,t=r):(t===e.R&&(cb(this,e),e=(t=e).U),e.C=!1,r.C=!0,fb(this,r)):(i=r.L)&&i.C?(e.C=i.C=!1,r.C=!0,t=r):(t===e.L&&(fb(this,e),e=(t=e).U),e.C=!1,r.C=!0,cb(this,r)),e=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var n,e,r,i=t.U,o=t.L,a=t.R;if(e=o?a?sb(a):o:a,i?i.L===t?i.L=e:i.R=e:this._=e,o&&a?(r=e.C,e.C=t.C,e.L=o,o.U=e,e!==a?(i=e.U,e.U=t.U,t=e.R,i.L=t,e.R=a,a.U=e):(e.U=i,i=e,t=e.R)):(r=t.C,t=e),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((n=i.R).C&&(n.C=!1,i.C=!0,cb(this,i),n=i.R),n.L&&n.L.C||n.R&&n.R.C){n.R&&n.R.C||(n.L.C=!1,n.C=!0,fb(this,n),n=i.R),n.C=i.C,i.C=n.R.C=!1,cb(this,i),t=this._;break}}else if((n=i.L).C&&(n.C=!1,i.C=!0,fb(this,i),n=i.L),n.L&&n.L.C||n.R&&n.R.C){n.L&&n.L.C||(n.R.C=!1,n.C=!0,cb(this,n),n=i.L),n.C=i.C,i.C=n.L.C=!1,fb(this,i),t=this._;break}n.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var bb,mb=[];function xb(){ub(this),this.x=this.y=this.arc=this.site=this.cy=null}function wb(t){var n=t.P,e=t.N;if(n&&e){var r=n.site,i=t.site,o=e.site;if(r!==o){var a=i[0],u=i[1],c=r[0]-a,f=r[1]-u,s=o[0]-a,l=o[1]-u,h=2*(c*l-f*s);if(!(h>=-Ub)){var d=c*c+f*f,p=s*s+l*l,v=(l*d-f*p)/h,g=(c*p-s*d)/h,y=mb.pop()||new xb;y.arc=t,y.site=i,y.x=v+a,y.y=(y.cy=g+u)+Math.sqrt(v*v+g*g),t.circle=y;for(var _=null,b=Db._;b;)if(y.y<b.y||y.y===b.y&&y.x<=b.x){if(!b.L){_=b.P;break}b=b.L}else{if(!b.R){_=b;break}b=b.R}Db.insert(_,y),_||(bb=y)}}}}function Mb(t){var n=t.circle;n&&(n.P||(bb=n.N),Db.remove(n),mb.push(n),ub(n),t.circle=null)}var Nb=[];function Ab(){ub(this),this.edge=this.site=this.circle=null}function Tb(t){var n=Nb.pop()||new Ab;return n.site=t,n}function Sb(t){Mb(t),zb.remove(t),Nb.push(t),ub(t)}function kb(t){var n=t.circle,e=n.x,r=n.cy,i=[e,r],o=t.P,a=t.N,u=[t];Sb(t);for(var c=o;c.circle&&Math.abs(e-c.circle.x)<Lb&&Math.abs(r-c.circle.cy)<Lb;)o=c.P,u.unshift(c),Sb(c),c=o;u.unshift(c),Mb(c);for(var f=a;f.circle&&Math.abs(e-f.circle.x)<Lb&&Math.abs(r-f.circle.cy)<Lb;)a=f.N,u.push(f),Sb(f),f=a;u.push(f),Mb(f);var s,l=u.length;for(s=1;s<l;++s)f=u[s],c=u[s-1],db(f.edge,c.site,f.site,i);c=u[0],(f=u[l-1]).edge=lb(c.site,f.site,null,i),wb(c),wb(f)}function Eb(t){for(var n,e,r,i,o=t[0],a=t[1],u=zb._;u;)if((r=Cb(u,a)-o)>Lb)u=u.L;else{if(!((i=o-Pb(u,a))>Lb)){r>-Lb?(n=u.P,e=u):i>-Lb?(n=u,e=u.N):n=e=u;break}if(!u.R){n=u;break}u=u.R}!function(t){Rb[t.index]={site:t,halfedges:[]}}(t);var c=Tb(t);if(zb.insert(n,c),n||e){if(n===e)return Mb(n),e=Tb(n.site),zb.insert(c,e),c.edge=e.edge=lb(n.site,c.site),wb(n),void wb(e);if(e){Mb(n),Mb(e);var f=n.site,s=f[0],l=f[1],h=t[0]-s,d=t[1]-l,p=e.site,v=p[0]-s,g=p[1]-l,y=2*(h*g-d*v),_=h*h+d*d,b=v*v+g*g,m=[(g*_-d*b)/y+s,(h*b-v*_)/y+l];db(e.edge,f,p,m),c.edge=lb(f,t,null,m),e.edge=lb(t,p,null,m),wb(n),wb(e)}else c.edge=lb(n.site,c.site)}}function Cb(t,n){var e=t.site,r=e[0],i=e[1],o=i-n;if(!o)return r;var a=t.P;if(!a)return-1/0;var u=(e=a.site)[0],c=e[1],f=c-n;if(!f)return u;var s=u-r,l=1/o-1/f,h=s/f;return l?(-h+Math.sqrt(h*h-2*l*(s*s/(-2*f)-c+f/2+i-o/2)))/l+r:(r+u)/2}function Pb(t,n){var e=t.N;if(e)return Cb(e,n);var r=t.site;return r[1]===n?r[0]:1/0}var zb,Rb,Db,qb,Lb=1e-6,Ub=1e-12;function Ob(t,n,e){return(t[0]-e[0])*(n[1]-t[1])-(t[0]-n[0])*(e[1]-t[1])}function Bb(t,n){return n[1]-t[1]||n[0]-t[0]}function Yb(t,n){var e,r,i,o=t.sort(Bb).pop();for(qb=[],Rb=new Array(t.length),zb=new ab,Db=new ab;;)if(i=bb,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===e&&o[1]===r||(Eb(o),e=o[0],r=o[1]),o=t.pop();else{if(!i)break;kb(i.arc)}if(function(){for(var t,n,e,r,i=0,o=Rb.length;i<o;++i)if((t=Rb[i])&&(r=(n=t.halfedges).length)){var a=new Array(r),u=new Array(r);for(e=0;e<r;++e)a[e]=e,u[e]=gb(t,qb[n[e]]);for(a.sort(function(t,n){return u[n]-u[t]}),e=0;e<r;++e)u[e]=n[a[e]];for(e=0;e<r;++e)n[e]=u[e]}}(),n){var a=+n[0][0],u=+n[0][1],c=+n[1][0],f=+n[1][1];!function(t,n,e,r){for(var i,o=qb.length;o--;)vb(i=qb[o],t,n,e,r)&&pb(i,t,n,e,r)&&(Math.abs(i[0][0]-i[1][0])>Lb||Math.abs(i[0][1]-i[1][1])>Lb)||delete qb[o]}(a,u,c,f),function(t,n,e,r){var i,o,a,u,c,f,s,l,h,d,p,v,g=Rb.length,y=!0;for(i=0;i<g;++i)if(o=Rb[i]){for(a=o.site,u=(c=o.halfedges).length;u--;)qb[c[u]]||c.splice(u,1);for(u=0,f=c.length;u<f;)p=(d=_b(o,qb[c[u]]))[0],v=d[1],l=(s=yb(o,qb[c[++u%f]]))[0],h=s[1],(Math.abs(p-l)>Lb||Math.abs(v-h)>Lb)&&(c.splice(u,0,qb.push(hb(a,d,Math.abs(p-t)<Lb&&r-v>Lb?[t,Math.abs(l-t)<Lb?h:r]:Math.abs(v-r)<Lb&&e-p>Lb?[Math.abs(h-r)<Lb?l:e,r]:Math.abs(p-e)<Lb&&v-n>Lb?[e,Math.abs(l-e)<Lb?h:n]:Math.abs(v-n)<Lb&&p-t>Lb?[Math.abs(h-n)<Lb?l:t,n]:null))-1),++f);f&&(y=!1)}if(y){var _,b,m,x=1/0;for(i=0,y=null;i<g;++i)(o=Rb[i])&&(m=(_=(a=o.site)[0]-t)*_+(b=a[1]-n)*b)<x&&(x=m,y=o);if(y){var w=[t,n],M=[t,r],N=[e,r],A=[e,n];y.halfedges.push(qb.push(hb(a=y.site,w,M))-1,qb.push(hb(a,M,N))-1,qb.push(hb(a,N,A))-1,qb.push(hb(a,A,w))-1)}}for(i=0;i<g;++i)(o=Rb[i])&&(o.halfedges.length||delete Rb[i])}(a,u,c,f)}this.edges=qb,this.cells=Rb,zb=Db=qb=Rb=null}function Fb(t){return function(){return t}}function Ib(t,n,e){this.target=t,this.type=n,this.transform=e}function Hb(t,n,e){this.k=t,this.x=n,this.y=e}Yb.prototype={constructor:Yb,polygons:function(){var t=this.edges;return this.cells.map(function(n){var e=n.halfedges.map(function(e){return yb(n,t[e])});return e.data=n.site.data,e})},triangles:function(){var t=[],n=this.edges;return this.cells.forEach(function(e,r){if(o=(i=e.halfedges).length)for(var i,o,a,u=e.site,c=-1,f=n[i[o-1]],s=f.left===u?f.right:f.left;++c<o;)a=s,s=(f=n[i[c]]).left===u?f.right:f.left,a&&s&&r<a.index&&r<s.index&&Ob(u,a,s)<0&&t.push([u.data,a.data,s.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,n,e){for(var r,i,o=this,a=o._found||0,u=o.cells.length;!(i=o.cells[a]);)if(++a>=u)return null;var c=t-i.site[0],f=n-i.site[1],s=c*c+f*f;do{i=o.cells[r=a],a=null,i.halfedges.forEach(function(e){var r=o.edges[e],u=r.left;if(u!==i.site&&u||(u=r.right)){var c=t-u[0],f=n-u[1],l=c*c+f*f;l<s&&(s=l,a=u.index)}})}while(null!==a);return o._found=r,null==e||s<=e*e?i.site:null}},Hb.prototype={constructor:Hb,scale:function(t){return 1===t?this:new Hb(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new Hb(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var jb=new Hb(1,0,0);function Xb(t){for(;!t.__zoom;)if(!(t=t.parentNode))return jb;return t.__zoom}function Gb(){t.event.stopImmediatePropagation()}function Vb(){t.event.preventDefault(),t.event.stopImmediatePropagation()}function $b(){return!t.event.ctrlKey&&!t.event.button}function Wb(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Zb(){return this.__zoom||jb}function Qb(){return-t.event.deltaY*(1===t.event.deltaMode?.05:t.event.deltaMode?1:.002)}function Kb(){return navigator.maxTouchPoints||"ontouchstart"in this}function Jb(t,n,e){var r=t.invertX(n[0][0])-e[0][0],i=t.invertX(n[1][0])-e[1][0],o=t.invertY(n[0][1])-e[0][1],a=t.invertY(n[1][1])-e[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}Xb.prototype=Hb.prototype,t.FormatSpecifier=Ra,t.active=function(t,n){var e,r,i=t.__transition;if(i)for(r in n=null==n?null:n+"",i)if((e=i[r]).state>mr&&e.name===n)return new Lr([[t]],gi,n,+r);return null},t.arc=function(){var t=Sy,n=ky,e=py(0),r=null,i=Ey,o=Cy,a=Py,u=null;function c(){var c,f,s=+t.apply(this,arguments),l=+n.apply(this,arguments),h=i.apply(this,arguments)-Ny,d=o.apply(this,arguments)-Ny,p=vy(d-h),v=d>h;if(u||(u=c=to()),l<s&&(f=l,l=s,s=f),l>wy)if(p>Ay-wy)u.moveTo(l*yy(h),l*my(h)),u.arc(0,0,l,h,d,!v),s>wy&&(u.moveTo(s*yy(d),s*my(d)),u.arc(0,0,s,d,h,v));else{var g,y,_=h,b=d,m=h,x=d,w=p,M=p,N=a.apply(this,arguments)/2,A=N>wy&&(r?+r.apply(this,arguments):xy(s*s+l*l)),T=by(vy(l-s)/2,+e.apply(this,arguments)),S=T,k=T;if(A>wy){var E=Ty(A/s*my(N)),C=Ty(A/l*my(N));(w-=2*E)>wy?(m+=E*=v?1:-1,x-=E):(w=0,m=x=(h+d)/2),(M-=2*C)>wy?(_+=C*=v?1:-1,b-=C):(M=0,_=b=(h+d)/2)}var P=l*yy(_),z=l*my(_),R=s*yy(x),D=s*my(x);if(T>wy){var q,L=l*yy(b),U=l*my(b),O=s*yy(m),B=s*my(m);if(p<My&&(q=function(t,n,e,r,i,o,a,u){var c=e-t,f=r-n,s=a-i,l=u-o,h=l*c-s*f;if(!(h*h<wy))return[t+(h=(s*(n-o)-l*(t-i))/h)*c,n+h*f]}(P,z,O,B,L,U,R,D))){var Y=P-q[0],F=z-q[1],I=L-q[0],H=U-q[1],j=1/my(function(t){return t>1?0:t<-1?My:Math.acos(t)}((Y*I+F*H)/(xy(Y*Y+F*F)*xy(I*I+H*H)))/2),X=xy(q[0]*q[0]+q[1]*q[1]);S=by(T,(s-X)/(j-1)),k=by(T,(l-X)/(j+1))}}M>wy?k>wy?(g=zy(O,B,P,z,l,k,v),y=zy(L,U,R,D,l,k,v),u.moveTo(g.cx+g.x01,g.cy+g.y01),k<T?u.arc(g.cx,g.cy,k,gy(g.y01,g.x01),gy(y.y01,y.x01),!v):(u.arc(g.cx,g.cy,k,gy(g.y01,g.x01),gy(g.y11,g.x11),!v),u.arc(0,0,l,gy(g.cy+g.y11,g.cx+g.x11),gy(y.cy+y.y11,y.cx+y.x11),!v),u.arc(y.cx,y.cy,k,gy(y.y11,y.x11),gy(y.y01,y.x01),!v))):(u.moveTo(P,z),u.arc(0,0,l,_,b,!v)):u.moveTo(P,z),s>wy&&w>wy?S>wy?(g=zy(R,D,L,U,s,-S,v),y=zy(P,z,O,B,s,-S,v),u.lineTo(g.cx+g.x01,g.cy+g.y01),S<T?u.arc(g.cx,g.cy,S,gy(g.y01,g.x01),gy(y.y01,y.x01),!v):(u.arc(g.cx,g.cy,S,gy(g.y01,g.x01),gy(g.y11,g.x11),!v),u.arc(0,0,s,gy(g.cy+g.y11,g.cx+g.x11),gy(y.cy+y.y11,y.cx+y.x11),v),u.arc(y.cx,y.cy,S,gy(y.y11,y.x11),gy(y.y01,y.x01),!v))):u.arc(0,0,s,x,m,v):u.lineTo(R,D)}else u.moveTo(0,0);if(u.closePath(),c)return u=null,c+""||null}return c.centroid=function(){var e=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-My/2;return[yy(r)*e,my(r)*e]},c.innerRadius=function(n){return arguments.length?(t="function"==typeof n?n:py(+n),c):t},c.outerRadius=function(t){return arguments.length?(n="function"==typeof t?t:py(+t),c):n},c.cornerRadius=function(t){return arguments.length?(e="function"==typeof t?t:py(+t),c):e},c.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:py(+t),c):r},c.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:py(+t),c):i},c.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:py(+t),c):o},c.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:py(+t),c):a},c.context=function(t){return arguments.length?(u=null==t?null:t,c):u},c},t.area=Oy,t.areaRadial=Gy,t.ascending=n,t.autoType=function(t){for(var n in t){var e,r=t[n].trim();if(r)if("true"===r)r=!0;else if("false"===r)r=!1;else if("NaN"===r)r=NaN;else if(isNaN(e=+r)){if(!/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/.test(r))continue;r=new Date(r)}else r=e;else r=null;t[n]=r}return t},t.axisBottom=function(t){return Y(D,t)},t.axisLeft=function(t){return Y(q,t)},t.axisRight=function(t){return Y(R,t)},t.axisTop=function(t){return Y(z,t)},t.bisect=i,t.bisectLeft=o,t.bisectRight=i,t.bisector=e,t.blob=function(t,n){return fetch(t,n).then(Ko)},t.brush=function(){return Yi(Ei)},t.brushSelection=function(t){var n=t.__brush;return n?n.dim.output(n.selection):null},t.brushX=function(){return Yi(Si)},t.brushY=function(){return Yi(ki)},t.buffer=function(t,n){return fetch(t,n).then(Jo)},t.chord=function(){var t=0,n=null,e=null,r=null;function i(i){var o,a,u,c,f,s,l=i.length,h=[],d=g(l),p=[],v=[],y=v.groups=new Array(l),_=new Array(l*l);for(o=0,f=-1;++f<l;){for(a=0,s=-1;++s<l;)a+=i[f][s];h.push(a),p.push(g(l)),o+=a}for(n&&d.sort(function(t,e){return n(h[t],h[e])}),e&&p.forEach(function(t,n){t.sort(function(t,r){return e(i[n][t],i[n][r])})}),c=(o=Gi(0,Xi-t*l)/o)?t:Xi/l,a=0,f=-1;++f<l;){for(u=a,s=-1;++s<l;){var b=d[f],m=p[b][s],x=i[b][m],w=a,M=a+=x*o;_[m*l+b]={index:b,subindex:m,startAngle:w,endAngle:M,value:x}}y[b]={index:b,startAngle:u,endAngle:a,value:h[b]},a+=c}for(f=-1;++f<l;)for(s=f-1;++s<l;){var N=_[s*l+f],A=_[f*l+s];(N.value||A.value)&&v.push(N.value<A.value?{source:A,target:N}:{source:N,target:A})}return r?v.sort(r):v}return i.padAngle=function(n){return arguments.length?(t=Gi(0,n),i):t},i.sortGroups=function(t){return arguments.length?(n=t,i):n},i.sortSubgroups=function(t){return arguments.length?(e=t,i):e},i.sortChords=function(t){return arguments.length?(null==t?r=null:(r=Vi(t))._=t,i):r&&r._},i},t.clientPoint=Ot,t.cluster=function(){var t=bl,n=1,e=1,r=!1;function i(i){var o,a=0;i.eachAfter(function(n){var e=n.children;e?(n.x=function(t){return t.reduce(ml,0)/t.length}(e),n.y=function(t){return 1+t.reduce(xl,0)}(e)):(n.x=o?a+=t(n,o):0,n.y=0,o=n)});var u=function(t){for(var n;n=t.children;)t=n[0];return t}(i),c=function(t){for(var n;n=t.children;)t=n[n.length-1];return t}(i),f=u.x-t(u,c)/2,s=c.x+t(c,u)/2;return i.eachAfter(r?function(t){t.x=(t.x-i.x)*n,t.y=(i.y-t.y)*e}:function(t){t.x=(t.x-f)/(s-f)*n,t.y=(1-(i.y?t.y/i.y:1))*e})}return i.separation=function(n){return arguments.length?(t=n,i):t},i.size=function(t){return arguments.length?(r=!1,n=+t[0],e=+t[1],i):r?null:[n,e]},i.nodeSize=function(t){return arguments.length?(r=!0,n=+t[0],e=+t[1],i):r?[n,e]:null},i},t.color=vn,t.contourDensity=function(){var t=So,n=ko,e=Eo,r=960,i=500,o=20,a=2,u=3*o,c=r+2*u>>a,f=i+2*u>>a,s=_o(20);function l(r){var i=new Float32Array(c*f),l=new Float32Array(c*f);r.forEach(function(r,o,s){var l=+t(r,o,s)+u>>a,h=+n(r,o,s)+u>>a,d=+e(r,o,s);l>=0&&l<c&&h>=0&&h<f&&(i[l+h*c]+=d)}),Ao({width:c,height:f,data:i},{width:c,height:f,data:l},o>>a),To({width:c,height:f,data:l},{width:c,height:f,data:i},o>>a),Ao({width:c,height:f,data:i},{width:c,height:f,data:l},o>>a),To({width:c,height:f,data:l},{width:c,height:f,data:i},o>>a),Ao({width:c,height:f,data:i},{width:c,height:f,data:l},o>>a),To({width:c,height:f,data:l},{width:c,height:f,data:i},o>>a);var d=s(i);if(!Array.isArray(d)){var p=A(i);d=w(0,p,d),(d=g(0,Math.floor(p/d)*d,d)).shift()}return No().thresholds(d).size([c,f])(i).map(h)}function h(t){return t.value*=Math.pow(2,-2*a),t.coordinates.forEach(d),t}function d(t){t.forEach(p)}function p(t){t.forEach(v)}function v(t){t[0]=t[0]*Math.pow(2,a)-u,t[1]=t[1]*Math.pow(2,a)-u}function y(){return c=r+2*(u=3*o)>>a,f=i+2*u>>a,l}return l.x=function(n){return arguments.length?(t="function"==typeof n?n:_o(+n),l):t},l.y=function(t){return arguments.length?(n="function"==typeof t?t:_o(+t),l):n},l.weight=function(t){return arguments.length?(e="function"==typeof t?t:_o(+t),l):e},l.size=function(t){if(!arguments.length)return[r,i];var n=Math.ceil(t[0]),e=Math.ceil(t[1]);if(!(n>=0||n>=0))throw new Error("invalid size");return r=n,i=e,y()},l.cellSize=function(t){if(!arguments.length)return 1<<a;if(!((t=+t)>=1))throw new Error("invalid cell size");return a=Math.floor(Math.log(t)/Math.LN2),y()},l.thresholds=function(t){return arguments.length?(s="function"==typeof t?t:Array.isArray(t)?_o(go.call(t)):_o(t),l):s},l.bandwidth=function(t){if(!arguments.length)return Math.sqrt(o*(o+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return o=Math.round((Math.sqrt(4*t*t+1)-1)/2),y()},l},t.contours=No,t.create=function(t){return Rt(Z(t).call(document.documentElement))},t.creator=Z,t.cross=function(t,n,e){var r,i,o,u,c=t.length,f=n.length,s=new Array(c*f);for(null==e&&(e=a),r=o=0;r<c;++r)for(u=t[r],i=0;i<f;++i,++o)s[o]=e(u,n[i]);return s},t.csv=ra,t.csvFormat=Ho,t.csvFormatBody=jo,t.csvFormatRows=Xo,t.csvParse=Fo,t.csvParseRows=Io,t.cubehelix=re,t.curveBasis=function(t){return new m_(t)},t.curveBasisClosed=function(t){return new x_(t)},t.curveBasisOpen=function(t){return new w_(t)},t.curveBundle=N_,t.curveCardinal=S_,t.curveCardinalClosed=E_,t.curveCardinalOpen=P_,t.curveCatmullRom=D_,t.curveCatmullRomClosed=L_,t.curveCatmullRomOpen=O_,t.curveLinear=Dy,t.curveLinearClosed=function(t){return new B_(t)},t.curveMonotoneX=function(t){return new j_(t)},t.curveMonotoneY=function(t){return new X_(t)},t.curveNatural=function(t){return new V_(t)},t.curveStep=function(t){return new W_(t,.5)},t.curveStepAfter=function(t){return new W_(t,1)},t.curveStepBefore=function(t){return new W_(t,0)},t.customEvent=kt,t.descending=function(t,n){return n<t?-1:n>t?1:n>=t?0:NaN},t.deviation=f,t.dispatch=I,t.drag=function(){var n,e,r,i,o=Vt,a=$t,u=Wt,c=Zt,f={},s=I("start","drag","end"),l=0,h=0;function d(t){t.on("mousedown.drag",p).filter(c).on("touchstart.drag",y).on("touchmove.drag",_).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(){if(!i&&o.apply(this,arguments)){var u=m("mouse",a.apply(this,arguments),Bt,this,arguments);u&&(Rt(t.event.view).on("mousemove.drag",v,!0).on("mouseup.drag",g,!0),Ht(t.event.view),Ft(),r=!1,n=t.event.clientX,e=t.event.clientY,u("start"))}}function v(){if(It(),!r){var i=t.event.clientX-n,o=t.event.clientY-e;r=i*i+o*o>h}f.mouse("drag")}function g(){Rt(t.event.view).on("mousemove.drag mouseup.drag",null),jt(t.event.view,r),It(),f.mouse("end")}function y(){if(o.apply(this,arguments)){var n,e,r=t.event.changedTouches,i=a.apply(this,arguments),u=r.length;for(n=0;n<u;++n)(e=m(r[n].identifier,i,Yt,this,arguments))&&(Ft(),e("start"))}}function _(){var n,e,r=t.event.changedTouches,i=r.length;for(n=0;n<i;++n)(e=f[r[n].identifier])&&(It(),e("drag"))}function b(){var n,e,r=t.event.changedTouches,o=r.length;for(i&&clearTimeout(i),i=setTimeout(function(){i=null},500),n=0;n<o;++n)(e=f[r[n].identifier])&&(Ft(),e("end"))}function m(n,e,r,i,o){var a,c,h,p=r(e,n),v=s.copy();if(kt(new Gt(d,"beforestart",a,n,l,p[0],p[1],0,0,v),function(){return null!=(t.event.subject=a=u.apply(i,o))&&(c=a.x-p[0]||0,h=a.y-p[1]||0,!0)}))return function t(u){var s,g=p;switch(u){case"start":f[n]=t,s=l++;break;case"end":delete f[n],--l;case"drag":p=r(e,n),s=l}kt(new Gt(d,u,a,n,s,p[0]+c,p[1]+h,p[0]-g[0],p[1]-g[1],v),v.apply,v,[u,i,o])}}return d.filter=function(t){return arguments.length?(o="function"==typeof t?t:Xt(!!t),d):o},d.container=function(t){return arguments.length?(a="function"==typeof t?t:Xt(t),d):a},d.subject=function(t){return arguments.length?(u="function"==typeof t?t:Xt(t),d):u},d.touchable=function(t){return arguments.length?(c="function"==typeof t?t:Xt(!!t),d):c},d.on=function(){var t=s.on.apply(s,arguments);return t===s?d:t},d.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,d):Math.sqrt(h)},d},t.dragDisable=Ht,t.dragEnable=jt,t.dsv=function(t,n,e,r){3===arguments.length&&"function"==typeof e&&(r=e,e=void 0);var i=Bo(t);return na(n,e).then(function(t){return i.parse(t,r)})},t.dsvFormat=Bo,t.easeBack=fi,t.easeBackIn=ui,t.easeBackInOut=fi,t.easeBackOut=ci,t.easeBounce=ai,t.easeBounceIn=function(t){return 1-ai(1-t)},t.easeBounceInOut=function(t){return((t*=2)<=1?1-ai(1-t):ai(t-1)+1)/2},t.easeBounceOut=ai,t.easeCircle=Wr,t.easeCircleIn=function(t){return 1-Math.sqrt(1-t*t)},t.easeCircleInOut=Wr,t.easeCircleOut=function(t){return Math.sqrt(1- --t*t)},t.easeCubic=Fr,t.easeCubicIn=function(t){return t*t*t},t.easeCubicInOut=Fr,t.easeCubicOut=function(t){return--t*t*t+1},t.easeElastic=hi,t.easeElasticIn=li,t.easeElasticInOut=di,t.easeElasticOut=hi,t.easeExp=$r,t.easeExpIn=function(t){return Math.pow(2,10*t-10)},t.easeExpInOut=$r,t.easeExpOut=function(t){return 1-Math.pow(2,-10*t)},t.easeLinear=function(t){return+t},t.easePoly=jr,t.easePolyIn=Ir,t.easePolyInOut=jr,t.easePolyOut=Hr,t.easeQuad=Yr,t.easeQuadIn=function(t){return t*t},t.easeQuadInOut=Yr,t.easeQuadOut=function(t){return t*(2-t)},t.easeSin=Vr,t.easeSinIn=function(t){return 1-Math.cos(t*Gr)},t.easeSinInOut=Vr,t.easeSinOut=function(t){return Math.sin(t*Gr)},t.entries=function(t){var n=[];for(var e in t)n.push({key:e,value:t[e]});return n},t.extent=s,t.forceCenter=function(t,n){var e;function r(){var r,i,o=e.length,a=0,u=0;for(r=0;r<o;++r)a+=(i=e[r]).x,u+=i.y;for(a=a/o-t,u=u/o-n,r=0;r<o;++r)(i=e[r]).x-=a,i.y-=u}return null==t&&(t=0),null==n&&(n=0),r.initialize=function(t){e=t},r.x=function(n){return arguments.length?(t=+n,r):t},r.y=function(t){return arguments.length?(n=+t,r):n},r},t.forceCollide=function(t){var n,e,r=1,i=1;function o(){for(var t,o,u,c,f,s,l,h=n.length,d=0;d<i;++d)for(o=ga(n,ma,xa).visitAfter(a),t=0;t<h;++t)u=n[t],s=e[u.index],l=s*s,c=u.x+u.vx,f=u.y+u.vy,o.visit(p);function p(t,n,e,i,o){var a=t.data,h=t.r,d=s+h;if(!a)return n>c+d||i<c-d||e>f+d||o<f-d;if(a.index>u.index){var p=c-a.x-a.vx,v=f-a.y-a.vy,g=p*p+v*v;g<d*d&&(0===p&&(g+=(p=la())*p),0===v&&(g+=(v=la())*v),g=(d-(g=Math.sqrt(g)))/g*r,u.vx+=(p*=g)*(d=(h*=h)/(l+h)),u.vy+=(v*=g)*d,a.vx-=p*(d=1-d),a.vy-=v*d)}}}function a(t){if(t.data)return t.r=e[t.data.index];for(var n=t.r=0;n<4;++n)t[n]&&t[n].r>t.r&&(t.r=t[n].r)}function u(){if(n){var r,i,o=n.length;for(e=new Array(o),r=0;r<o;++r)i=n[r],e[i.index]=+t(i,r,n)}}return"function"!=typeof t&&(t=sa(null==t?1:+t)),o.initialize=function(t){n=t,u()},o.iterations=function(t){return arguments.length?(i=+t,o):i},o.strength=function(t){return arguments.length?(r=+t,o):r},o.radius=function(n){return arguments.length?(t="function"==typeof n?n:sa(+n),u(),o):t},o},t.forceLink=function(t){var n,e,r,i,o,a=wa,u=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},c=sa(30),f=1;function s(r){for(var i=0,a=t.length;i<f;++i)for(var u,c,s,l,h,d,p,v=0;v<a;++v)c=(u=t[v]).source,l=(s=u.target).x+s.vx-c.x-c.vx||la(),h=s.y+s.vy-c.y-c.vy||la(),l*=d=((d=Math.sqrt(l*l+h*h))-e[v])/d*r*n[v],h*=d,s.vx-=l*(p=o[v]),s.vy-=h*p,c.vx+=l*(p=1-p),c.vy+=h*p}function l(){if(r){var u,c,f=r.length,s=t.length,l=uo(r,a);for(u=0,i=new Array(f);u<s;++u)(c=t[u]).index=u,"object"!=typeof c.source&&(c.source=Ma(l,c.source)),"object"!=typeof c.target&&(c.target=Ma(l,c.target)),i[c.source.index]=(i[c.source.index]||0)+1,i[c.target.index]=(i[c.target.index]||0)+1;for(u=0,o=new Array(s);u<s;++u)c=t[u],o[u]=i[c.source.index]/(i[c.source.index]+i[c.target.index]);n=new Array(s),h(),e=new Array(s),d()}}function h(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+u(t[e],e,t)}function d(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+c(t[n],n,t)}return null==t&&(t=[]),s.initialize=function(t){r=t,l()},s.links=function(n){return arguments.length?(t=n,l(),s):t},s.id=function(t){return arguments.length?(a=t,s):a},s.iterations=function(t){return arguments.length?(f=+t,s):f},s.strength=function(t){return arguments.length?(u="function"==typeof t?t:sa(+t),h(),s):u},s.distance=function(t){return arguments.length?(c="function"==typeof t?t:sa(+t),d(),s):c},s},t.forceManyBody=function(){var t,n,e,r,i=sa(-30),o=1,a=1/0,u=.81;function c(r){var i,o=t.length,a=ga(t,Na,Aa).visitAfter(s);for(e=r,i=0;i<o;++i)n=t[i],a.visit(l)}function f(){if(t){var n,e,o=t.length;for(r=new Array(o),n=0;n<o;++n)e=t[n],r[e.index]=+i(e,n,t)}}function s(t){var n,e,i,o,a,u=0,c=0;if(t.length){for(i=o=a=0;a<4;++a)(n=t[a])&&(e=Math.abs(n.value))&&(u+=n.value,c+=e,i+=e*n.x,o+=e*n.y);t.x=i/c,t.y=o/c}else{(n=t).x=n.data.x,n.y=n.data.y;do{u+=r[n.data.index]}while(n=n.next)}t.value=u}function l(t,i,c,f){if(!t.value)return!0;var s=t.x-n.x,l=t.y-n.y,h=f-i,d=s*s+l*l;if(h*h/u<d)return d<a&&(0===s&&(d+=(s=la())*s),0===l&&(d+=(l=la())*l),d<o&&(d=Math.sqrt(o*d)),n.vx+=s*t.value*e/d,n.vy+=l*t.value*e/d),!0;if(!(t.length||d>=a)){(t.data!==n||t.next)&&(0===s&&(d+=(s=la())*s),0===l&&(d+=(l=la())*l),d<o&&(d=Math.sqrt(o*d)));do{t.data!==n&&(h=r[t.data.index]*e/d,n.vx+=s*h,n.vy+=l*h)}while(t=t.next)}}return c.initialize=function(n){t=n,f()},c.strength=function(t){return arguments.length?(i="function"==typeof t?t:sa(+t),f(),c):i},c.distanceMin=function(t){return arguments.length?(o=t*t,c):Math.sqrt(o)},c.distanceMax=function(t){return arguments.length?(a=t*t,c):Math.sqrt(a)},c.theta=function(t){return arguments.length?(u=t*t,c):Math.sqrt(u)},c},t.forceRadial=function(t,n,e){var r,i,o,a=sa(.1);function u(t){for(var a=0,u=r.length;a<u;++a){var c=r[a],f=c.x-n||1e-6,s=c.y-e||1e-6,l=Math.sqrt(f*f+s*s),h=(o[a]-l)*i[a]*t/l;c.vx+=f*h,c.vy+=s*h}}function c(){if(r){var n,e=r.length;for(i=new Array(e),o=new Array(e),n=0;n<e;++n)o[n]=+t(r[n],n,r),i[n]=isNaN(o[n])?0:+a(r[n],n,r)}}return"function"!=typeof t&&(t=sa(+t)),null==n&&(n=0),null==e&&(e=0),u.initialize=function(t){r=t,c()},u.strength=function(t){return arguments.length?(a="function"==typeof t?t:sa(+t),c(),u):a},u.radius=function(n){return arguments.length?(t="function"==typeof n?n:sa(+n),c(),u):t},u.x=function(t){return arguments.length?(n=+t,u):n},u.y=function(t){return arguments.length?(e=+t,u):e},u},t.forceSimulation=function(t){var n,e=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,u=uo(),c=lr(s),f=I("tick","end");function s(){l(),f.call("tick",n),e<r&&(c.stop(),f.call("end",n))}function l(r){var c,f,s=t.length;void 0===r&&(r=1);for(var l=0;l<r;++l)for(e+=(o-e)*i,u.each(function(t){t(e)}),c=0;c<s;++c)null==(f=t[c]).fx?f.x+=f.vx*=a:(f.x=f.fx,f.vx=0),null==f.fy?f.y+=f.vy*=a:(f.y=f.fy,f.vy=0);return n}function h(){for(var n,e=0,r=t.length;e<r;++e){if((n=t[e]).index=e,null!=n.fx&&(n.x=n.fx),null!=n.fy&&(n.y=n.fy),isNaN(n.x)||isNaN(n.y)){var i=Ta*Math.sqrt(e),o=e*Sa;n.x=i*Math.cos(o),n.y=i*Math.sin(o)}(isNaN(n.vx)||isNaN(n.vy))&&(n.vx=n.vy=0)}}function d(n){return n.initialize&&n.initialize(t),n}return null==t&&(t=[]),h(),n={tick:l,restart:function(){return c.restart(s),n},stop:function(){return c.stop(),n},nodes:function(e){return arguments.length?(t=e,h(),u.each(d),n):t},alpha:function(t){return arguments.length?(e=+t,n):e},alphaMin:function(t){return arguments.length?(r=+t,n):r},alphaDecay:function(t){return arguments.length?(i=+t,n):+i},alphaTarget:function(t){return arguments.length?(o=+t,n):o},velocityDecay:function(t){return arguments.length?(a=1-t,n):1-a},force:function(t,e){return arguments.length>1?(null==e?u.remove(t):u.set(t,d(e)),n):u.get(t)},find:function(n,e,r){var i,o,a,u,c,f=0,s=t.length;for(null==r?r=1/0:r*=r,f=0;f<s;++f)(a=(i=n-(u=t[f]).x)*i+(o=e-u.y)*o)<r&&(c=u,r=a);return c},on:function(t,e){return arguments.length>1?(f.on(t,e),n):f.on(t)}}},t.forceX=function(t){var n,e,r,i=sa(.1);function o(t){for(var i,o=0,a=n.length;o<a;++o)(i=n[o]).vx+=(r[o]-i.x)*e[o]*t}function a(){if(n){var o,a=n.length;for(e=new Array(a),r=new Array(a),o=0;o<a;++o)e[o]=isNaN(r[o]=+t(n[o],o,n))?0:+i(n[o],o,n)}}return"function"!=typeof t&&(t=sa(null==t?0:+t)),o.initialize=function(t){n=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:sa(+t),a(),o):i},o.x=function(n){return arguments.length?(t="function"==typeof n?n:sa(+n),a(),o):t},o},t.forceY=function(t){var n,e,r,i=sa(.1);function o(t){for(var i,o=0,a=n.length;o<a;++o)(i=n[o]).vy+=(r[o]-i.y)*e[o]*t}function a(){if(n){var o,a=n.length;for(e=new Array(a),r=new Array(a),o=0;o<a;++o)e[o]=isNaN(r[o]=+t(n[o],o,n))?0:+i(n[o],o,n)}}return"function"!=typeof t&&(t=sa(null==t?0:+t)),o.initialize=function(t){n=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:sa(+t),a(),o):i},o.y=function(n){return arguments.length?(t="function"==typeof n?n:sa(+n),a(),o):t},o},t.formatDefaultLocale=Fa,t.formatLocale=Ya,t.formatSpecifier=za,t.geoAlbers=Zs,t.geoAlbersUsa=function(){var t,n,e,r,i,o,a=Zs(),u=Ws().rotate([154,0]).center([-2,58.5]).parallels([55,65]),c=Ws().rotate([157,0]).center([-3,19.9]).parallels([8,18]),f={point:function(t,n){o=[t,n]}};function s(t){var n=t[0],a=t[1];return o=null,e.point(n,a),o||(r.point(n,a),o)||(i.point(n,a),o)}function l(){return t=n=null,s}return s.invert=function(t){var n=a.scale(),e=a.translate(),r=(t[0]-e[0])/n,i=(t[1]-e[1])/n;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?u:i>=.166&&i<.234&&r>=-.214&&r<-.115?c:a).invert(t)},s.stream=function(e){return t&&n===e?t:(r=[a.stream(n=e),u.stream(e),c.stream(e)],i=r.length,t={point:function(t,n){for(var e=-1;++e<i;)r[e].point(t,n)},sphere:function(){for(var t=-1;++t<i;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<i;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<i;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<i;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<i;)r[t].polygonEnd()}});var r,i},s.precision=function(t){return arguments.length?(a.precision(t),u.precision(t),c.precision(t),l()):a.precision()},s.scale=function(t){return arguments.length?(a.scale(t),u.scale(.35*t),c.scale(t),s.translate(a.translate())):a.scale()},s.translate=function(t){if(!arguments.length)return a.translate();var n=a.scale(),o=+t[0],s=+t[1];return e=a.translate(t).clipExtent([[o-.455*n,s-.238*n],[o+.455*n,s+.238*n]]).stream(f),r=u.translate([o-.307*n,s+.201*n]).clipExtent([[o-.425*n+Wa,s+.12*n+Wa],[o-.214*n-Wa,s+.234*n-Wa]]).stream(f),i=c.translate([o-.205*n,s+.212*n]).clipExtent([[o-.214*n+Wa,s+.166*n+Wa],[o-.115*n-Wa,s+.234*n-Wa]]).stream(f),l()},s.fitExtent=function(t,n){return Ls(s,t,n)},s.fitSize=function(t,n){return Us(s,t,n)},s.fitWidth=function(t,n){return Os(s,t,n)},s.fitHeight=function(t,n){return Bs(s,t,n)},s.scale(1070)},t.geoArea=function(t){return Pu.reset(),Nu(t,zu),2*Pu},t.geoAzimuthalEqualArea=function(){return Xs(Js).scale(124.75).clipAngle(179.999)},t.geoAzimuthalEqualAreaRaw=Js,t.geoAzimuthalEquidistant=function(){return Xs(tl).scale(79.4188).clipAngle(179.999)},t.geoAzimuthalEquidistantRaw=tl,t.geoBounds=function(t){var n,e,r,i,o,a,u;if(Vu=Gu=-(ju=Xu=1/0),Ku=[],Nu(t,yc),e=Ku.length){for(Ku.sort(Tc),n=1,o=[r=Ku[0]];n<e;++n)Sc(r,(i=Ku[n])[0])||Sc(r,i[1])?(Ac(r[0],i[1])>Ac(r[0],r[1])&&(r[1]=i[1]),Ac(i[0],r[1])>Ac(r[0],r[1])&&(r[0]=i[0])):o.push(r=i);for(a=-1/0,n=0,r=o[e=o.length-1];n<=e;r=i,++n)i=o[n],(u=Ac(r[1],i[0]))>a&&(a=u,ju=i[0],Gu=r[1])}return Ku=Ju=null,ju===1/0||Xu===1/0?[[NaN,NaN],[NaN,NaN]]:[[ju,Xu],[Gu,Vu]]},t.geoCentroid=function(t){tc=nc=ec=rc=ic=oc=ac=uc=cc=fc=sc=0,Nu(t,kc);var n=cc,e=fc,r=sc,i=n*n+e*e+r*r;return i<Za&&(n=oc,e=ac,r=uc,nc<Wa&&(n=ec,e=rc,r=ic),(i=n*n+e*e+r*r)<Za)?[NaN,NaN]:[ou(e,n)*nu,gu(r/du(i))*nu]},t.geoCircle=function(){var t,n,e=Bc([0,0]),r=Bc(90),i=Bc(6),o={point:function(e,r){t.push(e=n(e,r)),e[0]*=nu,e[1]*=nu}};function a(){var a=e.apply(this,arguments),u=r.apply(this,arguments)*eu,c=i.apply(this,arguments)*eu;return t=[],n=Ic(-a[0]*eu,-a[1]*eu,0).invert,Vc(o,u,c,1),a={type:"Polygon",coordinates:[t]},t=n=null,a}return a.center=function(t){return arguments.length?(e="function"==typeof t?t:Bc([+t[0],+t[1]]),a):e},a.radius=function(t){return arguments.length?(r="function"==typeof t?t:Bc(+t),a):r},a.precision=function(t){return arguments.length?(i="function"==typeof t?t:Bc(+t),a):i},a},t.geoClipAntimeridian=uf,t.geoClipCircle=cf,t.geoClipExtent=function(){var t,n,e,r=0,i=0,o=960,a=500;return e={stream:function(e){return t&&n===e?t:t=lf(r,i,o,a)(n=e)},extent:function(u){return arguments.length?(r=+u[0][0],i=+u[0][1],o=+u[1][0],a=+u[1][1],t=n=null,e):[[r,i],[o,a]]}}},t.geoClipRectangle=lf,t.geoConicConformal=function(){return Vs(il).scale(109.5).parallels([30,30])},t.geoConicConformalRaw=il,t.geoConicEqualArea=Ws,t.geoConicEqualAreaRaw=$s,t.geoConicEquidistant=function(){return Vs(al).scale(131.154).center([0,13.9389])},t.geoConicEquidistantRaw=al,t.geoContains=function(t,n){return(t&&Nf.hasOwnProperty(t.type)?Nf[t.type]:Tf)(t,n)},t.geoDistance=Mf,t.geoEqualEarth=function(){return Xs(hl).scale(177.158)},t.geoEqualEarthRaw=hl,t.geoEquirectangular=function(){return Xs(ol).scale(152.63)},t.geoEquirectangularRaw=ol,t.geoGnomonic=function(){return Xs(dl).scale(144.049).clipAngle(60)},t.geoGnomonicRaw=dl,t.geoGraticule=Df,t.geoGraticule10=function(){return Df()()},t.geoIdentity=function(){var t,n,e,r,i,o,a=1,u=0,c=0,f=1,s=1,l=qf,h=null,d=qf;function p(){return r=i=null,o}return o={stream:function(t){return r&&i===t?r:r=l(d(i=t))},postclip:function(r){return arguments.length?(d=r,h=t=n=e=null,p()):d},clipExtent:function(r){return arguments.length?(d=null==r?(h=t=n=e=null,qf):lf(h=+r[0][0],t=+r[0][1],n=+r[1][0],e=+r[1][1]),p()):null==h?null:[[h,t],[n,e]]},scale:function(t){return arguments.length?(l=pl((a=+t)*f,a*s,u,c),p()):a},translate:function(t){return arguments.length?(l=pl(a*f,a*s,u=+t[0],c=+t[1]),p()):[u,c]},reflectX:function(t){return arguments.length?(l=pl(a*(f=t?-1:1),a*s,u,c),p()):f<0},reflectY:function(t){return arguments.length?(l=pl(a*f,a*(s=t?-1:1),u,c),p()):s<0},fitExtent:function(t,n){return Ls(o,t,n)},fitSize:function(t,n){return Us(o,t,n)},fitWidth:function(t,n){return Os(o,t,n)},fitHeight:function(t,n){return Bs(o,t,n)}}},t.geoInterpolate=function(t,n){var e=t[0]*eu,r=t[1]*eu,i=n[0]*eu,o=n[1]*eu,a=au(r),u=lu(r),c=au(o),f=lu(o),s=a*au(e),l=a*lu(e),h=c*au(i),d=c*lu(i),p=2*gu(du(yu(o-r)+a*c*yu(i-e))),v=lu(p),g=p?function(t){var n=lu(t*=p)/v,e=lu(p-t)/v,r=e*s+n*h,i=e*l+n*d,o=e*u+n*f;return[ou(i,r)*nu,ou(o,du(r*r+i*i))*nu]}:function(){return[e*nu,r*nu]};return g.distance=p,g},t.geoLength=mf,t.geoMercator=function(){return el(nl).scale(961/tu)},t.geoMercatorRaw=nl,t.geoNaturalEarth1=function(){return Xs(vl).scale(175.295)},t.geoNaturalEarth1Raw=vl,t.geoOrthographic=function(){return Xs(gl).scale(249.5).clipAngle(90+Wa)},t.geoOrthographicRaw=gl,t.geoPath=function(t,n){var e,r,i=4.5;function o(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),Nu(t,e(r))),r.result()}return o.area=function(t){return Nu(t,e(If)),If.result()},o.measure=function(t){return Nu(t,e(ks)),ks.result()},o.bounds=function(t){return Nu(t,e(Qf)),Qf.result()},o.centroid=function(t){return Nu(t,e(ls)),ls.result()},o.projection=function(n){return arguments.length?(e=null==n?(t=null,qf):(t=n).stream,o):t},o.context=function(t){return arguments.length?(r=null==t?(n=null,new Ps):new xs(n=t),"function"!=typeof i&&r.pointRadius(i),o):n},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),o):i},o.projection(t).context(n)},t.geoProjection=Xs,t.geoProjectionMutator=Gs,t.geoRotation=Gc,t.geoStereographic=function(){return Xs(yl).scale(250).clipAngle(142)},t.geoStereographicRaw=yl,t.geoStream=Nu,t.geoTransform=function(t){return{stream:Rs(t)}},t.geoTransverseMercator=function(){var t=el(_l),n=t.center,e=t.rotate;return t.center=function(t){return arguments.length?n([-t[1],t[0]]):[(t=n())[1],-t[0]]},t.rotate=function(t){return arguments.length?e([t[0],t[1],t.length>2?t[2]+90:90]):[(t=e())[0],t[1],t[2]-90]},e([0,0,90]).scale(159.155)},t.geoTransverseMercatorRaw=_l,t.gray=function(t,n){return new Yn(t,0,0,null==n?1:n)},t.hcl=Gn,t.hierarchy=Ml,t.histogram=function(){var t=v,n=s,e=M;function r(r){var o,a,u=r.length,c=new Array(u);for(o=0;o<u;++o)c[o]=t(r[o],o,r);var f=n(c),s=f[0],l=f[1],h=e(c,s,l);Array.isArray(h)||(h=w(s,l,h),h=g(Math.ceil(s/h)*h,l,h));for(var d=h.length;h[0]<=s;)h.shift(),--d;for(;h[d-1]>l;)h.pop(),--d;var p,v=new Array(d+1);for(o=0;o<=d;++o)(p=v[o]=[]).x0=o>0?h[o-1]:s,p.x1=o<d?h[o]:l;for(o=0;o<u;++o)s<=(a=c[o])&&a<=l&&v[i(h,a,0,d)].push(r[o]);return v}return r.value=function(n){return arguments.length?(t="function"==typeof n?n:p(n),r):t},r.domain=function(t){return arguments.length?(n="function"==typeof t?t:p([t[0],t[1]]),r):n},r.thresholds=function(t){return arguments.length?(e="function"==typeof t?t:Array.isArray(t)?p(h.call(t)):p(t),r):e},r},t.hsl=Tn,t.html=ca,t.image=function(t,n){return new Promise(function(e,r){var i=new Image;for(var o in n)i[o]=n[o];i.onerror=r,i.onload=function(){e(i)},i.src=t})},t.interpolate=Ne,t.interpolateArray=ye,t.interpolateBasis=ae,t.interpolateBasisClosed=ue,t.interpolateBlues=Xg,t.interpolateBrBG=rg,t.interpolateBuGn=xg,t.interpolateBuPu=Mg,t.interpolateCividis=function(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-2710.57*t)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-67.37*t)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-2475.67*t)))))))+")"},t.interpolateCool=iy,t.interpolateCubehelix=We,t.interpolateCubehelixDefault=ey,t.interpolateCubehelixLong=Ze,t.interpolateDate=_e,t.interpolateDiscrete=function(t){var n=t.length;return function(e){return t[Math.max(0,Math.min(n-1,Math.floor(e*n)))]}},t.interpolateGnBu=Ag,t.interpolateGreens=Vg,t.interpolateGreys=Wg,t.interpolateHcl=Ge,t.interpolateHclLong=Ve,t.interpolateHsl=He,t.interpolateHslLong=je,t.interpolateHue=function(t,n){var e=se(+t,+n);return function(t){var n=e(t);return n-360*Math.floor(n/360)}},t.interpolateInferno=hy,t.interpolateLab=function(t,n){var e=he((t=Bn(t)).l,(n=Bn(n)).l),r=he(t.a,n.a),i=he(t.b,n.b),o=he(t.opacity,n.opacity);return function(n){return t.l=e(n),t.a=r(n),t.b=i(n),t.opacity=o(n),t+""}},t.interpolateMagma=ly,t.interpolateNumber=be,t.interpolateObject=me,t.interpolateOrRd=Sg,t.interpolateOranges=ny,t.interpolatePRGn=og,t.interpolatePiYG=ug,t.interpolatePlasma=dy,t.interpolatePuBu=Pg,t.interpolatePuBuGn=Eg,t.interpolatePuOr=fg,t.interpolatePuRd=Rg,t.interpolatePurples=Qg,t.interpolateRainbow=function(t){(t<0||t>1)&&(t-=Math.floor(t));var n=Math.abs(t-.5);return oy.h=360*t-100,oy.s=1.5-1.5*n,oy.l=.8-.9*n,oy+""},t.interpolateRdBu=lg,t.interpolateRdGy=dg,t.interpolateRdPu=qg,t.interpolateRdYlBu=vg,t.interpolateRdYlGn=yg,t.interpolateReds=Jg,t.interpolateRgb=de,t.interpolateRgbBasis=ve,t.interpolateRgbBasisClosed=ge,t.interpolateRound=Ae,t.interpolateSinebow=function(t){var n;return t=(.5-t)*Math.PI,ay.r=255*(n=Math.sin(t))*n,ay.g=255*(n=Math.sin(t+uy))*n,ay.b=255*(n=Math.sin(t+cy))*n,ay+""},t.interpolateSpectral=bg,t.interpolateString=Me,t.interpolateTransformCss=De,t.interpolateTransformSvg=qe,t.interpolateTurbo=function(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-14825.05*t)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+707.56*t)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-6838.66*t)))))))+")"},t.interpolateViridis=sy,t.interpolateWarm=ry,t.interpolateYlGn=Bg,t.interpolateYlGnBu=Ug,t.interpolateYlOrBr=Fg,t.interpolateYlOrRd=Hg,t.interpolateZoom=Fe,t.interrupt=Cr,t.interval=function(t,n,e){var r=new sr,i=n;return null==n?(r.restart(t,n,e),r):(n=+n,e=null==e?cr():+e,r.restart(function o(a){a+=i,r.restart(o,i+=n,e),t(a)},n,e),r)},t.isoFormat=Sv,t.isoParse=kv,t.json=function(t,n){return fetch(t,n).then(oa)},t.keys=function(t){var n=[];for(var e in t)n.push(e);return n},t.lab=Bn,t.lch=function(t,n,e,r){return 1===arguments.length?Xn(t):new Vn(e,n,t,null==r?1:r)},t.line=Uy,t.lineRadial=Xy,t.linkHorizontal=function(){return Qy(Ky)},t.linkRadial=function(){var t=Qy(t_);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t},t.linkVertical=function(){return Qy(Jy)},t.local=qt,t.map=uo,t.matcher=nt,t.max=A,t.mean=function(t,n){var e,r=t.length,i=r,o=-1,a=0;if(null==n)for(;++o<r;)isNaN(e=u(t[o]))?--i:a+=e;else for(;++o<r;)isNaN(e=u(n(t[o],o,t)))?--i:a+=e;if(i)return a/i},t.median=function(t,e){var r,i=t.length,o=-1,a=[];if(null==e)for(;++o<i;)isNaN(r=u(t[o]))||a.push(r);else for(;++o<i;)isNaN(r=u(e(t[o],o,t)))||a.push(r);return N(a.sort(n),.5)},t.merge=T,t.min=S,t.mouse=Bt,t.namespace=W,t.namespaces=$,t.nest=function(){var t,n,e,r=[],i=[];function o(e,i,a,u){if(i>=r.length)return null!=t&&e.sort(t),null!=n?n(e):e;for(var c,f,s,l=-1,h=e.length,d=r[i++],p=uo(),v=a();++l<h;)(s=p.get(c=d(f=e[l])+""))?s.push(f):p.set(c,[f]);return p.each(function(t,n){u(v,n,o(t,i,a,u))}),v}return e={object:function(t){return o(t,0,co,fo)},map:function(t){return o(t,0,so,lo)},entries:function(t){return function t(e,o){if(++o>r.length)return e;var a,u=i[o-1];return null!=n&&o>=r.length?a=e.entries():(a=[],e.each(function(n,e){a.push({key:e,values:t(n,o)})})),null!=u?a.sort(function(t,n){return u(t.key,n.key)}):a}(o(t,0,so,lo),0)},key:function(t){return r.push(t),e},sortKeys:function(t){return i[r.length-1]=t,e},sortValues:function(n){return t=n,e},rollup:function(t){return n=t,e}}},t.now=cr,t.pack=function(){var t=null,n=1,e=1,r=jl;function i(i){return i.x=n/2,i.y=e/2,t?i.eachBefore(Vl(t)).eachAfter($l(r,.5)).eachBefore(Wl(1)):i.eachBefore(Vl(Gl)).eachAfter($l(jl,1)).eachAfter($l(r,i.r/Math.min(n,e))).eachBefore(Wl(Math.min(n,e)/(2*i.r))),i}return i.radius=function(n){return arguments.length?(t=Il(n),i):t},i.size=function(t){return arguments.length?(n=+t[0],e=+t[1],i):[n,e]},i.padding=function(t){return arguments.length?(r="function"==typeof t?t:Xl(+t),i):r},i},t.packEnclose=El,t.packSiblings=function(t){return Fl(t),t},t.pairs=function(t,n){null==n&&(n=a);for(var e=0,r=t.length-1,i=t[0],o=new Array(r<0?0:r);e<r;)o[e]=n(i,i=t[++e]);return o},t.partition=function(){var t=1,n=1,e=0,r=!1;function i(i){var o=i.height+1;return i.x0=i.y0=e,i.x1=t,i.y1=n/o,i.eachBefore(function(t,n){return function(r){r.children&&Ql(r,r.x0,t*(r.depth+1)/n,r.x1,t*(r.depth+2)/n);var i=r.x0,o=r.y0,a=r.x1-e,u=r.y1-e;a<i&&(i=a=(i+a)/2),u<o&&(o=u=(o+u)/2),r.x0=i,r.y0=o,r.x1=a,r.y1=u}}(n,o)),r&&i.eachBefore(Zl),i}return i.round=function(t){return arguments.length?(r=!!t,i):r},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(t){return arguments.length?(e=+t,i):e},i},t.path=to,t.permute=function(t,n){for(var e=n.length,r=new Array(e);e--;)r[e]=t[n[e]];return r},t.pie=function(){var t=Yy,n=By,e=null,r=py(0),i=py(Ay),o=py(0);function a(a){var u,c,f,s,l,h=a.length,d=0,p=new Array(h),v=new Array(h),g=+r.apply(this,arguments),y=Math.min(Ay,Math.max(-Ay,i.apply(this,arguments)-g)),_=Math.min(Math.abs(y)/h,o.apply(this,arguments)),b=_*(y<0?-1:1);for(u=0;u<h;++u)(l=v[p[u]=u]=+t(a[u],u,a))>0&&(d+=l);for(null!=n?p.sort(function(t,e){return n(v[t],v[e])}):null!=e&&p.sort(function(t,n){return e(a[t],a[n])}),u=0,f=d?(y-h*b)/d:0;u<h;++u,g=s)c=p[u],s=g+((l=v[c])>0?l*f:0)+b,v[c]={data:a[c],index:u,value:l,startAngle:g,endAngle:s,padAngle:_};return v}return a.value=function(n){return arguments.length?(t="function"==typeof n?n:py(+n),a):t},a.sortValues=function(t){return arguments.length?(n=t,e=null,a):n},a.sort=function(t){return arguments.length?(e=t,n=null,a):e},a.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:py(+t),a):r},a.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:py(+t),a):i},a.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:py(+t),a):o},a},t.piecewise=function(t,n){for(var e=0,r=n.length-1,i=n[0],o=new Array(r<0?0:r);e<r;)o[e]=t(i,i=n[++e]);return function(t){var n=Math.max(0,Math.min(r-1,Math.floor(t*=r)));return o[n](t-n)}},t.pointRadial=Vy,t.polygonArea=function(t){for(var n,e=-1,r=t.length,i=t[r-1],o=0;++e<r;)n=i,i=t[e],o+=n[1]*i[0]-n[0]*i[1];return o/2},t.polygonCentroid=function(t){for(var n,e,r=-1,i=t.length,o=0,a=0,u=t[i-1],c=0;++r<i;)n=u,u=t[r],c+=e=n[0]*u[1]-u[0]*n[1],o+=(n[0]+u[0])*e,a+=(n[1]+u[1])*e;return[o/(c*=3),a/c]},t.polygonContains=function(t,n){for(var e,r,i=t.length,o=t[i-1],a=n[0],u=n[1],c=o[0],f=o[1],s=!1,l=0;l<i;++l)e=(o=t[l])[0],(r=o[1])>u!=f>u&&a<(c-e)*(u-r)/(f-r)+e&&(s=!s),c=e,f=r;return s},t.polygonHull=function(t){if((e=t.length)<3)return null;var n,e,r=new Array(e),i=new Array(e);for(n=0;n<e;++n)r[n]=[+t[n][0],+t[n][1],n];for(r.sort(vh),n=0;n<e;++n)i[n]=[r[n][0],-r[n][1]];var o=gh(r),a=gh(i),u=a[0]===o[0],c=a[a.length-1]===o[o.length-1],f=[];for(n=o.length-1;n>=0;--n)f.push(t[r[o[n]][2]]);for(n=+u;n<a.length-c;++n)f.push(t[r[a[n]][2]]);return f},t.polygonLength=function(t){for(var n,e,r=-1,i=t.length,o=t[i-1],a=o[0],u=o[1],c=0;++r<i;)n=a,e=u,n-=a=(o=t[r])[0],e-=u=o[1],c+=Math.sqrt(n*n+e*e);return c},t.precisionFixed=Ia,t.precisionPrefix=Ha,t.precisionRound=ja,t.quadtree=ga,t.quantile=N,t.quantize=function(t,n){for(var e=new Array(n),r=0;r<n;++r)e[r]=t(r/(n-1));return e},t.radialArea=Gy,t.radialLine=Xy,t.randomBates=wh,t.randomExponential=Mh,t.randomIrwinHall=xh,t.randomLogNormal=mh,t.randomNormal=bh,t.randomUniform=_h,t.range=g,t.rgb=bn,t.ribbon=function(){var t=no,n=eo,e=ro,r=io,i=oo,o=null;function a(){var a,u=$i.call(arguments),c=t.apply(this,u),f=n.apply(this,u),s=+e.apply(this,(u[0]=c,u)),l=r.apply(this,u)-ji,h=i.apply(this,u)-ji,d=s*Fi(l),p=s*Ii(l),v=+e.apply(this,(u[0]=f,u)),g=r.apply(this,u)-ji,y=i.apply(this,u)-ji;if(o||(o=a=to()),o.moveTo(d,p),o.arc(0,0,s,l,h),l===g&&h===y||(o.quadraticCurveTo(0,0,v*Fi(g),v*Ii(g)),o.arc(0,0,v,g,y)),o.quadraticCurveTo(0,0,d,p),o.closePath(),a)return o=null,a+""||null}return a.radius=function(t){return arguments.length?(e="function"==typeof t?t:Wi(+t),a):e},a.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:Wi(+t),a):r},a.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:Wi(+t),a):i},a.source=function(n){return arguments.length?(t=n,a):t},a.target=function(t){return arguments.length?(n=t,a):n},a.context=function(t){return arguments.length?(o=null==t?null:t,a):o},a},t.scaleBand=Ph,t.scaleDiverging=function t(){var n=Hh(Iv()(Dh));return n.copy=function(){return Yv(n,t())},Ah.apply(n,arguments)},t.scaleDivergingLog=function t(){var n=Qh(Iv()).domain([.1,1,10]);return n.copy=function(){return Yv(n,t()).base(n.base())},Ah.apply(n,arguments)},t.scaleDivergingPow=Hv,t.scaleDivergingSqrt=function(){return Hv.apply(null,arguments).exponent(.5)},t.scaleDivergingSymlog=function t(){var n=td(Iv());return n.copy=function(){return Yv(n,t()).constant(n.constant())},Ah.apply(n,arguments)},t.scaleIdentity=function t(n){var e;function r(t){return isNaN(t=+t)?e:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(n=Sh.call(t,zh),r):n.slice()},r.unknown=function(t){return arguments.length?(e=t,r):e},r.copy=function(){return t(n).unknown(e)},n=arguments.length?Sh.call(n,zh):[0,1],Hh(r)},t.scaleImplicit=Eh,t.scaleLinear=function t(){var n=Fh(Dh,Dh);return n.copy=function(){return Bh(n,t())},Nh.apply(n,arguments),Hh(n)},t.scaleLog=function t(){var n=Qh(Yh()).domain([1,10]);return n.copy=function(){return Bh(n,t()).base(n.base())},Nh.apply(n,arguments),n},t.scaleOrdinal=Ch,t.scalePoint=function(){return function t(n){var e=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return t(e())},n}(Ph.apply(null,arguments).paddingInner(1))},t.scalePow=od,t.scaleQuantile=function t(){var e,r=[],o=[],a=[];function u(){var t=0,n=Math.max(1,o.length);for(a=new Array(n-1);++t<n;)a[t-1]=N(r,t/n);return c}function c(t){return isNaN(t=+t)?e:o[i(a,t)]}return c.invertExtent=function(t){var n=o.indexOf(t);return n<0?[NaN,NaN]:[n>0?a[n-1]:r[0],n<a.length?a[n]:r[r.length-1]]},c.domain=function(t){if(!arguments.length)return r.slice();r=[];for(var e,i=0,o=t.length;i<o;++i)null==(e=t[i])||isNaN(e=+e)||r.push(e);return r.sort(n),u()},c.range=function(t){return arguments.length?(o=kh.call(t),u()):o.slice()},c.unknown=function(t){return arguments.length?(e=t,c):e},c.quantiles=function(){return a.slice()},c.copy=function(){return t().domain(r).range(o).unknown(e)},Nh.apply(c,arguments)},t.scaleQuantize=function t(){var n,e=0,r=1,o=1,a=[.5],u=[0,1];function c(t){return t<=t?u[i(a,t,0,o)]:n}function f(){var t=-1;for(a=new Array(o);++t<o;)a[t]=((t+1)*r-(t-o)*e)/(o+1);return c}return c.domain=function(t){return arguments.length?(e=+t[0],r=+t[1],f()):[e,r]},c.range=function(t){return arguments.length?(o=(u=kh.call(t)).length-1,f()):u.slice()},c.invertExtent=function(t){var n=u.indexOf(t);return n<0?[NaN,NaN]:n<1?[e,a[0]]:n>=o?[a[o-1],r]:[a[n-1],a[n]]},c.unknown=function(t){return arguments.length?(n=t,c):c},c.thresholds=function(){return a.slice()},c.copy=function(){return t().domain([e,r]).range(u).unknown(n)},Nh.apply(Hh(c),arguments)},t.scaleSequential=function t(){var n=Hh(Bv()(Dh));return n.copy=function(){return Yv(n,t())},Ah.apply(n,arguments)},t.scaleSequentialLog=function t(){var n=Qh(Bv()).domain([1,10]);return n.copy=function(){return Yv(n,t()).base(n.base())},Ah.apply(n,arguments)},t.scaleSequentialPow=Fv,t.scaleSequentialQuantile=function t(){var e=[],r=Dh;function o(t){if(!isNaN(t=+t))return r((i(e,t)-1)/(e.length-1))}return o.domain=function(t){if(!arguments.length)return e.slice();e=[];for(var r,i=0,a=t.length;i<a;++i)null==(r=t[i])||isNaN(r=+r)||e.push(r);return e.sort(n),o},o.interpolator=function(t){return arguments.length?(r=t,o):r},o.copy=function(){return t(r).domain(e)},Ah.apply(o,arguments)},t.scaleSequentialSqrt=function(){return Fv.apply(null,arguments).exponent(.5)},t.scaleSequentialSymlog=function t(){var n=td(Bv());return n.copy=function(){return Yv(n,t()).constant(n.constant())},Ah.apply(n,arguments)},t.scaleSqrt=function(){return od.apply(null,arguments).exponent(.5)},t.scaleSymlog=function t(){var n=td(Yh());return n.copy=function(){return Bh(n,t()).constant(n.constant())},Nh.apply(n,arguments)},t.scaleThreshold=function t(){var n,e=[.5],r=[0,1],o=1;function a(t){return t<=t?r[i(e,t,0,o)]:n}return a.domain=function(t){return arguments.length?(e=kh.call(t),o=Math.min(e.length,r.length-1),a):e.slice()},a.range=function(t){return arguments.length?(r=kh.call(t),o=Math.min(e.length,r.length-1),a):r.slice()},a.invertExtent=function(t){var n=r.indexOf(t);return[e[n-1],e[n]]},a.unknown=function(t){return arguments.length?(n=t,a):n},a.copy=function(){return t().domain(e).range(r).unknown(n)},Nh.apply(a,arguments)},t.scaleTime=function(){return Nh.apply(Ov(Od,Ld,wd,bd,yd,vd,dd,fd,t.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},t.scaleUtc=function(){return Nh.apply(Ov(fp,up,Vd,jd,Id,Yd,dd,fd,t.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},t.scan=function(t,e){if(r=t.length){var r,i,o=0,a=0,u=t[a];for(null==e&&(e=n);++o<r;)(e(i=t[o],u)<0||0!==e(u,u))&&(u=i,a=o);return 0===e(u,u)?a:void 0}},t.schemeAccent=Gv,t.schemeBlues=jg,t.schemeBrBG=eg,t.schemeBuGn=mg,t.schemeBuPu=wg,t.schemeCategory10=Xv,t.schemeDark2=Vv,t.schemeGnBu=Ng,t.schemeGreens=Gg,t.schemeGreys=$g,t.schemeOrRd=Tg,t.schemeOranges=ty,t.schemePRGn=ig,t.schemePaired=$v,t.schemePastel1=Wv,t.schemePastel2=Zv,t.schemePiYG=ag,t.schemePuBu=Cg,t.schemePuBuGn=kg,t.schemePuOr=cg,t.schemePuRd=zg,t.schemePurples=Zg,t.schemeRdBu=sg,t.schemeRdGy=hg,t.schemeRdPu=Dg,t.schemeRdYlBu=pg,t.schemeRdYlGn=gg,t.schemeReds=Kg,t.schemeSet1=Qv,t.schemeSet2=Kv,t.schemeSet3=Jv,t.schemeSpectral=_g,t.schemeTableau10=tg,t.schemeYlGn=Og,t.schemeYlGnBu=Lg,t.schemeYlOrBr=Yg,t.schemeYlOrRd=Ig,t.select=Rt,t.selectAll=function(t){return"string"==typeof t?new Pt([document.querySelectorAll(t)],[document.documentElement]):new Pt([null==t?[]:t],Ct)},t.selection=zt,t.selector=K,t.selectorAll=tt,t.set=vo,t.shuffle=function(t,n,e){for(var r,i,o=(null==e?t.length:e)-(n=null==n?0:+n);o;)i=Math.random()*o--|0,r=t[o+n],t[o+n]=t[i+n],t[i+n]=r;return t},t.stack=function(){var t=py([]),n=Q_,e=Z_,r=K_;function i(i){var o,a,u=t.apply(this,arguments),c=i.length,f=u.length,s=new Array(f);for(o=0;o<f;++o){for(var l,h=u[o],d=s[o]=new Array(c),p=0;p<c;++p)d[p]=l=[0,+r(i[p],h,p,i)],l.data=i[p];d.key=h}for(o=0,a=n(s);o<f;++o)s[a[o]].index=o;return e(s,a),s}return i.keys=function(n){return arguments.length?(t="function"==typeof n?n:py($y.call(n)),i):t},i.value=function(t){return arguments.length?(r="function"==typeof t?t:py(+t),i):r},i.order=function(t){return arguments.length?(n=null==t?Q_:"function"==typeof t?t:py($y.call(t)),i):n},i.offset=function(t){return arguments.length?(e=null==t?Z_:t,i):e},i},t.stackOffsetDiverging=function(t,n){if((u=t.length)>0)for(var e,r,i,o,a,u,c=0,f=t[n[0]].length;c<f;++c)for(o=a=0,e=0;e<u;++e)(i=(r=t[n[e]][c])[1]-r[0])>=0?(r[0]=o,r[1]=o+=i):i<0?(r[1]=a,r[0]=a+=i):r[0]=o},t.stackOffsetExpand=function(t,n){if((r=t.length)>0){for(var e,r,i,o=0,a=t[0].length;o<a;++o){for(i=e=0;e<r;++e)i+=t[e][o][1]||0;if(i)for(e=0;e<r;++e)t[e][o][1]/=i}Z_(t,n)}},t.stackOffsetNone=Z_,t.stackOffsetSilhouette=function(t,n){if((e=t.length)>0){for(var e,r=0,i=t[n[0]],o=i.length;r<o;++r){for(var a=0,u=0;a<e;++a)u+=t[a][r][1]||0;i[r][1]+=i[r][0]=-u/2}Z_(t,n)}},t.stackOffsetWiggle=function(t,n){if((i=t.length)>0&&(r=(e=t[n[0]]).length)>0){for(var e,r,i,o=0,a=1;a<r;++a){for(var u=0,c=0,f=0;u<i;++u){for(var s=t[n[u]],l=s[a][1]||0,h=(l-(s[a-1][1]||0))/2,d=0;d<u;++d){var p=t[n[d]];h+=(p[a][1]||0)-(p[a-1][1]||0)}c+=l,f+=h*l}e[a-1][1]+=e[a-1][0]=o,c&&(o-=f/c)}e[a-1][1]+=e[a-1][0]=o,Z_(t,n)}},t.stackOrderAppearance=J_,t.stackOrderAscending=nb,t.stackOrderDescending=function(t){return nb(t).reverse()},t.stackOrderInsideOut=function(t){var n,e,r=t.length,i=t.map(eb),o=J_(t),a=0,u=0,c=[],f=[];for(n=0;n<r;++n)e=o[n],a<u?(a+=i[e],c.push(e)):(u+=i[e],f.push(e));return f.reverse().concat(c)},t.stackOrderNone=Q_,t.stackOrderReverse=function(t){return Q_(t).reverse()},t.stratify=function(){var t=nh,n=eh;function e(e){var r,i,o,a,u,c,f,s=e.length,l=new Array(s),h={};for(i=0;i<s;++i)r=e[i],u=l[i]=new Sl(r),null!=(c=t(r,i,e))&&(c+="")&&(h[f=Kl+(u.id=c)]=f in h?th:u);for(i=0;i<s;++i)if(u=l[i],null!=(c=n(e[i],i,e))&&(c+="")){if(!(a=h[Kl+c]))throw new Error("missing: "+c);if(a===th)throw new Error("ambiguous: "+c);a.children?a.children.push(u):a.children=[u],u.parent=a}else{if(o)throw new Error("multiple roots");o=u}if(!o)throw new Error("no root");if(o.parent=Jl,o.eachBefore(function(t){t.depth=t.parent.depth+1,--s}).eachBefore(Tl),o.parent=null,s>0)throw new Error("cycle");return o}return e.id=function(n){return arguments.length?(t=Hl(n),e):t},e.parentId=function(t){return arguments.length?(n=Hl(t),e):n},e},t.style=ft,t.sum=function(t,n){var e,r=t.length,i=-1,o=0;if(null==n)for(;++i<r;)(e=+t[i])&&(o+=e);else for(;++i<r;)(e=+n(t[i],i,t))&&(o+=e);return o},t.svg=fa,t.symbol=function(){var t=py(n_),n=py(64),e=null;function r(){var r;if(e||(e=r=to()),t.apply(this,arguments).draw(e,+n.apply(this,arguments)),r)return e=null,r+""||null}return r.type=function(n){return arguments.length?(t="function"==typeof n?n:py(n),r):t},r.size=function(t){return arguments.length?(n="function"==typeof t?t:py(+t),r):n},r.context=function(t){return arguments.length?(e=null==t?null:t,r):e},r},t.symbolCircle=n_,t.symbolCross=e_,t.symbolDiamond=o_,t.symbolSquare=s_,t.symbolStar=f_,t.symbolTriangle=h_,t.symbolWye=g_,t.symbols=y_,t.text=na,t.thresholdFreedmanDiaconis=function(t,e,r){return t=d.call(t,u).sort(n),Math.ceil((r-e)/(2*(N(t,.75)-N(t,.25))*Math.pow(t.length,-1/3)))},t.thresholdScott=function(t,n,e){return Math.ceil((e-n)/(3.5*f(t)*Math.pow(t.length,-1/3)))},t.thresholdSturges=M,t.tickFormat=Ih,t.tickIncrement=x,t.tickStep=w,t.ticks=m,t.timeDay=bd,t.timeDays=md,t.timeFormatDefaultLocale=Tv,t.timeFormatLocale=pp,t.timeFriday=Sd,t.timeFridays=Dd,t.timeHour=yd,t.timeHours=_d,t.timeInterval=cd,t.timeMillisecond=fd,t.timeMilliseconds=sd,t.timeMinute=vd,t.timeMinutes=gd,t.timeMonday=Md,t.timeMondays=Cd,t.timeMonth=Ld,t.timeMonths=Ud,t.timeSaturday=kd,t.timeSaturdays=qd,t.timeSecond=dd,t.timeSeconds=pd,t.timeSunday=wd,t.timeSundays=Ed,t.timeThursday=Td,t.timeThursdays=Rd,t.timeTuesday=Nd,t.timeTuesdays=Pd,t.timeWednesday=Ad,t.timeWednesdays=zd,t.timeWeek=wd,t.timeWeeks=Ed,t.timeYear=Od,t.timeYears=Bd,t.timeout=gr,t.timer=lr,t.timerFlush=hr,t.touch=Yt,t.touches=function(t,n){null==n&&(n=Ut().touches);for(var e=0,r=n?n.length:0,i=new Array(r);e<r;++e)i[e]=Ot(t,n[e]);return i},t.transition=Ur,t.transpose=k,t.tree=function(){var t=rh,n=1,e=1,r=null;function i(i){var c=function(t){for(var n,e,r,i,o,a=new ch(t,0),u=[a];n=u.pop();)if(r=n._.children)for(n.children=new Array(o=r.length),i=o-1;i>=0;--i)u.push(e=n.children[i]=new ch(r[i],i)),e.parent=n;return(a.parent=new ch(null,0)).children=[a],a}(i);if(c.eachAfter(o),c.parent.m=-c.z,c.eachBefore(a),r)i.eachBefore(u);else{var f=i,s=i,l=i;i.eachBefore(function(t){t.x<f.x&&(f=t),t.x>s.x&&(s=t),t.depth>l.depth&&(l=t)});var h=f===s?1:t(f,s)/2,d=h-f.x,p=n/(s.x+h+d),v=e/(l.depth||1);i.eachBefore(function(t){t.x=(t.x+d)*p,t.y=t.depth*v})}return i}function o(n){var e=n.children,r=n.parent.children,i=n.i?r[n.i-1]:null;if(e){!function(t){for(var n,e=0,r=0,i=t.children,o=i.length;--o>=0;)(n=i[o]).z+=e,n.m+=e,e+=n.s+(r+=n.c)}(n);var o=(e[0].z+e[e.length-1].z)/2;i?(n.z=i.z+t(n._,i._),n.m=n.z-o):n.z=o}else i&&(n.z=i.z+t(n._,i._));n.parent.A=function(n,e,r){if(e){for(var i,o=n,a=n,u=e,c=o.parent.children[0],f=o.m,s=a.m,l=u.m,h=c.m;u=oh(u),o=ih(o),u&&o;)c=ih(c),(a=oh(a)).a=n,(i=u.z+l-o.z-f+t(u._,o._))>0&&(ah(uh(u,n,r),n,i),f+=i,s+=i),l+=u.m,f+=o.m,h+=c.m,s+=a.m;u&&!oh(a)&&(a.t=u,a.m+=l-s),o&&!ih(c)&&(c.t=o,c.m+=f-h,r=n)}return r}(n,i,n.parent.A||r[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function u(t){t.x*=n,t.y=t.depth*e}return i.separation=function(n){return arguments.length?(t=n,i):t},i.size=function(t){return arguments.length?(r=!1,n=+t[0],e=+t[1],i):r?null:[n,e]},i.nodeSize=function(t){return arguments.length?(r=!0,n=+t[0],e=+t[1],i):r?[n,e]:null},i},t.treemap=function(){var t=hh,n=!1,e=1,r=1,i=[0],o=jl,a=jl,u=jl,c=jl,f=jl;function s(t){return t.x0=t.y0=0,t.x1=e,t.y1=r,t.eachBefore(l),i=[0],n&&t.eachBefore(Zl),t}function l(n){var e=i[n.depth],r=n.x0+e,s=n.y0+e,l=n.x1-e,h=n.y1-e;l<r&&(r=l=(r+l)/2),h<s&&(s=h=(s+h)/2),n.x0=r,n.y0=s,n.x1=l,n.y1=h,n.children&&(e=i[n.depth+1]=o(n)/2,r+=f(n)-e,s+=a(n)-e,(l-=u(n)-e)<r&&(r=l=(r+l)/2),(h-=c(n)-e)<s&&(s=h=(s+h)/2),t(n,r,s,l,h))}return s.round=function(t){return arguments.length?(n=!!t,s):n},s.size=function(t){return arguments.length?(e=+t[0],r=+t[1],s):[e,r]},s.tile=function(n){return arguments.length?(t=Hl(n),s):t},s.padding=function(t){return arguments.length?s.paddingInner(t).paddingOuter(t):s.paddingInner()},s.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:Xl(+t),s):o},s.paddingOuter=function(t){return arguments.length?s.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):s.paddingTop()},s.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:Xl(+t),s):a},s.paddingRight=function(t){return arguments.length?(u="function"==typeof t?t:Xl(+t),s):u},s.paddingBottom=function(t){return arguments.length?(c="function"==typeof t?t:Xl(+t),s):c},s.paddingLeft=function(t){return arguments.length?(f="function"==typeof t?t:Xl(+t),s):f},s},t.treemapBinary=function(t,n,e,r,i){var o,a,u=t.children,c=u.length,f=new Array(c+1);for(f[0]=a=o=0;o<c;++o)f[o+1]=a+=u[o].value;!function t(n,e,r,i,o,a,c){if(n>=e-1){var s=u[n];return s.x0=i,s.y0=o,s.x1=a,void(s.y1=c)}for(var l=f[n],h=r/2+l,d=n+1,p=e-1;d<p;){var v=d+p>>>1;f[v]<h?d=v+1:p=v}h-f[d-1]<f[d]-h&&n+1<d&&--d;var g=f[d]-l,y=r-g;if(a-i>c-o){var _=(i*y+a*g)/r;t(n,d,g,i,o,_,c),t(d,e,y,_,o,a,c)}else{var b=(o*y+c*g)/r;t(n,d,g,i,o,a,b),t(d,e,y,i,b,a,c)}}(0,c,t.value,n,e,r,i)},t.treemapDice=Ql,t.treemapResquarify=dh,t.treemapSlice=fh,t.treemapSliceDice=function(t,n,e,r,i){(1&t.depth?fh:Ql)(t,n,e,r,i)},t.treemapSquarify=hh,t.tsv=ia,t.tsvFormat=Wo,t.tsvFormatBody=Zo,t.tsvFormatRows=Qo,t.tsvParse=Vo,t.tsvParseRows=$o,t.utcDay=jd,t.utcDays=Xd,t.utcFriday=Kd,t.utcFridays=op,t.utcHour=Id,t.utcHours=Hd,t.utcMillisecond=fd,t.utcMilliseconds=sd,t.utcMinute=Yd,t.utcMinutes=Fd,t.utcMonday=$d,t.utcMondays=np,t.utcMonth=up,t.utcMonths=cp,t.utcSaturday=Jd,t.utcSaturdays=ap,t.utcSecond=dd,t.utcSeconds=pd,t.utcSunday=Vd,t.utcSundays=tp,t.utcThursday=Qd,t.utcThursdays=ip,t.utcTuesday=Wd,t.utcTuesdays=ep,t.utcWednesday=Zd,t.utcWednesdays=rp,t.utcWeek=Vd,t.utcWeeks=tp,t.utcYear=fp,t.utcYears=sp,t.values=function(t){var n=[];for(var e in t)n.push(t[e]);return n},t.variance=c,t.version="5.12.0",t.voronoi=function(){var t=ib,n=ob,e=null;function r(r){return new Yb(r.map(function(e,i){var o=[Math.round(t(e,i,r)/Lb)*Lb,Math.round(n(e,i,r)/Lb)*Lb];return o.index=i,o.data=e,o}),e)}return r.polygons=function(t){return r(t).polygons()},r.links=function(t){return r(t).links()},r.triangles=function(t){return r(t).triangles()},r.x=function(n){return arguments.length?(t="function"==typeof n?n:rb(+n),r):t},r.y=function(t){return arguments.length?(n="function"==typeof t?t:rb(+t),r):n},r.extent=function(t){return arguments.length?(e=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],r):e&&[[e[0][0],e[0][1]],[e[1][0],e[1][1]]]},r.size=function(t){return arguments.length?(e=null==t?null:[[0,0],[+t[0],+t[1]]],r):e&&[e[1][0]-e[0][0],e[1][1]-e[0][1]]},r},t.window=ct,t.xml=ua,t.zip=function(){return k(arguments)},t.zoom=function(){var n,e,r=$b,i=Wb,o=Jb,a=Qb,u=Kb,c=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],s=250,l=Fe,h=I("start","zoom","end"),d=500,p=150,v=0;function g(t){t.property("__zoom",Zb).on("wheel.zoom",M).on("mousedown.zoom",N).on("dblclick.zoom",A).filter(u).on("touchstart.zoom",T).on("touchmove.zoom",S).on("touchend.zoom touchcancel.zoom",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,n){return(n=Math.max(c[0],Math.min(c[1],n)))===t.k?t:new Hb(n,t.x,t.y)}function _(t,n,e){var r=n[0]-e[0]*t.k,i=n[1]-e[1]*t.k;return r===t.x&&i===t.y?t:new Hb(t.k,r,i)}function b(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function m(t,n,e){t.on("start.zoom",function(){x(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).end()}).tween("zoom",function(){var t=this,r=arguments,o=x(t,r),a=i.apply(t,r),u=null==e?b(a):"function"==typeof e?e.apply(t,r):e,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),f=t.__zoom,s="function"==typeof n?n.apply(t,r):n,h=l(f.invert(u).concat(c/f.k),s.invert(u).concat(c/s.k));return function(t){if(1===t)t=s;else{var n=h(t),e=c/n[2];t=new Hb(e,u[0]-n[0]*e,u[1]-n[1]*e)}o.zoom(null,t)}})}function x(t,n,e){return!e&&t.__zooming||new w(t,n)}function w(t,n){this.that=t,this.args=n,this.active=0,this.extent=i.apply(t,n),this.taps=0}function M(){if(r.apply(this,arguments)){var t=x(this,arguments),n=this.__zoom,e=Math.max(c[0],Math.min(c[1],n.k*Math.pow(2,a.apply(this,arguments)))),i=Bt(this);if(t.wheel)t.mouse[0][0]===i[0]&&t.mouse[0][1]===i[1]||(t.mouse[1]=n.invert(t.mouse[0]=i)),clearTimeout(t.wheel);else{if(n.k===e)return;t.mouse=[i,n.invert(i)],Cr(this),t.start()}Vb(),t.wheel=setTimeout(function(){t.wheel=null,t.end()},p),t.zoom("mouse",o(_(y(n,e),t.mouse[0],t.mouse[1]),t.extent,f))}}function N(){if(!e&&r.apply(this,arguments)){var n=x(this,arguments,!0),i=Rt(t.event.view).on("mousemove.zoom",function(){if(Vb(),!n.moved){var e=t.event.clientX-u,r=t.event.clientY-c;n.moved=e*e+r*r>v}n.zoom("mouse",o(_(n.that.__zoom,n.mouse[0]=Bt(n.that),n.mouse[1]),n.extent,f))},!0).on("mouseup.zoom",function(){i.on("mousemove.zoom mouseup.zoom",null),jt(t.event.view,n.moved),Vb(),n.end()},!0),a=Bt(this),u=t.event.clientX,c=t.event.clientY;Ht(t.event.view),Gb(),n.mouse=[a,this.__zoom.invert(a)],Cr(this),n.start()}}function A(){if(r.apply(this,arguments)){var n=this.__zoom,e=Bt(this),a=n.invert(e),u=n.k*(t.event.shiftKey?.5:2),c=o(_(y(n,u),e,a),i.apply(this,arguments),f);Vb(),s>0?Rt(this).transition().duration(s).call(m,c,e):Rt(this).call(g.transform,c)}}function T(){if(r.apply(this,arguments)){var e,i,o,a,u=t.event.touches,c=u.length,f=x(this,arguments,t.event.changedTouches.length===c);for(Gb(),i=0;i<c;++i)a=[a=Yt(this,u,(o=u[i]).identifier),this.__zoom.invert(a),o.identifier],f.touch0?f.touch1||f.touch0[2]===a[2]||(f.touch1=a,f.taps=0):(f.touch0=a,e=!0,f.taps=1+!!n);n&&(n=clearTimeout(n)),e&&(f.taps<2&&(n=setTimeout(function(){n=null},d)),Cr(this),f.start())}}function S(){if(this.__zooming){var e,r,i,a,u=x(this,arguments),c=t.event.changedTouches,s=c.length;for(Vb(),n&&(n=clearTimeout(n)),u.taps=0,e=0;e<s;++e)i=Yt(this,c,(r=c[e]).identifier),u.touch0&&u.touch0[2]===r.identifier?u.touch0[0]=i:u.touch1&&u.touch1[2]===r.identifier&&(u.touch1[0]=i);if(r=u.that.__zoom,u.touch1){var l=u.touch0[0],h=u.touch0[1],d=u.touch1[0],p=u.touch1[1],v=(v=d[0]-l[0])*v+(v=d[1]-l[1])*v,g=(g=p[0]-h[0])*g+(g=p[1]-h[1])*g;r=y(r,Math.sqrt(v/g)),i=[(l[0]+d[0])/2,(l[1]+d[1])/2],a=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!u.touch0)return;i=u.touch0[0],a=u.touch0[1]}u.zoom("touch",o(_(r,i,a),u.extent,f))}}function k(){if(this.__zooming){var n,r,i=x(this,arguments),o=t.event.changedTouches,a=o.length;for(Gb(),e&&clearTimeout(e),e=setTimeout(function(){e=null},d),n=0;n<a;++n)r=o[n],i.touch0&&i.touch0[2]===r.identifier?delete i.touch0:i.touch1&&i.touch1[2]===r.identifier&&delete i.touch1;if(i.touch1&&!i.touch0&&(i.touch0=i.touch1,delete i.touch1),i.touch0)i.touch0[1]=this.__zoom.invert(i.touch0[0]);else if(i.end(),2===i.taps){var u=Rt(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return g.transform=function(t,n,e){var r=t.selection?t.selection():t;r.property("__zoom",Zb),t!==r?m(t,n,e):r.interrupt().each(function(){x(this,arguments).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()})},g.scaleBy=function(t,n,e){g.scaleTo(t,function(){var t=this.__zoom.k,e="function"==typeof n?n.apply(this,arguments):n;return t*e},e)},g.scaleTo=function(t,n,e){g.transform(t,function(){var t=i.apply(this,arguments),r=this.__zoom,a=null==e?b(t):"function"==typeof e?e.apply(this,arguments):e,u=r.invert(a),c="function"==typeof n?n.apply(this,arguments):n;return o(_(y(r,c),a,u),t,f)},e)},g.translateBy=function(t,n,e){g.transform(t,function(){return o(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof e?e.apply(this,arguments):e),i.apply(this,arguments),f)})},g.translateTo=function(t,n,e,r){g.transform(t,function(){var t=i.apply(this,arguments),a=this.__zoom,u=null==r?b(t):"function"==typeof r?r.apply(this,arguments):r;return o(jb.translate(u[0],u[1]).scale(a.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof e?-e.apply(this,arguments):-e),t,f)},r)},w.prototype={start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){kt(new Ib(g,t,this.that.__zoom),h.apply,h,[t,this.that,this.args])}},g.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:Fb(+t),g):a},g.filter=function(t){return arguments.length?(r="function"==typeof t?t:Fb(!!t),g):r},g.touchable=function(t){return arguments.length?(u="function"==typeof t?t:Fb(!!t),g):u},g.extent=function(t){return arguments.length?(i="function"==typeof t?t:Fb([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),g):i},g.scaleExtent=function(t){return arguments.length?(c[0]=+t[0],c[1]=+t[1],g):[c[0],c[1]]},g.translateExtent=function(t){return arguments.length?(f[0][0]=+t[0][0],f[1][0]=+t[1][0],f[0][1]=+t[0][1],f[1][1]=+t[1][1],g):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},g.constrain=function(t){return arguments.length?(o=t,g):o},g.duration=function(t){return arguments.length?(s=+t,g):s},g.interpolate=function(t){return arguments.length?(l=t,g):l},g.on=function(){var t=h.on.apply(h,arguments);return t===h?g:t},g.clickDistance=function(t){return arguments.length?(v=(t=+t)*t,g):Math.sqrt(v)},g},t.zoomIdentity=jb,t.zoomTransform=Xb,Object.defineProperty(t,"__esModule",{value:!0})});

define('local_boostnavigation/collapsenavdrawernodes', ["jquery"],function(a){"use strict";function b(b,e){b.click(function(f){if(f.preventDefault(),0==b.attr("data-collapse"))c(b,e);else if(1==b.attr("data-collapse")){d(b,e);var g=b.attr("data-localboostnavigation-accordion");"undefined"!=typeof g&&a('.list-group-item[data-key^="'+g+'"][data-isexpandable="1"]').each(function(){a(this).attr("data-key")!==b.attr("data-key")&&c(a(this),a(this).attr("data-key"))})}})}function c(b,c){a(".list-group-item[data-parent-key="+c+"]").attr("data-hidden","1"),b.attr("data-collapse","1"),b.attr("aria-expanded","0"),M.util.set_user_preference("local_boostnavigation-collapse_"+c+"node",1)}function d(b,c){a(".list-group-item[data-parent-key="+c+"]").attr("data-hidden","0"),b.attr("data-collapse","0"),b.attr("aria-expanded","1"),M.util.set_user_preference("local_boostnavigation-collapse_"+c+"node",0)}function e(b,c){var d="";a(".list-group-item[data-parent-key="+c+"]").each(function(b,c){var e=a(c).attr("data-key");"localboost"!==e.substring(0,10)&&(e="localboostnavigation"+e),a(c).attr("id",e),d=d+e+" "}),""!==d&&b.attr("aria-controls",d.trim()),0==b.attr("data-collapse")?b.attr("aria-expanded","1"):1==b.attr("data-collapse")&&b.attr("aria-expanded","0")}function f(a){a.attr("tabindex","0"),a.keydown(function(a){13===a.which&&a.currentTarget.click()}),a.mousedown(function(){a.css("outline","none")}),a.mouseup(function(){a.css("outline",""),a.blur()})}function g(c){var d=a('.list-group-item[data-key="'+c+'"]');b(d,c),e(d,c),"mycourses"==c&&f(d)}function h(b){a('.list-group-item[data-key^="'+b+'"][data-isexpandable="1"]').attr("data-localboostnavigation-accordion",b)}return{init:function(a,b){for(var c=0,d=a.length;c<d;c++)g(a[c]);for(var e=0,f=b.length;e<f;e++)h(b[e])}}});
//fuction to sort select elements 

//console.log("script course 2");
var tagid=1;
var coursemodule;
var courseid;
var quizurl;
var quizorgid;
var randomqus=[];
var bool=[];
var del=1;

        	var tagspanid=1;
        	var tagex=1;
        	var tagspanexid=1;
        	
  
function sortSelect(select) {
    $(select).html($(select).children('option').sort(function (x, y) {
        return $(x).text().toUpperCase() < $(y).text().toUpperCase() ? -1 : 1;
    }));
    //Add empty select option tag and select it
    $( select + ' option:eq(0)').before('<option value="">Select</option>');
    $(select).get(0).selectedIndex = 0;
}


function clickbuton(id){
	
		 var spid=$('#'+id).parent().attr('id');
		 //alert($('#'+id).parent().attr('value'));
		 $('span[id^="'+spid+'"]').remove();
	
 	}

function getcourse(){
	
	
	var val= '';
	if($( "#dropone1 option:selected" ).val()!=''){
	if($("#dropone2").length){
		if($( "#dropone2 option:selected" ).val()!=''){
		val= $( "#dropone2 option:selected" ).val();
		}
		else{
			val=$( "#dropone1 option:selected" ).val();
		}
	}
	else{
		val=$( "#dropone1 option:selected" ).val();
	}
	}
	
	if(val!=''){
	$.ajax({	
		method: "POST",
		url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
		data: { "categoryid" : val, "choice" : "get_courses", "categorycount" : 1 }
	})
	.done(function( response ) {
		//console.log(response);

						if($("#courserem").length){
							
							$("#courserem").remove();
							$("#sectionrem").remove();
						}
		$('#coursediv').append( response );
		sortSelect('.coursedropdown1 select' );
	});
	}

}

function typeChange(type){
	
	 if(type=='R'){
		 $('#randomselect').removeClass('hidden');
	
	 }
	 else{
		 $("#bankcount").val('');
		 $("#quizcount").val('');
		 $('#randomselect').addClass('hidden');
	 }

}


function deletebuton(id,del){
	$('#divduplicate').addClass('hidden');
	$('#'+id+del+'TR').remove();
	var newStrs='';
	 $('#tab2').find('a').each(function() { 
	    var ids = this.id;
	    var valstr=$('#'+ids).attr('value');
	     newStrs=newStrs+valstr;
	
	    // do whatever...
	});
	//alert(newStrs);
	newStrs = newStrs.substring(0, newStrs.length-2);
	
		var totalmarks=0;
		var totalcounts=0;
	
	if(newStrs!=''){
	var quesarrays = newStrs.split(",");
	
	var totalmarks=quesarrays.length;
	var totalcounts=quesarrays.length;
	}
	else{
		 $('.uploadquestionsAddbuttonsdiv').addClass('hidden');
	}
	
	 $("#totm").html(totalmarks);
	 $("#totc").html(totalcounts);
	 var totaltr= $('#tab2').find('tr').length-1;
	 
	 $("#sec").html(totaltr);
	 $("#ski").html(totaltr);
	 for (var i = 0; i < randomqus.length; i++){
		 var quesarrays = randomqus[i].split("@");
		    if (quesarrays[0] == id) { 
		    	randomqus.splice(i, 1);
		        break;
		    }
	 }
 	}

function showmodal(cat){
	/* $('#rem').click( function() {
 		var as=$(this).closest('span').attr('id');*/
	$('#divduplicate').addClass('hidden');
	
	var catid=cat;
 	   var ques=$('#'+cat).attr('value');
 	     
 	  ques = ques.substring(0, ques.length-1); 
 	  if(ques.includes('R')){
 		 $('#duphead').remove();
		 $('#randsel').remove();
 		 $('<h5 id="randsel" style="color:red">Edit is not allowed for Random Questions</h5>').appendTo('#divduplicate');
 		 $('#divduplicate').removeClass('hidden');
 	  }
 	  else{
 		 $('#duphead').remove();
		 $('#randsel').remove();
		 $('#divduplicate').addClass('hidden');
 	  	   var quesarray = ques.split(",");
 	     jQuery.ajax({	
    			method: "POST",
    			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
    			data: { "categoryid" : catid, "choice" : "get_questions"}
			})
			.done(function( response ) {
				//console.log(response);
				jQuery("#classTable1").html("<tbody>"+response+"</tbody>");
				// $(".modal-body").html(response);
				//$('#confirmActionModal .modal-body tbody').append();
				for(var i=0;i<quesarray.length;i++){
					// alert(quesarray[i]);
				jQuery('.messageCheckbox').each(function(){
					if(quesarray[i].includes('@')){
						var quesat=quesarray[i].split("@");
						 if($(this).val()==quesat[0]){
		     		        	this.checked = true;
		     		        }
					}
					else{
     		        if($(this).val()==quesarray[i]){
     		        	this.checked = true;
     		        }
					}

     		    });
				}
				jQuery(".modal-body #bookId").val(cat);
				jQuery(".modal-body #quesId").val(ques);
				jQuery('#confirmActionModal').modal('show');
			});
    		
 	  }
 	}

var drop1='';
var drop2='';
var drop3='';
var drop4='';
var selstring='';
function selectChangedQ( element ){
	//console.log(element);
	//console.log(element.value);
	/*if(element.id=='dropone1'){
	var skillsSelect = document.getElementById(element.id);
	 drop1 = skillsSelect.options[skillsSelect.selectedIndex].text;
	  drop2='';
	  drop3='';
	  drop4='';
	}
	if(element.id=='dropone2'){
		var skillsSelect = document.getElementById(element.id);
		 drop2 = skillsSelect.options[skillsSelect.selectedIndex].text;
		 
		  drop3='';
		  drop4='';
		}
	if(element.id=='courseone1'){
		var skillsSelect = document.getElementById(element.id);
		 drop3 = skillsSelect.options[skillsSelect.selectedIndex].text;
		
		  drop4='';
		}
	if(element.id=='sectionone2'){
		var skillsSelect = document.getElementById(element.id);
		 drop4 = skillsSelect.options[skillsSelect.selectedIndex].text;
		}
	//Remove all subsequent dropdowns as they all are useless now
	
	if(drop1!=''){
		 selstring=drop1+'/';
	}
	if(drop2!=''){
		 selstring=selstring+drop2+'/';
	}
	if(drop3!=''){
		 selstring=selstring+drop3+'/';
	}
	if(drop4!=''){
		 selstring=selstring+drop4+'/';
	}
	selstring = selstring.substring(0, selstring.length-1);*/
	//console.log(element.value);
	var className = element.parentNode.className;
	className = className.split(' ').pop('-1');
	$('.' + className).nextAll().remove();
	
	//console.log(element.value);
	//Ensure that the change event is not selecting the 'Select' option
	if( element.value ){
		
		//console.log(element.value);
		//Make the buttons div visible when select1 is changed
		if( element.className.includes('select1') ){
			$('.questionsAddbuttonsdiv').removeClass('hidden');
		}
		
		//Make an ajax call to get the list of categories inside the given subcategory
		var categoryCount = $('.filterbuttonsdiv div.categoryfilter').length + 1;
		$.ajax({	
			method: "POST",
			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
			data: { "categoryid" : element.value , "choice" : "get_subcategory", "categorycount" : categoryCount }
		})
		.done(function( response ) {
			if ( response !== 'NO_DATA'){
	            //Category had subcategory
				
				$('.filterbuttonsdiv').append( response );
				sortSelect('.categorydropdown'+ categoryCount +' select' );
			}
		});
	}else if ( element.className.includes('select1') ){
		//only the first category is visible and select option is choosen in it
		$('.questionsAddbuttonsdiv').addClass('hidden');
	}
	 $('#go').removeClass('hidden');
}




var course1='';
var course2='';
var selstring='';
function selectcourseQ( element ){
	//console.log(element);
	//console.log(element.value);
	
	if(element.id=='courseone1'){
		var skillsSelect = document.getElementById(element.id);
		course1 = skillsSelect.options[skillsSelect.selectedIndex].text;
		
		course2='';
		}

	
	//Remove all subsequent dropdowns as they all are useless now
	
	if(course1!=''){
		 selstring=course1;
		 if($( "#sectionone2 option:selected" ).val()!=''){
				val= $( "#sectionone2 option:selected" ).text();
				selstring=selstring+'/'+val;
				}
		 
	}
	

	
	//console.log(element.value);
	var className = element.parentNode.className;
	className = className.split(' ').pop('-1');
	$('.' + className).nextAll().remove();
	
	//console.log(element.value);
	//Ensure that the change event is not selecting the 'Select' option
	if( element.value ){
		
		//console.log(element.value);
		//Make the buttons div visible when select1 is changed
		if( element.className.includes('select1') ){
			$('.questionsAddbuttonsdiv').removeClass('hidden');
		}
		
		//Make an ajax call to get the list of categories inside the given subcategory
		var categoryCount = $('.coursebuttonsdiv div.coursefilter').length + 1;
		//var diff=$("#difftype").val();
		$.ajax({	
			method: "POST",
			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
			data: { "categoryid" : element.value , "choice" : "get_courseSec", "categorycount" : categoryCount}
		})
		.done(function( response ) {
			if ( response !== 'NO_DATA'){
	            //Category had subcategory	
						
				$('.coursebuttonsdiv').append( response );
				sortSelect('.sectiondropdown'+ categoryCount +' select' );
			}
		});
	}else if ( element.className.includes('select1') ){
		//only the first category is visible and select option is choosen in it
		$('.questionsAddbuttonsdiv').addClass('hidden');
	}
	
}







define('local_coursefiltering/script', ['jquery'], function($) {
     return {
        init: function() {
        	var url=  $(location).attr('href');	
        	var tablearray = [];
    	    // when page loads
        	$( document ).ready(function() {
        		
        		var errorHtml =
					' <div id="errorModal" class="modal fade" tabindex="-1" style="padding-top: 100px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">' +
					' <div id = "errordialog" class="modal-dialog" style="max-width:500px">' +
					' <div class="modal-content">' +					
					' <div class="modal-headers" style="background: #020082;height: 50px;">' +
					' <h4 class="modal-title" id="confirmActionModalTitle" style="margin-left: 20px;color: white;padding-top: 10px;"> </h4> </div>' +
					' <div class="modal-body" id="errorRegister" style="height: 120px;"></div>'+
					' <div class="modal-footer">'+ 					
					' <button type="button" class="btn btn-primary" id="errorOk" aria-expanded="false" >Ok</button>'+
					' <button type="button" class="btn btn-primary" id="errorCancel" aria-expanded="false" >Cancel</button></div>'+
					' </div>'+
					' </div></div>';
    			
    			$("#page-header").append(errorHtml);
    			
    			$(document).on("click","#errorCancel",function() {   
    				$("#quizdiv").prop('checked', false);
    				$("#tagdiv").css("display","block");
                 	$("#pickdiv").css("display","block");
    				$("#type").val('P');
    	     	    $('#exclude').find('span').remove();
    	     	    $('#randomselect').addClass('hidden');
    	     	    $("#bankcount").val('');    	     	    
    				$("#errorModal").modal("hide"); 
    				$("#errorCancel").text("Cancel");
    				$("#errorOk").css("display","block");
    				$("#confirmActionModalTitle").text("");
    			});
    			
        			  $('.container-fluid').removeClass('hidden');
        		    
        		 
        		//lets build the first category dropdown
        		$.ajax({	
        			method: "POST",
        			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
        			data: { "categoryid" : 0, "choice" : "get_subcategory", "categorycount" : 1 }
    			})
    			.done(function( response ) {    				
    				$('.filterbuttonsdiv').append( response );
    				sortSelect('.categorydropdown1 select' );
    			});
        		
        		
        		$('<div id="tagbasediv"style="margin-right: 5px;" class="autocomplete" ><div><h5 style="padding-top:5px">With following tags</h5></div><div id="exclude"><input id="tagexclude" style=" border: 1px solid lightgrey;" type="text" name="taginc" placeholder="Exclude tags"></div></div>').appendTo('#tagdiv');
        		
        		
        		//$('<div id="diffone" class="row col-sm-12"><h5 style="padding-top:5px">Difficulty Level</h5></div><div class="col-sm-12" id="diffsel"><select style=" border: 1px solid lightgrey;" id="difftype"><option value="ALL">ALL</option><option value="Easy">Easy</option><option value="Medium">Medium</option><option value="Difficult">Difficult</option></select></div>').appendTo('#pickdiv');
        		//$('<div id="spandiv"></div>').appendTo('#tagdiv');
        		$('<div id="picone" class="row col-sm-12"><h5 style="padding-top:5px">Select Question type</h5></div><div class="col-sm-12" id="sel"><select style=" border: 1px solid lightgrey;" id="type" onchange="typeChange(this.value)"><option value="P">Pick</option><option value="R">Random</option></select></div>').appendTo('#pickdiv');
        		$('<div class="row col-sm-12 row hidden" id="randomselect"><div style="margin-left:10px"><h5 style="padding-top: 6px;">Question count: </h5></div><div style="margin-left:20px"><input style="border: 1px solid lightgrey;width:50px;text-align: center;"id="bankcount" type="text" name="bcount"></div></div>').appendTo('#sel');        		  
        		$('<div id="alertone" class="row col-sm-12 hidden"> <h5 style="padding-top:5px;color:red">please give question count</h5> </div>').appendTo('#sel'); 
        		 
        		 
        		/* $("#tagin").keypress(function(e) {
             	    if(e.which == 13) {
             	    	 var tagstr=$("#tagin").val();
             	    	 var s = $('<button type="button" id="rem'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                		 var span = $('<span id="span'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                		 span.append(s);
                		 $('#intag').append('    ');
                		 $('#intag').append(span);
                		$("#tagin").val('');
                		tagid=tagid+1;
                		tagspanid=tagspanid+1;
                		
             	    }
             	});*/
        		 
        		 
              	   /* $("#taginclude").on("mouseup",function() {
              	   // if(e.which === 13 || e.type === 'click') {
              	    	 var tagstr=$("#taginclude").val();
              	    	if(tagstr!=''){
              	    	 var st = $('<button type="button" id="remin'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                		 var spant = $('<span id="in'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                		 spant.append(st);
                		 $('#include').append('    ');
                		 $('#include').append(spant);
                		$("#taginclude").val('');
                		tagid=tagid+1;
                		tagspanid=tagspanid+1;
              	   // 	}
                 		
              	    }
              	});*/
/* $("#taginclude").keypress(function(e) {
              	    if(e.which == 13) {
              	    	 var tagstr=$("#taginclude").val();
              	    	if(tagstr!=''){
              	    	 var st = $('<button type="button" id="remin'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                		 var spant = $('<span id="in'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                		 spant.append(st);
                		 $('#include').append('    ');
                		 $('#include').append(spant);
                		$("#taginclude").val('');
                		tagid=tagid+1;
                		tagspanid=tagspanid+1;
              	    	}
                 		
              	    }
              	});*/
  $("#tagexclude").on("mouseup",function() {
                   // if(e.which == 13) {
                         var tagstr=$("#tagexclude").val();
                        if(tagstr!=''){
                         var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                                 var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                                 spant.append(st);
                                 $('#exclude').append('    ');
                                 $('#exclude').append(spant);
                                $("#tagexclude").val('');
                                tagex=tagex+1;
                                tagspanexid=tagspanexid+1;
                //        }
                    }
                });
        		 
        		 $("#tagexclude").keypress(function(e) {
               	    if(e.which == 13) {
               	    	 var tagstr=$("#tagexclude").val();
               	    	if(tagstr!=''){
               	    	 var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                 		 var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                 		 spant.append(st);
                 		 $('#exclude').append('    ');
                 		 $('#exclude').append(spant);
                 		$("#tagexclude").val('');
                 		tagex=tagex+1;
                 		tagspanexid=tagspanexid+1;
               	    	}	
               	    }
               	});
        		
        		 function autocomplete(inp, arr) {
        				
        				  /*the autocomplete function takes two arguments,
        				  the text field element and an array of possible autocompleted values:*/
        				  var currentFocus;
        				  /*execute a function when someone writes in the text field:*/
        				  inp.addEventListener("input", function(e) {
        				      var a, b, i, val = this.value;
        				      /*close any already open lists of autocompleted values*/
        				      closeAllLists();
        				      if (!val) { return false;}
        				      currentFocus = -1;
        				      /*create a DIV element that will contain the items (values):*/
        				      a = document.createElement("DIV");
        				      a.setAttribute("id", this.id + "autocomplete-list");
        				      a.setAttribute("class", "autocomplete-items");
        				      /*append the DIV element as a child of the autocomplete container:*/
        				      this.parentNode.appendChild(a);
        				      /*for each item in the array...*/
        				      for (i = 0; i < arr.length; i++) {
        				        /*check if the item starts with the same letters as the text field value:*/
        				        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
        				          /*create a DIV element for each matching element:*/
        				          b = document.createElement("DIV");
        				          /*make the matching letters bold:*/
        				          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
        				          b.innerHTML += arr[i].substr(val.length);
        				          /*insert a input field that will hold the current array item's value:*/
        				          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
        				          /*execute a function when someone clicks on the item value (DIV element):*/
        				              b.addEventListener("click", function(e) {
        				              /*insert the value for the autocomplete text field:*/
        				              inp.value = this.getElementsByTagName("input")[0].value;
        				              /*close the list of autocompleted values,
        				              (or any other open lists of autocompleted values:*/
        				              closeAllLists();
        				          });
        				          a.appendChild(b);
        				        }
        				      }
        				  });
        				  /*execute a function presses a key on the keyboard:*/
        				  inp.addEventListener("keydown", function(e) {
        				      var x = document.getElementById(this.id + "autocomplete-list");
        				      if (x) x = x.getElementsByTagName("div");
        				      if (e.keyCode == 40) {
        				    	
        				        /*If the arrow DOWN key is pressed,
        				        increase the currentFocus variable:*/
        				        currentFocus++;
        				        
        				        
        				        
        				        /*and and make the current item more visible:*/
        				        addActive(x);
        				        
        				      } else if (e.keyCode == 38) { //up
        				        /*If the arrow UP key is pressed,
        				        decrease the currentFocus variable:*/
        				        currentFocus--;
        				        /*and and make the current item more visible:*/
        				        addActive(x);
        				      } else if (e.keyCode == 13) {
        				        /*If the ENTER key is pressed, prevent the form from being submitted,*/
        				        
        				        if (currentFocus > -1) {
        				          /*and simulate a click on the "active" item:*/
        				          if (x) x[currentFocus].click();
        				        }
        				      }
        				  });
        				  function addActive(x) {
        				    /*a function to classify an item as "active":*/
        				    if (!x) return false;
        				    /*start by removing the "active" class on all items:*/
        				    removeActive(x);
        				    if (currentFocus >= x.length) currentFocus = 0;
        				    if (currentFocus < 0) currentFocus = (x.length - 1);
        				    /*add class "autocomplete-active":*/
        				    x[currentFocus].classList.add("autocomplete-active");
        				  }
        				  function removeActive(x) {
        				    /*a function to remove the "active" class from all autocomplete items:*/
        				    for (var i = 0; i < x.length; i++) {
        				      x[i].classList.remove("autocomplete-active");
        				    }
        				  }
        				  function closeAllLists(elmnt) {
        				    /*close all autocomplete lists in the document,
        				    except the one passed as an argument:*/
        				    var x = document.getElementsByClassName("autocomplete-items");
        				    for (var i = 0; i < x.length; i++) {
        				      if (elmnt != x[i] && elmnt != inp) {
        				      x[i].parentNode.removeChild(x[i]);
        				    }
        				  }
        				}
        				/*execute a function when someone clicks in the document:*/
        				document.addEventListener("click", function (e) {
        				    closeAllLists(e.target);
/* var tagstr=$("#taginclude").val();
                        if(tagstr!=''){
                         var st = $('<button type="button" id="remin'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                                 var spant = $('<span id="in'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                                 spant.append(st);
                                 $('#include').append('    ');
                                 $('#include').append(spant);
                                $("#taginclude").val('');
                                tagid=tagid+1;
                                tagspanid=tagspanid+1;
}*/
        				
 var tagstr=$("#tagexclude").val();
                        if(tagstr!=''){
                         var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                                 var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                                 spant.append(st);
                                 $('#exclude').append('    ');
                                 $('#exclude').append(spant);
                                $("#tagexclude").val('');
                                tagex=tagex+1;
                                tagspanexid=tagspanexid+1;
                //        }
                    }
});
        				} 
        		 
        		 
        		 
        		 
        		 $.ajax({	
         			method: "POST",
         			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
         			data: { "categoryid" : 0, "choice" : "get_tags", "categorycount" : 1 }
     			})
     			.done(function( response ) {     				
     				/*var arycon=[response.join(',')];
     				console.log(arycon);*/
     				var ary=response.substring(0, response.length-1);
     				ary=ary.substring(1);
     				ary=ary.replace(/"/g, '');
     				var final=ary.split(',');
     				//autocomplete(document.getElementById("taginclude"), final);
     				autocomplete(document.getElementById("tagexclude"), final);
     			});
        		 
        		 
        		 
             	 
        		 
        		
        	});
        	
        	var btnid=1;
        	var spanid=1;
        	var categoryId=0;
        	var totalmark=0;
        	var totalcount=0;        	        
        	
        	$("#sub").click( function() {
       		 $('#noques').addClass('hidden');
       		 $('#nosub').addClass('hidden');
        		 $('#randommodal').addClass('hidden');
        		var modaledit=$('#bookId').val();
        		var editquesdup=$('#quesId').val();
        		//alert(modaledit);
        		var final='';
        		var count=0;
        		var marktotal=0;
        		var newStr='';
        		var dup='';
        		$('#divtabexp').find('a').each(function() { 
        		    var id = this.id;
        		    var valstr=$('#'+id).attr('value');
        		     newStr=newStr+valstr;
        		
        		    // do whatever...
        		});
        		var chkvalues='';
        		$('.messageCheckbox:checked').each(function(){        
        			chkvalues = $(this).val();
        		});
if(chkvalues!=''){
        		newStr = newStr.substring(0, newStr.length-1);
        		var arr=newStr.split(',');
        		var editexist=editquesdup.split(',');
        		 $('.messageCheckbox:checked').each(function(){        
        		        var values = $(this).val();
        		        if(modaledit!='' && modaledit!='Rand'){
        		        	 if($.inArray(values, editexist) != -1){
        		        	 var marks = $(this).attr('name');
             		        final =final+values+',';
             		        marktotal= +marktotal + +marks;
//             		    arr.push({values});    
             		      count= count+1;
             		    // alert(final);
        		        	 }
        		        	 else{
        		        		  if($.inArray(values, arr) == -1){
        	        		        	 var marks = $(this).attr('name');
        	             		        final =final+values+',';
        	             		        marktotal= +marktotal + +marks;
//        	             		    arr.push({values});    
        	             		      count= count+1;
        	             		    // alert(final);
        	        		        	
        	        		        }
        	        		        else{
        	        		        	dup='true';
        	        		        }
        		        	 }
        		        }
        		        else{
        		        if($.inArray(values, arr) == -1){
        		        	 var marks = $(this).attr('name');
        		        	 if(modaledit=='Rand'){
        		        		 values=values;
        		        	 }
             		        final =final+values+',';
             		        marktotal= +marktotal + +marks;
//             		    arr.push({values});    
             		      count= count+1;
             		    // alert(final);
        		        	
        		        }
        		        else{
        		        	dup='true';
        		        }
        		        }
        		        
        		    });
        		
        		
        		 
        		var total= $('#classTable1').find('tr').length;
        		
        		if(modaledit!='' && modaledit!='Rand'){
        			$('#'+modaledit).html(count);
        			$('#'+modaledit).attr("value",final);
        			 $('#confirmActionModal').modal('hide');
        			 $('#'+modaledit+'mark').html(count);
        			 $(".modal-body #bookId").val('');
        			 var newStr='';
        			 $('#divtabexp').find('a').each(function() { 
             		    var id = this.id;
             		    var valstr=$('#'+id).attr('value');
             		     newStr=newStr+valstr;
             		
             		    // do whatever...
             		});
             		
             		newStr = newStr.substring(0, newStr.length-2);
             		var quesarray = newStr.split(",");
             		totalmark=quesarray.length;
             		totalcount=quesarray.length;
             		//alert('mark'+totalmark);
             		 $("#totm").html(totalmark);
        			 $("#totc").html(totalcount);
        		}
        		
        		else{
        			if($("#type").val()=='R'){
            			//if($.inArray(categoryId+'@'+$('#quizcount').val(), randomqus) != -1){
            				//randomqus.push(categoryId+'@'+$('#quizcount').val());
            				
            			//}
            			// $("#type").val('P');
        				 $("#bankcount").val('');
        				 //$("#quizcount").val('');
        				// $('#randomselect').addClass('hidden');
            			//alert(randomqus);
        				 
           		}
        		 /*var s = $('<button type="button" id="rem'+btnid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
        		 var span = $('<span id="span'+spanid+'" class="tag label label-info" value='+final+'>'+selstring+'</span>');
        		 span.append(s);
        		 $('<div id="div1">hello</div>').appendTo('#parent');
        		 $('#div1').append('    ');
        		 $('#div1').append(span);*/
        		 $('#confirmActionModal').modal('hide');
        		 $('#pickQuestion').removeClass('hidden');
        		 if(spanid==1){
        			 var table_body2 = '<table id="tab2" style="margin:auto;" width="80%" border="1">';
        		 }
        		 var number_of_rows = 2;
                 var number_of_cols = 4;
                
                 var table_body = '<table id="tab1" style="margin:auto;" width="80%" border="1">';
                 
                 for(var i=0;i<number_of_rows;i++){
                   table_body+='<tr>';
if(i==0){
	 table_body +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
     table_body +='<span id="sec" style="font-size: 2.0em;color: blue">'+spanid+'</span> <span>COURSES</span>';
     table_body +='</td>';
     
     table_body +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
     table_body +='<span id="ski" style="font-size: 2.0em;color: blue">'+spanid+'</span> <span>SECTIONS</span>';
     table_body +='</td>';
     
     table_body +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
     table_body +='<span  id="totc" style="font-size: 2.0em;color: blue">'+totalcount+'</span> <span>QUESTIONS</span>';
     table_body +='</td>';
     
     /*table_body +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
     table_body +='<span  id="totm" style="font-size: 2.0em;color: blue">'+totalmark+'</span> <span>MARKS</span>';
     table_body +='</td>';*/
 }
                   
                   table_body+='</tr>';
                 }
                   table_body+='</table>';
                   $('#divtab').removeClass('hidden');
                  $('#divtab').html(table_body);
        		 
        		 
if(spanid!=1){
	var table_body2='';
}
        		
        			             
        		    if(spanid==1){
        		    	table_body2+='<tr>'; 
        		    	 table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		         table_body2 +='Course Name';
        		         table_body2 +='</td>';
        		         
        		         table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='No.Of.Questions';
        		         table_body2 +='</td>';
        		         
        		         table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='Selected Questions';
        		         table_body2 +='</td>';
        		   /*      
        		         table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='Marks';
        		         table_body2 +='</td>';*/
        		        
        		         
        		         table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='Delete';
        		         table_body2 +='</td>';
        		         table_body2+='</tr>';
        		     }
        		    table_body2+='<tr id="'+categoryId+del+'TR'+'">'; 
        		    for(var j=0;j<4;j++){
        		    	 
        		 	   if(j==0){
        		 		   table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		 	        table_body2 +=selstring;
        		 	        table_body2 +='</td>';
        		 	   }
        		 if(j==1){
        		 	table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		     table_body2 +=total;
        		     table_body2 +='</td>';
        		 	   }
        		 
        		 if(j==2){
        			
        		 	table_body2 +='<td  height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		     table_body2 +='<a id="'+categoryId+'"value="'+final+'"href=#>'+count+'</a>';
        		     table_body2 +='</td>';
        		 }
        		 
        		 if(j==3){
         		 	table_body2 +='<td id="'+categoryId+'delete'+'" height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
         		     table_body2 +='<span style="cursor: pointer;" onClick="deletebuton('+categoryId+','+del+');" ><i class="fa fa-trash" aria-hidden="true"></i></span>';
         		     table_body2 +='</td>';
         		    del=del+1;
         		 }
        		    }
        		                       
        		                       table_body2+='</tr>';
        		                    
        		 if(spanid==1){
        		                       table_body2+='</table>';
        		                       $('#divtabexp').removeClass('hidden');
        		                      $('#divtabexp').html(table_body2);
        		                     //$('<div><h5 style="padding-top:5px">Tag</h5></div><div id="include"><input id="taginput" style=" border: 1px solid lightgrey;" type="text"  placeholder="tags"></div><div>').appendTo('#divtabexp');
        		                      
        		 }
        		 if(spanid!=1){
            		 $("#tab2").append(table_body2);
            		 }
        		 btnid=btnid+1;
        		 spanid=spanid+1;
        		 var newStrs='';
        		 $('#tab2').find('a').each(function() { 
        		    var ids = this.id;
        		    var valstr=$('#'+ids).attr('value');
        		     newStrs=newStrs+valstr;
        		
        		    // do whatever...
        		});
        		
        		newStrs = newStrs.substring(0, newStrs.length-2);
        		
        			var totalmarks=0;
        			var totalcounts=0;
        		
        		if(newStrs!=''){
        		var quesarrays = newStrs.split(",");
        		
        		var totalmarks=quesarrays.length;
        		var totalcounts=quesarrays.length;
        		}
        		
        		 $("#totm").html(totalmarks);
        		 $("#totc").html(totalcounts);
        		 var totaltr= $('#tab2').find('tr').length-1;
        		 
        		 $("#sec").html(totaltr);
        		 $("#ski").html(totaltr);
        		}
        		//alert(dup);
        		 if(dup=='true'){
        			 $('#duphead').remove();
        			 $('#randsel').remove();
            		 $('<h5 id="duphead" style="color:red">Duplicate questions have been removed in "'+selstring+'" section</h5>').appendTo('#divduplicate');
            		 $('#divduplicate').removeClass('hidden');
            		 }
        		/* $('#editques').click(function(){
               		//get the category id from last non empty dropdown
               		var categoryId = $(#editques).attr('value');
               		
               		alert(categoryId);
               		//Fetch the quiz questions from categoryid and show in modal with required form elements
               		$.ajax({	
               			method: "POST",
               			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
               			data: { "categoryid" : categoryId, "choice" : "get_questions"}
           			})
           			.done(function( response ) {
           				console.log(response);
           				 $("#classTable1").html("<tbody>"+response+"</tbody>");
           				// $(".modal-body").html(response);
           				//$('#confirmActionModal .modal-body tbody').append();
           				$('#confirmActionModal').modal('show');
           			});
               		
               	});	*/
        		 $(".modal-body #bookId").val('');
        		 $('#courserem').remove();
        		 $('#sectionrem').remove();
        	}
else{
	
	 $('#nosub').removeClass('hidden');
}
     	});
        	
        	
        	$("#subtag").click( function() {
        		 taginput=$('#taginput').val();
        		alert(taginput);
        		$.ajax({	
        			method: "POST",
        			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
        			data: { "choice" : "check_tag", "categorycount" : 1,"tag" : taginput}
    			})
    			.done(function( response ) {    				
    				if(response=='False'){
    					$('#modalh').remove();
    					$('#tagActionModal .modal-body').append('<h5 id="modalh" style="color:red">Tag already exist !!</h5>');
    				}
    				else{
    					$('#modalh').remove();
    					$('#tagActionModal').modal('hide');
    					 var newStr='';
    		        		$('#divtabexp').find('a').each(function() { 
    		        		    var id = this.id;
    		        		   
    		        		    var valstr=$('#'+id).attr('value');
    		        		  
    		        		     newStr=newStr+valstr;
    		        		   
    		        		     
    		        		    // do whatever...
    		        		});
    		        		 
    		        		
    		        		    var taginput=$('#taginput').val();
    		        	
    		        		var courseid = 0;
    		        		newStr = newStr.substring(0, newStr.length-1);
    		        		//tags = tags.substring(0, tags.length-1);
    		        	//	alert(newStr);
    		        		$.ajax({	
    		        			method: "POST",
    		        			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
    		        			data: { "arystring" : newStr, "choice" : "save_VPLquestions", "categorycount" : 1,"tag" : taginput,"course":courseid}
    		    			})
    		    			.done(function( response ) {    		    				    		    			
    		    					 $('.select1').prop("selectedIndex", 0);
    		    		     	       $('.categorydropdown1').nextAll().remove();
    		    		     	       $('.questionsAddbuttonsdiv').addClass('hidden');
    		    		     	      $('#divtab').addClass('hidden');
    		    		     	       $('#divtabexp').addClass('hidden');
    		    		     	      $('#pickQuestion').addClass('hidden');
    		    		     	      tagid=1;
    		    		     	            	 tagspanid=1;
    		    		     	            	 tagex=1;
    		    		     	             tagspanexid=1;
    		    		     	             btnid=1;
    		    		     	        	 spanid=1;
    		    		     	        	 categoryId=0;
    		    		     	        	 totalmark=0;
    		    		     	        	 totalcount=0;
    		    		     	        	 
    		    		     	        	$('#exclude').find('span').each(function() { 
    		    		            		    var tagids = this.id;
    		    		            		    $('span[id^="'+tagids+'"]').remove();
    		    		            		});
    		    		            		 
    		    		            		 $('#include').find('span').each(function() { 
    		    		            		    var tagids = this.id;
    		    		            		    $('span[id^="'+tagids+'"]').remove();
    		    		            		});
    		    		            		 $('#startdiv').addClass('hidden');
    		    		            		 if(response==''){
    		    		            		 $('<h4>Selected HandsOn Successfuly uploaded</h4>').appendTo('#resp');
    		    		            		 }
    		    		            		 else{
    		    		            			 $('<h4 style="color:red";>'+response+'</h4>').appendTo('#resp');
    		    		            		 }
    		    		            		 
    		    		            		 $('<div class="text-center"><button type="button" id="returnbank" class="btn btn-primary">Retun to bank</button><button type="button" id="returnquiz" class="btn">Return to Course</button></div>').appendTo('#resp');
    		    		            		 $('#resp').removeClass('hidden');
    		    		            		 
    		    		            		 
        		    		            		 
    		    		            		 $("#returnbank").click( function() {
    		    		                 		window.location.reload();
    		    		                 	});
    		    		                 	$("#returnquiz").click( function() {
    		    		                 		window.location.href = quizurl+"?id="+courseid;
    		    		                 	});
    		    		            		 
    		    		            		 
    		    		            		
    		    				
    		    			});
    		        		
        		
    			}
			});
    		
    	});
        		        	        	        	
        	$("#cancel").click( function() {        		
        		$('#divduplicate').addClass('hidden');
        		 $('.select1').prop("selectedIndex", 0);
	     	       $('.categorydropdown1').nextAll().remove();	     	       
	     	      $('#divtab').addClass('hidden');
	     	     if($("#type").val()=='R') {
	     	    	$('#randomQuestion').addClass('uploadquestionsAddbuttonsdiv hidden');
	     	     } else {
	     	    	$('.questionsAddbuttonsdiv').addClass('hidden');
	     	     }
	     	       $('#divtabexp').addClass('hidden');
	     	      $('#pickQuestion').addClass('hidden');
	     	      tagid=1;
	     	            	 tagspanid=1;
	     	            	 tagex=1;
	     	             tagspanexid=1;
	     	             btnid=1;
	     	        	 spanid=1;
	     	        	 categoryId=0;
	     	        	 totalmark=0;
	     	        	 totalcount=0;
	     	        	 
	     	        	$('#exclude').find('span').each(function() { 
	            		    var tagids = this.id;
	            		    $('span[id^="'+tagids+'"]').remove();
	            		});
	            		 
	            		 $('#include').find('span').each(function() { 
	            		    var tagids = this.id;
	            		    $('span[id^="'+tagids+'"]').remove();
	            		});
	            		 $("#type").val('P');
        				 $("#bankcount").val('');
        				// $("#quizcount").val('');
        				 $('#randomselect').addClass('hidden');
        				 
        				 $('#coursealreadyexists').find('span').each(function() { 
	            		    var tagids = this.id;
	            		    $('span[id^="'+tagids+'"]').remove();
	            		});
        				 $('#coursefullname').val('');
        				 $('#courseshortname').val('');
        				 $('#assessmentduration').val('');
      	      
      	});
        	
        	
        	$("#reset").click( function() {
        		$("#quizdiv").prop('checked', false);        		
        		$('#divduplicate').addClass('hidden');
     	       $('.select1').prop("selectedIndex", 0);
     	       $('.categorydropdown1').nextAll().remove();     	       
     	      $( "#divtabexp" ).empty();  
     	     $('#divtabexp').addClass('centered hidden');
     	    $('#randomQuestion').addClass('uploadquestionsAddbuttonsdiv hidden');
     	   $('#pickQuestion').addClass('uploadquestionsAddbuttonsdiv hidden');
     	     $('.questionsAddbuttonsdiv').addClass('hidden');     	     
     	      $("#type").val('P');
     	     $('#exclude').find('span').remove();
				 $("#bankcount").val('');
				// $("#quizcount").val('');
				 $('#randomselect').addClass('hidden');
					$("#courserem").remove();
					$("#sectionrem").remove();
					$("#randomdiv").attr("hidden",true);
					$("#coursename").val('');
					$("#sectiondescription").val('');
					$("#quizsectionname").val('');
					$("#vplsectionname").val('');
					$("#courseshortname").val('');
					$("#assessmentduration").val('');
					$("#duration").val('');
					$("#coursecount").val('');
					$("#created").css("display","none");
     	});
        	
        	
        	$("#addquestionquiz").click( function() {
        		//var categoryid = url.substring();        		
        		var courseshortname = $('#courseshortname').val();
        		var duration = $('#assessmentduration').val();
        		var newStr='';
        		$('#divtabexp').find('a').each(function() { 
        		    var id = this.id;
        		   
        		    var valstr=$('#'+id).attr('value');
        		  
        		     newStr=newStr+valstr;
        		   
        		     
        		    // do whatever...
        		});
        		
        		
        		newStr = newStr.substring(0, newStr.length-1);
        		categoryId = url.substring(url.indexOf("categoryid=") + 11);
        		$.ajax({	
        			method: "POST",
        			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
        			data: { "arystring" : newStr, "choice" : "save_VPLquestions", "categoryid":categoryId,"courseshortname":courseshortname,"duration":duration}
    			})
    			.done(function( response ) {    				
    				if(response.includes("Course name already exists")) {
   					 $('<span id="alertspan"><center><font style="color:red"><b>Course name already exists</b></font></center></span>').appendTo('#coursealreadyexists');
   				}
   				else {
   					window.location.href = quizurl+"?id="+response;
   				}
    			});
        		
        		
        		//lets build the first category dropdown
        		 /*$('#duphead').remove();
    			 $('#randsel').remove();
        		 $('#divduplicate').addClass('hidden');
        		
        		
        		$('#tagActionModal').modal({backdrop: 'static', keyboard: false});
        		$('#tagActionModal').modal('show');*/
        		
 
        	});
        	
        	$("#canceltag").click( function() {
        		//lets build the first category dropdown
        		$('#taginput').val('');
        		$('#modalh').remove();
                
        	});
        	 
        	$("#quizdiv").click(function(){
                if($(this).prop("checked") == true){
                	$("#tagdiv").css("display","none");
                	$("#pickdiv").css("display","none");
                }
                else if($(this).prop("checked") == false){
                	$("#tagdiv").css("display","block");
                	$("#pickdiv").css("display","block");
                }
            });
        	
        	var tag_count = 0;
        	var id_count = 0;
        	var table_body2 = '<table id="tag_table" style="margin:auto;" width="80%" border="1">';
        		table_body2+='<tbody>';
	   			table_body2+='<tr>'; 
	   			table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
	   			table_body2 +='Course Name';
	   			table_body2 +='</td>';
        
	   			table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
	   			table_body2 +='Tags';
	   			table_body2 +='</td>';
        
	   			table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
	   			table_body2 +='Question Count';
	   			table_body2 +='</td>';
 
	   			table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
	   			table_body2 +='Delete';
	   			table_body2 +='</td>';
	   			table_body2+='</tr>';
	   			table_body2+='</tbody>';
	   			table_body2+='</table>';
        	
        	//Implement Add questions click functionality
        	$('#addquestion').click(function(){
        		$('#divduplicate').addClass('hidden');
        		 $('#randommodal').addClass('hidden');
        		 $('#noques').addClass('hidden');
        		 $('#nosub').addClass('hidden');
        		//get the category id from last non empty dropdown
        		 categoryId = 0;
        		 var sectionid=0;
        		 var courseId = 0;        		         		 
        		
        	   if($( "#dropone1").length){
        			 
        			 if($( "#dropone1 option:selected" ).val()!=''){
        			 
        				 //categoryId= $( "#courseone1 option:selected" ).val();
        				 categoryId= $( "#courseone1 option:selected" ).val();
        			 }
        		 }
        		 
        		 
        		 
        		 if($( "#courseone1").length){
        			 
        			 if($( "#courseone1 option:selected" ).val()!=''){
        			 
        				 //categoryId= $( "#courseone1 option:selected" ).val();
        				 courseId= $( "#courseone1 option:selected" ).val();
        			 }
        		 }
        		 
        		 
        		 
        		 if($( "#sectionone2").length){
        			 
        			 if($( "#sectionone2 option:selected" ).val()!=''){
        			 
        				 sectionid= $( "#sectionone2 option:selected" ).val();
        			 }
        		 }
        		
        		
        		 var extag='';
        		 $('#exclude').find('span').each(function() { 
        		    var tagids = this.id;
        		    if(tagids!=''){
        		    var tagstr=$('#'+tagids).text();
        		    tagstr = tagstr.substring(0, tagstr.length-1);
        		    extag=extag+tagstr+',';
        		    }
        		    
        		
        		    // do whatever...
        		});
        		 extag = extag.substring(0, extag.length-1);
        		 var intag='';
        		
        		var count = 0;
        		 if($("#type").val()=='R') {
        			 var b= $("#bankcount").val();
        			 if(b=='') {
        				 count = 0;
  					 }
   				    else {
   				    	count = b;
   				    }   				    
        		 }
        		 
        		 if($("#quizdiv").prop("checked") == true){        			
                 	$.ajax({	
             			method: "POST",
             			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',             			        			
             			data: {"choice" : "check_quizavailability","section" : sectionid,"course":courseId}
         			})
         			.done(function( response ) {    				
         				if(response == "success"){
         					$("#quizdiv").prop('checked', false);
                         	$("#tagdiv").css("display","block");
                         	$("#pickdiv").css("display","block");
         					if ($("#divtabexp").find("#tag_table").length > 0){             		 
         						tag_count = $('#tag_table tr').length;            		           		             		
         					} else {
         						tag_count = 0;
         					}
                       	             	             	                    	 
                    	     var div = $("#randomdiv").removeAttr("style");  
                    	     var table = $("#randomtable").removeAttr("style");
                    	     var table = $("#createcourse").removeAttr("style");
                    	     
                    	   var coursedetail = {};         	   
                    	   var courseName = $("#courseone1 option:selected" ).text();         	   
                    	   		coursedetail['courseid'] = courseId;
                    	   		coursedetail['sectionid'] = sectionid;
                    	   		coursedetail['tag'] = {};
                    	   		coursedetail['tag']['quiz'] = 'Quiz';
                    	   		       	   		
                    	   		tag_count += 1;  		         	   		
                    	   		id_count += 1;
                    	   		
                    	   		tablearray[id_count] = coursedetail;
                    	   	
                    	   		table_body3 ='<tr id="'+id_count+'">'; 
           	   				table_body3 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
           	   				table_body3 +=courseName;
           	   				table_body3 +='</td>';
                
           	   				table_body3 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
           	   				table_body3 +='Quiz';
           	   				table_body3 +='</td>';
                
           	   				table_body3 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
           	   				table_body3 +='-';
           	   				table_body3 +='</td>';

           	   				table_body3 +='<td height="50" style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
           	   				var temp = '<span style="cursor: pointer;" onclick="delete_tag('+id_count+');">';
           	   				table_body3 += temp;
           	   				table_body3 +='<i class="fa fa-trash" aria-hidden="true"></i></span></td>';
           	   				table_body3 +='</tr>';	   					   			
           	   				
                    	   		if(tag_count == 1) {         	   			         	   			         	   			
                    	   			$('#divtabexp').removeClass('hidden');
                    	   			$('#divtabexp').html(table_body2);
                    	   			$('#tag_table').find('tbody').append(table_body3);
                    	   			$('#randomQuestion').removeClass('hidden');
                    	   		} else if(tag_count == 0) {
                    	   			$('#divtabexp').addClass('centered hidden');
                    	   			$('#randomQuestion').addClass('uploadquestionsAddbuttonsdiv hidden');
                    	   		} else {
                    	   			$('#tag_table').find('tbody').append(table_body3);
                    	   		}
         				} else {
         					if(response === "failure"){
         						var detail = '<label>Quiz is not available.</label>';    
             					$("#errorCancel").text("OK");
             					$("#errorOk").css("display","none");
                        		$('#errorRegister').html(detail);
                        		$('#confirmActionModalTitle').text("Confirmation");
                 				$('#errorModal').modal('show');
         					} else {
         						data = $.parseJSON(response);
         						var detail = '';
         						$.each(data, function (i,v){
         							detail += '<label>'+v+': Questions are in System level.</label><br>';
         						});
         						$("#errorCancel").text("OK");
             					$("#errorOk").css("display","none");
                        		$('#errorRegister').html(detail);
                        		$('#confirmActionModalTitle').text("Confirmation");
                 				$('#errorModal').modal('show');
         					}
         					
         				}
         			});
                 } else {                	 
                	 if($("#type").val() =='P') {
                    	 $.ajax({	
                 			method: "POST",
                 			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',                 			      		
                 			data: {"type":$("#type").val(),"count":count,"course":courseId,"categoryid" : categoryId,"choice" : "get_questions","section" : sectionid,"include":extag,"exclude":intag}
             			})
             			.done(function( response ) {    				
             				if(response.includes("No ques")){
         		   					 $("#classTable1").html("<tbody>"+response+"</tbody>");
         		   					 $('#confirmActionModal').modal('show');
         		       				 $('#noques').removeClass('hidden');
            				   }
            			    else{
            			    	$("#classTable1").html("<tbody>"+response+"</tbody>");
            			        $('#confirmActionModal').modal('show');
            			    }
             			});
                     } else {
                    	 var randomcount = $('#bankcount').val();
                    	 var flag = 0;
                    	 var resultCount = 0;
                    	 $.ajax({	
                 			method: "POST",
                 			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
                 			data: 
                 			{ 
                 				"choice" : "check_VPLquestions",
                 				"course" : courseId,
                 				"section" : sectionid,  
                 				"type" : extag,
                 				"count" : randomcount
                 			}
             			}).done(function( response ){
             				if(response !== "success"){
             					var detail = '<label><b>Tags: </b>'+extag+'</label><br>';
             					detail += '<label><b>Required number of questions: </b>'+randomcount+'</label><br>';
             					detail += '<label><b>Available number of questions: </b>'+resultCount+'</label>';     					
                        		$('#errorRegister').html(detail);
                        		$('#confirmActionModalTitle').text("Confirmation");
                 				$('#errorModal').modal('show');
             				} else {
             					if ($("#divtabexp").find("#tag_table").length > 0){             		 
             						tag_count = $('#tag_table tr').length;            		           		             		
             					} else {
             						tag_count = 0;
             					}
                           	             	             	                    	 
                        	     var div = $("#randomdiv").removeAttr("style");  
                        	     var table = $("#randomtable").removeAttr("style");
                        	     var table = $("#createcourse").removeAttr("style");
                        	     
                        	   var coursedetail = {};         	   
                        	   var courseName = $("#courseone1 option:selected" ).text();         	   
                        	   coursedetail['courseid'] = courseId;
                        	   		coursedetail['sectionid'] = sectionid;
                        	   		coursedetail['tag'] = {};  
                        	   		$('#exclude').find('span').each(function() { 
                        	   			var tagids = this.id;
                        	   			if(tagids!=''){
                        	   				var tagstr=$('#'+tagids).text();
                        	   				tagstr = tagstr.substring(0, tagstr.length-1);
                        	   				coursedetail['tag'][tagstr] = $("#bankcount").val();
                        	   			}
                        	   		});
                        	   		         	   		
                        	   		tag_count += 1;  		         	   		
                        	   		id_count += 1;
                        	   		
                        	   		tablearray[id_count] = coursedetail;
                        	   	
                        	   		table_body3 ='<tr id="'+id_count+'">'; 
               	   				table_body3 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
               	   				table_body3 +=courseName;
               	   				table_body3 +='</td>';
                    
               	   				table_body3 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
               	   				table_body3 +=extag;
               	   				table_body3 +='</td>';
                    
               	   				table_body3 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
               	   				table_body3 +=$("#bankcount").val();
               	   				table_body3 +='</td>';

               	   				table_body3 +='<td height="50" style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
               	   				var temp = '<span style="cursor: pointer;" onclick="delete_tag('+id_count+');">';
               	   				table_body3 += temp;
               	   				table_body3 +='<i class="fa fa-trash" aria-hidden="true"></i></span></td>';
               	   				table_body3 +='</tr>';	   					   			
               	   				
                        	   		if(tag_count == 1) {         	   			         	   			         	   			
                        	   			$('#divtabexp').removeClass('hidden');
                        	   			$('#divtabexp').html(table_body2);
                        	   			$('#tag_table').find('tbody').append(table_body3);
                        	   			$('#randomQuestion').removeClass('hidden');
                        	   		} else if(tag_count == 0) {
                        	   			$('#divtabexp').addClass('centered hidden');
                        	   			$('#randomQuestion').addClass('uploadquestionsAddbuttonsdiv hidden');
                        	   		} else {
                        	   			$('#tag_table').find('tbody').append(table_body3);
                        	   		}
             				}
             			});            	            	 
                     	} 
                 }        		              
        	});
        	
        	$(document).on("click","#errorOk",function() { 
        		
				$("#errorModal").modal("hide");    				
				$("#confirmActionModalTitle").text("");
				
				var extag='';
       		 	$('#exclude').find('span').each(function() { 
       		 		var tagids = this.id;
       		 		if(tagids!=''){
       		 			var tagstr=$('#'+tagids).text();
       		 			tagstr = tagstr.substring(0, tagstr.length-1);
       		 			extag=extag+tagstr+',';
       		 		}       		
       		 	});
       		 	extag = extag.substring(0, extag.length-1);
				
				if ($("#divtabexp").find("#tag_table").length > 0){             		 
           		 	tag_count = $('#tag_table tr').length;            		           		             		
           	 	} else {
           	 		tag_count = 0;
           	 	}
				
				var randomcount = $('#bankcount').val();      	             	 
				var courseId= $( "#courseone1 option:selected" ).val();
				var sectionid= $( "#sectionone2 option:selected" ).val();
				
        	     var div = $("#randomdiv").removeAttr("style");  
        	     var table = $("#randomtable").removeAttr("style");
        	     var table = $("#createcourse").removeAttr("style");
        	     
        	   var coursedetail = {};         	   
        	   var courseName = $("#courseone1 option:selected" ).text();         	   
        	   coursedetail['courseid'] = courseId;
        	   		coursedetail['sectionid'] = sectionid;
        	   		coursedetail['tag'] = {};  
        	   		$('#exclude').find('span').each(function() { 
        	   			var tagids = this.id;
        	   			if(tagids!=''){
        	   				var tagstr=$('#'+tagids).text();
        	   				tagstr = tagstr.substring(0, tagstr.length-1);
        	   				coursedetail['tag'][tagstr] = $("#bankcount").val();
        	   			}
        	   		});
        	   		         	   		
        	   		tag_count += 1;  		         	   		
        	   		id_count += 1;
        	   		
        	   		tablearray[id_count] = coursedetail;
        	   	
        	   		table_body3 ='<tr id="'+id_count+'">'; 
	   				table_body3 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
	   				table_body3 +=courseName;
	   				table_body3 +='</td>';
    
	   				table_body3 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
	   				table_body3 +=extag;
	   				table_body3 +='</td>';
    
	   				table_body3 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
	   				table_body3 +=$("#bankcount").val();
	   				table_body3 +='</td>';

	   				table_body3 +='<td height="50" style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
	   				var temp = '<span style="cursor: pointer;" onclick="delete_tag('+id_count+');">';
	   				table_body3 += temp;
	   				table_body3 +='<i class="fa fa-trash" aria-hidden="true"></i></span></td>';
	   				table_body3 +='</tr>';	   					   			
	   				
        	   		if(tag_count == 1) {         	   			         	   			         	   			
        	   			$('#divtabexp').removeClass('hidden');
        	   			$('#divtabexp').html(table_body2);
        	   			$('#tag_table').find('tbody').append(table_body3);
        	   			$('#randomQuestion').removeClass('hidden');
        	   		} else if(tag_count == 0) {
        	   			$('#divtabexp').addClass('centered hidden');
        	   			$('#randomQuestion').addClass('uploadquestionsAddbuttonsdiv hidden');
        	   		} else {
        	   			$('#tag_table').find('tbody').append(table_body3);
        	   		}
        	   		
			});
        	
        	$("#createCourse").click(function(){
        		if ($("#divtabexp").find("#tag_table").length > 0){ 
           		            		            		
           		 var arr = [];
           		 $("#tag_table tr").each(function() {
           			 if(this.id != ""){
           				arr.push(this.id); 
           			 }           			 
           		 });               		 
           		 var final_array = {};           		 
           		 $.each( tablearray, function( key, value ) {
           			 var temp = key.toString();             			
           			 if(jQuery.inArray(temp, arr) !== -1){
           				final_array[key] = tablearray[key];
           			 }
           		 });           		 
           	 	}
        		
        		var courseshortname = $('#coursename').val();
        		var sectiondescription = $("#sectiondescription").val();
        		var quizsectionname = $("#quizsectionname").val();
				var vplsectionname = $("#vplsectionname").val();
        		var duration = $('#duration').val();
        		var coursecount = $('#coursecount').val();

        		var jsonString = JSON.stringify(final_array);
        		categoryId = url.substring(url.indexOf("categoryid=") + 11);
        		
        		$.ajax({	
        			method: "POST",
        			url: M.cfg.wwwroot + '/local/coursefiltering/ajax.php',
        			data: 
        			{ 
        				"choice" : "save_random_VPLquestions",
        				"categoryid":categoryId,
        				"criteria":jsonString,
        				"courseshortname":courseshortname,
        				"sectiondescription":sectiondescription,
        				"quizsectionname":quizsectionname,
        				"vplsectionname":vplsectionname,
        				"duration":duration,
        				"course_count":coursecount
        			}
    			})
    			.done(function( response ) {    				
    				var final = [];
					data = $.parseJSON(response);
					var count = 0;
					var table_body2 = '';
                    $.each(data, function (i,v){                            
                        if(i.includes("error_")){
                        	table_body2 +='<table id="result_table" style="margin:auto;" width="80%" border="1">';
                    		table_body2 +='<tbody>';
            	   			table_body2 +='<tr>';                 	   			
                    
            	   			table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
            	   			table_body2 +='Tags';
            	   			table_body2 +='</td>';
                    
            	   			table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
            	   			table_body2 +='Details';
            	   			table_body2 +='</td>';
            	   			table_body2 +='</tr>';     
                    		var j = 0;                        		                        		
                    		for(j=0;j<v.length;j++){                        			
                    			var tagName = '';
                        		$.each(v[j][0]['tag'], function (tag,tagcount){                                			
                        			tagName += tag+',';
                        		});              
                        		var error = v[j][1];
                        		table_body2 +='<tr>'; 
                            	table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
                            	table_body2 +=tagName;
                            	table_body2 +='</td>';
                            	
                            	table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
                            	table_body2 +=error;
                            	table_body2 +='</td>';
                            	table_body2 +='</tr>';
                    		}
                    		table_body2 +='</tbody>';
            	   			table_body2 +='</table>';                    		                    		
                        } else {
                        	var course = i.split(":");
                        	var courseName = course[0];
                        	var courseId = course[1];
                        	var courseURL = M.cfg.wwwroot+'/course/view.php?id='+courseId;
                        	if(count == 0){
                            	table_body2 += '<table id="result_table" style="margin:auto;" width="80%" border="1">';
                        		table_body2 +='<tbody>';
                	   			table_body2 +='<tr>'; 
                	   			table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
                	   			table_body2 +='Course Name';
                	   			table_body2 +='</td>';
                        
                	   			table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
                	   			table_body2 +='Tags';
                	   			table_body2 +='</td>';
                        
                	   			table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
                	   			table_body2 +='Details';
                	   			table_body2 +='</td>';
                	   			table_body2 +='</tr>';                    	   			
                            }
                        	                        	                        
                        	if(v.length == 1){
                        		var tagName = '';
                        		table_body2 +='<tr>'; 
                            	table_body2 +='<th style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
                            	table_body2 +='<a href="'+courseURL+'">'+courseName+'</a>';
                            	table_body2 +='</th>';
                            	
                        		$.each(v[0][0]['tag'], function (tag,tagcount){                                			
                        			tagName += tag+',';
                        		});
                        		tagName = tagName.substring(0, tagName.length-1);
                        		table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
                            	table_body2 +=tagName;
                            	table_body2 +='</td>';
                 
                            	table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
                            	table_body2 += v[0][1];
                            	table_body2 +='</td>';   
                            	table_body2 +='</tr>';
                        	} else {
                        		var j = 0;     
                        		table_body2 +='<tr>'; 
                            	table_body2 +='<td rowspan="'+v.length+'" style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
                            	table_body2 +='<a href="'+courseURL+'">'+courseName+'</a>';
                            	table_body2 +='</td>';                            	                            	
                        		for(j=0;j<v.length;j++){
                        			var tagName = '';                                		
                            		$.each(v[j][0]['tag'], function (tag,tagcount){                                			
                            			tagName += tag+',';
                            		}); 
                            		if(j != 0){
                            			table_body2 +='<tr>';
                            		}
                            		tagName = tagName.substring(0, tagName.length-1);
                            		table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
                        			table_body2 +=tagName;
                                	table_body2 +='</td>';                              
                                	table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
                        			table_body2 +=v[j][1];
                                	table_body2 +='</td>';
                                	table_body2 +='</tr>';
                        		}                                                		                        		                        			                                                		
                        	}                        	                        	
                        	
                        	if(coursecount == count+1){
                        		table_body2 +='</tbody>';
                	   			table_body2 +='</table>';
                        	}
                        }                                                        
                        count += 1;
                    });
                    
                    if(table_body2 != ''){
                    	$('#divduplicate').addClass('hidden');
              	      	$('.select1').prop("selectedIndex", 0);
              	      	$('.categorydropdown1').nextAll().remove();     	       
              	      	$( "#divtabexp" ).empty();              	      	
              	      	$('#randomQuestion').addClass('uploadquestionsAddbuttonsdiv hidden');
              	      	$('.questionsAddbuttonsdiv').addClass('hidden');     	     
              	      	$("#type").val('P');
              	      	$('#exclude').find('span').remove();
         				$("#bankcount").val('');         				
         				$('#randomselect').addClass('hidden');
         				$("#courserem").remove();
         				$("#sectionrem").remove();
         				$("#randomdiv").attr("hidden",true);
         				$("#coursename").val('');
         				$("#sectiondescription").val('');
         				$("#quizsectionname").val('');
    					$("#vplsectionname").val('');
    					$("#duration").val('');
    					$("#coursecount").val('');
         	   			$('#divtabexp').html(table_body2);
         	   			$("#created").css("display","block");
                    }
    			});
        	});
        	
        	$("#cancelCourse").click(function(){
        		document.location.reload();
        	});
        	
        	$("#createOK").click(function(){
        		document.location.reload();
        	});
        }
     };
});
//fuction to sort select elements 
var tagid=1;

var coursemodule;
var quizurl;
var quizorgid;
var randomqus=[];
var bool=[];
var del=1;

        	var tagspanid=1;
        	var tagex=1;
        	var tagspanexid=1;
        	
function clickno(){
	
	$('#tagActionModal').find(".modal-footer").show();
		$('#tagActionModal .modal-body2').find("#taginput").show();
		$('#tagActionModal .modal-body2').find("#taginput").show();
		$('#modalh').remove();
		$('#notag').remove();
		$('#confirmtag').remove();
}  

function clicksave(){
	

	$('#modalh').remove();
	$('#tagActionModal').modal('hide');
	 var newStr='';
		$('#divtabexp').find('a').each(function() { 
		    var id = this.id;
		    var mar=$('#'+id+'marks').val();
		    var valstr=$('#'+id).attr('value');
		    valstr = valstr.substring(0, valstr.length-1);
		    if(mar!=''){
		    	var adval='';
		    	var addmark=valstr.split(',');
		    	for(var i=0;i<addmark.length;i++){
		    		var fmark=addmark[i]+'@'+mar;
		    		adval=adval+fmark+',';
		    	}
		    	newStr=newStr+adval;
		    }
		    else{
		     newStr=newStr+valstr;
		    }
		     
		    // do whatever...
		});
		 
		
		    var taginput=$('#taginput').val();
	
		
		newStr = newStr.substring(0, newStr.length-1);
		//tags = tags.substring(0, tags.length-1);
	//	alert(newStr);
		$.ajax({	
			method: "POST",
			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
			data: { "arystring" : newStr, "choice" : "save_questions", "categorycount" : 1,"tag" : taginput,"coursemid":coursemodule,"quizid":quizorgid,"random":randomqus,"recurse":bool}
		})
		.done(function( response ) {
			console.log(response);
			
				 $('.select1').prop("selectedIndex", 0);
	     	       $('.categorydropdown1').nextAll().remove();
	     	       $('.questionsAddbuttonsdiv').addClass('hidden');
	     	      $('#divtab').addClass('hidden');
	     	       $('#divtabexp').addClass('hidden');
	     	      $('.uploadquestionsAddbuttonsdiv').addClass('hidden');
	     	      tagid=1;
	     	            	 tagspanid=1;
	     	            	 tagex=1;
	     	             tagspanexid=1;
	     	             btnid=1;
	     	        	 spanid=1;
	     	        	 categoryId=0;
	     	        	 totalmark=0;
	     	        	 totalcount=0;
	     	        	 
	     	        	$('#exclude').find('span').each(function() { 
	            		    var tagids = this.id;
	            		    $('span[id^="'+tagids+'"]').remove();
	            		});
	            		 
	            		 $('#include').find('span').each(function() { 
	            		    var tagids = this.id;
	            		    $('span[id^="'+tagids+'"]').remove();

	            		});
	            		 $('#startdiv').addClass('hidden');
	            		 if(response==''){
	            		 $('<h4>Selected Questions Successfuly uploaded</h4>').appendTo('#resp');
	            		 }
	            		 else{
	            			 $('<h4 style="color:red";>'+response+'</h4>').appendTo('#resp');
	            		 }
	            		 
	            		 $('<div class="text-center"><button type="button" id="returnbank" class="btn btn-primary">Retun to bank</button><button type="button" id="returnquiz" class="btn">Return to quiz</button></div>').appendTo('#resp');

	            		 $('#resp').removeClass('hidden');
	            		 
	            		 
		            		 
	            		 $("#returnbank").click( function() {
	                 		window.location.reload();
	                 	});
	                 	$("#returnquiz").click( function() {
	                 		window.location.href = quizurl+"?id="+coursemodule;
	                 	});
	            		 
	            		 
	            		
			
		});
		

	
	
}
        	
        	
function sortSelect(select) {
    $(select).html($(select).children('option').sort(function (x, y) {
        return $(x).text().toUpperCase() < $(y).text().toUpperCase() ? -1 : 1;
    }));
    //Add empty select option tag and select it
    $( select + ' option:eq(0)').before('<option value="">Select</option>');
    $(select).get(0).selectedIndex = 0;
}


function clickbuton(id){
	
		 var spid=$('#'+id).parent().attr('id');
		 //alert($('#'+id).parent().attr('value'));
		 $('span[id^="'+spid+'"]').remove();
	
 	}

function typeChange(type){
	
	 if(type=='R'){
		 $('#randomselect').removeClass('hidden');
	
	 }
	 else{
		 $("#bankcount").val('');
		 $("#quizcount").val('');
		 $('#randomselect').addClass('hidden');
	 }

}


function deletebuton(id,del){
	$('#divduplicate').addClass('hidden');
	$('#'+id+del+'TR').remove();
	var newStrs='';
	 $('#tab2').find('a').each(function() { 
	    var ids = this.id;
	    var valstr=$('#'+ids).attr('value');
	     newStrs=newStrs+valstr;
	
	    // do whatever...
	});
	//alert(newStrs);
	newStrs = newStrs.substring(0, newStrs.length-2);
	
		var totalmarks=0;
		var totalcounts=0;
	
	if(newStrs!=''){
	var quesarrays = newStrs.split(",");
	
	var totalmarks=quesarrays.length;
	var totalcounts=quesarrays.length;
	}
	else{
		 $('.uploadquestionsAddbuttonsdiv').addClass('hidden');
	}
	
	 $("#totm").html(totalmarks);
	 $("#totc").html(totalcounts);
	 var totaltr= $('#tab2').find('tr').length-1;
	 
	 $("#sec").html(totaltr);
	 $("#ski").html(totaltr);
	 for (var i = 0; i < randomqus.length; i++){
		 var quesarrays = randomqus[i].split("@");
		    if (quesarrays[0] == id) { 
		    	randomqus.splice(i, 1);
		        break;
		    }
	 }
 	}

function showmodal(cat){
	/* $('#rem').click( function() {
 		var as=$(this).closest('span').attr('id');*/
	$('#divduplicate').addClass('hidden');
	
	var catid=cat;
 	   var ques=$('#'+cat).attr('value');
 	     
 	  ques = ques.substring(0, ques.length-1); 
 	  if(ques.includes('R')){
 		 $('#duphead').remove();
		 $('#randsel').remove();
 		 $('<h5 id="randsel" style="color:red">Edit is not allowed for Random Questions</h5>').appendTo('#divduplicate');
 		 $('#divduplicate').removeClass('hidden');
 	  }
 	  else{
 		 $('#duphead').remove();
		 $('#randsel').remove();
		 $('#divduplicate').addClass('hidden');
 	  	   var quesarray = ques.split(",");
 	     jQuery.ajax({	
    			method: "POST",
    			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
    			data: { "categoryid" : catid, "choice" : "get_questions"}
			})
			.done(function( response ) {
				console.log(response);
				jQuery("#classTable1").html("<tbody>"+response+"</tbody>");
				// $(".modal-body").html(response);
				//$('#confirmActionModal .modal-body tbody').append();
				for(var i=0;i<quesarray.length;i++){
					// alert(quesarray[i]);
				jQuery('.messageCheckbox').each(function(){
					if(quesarray[i].includes('@')){
						var quesat=quesarray[i].split("@");
						 if($(this).val()==quesat[0]){
		     		        	this.checked = true;
		     		        }
					}
					else{
     		        if($(this).val()==quesarray[i]){
     		        	this.checked = true;
     		        }
					}

     		    });
				}
				jQuery(".modal-body #bookId").val(cat);
				jQuery(".modal-body #quesId").val(ques);
				jQuery('#confirmActionModal').modal('show');
			});
    		
 	  }
 	}

var drop1='';
var drop2='';
var drop3='';
var drop4='';
var selstring='';
function selectChanged( element ){
	
	if(element.id=='dropone1'){
	var skillsSelect = document.getElementById(element.id);
	 drop1 = skillsSelect.options[skillsSelect.selectedIndex].text;
	  drop2='';
	  drop3='';
	  drop4='';
	}
	if(element.id=='dropone2'){
		var skillsSelect = document.getElementById(element.id);
		 drop2 = skillsSelect.options[skillsSelect.selectedIndex].text;
		 
		  drop3='';
		  drop4='';
		}
	if(element.id=='dropone3'){
		var skillsSelect = document.getElementById(element.id);
		 drop3 = skillsSelect.options[skillsSelect.selectedIndex].text;
		
		  drop4='';
		}
	if(element.id=='dropone4'){
		var skillsSelect = document.getElementById(element.id);
		 drop4 = skillsSelect.options[skillsSelect.selectedIndex].text;
		}
	//Remove all subsequent dropdowns as they all are useless now
	
	if(drop1!=''){
		 selstring=drop1+'/';
	}
	if(drop2!=''){
		 selstring=selstring+drop2+'/';
	}
	if(drop3!=''){
		 selstring=selstring+drop3+'/';
	}
	if(drop4!=''){
		 selstring=selstring+drop4+'/';
	}
	selstring = selstring.substring(0, selstring.length-1);
	console.log(element.id);
	var className = element.parentNode.className;
	className = className.split(' ').pop('-1');
	$('.' + className).nextAll().remove();
	
	//Ensure that the change event is not selecting the 'Select' option
	if( element.value ){
		
		
		//Make the buttons div visible when select1 is changed
		if( element.className.includes('select1') ){
			$('.questionsAddbuttonsdiv').removeClass('hidden');
		}
		
		//Make an ajax call to get the list of categories inside the given subcategory
		var categoryCount = $('.filterbuttonsdiv div.categoryfilter').length + 1;
		$.ajax({	
			method: "POST",
			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
			data: { "categoryid" : element.value , "choice" : "get_subcategory", "categorycount" : categoryCount }
		})
		.done(function( response ) {
			if ( response !== 'NO_DATA'){
	            //Category had subcategory
				
				$('.filterbuttonsdiv').append( response );
				sortSelect('.categorydropdown'+ categoryCount +' select' );
			}
		});
	}else if ( element.className.includes('select1') ){
		//only the first category is visible and select option is choosen in it
		$('.questionsAddbuttonsdiv').addClass('hidden');
	}
}

define('local_questionsfiltering/script', ['jquery'], function($) {
     return {
        init: function() {
         	
    	    // when page loads
        	$( document ).ready(function() {
        		
        			  $('.container-fluid').removeClass('hidden');
        		    
        		 
        		//lets build the first category dropdown
        		$.ajax({	
        			method: "POST",
        			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
        			data: { "categoryid" : 0, "choice" : "get_subcategory", "categorycount" : 1 }
    			})
    			.done(function( response ) {
    				$('.filterbuttonsdiv').append( response );
    				sortSelect('.categorydropdown1 select' );
    			});
        		
        		
        		$('<div id="tagbasediv"style="margin-right: 5px;" class="autocomplete" ><div><h5 style="padding-top:5px">With following tags</h5></div><div id="include"><input id="taginclude" style=" border: 1px solid lightgrey;" type="text" name="taginc" placeholder="Include tags"></div><div><h5 style="padding-top:5px">Without following tags</h5></div><div id="exclude"><input id="tagexclude" style=" border: 1px solid lightgrey;" type="text" name="taginc" placeholder="Exclude tags"></div></div>').appendTo('#tagdiv');
        		//$('<div id="spandiv"></div>').appendTo('#tagdiv');
        		$('<div id="picone" class="row col-sm-12"><h5 style="padding-top:5px">Select Question type</h5></div><div class="col-sm-12" id="sel"><select style=" border: 1px solid lightgrey;" id="type" onchange="typeChange(this.value)"><option value="P">Pick</option><option value="R">Random</option></select></div>').appendTo('#pickdiv');
        		$('<div class="row col-sm-12 row hidden" id="randomselect"><div style="margin-left:10px"><h5 style="padding-top: 6px;">Question count for Bank: </h5></div><div  style="margin-left:20px"><input style="border: 1px solid lightgrey;width:50px;text-align: center;"id="bankcount" type="text" name="bcount"></div><div style="margin-left:10px"><h5 style="padding-top: 6px;">Question count for Quiz: </h5></div><div style="margin-left:20px"><input style="border: 1px solid lightgrey;width:50px;text-align: center;"id="quizcount" type="text" name="bcount"></div></div>').appendTo('#sel');        		  
        		$('<div id="alertone" class="row col-sm-12 hidden"> <h5 style="padding-top:5px;color:red">please fill question count</h5> </div>').appendTo('#sel'); 
        		 
        		 
        		/* $("#tagin").keypress(function(e) {
             	    if(e.which == 13) {
             	    	 var tagstr=$("#tagin").val();
             	    	 var s = $('<button type="button" id="rem'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                		 var span = $('<span id="span'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                		 span.append(s);
                		 $('#intag').append('    ');
                		 $('#intag').append(span);
                		$("#tagin").val('');
                		tagid=tagid+1;
                		tagspanid=tagspanid+1;
                		
             	    }
             	});*/
        		 
        		 $("#taginclude").keypress(function(e) {
              	    if(e.which == 13) {
              	    	 var tagstr=$("#taginclude").val();
              	    	if(tagstr!=''){
              	    	 var st = $('<button type="button" id="remin'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                		 var spant = $('<span id="in'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                		 spant.append(st);
                		 $('#include').append('    ');
                		 $('#include').append(spant);
                		$("#taginclude").val('');
                		tagid=tagid+1;
                		tagspanid=tagspanid+1;
              	    	}
                 		
              	    }
              	});
        		 
        		
        		 
        		 $("#taginclude").on("mouseup",function() {
               	    if(e.which == 13) {
               	    	 var tagstr=$("#taginclude").val();
               	    	if(tagstr!=''){
               	    	 var st = $('<button type="button" id="remin'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                 		 var spant = $('<span id="in'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                 		 spant.append(st);
                 		 $('#include').append('    ');
                 		 $('#include').append(spant);
                 		$("#taginclude").val('');
                 		tagid=tagid+1;
                 		tagspanid=tagspanid+1;
               	    	}
                  		
               	    }
               	});
        		 
        		 $("#tagexclude").keypress(function(e) {
                	    if(e.which == 13) {
                	    	 var tagstr=$("#tagexclude").val();
                	    	if(tagstr!=''){
                	    	 var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                  		 var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                  		 spant.append(st);
                  		 $('#exclude').append('    ');
                  		 $('#exclude').append(spant);
                  		$("#tagexclude").val('');
                  		tagex=tagex+1;
                  		tagspanexid=tagspanexid+1;
                	    	}	
                	    }
                	});
        		 
        		 
        		 $("#tagexclude").on("mouseup",function() {
               	    if(e.which == 13) {
               	    	 var tagstr=$("#tagexclude").val();
               	    	if(tagstr!=''){
               	    	 var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                 		 var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                 		 spant.append(st);
                 		 $('#exclude').append('    ');
                 		 $('#exclude').append(spant);
                 		$("#tagexclude").val('');
                 		tagex=tagex+1;
                 		tagspanexid=tagspanexid+1;
               	    	}	
               	    }
               	});
        		
        		 function autocomplete(inp, arr) {
        				
        				  /*the autocomplete function takes two arguments,
        				  the text field element and an array of possible autocompleted values:*/
        				  var currentFocus;
        				  /*execute a function when someone writes in the text field:*/
        				  inp.addEventListener("input", function(e) {
        				      var a, b, i, val = this.value;
        				      /*close any already open lists of autocompleted values*/
        				      closeAllLists();
        				      if (!val) { return false;}
        				      currentFocus = -1;
        				      /*create a DIV element that will contain the items (values):*/
        				      a = document.createElement("DIV");
        				      a.setAttribute("id", this.id + "autocomplete-list");
        				      a.setAttribute("class", "autocomplete-items");
        				      /*append the DIV element as a child of the autocomplete container:*/
        				      this.parentNode.appendChild(a);
        				      /*for each item in the array...*/
        				      for (i = 0; i < arr.length; i++) {
        				        /*check if the item starts with the same letters as the text field value:*/
        				        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
        				          /*create a DIV element for each matching element:*/
        				          b = document.createElement("DIV");
        				          /*make the matching letters bold:*/
        				          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
        				          b.innerHTML += arr[i].substr(val.length);
        				          /*insert a input field that will hold the current array item's value:*/
        				          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
        				          /*execute a function when someone clicks on the item value (DIV element):*/
        				              b.addEventListener("click", function(e) {
        				              /*insert the value for the autocomplete text field:*/
        				              inp.value = this.getElementsByTagName("input")[0].value;
        				              /*close the list of autocompleted values,
        				              (or any other open lists of autocompleted values:*/
        				              closeAllLists();
        				          });
        				          a.appendChild(b);
        				        }
        				      }
        				  });
        				  /*execute a function presses a key on the keyboard:*/
        				  inp.addEventListener("keydown", function(e) {
        				      var x = document.getElementById(this.id + "autocomplete-list");
        				      if (x) x = x.getElementsByTagName("div");
        				      if (e.keyCode == 40) {
        				    	
        				        /*If the arrow DOWN key is pressed,
        				        increase the currentFocus variable:*/
        				        currentFocus++;
        				        
        				        
        				        
        				        /*and and make the current item more visible:*/
        				        addActive(x);
        				        
        				      } else if (e.keyCode == 38) { //up
        				        /*If the arrow UP key is pressed,
        				        decrease the currentFocus variable:*/
        				        currentFocus--;
        				        /*and and make the current item more visible:*/
        				        addActive(x);
        				      } else if (e.keyCode == 13) {
        				        /*If the ENTER key is pressed, prevent the form from being submitted,*/
        				        
        				        if (currentFocus > -1) {
        				          /*and simulate a click on the "active" item:*/
        				          if (x) x[currentFocus].click();
        				        }
        				      }
        				  });
        				  function addActive(x) {
        				    /*a function to classify an item as "active":*/
        				    if (!x) return false;
        				    /*start by removing the "active" class on all items:*/
        				    removeActive(x);
        				    if (currentFocus >= x.length) currentFocus = 0;
        				    if (currentFocus < 0) currentFocus = (x.length - 1);
        				    /*add class "autocomplete-active":*/
        				    x[currentFocus].classList.add("autocomplete-active");
        				  }
        				  function removeActive(x) {
        				    /*a function to remove the "active" class from all autocomplete items:*/
        				    for (var i = 0; i < x.length; i++) {
        				      x[i].classList.remove("autocomplete-active");
        				    }
        				  }
        				  function closeAllLists(elmnt) {
        				    /*close all autocomplete lists in the document,
        				    except the one passed as an argument:*/
        				    var x = document.getElementsByClassName("autocomplete-items");
        				    for (var i = 0; i < x.length; i++) {
        				      if (elmnt != x[i] && elmnt != inp) {
        				      x[i].parentNode.removeChild(x[i]);
        				    }
        				  }
        				}
        				/*execute a function when someone clicks in the document:*/
        				document.addEventListener("click", function (e) {
        				    closeAllLists(e.target);
        				    
        				    
        				    var tagstr=$("#taginclude").val();
                   	    	if(tagstr!=''){
                   	    	 var st = $('<button type="button" id="remin'+tagid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                     		 var spant = $('<span id="in'+tagspanid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                     		 spant.append(st);
                     		 $('#include').append('    ');
                     		 $('#include').append(spant);
                     		$("#taginclude").val('');
                     		tagid=tagid+1;
                     		tagspanid=tagspanid+1;
                   	    	}
                   	    	
                   	     var tagstr=$("#tagexclude").val();
                	    	if(tagstr!=''){
                	    	 var st = $('<button type="button" id="remex'+tagex+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
                  		 var spant = $('<span id="ex'+tagspanexid+'" class="tag label label-info" value='+tagstr+'>'+tagstr+'</span>');
                  		 spant.append(st);
                  		 $('#exclude').append('    ');
                  		 $('#exclude').append(spant);
                  		$("#tagexclude").val('');
                  		tagex=tagex+1;
                  		tagspanexid=tagspanexid+1;
                	    	}
        				    
        				});
        				} 
        		 
        		 
        		 
        		 
        		 $.ajax({	
         			method: "POST",
         			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
         			data: { "categoryid" : 0, "choice" : "get_tags", "categorycount" : 1 }
     			})
     			.done(function( response ) {
     				console.log(response);
     				/*var arycon=[response.join(',')];
     				console.log(arycon);*/
     				var ary=response.substring(0, response.length-1);
     				ary=ary.substring(1);
     				ary=ary.replace(/"/g, '');
     				var final=ary.split(',');
     				autocomplete(document.getElementById("taginclude"), final);
     				autocomplete(document.getElementById("tagexclude"), final);
     			});
        		 
        		 
        		 
             	 
        		 
        		
        	});
        	
        	var btnid=1;
        	var spanid=1;
        	var categoryId=0;
        	var totalmark=0;
        	var totalcount=0;
        	$("#sub").click( function() {
       		 $('#noques').addClass('hidden');

        		 $('#randommodal').addClass('hidden');
        		var modaledit=$('#bookId').val();
        		var editquesdup=$('#quesId').val();
        		//alert(modaledit);
        		var final='';
        		var count=0;
        		var marktotal=0;
        		var newStr='';
        		var dup='';
        		$('#divtabexp').find('a').each(function() { 
        		    var id = this.id;
        		    var valstr=$('#'+id).attr('value');
        		     newStr=newStr+valstr;
        		
        		    // do whatever...
        		});

        		newStr = newStr.substring(0, newStr.length-1);
        		var arr=newStr.split(',');
        		var editexist=editquesdup.split(',');
        		 $('.messageCheckbox:checked').each(function(){        
        		        var values = $(this).val();
        		        if(modaledit!='' && modaledit!='Rand'){
        		        	 if($.inArray(values, editexist) != -1){
        		        	 var marks = $(this).attr('name');
             		        final =final+values+',';
             		        marktotal= +marktotal + +marks;
//             		    arr.push({values});    
             		      count= count+1;
             		    // alert(final);
        		        	 }
        		        	 else{
        		        		  if($.inArray(values, arr) == -1){

        	        		        	 var marks = $(this).attr('name');
        	             		        final =final+values+',';
        	             		        marktotal= +marktotal + +marks;
//        	             		    arr.push({values});    
        	             		      count= count+1;
        	             		    // alert(final);
        	        		        	
        	        		        }
        	        		        else{
        	        		        	dup='true';
        	        		        }
        		        	 }
        		        }
        		        else{
        		        if($.inArray(values, arr) == -1){

        		        	 var marks = $(this).attr('name');
        		        	 if(modaledit=='Rand'){
        		        		 values=values+'@'+'R';
        		        	 }
             		        final =final+values+',';
             		        marktotal= +marktotal + +marks;
//             		    arr.push({values});    
             		      count= count+1;
             		    // alert(final);
        		        	
        		        }
        		        else{
        		        	dup='true';
        		        }
        		        }
        		        

        		    });
        		
        		
        		 
        		var total= $('#classTable1').find('tr').length;
        		
        		if(modaledit!='' && modaledit!='Rand'){
        			$('#'+modaledit).html(count);
        			$('#'+modaledit).attr("value",final);
        			 $('#confirmActionModal').modal('hide');
        			 $('#'+modaledit+'mark').html(count);
        			 $(".modal-body #bookId").val('');
        			 var newStr='';
        			 $('#divtabexp').find('a').each(function() { 
             		    var id = this.id;
             		    var valstr=$('#'+id).attr('value');
             		     newStr=newStr+valstr;
             		
             		    // do whatever...
             		});
             		
             		newStr = newStr.substring(0, newStr.length-2);
             		var quesarray = newStr.split(",");
             		totalmark=quesarray.length;
             		totalcount=quesarray.length;
             		//alert('mark'+totalmark);
             		 $("#totm").html(totalmark);
        			 $("#totc").html(totalcount);
        		}
        		
        		else{
        			if($("#type").val()=='R'){
            			//if($.inArray(categoryId+'@'+$('#quizcount').val(), randomqus) != -1){
            				randomqus.push(categoryId+'@'+$('#quizcount').val());
            				
            			//}
            			// $("#type").val('P');
        				 $("#bankcount").val('');
        				 $("#quizcount").val('');
        				// $('#randomselect').addClass('hidden');
            			//alert(randomqus);
        				 
           		}
        		 /*var s = $('<button type="button" id="rem'+btnid+'" class="close" aria-label="Close" style="font-size:15px;padding-left:4px" onclick="clickbuton(this.id)">&times;</button>');
        		 var span = $('<span id="span'+spanid+'" class="tag label label-info" value='+final+'>'+selstring+'</span>');
        		 span.append(s);
        		 $('<div id="div1">hello</div>').appendTo('#parent');
        		 $('#div1').append('    ');
        		 $('#div1').append(span);*/
        		 $('#confirmActionModal').modal('hide');
        		 $('.uploadquestionsAddbuttonsdiv').removeClass('hidden');
        		 if(spanid==1){
        			 var table_body2 = '<table id="tab2" style="margin:auto;" width="80%" border="1">';
        		 }
        		 var number_of_rows = 2;
                 var number_of_cols = 4;
                
                 var table_body = '<table id="tab1" style="margin:auto;" width="80%" border="1">';
                 
                 for(var i=0;i<number_of_rows;i++){
                   table_body+='<tr>';
if(i==0){
	 table_body +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
     table_body +='<span id="sec" style="font-size: 2.0em;color: blue">'+spanid+'</span> <span>SECTIONS</span>';
     table_body +='</td>';
     
     table_body +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
     table_body +='<span id="ski" style="font-size: 2.0em;color: blue">'+spanid+'</span> <span>SKILLS</span>';
     table_body +='</td>';
     
     table_body +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
     table_body +='<span  id="totc" style="font-size: 2.0em;color: blue">'+totalcount+'</span> <span>QUESTIONS</span>';
     table_body +='</td>';
     
     table_body +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
     table_body +='<span  id="totm" style="font-size: 2.0em;color: blue">'+totalmark+'</span> <span>MARKS</span>';
     table_body +='</td>';
 }

                   
                   table_body+='</tr>';
                 }
                   table_body+='</table>';
                   $('#divtab').removeClass('hidden');
                  $('#divtab').html(table_body);
        		 
        		 
if(spanid!=1){
	var table_body2='';
}

        		
        			             
        		    if(spanid==1){
        		    	table_body2+='<tr>'; 
        		    	 table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		         table_body2 +='SECTIONS';
        		         table_body2 +='</td>';
        		         
        		         table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='No.Of.Questions';
        		         table_body2 +='</td>';
        		         
        		         table_body2 +='<td  style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='Selected Questions';
        		         table_body2 +='</td>';
        		         
        		         table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='Marks';
        		         table_body2 +='</td>';
        		        
        		         
        		         table_body2 +='<td style="text-align:center;font-style:italic; border: 1px solid lightgrey;">';
        		         table_body2 +='Delete';
        		         table_body2 +='</td>';
        		         table_body2+='</tr>';
        		     }
        		    table_body2+='<tr id="'+categoryId+del+'TR'+'">'; 
        		    for(var j=0;j<5;j++){
        		    	 
        		 	   if(j==0){
        		 		   table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		 	        table_body2 +=selstring;
        		 	        table_body2 +='</td>';
        		 	   }
        		 if(j==1){
        		 	table_body2 +='<td height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		     table_body2 +=total;
        		     table_body2 +='</td>';
        		 	   }
        		 
        		 if(j==2){
        			
        		 	table_body2 +='<td  height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		     table_body2 +='<a id="'+categoryId+'"onClick="showmodal('+categoryId+');" value="'+final+'"href=#>'+count+'</a>';
        		     table_body2 +='</td>';
        		 }
        		 if(j==3){
        		 	table_body2 +='<td id="'+categoryId+'m'+'" height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
        		     table_body2 +='<input style="border: 1px solid lightgrey;width:50px;text-align: center;"id="'+categoryId+'marks'+'" type="text" name="marks" value="1">';
        		     table_body2 +='</td>';
        		 }
        		 if(j==4){
         		 	table_body2 +='<td id="'+categoryId+'delete'+'" height="50"  style="text-align:center;font-style:italic; border:1px solid lightgrey;">';
         		     table_body2 +='<span style="cursor: pointer;" onClick="deletebuton('+categoryId+','+del+');" ><i class="fa fa-trash" aria-hidden="true"></i></span>';
         		     table_body2 +='</td>';
         		    del=del+1;
         		 }
        		    }
        		                       
        		                       table_body2+='</tr>';
        		                    
        		 if(spanid==1){
        		                       table_body2+='</table>';
        		                       $('#divtabexp').removeClass('hidden');
        		                      $('#divtabexp').html(table_body2);
        		                     //$('<div><h5 style="padding-top:5px">Tag</h5></div><div id="include"><input id="taginput" style=" border: 1px solid lightgrey;" type="text"  placeholder="tags"></div><div>').appendTo('#divtabexp');
        		                      
        		 }
        		 if(spanid!=1){
            		 $("#tab2").append(table_body2);
            		 }
        		 btnid=btnid+1;
        		 spanid=spanid+1;
        		 var newStrs='';
        		 $('#tab2').find('a').each(function() { 
        		    var ids = this.id;
        		    var valstr=$('#'+ids).attr('value');
        		     newStrs=newStrs+valstr;
        		
        		    // do whatever...
        		});
        		
        		newStrs = newStrs.substring(0, newStrs.length-2);
        		
        			var totalmarks=0;
        			var totalcounts=0;
        		
        		if(newStrs!=''){
        		var quesarrays = newStrs.split(",");
        		
        		var totalmarks=quesarrays.length;
        		var totalcounts=quesarrays.length;
        		}
        		
        		 $("#totm").html(totalmarks);
        		 $("#totc").html(totalcounts);
        		 var totaltr= $('#tab2').find('tr').length-1;
        		 
        		 $("#sec").html(totaltr);
        		 $("#ski").html(totaltr);
        		}
        		//alert(dup);
        		 if(dup=='true'){
        			 $('#duphead').remove();
        			 $('#randsel').remove();
            		 $('<h5 id="duphead" style="color:red">Duplicate questions have been removed in "'+selstring+'" section</h5>').appendTo('#divduplicate');
            		 $('#divduplicate').removeClass('hidden');
            		 }
        		/* $('#editques').click(function(){
               		//get the category id from last non empty dropdown
               		var categoryId = $(#editques).attr('value');
               		
               		alert(categoryId);
               		//Fetch the quiz questions from categoryid and show in modal with required form elements
               		$.ajax({	
               			method: "POST",
               			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
               			data: { "categoryid" : categoryId, "choice" : "get_questions"}
           			})
           			.done(function( response ) {
           				console.log(response);
           				 $("#classTable1").html("<tbody>"+response+"</tbody>");
           				// $(".modal-body").html(response);
           				//$('#confirmActionModal .modal-body tbody').append();
           				$('#confirmActionModal').modal('show');
           			});
               		
               	});	*/
        		 $(".modal-body #bookId").val('');
        		 
     	});
      
        	
        	
        	$("#subtag").click( function() {
        		var taginput=$('#taginput').val();
        		//alert(randomqus);
        		if(taginput!=''){
        		$.ajax({	
        			method: "POST",
        			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
        			data: { "choice" : "check_tag", "categorycount" : 1,"tag" : taginput}
    			})
    			.done(function( response ) {
    				console.log(response);
    				if(response=='False'){
    					$('#modalh').remove();
    					//$('#tagconfirmModal').modal('show');
    					$('#tagActionModal').find(".modal-footer").hide();
    					$('#tagActionModal .modal-body2').find("#taginput").hide();
    					$('#tagActionModal .modal-body2').append('<h5 id="modalh" style="color:red">Tag already exist,continue with same tag ?</h5> <button id="notag" onclick="clickno()" class="btn btn-default" type="button">No</button><button id="confirmtag"  style="margin-left: 10px" class="btn btn-primary" btn="submt" onclick="clicksave()" type="button">Yes</button>');
    				}
    				else{
    					$('#modalh').remove();
    					$('#tagActionModal').modal('hide');
    					 var newStr='';
    		        		$('#divtabexp').find('a').each(function() { 
    		        		    var id = this.id;
    		        		    var mar=$('#'+id+'marks').val();
    		        		    var valstr=$('#'+id).attr('value');
    		        		    valstr = valstr.substring(0, valstr.length-1);
    		        		    if(mar!=''){
    		        		    	var adval='';
    		        		    	var addmark=valstr.split(',');
    		        		    	for(var i=0;i<addmark.length;i++){
    		        		    		var fmark=addmark[i]+'@'+mar;
    		        		    		adval=adval+fmark+',';
    		        		    	}
    		        		    	newStr=newStr+adval;
    		        		    }
    		        		    else{
    		        		     newStr=newStr+valstr;
    		        		    }
    		        		     
    		        		    // do whatever...
    		        		});
    		        		 
    		        		
    		        		    var taginput=$('#taginput').val();
    		        	
    		        		
    		        		newStr = newStr.substring(0, newStr.length-1);
    		        		//tags = tags.substring(0, tags.length-1);
    		        	//	alert(newStr);
    		        		$.ajax({	
    		        			method: "POST",
    		        			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
    		        			data: { "arystring" : newStr, "choice" : "save_questions", "categorycount" : 1,"tag" : taginput,"coursemid":coursemodule,"quizid":quizorgid,"random":randomqus,"recurse":bool}
    		    			})
    		    			.done(function( response ) {
    		    				console.log(response);
    		    				
    		    					 $('.select1').prop("selectedIndex", 0);
    		    		     	       $('.categorydropdown1').nextAll().remove();
    		    		     	       $('.questionsAddbuttonsdiv').addClass('hidden');
    		    		     	      $('#divtab').addClass('hidden');
    		    		     	       $('#divtabexp').addClass('hidden');
    		    		     	      $('.uploadquestionsAddbuttonsdiv').addClass('hidden');
    		    		     	      tagid=1;
    		    		     	            	 tagspanid=1;
    		    		     	            	 tagex=1;
    		    		     	             tagspanexid=1;
    		    		     	             btnid=1;
    		    		     	        	 spanid=1;
    		    		     	        	 categoryId=0;
    		    		     	        	 totalmark=0;
    		    		     	        	 totalcount=0;
    		    		     	        	 
    		    		     	        	$('#exclude').find('span').each(function() { 
    		    		            		    var tagids = this.id;
    		    		            		    $('span[id^="'+tagids+'"]').remove();
    		    		            		});
    		    		            		 
    		    		            		 $('#include').find('span').each(function() { 
    		    		            		    var tagids = this.id;
    		    		            		    $('span[id^="'+tagids+'"]').remove();

    		    		            		});
    		    		            		 $('#startdiv').addClass('hidden');
    		    		            		 if(response==''){
    		    		            		 $('<h4>Selected Questions Successfuly uploaded</h4>').appendTo('#resp');
    		    		            		 }
    		    		            		 else{
    		    		            			 $('<h4 style="color:red";>'+response+'</h4>').appendTo('#resp');
    		    		            		 }
    		    		            		 
    		    		            		 $('<div class="text-center"><button type="button" id="returnbank" class="btn btn-primary">Retun to bank</button><button type="button" id="returnquiz" class="btn">Return to quiz</button></div>').appendTo('#resp');

    		    		            		 $('#resp').removeClass('hidden');
    		    		            		 
    		    		            		 
        		    		            		 
    		    		            		 $("#returnbank").click( function() {
    		    		                 		window.location.reload();
    		    		                 	});
    		    		                 	$("#returnquiz").click( function() {
    		    		                 		window.location.href = quizurl+"?id="+coursemodule;
    		    		                 	});
    		    		            		 
    		    		            		 
    		    		            		
    		    				
    		    			});
    		        		
    				}
    			});
        	}
        		else{
        			$('#modalh').remove();
					//$('#tagconfirmModal').modal('show');
					$('#tagActionModal').find(".modal-footer").hide();
					$('#tagActionModal .modal-body2').find("#taginput").hide();
					$('#tagActionModal .modal-body2').append('<h5 id="modalh" style="color:red">Tag is empty,continue without tag ?</h5> <button id="notag" onclick="clickno()" class="btn btn-default" type="button">No</button><button id="confirmtag"  style="margin-left: 10px" class="btn btn-primary" btn="submt" onclick="clicksave()" type="button">Yes</button>');
        		}
        	});
        	
        	
        	$("#cancel").click( function() {
        		$('#divduplicate').addClass('hidden');
        		 $('.select1').prop("selectedIndex", 0);
	     	       $('.categorydropdown1').nextAll().remove();
	     	       $('.questionsAddbuttonsdiv').addClass('hidden');
	     	      $('#divtab').addClass('hidden');
	     	       $('#divtabexp').addClass('hidden');
	     	      $('.uploadquestionsAddbuttonsdiv').addClass('hidden');
	     	      tagid=1;
	     	            	 tagspanid=1;
	     	            	 tagex=1;
	     	             tagspanexid=1;
	     	             btnid=1;
	     	        	 spanid=1;
	     	        	 categoryId=0;
	     	        	 totalmark=0;
	     	        	 totalcount=0;
	     	        	 
	     	        	$('#exclude').find('span').each(function() { 
	            		    var tagids = this.id;
	            		    $('span[id^="'+tagids+'"]').remove();
	            		});
	            		 
	            		 $('#include').find('span').each(function() { 
	            		    var tagids = this.id;
	            		    $('span[id^="'+tagids+'"]').remove();

	            		});
	            		 $("#type").val('P');
        				 $("#bankcount").val('');
        				 $("#quizcount").val('');
        				 $('#randomselect').addClass('hidden');
	     	        	 
      	      
      	});
        	
        	
        	$("#reset").click( function() {
        		$('#divduplicate').addClass('hidden');
     	       $('.select1').prop("selectedIndex", 0);
     	       $('.categorydropdown1').nextAll().remove();
     	       $('.questionsAddbuttonsdiv').addClass('hidden');
     	      $("#type").val('P');
				 $("#bankcount").val('');
				 $("#quizcount").val('');
				 $('#randomselect').addClass('hidden');
     	      
     	});
        	
        	
        	$("#addquestionquiz").click( function() {
        		//lets build the first category dropdown
        		 $('#duphead').remove();
    			 $('#randsel').remove();
        		 $('#divduplicate').addClass('hidden');
        		
        		
        		$('#tagActionModal').modal({backdrop: 'static', keyboard: false});
        		$('#tagActionModal').modal('show');
        		
 
        	});
        	
        	$("#canceltag").click( function() {
        		//lets build the first category dropdown
        		$('#taginput').val('');
        		$('#modalh').remove();
 
        	});
        	 
        	
        	
        	
        	//Implement Add questions click functionality
        	$('#addquestion').click(function(){
        		$('#divduplicate').addClass('hidden');
        		 $('#randommodal').addClass('hidden');
        		 $('#noques').addClass('hidden');
        		//get the category id from last non empty dropdown
        		 categoryId = 0;
        		var len = $('.categoryfilter select').length
        		if ( $('.select' + len).val() ){
        			categoryId = $('.select' + len).val();
        		}else if ( $('.select' + (len-1)).val() ){
        			categoryId = $('.select' + (len-1)).val();
        		}
        		//alert(categoryId);
        		
        		 var extag='';
        		 $('#exclude').find('span').each(function() { 
        		    var tagids = this.id;
        		    if(tagids!=''){
        		    var tagstr=$('#'+tagids).attr('value');
        		   
        		    extag=extag+tagstr+',';
        		    }
        		    
        		
        		    // do whatever...
        		});
        		 extag = extag.substring(0, extag.length-1);
        		 var intag='';
        		 $('#include').find('span').each(function() { 
        		    var tagids = this.id;
        		    if(tagids!=''){
        		    var tagstr=$('#'+tagids).attr('value');
        		    intag=intag+tagstr+',';
        		    }
        		    
        		
        		    // do whatever...
        		});
        		
        		 intag = intag.substring(0, intag.length-1);
        		 //alert(extag);
        		// alert(intag);
        		//Fetch the quiz questions from categoryid and show in modal with required form elements
        		$.ajax({	
        			method: "POST",
        			url: M.cfg.wwwroot + '/local/questionsfiltering/ajax.php',
        			data: { "categoryid" : categoryId, "choice" : "get_questions","exclude":extag,"include":intag}
    			})
    			.done(function( response ) {
    				console.log(response);
    				if(response.includes("No ques")){
    					 $("#classTable1").html("<tbody>"+response+"</tbody>");
    					 $('#confirmActionModal').modal('show');
        				 $('#noques').removeClass('hidden');
    				}
    				else{
    				 $("#classTable1").html("<tbody>"+response+"</tbody>");
    				// $(".modal-body").html(response);
    				//$('#confirmActionModal .modal-body tbody').append();
    				 if($("#type").val()=='R'){
    					var b= $("#bankcount").val();
    					 var q=$("#quizcount").val();
    					 if(b==''||q==''){
    						 $('#alertone').removeClass('hidden');
    					 }
    					 else{
    						 $('#alertone').addClass('hidden');
    				 var totques=$('#classTable1').find('tr').length;
    				
    				var bankcount=$('#bankcount').val();
    				var selctedrand=[];
    				 for(var z=0;z<bankcount;z++){
    					var random=Math.floor(Math.random() * totques);
    					if($.inArray(random, selctedrand) == -1){
    					 var ir=0;
    					 selctedrand[z]=random;
    				 $('.messageCheckbox').each(function(){  
    					 if(ir==random){
    						 this.checked = true;
    						return false;
    					 }
    					 ir=ir+1;
    				 });
    				 }
    					else{
    						z=z-1;
    					}
    				 }
    				
    				 $(".modal-body #bookId").val('Rand');
     				 $('#confirmActionModal').modal('show');
    				 $('#randommodal').removeClass('hidden');
    					 }
    				 }
    				 else{
    				$('#confirmActionModal').modal('show');
    				
    				 }
    				}
    			});
        		
        	});
        }
     };
});
define('local_tekarchive/script', ['jquery', 'core/ajax'], function($, ajax) {

	return {
		init: function() {

			// $(document).ready( function () {
				$('document').ready(function(){
					//Archival request process
					$(document).on("click","#archive",function() {
						var userids = [];
			            $.each($("input[name='user_id']:checked"), function(){            
			            	userids.push($(this).val());
			            });
	                	// console.log(userids);
	                	var promises = ajax.call([{
		                    methodname: 'local_tekarchive_archive_request',
		                    args: {'userids': userids}
		                }, ]);

		                promises[0].done(function(response) {
		                	location.reload();
		                	//Nothing to do here as of now      
		                }).fail(function(ex) {
		                    console.log(ex);
		                });
	                });
				});
				// Reset button event
				$('.resetDate').click(function(){
					// $(".resetDate").addClass("disabled"); 
					$('.form-control').val('');
					// userTable.clear().draw(); ---- Need to include while including datatable
			  	});


			    //Applying filter
			    $('#search').click(function() {
			    	// var fields = new Array();
					// var datas = new Array();

			    	$(".resetDate").removeClass("disabled");
			    	var date = $('#maxdate').val();
			    	var field1 = $('#profiledropdown1').val();
			    	var field2 = $('#profiledropdown2').val();
			    	var field3 = $('#profiledropdown3').val();
			    	var data1 = $('#profiledata1').val();
			    	var data2 = $('#profiledata2').val();
			    	var data3 = $('#profiledata3').val();
			    	var suspended = 0;
			    	const ids = document.querySelector('input[name="suspend"]');
			    	if(ids.checked)
			        {
			        	suspended = 1;
			        }

			    	var fields = [field1, field2, field3];
			    	var datas = [data1, data2, data3];

			    	for(var i=0; i<3; i++){
			    		if(!fields[i]){
			    			fields[i] = 0;
			    		}
			    		if(!datas[i]){
			    			datas[i] = 0;
			    		}
			    	}

			    	// console.log(date, fields, datas);

			    	var promises = ajax.call([{
	                    methodname: 'local_tekarchive_filter_userdata',
	                    args: {'maxdate': date, 'profileids' : fields , 'profiledata' : datas, 'suspended' : suspended}
	                }, ]);
    
	                promises[0].done(function(response) {
	                    document.getElementById('cacheuser-list').innerHTML = response.html;

	                    $( "#extend-alluser" ).change(function() {
	                    	checkAll(this);
	                    });
	                //     $(document).on("click","#archive",function() {
	                // 	console.log('hii');
	                // });
						// var userTable=$('#usergradetable').DataTable();
	                }).fail(function(ex) {
	                    console.log(ex);
	                });
			   	});

			    //Function for checking all check boxes
			   	function check(checked = true) {
				    const ids = document.querySelectorAll('input[name="user_id"]');
				    ids.forEach((id) => {
				        id.checked = checked;
				    });
				}

				//function triggered when checking select all check box
				function checkAll(checkboxElem) {
				  if (checkboxElem.checked) {
				  check();
				   $("#archive").removeClass("disabled");
				  } else {
				    check(false);
				    $("#archive").addClass("disabled");
				  }
				}

				//events to be happened with check boxes
				$( ".user_id" ).change(function() {
					var flag=0;
					if($(this).prop("checked") == false){
				        $("#extend-alluser").prop("checked", false);
				    }
				    const ids = document.querySelectorAll('input[name="user_id"]');
				    ids.forEach((id) => {
				        if(id.checked)
				        {
				        	flag=1;
				        }
				    });
				    if(flag==1){
				    	$("#archive").removeClass("disabled");
				    } else{
				    	$("#archive").addClass("disabled");
				    }
				});

			    
			// } );
			//Reset filter
			// $('.resetDate').click(function(){
			// 	$(".resetDate").addClass("disabled"); 
			// 	$('.form-control').val('');
			// 	userTable.clear().draw();
		 //  	});
		}
	};

});
